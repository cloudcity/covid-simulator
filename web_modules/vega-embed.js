import{c as Cq}from"./common/_commonjsHelpers-1d2f7e84.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function $(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function zl(a,b,c,d){function e(f){return f instanceof c?f:new c(function(g){g(f)})}return new(c||(c=Promise))(function(f,g){function h(k){try{j(d.next(k))}catch(l){g(l)}}function i(k){try{j(d.throw(k))}catch(l){g(l)}}function j(k){k.done?f(k.value):e(k.value).then(h,i)}j((d=d.apply(a,b||[])).next())})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var NP=function(){var a=function(b,c){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,e){d.__proto__=e}||function(d,e){for(var f in e)e.hasOwnProperty(f)&&(d[f]=e[f])},a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d())}}(),OP=Object.prototype.hasOwnProperty;function Dq(a,b){return OP.call(a,b)}function Eq(a){if(Array.isArray(a)){for(var b=new Array(a.length),c=0;c<b.length;c++)b[c]=""+c;return b}if(Object.keys)return Object.keys(a);var b=[];for(var d in a)Dq(a,d)&&b.push(d);return b}function Ac(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}}function Fq(a){for(var b=0,c=a.length,d;b<c;){d=a.charCodeAt(b);if(d>=48&&d<=57){b++;continue}return!1}return!0}function Wf(a){return a.indexOf("/")===-1&&a.indexOf("~")===-1?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function nz(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function Gq(a){if(a===void 0)return!0;if(a){if(Array.isArray(a)){for(var b=0,c=a.length;b<c;b++)if(Gq(a[b]))return!0}else if(typeof a==="object"){for(var d=Eq(a),e=d.length,b=0;b<e;b++)if(Gq(a[d[b]]))return!0}}return!1}function oz(a,b){var c=[a];for(var d in b){var e=typeof b[d]==="object"?JSON.stringify(b[d],null,2):b[d];typeof e!=="undefined"&&c.push(d+": "+e)}return c.join(`
`)}var pz=function(a){NP(b,a);function b(c,d,e,f,g){var h=this.constructor,i=a.call(this,oz(c,{name:d,index:e,operation:f,tree:g}))||this;return i.name=d,i.index=e,i.operation=f,i.tree=g,Object.setPrototypeOf(i,h.prototype),i.message=oz(c,{name:d,index:e,operation:f,tree:g}),i}return b}(Error),Ya=pz,PP=Ac,th={add:function(a,b,c){return a[b]=this.value,{newDocument:c}},remove:function(a,b,c){var d=a[b];return delete a[b],{newDocument:c,removed:d}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:function(a,b,c){var d=Al(c,this.path);d&&(d=Ac(d));var e=Xf(c,{op:"remove",path:this.from}).removed;return Xf(c,{op:"add",path:this.path,value:e}),{newDocument:c,removed:d}},copy:function(a,b,c){var d=Al(c,this.from);return Xf(c,{op:"add",path:this.path,value:Ac(d)}),{newDocument:c}},test:function(a,b,c){return{newDocument:c,test:Pi(a[b],this.value)}},_get:function(a,b,c){return this.value=a[b],{newDocument:c}}},QP={add:function(a,b,c){return Fq(b)?a.splice(b,0,this.value):a[b]=this.value,{newDocument:c,index:b}},remove:function(a,b,c){var d=a.splice(b,1);return{newDocument:c,removed:d[0]}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:th.move,copy:th.copy,test:th.test,_get:th._get};function Al(a,b){if(b=="")return a;var c={op:"_get",path:b};return Xf(a,c),c.value}function Xf(a,b,c,d,e,f){c===void 0&&(c=!1),d===void 0&&(d=!0),e===void 0&&(e=!0),f===void 0&&(f=0),c&&(typeof c=="function"?c(b,0,a,b.path):Cl(b,0));if(b.path===""){var g={newDocument:a};if(b.op==="add")return g.newDocument=b.value,g;{if(b.op==="replace")return g.newDocument=b.value,g.removed=a,g;{if(b.op==="move"||b.op==="copy")return g.newDocument=Al(a,b.from),b.op==="move"&&(g.removed=a),g;if(b.op==="test"){g.test=Pi(a,b.value);if(g.test===!1)throw new Ya("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return g.newDocument=a,g}else{if(b.op==="remove")return g.removed=a,g.newDocument=null,g;{if(b.op==="_get")return b.value=a,g;{if(c)throw new Ya("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,b,a);return g}}}}}}else{d||(a=Ac(a));var h=b.path||"",i=h.split("/"),j=a,k=1,l=i.length,m=void 0,n=void 0,o=void 0;for(typeof c=="function"?o=c:o=Cl;;){n=i[k];if(e&&n=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");c&&(m===void 0&&(j[n]===void 0?m=i.slice(0,k).join("/"):k==l-1&&(m=b.path),m!==void 0&&o(b,0,a,m))),k++;if(Array.isArray(j)){if(n==="-")n=j.length;else{if(c&&!Fq(n))throw new Ya("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,b,a);Fq(n)&&(n=~~n)}if(k>=l){if(c&&b.op==="add"&&n>j.length)throw new Ya("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,b,a);var g=QP[b.op].call(b,j,n,a);if(g.test===!1)throw new Ya("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return g}}else{n&&n.indexOf("~")!=-1&&(n=nz(n));if(k>=l){var g=th[b.op].call(b,j,n,a);if(g.test===!1)throw new Ya("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return g}}j=j[n]}}}function Bl(a,b,c,d,e){d===void 0&&(d=!0),e===void 0&&(e=!0);if(c){if(!Array.isArray(b))throw new Ya("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}d||(a=Ac(a));for(var f=new Array(b.length),g=0,h=b.length;g<h;g++)f[g]=Xf(a,b[g],c,!0,e,g),a=f[g].newDocument;return f.newDocument=a,f}function RP(a,b,c){var d=Xf(a,b);if(d.test===!1)throw new Ya("Test operation failed","TEST_OPERATION_FAILED",c,b,a);return d.newDocument}function Cl(a,b,c,d){if(typeof a!=="object"||a===null||Array.isArray(a))throw new Ya("Operation is not an object","OPERATION_NOT_AN_OBJECT",b,a,c);if(th[a.op]){if(typeof a.path!=="string")throw new Ya("Operation `path` property is not a string","OPERATION_PATH_INVALID",b,a,c);{if(a.path.indexOf("/")!==0&&a.path.length>0)throw new Ya('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",b,a,c);{if((a.op==="move"||a.op==="copy")&&typeof a.from!=="string")throw new Ya("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",b,a,c);{if((a.op==="add"||a.op==="replace"||a.op==="test")&&a.value===void 0)throw new Ya("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",b,a,c);{if((a.op==="add"||a.op==="replace"||a.op==="test")&&Gq(a.value))throw new Ya("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",b,a,c);if(c){if(a.op=="add"){var e=a.path.split("/").length,f=d.split("/").length;if(e!==f+1&&e!==f)throw new Ya("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",b,a,c)}else if(a.op==="replace"||a.op==="remove"||a.op==="_get"){if(a.path!==d)throw new Ya("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",b,a,c)}else if(a.op==="move"||a.op==="copy"){var g={op:"_get",path:a.from,value:void 0},h=qz([g],c);if(h&&h.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ya("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",b,a,c)}}}}}}}else throw new Ya("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",b,a,c)}function qz(a,b,c){try{if(!Array.isArray(a))throw new Ya("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(b)Bl(Ac(b),Ac(a),c||!0);else{c=c||Cl;for(var d=0;d<a.length;d++)c(a[d],d,b,void 0)}}catch(e){if(e instanceof Ya)return e;throw e}}function Pi(a,b){if(a===b)return!0;if(a&&b&&typeof a=="object"&&typeof b=="object"){var c=Array.isArray(a),d=Array.isArray(b),e,f,g;if(c&&d){f=a.length;if(f!=b.length)return!1;for(e=f;e--!==0;)if(!Pi(a[e],b[e]))return!1;return!0}if(c!=d)return!1;var h=Object.keys(a);f=h.length;if(f!==Object.keys(b).length)return!1;for(e=f;e--!==0;)if(!b.hasOwnProperty(h[e]))return!1;for(e=f;e--!==0;){g=h[e];if(!Pi(a[g],b[g]))return!1}return!0}return a!==a&&b!==b}var SP=Object.freeze({__proto__:null,JsonPatchError:Ya,deepClone:PP,getValueByPointer:Al,applyOperation:Xf,applyPatch:Bl,applyReducer:RP,validator:Cl,validate:qz,_areEquals:Pi});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Hq=new WeakMap(),TP=function(){function a(b){this.observers=new Map(),this.obj=b}return a}(),UP=function(){function a(b,c){this.callback=b,this.observer=c}return a}();function VP(a){return Hq.get(a)}function WP(a,b){return a.observers.get(b)}function XP(a,b){a.observers.delete(b.callback)}function YP(a,b){b.unobserve()}function ZP(a,b){var c=[],d,e=VP(a);if(!e)e=new TP(a),Hq.set(a,e);else{var f=WP(e,b);d=f&&f.observer}if(d)return d;d={},e.value=Ac(a);if(b){d.callback=b,d.next=null;var g=function(){Iq(d)},h=function(){clearTimeout(d.next),d.next=setTimeout(g)};typeof window!=="undefined"&&(window.addEventListener("mouseup",h),window.addEventListener("keyup",h),window.addEventListener("mousedown",h),window.addEventListener("keydown",h),window.addEventListener("change",h))}return d.patches=c,d.object=a,d.unobserve=function(){Iq(d),clearTimeout(d.next),XP(e,d),typeof window!=="undefined"&&(window.removeEventListener("mouseup",h),window.removeEventListener("keyup",h),window.removeEventListener("mousedown",h),window.removeEventListener("keydown",h),window.removeEventListener("change",h))},e.observers.set(b,new UP(b,d)),d}function Iq(a,b){b===void 0&&(b=!1);var c=Hq.get(a.object);Jq(c.value,a.object,a.patches,"",b),a.patches.length&&Bl(c.value,a.patches);var d=a.patches;return d.length>0&&(a.patches=[],a.callback&&a.callback(d)),d}function Jq(a,b,c,d,e){if(b===a)return;typeof b.toJSON==="function"&&(b=b.toJSON());for(var f=Eq(b),g=Eq(a),h=!1,i=g.length-1;i>=0;i--){var j=g[i],k=a[j];if(Dq(b,j)&&!(b[j]===void 0&&k!==void 0&&Array.isArray(b)===!1)){var l=b[j];typeof k=="object"&&k!=null&&typeof l=="object"&&l!=null?Jq(k,l,c,d+"/"+Wf(j),e):k!==l&&(e&&c.push({op:"test",path:d+"/"+Wf(j),value:Ac(k)}),c.push({op:"replace",path:d+"/"+Wf(j),value:Ac(l)}))}else Array.isArray(a)===Array.isArray(b)?(e&&c.push({op:"test",path:d+"/"+Wf(j),value:Ac(k)}),c.push({op:"remove",path:d+"/"+Wf(j)}),h=!0):(e&&c.push({op:"test",path:d,value:a}),c.push({op:"replace",path:d,value:b}))}if(!h&&f.length==g.length)return;for(var i=0;i<f.length;i++){var j=f[i];!Dq(a,j)&&b[j]!==void 0&&c.push({op:"add",path:d+"/"+Wf(j),value:Ac(b[j])})}}function _P(a,b,c){c===void 0&&(c=!1);var d=[];return Jq(a,b,d,"",c),d}var $P=Object.freeze({__proto__:null,unobserve:YP,observe:ZP,generate:Iq,compare:_P});Object.assign({},SP,$P,{JsonPatchError:pz,deepClone:Ac,escapePathComponent:Wf,unescapePathComponent:nz});var aQ=/("(?:[^\\"]|\\.)*")|[:,]/g,Kq=function a(b,c){var d,e,f;return c=c||{},d=JSON.stringify([1],void 0,c.indent===void 0?2:c.indent).slice(2,-3),e=d===""?Infinity:c.maxLength===void 0?80:c.maxLength,f=c.replacer,function g(h,i,j){var k,l,m,n,o,p,q,r,s,t,w,v;h&&typeof h.toJSON==="function"&&(h=h.toJSON()),w=JSON.stringify(h,f);if(w===void 0)return w;q=e-i.length-j;if(w.length<=q){s=w.replace(aQ,function(x,u){return u||x+" "});if(s.length<=q)return s}f!=null&&(h=JSON.parse(w),f=void 0);if(typeof h==="object"&&h!==null){r=i+d,m=[],l=0;if(Array.isArray(h))for(t="[",k="]",q=h.length;l<q;l++)m.push(g(h[l],r,l===q-1?0:1)||"null");else for(t="{",k="}",p=Object.keys(h),q=p.length;l<q;l++)n=p[l],o=JSON.stringify(n)+": ",v=g(h[n],r,o.length+(l===q-1?0:1)),v!==void 0&&m.push(o+v);if(m.length>0)return[t,d+m.join(`,
`+r),k].join(`
`+i)}return w}(b,"",0)};const bQ="2.0.0",cQ=256,dQ=Number.MAX_SAFE_INTEGER||9007199254740991,eQ=16;var Dl={SEMVER_SPEC_VERSION:bQ,MAX_LENGTH:cQ,MAX_SAFE_INTEGER:dQ,MAX_SAFE_COMPONENT_LENGTH:eQ};const fQ=()=>{};var El=fQ,We=Cq(function(a,b){const{MAX_SAFE_COMPONENT_LENGTH:c}=Dl;b=a.exports={};const d=b.re=[],e=b.src=[],f=b.t={};let g=0;const h=(i,j,k)=>{const l=g++;f[i]=l,e[l]=j,d[l]=new RegExp(j,k?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${e[f.NUMERICIDENTIFIER]})\\.(${e[f.NUMERICIDENTIFIER]})\\.(${e[f.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${e[f.NUMERICIDENTIFIERLOOSE]})\\.(${e[f.NUMERICIDENTIFIERLOOSE]})\\.(${e[f.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${e[f.NUMERICIDENTIFIER]}|${e[f.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${e[f.NUMERICIDENTIFIERLOOSE]}|${e[f.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${e[f.PRERELEASEIDENTIFIER]}(?:\\.${e[f.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${e[f.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${e[f.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${e[f.BUILDIDENTIFIER]}(?:\\.${e[f.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${e[f.MAINVERSION]}${e[f.PRERELEASE]}?${e[f.BUILD]}?`),h("FULL",`^${e[f.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${e[f.MAINVERSIONLOOSE]}${e[f.PRERELEASELOOSE]}?${e[f.BUILD]}?`),h("LOOSE",`^${e[f.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${e[f.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${e[f.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${e[f.XRANGEIDENTIFIER]})(?:\\.(${e[f.XRANGEIDENTIFIER]})(?:\\.(${e[f.XRANGEIDENTIFIER]})(?:${e[f.PRERELEASE]})?${e[f.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${e[f.XRANGEIDENTIFIERLOOSE]})(?:\\.(${e[f.XRANGEIDENTIFIERLOOSE]})(?:\\.(${e[f.XRANGEIDENTIFIERLOOSE]})(?:${e[f.PRERELEASELOOSE]})?${e[f.BUILD]}?)?)?`),h("XRANGE",`^${e[f.GTLT]}\\s*${e[f.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${e[f.GTLT]}\\s*${e[f.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${c}})(?:\\.(\\d{1,${c}}))?(?:\\.(\\d{1,${c}}))?(?:$|[^\\d])`),h("COERCERTL",e[f.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${e[f.LONETILDE]}\\s+`,!0),b.tildeTrimReplace="$1~",h("TILDE",`^${e[f.LONETILDE]}${e[f.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${e[f.LONETILDE]}${e[f.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${e[f.LONECARET]}\\s+`,!0),b.caretTrimReplace="$1^",h("CARET",`^${e[f.LONECARET]}${e[f.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${e[f.LONECARET]}${e[f.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${e[f.GTLT]}\\s*(${e[f.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${e[f.GTLT]}\\s*(${e[f.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${e[f.GTLT]}\\s*(${e[f.LOOSEPLAIN]}|${e[f.XRANGEPLAIN]})`,!0),b.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${e[f.XRANGEPLAIN]})\\s+-\\s+(${e[f.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${e[f.XRANGEPLAINLOOSE]})\\s+-\\s+(${e[f.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0.0.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});const rz=/^[0-9]+$/,sz=(a,b)=>{const c=rz.test(a),d=rz.test(b);return c&&d&&(a=+a,b=+b),a===b?0:c&&!d?-1:d&&!c?1:a<b?-1:1},gQ=(a,b)=>sz(b,a);var Lq={compareIdentifiers:sz,rcompareIdentifiers:gQ};const{MAX_LENGTH:tz,MAX_SAFE_INTEGER:Fl}=Dl,{re:uz,t:vz}=We,{compareIdentifiers:Qi}=Lq;class Ed{constructor(a,b){(!b||typeof b!=="object")&&(b={loose:!!b,includePrerelease:!1});if(a instanceof Ed){if(a.loose===!!b.loose&&a.includePrerelease===!!b.includePrerelease)return a;a=a.version}else if(typeof a!=="string")throw new TypeError(`Invalid Version: ${a}`);if(a.length>tz)throw new TypeError(`version is longer than ${tz} characters`);this.options=b,this.loose=!!b.loose,this.includePrerelease=!!b.includePrerelease;const c=a.trim().match(b.loose?uz[vz.LOOSE]:uz[vz.FULL]);if(!c)throw new TypeError(`Invalid Version: ${a}`);this.raw=a,this.major=+c[1],this.minor=+c[2],this.patch=+c[3];if(this.major>Fl||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Fl||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Fl||this.patch<0)throw new TypeError("Invalid patch version");c[4]?this.prerelease=c[4].split(".").map(d=>{if(/^[0-9]+$/.test(d)){const e=+d;if(e>=0&&e<Fl)return e}return d}):this.prerelease=[],this.build=c[5]?c[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(a){El("SemVer.compare",this.version,this.options);if(!(a instanceof Ed)){if(typeof a==="string"&&a===this.version)return 0;a=new Ed(a,this.options)}return a.version===this.version?0:this.compareMain(a)||this.comparePre(a)}compareMain(a){return a instanceof Ed||(a=new Ed(a,this.options)),Qi(this.major,a.major)||Qi(this.minor,a.minor)||Qi(this.patch,a.patch)}comparePre(a){a instanceof Ed||(a=new Ed(a,this.options));if(this.prerelease.length&&!a.prerelease.length)return-1;{if(!this.prerelease.length&&a.prerelease.length)return 1;if(!this.prerelease.length&&!a.prerelease.length)return 0}let b=0;do{const c=this.prerelease[b],d=a.prerelease[b];if(c===void 0&&d===void 0)return 0;{if(d===void 0)return 1;{if(c===void 0)return-1;{if(c===d)continue;return Qi(c,d)}}}}while(++b)}compareBuild(a){a instanceof Ed||(a=new Ed(a,this.options));let b=0;do{const c=this.build[b],d=a.build[b];if(c===void 0&&d===void 0)return 0;{if(d===void 0)return 1;{if(c===void 0)return-1;{if(c===d)continue;return Qi(c,d)}}}}while(++b)}inc(a,b){switch(a){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",b);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",b);break;case"prepatch":this.prerelease.length=0,this.inc("patch",b),this.inc("pre",b);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",b),this.inc("pre",b);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let c=this.prerelease.length;for(;--c>=0;)typeof this.prerelease[c]==="number"&&(this.prerelease[c]++,c=-2);c===-1&&this.prerelease.push(0)}b&&(this.prerelease[0]===b?isNaN(this.prerelease[1])&&(this.prerelease=[b,0]):this.prerelease=[b,0]);break;default:throw new Error(`invalid increment argument: ${a}`)}return this.format(),this.raw=this.version,this}}var Za=Ed;const{MAX_LENGTH:hQ}=Dl,{re:wz,t:xz}=We,iQ=(a,b)=>{(!b||typeof b!=="object")&&(b={loose:!!b,includePrerelease:!1});if(a instanceof Za)return a;if(typeof a!=="string")return null;if(a.length>hQ)return null;const c=b.loose?wz[xz.LOOSE]:wz[xz.FULL];if(!c.test(a))return null;try{return new Za(a,b)}catch(d){return null}};var Yf=iQ;const jQ=(a,b)=>{const c=Yf(a,b);return c?c.version:null};var kQ=jQ;const lQ=(a,b)=>{const c=Yf(a.trim().replace(/^[=v]+/,""),b);return c?c.version:null};var mQ=lQ;const nQ=(a,b,c,d)=>{typeof c==="string"&&(d=c,c=void 0);try{return new Za(a,c).inc(b,d).version}catch(e){return null}};var oQ=nQ;const pQ=(a,b,c)=>new Za(a,c).compare(new Za(b,c));var Bc=pQ;const qQ=(a,b,c)=>Bc(a,b,c)===0;var Mq=qQ;const rQ=(a,b)=>{if(Mq(a,b))return null;{const c=Yf(a),d=Yf(b),e=c.prerelease.length||d.prerelease.length,f=e?"pre":"",g=e?"prerelease":"";for(const h in c)if(h==="major"||h==="minor"||h==="patch"){if(c[h]!==d[h])return f+h}return g}};var sQ=rQ;const tQ=(a,b)=>new Za(a,b).major;var uQ=tQ;const vQ=(a,b)=>new Za(a,b).minor;var wQ=vQ;const xQ=(a,b)=>new Za(a,b).patch;var yQ=xQ;const zQ=(a,b)=>{const c=Yf(a,b);return c&&c.prerelease.length?c.prerelease:null};var AQ=zQ;const BQ=(a,b,c)=>Bc(b,a,c);var CQ=BQ;const DQ=(a,b)=>Bc(a,b,!0);var EQ=DQ;const FQ=(a,b,c)=>{const d=new Za(a,c),e=new Za(b,c);return d.compare(e)||d.compareBuild(e)};var Nq=FQ;const GQ=(a,b)=>a.sort((c,d)=>Nq(c,d,b));var HQ=GQ;const IQ=(a,b)=>a.sort((c,d)=>Nq(d,c,b));var JQ=IQ;const KQ=(a,b,c)=>Bc(a,b,c)>0;var Ri=KQ;const LQ=(a,b,c)=>Bc(a,b,c)<0;var Gl=LQ;const MQ=(a,b,c)=>Bc(a,b,c)!==0;var yz=MQ;const NQ=(a,b,c)=>Bc(a,b,c)>=0;var Oq=NQ;const OQ=(a,b,c)=>Bc(a,b,c)<=0;var Pq=OQ;const PQ=(a,b,c,d)=>{switch(b){case"===":return typeof a==="object"&&(a=a.version),typeof c==="object"&&(c=c.version),a===c;case"!==":return typeof a==="object"&&(a=a.version),typeof c==="object"&&(c=c.version),a!==c;case"":case"=":case"==":return Mq(a,c,d);case"!=":return yz(a,c,d);case">":return Ri(a,c,d);case">=":return Oq(a,c,d);case"<":return Gl(a,c,d);case"<=":return Pq(a,c,d);default:throw new TypeError(`Invalid operator: ${b}`)}};var Hl=PQ;const{re:Il,t:Jl}=We,QQ=(a,b)=>{if(a instanceof Za)return a;typeof a==="number"&&(a=String(a));if(typeof a!=="string")return null;b=b||{};let c=null;if(!b.rtl)c=a.match(Il[Jl.COERCE]);else{let d;for(;(d=Il[Jl.COERCERTL].exec(a))&&(!c||c.index+c[0].length!==a.length);)(!c||d.index+d[0].length!==c.index+c[0].length)&&(c=d),Il[Jl.COERCERTL].lastIndex=d.index+d[1].length+d[2].length;Il[Jl.COERCERTL].lastIndex=-1}return c===null?null:Yf(`${c[2]}.${c[3]||"0"}.${c[4]||"0"}`,b)};var RQ=QQ;class Kl{constructor(a,b){(!b||typeof b!=="object")&&(b={loose:!!b,includePrerelease:!1});if(a instanceof Kl)return a.loose===!!b.loose&&a.includePrerelease===!!b.includePrerelease?a:new Kl(a.raw,b);if(a instanceof Zf)return this.raw=a.value,this.set=[[a]],this.format(),this;this.options=b,this.loose=!!b.loose,this.includePrerelease=!!b.includePrerelease,this.raw=a,this.set=a.split(/\s*\|\|\s*/).map(c=>this.parseRange(c.trim())).filter(c=>c.length);if(!this.set.length)throw new TypeError(`Invalid SemVer Range: ${a}`);this.format()}format(){return this.range=this.set.map(a=>a.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(a){const b=this.options.loose;a=a.trim();const c=b?Fb[vb.HYPHENRANGELOOSE]:Fb[vb.HYPHENRANGE];a=a.replace(c,cR(this.options.includePrerelease)),a=a.replace(Fb[vb.COMPARATORTRIM],SQ),El("comparator trim",a,Fb[vb.COMPARATORTRIM]),a=a.replace(Fb[vb.TILDETRIM],TQ),a=a.replace(Fb[vb.CARETTRIM],UQ),a=a.split(/\s+/).join(" ");const d=b?Fb[vb.COMPARATORLOOSE]:Fb[vb.COMPARATOR];return a.split(" ").map(e=>VQ(e,this.options)).join(" ").split(/\s+/).map(e=>bR(e,this.options)).filter(this.options.loose?e=>!!e.match(d):()=>!0).map(e=>new Zf(e,this.options))}intersects(a,b){if(!(a instanceof Kl))throw new TypeError("a Range is required");return this.set.some(c=>zz(c,b)&&a.set.some(d=>zz(d,b)&&c.every(e=>d.every(f=>e.intersects(f,b)))))}test(a){if(!a)return!1;if(typeof a==="string")try{a=new Za(a,this.options)}catch(b){return!1}for(let b=0;b<this.set.length;b++)if(dR(this.set[b],a,this.options))return!0;return!1}}var hc=Kl;const{re:Fb,t:vb,comparatorTrimReplace:SQ,tildeTrimReplace:TQ,caretTrimReplace:UQ}=We,zz=(a,b)=>{let c=!0;const d=a.slice();let e=d.pop();for(;c&&d.length;)c=d.every(f=>e.intersects(f,b)),e=d.pop();return c},VQ=(a,b)=>(a=YQ(a,b),a=WQ(a,b),a=_Q(a,b),a=aR(a),a),Sb=a=>!a||a.toLowerCase()==="x"||a==="*",WQ=(a,b)=>a.trim().split(/\s+/).map(c=>XQ(c,b)).join(" "),XQ=(a,b)=>{const c=b.loose?Fb[vb.TILDELOOSE]:Fb[vb.TILDE];return a.replace(c,(d,e,f,g,h)=>{let i;return Sb(e)?i="":Sb(f)?i=`>=${e}.0.0 <${+e+1}.0.0-0`:Sb(g)?i=`>=${e}.${f}.0 <${e}.${+f+1}.0-0`:h?i=`>=${e}.${f}.${g}-${h} <${e}.${+f+1}.0-0`:i=`>=${e}.${f}.${g} <${e}.${+f+1}.0-0`,i})},YQ=(a,b)=>a.trim().split(/\s+/).map(c=>ZQ(c,b)).join(" "),ZQ=(a,b)=>{const c=b.loose?Fb[vb.CARETLOOSE]:Fb[vb.CARET],d=b.includePrerelease?"-0":"";return a.replace(c,(e,f,g,h,i)=>{let j;return Sb(f)?j="":Sb(g)?j=`>=${f}.0.0${d} <${+f+1}.0.0-0`:Sb(h)?f==="0"?j=`>=${f}.${g}.0${d} <${f}.${+g+1}.0-0`:j=`>=${f}.${g}.0${d} <${+f+1}.0.0-0`:i?f==="0"?g==="0"?j=`>=${f}.${g}.${h}-${i} <${f}.${g}.${+h+1}-0`:j=`>=${f}.${g}.${h}-${i} <${f}.${+g+1}.0-0`:j=`>=${f}.${g}.${h}-${i} <${+f+1}.0.0-0`:f==="0"?g==="0"?j=`>=${f}.${g}.${h}${d} <${f}.${g}.${+h+1}-0`:j=`>=${f}.${g}.${h}${d} <${f}.${+g+1}.0-0`:j=`>=${f}.${g}.${h} <${+f+1}.0.0-0`,j})},_Q=(a,b)=>a.split(/\s+/).map(c=>$Q(c,b)).join(" "),$Q=(a,b)=>{a=a.trim();const c=b.loose?Fb[vb.XRANGELOOSE]:Fb[vb.XRANGE];return a.replace(c,(d,e,f,g,h,i)=>{const j=Sb(f),k=j||Sb(g),l=k||Sb(h),m=l;return e==="="&&m&&(e=""),i=b.includePrerelease?"-0":"",j?e===">"||e==="<"?d="<0.0.0-0":d="*":e&&m?(k&&(g=0),h=0,e===">"?(e=">=",k?(f=+f+1,g=0,h=0):(g=+g+1,h=0)):e==="<="&&(e="<",k?f=+f+1:g=+g+1),e==="<"&&(i="-0"),d=`${e+f}.${g}.${h}${i}`):k?d=`>=${f}.0.0${i} <${+f+1}.0.0-0`:l&&(d=`>=${f}.${g}.0${i} <${f}.${+g+1}.0-0`),d})},aR=(a,b)=>a.trim().replace(Fb[vb.STAR],""),bR=(a,b)=>a.trim().replace(Fb[b.includePrerelease?vb.GTE0PRE:vb.GTE0],""),cR=a=>(b,c,d,e,f,g,h,i,j,k,l,m,n)=>(Sb(d)?c="":Sb(e)?c=`>=${d}.0.0${a?"-0":""}`:Sb(f)?c=`>=${d}.${e}.0${a?"-0":""}`:g?c=`>=${c}`:c=`>=${c}${a?"-0":""}`,Sb(j)?i="":Sb(k)?i=`<${+j+1}.0.0-0`:Sb(l)?i=`<${j}.${+k+1}.0-0`:m?i=`<=${j}.${k}.${l}-${m}`:a?i=`<${j}.${k}.${+l+1}-0`:i=`<=${i}`,`${c} ${i}`.trim()),dR=(a,b,c)=>{for(let d=0;d<a.length;d++)if(!a[d].test(b))return!1;if(b.prerelease.length&&!c.includePrerelease){for(let d=0;d<a.length;d++){El(a[d].semver);if(a[d].semver===Zf.ANY)continue;if(a[d].semver.prerelease.length>0){const e=a[d].semver;if(e.major===b.major&&e.minor===b.minor&&e.patch===b.patch)return!0}}return!1}return!0},Si=Symbol("SemVer ANY");class Qq{static get ANY(){return Si}constructor(a,b){(!b||typeof b!=="object")&&(b={loose:!!b,includePrerelease:!1});if(a instanceof Qq){if(a.loose===!!b.loose)return a;a=a.value}this.options=b,this.loose=!!b.loose,this.parse(a),this.semver===Si?this.value="":this.value=this.operator+this.semver.version}parse(a){const b=this.options.loose?Az[Bz.COMPARATORLOOSE]:Az[Bz.COMPARATOR],c=a.match(b);if(!c)throw new TypeError(`Invalid comparator: ${a}`);this.operator=c[1]!==void 0?c[1]:"",this.operator==="="&&(this.operator=""),c[2]?this.semver=new Za(c[2],this.options.loose):this.semver=Si}toString(){return this.value}test(a){El("Comparator.test",a,this.options.loose);if(this.semver===Si||a===Si)return!0;if(typeof a==="string")try{a=new Za(a,this.options)}catch(b){return!1}return Hl(a,this.operator,this.semver,this.options)}intersects(a,b){if(!(a instanceof Qq))throw new TypeError("a Comparator is required");(!b||typeof b!=="object")&&(b={loose:!!b,includePrerelease:!1});if(this.operator==="")return this.value===""?!0:new hc(a.value,b).test(this.value);if(a.operator==="")return a.value===""?!0:new hc(this.value,b).test(a.semver);const c=(this.operator===">="||this.operator===">")&&(a.operator===">="||a.operator===">"),d=(this.operator==="<="||this.operator==="<")&&(a.operator==="<="||a.operator==="<"),e=this.semver.version===a.semver.version,f=(this.operator===">="||this.operator==="<=")&&(a.operator===">="||a.operator==="<="),g=Hl(this.semver,"<",a.semver,b)&&(this.operator===">="||this.operator===">")&&(a.operator==="<="||a.operator==="<"),h=Hl(this.semver,">",a.semver,b)&&(this.operator==="<="||this.operator==="<")&&(a.operator===">="||a.operator===">");return c||d||e&&f||g||h}}var Zf=Qq;const{re:Az,t:Bz}=We,eR=(a,b,c)=>{try{b=new hc(b,c)}catch(d){return!1}return b.test(a)};var Xe=eR;const fR=(a,b)=>new hc(a,b).set.map(c=>c.map(d=>d.value).join(" ").trim().split(" "));var gR=fR;const hR=(a,b,c)=>{let d=null,e=null,f=null;try{f=new hc(b,c)}catch(g){return null}return a.forEach(g=>{f.test(g)&&((!d||e.compare(g)===-1)&&(d=g,e=new Za(d,c)))}),d};var iR=hR;const jR=(a,b,c)=>{let d=null,e=null,f=null;try{f=new hc(b,c)}catch(g){return null}return a.forEach(g=>{f.test(g)&&((!d||e.compare(g)===1)&&(d=g,e=new Za(d,c)))}),d};var kR=jR;const lR=(a,b)=>{a=new hc(a,b);let c=new Za("0.0.0");if(a.test(c))return c;c=new Za("0.0.0-0");if(a.test(c))return c;c=null;for(let d=0;d<a.set.length;++d){const e=a.set[d];e.forEach(f=>{const g=new Za(f.semver.version);switch(f.operator){case">":g.prerelease.length===0?g.patch++:g.prerelease.push(0),g.raw=g.format();case"":case">=":(!c||Ri(c,g))&&(c=g);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${f.operator}`)}})}return c&&a.test(c)?c:null};var mR=lR;const nR=(a,b)=>{try{return new hc(a,b).range||"*"}catch(c){return null}};var oR=nR;const{ANY:pR}=Zf,qR=(a,b,c,d)=>{a=new Za(a,d),b=new hc(b,d);let e,f,g,h,i;switch(c){case">":e=Ri,f=Pq,g=Gl,h=">",i=">=";break;case"<":e=Gl,f=Oq,g=Ri,h="<",i="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Xe(a,b,d))return!1;for(let j=0;j<b.set.length;++j){const k=b.set[j];let l=null,m=null;k.forEach(n=>{n.semver===pR&&(n=new Zf(">=0.0.0")),l=l||n,m=m||n,e(n.semver,l.semver,d)?l=n:g(n.semver,m.semver,d)&&(m=n)});if(l.operator===h||l.operator===i)return!1;if((!m.operator||m.operator===h)&&f(a,m.semver))return!1;if(m.operator===i&&g(a,m.semver))return!1}return!0};var Rq=qR;const rR=(a,b,c)=>Rq(a,b,">",c);var sR=rR;const tR=(a,b,c)=>Rq(a,b,"<",c);var uR=tR;const vR=(a,b,c)=>(a=new hc(a,c),b=new hc(b,c),a.intersects(b));var wR=vR,xR=(a,b,c)=>{const d=[];let e=null,f=null;const g=a.sort((k,l)=>Bc(k,l,c));for(const k of g){const l=Xe(k,b,c);l?(f=k,e||(e=k)):(f&&d.push([e,f]),f=null,e=null)}e&&d.push([e,null]);const h=[];for(const[k,l]of d)k===l?h.push(k):!l&&k===g[0]?h.push("*"):l?k===g[0]?h.push(`<=${l}`):h.push(`${k} - ${l}`):h.push(`>=${k}`);const i=h.join(" || "),j=typeof b.raw==="string"?b.raw:String(b);return i.length<j.length?i:b};const{ANY:Cz}=Zf,yR=(a,b,c)=>{a=new hc(a,c),b=new hc(b,c);let d=!1;Ve:for(const e of a.set){for(const f of b.set){const g=zR(e,f,c);d=d||g!==null;if(g)continue Ve}if(d)return!1}return!0},zR=(a,b,c)=>{if(a.length===1&&a[0].semver===Cz)return b.length===1&&b[0].semver===Cz;const d=new Set();let e,f;for(const l of a)l.operator===">"||l.operator===">="?e=Dz(e,l,c):l.operator==="<"||l.operator==="<="?f=Ez(f,l,c):d.add(l.semver);if(d.size>1)return null;let g;if(e&&f){g=Bc(e.semver,f.semver,c);if(g>0)return null;if(g===0&&(e.operator!==">="||f.operator!=="<="))return null}for(const l of d){if(e&&!Xe(l,String(e),c))return null;if(f&&!Xe(l,String(f),c))return null;for(const m of b)if(!Xe(l,String(m),c))return!1;return!0}let h,i,j,k;for(const l of b){k=k||l.operator===">"||l.operator===">=",j=j||l.operator==="<"||l.operator==="<=";if(e){if(l.operator===">"||l.operator===">="){h=Dz(e,l,c);if(h===l)return!1}else if(e.operator===">="&&!Xe(e.semver,String(l),c))return!1}if(f){if(l.operator==="<"||l.operator==="<="){i=Ez(f,l,c);if(i===l)return!1}else if(f.operator==="<="&&!Xe(f.semver,String(l),c))return!1}if(!l.operator&&(f||e)&&g!==0)return!1}return e&&j&&!f&&g!==0?!1:f&&k&&!e&&g!==0?!1:!0},Dz=(a,b,c)=>{if(!a)return b;const d=Bc(a.semver,b.semver,c);return d>0?a:d<0?b:b.operator===">"&&a.operator===">="?b:a},Ez=(a,b,c)=>{if(!a)return b;const d=Bc(a.semver,b.semver,c);return d<0?a:d>0?b:b.operator==="<"&&a.operator==="<="?b:a};var AR=yR,Fz={re:We.re,src:We.src,tokens:We.t,SEMVER_SPEC_VERSION:Dl.SEMVER_SPEC_VERSION,SemVer:Za,compareIdentifiers:Lq.compareIdentifiers,rcompareIdentifiers:Lq.rcompareIdentifiers,parse:Yf,valid:kQ,clean:mQ,inc:oQ,diff:sQ,major:uQ,minor:wQ,patch:yQ,prerelease:AQ,compare:Bc,rcompare:CQ,compareLoose:EQ,compareBuild:Nq,sort:HQ,rsort:JQ,gt:Ri,lt:Gl,eq:Mq,neq:yz,gte:Oq,lte:Pq,cmp:Hl,coerce:RQ,Comparator:Zf,Range:hc,satisfies:Xe,toComparators:gR,maxSatisfying:iR,minSatisfying:kR,minVersion:mR,validRange:oR,outside:Rq,gtr:sR,ltr:uR,intersects:wR,simplifyRange:xR,subset:AR};function ne(a,b,c){return a.fields=b||[],a.fname=c,a}function BR(a){return a==null?null:a.fname}function Gz(a){return a==null?null:a.fields}function Hz(a){return a.length===1?CR(a[0]):DR(a)}const CR=a=>function(b){return b[a]},DR=a=>{const b=a.length;return function(c){for(let d=0;d<b;++d)c=c[a[d]];return c}};function Ll(a){throw Error(a)}function Sq(a){var b=[],c=null,d=0,e=a.length,f="",g,h,i;a=a+"";function j(){b.push(f+a.substring(g,h)),f="",g=h+1}for(g=h=0;h<e;++h){i=a[h];if(i==="\\")f+=a.substring(g,h),f+=a.substring(++h,++h),g=h;else if(i===c)j(),c=null,d=-1;else{if(c)continue;g===d&&i==='"'?(g=h+1,c=i):g===d&&i==="'"?(g=h+1,c=i):i==="."&&!d?h>g?j():g=h+1:i==="["?(h>g&&j(),d=g=h+1):i==="]"&&(d||Ll("Access path missing open bracket: "+a),d>0&&j(),d=0,g=h+1)}}return d&&Ll("Access path missing closing bracket: "+a),c&&Ll("Access path missing closing quote: "+a),h>g&&(h++,j()),b}function Tq(a,b,c){const d=Sq(a);return a=d.length===1?d[0]:a,ne((c&&c.get||Hz)(d),[a],b||a)}var Ti=[],ER=Tq("id"),Uq=ne(function(a){return a},Ti,"identity"),FR=ne(function(){return 0},Ti,"zero"),GR=ne(function(){return 1},Ti,"one"),HR=ne(function(){return!0},Ti,"true"),IR=ne(function(){return!1},Ti,"false");function Ml(a,b,c){var d=[b].concat([].slice.call(c));console[a].apply(console,d)}var Iz=0,Jz=1,Kz=2,Lz=3,Mz=4;function JR(a,b){var c=a||Iz;return{level:function(d){return arguments.length?(c=+d,this):c},error:function(){return c>=Jz&&Ml(b||"error","ERROR",arguments),this},warn:function(){return c>=Kz&&Ml(b||"warn","WARN",arguments),this},info:function(){return c>=Lz&&Ml(b||"log","INFO",arguments),this},debug:function(){return c>=Mz&&Ml(b||"log","DEBUG",arguments),this}}}var Nl=Array.isArray;function Ol(a){return a===Object(a)}const Nz=a=>a!=="__proto__";function KR(...a){return a.reduce((b,c)=>{for(var d in c)if(d==="signals")b.signals=LR(b.signals,c.signals);else{var e=d==="legend"?{layout:1}:d==="style"?!0:null;Pl(b,d,c[d],e)}return b},{})}function Pl(a,b,c,d){if(!Nz(b))return;var e,f;if(Ol(c)&&!Nl(c)){f=Ol(a[b])?a[b]:a[b]={};for(e in c)d&&(d===!0||d[e])?Pl(f,e,c[e]):Nz(e)&&(f[e]=c[e])}else a[b]=c}function LR(a,b){if(a==null)return b;const c={},d=[];function e(f){c[f.name]||(c[f.name]=1,d.push(f))}return b.forEach(e),a.forEach(e),d}function uh(a){return a[a.length-1]}function Vq(a){return a==null||a===""?null:+a}function Oz(a){return function(b){return a*Math.exp(b)}}function Pz(a){return function(b){return Math.log(a*b)}}function Qz(a){return function(b){return Math.sign(b)*Math.log1p(Math.abs(b/a))}}function Rz(a){return function(b){return Math.sign(b)*Math.expm1(Math.abs(b))*a}}function Ql(a){return function(b){return b<0?-Math.pow(-b,a):Math.pow(b,a)}}function Rl(a,b,c,d){var e=c(a[0]),f=c(uh(a)),g=(f-e)*b;return[d(e-g),d(f-g)]}function MR(a,b){return Rl(a,b,Vq,Uq)}function NR(a,b){var c=Math.sign(a[0]);return Rl(a,b,Pz(c),Oz(c))}function OR(a,b,c){return Rl(a,b,Ql(c),Ql(1/c))}function PR(a,b,c){return Rl(a,b,Qz(c),Rz(c))}function Sl(a,b,c,d,e){var f=d(a[0]),g=d(uh(a)),h=b!=null?d(b):(f+g)/2;return[e(h+(f-h)*c),e(h+(g-h)*c)]}function QR(a,b,c){return Sl(a,b,c,Vq,Uq)}function RR(a,b,c){var d=Math.sign(a[0]);return Sl(a,b,c,Pz(d),Oz(d))}function SR(a,b,c,d){return Sl(a,b,c,Ql(d),Ql(1/d))}function TR(a,b,c,d){return Sl(a,b,c,Qz(d),Rz(d))}function UR(a){return 1+~~(new Date(a).getMonth()/3)}function VR(a){return 1+~~(new Date(a).getUTCMonth()/3)}function Ui(a){return a!=null?Nl(a)?a:[a]:[]}function WR(a,b,c){var d=a[0],e=a[1],f;return e<d&&(f=e,e=d,d=f),f=e-d,f>=c-b?[b,c]:[d=Math.min(Math.max(d,b),c-f),d+f]}function Wq(a){return typeof a==="function"}const XR="descending";function YR(a,b,c){c=c||{},b=Ui(b)||[];const d=[],e=[],f={},g=c.comparator||ZR;return Ui(a).forEach((h,i)=>{if(h==null)return;d.push(b[i]===XR?-1:1),e.push(h=Wq(h)?h:Tq(h,null,c)),(Gz(h)||[]).forEach(j=>f[j]=1)}),e.length===0?null:ne(g(e,d),Object.keys(f))}const Sz=(a,b)=>(a<b||a==null)&&b!=null?-1:(a>b||b==null)&&a!=null?1:(b=b instanceof Date?+b:b,a=a instanceof Date?+a:a)!==a&&b===b?-1:b!==b&&a===a?1:0,ZR=(a,b)=>a.length===1?_R(a[0],b[0]):$R(a,b,a.length),_R=(a,b)=>function(c,d){return Sz(a(c),a(d))*b},$R=(a,b,c)=>(b.push(0),function(d,e){let f,g=0,h=-1;for(;g===0&&++h<c;)f=a[h],g=Sz(f(d),f(e));return g*b[h]});function aS(a){return Wq(a)?a:function(){return a}}function bS(a,b){var c,d;function e(){b(d),c=d=null}return function(f){d=f,c&&clearTimeout(c),c=setTimeout(e,a)}}function Tz(a){for(var b,c,d=1,e=arguments.length;d<e;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a}function cS(a,b){var c=0,d,e,f,g;if(a&&(d=a.length))if(b==null){for(e=a[c];c<d&&(e==null||e!==e);e=a[++c]);for(f=g=e;c<d;++c)e=a[c],e!=null&&(e<f&&(f=e),e>g&&(g=e))}else{for(e=b(a[c]);c<d&&(e==null||e!==e);e=b(a[++c]));for(f=g=e;c<d;++c)e=b(a[c]),e!=null&&(e<f&&(f=e),e>g&&(g=e))}return[f,g]}function dS(a,b){var c=-1,d=a.length,e,f,g,h,i;if(b==null){for(;++c<d;){f=a[c];if(f!=null&&f>=f){e=g=f;break}}if(c===d)return[-1,-1];for(h=i=c;++c<d;)f=a[c],f!=null&&(e>f&&(e=f,h=c),g<f&&(g=f,i=c))}else{for(;++c<d;){f=b(a[c],c,a);if(f!=null&&f>=f){e=g=f;break}}if(c===d)return[-1,-1];for(h=i=c;++c<d;)f=b(a[c],c,a),f!=null&&(e>f&&(e=f,h=c),g<f&&(g=f,i=c))}return[h,i]}const eS=Object.prototype.hasOwnProperty;function _f(a,b){return eS.call(a,b)}var Tl={};function fS(a){var b={},c,d;function e(f){return _f(b,f)&&b[f]!==Tl}return c={size:0,empty:0,object:b,has:e,get(f){return e(f)?b[f]:void 0},set(f,g){return e(f)||(++c.size,b[f]===Tl&&--c.empty),b[f]=g,this},delete(f){return e(f)&&(--c.size,++c.empty,b[f]=Tl),this},clear(){c.size=c.empty=0,c.object=b={}},test(f){return arguments.length?(d=f,c):d},clean(){var f={},g=0,h,i;for(h in b)i=b[h],i!==Tl&&(!d||!d(i))&&(f[h]=i,++g);c.size=g,c.empty=0,c.object=b=f}},a&&Object.keys(a).forEach(function(f){c.set(f,a[f])}),c}function gS(a,b,c,d,e,f){if(!c&&c!==0)return f;var g=a[0],h=uh(a),i=+c,j,k;return h<g&&(j=g,g=h,h=j),j=Math.abs(b-g),k=Math.abs(h-b),j<k&&j<=i?d:k<=i?e:f}function hS(a,b){var c=a.prototype=Object.create(b.prototype);return c.constructor=a,c}function iS(a,b,c,d){var e=b[0],f=b[b.length-1],g;return e>f&&(g=e,e=f,f=g),c=c===void 0||c,d=d===void 0||d,(c?e<=a:e<a)&&(d?a<=f:a<f)}function jS(a){return typeof a==="boolean"}function Uz(a){return Object.prototype.toString.call(a)==="[object Date]"}function Vz(a){return typeof a==="number"}function kS(a){return Object.prototype.toString.call(a)==="[object RegExp]"}function Wz(a){return typeof a==="string"}function lS(a,b,c){a&&(a=b?Ui(a).map(h=>h.replace(/\\(.)/g,"$1")):Ui(a));const d=a&&a.length,e=c&&c.get||Hz,f=h=>e(b?[h]:Sq(h));let g;if(!d)g=function(){return""};else if(d===1){const h=f(a[0]);g=function(i){return""+h(i)}}else{const h=a.map(f);g=function(i){let j=""+h[0](i),k=0;for(;++k<d;)j+="|"+h[k](i);return j}}return ne(g,a,"key")}function mS(a,b){const c=a[0],d=uh(a),e=+b;return e?e===1?d:c+e*(d-c):c}const nS=1e4;function oS(a){a=+a||nS;let b,c,d;const e=()=>{b={},c={},d=0},f=(g,h)=>(++d>a&&(c=b,b={},d=1),b[g]=h);return e(),{clear:e,has:g=>_f(b,g)||_f(c,g),get:g=>_f(b,g)?b[g]:_f(c,g)?f(g,c[g]):void 0,set:(g,h)=>_f(b,g)?b[g]=h:f(g,h)}}function pS(a,b,c,d){var e=b.length,f=c.length;if(!f)return b;if(!e)return c;for(var g=d||new b.constructor(e+f),h=0,i=0,j=0;h<e&&i<f;++j)g[j]=a(b[h],c[i])>0?c[i++]:b[h++];for(;h<e;++h,++j)g[j]=b[h];for(;i<f;++i,++j)g[j]=c[i];return g}function Vi(a,b){for(var c="";--b>=0;)c+=a;return c}function qS(a,b,c,d){var e=c||" ",f=a+"",g=b-f.length;return g<=0?f:d==="left"?Vi(e,g)+f:d==="center"?Vi(e,~~(g/2))+f+Vi(e,Math.ceil(g/2)):f+Vi(e,g)}function rS(a){return a&&uh(a)-a[0]||0}function Xz(a){return Nl(a)?"["+a.map(Xz)+"]":Ol(a)||Wz(a)?JSON.stringify(a).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):a}function sS(a){return a==null||a===""?null:!a||a==="false"||a==="0"?!1:!!a}function tS(a){return Vz(a)?a:Uz(a)?a:Date.parse(a)}function uS(a,b){return b=b||tS,a==null||a===""?null:b(a)}function vS(a){return a==null||a===""?null:a+""}function wS(a){for(var b={},c=0,d=a.length;c<d;++c)b[a[c]]=!0;return b}function xS(a,b,c,d){var e=d!=null?d:"…",f=a+"",g=f.length,h=Math.max(0,b-e.length);return g<=b?f:c==="left"?e+f.slice(g-h):c==="center"?f.slice(0,Math.ceil(h/2))+e+f.slice(g-~~(h/2)):f.slice(0,h)+e}function yS(a,b,c){if(a)if(b)for(var d=0,e=a.length,f;d<e;++d)(f=b(a[d]))&&c(f,d,a);else a.forEach(c)}function Cc(a,b,c){return a.fields=b||[],a.fname=c,a}function _a(a){return a==null?null:a.fname}function Tb(a){return a==null?null:a.fields}function Yz(a){return a.length===1?zS(a[0]):AS(a)}const zS=a=>function(b){return b[a]},AS=a=>{const b=a.length;return function(c){for(let d=0;d<b;++d)c=c[a[d]];return c}};function H(a){throw Error(a)}function oe(a){var b=[],c=null,d=0,e=a.length,f="",g,h,i;a=a+"";function j(){b.push(f+a.substring(g,h)),f="",g=h+1}for(g=h=0;h<e;++h){i=a[h];if(i==="\\")f+=a.substring(g,h),f+=a.substring(++h,++h),g=h;else if(i===c)j(),c=null,d=-1;else{if(c)continue;g===d&&i==='"'?(g=h+1,c=i):g===d&&i==="'"?(g=h+1,c=i):i==="."&&!d?h>g?j():g=h+1:i==="["?(h>g&&j(),d=g=h+1):i==="]"&&(d||H("Access path missing open bracket: "+a),d>0&&j(),d=0,g=h+1)}}return d&&H("Access path missing closing bracket: "+a),c&&H("Access path missing closing quote: "+a),h>g&&(h++,j()),b}function Fd(a,b,c){const d=oe(a);return a=d.length===1?d[0]:a,Cc((c&&c.get||Yz)(d),[a],b||a)}var Wi=[],Ul=Fd("id"),Ub=Cc(function(a){return a},Wi,"identity"),$f=Cc(function(){return 0},Wi,"zero"),Xi=Cc(function(){return 1},Wi,"one"),Gd=Cc(function(){return!0},Wi,"true"),ag=Cc(function(){return!1},Wi,"false");function Vl(a,b,c){var d=[b].concat([].slice.call(c));console[a].apply(console,d)}var BS=0,Zz=1,_z=2,CS=3,DS=4;function $z(a,b){var c=a||BS;return{level:function(d){return arguments.length?(c=+d,this):c},error:function(){return c>=Zz&&Vl(b||"error","ERROR",arguments),this},warn:function(){return c>=_z&&Vl(b||"warn","WARN",arguments),this},info:function(){return c>=CS&&Vl(b||"log","INFO",arguments),this},debug:function(){return c>=DS&&Vl(b||"log","DEBUG",arguments),this}}}var J=Array.isArray;function Z(a){return a===Object(a)}const aA=a=>a!=="__proto__";function Yi(...a){return a.reduce((b,c)=>{for(var d in c)if(d==="signals")b.signals=ES(b.signals,c.signals);else{var e=d==="legend"?{layout:1}:d==="style"?!0:null;Xq(b,d,c[d],e)}return b},{})}function Xq(a,b,c,d){if(!aA(b))return;var e,f;if(Z(c)&&!J(c)){f=Z(a[b])?a[b]:a[b]={};for(e in c)d&&(d===!0||d[e])?Xq(f,e,c[e]):aA(e)&&(f[e]=c[e])}else a[b]=c}function ES(a,b){if(a==null)return b;const c={},d=[];function e(f){c[f.name]||(c[f.name]=1,d.push(f))}return b.forEach(e),a.forEach(e),d}function ra(a){return a[a.length-1]}function ic(a){return a==null||a===""?null:+a}function bA(a){return function(b){return a*Math.exp(b)}}function cA(a){return function(b){return Math.log(a*b)}}function dA(a){return function(b){return Math.sign(b)*Math.log1p(Math.abs(b/a))}}function eA(a){return function(b){return Math.sign(b)*Math.expm1(Math.abs(b))*a}}function Wl(a){return function(b){return b<0?-Math.pow(-b,a):Math.pow(b,a)}}function Xl(a,b,c,d){var e=c(a[0]),f=c(ra(a)),g=(f-e)*b;return[d(e-g),d(f-g)]}function FS(a,b){return Xl(a,b,ic,Ub)}function GS(a,b){var c=Math.sign(a[0]);return Xl(a,b,cA(c),bA(c))}function HS(a,b,c){return Xl(a,b,Wl(c),Wl(1/c))}function IS(a,b,c){return Xl(a,b,dA(c),eA(c))}function Yl(a,b,c,d,e){var f=d(a[0]),g=d(ra(a)),h=b!=null?d(b):(f+g)/2;return[e(h+(f-h)*c),e(h+(g-h)*c)]}function fA(a,b,c){return Yl(a,b,c,ic,Ub)}function gA(a,b,c){var d=Math.sign(a[0]);return Yl(a,b,c,cA(d),bA(d))}function Yq(a,b,c,d){return Yl(a,b,c,Wl(d),Wl(1/d))}function hA(a,b,c,d){return Yl(a,b,c,dA(d),eA(d))}function JS(a){return 1+~~(new Date(a).getMonth()/3)}function KS(a){return 1+~~(new Date(a).getUTCMonth()/3)}function T(a){return a!=null?J(a)?a:[a]:[]}function LS(a,b,c){var d=a[0],e=a[1],f;return e<d&&(f=e,e=d,d=f),f=e-d,f>=c-b?[b,c]:[d=Math.min(Math.max(d,b),c-f),d+f]}function pa(a){return typeof a==="function"}const MS="descending";function iA(a,b,c){c=c||{},b=T(b)||[];const d=[],e=[],f={},g=c.comparator||NS;return T(a).forEach((h,i)=>{if(h==null)return;d.push(b[i]===MS?-1:1),e.push(h=pa(h)?h:Fd(h,null,c)),(Tb(h)||[]).forEach(j=>f[j]=1)}),e.length===0?null:Cc(g(e,d),Object.keys(f))}const jA=(a,b)=>(a<b||a==null)&&b!=null?-1:(a>b||b==null)&&a!=null?1:(b=b instanceof Date?+b:b,a=a instanceof Date?+a:a)!==a&&b===b?-1:b!==b&&a===a?1:0,NS=(a,b)=>a.length===1?OS(a[0],b[0]):PS(a,b,a.length),OS=(a,b)=>function(c,d){return jA(a(c),a(d))*b},PS=(a,b,c)=>(b.push(0),function(d,e){let f,g=0,h=-1;for(;g===0&&++h<c;)f=a[h],g=jA(f(d),f(e));return g*b[h]});function Vb(a){return pa(a)?a:function(){return a}}function kA(a,b){var c,d;function e(){b(d),c=d=null}return function(f){d=f,c&&clearTimeout(c),c=setTimeout(e,a)}}function la(a){for(var b,c,d=1,e=arguments.length;d<e;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a}function pe(a,b){var c=0,d,e,f,g;if(a&&(d=a.length))if(b==null){for(e=a[c];c<d&&(e==null||e!==e);e=a[++c]);for(f=g=e;c<d;++c)e=a[c],e!=null&&(e<f&&(f=e),e>g&&(g=e))}else{for(e=b(a[c]);c<d&&(e==null||e!==e);e=b(a[++c]));for(f=g=e;c<d;++c)e=b(a[c]),e!=null&&(e<f&&(f=e),e>g&&(g=e))}return[f,g]}function QS(a,b){var c=-1,d=a.length,e,f,g,h,i;if(b==null){for(;++c<d;){f=a[c];if(f!=null&&f>=f){e=g=f;break}}if(c===d)return[-1,-1];for(h=i=c;++c<d;)f=a[c],f!=null&&(e>f&&(e=f,h=c),g<f&&(g=f,i=c))}else{for(;++c<d;){f=b(a[c],c,a);if(f!=null&&f>=f){e=g=f;break}}if(c===d)return[-1,-1];for(h=i=c;++c<d;)f=b(a[c],c,a),f!=null&&(e>f&&(e=f,h=c),g<f&&(g=f,i=c))}return[h,i]}const RS=Object.prototype.hasOwnProperty;function _(a,b){return RS.call(a,b)}var Zl={};function Zi(a){var b={},c,d;function e(f){return _(b,f)&&b[f]!==Zl}return c={size:0,empty:0,object:b,has:e,get:function(f){return e(f)?b[f]:void 0},set:function(f,g){return e(f)||(++c.size,b[f]===Zl&&--c.empty),b[f]=g,this},delete:function(f){return e(f)&&(--c.size,++c.empty,b[f]=Zl),this},clear:function(){c.size=c.empty=0,c.object=b={}},test:function(f){return arguments.length?(d=f,c):d},clean:function(){var f={},g=0,h,i;for(h in b)i=b[h],i!==Zl&&(!d||!d(i))&&(f[h]=i,++g);c.size=g,c.empty=0,c.object=b=f}},a&&Object.keys(a).forEach(function(f){c.set(f,a[f])}),c}function SS(a,b,c,d,e,f){if(!c&&c!==0)return f;var g=a[0],h=ra(a),i=+c,j,k;return h<g&&(j=g,g=h,h=j),j=Math.abs(b-g),k=Math.abs(h-b),j<k&&j<=i?d:k<=i?e:f}function N(a,b){var c=a.prototype=Object.create(b.prototype);return c.constructor=a,c}function _i(a,b,c,d){var e=b[0],f=b[b.length-1],g;return e>f&&(g=e,e=f,f=g),c=c===void 0||c,d=d===void 0||d,(c?e<=a:e<a)&&(d?a<=f:a<f)}function bg(a){return typeof a==="boolean"}function cg(a){return Object.prototype.toString.call(a)==="[object Date]"}function Fa(a){return typeof a==="number"}function TS(a){return Object.prototype.toString.call(a)==="[object RegExp]"}function V(a){return typeof a==="string"}function lA(a,b,c){a&&(a=b?T(a).map(h=>h.replace(/\\(.)/g,"$1")):T(a));const d=a&&a.length,e=c&&c.get||Yz,f=h=>e(b?[h]:oe(h));let g;if(!d)g=function(){return""};else if(d===1){const h=f(a[0]);g=function(i){return""+h(i)}}else{const h=a.map(f);g=function(i){let j=""+h[0](i),k=0;for(;++k<d;)j+="|"+h[k](i);return j}}return Cc(g,a,"key")}function US(a,b){const c=a[0],d=ra(a),e=+b;return e?e===1?d:c+e*(d-c):c}const VS=1e4;function WS(a){a=+a||VS;let b,c,d;const e=()=>{b={},c={},d=0},f=(g,h)=>(++d>a&&(c=b,b={},d=1),b[g]=h);return e(),{clear:e,has:g=>_(b,g)||_(c,g),get:g=>_(b,g)?b[g]:_(c,g)?f(g,c[g]):void 0,set:(g,h)=>_(b,g)?b[g]=h:f(g,h)}}function XS(a,b,c,d){var e=b.length,f=c.length;if(!f)return b;if(!e)return c;for(var g=d||new b.constructor(e+f),h=0,i=0,j=0;h<e&&i<f;++j)g[j]=a(b[h],c[i])>0?c[i++]:b[h++];for(;h<e;++h,++j)g[j]=b[h];for(;i<f;++i,++j)g[j]=c[i];return g}function _l(a,b){for(var c="";--b>=0;)c+=a;return c}function YS(a,b,c,d){var e=c||" ",f=a+"",g=b-f.length;return g<=0?f:d==="left"?_l(e,g)+f:d==="center"?_l(e,~~(g/2))+f+_l(e,Math.ceil(g/2)):f+_l(e,g)}function $l(a){return a&&ra(a)-a[0]||0}function P(a){return J(a)?"["+a.map(P)+"]":Z(a)||V(a)?JSON.stringify(a).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):a}function mA(a){return a==null||a===""?null:!a||a==="false"||a==="0"?!1:!!a}function ZS(a){return Fa(a)?a:cg(a)?a:Date.parse(a)}function nA(a,b){return b=b||ZS,a==null||a===""?null:b(a)}function oA(a){return a==null||a===""?null:a+""}function wb(a){for(var b={},c=0,d=a.length;c<d;++c)b[a[c]]=!0;return b}function _S(a,b,c,d){var e=d!=null?d:"…",f=a+"",g=f.length,h=Math.max(0,b-e.length);return g<=b?f:c==="left"?e+f.slice(g-h):c==="center"?f.slice(0,Math.ceil(h/2))+e+f.slice(g-~~(h/2)):f.slice(0,h)+e}function dg(a,b,c){if(a){var d=0,e=a.length,f;if(b)for(;d<e;++d)(f=b(a[d]))&&c(f,d,a);else a.forEach(c)}}function am(a){var b=a||Ub,c=[],d={};return c.add=function(e){var f=b(e);return d[f]||(d[f]=1,c.push(e)),c},c.remove=function(e){var f=b(e),g;return d[f]&&(d[f]=0,(g=c.indexOf(e))>=0&&c.splice(g,1)),c},c}async function bm(a,b){try{await b(a)}catch(c){a.error(c)}}var pA=Symbol("vega_id"),$S=1;function cm(a){return!!(a&&aa(a))}function aa(a){return a[pA]}function qA(a,b){return a[pA]=b,a}function xa(a){var b=a===Object(a)?a:{data:a};return aa(b)?b:qA(b,$S++)}function Zq(a){return _q(a,xa({}))}function _q(a,b){for(var c in a)b[c]=a[c];return b}function rA(a,b){return qA(b,aa(a))}function eg(a,b){return a?b?(c,d)=>a(c,d)||aa(b(c))-aa(b(d)):(c,d)=>a(c,d)||aa(c)-aa(d):null}function sA(a){return a&&a.constructor===fg}function fg(){var a=[],b=[],c=[],d=[],e=[],f=null,g=!1;return{constructor:fg,insert:function(h){for(var i=T(h),j=0,k=i.length;j<k;++j)a.push(i[j]);return this},remove:function(h){for(var i=pa(h)?d:b,j=T(h),k=0,l=j.length;k<l;++k)i.push(j[k]);return this},modify:function(h,i,j){var k={field:i,value:Vb(j)};return pa(h)?(k.filter=h,e.push(k)):(k.tuple=h,c.push(k)),this},encode:function(h,i){return pa(h)?e.push({filter:h,field:i}):c.push({tuple:h,field:i}),this},clean:function(h){return f=h,this},reflow:function(){return g=!0,this},pulse:function(h,i){var j={},k={},l,m,n,o,p,q;for(l=0,m=i.length;l<m;++l)j[aa(i[l])]=1;for(l=0,m=b.length;l<m;++l)p=b[l],j[aa(p)]=-1;for(l=0,m=d.length;l<m;++l)o=d[l],i.forEach(function(s){o(s)&&(j[aa(s)]=-1)});for(l=0,m=a.length;l<m;++l)p=a[l],q=aa(p),j[q]?j[q]=1:h.add.push(xa(a[l]));for(l=0,m=i.length;l<m;++l)p=i[l],j[aa(p)]<0&&h.rem.push(p);function r(s,t,w){w?s[t]=w(s):h.encode=t,g||(k[aa(s)]=s)}for(l=0,m=c.length;l<m;++l)n=c[l],p=n.tuple,o=n.field,q=j[aa(p)],q>0&&(r(p,o,n.value),h.modifies(o));for(l=0,m=e.length;l<m;++l)n=e[l],o=n.filter,i.forEach(function(s){o(s)&&j[aa(s)]>0&&r(s,n.field,n.value)}),h.modifies(n.field);if(g)h.mod=b.length||d.length?i.filter(function(s){return j[aa(s)]>0}):i.slice();else for(q in k)h.mod.push(k[q]);return(f||f==null&&(b.length||d.length))&&h.clean(!0),h}}}var dm="_:mod:_";function em(){Object.defineProperty(this,dm,{writable:!0,value:{}})}var $q=em.prototype;$q.set=function(a,b,c,d){var e=this,f=e[a],g=e[dm];return b!=null&&b>=0?(f[b]!==c||d)&&(f[b]=c,g[b+":"+a]=-1,g[a]=-1):(f!==c||d)&&(e[a]=c,g[a]=J(c)?1+c.length:-1),e},$q.modified=function(a,b){var c=this[dm],d;if(arguments.length){if(J(a)){for(d=0;d<a.length;++d)if(c[a[d]])return!0;return!1}}else{for(d in c)if(c[d])return!0;return!1}return b!=null&&b>=0?b+1<c[a]||!!c[b+":"+a]:!!c[a]},$q.clear=function(){return this[dm]={},this};var aT=0,bT="pulse",cT=new em(),dT=1,eT=2;function Ga(a,b,c,d){this.id=++aT,this.value=a,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,b&&(this._update=b),c&&this.parameters(c,d)}var qe=Ga.prototype;qe.targets=function(){return this._targets||(this._targets=am(Ul))},qe.set=function(a){return this.value!==a?(this.value=a,1):0};function tA(a){return function(b){var c=this.flags;return arguments.length===0?!!(c&a):(this.flags=b?c|a:c&~a,this)}}qe.skip=tA(dT),qe.modified=tA(eT),qe.parameters=function(a,b,c){b=b!==!1;var d=this,e=d._argval=d._argval||new em(),f=d._argops=d._argops||[],g=[],h,i,j,k;function l(m,n,o){o instanceof Ga?(o!==d&&(b&&o.targets().add(d),g.push(o)),f.push({op:o,name:m,index:n})):e.set(m,n,o)}for(h in a){i=a[h];if(h===bT)T(i).forEach(function(m){m instanceof Ga?m!==d&&(m.targets().add(d),g.push(m)):H("Pulse parameters must be operator instances.")}),d.source=i;else if(J(i))for(e.set(h,-1,Array(j=i.length)),k=0;k<j;++k)l(h,k,i[k]);else l(h,-1,i)}return this.marshall().clear(),c&&(f.initonly=!0),g},qe.marshall=function(a){var b=this._argval||cT,c=this._argops,d,e,f,g,h;if(c){for(e=0,f=c.length;e<f;++e)d=c[e],g=d.op,h=g.modified()&&g.stamp===a,b.set(d.name,d.index,g.value,h);if(c.initonly){for(e=0;e<f;++e)d=c[e],d.op.targets().remove(this);this._argops=null,this._update=null}}return b},qe.detach=function(){var a=this._argops,b,c,d,e;if(a)for(b=0,c=a.length;b<c;++b)d=a[b],e=d.op,e._targets&&e._targets.remove(this)},qe.evaluate=function(a){var b=this._update;if(b){var c=this.marshall(a.stamp),d=b.call(this,c,a);c.clear();if(d!==this.value)this.value=d;else if(!this.modified())return a.StopPropagation}},qe.run=function(a){if(a.stamp<this.stamp)return a.StopPropagation;var b;return this.skip()?(this.skip(!1),b=0):b=this.evaluate(a),this.pulse=b||a};function fT(a,b,c,d){var e=1,f;return a instanceof Ga?f=a:a&&a.prototype instanceof Ga?f=new a():pa(a)?f=new Ga(null,a):(e=0,f=new Ga(a,b)),this.rank(f),e&&(d=c,c=b),c&&this.connect(f,f.parameters(c,d)),this.touch(f),f}function gT(a,b){var c=a.rank,d,e;for(d=0,e=b.length;d<e;++d)if(c<b[d].rank){this.rerank(a);return}}var hT=0;function fm(a,b,c){this.id=++hT,this.value=null,c&&(this.receive=c),a&&(this._filter=a),b&&(this._apply=b)}function Ye(a,b,c){return new fm(a,b,c)}var hd=fm.prototype;hd._filter=Gd,hd._apply=Ub,hd.targets=function(){return this._targets||(this._targets=am(Ul))},hd.consume=function(a){return arguments.length?(this._consume=!!a,this):!!this._consume},hd.receive=function(a){if(this._filter(a)){for(var b=this.value=this._apply(a),c=this._targets,d=c?c.length:0,e=0;e<d;++e)c[e].receive(b);this._consume&&(a.preventDefault(),a.stopPropagation())}},hd.filter=function(a){var b=Ye(a);return this.targets().add(b),b},hd.apply=function(a){var b=Ye(null,a);return this.targets().add(b),b},hd.merge=function(){var a=Ye();this.targets().add(a);for(var b=0,c=arguments.length;b<c;++b)arguments[b].targets().add(a);return a},hd.throttle=function(a){var b=-1;return this.filter(function(){var c=Date.now();return c-b>a?(b=c,1):0})},hd.debounce=function(a){var b=Ye();return this.targets().add(Ye(null,null,kA(a,function(c){var d=c.dataflow;b.receive(c),d&&d.run&&d.run()}))),b},hd.between=function(a,b){var c=!1;return a.targets().add(Ye(null,null,function(){c=!0})),b.targets().add(Ye(null,null,function(){c=!1})),this.filter(function(){return c})};function iT(a,b,c,d){var e=this,f=Ye(c,d),g=function(k){k.dataflow=e;try{f.receive(k)}catch(l){e.error(l)}finally{e.run()}},h;typeof a==="string"&&typeof document!=="undefined"?h=document.querySelectorAll(a):h=T(a);for(var i=0,j=h.length;i<j;++i)h[i].addEventListener(b,g);return f}const jT=/^([A-Za-z]+:)?\/\//,kT=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,lT=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,uA="file://";function mT(a,b){return function(c){return{options:c||{},sanitize:oT,load:nT,fileAccess:!!b,file:pT(b),http:rT(a)}}}async function nT(a,b){const c=await this.sanitize(a,b),d=c.href;return c.localFile?this.file(d):this.http(d,b)}async function oT(a,b){b=la({},this.options,b);const c=this.fileAccess,d={href:null};let e,f,g;const h=kT.test(a.replace(lT,""));(a==null||typeof a!=="string"||!h)&&H("Sanitize failure, invalid URI: "+P(a));const i=jT.test(a);return(g=b.baseURL)&&!i&&(!a.startsWith("/")&&g[g.length-1]!=="/"&&(a="/"+a),a=g+a),f=(e=a.startsWith(uA))||b.mode==="file"||b.mode!=="http"&&!i&&c,e?a=a.slice(uA.length):a.startsWith("//")&&(b.defaultProtocol==="file"?(a=a.slice(2),f=!0):a=(b.defaultProtocol||"http")+":"+a),Object.defineProperty(d,"localFile",{value:!!f}),d.href=a,b.target&&(d.target=b.target+""),b.rel&&(d.rel=b.rel+""),b.context==="image"&&b.crossOrigin&&(d.crossOrigin=b.crossOrigin+""),d}function pT(a){return a?function(b){return new Promise(function(c,d){a.readFile(b,function(e,f){e?d(e):c(f)})})}:qT}async function qT(){H("No file system access.")}function rT(a){return a?async function(b,c){const d=la({},this.options.http,c),e=c&&c.response,f=await a(b,d);return f.ok?pa(f[e])?f[e]():f.text():H(f.status+""+f.statusText)}:sT}async function sT(){H("No HTTP fetch method available.")}var ar={boolean:mA,integer:ic,number:ic,date:nA,string:oA,unknown:Ub},gm=[vT,xT,xA,wT],tT=["boolean","integer","number","date"];function vA(a,b){if(!a||!a.length)return"unknown";const c=a.length,d=gm.length,e=gm.map((f,g)=>g+1);for(let f=0,g=0,h,i;f<c;++f)for(i=b?a[f][b]:a[f],h=0;h<d;++h)if(e[h]&&uT(i)&&!gm[h](i)){e[h]=0,++g;if(g===gm.length)return"string"}return tT[e.reduce((f,g)=>f===0?g:f,0)-1]}function wA(a,b){return b.reduce(function(c,d){return c[d]=vA(a,d),c},{})}function uT(a){return a!=null&&a===a}function vT(a){return a==="true"||a==="false"||a===!0||a===!1}function wT(a){return!Number.isNaN(Date.parse(a))}function xA(a){return!Number.isNaN(+a)&&!(a instanceof Date)}function xT(a){return xA(a)&&Number.isInteger(+a)}var yA={},br={},cr=34,$i=10,dr=13;function zA(a){return new Function("d","return {"+a.map(function(b,c){return JSON.stringify(b)+": d["+c+'] || ""'}).join(",")+"}")}function yT(a,b){var c=zA(a);return function(d,e){return b(c(d),e,a)}}function AA(a){var b=Object.create(null),c=[];return a.forEach(function(d){for(var e in d)e in b||c.push(b[e]=e)}),c}function jc(a,b){var c=a+"",d=c.length;return d<b?new Array(b-d+1).join(0)+c:c}function zT(a){return a<0?"-"+jc(-a,6):a>9999?"+"+jc(a,6):jc(a,4)}function AT(a){var b=a.getUTCHours(),c=a.getUTCMinutes(),d=a.getUTCSeconds(),e=a.getUTCMilliseconds();return isNaN(a)?"Invalid Date":zT(a.getUTCFullYear())+"-"+jc(a.getUTCMonth()+1,2)+"-"+jc(a.getUTCDate(),2)+(e?"T"+jc(b,2)+":"+jc(c,2)+":"+jc(d,2)+"."+jc(e,3)+"Z":d?"T"+jc(b,2)+":"+jc(c,2)+":"+jc(d,2)+"Z":c||b?"T"+jc(b,2)+":"+jc(c,2)+"Z":"")}function BT(a){var b=new RegExp('["'+a+`
\r]`),c=a.charCodeAt(0);function d(l,m){var n,o,p=e(l,function(q,r){if(n)return n(q,r-1);o=q,n=m?yT(q,m):zA(q)});return p.columns=o||[],p}function e(l,m){var n=[],o=l.length,p=0,q=0,r,s=o<=0,t=!1;l.charCodeAt(o-1)===$i&&--o,l.charCodeAt(o-1)===dr&&--o;function w(){if(s)return br;if(t)return t=!1,yA;var x,u=p,z;if(l.charCodeAt(u)===cr){for(;p++<o&&l.charCodeAt(p)!==cr||l.charCodeAt(++p)===cr;);return(x=p)>=o?s=!0:(z=l.charCodeAt(p++))===$i?t=!0:z===dr&&(t=!0,l.charCodeAt(p)===$i&&++p),l.slice(u+1,x-1).replace(/""/g,'"')}for(;p<o;){if((z=l.charCodeAt(x=p++))===$i)t=!0;else if(z===dr)t=!0,l.charCodeAt(p)===$i&&++p;else if(z!==c)continue;return l.slice(u,x)}return s=!0,l.slice(u,o)}for(;(r=w())!==br;){for(var v=[];r!==yA&&r!==br;)v.push(r),r=w();if(m&&(v=m(v,q++))==null)continue;n.push(v)}return n}function f(l,m){return l.map(function(n){return m.map(function(o){return k(n[o])}).join(a)})}function g(l,m){return m==null&&(m=AA(l)),[m.map(k).join(a)].concat(f(l,m)).join(`
`)}function h(l,m){return m==null&&(m=AA(l)),f(l,m).join(`
`)}function i(l){return l.map(j).join(`
`)}function j(l){return l.map(k).join(a)}function k(l){return l==null?"":l instanceof Date?AT(l):b.test(l+="")?'"'+l.replace(/"/g,'""')+'"':l}return{parse:d,parseRows:e,format:g,formatBody:h,formatRows:i,formatRow:j,formatValue:k}}function BA(a){const b=function(c,d){const e={delimiter:a};return er(c,d?la(d,e):e)};return b.responseType="text",b}function er(a,b){return b.header&&(a=b.header.map(P).join(b.delimiter)+`
`+a),BT(b.delimiter).parse(a+"")}er.responseType="text";function CT(a){return typeof Buffer==="function"&&pa(Buffer.isBuffer)?Buffer.isBuffer(a):!1}function fr(a,b){const c=b&&b.property?Fd(b.property):Ub;return Z(a)&&!CT(a)?DT(c(a)):c(JSON.parse(a))}fr.responseType="json";function DT(a,b){return b&&b.copy?JSON.parse(JSON.stringify(a)):a}function ET(a){return a}function FT(a){if(a==null)return ET;var b,c,d=a.scale[0],e=a.scale[1],f=a.translate[0],g=a.translate[1];return function(h,i){i||(b=c=0);var j=2,k=h.length,l=new Array(k);for(l[0]=(b+=h[0])*d+f,l[1]=(c+=h[1])*e+g;j<k;)l[j]=h[j],++j;return l}}function GT(a,b){for(var c,d=a.length,e=d-b;e<--d;)c=a[e],a[e++]=a[d],a[d]=c}function HT(a,b){return typeof b==="string"&&(b=a.objects[b]),b.type==="GeometryCollection"?{type:"FeatureCollection",features:b.geometries.map(function(c){return CA(a,c)})}:CA(a,b)}function CA(a,b){var c=b.id,d=b.bbox,e=b.properties==null?{}:b.properties,f=DA(a,b);return c==null&&d==null?{type:"Feature",properties:e,geometry:f}:d==null?{type:"Feature",id:c,properties:e,geometry:f}:{type:"Feature",id:c,bbox:d,properties:e,geometry:f}}function DA(a,b){var c=FT(a.transform),d=a.arcs;function e(k,l){l.length&&l.pop();for(var m=d[k<0?~k:k],n=0,o=m.length;n<o;++n)l.push(c(m[n],n));k<0&&GT(l,o)}function f(k){return c(k)}function g(k){for(var l=[],m=0,n=k.length;m<n;++m)e(k[m],l);return l.length<2&&l.push(l[0]),l}function h(k){for(var l=g(k);l.length<4;)l.push(l[0]);return l}function i(k){return k.map(h)}function j(k){var l=k.type,m;switch(l){case"GeometryCollection":return{type:l,geometries:k.geometries.map(j)};case"Point":m=f(k.coordinates);break;case"MultiPoint":m=k.coordinates.map(f);break;case"LineString":m=g(k.arcs);break;case"MultiLineString":m=k.arcs.map(g);break;case"Polygon":m=i(k.arcs);break;case"MultiPolygon":m=k.arcs.map(i);break;default:return null}return{type:l,coordinates:m}}return j(b)}function IT(a,b){var c={},d={},e={},f=[],g=-1;b.forEach(function(j,k){var l=a.arcs[j<0?~j:j],m;l.length<3&&!l[1][0]&&!l[1][1]&&(m=b[++g],b[g]=j,b[k]=m)}),b.forEach(function(j){var k=h(j),l=k[0],m=k[1],n,o;if(n=e[l]){delete e[n.end],n.push(j),n.end=m;if(o=d[m]){delete d[o.start];var p=o===n?n:n.concat(o);d[p.start=n.start]=e[p.end=o.end]=p}else d[n.start]=e[n.end]=n}else if(n=d[m]){delete d[n.start],n.unshift(j),n.start=l;if(o=e[l]){delete e[o.end];var q=o===n?n:o.concat(n);d[q.start=o.start]=e[q.end=n.end]=q}else d[n.start]=e[n.end]=n}else n=[j],d[n.start=l]=e[n.end=m]=n});function h(j){var k=a.arcs[j<0?~j:j],l=k[0],m;return a.transform?(m=[0,0],k.forEach(function(n){m[0]+=n[0],m[1]+=n[1]})):m=k[k.length-1],j<0?[m,l]:[l,m]}function i(j,k){for(var l in j){var m=j[l];delete k[m.start],delete m.start,delete m.end,m.forEach(function(n){c[n<0?~n:n]=1}),f.push(m)}}return i(e,d),i(d,e),b.forEach(function(j){c[j<0?~j:j]||f.push([j])}),f}function JT(a){return DA(a,KT.apply(this,arguments))}function KT(a,b,c){var d,e,f;if(arguments.length>1)d=LT(a,b,c);else for(e=0,d=new Array(f=a.arcs.length);e<f;++e)d[e]=e;return{type:"MultiLineString",arcs:IT(a,d)}}function LT(a,b,c){var d=[],e=[],f;function g(l){var m=l<0?~l:l;(e[m]||(e[m]=[])).push({i:l,g:f})}function h(l){l.forEach(g)}function i(l){l.forEach(h)}function j(l){l.forEach(i)}function k(l){switch(f=l,l.type){case"GeometryCollection":l.geometries.forEach(k);break;case"LineString":h(l.arcs);break;case"MultiLineString":case"Polygon":i(l.arcs);break;case"MultiPolygon":j(l.arcs);break}}return k(b),e.forEach(c==null?function(l){d.push(l[0].i)}:function(l){c(l[0].g,l[l.length-1].g)&&d.push(l[0].i)}),d}const MT={interior:(a,b)=>a!==b,exterior:(a,b)=>a===b};function EA(a,b){let c,d,e,f;return a=fr(a,b),b&&b.feature?(c=HT,e=b.feature):b&&b.mesh?(c=JT,e=b.mesh,f=MT[b.filter]):H("Missing TopoJSON feature or mesh parameter."),d=(d=a.objects[e])?c(a,d,f):H("Invalid TopoJSON object: "+e),d&&d.features||[d]}EA.responseType="json";const hm={dsv:er,csv:BA(","),tsv:BA("	"),json:fr,topojson:EA};function gr(a,b){return arguments.length>1?(hm[a]=b,this):_(hm,a)?hm[a]:null}function FA(a){const b=gr(a);return b&&b.responseType||"text"}function aj(a){const b={};return c=>b[c]||(b[c]=a(c))}function vh(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function im(a){return a.length===1&&(a=NT(a)),{left:function(b,c,d,e){for(d==null&&(d=0),e==null&&(e=b.length);d<e;){var f=d+e>>>1;a(b[f],c)<0?d=f+1:e=f}return d},right:function(b,c,d,e){for(d==null&&(d=0),e==null&&(e=b.length);d<e;){var f=d+e>>>1;a(b[f],c)>0?e=f:d=f+1}return d}}}function NT(a){return function(b,c){return vh(a(b),c)}}var GA=im(vh),Ze=GA.right,OT=GA.left;function PT(a,b){let c=0,d,e=0,f=0;if(b===void 0)for(let g of a)g!=null&&(g=+g)>=g&&(d=g-e,e+=d/++c,f+=d*(g-e));else{let g=-1;for(let h of a)(h=b(h,++g,a))!=null&&(h=+h)>=h&&(d=h-e,e+=d/++c,f+=d*(h-e))}if(c>1)return f/(c-1)}function QT(a,b){const c=PT(a,b);return c?Math.sqrt(c):c}function gg(a,b,c){a=+a,b=+b,c=(e=arguments.length)<2?(b=a,a=0,1):e<3?1:+c;for(var d=-1,e=Math.max(0,Math.ceil((b-a)/c))|0,f=new Array(e);++d<e;)f[d]=a+d*c;return f}var hr=Math.sqrt(50),ir=Math.sqrt(10),jr=Math.sqrt(2);function kr(a,b,c){var d,e=-1,f,g,h;b=+b,a=+a,c=+c;if(a===b&&c>0)return[a];(d=b<a)&&(f=a,a=b,b=f);if((h=jm(a,b,c))===0||!isFinite(h))return[];if(h>0)for(a=Math.ceil(a/h),b=Math.floor(b/h),g=new Array(f=Math.ceil(b-a+1));++e<f;)g[e]=(a+e)*h;else for(a=Math.floor(a*h),b=Math.ceil(b*h),g=new Array(f=Math.ceil(a-b+1));++e<f;)g[e]=(a-e)/h;return d&&g.reverse(),g}function jm(a,b,c){var d=(b-a)/Math.max(0,c),e=Math.floor(Math.log(d)/Math.LN10),f=d/Math.pow(10,e);return e>=0?(f>=hr?10:f>=ir?5:f>=jr?2:1)*Math.pow(10,e):-Math.pow(10,-e)/(f>=hr?10:f>=ir?5:f>=jr?2:1)}function _e(a,b,c){var d=Math.abs(b-a)/Math.max(0,c),e=Math.pow(10,Math.floor(Math.log(d)/Math.LN10)),f=d/e;return f>=hr?e*=10:f>=ir?e*=5:f>=jr&&(e*=2),b<a?-e:e}function hg(a,b){let c;if(b===void 0)for(const d of a)d!=null&&(c<d||c===void 0&&d>=d)&&(c=d);else{let d=-1;for(let e of a)(e=b(e,++d,a))!=null&&(c<e||c===void 0&&e>=e)&&(c=e)}return c}function lr(a,b){let c;if(b===void 0)for(const d of a)d!=null&&(c>d||c===void 0&&d>=d)&&(c=d);else{let d=-1;for(let e of a)(e=b(e,++d,a))!=null&&(c>e||c===void 0&&e>=e)&&(c=e)}return c}function HA(a,b,c=0,d=a.length-1,e=vh){for(;d>c;){if(d-c>600){const i=d-c+1,j=b-c+1,k=Math.log(i),l=.5*Math.exp(2*k/3),m=.5*Math.sqrt(k*l*(i-l)/i)*(j-i/2<0?-1:1),n=Math.max(c,Math.floor(b-j*l/i+m)),o=Math.min(d,Math.floor(b+(i-j)*l/i+m));HA(a,b,n,o,e)}const f=a[b];let g=c,h=d;for(bj(a,c,b),e(a[d],f)>0&&bj(a,c,d);g<h;){for(bj(a,g,h),++g,--h;e(a[g],f)<0;)++g;for(;e(a[h],f)>0;)--h}e(a[c],f)===0?bj(a,c,h):(++h,bj(a,h,d)),h<=b&&(c=h+1),b<=h&&(d=h-1)}return a}function bj(a,b,c){const d=a[b];a[b]=a[c],a[c]=d}function RT(a){return a===null?NaN:+a}function*ST(a,b){if(b===void 0)for(let c of a)c!=null&&(c=+c)>=c&&(yield c);else{let c=-1;for(let d of a)(d=b(d,++c,a))!=null&&(d=+d)>=d&&(yield d)}}function km(a,b,c){a=Float64Array.from(ST(a,c));if(!(d=a.length))return;if((b=+b)<=0||d<2)return lr(a);if(b>=1)return hg(a);var d,e=(d-1)*b,f=Math.floor(e),g=hg(HA(a,f).subarray(0,f+1)),h=lr(a.subarray(f+1));return g+(h-g)*(e-f)}function TT(a,b,c=RT){if(!(d=a.length))return;if((b=+b)<=0||d<2)return+c(a[0],0,a);if(b>=1)return+c(a[d-1],d-1,a);var d,e=(d-1)*b,f=Math.floor(e),g=+c(a[f],f,a),h=+c(a[f+1],f+1,a);return g+(h-g)*(e-f)}function UT(a,b){let c=0,d=0;if(b===void 0)for(let e of a)e!=null&&(e=+e)>=e&&(++c,d+=e);else{let e=-1;for(let f of a)(f=b(f,++e,a))!=null&&(f=+f)>=f&&(++c,d+=f)}if(c)return d/c}function IA(a,b){return km(a,.5,b)}function VT(a,b){return Array.from(b,c=>a[c])}function JA(a,b){let c=0;if(b===void 0)for(let d of a)(d=+d)&&(c+=d);else{let d=-1;for(let e of a)(e=+b(e,++d,a))&&(c+=e)}return c}function lm(a,b){if((c=(a=b?a.toExponential(b-1):a.toExponential()).indexOf("e"))<0)return null;var c,d=a.slice(0,c);return[d.length>1?d[0]+d.slice(2):d,+a.slice(c+1)]}function wh(a){return a=lm(Math.abs(a)),a?a[1]:NaN}function WT(a,b){return function(c,d){for(var e=c.length,f=[],g=0,h=a[0],i=0;e>0&&h>0;){i+h+1>d&&(h=Math.max(1,d-i)),f.push(c.substring(e-=h,e+h));if((i+=h+1)>d)break;h=a[g=(g+1)%a.length]}return f.reverse().join(b)}}function XT(a){return function(b){return b.replace(/[0-9]/g,function(c){return a[+c]})}}var YT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function xh(a){if(!(b=YT.exec(a)))throw new Error("invalid format: "+a);var b;return new mr({fill:b[1],align:b[2],sign:b[3],symbol:b[4],zero:b[5],width:b[6],comma:b[7],precision:b[8]&&b[8].slice(1),trim:b[9],type:b[10]})}xh.prototype=mr.prototype;function mr(a){this.fill=a.fill===void 0?" ":a.fill+"",this.align=a.align===void 0?">":a.align+"",this.sign=a.sign===void 0?"-":a.sign+"",this.symbol=a.symbol===void 0?"":a.symbol+"",this.zero=!!a.zero,this.width=a.width===void 0?void 0:+a.width,this.comma=!!a.comma,this.precision=a.precision===void 0?void 0:+a.precision,this.trim=!!a.trim,this.type=a.type===void 0?"":a.type+""}mr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ZT(a){Ve:for(var b=a.length,c=1,d=-1,e;c<b;++c)switch(a[c]){case".":d=e=c;break;case"0":d===0&&(d=c),e=c;break;default:if(!+a[c])break Ve;d>0&&(d=0);break}return d>0?a.slice(0,d)+a.slice(e+1):a}var KA;function _T(a,b){var c=lm(a,b);if(!c)return a+"";var d=c[0],e=c[1],f=e-(KA=Math.max(-8,Math.min(8,Math.floor(e/3)))*3)+1,g=d.length;return f===g?d:f>g?d+new Array(f-g+1).join("0"):f>0?d.slice(0,f)+"."+d.slice(f):"0."+new Array(1-f).join("0")+lm(a,Math.max(0,b+f-1))[0]}function LA(a,b){var c=lm(a,b);if(!c)return a+"";var d=c[0],e=c[1];return e<0?"0."+new Array(-e).join("0")+d:d.length>e+1?d.slice(0,e+1)+"."+d.slice(e+1):d+new Array(e-d.length+2).join("0")}var MA={"%":function(a,b){return(a*100).toFixed(b)},b:function(a){return Math.round(a).toString(2)},c:function(a){return a+""},d:function(a){return Math.round(a).toString(10)},e:function(a,b){return a.toExponential(b)},f:function(a,b){return a.toFixed(b)},g:function(a,b){return a.toPrecision(b)},o:function(a){return Math.round(a).toString(8)},p:function(a,b){return LA(a*100,b)},r:LA,s:_T,X:function(a){return Math.round(a).toString(16).toUpperCase()},x:function(a){return Math.round(a).toString(16)}};function NA(a){return a}var OA=Array.prototype.map,PA=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function QA(a){var b=a.grouping===void 0||a.thousands===void 0?NA:WT(OA.call(a.grouping,Number),a.thousands+""),c=a.currency===void 0?"":a.currency[0]+"",d=a.currency===void 0?"":a.currency[1]+"",e=a.decimal===void 0?".":a.decimal+"",f=a.numerals===void 0?NA:XT(OA.call(a.numerals,String)),g=a.percent===void 0?"%":a.percent+"",h=a.minus===void 0?"-":a.minus+"",i=a.nan===void 0?"NaN":a.nan+"";function j(l){l=xh(l);var m=l.fill,n=l.align,o=l.sign,p=l.symbol,q=l.zero,r=l.width,s=l.comma,t=l.precision,w=l.trim,v=l.type;v==="n"?(s=!0,v="g"):MA[v]||(t===void 0&&(t=12),w=!0,v="g"),(q||m==="0"&&n==="=")&&(q=!0,m="0",n="=");var x=p==="$"?c:p==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",u=p==="$"?d:/[%p]/.test(v)?g:"",z=MA[v],y=/[defgprs%]/.test(v);t=t===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,t)):Math.max(0,Math.min(20,t));function B(A){var C=x,F=u,K,D,I;if(v==="c")F=z(A)+F,A="";else{A=+A;var S=A<0||1/A<0;A=isNaN(A)?i:z(Math.abs(A),t),w&&(A=ZT(A)),S&&+A===0&&o!=="+"&&(S=!1),C=(S?o==="("?o:h:o==="-"||o==="("?"":o)+C,F=(v==="s"?PA[8+KA/3]:"")+F+(S&&o==="("?")":"");if(y){for(K=-1,D=A.length;++K<D;)if(I=A.charCodeAt(K),48>I||I>57){F=(I===46?e+A.slice(K+1):A.slice(K))+F,A=A.slice(0,K);break}}}s&&!q&&(A=b(A,Infinity));var X=C.length+A.length+F.length,Y=X<r?new Array(r-X+1).join(m):"";s&&q&&(A=b(Y+A,Y.length?r-F.length:Infinity),Y="");switch(n){case"<":A=C+A+F+Y;break;case"=":A=C+Y+A+F;break;case"^":A=Y.slice(0,X=Y.length>>1)+C+A+F+Y.slice(X);break;default:A=Y+C+A+F;break}return f(A)}return B.toString=function(){return l+""},B}function k(l,m){var n=j((l=xh(l),l.type="f",l)),o=Math.max(-8,Math.min(8,Math.floor(wh(m)/3)))*3,p=Math.pow(10,-o),q=PA[8+o/3];return function(r){return n(p*r)+q}}return{format:j,formatPrefix:k}}var mm,nm,nr;$T({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function $T(a){return mm=QA(a),nm=mm.format,nr=mm.formatPrefix,mm}function RA(a){return Math.max(0,-wh(Math.abs(a)))}function SA(a,b){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(wh(b)/3)))*3-wh(Math.abs(a)))}function TA(a,b){return a=Math.abs(a),b=Math.abs(b)-a,Math.max(0,wh(b)-wh(a))+1}function aU(a,b){return c=>{var d=a(c),e=d.indexOf(b),f,g;if(e<0)return d;for(f=bU(d,e),g=f<d.length?d.slice(f):"";--f>e;)if(d[f]!=="0"){++f;break}return d.slice(0,f)+g}}function bU(a,b){var c=a.lastIndexOf("e"),d;if(c>0)return c;for(c=a.length;--c>b;){d=a.charCodeAt(c);if(d>=48&&d<=57)return c+1}}function UA(a){const b=aj(a.format),c=a.formatPrefix;return{format:b,formatPrefix:c,formatFloat(d){var e=xh(d||",");if(e.precision==null){e.precision=12;switch(e.type){case"%":e.precision-=2;break;case"e":e.precision-=1;break}return aU(b(e),b(".1f")(1)[1])}else return b(e)},formatSpan(d,e,f,g){g=xh(g==null?",f":g);const h=_e(d,e,f),i=Math.max(Math.abs(d),Math.abs(e));let j;if(g.precision==null)switch(g.type){case"s":return isNaN(j=SA(h,i))||(g.precision=j),c(g,i);case"":case"e":case"g":case"p":case"r":{isNaN(j=TA(h,i))||(g.precision=j-(g.type==="e"));break}case"f":case"%":{isNaN(j=RA(h))||(g.precision=j-(g.type==="%")*2);break}}return b(g)}}}let or;VA();function VA(){return or=UA({format:nm,formatPrefix:nr})}function WA(a){return UA(QA(a))}function om(a){return arguments.length?or=WA(a):or}const xb="year",kc="quarter",Gb="month",fb="week",lc="date",Hb="day",Hd="dayofyear",Dc="hours",Ec="minutes",Pc="seconds",id="milliseconds",pr=[xb,kc,Gb,fb,lc,Hb,Hd,Dc,Ec,Pc,id],qr=pr.reduce((a,b,c)=>(a[b]=1+c,a),{});function rr(a){const b=T(a).slice(),c={};b.length||H("Missing time unit."),b.forEach(e=>{_(qr,e)?c[e]=1:H(`Invalid time unit: ${e}.`)});const d=(c[fb]||c[Hb]?1:0)+(c[kc]||c[Gb]||c[lc]?1:0)+(c[Hd]?1:0);return d>1&&H(`Incompatible time units: ${a}`),b.sort((e,f)=>qr[e]-qr[f]),b}const cU={[xb]:"%Y ",[kc]:"Q%q ",[Gb]:"%b ",[lc]:"%d ",[fb]:"W%U ",[Hb]:"%a ",[Hd]:"%j ",[Dc]:"%H:00",[Ec]:"00:%M",[Pc]:":%S",[id]:".%L",[`${xb}-${Gb}`]:"%Y-%m ",[`${xb}-${Gb}-${lc}`]:"%Y-%m-%d ",[`${Dc}-${Ec}`]:"%H:%M"};function XA(a,b){const c=la({},cU,b),d=rr(a),e=d.length;let f="",g=0,h,i;for(g=0;g<e;)for(h=d.length;h>g;--h){i=d.slice(g,h).join("-");if(c[i]!=null){f+=c[i],g=h;break}}return f.trim()}var sr=new Date(),tr=new Date();function lb(a,b,c,d){function e(f){return a(f=arguments.length===0?new Date():new Date(+f)),f}return e.floor=function(f){return a(f=new Date(+f)),f},e.ceil=function(f){return a(f=new Date(f-1)),b(f,1),a(f),f},e.round=function(f){var g=e(f),h=e.ceil(f);return f-g<h-f?g:h},e.offset=function(f,g){return b(f=new Date(+f),g==null?1:Math.floor(g)),f},e.range=function(f,g,h){var i=[],j;f=e.ceil(f),h=h==null?1:Math.floor(h);if(!(f<g)||!(h>0))return i;do i.push(j=new Date(+f)),b(f,h),a(f);while(j<f&&f<g);return i},e.filter=function(f){return lb(function(g){if(g>=g)for(;a(g),!f(g);)g.setTime(g-1)},function(g,h){if(g>=g)if(h<0)for(;++h<=0;)for(;b(g,-1),!f(g););else for(;--h>=0;)for(;b(g,1),!f(g););})},c&&(e.count=function(f,g){return sr.setTime(+f),tr.setTime(+g),a(sr),a(tr),Math.floor(c(sr,tr))},e.every=function(f){return f=Math.floor(f),!isFinite(f)||!(f>0)?null:f>1?e.filter(d?function(g){return d(g)%f===0}:function(g){return e.count(0,g)%f===0}):e}),e}var yh=lb(function(){},function(a,b){a.setTime(+a+b)},function(a,b){return b-a});yh.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?lb(function(b){b.setTime(Math.floor(b/a)*a)},function(b,c){b.setTime(+b+c*a)},function(b,c){return(c-b)/a}):yh};var pm=1e3,ig=6e4,qm=36e5,YA=864e5,ZA=6048e5,rm=lb(function(a){a.setTime(a-a.getMilliseconds())},function(a,b){a.setTime(+a+b*pm)},function(a,b){return(b-a)/pm},function(a){return a.getUTCSeconds()}),_A=lb(function(a){a.setTime(a-a.getMilliseconds()-a.getSeconds()*pm)},function(a,b){a.setTime(+a+b*ig)},function(a,b){return(b-a)/ig},function(a){return a.getMinutes()}),$A=lb(function(a){a.setTime(a-a.getMilliseconds()-a.getSeconds()*pm-a.getMinutes()*ig)},function(a,b){a.setTime(+a+b*qm)},function(a,b){return(b-a)/qm},function(a){return a.getHours()}),jg=lb(function(a){a.setHours(0,0,0,0)},function(a,b){a.setDate(a.getDate()+b)},function(a,b){return(b-a-(b.getTimezoneOffset()-a.getTimezoneOffset())*ig)/YA},function(a){return a.getDate()-1});function kg(a){return lb(function(b){b.setDate(b.getDate()-(b.getDay()+7-a)%7),b.setHours(0,0,0,0)},function(b,c){b.setDate(b.getDate()+c*7)},function(b,c){return(c-b-(c.getTimezoneOffset()-b.getTimezoneOffset())*ig)/ZA})}var sm=kg(0),ur=kg(1),yma=kg(2),zma=kg(3),vr=kg(4),Ama=kg(5),Bma=kg(6),wr=lb(function(a){a.setDate(1),a.setHours(0,0,0,0)},function(a,b){a.setMonth(a.getMonth()+b)},function(a,b){return b.getMonth()-a.getMonth()+(b.getFullYear()-a.getFullYear())*12},function(a){return a.getMonth()}),$e=lb(function(a){a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,b){a.setFullYear(a.getFullYear()+b)},function(a,b){return b.getFullYear()-a.getFullYear()},function(a){return a.getFullYear()});$e.every=function(a){return!isFinite(a=Math.floor(a))||!(a>0)?null:lb(function(b){b.setFullYear(Math.floor(b.getFullYear()/a)*a),b.setMonth(0,1),b.setHours(0,0,0,0)},function(b,c){b.setFullYear(b.getFullYear()+c*a)})};var aB=lb(function(a){a.setUTCSeconds(0,0)},function(a,b){a.setTime(+a+b*ig)},function(a,b){return(b-a)/ig},function(a){return a.getUTCMinutes()}),bB=lb(function(a){a.setUTCMinutes(0,0,0)},function(a,b){a.setTime(+a+b*qm)},function(a,b){return(b-a)/qm},function(a){return a.getUTCHours()}),lg=lb(function(a){a.setUTCHours(0,0,0,0)},function(a,b){a.setUTCDate(a.getUTCDate()+b)},function(a,b){return(b-a)/YA},function(a){return a.getUTCDate()-1});function mg(a){return lb(function(b){b.setUTCDate(b.getUTCDate()-(b.getUTCDay()+7-a)%7),b.setUTCHours(0,0,0,0)},function(b,c){b.setUTCDate(b.getUTCDate()+c*7)},function(b,c){return(c-b)/ZA})}var tm=mg(0),xr=mg(1),Cma=mg(2),Dma=mg(3),yr=mg(4),Ema=mg(5),Fma=mg(6),zr=lb(function(a){a.setUTCDate(1),a.setUTCHours(0,0,0,0)},function(a,b){a.setUTCMonth(a.getUTCMonth()+b)},function(a,b){return b.getUTCMonth()-a.getUTCMonth()+(b.getUTCFullYear()-a.getUTCFullYear())*12},function(a){return a.getUTCMonth()}),af=lb(function(a){a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,b){a.setUTCFullYear(a.getUTCFullYear()+b)},function(a,b){return b.getUTCFullYear()-a.getUTCFullYear()},function(a){return a.getUTCFullYear()});af.every=function(a){return!isFinite(a=Math.floor(a))||!(a>0)?null:lb(function(b){b.setUTCFullYear(Math.floor(b.getUTCFullYear()/a)*a),b.setUTCMonth(0,1),b.setUTCHours(0,0,0,0)},function(b,c){b.setUTCFullYear(b.getUTCFullYear()+c*a)})};const ng=new Date();function Ar(a){return ng.setFullYear(a),ng.setMonth(0),ng.setDate(1),ng.setHours(0,0,0,0),ng}function cB(a){return eB(new Date(a))}function dB(a){return Br(new Date(a))}function eB(a){return jg.count(Ar(a.getFullYear())-1,a)}function Br(a){return sm.count(Ar(a.getFullYear())-1,a)}function Cr(a){return Ar(a).getDay()}function dU(a,b,c,d,e,f,g){if(0<=a&&a<100){var h=new Date(-1,b,c,d,e,f,g);return h.setFullYear(a),h}return new Date(a,b,c,d,e,f,g)}function fB(a){return hB(new Date(a))}function gB(a){return Dr(new Date(a))}function hB(a){const b=Date.UTC(a.getUTCFullYear(),0,1);return lg.count(b-1,a)}function Dr(a){const b=Date.UTC(a.getUTCFullYear(),0,1);return tm.count(b-1,a)}function Er(a){return ng.setTime(Date.UTC(a,0,1)),ng.getUTCDay()}function eU(a,b,c,d,e,f,g){if(0<=a&&a<100){var h=new Date(Date.UTC(-1,b,c,d,e,f,g));return h.setUTCFullYear(c.y),h}return new Date(Date.UTC(a,b,c,d,e,f,g))}function iB(a,b,c,d,e){const f=b||1,g=ra(a),h=(r,s,t)=>(t=t||r,fU(c[t],d[t],r===g&&f,s)),i=new Date(),j=wb(a),k=j[xb]?h(xb):Vb(2012),l=j[Gb]?h(Gb):j[kc]?h(kc):$f,m=j[fb]&&j[Hb]?h(Hb,1,fb+Hb):j[fb]?h(fb,1):j[Hb]?h(Hb,1):j[lc]?h(lc,1):j[Hd]?h(Hd,1):Xi,n=j[Dc]?h(Dc):$f,o=j[Ec]?h(Ec):$f,p=j[Pc]?h(Pc):$f,q=j[id]?h(id):$f;return function(r){i.setTime(+r);const s=k(i);return e(s,l(i),m(i,s),n(i),o(i),p(i),q(i))}}function fU(a,b,c,d){const e=c<=1?a:d?(f,g)=>d+c*Math.floor((a(f,g)-d)/c):(f,g)=>c*Math.floor(a(f,g)/c);return b?(f,g)=>b(e(f,g),g):e}function zh(a,b,c){return b+a*7-(c+6)%7}const gU={[xb]:a=>a.getFullYear(),[kc]:a=>Math.floor(a.getMonth()/3),[Gb]:a=>a.getMonth(),[lc]:a=>a.getDate(),[Dc]:a=>a.getHours(),[Ec]:a=>a.getMinutes(),[Pc]:a=>a.getSeconds(),[id]:a=>a.getMilliseconds(),[Hd]:a=>eB(a),[fb]:a=>Br(a),[fb+Hb]:(a,b)=>zh(Br(a),a.getDay(),Cr(b)),[Hb]:(a,b)=>zh(1,a.getDay(),Cr(b))},hU={[kc]:a=>3*a,[fb]:(a,b)=>zh(a,0,Cr(b))};function jB(a,b){return iB(a,b||1,gU,hU,dU)}const iU={[xb]:a=>a.getUTCFullYear(),[kc]:a=>Math.floor(a.getUTCMonth()/3),[Gb]:a=>a.getUTCMonth(),[lc]:a=>a.getUTCDate(),[Dc]:a=>a.getUTCHours(),[Ec]:a=>a.getUTCMinutes(),[Pc]:a=>a.getUTCSeconds(),[id]:a=>a.getUTCMilliseconds(),[Hd]:a=>hB(a),[fb]:a=>Dr(a),[Hb]:(a,b)=>zh(1,a.getUTCDay(),Er(b)),[fb+Hb]:(a,b)=>zh(Dr(a),a.getUTCDay(),Er(b))},jU={[kc]:a=>3*a,[fb]:(a,b)=>zh(a,0,Er(b))};function kB(a,b){return iB(a,b||1,iU,jU,eU)}const kU={[xb]:$e,[kc]:wr.every(3),[Gb]:wr,[fb]:sm,[lc]:jg,[Hb]:jg,[Hd]:jg,[Dc]:$A,[Ec]:_A,[Pc]:rm,[id]:yh},lU={[xb]:af,[kc]:zr.every(3),[Gb]:zr,[fb]:tm,[lc]:lg,[Hb]:lg,[Hd]:lg,[Dc]:bB,[Ec]:aB,[Pc]:rm,[id]:yh};function Ah(a){return kU[a]}function Bh(a){return lU[a]}function lB(a,b,c){return a?a.offset(b,c):void 0}function mB(a,b,c){return lB(Ah(a),b,c)}function nB(a,b,c){return lB(Bh(a),b,c)}function oB(a,b,c,d){return a?a.range(b,c,d):void 0}function pB(a,b,c,d){return oB(Ah(a),b,c,d)}function qB(a,b,c,d){return oB(Bh(a),b,c,d)}const cj=1e3,dj=cj*60,ej=dj*60,um=ej*24,mU=um*7,rB=um*30,Fr=um*365,sB=[xb,Gb,lc,Dc,Ec,Pc,id],fj=sB.slice(0,-1),gj=fj.slice(0,-1),hj=gj.slice(0,-1),nU=hj.slice(0,-1),oU=[xb,fb],tB=[xb,Gb],uB=[xb],ij=[[fj,1,cj],[fj,5,5*cj],[fj,15,15*cj],[fj,30,30*cj],[gj,1,dj],[gj,5,5*dj],[gj,15,15*dj],[gj,30,30*dj],[hj,1,ej],[hj,3,3*ej],[hj,6,6*ej],[hj,12,12*ej],[nU,1,um],[oU,1,mU],[tB,1,rB],[tB,3,3*rB],[uB,1,Fr]];function vB(a){const b=a.extent,c=a.maxbins||40,d=Math.abs($l(b))/c;let e=im(h=>h[2]).right(ij,d),f,g;return e===ij.length?(f=uB,g=_e(b[0]/Fr,b[1]/Fr,c)):e?(e=ij[d/ij[e-1][2]<ij[e][2]/d?e-1:e],f=e[0],g=e[1]):(f=sB,g=Math.max(_e(b[0],b[1],c),1)),{units:f,step:g}}function Gr(a){if(0<=a.y&&a.y<100){var b=new Date(-1,a.m,a.d,a.H,a.M,a.S,a.L);return b.setFullYear(a.y),b}return new Date(a.y,a.m,a.d,a.H,a.M,a.S,a.L)}function Hr(a){if(0<=a.y&&a.y<100){var b=new Date(Date.UTC(-1,a.m,a.d,a.H,a.M,a.S,a.L));return b.setUTCFullYear(a.y),b}return new Date(Date.UTC(a.y,a.m,a.d,a.H,a.M,a.S,a.L))}function jj(a,b,c){return{y:a,m:b,d:c,H:0,M:0,S:0,L:0}}function wB(a){var b=a.dateTime,c=a.date,d=a.time,e=a.periods,f=a.days,g=a.shortDays,h=a.months,i=a.shortMonths,j=kj(e),k=lj(e),l=kj(f),m=lj(f),n=kj(g),o=lj(g),p=kj(h),q=lj(h),r=kj(i),s=lj(i),t={a:S,A:X,b:Y,B:wa,c:null,d:AB,e:AB,f:NU,H:KU,I:LU,j:MU,L:BB,m:OU,M:PU,p:Qa,q:tb,Q:FB,s:GB,S:QU,u:RU,U:SU,V:TU,w:UU,W:VU,x:null,X:null,y:WU,Y:XU,Z:YU,"%":EB},w={a:ub,A:bb,b:Rb,B:Dd,c:null,d:CB,e:CB,f:aV,H:ZU,I:_U,j:$U,L:DB,m:bV,M:cV,p:rh,q:Vf,Q:FB,s:GB,S:dV,u:eV,U:fV,V:gV,w:hV,W:iV,x:null,X:null,y:jV,Y:kV,Z:lV,"%":EB},v={a:B,A,b:C,B:F,c:K,d:yB,e:yB,f:GU,H:zB,I:zB,j:CU,L:FU,m:BU,M:DU,p:y,q:AU,Q:IU,s:JU,S:EU,u:tU,U:uU,V:vU,w:sU,W:wU,x:D,X:I,y:yU,Y:xU,Z:zU,"%":HU};t.x=x(c,t),t.X=x(d,t),t.c=x(b,t),w.x=x(c,w),w.X=x(d,w),w.c=x(b,w);function x(U,ja){return function(qa){var M=[],zc=-1,Ja=0,Nc=U.length,Oc,sh,MP;for(qa instanceof Date||(qa=new Date(+qa));++zc<Nc;)U.charCodeAt(zc)===37&&(M.push(U.slice(Ja,zc)),(sh=xB[Oc=U.charAt(++zc)])!=null?Oc=U.charAt(++zc):sh=Oc==="e"?" ":"0",(MP=ja[Oc])&&(Oc=MP(qa,sh)),M.push(Oc),Ja=zc+1);return M.push(U.slice(Ja,zc)),M.join("")}}function u(U,ja){return function(qa){var M=jj(1900,void 0,1),zc=z(M,U,qa+="",0),Ja,Nc;if(zc!=qa.length)return null;if("Q"in M)return new Date(M.Q);if("s"in M)return new Date(M.s*1e3+("L"in M?M.L:0));ja&&!("Z"in M)&&(M.Z=0),"p"in M&&(M.H=M.H%12+M.p*12),M.m===void 0&&(M.m="q"in M?M.q:0);if("V"in M){if(M.V<1||M.V>53)return null;"w"in M||(M.w=1),"Z"in M?(Ja=Hr(jj(M.y,0,1)),Nc=Ja.getUTCDay(),Ja=Nc>4||Nc===0?xr.ceil(Ja):xr(Ja),Ja=lg.offset(Ja,(M.V-1)*7),M.y=Ja.getUTCFullYear(),M.m=Ja.getUTCMonth(),M.d=Ja.getUTCDate()+(M.w+6)%7):(Ja=Gr(jj(M.y,0,1)),Nc=Ja.getDay(),Ja=Nc>4||Nc===0?ur.ceil(Ja):ur(Ja),Ja=jg.offset(Ja,(M.V-1)*7),M.y=Ja.getFullYear(),M.m=Ja.getMonth(),M.d=Ja.getDate()+(M.w+6)%7)}else("W"in M||"U"in M)&&("w"in M||(M.w="u"in M?M.u%7:"W"in M?1:0),Nc="Z"in M?Hr(jj(M.y,0,1)).getUTCDay():Gr(jj(M.y,0,1)).getDay(),M.m=0,M.d="W"in M?(M.w+6)%7+M.W*7-(Nc+5)%7:M.w+M.U*7-(Nc+6)%7);return"Z"in M?(M.H+=M.Z/100|0,M.M+=M.Z%100,Hr(M)):Gr(M)}}function z(U,ja,qa,M){for(var zc=0,Ja=ja.length,Nc=qa.length,Oc,sh;zc<Ja;){if(M>=Nc)return-1;Oc=ja.charCodeAt(zc++);if(Oc===37){Oc=ja.charAt(zc++),sh=v[Oc in xB?ja.charAt(zc++):Oc];if(!sh||(M=sh(U,qa,M))<0)return-1}else if(Oc!=qa.charCodeAt(M++))return-1}return M}function y(U,ja,qa){var M=j.exec(ja.slice(qa));return M?(U.p=k[M[0].toLowerCase()],qa+M[0].length):-1}function B(U,ja,qa){var M=n.exec(ja.slice(qa));return M?(U.w=o[M[0].toLowerCase()],qa+M[0].length):-1}function A(U,ja,qa){var M=l.exec(ja.slice(qa));return M?(U.w=m[M[0].toLowerCase()],qa+M[0].length):-1}function C(U,ja,qa){var M=r.exec(ja.slice(qa));return M?(U.m=s[M[0].toLowerCase()],qa+M[0].length):-1}function F(U,ja,qa){var M=p.exec(ja.slice(qa));return M?(U.m=q[M[0].toLowerCase()],qa+M[0].length):-1}function K(U,ja,qa){return z(U,b,ja,qa)}function D(U,ja,qa){return z(U,c,ja,qa)}function I(U,ja,qa){return z(U,d,ja,qa)}function S(U){return g[U.getDay()]}function X(U){return f[U.getDay()]}function Y(U){return i[U.getMonth()]}function wa(U){return h[U.getMonth()]}function Qa(U){return e[+(U.getHours()>=12)]}function tb(U){return 1+~~(U.getMonth()/3)}function ub(U){return g[U.getUTCDay()]}function bb(U){return f[U.getUTCDay()]}function Rb(U){return i[U.getUTCMonth()]}function Dd(U){return h[U.getUTCMonth()]}function rh(U){return e[+(U.getUTCHours()>=12)]}function Vf(U){return 1+~~(U.getUTCMonth()/3)}return{format:function(U){var ja=x(U+="",t);return ja.toString=function(){return U},ja},parse:function(U){var ja=u(U+="",!1);return ja.toString=function(){return U},ja},utcFormat:function(U){var ja=x(U+="",w);return ja.toString=function(){return U},ja},utcParse:function(U){var ja=u(U+="",!0);return ja.toString=function(){return U},ja}}}var xB={"-":"",_:" ","0":"0"},mb=/^\s*\d+/,pU=/^%/,qU=/[\\^$*+?|[\]().{}]/g;function Ca(a,b,c){var d=a<0?"-":"",e=(d?-a:a)+"",f=e.length;return d+(f<c?new Array(c-f+1).join(b)+e:e)}function rU(a){return a.replace(qU,"\\$&")}function kj(a){return new RegExp("^(?:"+a.map(rU).join("|")+")","i")}function lj(a){for(var b={},c=-1,d=a.length;++c<d;)b[a[c].toLowerCase()]=c;return b}function sU(a,b,c){var d=mb.exec(b.slice(c,c+1));return d?(a.w=+d[0],c+d[0].length):-1}function tU(a,b,c){var d=mb.exec(b.slice(c,c+1));return d?(a.u=+d[0],c+d[0].length):-1}function uU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.U=+d[0],c+d[0].length):-1}function vU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.V=+d[0],c+d[0].length):-1}function wU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.W=+d[0],c+d[0].length):-1}function xU(a,b,c){var d=mb.exec(b.slice(c,c+4));return d?(a.y=+d[0],c+d[0].length):-1}function yU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.y=+d[0]+(+d[0]>68?1900:2e3),c+d[0].length):-1}function zU(a,b,c){var d=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(b.slice(c,c+6));return d?(a.Z=d[1]?0:-(d[2]+(d[3]||"00")),c+d[0].length):-1}function AU(a,b,c){var d=mb.exec(b.slice(c,c+1));return d?(a.q=d[0]*3-3,c+d[0].length):-1}function BU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.m=d[0]-1,c+d[0].length):-1}function yB(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.d=+d[0],c+d[0].length):-1}function CU(a,b,c){var d=mb.exec(b.slice(c,c+3));return d?(a.m=0,a.d=+d[0],c+d[0].length):-1}function zB(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.H=+d[0],c+d[0].length):-1}function DU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.M=+d[0],c+d[0].length):-1}function EU(a,b,c){var d=mb.exec(b.slice(c,c+2));return d?(a.S=+d[0],c+d[0].length):-1}function FU(a,b,c){var d=mb.exec(b.slice(c,c+3));return d?(a.L=+d[0],c+d[0].length):-1}function GU(a,b,c){var d=mb.exec(b.slice(c,c+6));return d?(a.L=Math.floor(d[0]/1e3),c+d[0].length):-1}function HU(a,b,c){var d=pU.exec(b.slice(c,c+1));return d?c+d[0].length:-1}function IU(a,b,c){var d=mb.exec(b.slice(c));return d?(a.Q=+d[0],c+d[0].length):-1}function JU(a,b,c){var d=mb.exec(b.slice(c));return d?(a.s=+d[0],c+d[0].length):-1}function AB(a,b){return Ca(a.getDate(),b,2)}function KU(a,b){return Ca(a.getHours(),b,2)}function LU(a,b){return Ca(a.getHours()%12||12,b,2)}function MU(a,b){return Ca(1+jg.count($e(a),a),b,3)}function BB(a,b){return Ca(a.getMilliseconds(),b,3)}function NU(a,b){return BB(a,b)+"000"}function OU(a,b){return Ca(a.getMonth()+1,b,2)}function PU(a,b){return Ca(a.getMinutes(),b,2)}function QU(a,b){return Ca(a.getSeconds(),b,2)}function RU(a){var b=a.getDay();return b===0?7:b}function SU(a,b){return Ca(sm.count($e(a)-1,a),b,2)}function TU(a,b){var c=a.getDay();return a=c>=4||c===0?vr(a):vr.ceil(a),Ca(vr.count($e(a),a)+($e(a).getDay()===4),b,2)}function UU(a){return a.getDay()}function VU(a,b){return Ca(ur.count($e(a)-1,a),b,2)}function WU(a,b){return Ca(a.getFullYear()%100,b,2)}function XU(a,b){return Ca(a.getFullYear()%1e4,b,4)}function YU(a){var b=a.getTimezoneOffset();return(b>0?"-":(b*=-1,"+"))+Ca(b/60|0,"0",2)+Ca(b%60,"0",2)}function CB(a,b){return Ca(a.getUTCDate(),b,2)}function ZU(a,b){return Ca(a.getUTCHours(),b,2)}function _U(a,b){return Ca(a.getUTCHours()%12||12,b,2)}function $U(a,b){return Ca(1+lg.count(af(a),a),b,3)}function DB(a,b){return Ca(a.getUTCMilliseconds(),b,3)}function aV(a,b){return DB(a,b)+"000"}function bV(a,b){return Ca(a.getUTCMonth()+1,b,2)}function cV(a,b){return Ca(a.getUTCMinutes(),b,2)}function dV(a,b){return Ca(a.getUTCSeconds(),b,2)}function eV(a){var b=a.getUTCDay();return b===0?7:b}function fV(a,b){return Ca(tm.count(af(a)-1,a),b,2)}function gV(a,b){var c=a.getUTCDay();return a=c>=4||c===0?yr(a):yr.ceil(a),Ca(yr.count(af(a),a)+(af(a).getUTCDay()===4),b,2)}function hV(a){return a.getUTCDay()}function iV(a,b){return Ca(xr.count(af(a)-1,a),b,2)}function jV(a,b){return Ca(a.getUTCFullYear()%100,b,2)}function kV(a,b){return Ca(a.getUTCFullYear()%1e4,b,4)}function lV(){return"+0000"}function EB(){return"%"}function FB(a){return+a}function GB(a){return Math.floor(+a/1e3)}var Ch,Ir,HB,Jr,IB;mV({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function mV(a){return Ch=wB(a),Ir=Ch.format,HB=Ch.parse,Jr=Ch.utcFormat,IB=Ch.utcParse,Ch}function JB(a,b,c){c=c||{},Z(c)||H(`Invalid time multi-format specifier: ${c}`);const d=b(Pc),e=b(Ec),f=b(Dc),g=b(lc),h=b(fb),i=b(Gb),j=b(kc),k=b(xb),l=a(c[id]||".%L"),m=a(c[Pc]||":%S"),n=a(c[Ec]||"%I:%M"),o=a(c[Dc]||"%I %p"),p=a(c[lc]||c[Hb]||"%a %d"),q=a(c[fb]||"%b %d"),r=a(c[Gb]||"%B"),s=a(c[kc]||"%B"),t=a(c[xb]||"%Y");return w=>(d(w)<w?l:e(w)<w?m:f(w)<w?n:g(w)<w?o:i(w)<w?h(w)<w?p:q:k(w)<w?j(w)<w?r:s:t)(w)}function KB(a){const b=aj(a.format),c=aj(a.utcFormat);return{timeFormat:d=>V(d)?b(d):JB(b,Ah,d),utcFormat:d=>V(d)?c(d):JB(c,Bh,d),timeParse:aj(a.parse),utcParse:aj(a.utcParse)}}let Kr;LB();function LB(){return Kr=KB({format:Ir,parse:HB,utcFormat:Jr,utcParse:IB})}function MB(a){return KB(wB(a))}function mj(a){return arguments.length?Kr=MB(a):Kr}const Lr=(a,b)=>la({},a,b);function NB(a,b){const c=a?WA(a):om(),d=b?MB(b):mj();return Lr(c,d)}function Mr(a,b){const c=arguments.length;return c&&c!==2&&H("defaultLocale expects either zero or two arguments."),c?Lr(om(a),mj(b)):Lr(om(),mj())}function nV(){return VA(),LB(),Mr()}function OB(a,b,c,d){b=b||{};const e=gr(b.type||"json");return e||H("Unknown data format type: "+b.type),a=e(a,b),b.parse&&oV(a,b.parse,c,d),_(a,"columns")&&delete a.columns,a}function oV(a,b,c,d){if(!a.length)return;const e=mj();c=c||e.timeParse,d=d||e.utcParse;var f=a.columns||Object.keys(a[0]),g,h,i,j,k,l,m;for(b==="auto"&&(b=wA(a,f)),f=Object.keys(b),g=f.map(function(n){var o=b[n],p,q;if(o&&(o.startsWith("date:")||o.startsWith("utc:"))){p=o.split(/:(.+)?/,2),q=p[1],(q[0]==="'"&&q[q.length-1]==="'"||q[0]==='"'&&q[q.length-1]==='"')&&(q=q.slice(1,-1));const r=p[0]==="utc"?d:c;return r(q)}if(!ar[o])throw Error("Illegal format pattern: "+n+":"+o);return ar[o]}),j=0,l=a.length,m=f.length;j<l;++j)for(h=a[j],k=0;k<m;++k)i=f[k],h[i]=g[k](h[i])}var vm=mT(typeof fetch!=="undefined"&&fetch,null);function pV(a,b){const c=this.locale();return OB(a,b,c.timeParse,c.utcParse)}function qV(a,b,c){return b=this.parse(b,c),this.pulse(a,this.changeset().insert(b))}async function rV(a,b){const c=this;let d=0,e;try{e=await c.loader().load(a,{context:"dataflow",response:FA(b&&b.type)});try{e=c.parse(e,b)}catch(f){d=-2,c.warn("Data ingestion failed",a,f)}}catch(f){d=-1,c.warn("Loading failed",a,f)}return{data:e,status:d}}async function sV(a,b,c){const d=this,e=d._pending||tV(d);e.requests+=1;const f=await d.request(b,c);return d.pulse(a,d.changeset().remove(Gd).insert(f.data||[])),e.done(),f}function tV(a){var b=new Promise(function(d){c=d}),c;return b.requests=0,b.done=function(){--b.requests===0&&(a._pending=null,c(a))},a._pending=b}var uV={skip:!0};function vV(a,b,c,d,e){var f=a instanceof Ga?xV:wV;return f(this,a,b,c,d,e),this}function wV(a,b,c,d,e,f){var g=la({},f,uV),h,i;pa(c)||(c=Vb(c)),d===void 0?h=j=>a.touch(c(j)):pa(d)?(i=new Ga(null,d,e,!1),h=j=>{i.evaluate(j);const k=c(j),l=i.value;sA(l)?a.pulse(k,l,f):a.update(k,l,g)}):h=j=>a.update(c(j),d,g),b.apply(h)}function xV(a,b,c,d,e,f){if(d===void 0)b.targets().add(c);else{const g=f||{},h=new Ga(null,yV(c,d),e,!1);h.modified(g.force),h.rank=b.rank,b.targets().add(h),c&&(h.skip(!0),h.value=c.value,h.targets().add(c),a.connect(c,[h]))}}function yV(a,b){return b=pa(b)?b:Vb(b),a?function(c,d){const e=b(c,d);return a.skip()||(a.skip(e!==this.value).value=e),e}:b}function zV(a){a.rank=++this._rank}function AV(a){for(var b=[a],c,d,e;b.length;){this.rank(c=b.pop());if(d=c._targets)for(e=d.length;--e>=0;)b.push(c=d[e]),c===a&&H("Cycle detected in dataflow graph.")}}const wm={},Id=1<<0,bf=1<<1,re=1<<2,BV=Id|bf,PB=Id|re,Dh=Id|bf|re,QB=1<<3,nj=1<<4,RB=1<<5,SB=1<<6;function cf(a,b,c){this.dataflow=a,this.stamp=b==null?-1:b,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=c||null}const Ma=cf.prototype;Ma.StopPropagation=wm,Ma.ADD=Id,Ma.REM=bf,Ma.MOD=re,Ma.ADD_REM=BV,Ma.ADD_MOD=PB,Ma.ALL=Dh,Ma.REFLOW=QB,Ma.SOURCE=nj,Ma.NO_SOURCE=RB,Ma.NO_FIELDS=SB,Ma.fork=function(a){return new cf(this.dataflow).init(this,a)},Ma.clone=function(){const a=this.fork(Dh);return a.add=a.add.slice(),a.rem=a.rem.slice(),a.mod=a.mod.slice(),a.source&&(a.source=a.source.slice()),a.materialize(Dh|nj)},Ma.addAll=function(){let a=this;return!a.source||a.source.length===a.add.length?a:(a=new cf(this.dataflow).init(this),a.add=a.source,a)},Ma.init=function(a,b){const c=this;return c.stamp=a.stamp,c.encode=a.encode,a.fields&&!(b&SB)&&(c.fields=a.fields),b&Id?(c.addF=a.addF,c.add=a.add):(c.addF=null,c.add=[]),b&bf?(c.remF=a.remF,c.rem=a.rem):(c.remF=null,c.rem=[]),b&re?(c.modF=a.modF,c.mod=a.mod):(c.modF=null,c.mod=[]),b&RB?(c.srcF=null,c.source=null):(c.srcF=a.srcF,c.source=a.source,a.cleans&&(c.cleans=a.cleans)),c},Ma.runAfter=function(a){this.dataflow.runAfter(a)},Ma.changed=function(a){var b=a||Dh;return b&Id&&this.add.length||b&bf&&this.rem.length||b&re&&this.mod.length},Ma.reflow=function(a){if(a)return this.fork(Dh).reflow();var b=this.add.length,c=this.source&&this.source.length;return c&&c!==b&&(this.mod=this.source,b&&this.filter(re,TB(this,Id))),this},Ma.clean=function(a){return arguments.length?(this.cleans=!!a,this):this.cleans},Ma.modifies=function(a){var b=this.fields||(this.fields={});return J(a)?a.forEach(c=>b[c]=!0):b[a]=!0,this},Ma.modified=function(a,b){var c=this.fields;return(b||this.mod.length)&&c?arguments.length?J(a)?a.some(d=>c[d]):c[a]:!!c:!1},Ma.filter=function(a,b){var c=this;return a&Id&&(c.addF=xm(c.addF,b)),a&bf&&(c.remF=xm(c.remF,b)),a&re&&(c.modF=xm(c.modF,b)),a&nj&&(c.srcF=xm(c.srcF,b)),c};function xm(a,b){return a?(c,d)=>a(c,d)&&b(c,d):b}Ma.materialize=function(a){a=a||Dh;var b=this;return a&Id&&b.addF&&(b.add=Nr(b.add,b.addF),b.addF=null),a&bf&&b.remF&&(b.rem=Nr(b.rem,b.remF),b.remF=null),a&re&&b.modF&&(b.mod=Nr(b.mod,b.modF),b.modF=null),a&nj&&b.srcF&&(b.source=b.source.filter(b.srcF),b.srcF=null),b};function Nr(a,b){var c=[];return dg(a,b,d=>c.push(d)),c}function TB(a,b){var c={};return a.visit(b,function(d){c[aa(d)]=1}),d=>c[aa(d)]?null:d}Ma.visit=function(a,b){var c=this,d=b,e,f;return a&nj?(dg(c.source,c.srcF,d),c):(a&Id&&dg(c.add,c.addF,d),a&bf&&dg(c.rem,c.remF,d),a&re&&dg(c.mod,c.modF,d),a&QB&&(e=c.source)&&(f=c.add.length+c.mod.length,f===e.length||(f?dg(e,TB(c,PB),d):dg(e,c.srcF,d))),c)};function Or(a,b,c,d){var e=this,f=0,g,h,i,j,k;for(this.dataflow=a,this.stamp=b,this.fields=null,this.encode=d||null,this.pulses=c,i=0,j=c.length;i<j;++i){g=c[i];if(g.stamp!==b)continue;if(g.fields){h=e.fields||(e.fields={});for(k in g.fields)h[k]=1}g.changed(e.ADD)&&(f|=e.ADD),g.changed(e.REM)&&(f|=e.REM),g.changed(e.MOD)&&(f|=e.MOD)}this.changes=f}var Eh=N(Or,cf);Eh.fork=function(a){var b=new cf(this.dataflow).init(this,a&this.NO_FIELDS);return a!==void 0&&(a&b.ADD&&this.visit(b.ADD,function(c){return b.add.push(c)}),a&b.REM&&this.visit(b.REM,function(c){return b.rem.push(c)}),a&b.MOD&&this.visit(b.MOD,function(c){return b.mod.push(c)})),b},Eh.changed=function(a){return this.changes&a},Eh.modified=function(a){var b=this,c=b.fields;return c&&b.changes&b.MOD?J(a)?a.some(function(d){return c[d]}):c[a]:0},Eh.filter=function(){H("MultiPulse does not support filtering.")},Eh.materialize=function(){H("MultiPulse does not support materialization.")},Eh.visit=function(a,b){var c=this,d=c.pulses,e=d.length,f=0;if(a&c.SOURCE)for(;f<e;++f)d[f].visit(a,b);else for(;f<e;++f)d[f].stamp===c.stamp&&d[f].visit(a,b);return c};async function CV(a,b,c){const d=this,e=[];if(d._pulse)return UB(d);d._pending&&await d._pending,b&&await bm(d,b);if(!d._touched.length)return d.debug("Dataflow invoked, but nothing to do."),d;const f=++d._clock;d._pulse=new cf(d,f,a),d._touched.forEach(k=>d._enqueue(k,!0)),d._touched=am(Ul);let g=0,h,i,j;try{for(;d._heap.size()>0;){h=d._heap.pop();if(h.rank!==h.qrank){d._enqueue(h,!0);continue}i=h.run(d._getPulse(h,a)),i.then?i=await i:i.async&&(e.push(i.async),i=wm),i!==wm&&(h._targets&&h._targets.forEach(k=>d._enqueue(k))),++g}}catch(k){d._heap.clear(),j=k}d._input={},d._pulse=null,d.debug(`Pulse ${f}: ${g} operators`),j&&(d._postrun=[],d.error(j));if(d._postrun.length){const k=d._postrun.sort((l,m)=>m.priority-l.priority);d._postrun=[];for(let l=0;l<k.length;++l)await bm(d,k[l].callback)}return c&&await bm(d,c),e.length&&Promise.all(e).then(k=>d.runAsync(null,()=>{k.forEach(l=>{try{l(d)}catch(m){d.error(m)}})})),d}async function DV(a,b,c){for(;this._running;)await this._running;const d=()=>this._running=null;return(this._running=this.evaluate(a,b,c)).then(d,d),this._running}function EV(a,b,c){return this._pulse?UB(this):(this.evaluate(a,b,c),this)}function FV(a,b,c){if(this._pulse||b)this._postrun.push({priority:c||0,callback:a});else try{a(this)}catch(d){this.error(d)}}function UB(a){return a.error("Dataflow already running. Use runAsync() to chain invocations."),a}function GV(a,b){var c=a.stamp<this._clock;c&&(a.stamp=this._clock),(c||b)&&(a.qrank=a.rank,this._heap.push(a))}function HV(a,b){var c=a.source,d=this._clock;return c&&J(c)?new Or(this,d,c.map(e=>e.pulse),b):this._input[a.id]||IV(this._pulse,c&&c.pulse)}function IV(a,b){return b&&b.stamp===a.stamp?b:(a=a.fork(),b&&b!==wm&&(a.source=b.source),a)}var Pr={skip:!1,force:!1};function JV(a,b){var c=b||Pr;return this._pulse?this._enqueue(a):this._touched.add(a),c.skip&&a.skip(!0),this}function KV(a,b,c){var d=c||Pr;return(a.set(b)||d.force)&&this.touch(a,d),this}function LV(a,b,c){this.touch(a,c||Pr);var d=new cf(this,this._clock+(this._pulse?0:1)),e=a.pulse&&a.pulse.source||[];return d.target=a,this._input[a.id]=b.pulse(d,e),this}function MV(a){var b=[];return{clear:()=>b=[],size:()=>b.length,peek:()=>b[0],push:c=>(b.push(c),VB(b,0,b.length-1,a)),pop:()=>{var c=b.pop(),d;return b.length?(d=b[0],b[0]=c,NV(b,0,a)):d=c,d}}}function VB(a,b,c,d){var e,f,g;for(e=a[c];c>b;){g=c-1>>1,f=a[g];if(d(e,f)<0){a[c]=f,c=g;continue}break}return a[c]=e}function NV(a,b,c){for(var d=b,e=a.length,f=a[b],g=(b<<1)+1,h;g<e;)h=g+1,h<e&&c(a[g],a[h])>=0&&(g=h),a[b]=a[g],b=g,g=(b<<1)+1;return a[b]=f,VB(a,d,b,c)}function Fh(){this.logger($z()),this.logLevel(Zz),this._clock=0,this._rank=0,this._locale=Mr();try{this._loader=vm()}catch(a){}this._touched=am(Ul),this._input={},this._pulse=null,this._heap=MV((a,b)=>a.qrank-b.qrank),this._postrun=[]}var za=Fh.prototype;za.stamp=function(){return this._clock},za.loader=function(a){return arguments.length?(this._loader=a,this):this._loader},za.locale=function(a){return arguments.length?(this._locale=a,this):this._locale},za.cleanThreshold=1e4,za.add=fT,za.connect=gT,za.rank=zV,za.rerank=AV,za.pulse=LV,za.touch=JV,za.update=KV,za.changeset=fg,za.ingest=qV,za.parse=pV,za.preload=sV,za.request=rV,za.events=iT,za.on=vV,za.evaluate=CV,za.run=EV,za.runAsync=DV,za.runAfter=FV,za._enqueue=GV,za._getPulse=HV;function oj(a){return function(){return this._log[a].apply(this,arguments)}}za.logger=function(a){return arguments.length?(this._log=a,this):this._log},za.error=oj("error"),za.warn=oj("warn"),za.info=oj("info"),za.debug=oj("debug"),za.logLevel=oj("level");function E(a,b){Ga.call(this,a,null,b)}var Qr=N(E,Ga);Qr.run=function(a){if(a.stamp<this.stamp)return a.StopPropagation;var b;return this.skip()?this.skip(!1):b=this.evaluate(a),b=b||a,b.then?b=b.then(c=>this.pulse=c):b!==a.StopPropagation&&(this.pulse=b),b},Qr.evaluate=function(a){var b=this.marshall(a.stamp),c=this.transform(b,a);return b.clear(),c},Qr.transform=function(){};var Gh={};function WB(a){var b=XB(a);return b&&b.Definition||null}function XB(a){return a=a&&a.toLowerCase(),_(Gh,a)?Gh[a]:null}function OV(a){return function(b){for(var c=a.length,d=1,e=String(a[0](b));d<c;++d)e+="|"+a[d](b);return e}}function Rr(a){return!a||!a.length?function(){return""}:a.length===1?a[0]:OV(a)}function YB(a,b,c){return c||a+(b?"_"+b:"")}const Sr=()=>{},PV={init:Sr,add:Sr,rem:Sr,idx:0},pj={values:{init:a=>a.cell.store=!0,value:a=>a.cell.data.values(),idx:-1},count:{value:a=>a.cell.num},__count__:{value:a=>a.missing+a.valid},missing:{value:a=>a.missing},valid:{value:a=>a.valid},sum:{init:a=>a.sum=0,value:a=>a.sum,add:(a,b)=>a.sum+=+b,rem:(a,b)=>a.sum-=b},product:{init:a=>a.product=1,value:a=>a.valid?a.product:void 0,add:(a,b)=>a.product*=b,rem:(a,b)=>a.product/=b},mean:{init:a=>a.mean=0,value:a=>a.valid?a.mean:void 0,add:(a,b)=>(a.mean_d=b-a.mean,a.mean+=a.mean_d/a.valid),rem:(a,b)=>(a.mean_d=b-a.mean,a.mean-=a.valid?a.mean_d/a.valid:a.mean)},average:{value:a=>a.valid?a.mean:void 0,req:["mean"],idx:1},variance:{init:a=>a.dev=0,value:a=>a.valid>1?a.dev/(a.valid-1):void 0,add:(a,b)=>a.dev+=a.mean_d*(b-a.mean),rem:(a,b)=>a.dev-=a.mean_d*(b-a.mean),req:["mean"],idx:1},variancep:{value:a=>a.valid>1?a.dev/a.valid:void 0,req:["variance"],idx:2},stdev:{value:a=>a.valid>1?Math.sqrt(a.dev/(a.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:a=>a.valid>1?Math.sqrt(a.dev/a.valid):void 0,req:["variance"],idx:2},stderr:{value:a=>a.valid>1?Math.sqrt(a.dev/(a.valid*(a.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:a=>a.cell.data.distinct(a.get),req:["values"],idx:3},ci0:{value:a=>a.cell.data.ci0(a.get),req:["values"],idx:3},ci1:{value:a=>a.cell.data.ci1(a.get),req:["values"],idx:3},median:{value:a=>a.cell.data.q2(a.get),req:["values"],idx:3},q1:{value:a=>a.cell.data.q1(a.get),req:["values"],idx:3},q3:{value:a=>a.cell.data.q3(a.get),req:["values"],idx:3},min:{init:a=>a.min=void 0,value:a=>a.min=Number.isNaN(a.min)?a.cell.data.min(a.get):a.min,add:(a,b)=>{(b<a.min||a.min===void 0)&&(a.min=b)},rem:(a,b)=>{b<=a.min&&(a.min=NaN)},req:["values"],idx:4},max:{init:a=>a.max=void 0,value:a=>a.max=Number.isNaN(a.max)?a.cell.data.max(a.get):a.max,add:(a,b)=>{(b>a.max||a.max===void 0)&&(a.max=b)},rem:(a,b)=>{b>=a.max&&(a.max=NaN)},req:["values"],idx:4},argmin:{init:a=>a.argmin=void 0,value:a=>a.argmin||a.cell.data.argmin(a.get),add:(a,b,c)=>{b<a.min&&(a.argmin=c)},rem:(a,b)=>{b<=a.min&&(a.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:a=>a.argmax=void 0,value:a=>a.argmax||a.cell.data.argmax(a.get),add:(a,b,c)=>{b>a.max&&(a.argmax=c)},rem:(a,b)=>{b>=a.max&&(a.argmax=void 0)},req:["max","values"],idx:3}},qj=Object.keys(pj);function QV(a,b){return c=>la({name:a,out:c||a},PV,b)}qj.forEach(a=>{pj[a]=QV(a,pj[a])});function ZB(a,b){return pj[a](b)}function _B(a,b){return a.idx-b.idx}function RV(a){const b={};a.forEach(d=>b[d.name]=d);const c=d=>{if(!d.req)return;d.req.forEach(e=>{b[e]||c(b[e]=pj[e]())})};return a.forEach(c),Object.values(b).sort(_B)}function SV(){this.valid=0,this.missing=0,this._ops.forEach(a=>a.init(this))}function TV(a,b){if(a==null||a===""){++this.missing;return}if(a!==a)return;++this.valid,this._ops.forEach(c=>c.add(this,a,b))}function UV(a,b){if(a==null||a===""){--this.missing;return}if(a!==a)return;--this.valid,this._ops.forEach(c=>c.rem(this,a,b))}function VV(a){return this._out.forEach(b=>a[b.out]=b.value(this)),a}function $B(a,b){var c=b||Ub,d=RV(a),e=a.slice().sort(_B);function f(g){this._ops=d,this._out=e,this.cell=g,this.init()}return f.prototype.init=SV,f.prototype.add=TV,f.prototype.rem=UV,f.prototype.set=VV,f.prototype.get=c,f.fields=a.map(g=>g.out),f}function*aC(a,b){if(b==null)for(let c of a)c!=null&&c!==""&&(c=+c)>=c&&(yield c);else{let c=-1;for(let d of a)d=b(d,++c,a),d!=null&&d!==""&&(d=+d)>=d&&(yield d)}}function Tr(a,b,c){var d=Float64Array.from(aC(a,c));return d.sort(vh),b.map(e=>TT(d,e))}function Ur(a,b){return Tr(a,[.25,.5,.75],b)}function Vr(a,b){var c=a.length,d=QT(a,b),e=Ur(a,b),f=(e[2]-e[0])/1.34;return d=Math.min(d,f)||d||Math.abs(e[0])||1,1.06*d*Math.pow(c,-.2)}function bC(a){var b=a.maxbins||20,c=a.base||10,d=Math.log(c),e=a.divide||[5,2],f=a.extent[0],g=a.extent[1],h=a.span||g-f||Math.abs(f)||1,i,j,k,l,m,n,o,p;if(a.step)i=a.step;else if(a.steps){for(m=h/b,n=0,o=a.steps.length;n<o&&a.steps[n]<m;++n);i=a.steps[Math.max(0,n-1)]}else{for(j=Math.ceil(Math.log(b)/d),k=a.minstep||0,i=Math.max(k,Math.pow(c,Math.round(Math.log(h)/d)-j));Math.ceil(h/i)>b;)i*=c;for(n=0,o=e.length;n<o;++n)m=i/e[n],m>=k&&h/m<=b&&(i=m)}return m=Math.log(i),l=m>=0?0:~~(-m/d)+1,p=Math.pow(c,-l-1),(a.nice||a.nice===void 0)&&(m=Math.floor(f/i+p)*i,f=f<m?m-i:m,g=Math.ceil(g/i)*i),{start:f,stop:g===f?f+i:g,step:i}}var Qc=Math.random;function WV(a){Qc=a}function cC(a,b,c,d){if(!a.length)return[void 0,void 0];var e=Float64Array.from(aC(a,d)),f=e.length,g=b,h,i,j,k;for(j=0,k=Array(g);j<g;++j){for(h=0,i=0;i<f;++i)h+=e[~~(Qc()*f)];k[j]=h/f}return k.sort(vh),[km(k,c/2),km(k,1-c/2)]}function dC(a,b,c,d){d=d||(m=>m);let e=0,f=1,g=a.length,h=new Float64Array(g),i=d(a[0]),j=i,k=i+b,l;for(;f<g;++f){l=d(a[f]);if(l>=k){for(j=(i+j)/2;e<f;++e)h[e]=j;k=l+b,i=l}j=l}for(j=(i+j)/2;e<f;++e)h[e]=j;return c?XV(h,b+b/4):h}function XV(a,b){let c=a.length,d=0,e=1,f,g;for(;a[d]===a[e];)++e;for(;e<c;){for(f=e+1;a[e]===a[f];)++f;if(a[e]-a[e-1]<b){for(g=e+(d+f-e-e>>1);g<e;)a[g++]=a[e];for(;g>e;)a[g--]=a[d]}d=e,e=f}return a}function YV(a){return function(){return a=(1103515245*a+12345)%2147483647,a/2147483647}}function ZV(a,b){b==null&&(b=a,a=0);var c={},d,e,f;return c.min=function(g){return arguments.length?(d=g||0,f=e-d,c):d},c.max=function(g){return arguments.length?(e=g||0,f=e-d,c):e},c.sample=function(){return d+Math.floor(f*Qc())},c.pdf=function(g){return g===Math.floor(g)&&g>=d&&g<e?1/f:0},c.cdf=function(g){var h=Math.floor(g);return h<d?0:h>=e?1:(h-d+1)/f},c.icdf=function(g){return g>=0&&g<=1?d-1+Math.floor(g*f):NaN},c.min(a).max(b)}const eC=Math.sqrt(2*Math.PI),_V=Math.SQRT2;let rj=NaN;function ym(a,b){a=a||0,b=b==null?1:b;let c=0,d=0,e,f;if(rj===rj)c=rj,rj=NaN;else{do c=Qc()*2-1,d=Qc()*2-1,e=c*c+d*d;while(e===0||e>1);f=Math.sqrt(-2*Math.log(e)/e),c*=f,rj=d*f}return a+c*b}function Wr(a,b,c){c=c==null?1:c;const d=(a-(b||0))/c;return Math.exp(-.5*d*d)/(c*eC)}function zm(a,b,c){b=b||0,c=c==null?1:c;let d,e=(a-b)/c,f=Math.abs(e);if(f>37)d=0;else{let g,h=Math.exp(-f*f/2);f<7.07106781186547?(g=.0352624965998911*f+.700383064443688,g=g*f+6.37396220353165,g=g*f+33.912866078383,g=g*f+112.079291497871,g=g*f+221.213596169931,g=g*f+220.206867912376,d=h*g,g=.0883883476483184*f+1.75566716318264,g=g*f+16.064177579207,g=g*f+86.7807322029461,g=g*f+296.564248779674,g=g*f+637.333633378831,g=g*f+793.826512519948,g=g*f+440.413735824752,d=d/g):(g=f+.65,g=f+4/g,g=f+3/g,g=f+2/g,g=f+1/g,d=h/g/2.506628274631)}return e>0?1-d:d}function Am(a,b,c){return a<0||a>1?NaN:(b||0)+(c==null?1:c)*_V*$V(2*a-1)}function $V(a){let b=-Math.log((1-a)*(1+a)),c;return b<6.25?(b-=3.125,c=-364441206401782e-35,c=-16850591381820166e-35+c*b,c=128584807152564e-32+c*b,c=11157877678025181e-33+c*b,c=-1333171662854621e-31+c*b,c=20972767875968562e-33+c*b,c=6637638134358324e-30+c*b,c=-4054566272975207e-29+c*b,c=-8151934197605472e-29+c*b,c=26335093153082323e-28+c*b,c=-12975133253453532e-27+c*b,c=-5415412054294628e-26+c*b,c=10512122733215323e-25+c*b,c=-4112633980346984e-24+c*b,c=-29070369957882005e-24+c*b,c=42347877827932404e-23+c*b,c=-13654692000834679e-22+c*b,c=-13882523362786469e-21+c*b,c=.00018673420803405714+c*b,c=-.000740702534166267+c*b,c=-.006033670871430149+c*b,c=.24015818242558962+c*b,c=1.6536545626831027+c*b):b<16?(b=Math.sqrt(b)-3.25,c=22137376921775787e-25,c=9075656193888539e-23+c*b,c=-27517406297064545e-23+c*b,c=18239629214389228e-24+c*b,c=15027403968909828e-22+c*b,c=-4013867526981546e-21+c*b,c=29234449089955446e-22+c*b,c=12475304481671779e-21+c*b,c=-47318229009055734e-21+c*b,c=6828485145957318e-20+c*b,c=24031110387097894e-21+c*b,c=-.0003550375203628475+c*b,c=.0009532893797373805+c*b,c=-.0016882755560235047+c*b,c=.002491442096107851+c*b,c=-.003751208507569241+c*b,c=.005370914553590064+c*b,c=1.0052589676941592+c*b,c=3.0838856104922208+c*b):Number.isFinite(b)?(b=Math.sqrt(b)-5,c=-27109920616438573e-27,c=-2555641816996525e-25+c*b,c=15076572693500548e-25+c*b,c=-3789465440126737e-24+c*b,c=761570120807834e-23+c*b,c=-1496002662714924e-23+c*b,c=2914795345090108e-23+c*b,c=-6771199775845234e-23+c*b,c=22900482228026655e-23+c*b,c=-99298272942317e-20+c*b,c=4526062597223154e-21+c*b,c=-1968177810553167e-20+c*b,c=7599527703001776e-20+c*b,c=-.00021503011930044477+c*b,c=-.00013871931833623122+c*b,c=1.0103004648645344+c*b,c=4.849906401408584+c*b):c=Infinity,c*a}function Xr(a,b){var c,d,e={mean:function(f){return arguments.length?(c=f||0,e):c},stdev:function(f){return arguments.length?(d=f==null?1:f,e):d},sample:()=>ym(c,d),pdf:f=>Wr(f,c,d),cdf:f=>zm(f,c,d),icdf:f=>Am(f,c,d)};return e.mean(a).stdev(b)}function Yr(a,b){var c=Xr(),d={},e=0;return d.data=function(f){return arguments.length?(a=f,e=f?f.length:0,d.bandwidth(b)):a},d.bandwidth=function(f){return arguments.length?(b=f,!b&&a&&(b=Vr(a)),d):b},d.sample=function(){return a[~~(Qc()*e)]+b*c.sample()},d.pdf=function(f){for(var g=0,h=0;h<e;++h)g+=c.pdf((f-a[h])/b);return g/b/e},d.cdf=function(f){for(var g=0,h=0;h<e;++h)g+=c.cdf((f-a[h])/b);return g/e},d.icdf=function(){throw Error("KDE icdf not supported.")},d.data(a)}function Zr(a,b){return a=a||0,b=b==null?1:b,Math.exp(a+ym()*b)}function _r(a,b,c){if(a<=0)return 0;b=b||0,c=c==null?1:c;const d=(Math.log(a)-b)/c;return Math.exp(-.5*d*d)/(c*eC*a)}function $r(a,b,c){return zm(Math.log(a),b,c)}function as(a,b,c){return Math.exp(Am(a,b,c))}function fC(a,b){var c,d,e={mean:function(f){return arguments.length?(c=f||0,e):c},stdev:function(f){return arguments.length?(d=f==null?1:f,e):d},sample:()=>Zr(c,d),pdf:f=>_r(f,c,d),cdf:f=>$r(f,c,d),icdf:f=>as(f,c,d)};return e.mean(a).stdev(b)}function gC(a,b){var c={},d=0,e;function f(g){var h=[],i=0,j;for(j=0;j<d;++j)i+=h[j]=g[j]==null?1:+g[j];for(j=0;j<d;++j)h[j]/=i;return h}return c.weights=function(g){return arguments.length?(e=f(b=g||[]),c):b},c.distributions=function(g){return arguments.length?(g?(d=g.length,a=g):(d=0,a=[]),c.weights(b)):a},c.sample=function(){for(var g=Qc(),h=a[d-1],i=e[0],j=0;j<d-1;i+=e[++j])if(g<i){h=a[j];break}return h.sample()},c.pdf=function(g){for(var h=0,i=0;i<d;++i)h+=e[i]*a[i].pdf(g);return h},c.cdf=function(g){for(var h=0,i=0;i<d;++i)h+=e[i]*a[i].cdf(g);return h},c.icdf=function(){throw Error("Mixture icdf not supported.")},c.distributions(a).weights(b)}function bs(a,b){return b==null&&(b=a==null?1:a,a=0),a+(b-a)*Qc()}function cs(a,b,c){return c==null&&(c=b==null?1:b,b=0),a>=b&&a<=c?1/(c-b):0}function ds(a,b,c){return c==null&&(c=b==null?1:b,b=0),a<b?0:a>c?1:(a-b)/(c-b)}function es(a,b,c){return c==null&&(c=b==null?1:b,b=0),a>=0&&a<=1?b+a*(c-b):NaN}function hC(a,b){var c,d,e={min:function(f){return arguments.length?(c=f||0,e):c},max:function(f){return arguments.length?(d=f==null?1:f,e):d},sample:()=>bs(c,d),pdf:f=>cs(f,c,d),cdf:f=>ds(f,c,d),icdf:f=>es(f,c,d)};return b==null&&(b=a==null?1:a,a=0),e.min(a).max(b)}function sj(a,b,c,d){const e=d-a*a,f=Math.abs(e)<1e-24?0:(c-a*b)/e,g=b-f*a;return[g,f]}function Bm(a,b,c,d){a=a.filter(n=>{let o=b(n),p=c(n);return o!=null&&(o=+o)>=o&&p!=null&&(p=+p)>=p}),d&&a.sort((n,o)=>b(n)-b(o));const e=a.length,f=new Float64Array(e),g=new Float64Array(e);let h=0,i=0,j=0,k,l,m;for(m of a)f[h]=k=+b(m),g[h]=l=+c(m),++h,i+=(k-i)/h,j+=(l-j)/h;for(h=0;h<e;++h)f[h]-=i,g[h]-=j;return[f,g,i,j]}function tj(a,b,c,d){let e=-1,f,g;for(let h of a)f=b(h),g=c(h),f!=null&&(f=+f)>=f&&g!=null&&(g=+g)>=g&&d(f,g,++e)}function Hh(a,b,c,d,e){let f=0,g=0;return tj(a,b,c,(h,i)=>{const j=i-e(h),k=i-d;f+=j*j,g+=k*k}),1-f/g}function fs(a,b,c){let d=0,e=0,f=0,g=0,h=0;tj(a,b,c,(k,l)=>{++h,d+=(k-d)/h,e+=(l-e)/h,f+=(k*l-f)/h,g+=(k*k-g)/h});const i=sj(d,e,f,g),j=k=>i[0]+i[1]*k;return{coef:i,predict:j,rSquared:Hh(a,b,c,e,j)}}function iC(a,b,c){let d=0,e=0,f=0,g=0,h=0;tj(a,b,c,(k,l)=>{++h,k=Math.log(k),d+=(k-d)/h,e+=(l-e)/h,f+=(k*l-f)/h,g+=(k*k-g)/h});const i=sj(d,e,f,g),j=k=>i[0]+i[1]*Math.log(k);return{coef:i,predict:j,rSquared:Hh(a,b,c,e,j)}}function jC(a,b,c){const[d,e,f,g]=Bm(a,b,c);let h=0,i=0,j=0,k=0,l=0,m,n,o;tj(a,b,c,(s,t)=>{m=d[l++],n=Math.log(t),o=m*t,h+=(t*n-h)/l,i+=(o-i)/l,j+=(o*n-j)/l,k+=(m*o-k)/l});const[p,q]=sj(i/g,h/g,j/g,k/g),r=s=>Math.exp(p+q*(s-f));return{coef:[Math.exp(p-q*f),q],predict:r,rSquared:Hh(a,b,c,g,r)}}function kC(a,b,c){let d=0,e=0,f=0,g=0,h=0,i=0;tj(a,b,c,(l,m)=>{const n=Math.log(l),o=Math.log(m);++i,d+=(n-d)/i,e+=(o-e)/i,f+=(n*o-f)/i,g+=(n*n-g)/i,h+=(m-h)/i});const j=sj(d,e,f,g),k=l=>j[0]*Math.pow(l,j[1]);return j[0]=Math.exp(j[0]),{coef:j,predict:k,rSquared:Hh(a,b,c,h,k)}}function gs(a,b,c){const[d,e,f,g]=Bm(a,b,c),h=d.length;let i=0,j=0,k=0,l=0,m=0,n,o,p,q;for(n=0;n<h;)o=d[n],p=e[n++],q=o*o,i+=(q-i)/n,j+=(q*o-j)/n,k+=(q*q-k)/n,l+=(o*p-l)/n,m+=(q*p-m)/n;const r=k-i*i,s=i*r-j*j,t=(m*i-l*j)/s,w=(l*r-m*j)/s,v=-t*i,x=u=>(u=u-f,t*u*u+w*u+v+g);return{coef:[v-w*f+t*f*f+g,w-2*t*f,t],predict:x,rSquared:Hh(a,b,c,g,x)}}function lC(a,b,c,d){if(d===1)return fs(a,b,c);if(d===2)return gs(a,b,c);const[e,f,g,h]=Bm(a,b,c),i=e.length,j=[],k=[],l=d+1;let m,n,o,p,q;for(m=0;m<l;++m){for(o=0,p=0;o<i;++o)p+=Math.pow(e[o],m)*f[o];for(j.push(p),q=new Float64Array(l),n=0;n<l;++n){for(o=0,p=0;o<i;++o)p+=Math.pow(e[o],m+n);q[n]=p}k.push(q)}k.push(j);const r=bW(k),s=t=>{t-=g;let w=h+r[0]+r[1]*t+r[2]*t*t;for(m=3;m<l;++m)w+=r[m]*Math.pow(t,m);return w};return{coef:aW(l,r,-g,h),predict:s,rSquared:Hh(a,b,c,h,s)}}function aW(a,b,c,d){const e=Array(a);let f,g,h,i;for(f=0;f<a;++f)e[f]=0;for(f=a-1;f>=0;--f)for(h=b[f],i=1,e[f]+=h,g=1;g<=f;++g)i*=(f+1-g)/g,e[f-g]+=h*Math.pow(c,g)*i;return e[0]+=d,e}function bW(a){const b=a.length-1,c=[];let d,e,f,g,h;for(d=0;d<b;++d){for(g=d,e=d+1;e<b;++e)Math.abs(a[d][e])>Math.abs(a[d][g])&&(g=e);for(f=d;f<b+1;++f)h=a[f][d],a[f][d]=a[f][g],a[f][g]=h;for(e=d+1;e<b;++e)for(f=b;f>=d;f--)a[f][e]-=a[f][d]*a[d][e]/a[d][d]}for(e=b-1;e>=0;--e){for(h=0,f=e+1;f<b;++f)h+=a[f][e]*c[f];c[e]=(a[b][e]-h)/a[e][e]}return c}const mC=2,nC=1e-12;function oC(a,b,c,d){const[e,f,g,h]=Bm(a,b,c,!0),i=e.length,j=Math.max(2,~~(d*i)),k=new Float64Array(i),l=new Float64Array(i),m=new Float64Array(i).fill(1);for(let n=-1;++n<=mC;){const o=[0,j-1];for(let q=0;q<i;++q){const r=e[q],s=o[0],t=o[1],w=r-e[s]>e[t]-r?s:t;let v=0,x=0,u=0,z=0,y=0,B=1/Math.abs(e[w]-r||1);for(let F=s;F<=t;++F){const K=e[F],D=f[F],I=cW(Math.abs(r-K)*B)*m[F],S=K*I;v+=I,x+=S,u+=D*I,z+=D*S,y+=K*S}const[A,C]=sj(x/v,u/v,z/v,y/v);k[q]=A+C*r,l[q]=Math.abs(f[q]-k[q]),dW(e,q+1,o)}if(n===mC)break;const p=IA(l);if(Math.abs(p)<nC)break;for(let q=0,r,s;q<i;++q)r=l[q]/(6*p),m[q]=r>=1?nC:(s=1-r*r)*s}return eW(e,k,g,h)}function cW(a){return(a=1-a*a*a)*a*a}function dW(a,b,c){let d=a[b],e=c[0],f=c[1]+1;if(f>=a.length)return;for(;b>e&&a[f]-d<=d-a[e];)c[0]=++e,c[1]=f,++f}function eW(a,b,c,d){const e=a.length,f=[];let g=0,h=0,i=[],j;for(;g<e;++g)j=a[g]+c,i[0]===j?i[1]+=(b[g]-i[1])/++h:(h=0,i[1]+=d,i=[j,b[g]],f.push(i));return i[1]+=d,f}const fW=.1*Math.PI/180;function Cm(a,b,c,d){c=c||25,d=Math.max(c,d||200);const e=n=>[n,a(n)],f=b[0],g=b[1],h=g-f,i=h/d,j=[e(f)],k=[];if(c===d){for(let n=1;n<d;++n)j.push(e(f+n/c*h));return j.push(e(g)),j}else{k.push(e(g));for(let n=c;--n>0;)k.push(e(f+n/c*h))}let l=j[0],m=k[k.length-1];for(;m;){const n=e((l[0]+m[0])/2);n[0]-l[0]>=i&&gW(l,n,m)>fW?k.push(n):(l=m,j.push(m),k.pop()),m=k[k.length-1]}return j}function gW(a,b,c){const d=Math.atan2(c[1]-a[1],c[0]-a[0]),e=Math.atan2(b[1]-a[1],b[0]-a[0]);return Math.abs(d-e)}function hs(a){this._key=a?Fd(a):aa,this.reset()}var yb=hs.prototype;yb.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},yb.add=function(a){this._add.push(a)},yb.rem=function(a){this._rem.push(a)},yb.values=function(){this._get=null;if(this._rem.length===0)return this._add;var a=this._add,b=this._rem,c=this._key,d=a.length,e=b.length,f=Array(d-e),g={},h,i,j;for(h=0;h<e;++h)g[c(b[h])]=1;for(h=0,i=0;h<d;++h)g[c(j=a[h])]?g[c(j)]=0:f[i++]=j;return this._rem=[],this._add=f},yb.distinct=function(a){for(var b=this.values(),c=b.length,d={},e=0,f;--c>=0;)f=a(b[c])+"",_(d,f)||(d[f]=1,++e);return e},yb.extent=function(a){if(this._get!==a||!this._ext){var b=this.values(),c=QS(b,a);this._ext=[b[c[0]],b[c[1]]],this._get=a}return this._ext},yb.argmin=function(a){return this.extent(a)[0]||{}},yb.argmax=function(a){return this.extent(a)[1]||{}},yb.min=function(a){var b=this.extent(a)[0];return b!=null?a(b):void 0},yb.max=function(a){var b=this.extent(a)[1];return b!=null?a(b):void 0},yb.quartile=function(a){return(this._get!==a||!this._q)&&(this._q=Ur(this.values(),a),this._get=a),this._q},yb.q1=function(a){return this.quartile(a)[0]},yb.q2=function(a){return this.quartile(a)[1]},yb.q3=function(a){return this.quartile(a)[2]},yb.ci=function(a){return(this._get!==a||!this._ci)&&(this._ci=cC(this.values(),1e3,.05,a),this._get=a),this._ci},yb.ci0=function(a){return this.ci(a)[0]},yb.ci1=function(a){return this.ci(a)[1]};function og(a){E.call(this,null,a),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}og.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:qj},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Rc=N(og,E);Rc.transform=function(a,b){var c=this,d=b.fork(b.NO_SOURCE|b.NO_FIELDS),e=a.modified();return c.stamp=d.stamp,c.value&&(e||b.modified(c._inputs,!0))?(c._prev=c.value,c.value=e?c.init(a):{},b.visit(b.SOURCE,f=>c.add(f))):(c.value=c.value||c.init(a),b.visit(b.REM,f=>c.rem(f)),b.visit(b.ADD,f=>c.add(f))),d.modifies(c._outputs),c._drop=a.drop!==!1,a.cross&&c._dims.length>1&&(c._drop=!1,c.cross()),b.clean()&&c._drop&&d.clean(!0).runAfter(()=>this.clean()),c.changes(d)},Rc.cross=function(){var a=this,b=a.value,c=a._dnames,d=c.map(function(){return{}}),e=c.length;function f(h){var i,j,k,l;for(i in h)for(k=h[i].tuple,j=0;j<e;++j)d[j][l=k[c[j]]]=l}f(a._prev),f(b);function g(h,i,j){var k=c[j],l=d[j++],m,n;for(m in l)i[k]=l[m],n=h?h+"|"+m:m,j<e?g(n,i,j):b[n]||a.cell(n,i)}g("",{},0)},Rc.init=function(a){var b=this._inputs=[],c=this._outputs=[],d={};function e(q){for(var r=T(Tb(q)),s=0,t=r.length,w;s<t;++s)d[w=r[s]]||(d[w]=1,b.push(w))}this._dims=T(a.groupby),this._dnames=this._dims.map(function(q){var r=_a(q);return e(q),c.push(r),r}),this.cellkey=a.key?a.key:Rr(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var f=a.fields||[null],g=a.ops||["count"],h=a.as||[],i=f.length,j={},k,l,m,n,o,p;for(i!==g.length&&H("Unmatched number of fields and aggregate ops."),p=0;p<i;++p){k=f[p],l=g[p],k==null&&l!=="count"&&H("Null aggregate field specified."),n=_a(k),o=YB(l,n,h[p]),c.push(o);if(l==="count"){this._counts.push(o);continue}m=j[n],m||(e(k),m=j[n]=[],m.field=k,this._measures.push(m)),l!=="count"&&(this._countOnly=!1),m.push(ZB(l,o))}return this._measures=this._measures.map(function(q){return $B(q,q.field)}),{}},Rc.cellkey=Rr(),Rc.cell=function(a,b){var c=this.value[a];return c?c.num===0&&this._drop&&c.stamp<this.stamp?(c.stamp=this.stamp,this._adds[this._alen++]=c):c.stamp<this.stamp&&(c.stamp=this.stamp,this._mods[this._mlen++]=c):(c=this.value[a]=this.newcell(a,b),this._adds[this._alen++]=c),c},Rc.newcell=function(a,b){var c={key:a,num:0,agg:null,tuple:this.newtuple(b,this._prev&&this._prev[a]),stamp:this.stamp,store:!1};if(!this._countOnly){var d=this._measures,e=d.length,f;for(c.agg=Array(e),f=0;f<e;++f)c.agg[f]=new d[f](c)}return c.store&&(c.data=new hs()),c},Rc.newtuple=function(a,b){var c=this._dnames,d=this._dims,e={},f,g;for(f=0,g=d.length;f<g;++f)e[c[f]]=d[f](a);return b?rA(b.tuple,e):xa(e)},Rc.clean=function(){const a=this.value;for(const b in a)a[b].num===0&&delete a[b]},Rc.add=function(a){var b=this.cellkey(a),c=this.cell(b,a),d,e,f;c.num+=1;if(this._countOnly)return;for(c.store&&c.data.add(a),d=c.agg,e=0,f=d.length;e<f;++e)d[e].add(d[e].get(a),a)},Rc.rem=function(a){var b=this.cellkey(a),c=this.cell(b,a),d,e,f;c.num-=1;if(this._countOnly)return;for(c.store&&c.data.rem(a),d=c.agg,e=0,f=d.length;e<f;++e)d[e].rem(d[e].get(a),a)},Rc.celltuple=function(a){var b=a.tuple,c=this._counts,d,e,f;for(a.store&&a.data.values(),e=0,f=c.length;e<f;++e)b[c[e]]=a.num;if(!this._countOnly)for(d=a.agg,e=0,f=d.length;e<f;++e)d[e].set(b);return b},Rc.changes=function(a){var b=this._adds,c=this._mods,d=this._prev,e=this._drop,f=a.add,g=a.rem,h=a.mod,i,j,k,l;if(d)for(j in d)i=d[j],(!e||i.num)&&g.push(i.tuple);for(k=0,l=this._alen;k<l;++k)f.push(this.celltuple(b[k])),b[k]=null;for(k=0,l=this._mlen;k<l;++k)i=c[k],(i.num===0&&e?g:h).push(this.celltuple(i)),c[k]=null;return this._alen=this._mlen=0,this._prev=null,a};const hW=1e-14;function is(a){E.call(this,null,a)}is.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var pC=N(is,E);pC.transform=function(a,b){var c=a.interval!==!1,d=this._bins(a),e=d.start,f=d.step,g=a.as||["bin0","bin1"],h=g[0],i=g[1],j;return a.modified()?(b=b.reflow(!0),j=b.SOURCE):j=b.modified(Tb(a.field))?b.ADD_MOD:b.ADD,b.visit(j,c?function(k){var l=d(k);k[h]=l,k[i]=l==null?null:e+f*(1+(l-e)/f)}:function(k){k[h]=d(k)}),b.modifies(c?g:h)},pC._bins=function(a){if(this.value&&!a.modified())return this.value;var b=a.field,c=bC(a),d=c.step,e=c.start,f=e+Math.ceil((c.stop-e)/d)*d,g,h;(g=a.anchor)!=null&&(h=g-(e+d*Math.floor((g-e)/d)),e+=h,f+=h);var i=function(j){var k=ic(b(j));return k==null?null:k<e?-Infinity:k>f?Infinity:(k=Math.max(e,Math.min(k,f-d)),e+d*Math.floor(hW+(k-e)/d))};return i.start=e,i.stop=c.stop,i.step=d,this.value=Cc(i,Tb(b),a.name||"bin_"+_a(b))};function qC(a,b,c){var d=a,e=b||[],f=c||[],g={},h=0;return{add:function(i){f.push(i)},remove:function(i){g[d(i)]=++h},size:function(){return e.length},data:function(i,j){return h&&(e=e.filter(function(k){return!g[d(k)]}),g={},h=0),j&&i&&e.sort(i),f.length&&(e=i?XS(i,e,f.sort(i)):e.concat(f),f=[]),e}}}function js(a){E.call(this,[],a)}js.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};var iW=N(js,E);iW.transform=function(a,b){var c=b.fork(b.ALL),d=qC(aa,this.value,c.materialize(c.ADD).add),e=a.sort,f=b.changed()||e&&(a.modified("sort")||b.modified(e.fields));return c.visit(c.REM,d.remove),this.modified(f),this.value=c.source=d.data(eg(e),f),b.source&&b.source.root&&(this.value.root=b.source.root),c};function rC(a){Ga.call(this,null,jW,a)}N(rC,Ga);function jW(a){return this.value&&!a.modified()?this.value:iA(a.fields,a.orders)}function ks(a){E.call(this,null,a)}ks.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function kW(a,b,c){switch(b){case"upper":a=a.toUpperCase();break;case"lower":a=a.toLowerCase();break}return a.match(c)}var ls=N(ks,E);ls.transform=function(a,b){function c(l){return function(m){for(var n=kW(h(m),a.case,f)||[],o,p=0,q=n.length;p<q;++p)g.test(o=n[p])||l(o)}}var d=this._parameterCheck(a,b),e=this._counts,f=this._match,g=this._stop,h=a.field,i=a.as||["text","count"],j=c(function(l){e[l]=1+(e[l]||0)}),k=c(function(l){e[l]-=1});return d?b.visit(b.SOURCE,j):(b.visit(b.ADD,j),b.visit(b.REM,k)),this._finish(b,i)},ls._parameterCheck=function(a,b){var c=!1;return(a.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(a.stopwords||"")+"$","i"),c=!0),(a.modified("pattern")||!this._match)&&(this._match=new RegExp(a.pattern||"[\\w']+","g"),c=!0),(a.modified("field")||b.modified(a.field.fields))&&(c=!0),c&&(this._counts={}),c},ls._finish=function(a,b){var c=this._counts,d=this._tuples||(this._tuples={}),e=b[0],f=b[1],g=a.fork(a.NO_SOURCE|a.NO_FIELDS),h,i,j;for(h in c)i=d[h],j=c[h]||0,!i&&j?(d[h]=i=xa({}),i[e]=h,i[f]=j,g.add.push(i)):j===0?(i&&g.rem.push(i),c[h]=null,d[h]=null):i[f]!==j&&(i[f]=j,g.mod.push(i));return g.modifies(b)};function ms(a){E.call(this,null,a)}ms.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};var lW=N(ms,E);lW.transform=function(a,b){var c=b.fork(b.NO_SOURCE),d=this.value,e=a.as||["a","b"],f=e[0],g=e[1],h=!d||b.changed(b.ADD_REM)||a.modified("as")||a.modified("filter");return h?(d&&(c.rem=d),d=b.materialize(b.SOURCE).source,c.add=this.value=mW(d,f,g,a.filter||Gd)):c.mod=d,c.source=this.value,c.modifies(e)};function mW(a,b,c,d){for(var e=[],f={},g=a.length,h=0,i,j;h<g;++h)for(f[b]=j=a[h],i=0;i<g;++i)f[c]=a[i],d(f)&&(e.push(xa(f)),f={},f[b]=j);return e}var sC={kde:Yr,mixture:gC,normal:Xr,lognormal:fC,uniform:hC},nW="distributions",tC="function",oW="field";function uC(a,b){var c=a[tC];_(sC,c)||H("Unknown distribution function: "+c);var d=sC[c]();for(var e in a)e===oW?d.data((a.from||b()).map(a[e])):e===nW?d[e](a[e].map(function(f){return uC(f,b)})):typeof d[e]===tC&&d[e](a[e]);return d}function ns(a){E.call(this,null,a)}var vC=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],pW={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:vC},{name:"weights",type:"number",array:!0}]};ns.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:vC.concat(pW)},{name:"as",type:"string",array:!0,default:["value","density"]}]};var qW=N(ns,E);qW.transform=function(a,b){var c=b.fork(b.NO_SOURCE|b.NO_FIELDS);if(!this.value||b.changed()||a.modified()){var d=uC(a.distribution,rW(b)),e=a.steps||a.minsteps||25,f=a.steps||a.maxsteps||200,g=a.method||"pdf";g!=="pdf"&&g!=="cdf"&&H("Invalid density method: "+g),!a.extent&&!d.data&&H("Missing density extent parameter."),g=d[g];var h=a.as||["value","density"],i=a.extent||pe(d.data()),j=Cm(g,i,e,f).map(k=>{var l={};return l[h[0]]=k[0],l[h[1]]=k[1],xa(l)});this.value&&(c.rem=this.value),this.value=c.add=c.source=j}return c};function rW(a){return function(){return a.materialize(a.SOURCE).source}}function wC(a,b){return a?a.map(function(c,d){return b[d]||_a(c)}):null}function os(a,b,c){var d=[],e=function(l){return l(i)},f,g,h,i,j,k;if(b==null)d.push(a.map(c));else for(f={},g=0,h=a.length;g<h;++g)i=a[g],j=b.map(e),k=f[j],k||(f[j]=k=[],k.dims=j,d.push(k)),k.push(c(i));return d}const xC="bin";function ps(a){E.call(this,null,a)}ps.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:xC}]};const sW=N(ps,E);sW.transform=function(a,b){if(this.value&&!(a.modified()||b.changed()))return b;const c=b.materialize(b.SOURCE).source,d=os(b.source,a.groupby,Ub),e=a.smooth||!1,f=a.field,g=a.step||tW(c,f),h=eg((o,p)=>f(o)-f(p)),i=a.as||xC,j=d.length;let k=Infinity,l=-Infinity,m=0,n;for(;m<j;++m){const o=d[m].sort(h);n=-1;for(const p of dC(o,g,e,f))p<k&&(k=p),p>l&&(l=p),o[++n][i]=p}return this.value={start:k,stop:l,step:g},b.reflow(!0).modifies(i)};function tW(a,b){return $l(pe(a,b))/30}function yC(a){Ga.call(this,null,uW,a),this.modified(!0)}N(yC,Ga);function uW(a){var b=a.expr;return this.value&&!a.modified("expr")?this.value:Cc(c=>b(c,a),Tb(b),_a(b))}function qs(a){E.call(this,[void 0,void 0],a)}qs.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};var vW=N(qs,E);vW.transform=function(a,b){var c=this.value,d=a.field,e=c[0],f=c[1],g;g=b.changed()||b.modified(d.fields)||a.modified("field"),(g||e==null)&&(e=Infinity,f=-Infinity),b.visit(g?b.SOURCE:b.ADD,function(h){var i=ic(d(h));i!=null&&(i<e&&(e=i),i>f&&(f=i))});if(!Number.isFinite(e)||!Number.isFinite(f)){let h=_a(d);h&&(h=` for field "${h}"`),b.dataflow.warn(`Infinite extent${h}: [${e}, ${f}]`),e=f=void 0}this.value=[e,f]};function rs(a,b){Ga.call(this,a),this.parent=b,this.count=0}var Ih=N(rs,Ga);Ih.connect=function(a){return this.detachSubflow=a.detachSubflow,this.targets().add(a),a.source=this},Ih.add=function(a){this.count+=1,this.value.add.push(a)},Ih.rem=function(a){this.count-=1,this.value.rem.push(a)},Ih.mod=function(a){this.value.mod.push(a)},Ih.init=function(a){this.value.init(a,a.NO_SOURCE)},Ih.evaluate=function(){return this.value};function Dm(a){E.call(this,{},a),this._keys=Zi();const b=this._targets=[];b.active=0,b.forEach=c=>{for(let d=0,e=b.active;d<e;++d)c(b[d],d,b)}}const uj=N(Dm,E);uj.activate=function(a){this._targets[this._targets.active++]=a},uj.subflow=function(a,b,c,d){let e=this.value,f=_(e,a)&&e[a],g,h;return f?f.value.stamp<c.stamp&&(f.init(c),this.activate(f)):(h=d||(h=this._group[a])&&h.tuple,g=c.dataflow,f=new rs(c.fork(c.NO_SOURCE),this),g.add(f).connect(b(g,a,h)),e[a]=f,this.activate(f)),f},uj.clean=function(){const a=this.value;for(const b in a)if(a[b].count===0){const c=a[b].detachSubflow;c&&c(),delete a[b]}},uj.initTargets=function(){const a=this._targets,b=a.length;for(let c=0;c<b&&a[c]!=null;++c)a[c]=null;a.active=0},uj.transform=function(a,b){const c=b.dataflow,d=a.key,e=a.subflow,f=this._keys,g=a.modified("key"),h=i=>this.subflow(i,e,b);return this._group=a.group||{},this.initTargets(),b.visit(b.REM,i=>{const j=aa(i),k=f.get(j);k!==void 0&&(f.delete(j),h(k).rem(i))}),b.visit(b.ADD,i=>{const j=d(i);f.set(aa(i),j),h(j).add(i)}),g||b.modified(d.fields)?b.visit(b.MOD,i=>{const j=aa(i),k=f.get(j),l=d(i);k===l?h(l).mod(i):(f.set(j,l),h(k).rem(i),h(l).add(i))}):b.changed(b.MOD)&&b.visit(b.MOD,i=>{h(f.get(aa(i))).mod(i)}),g&&b.visit(b.REFLOW,i=>{const j=aa(i),k=f.get(j),l=d(i);k!==l&&(f.set(j,l),h(k).rem(i),h(l).add(i))}),b.clean()?c.runAfter(()=>{this.clean(),f.clean()}):f.empty>c.cleanThreshold&&c.runAfter(f.clean),b};function zC(a){Ga.call(this,null,wW,a)}N(zC,Ga);function wW(a){return this.value&&!a.modified()?this.value:J(a.name)?T(a.name).map(function(b){return Fd(b)}):Fd(a.name,a.as)}function ss(a){E.call(this,Zi(),a)}ss.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};var xW=N(ss,E);xW.transform=function(a,b){var c=b.dataflow,d=this.value,e=b.fork(),f=e.add,g=e.rem,h=e.mod,i=a.expr,j=!0;b.visit(b.REM,function(l){var m=aa(l);d.has(m)?d.delete(m):g.push(l)}),b.visit(b.ADD,function(l){i(l,a)?f.push(l):d.set(aa(l),1)});function k(l){var m=aa(l),n=i(l,a),o=d.get(m);n&&o?(d.delete(m),f.push(l)):!n&&!o?(d.set(m,1),g.push(l)):j&&n&&!o&&h.push(l)}return b.visit(b.MOD,k),a.modified()&&(j=!1,b.visit(b.REFLOW,k)),d.empty>c.cleanThreshold&&c.runAfter(d.clean),e};function ts(a){E.call(this,[],a)}ts.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};var yW=N(ts,E);yW.transform=function(a,b){var c=b.fork(b.NO_SOURCE),d=a.fields,e=wC(d,a.as||[]),f=a.index||null,g=e.length;return c.rem=this.value,b.visit(b.SOURCE,function(h){for(var i=d.map(o=>o(h)),j=i.reduce((o,p)=>Math.max(o,p.length),0),k=0,l,m,n;k<j;++k){for(m=Zq(h),l=0;l<g;++l)m[e[l]]=(n=i[l][k])==null?null:n;f&&(m[f]=k),c.add.push(m)}}),this.value=c.source=c.add,f&&c.modifies(f),c.modifies(e)};function us(a){E.call(this,[],a)}us.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};var zW=N(us,E);zW.transform=function(a,b){var c=b.fork(b.NO_SOURCE),d=a.fields,e=d.map(_a),f=a.as||["key","value"],g=f[0],h=f[1],i=d.length;return c.rem=this.value,b.visit(b.SOURCE,function(j){for(var k=0,l;k<i;++k)l=Zq(j),l[g]=e[k],l[h]=d[k](j),c.add.push(l)}),this.value=c.source=c.add,c.modifies(f)};function vs(a){E.call(this,null,a)}vs.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};var AW=N(vs,E);AW.transform=function(a,b){var c=a.expr,d=a.as,e=a.modified(),f=a.initonly?b.ADD:e?b.SOURCE:b.modified(c.fields)||b.modified(d)?b.ADD_MOD:b.ADD;return e&&(b=b.materialize().reflow(!0)),a.initonly||b.modifies(d),b.visit(f,g=>g[d]=c(g,a))};function AC(a){E.call(this,[],a)}var BW=N(AC,E);BW.transform=function(a,b){var c=this.value,d=b.fork(b.ALL),e=a.size-c.length,f=a.generator,g,h,i;if(e>0){for(g=[];--e>=0;)g.push(i=xa(f(a))),c.push(i);d.add=d.add.length?d.materialize(d.ADD).add.concat(g):g}else h=c.slice(0,-e),d.rem=d.rem.length?d.materialize(d.REM).rem.concat(h):h,c=c.slice(-e);return d.source=this.value=c,d};var Em={value:"value",median:IA,mean:UT,min:lr,max:hg},CW=[];function ws(a){E.call(this,[],a)}ws.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var DW=N(ws,E);function EW(a){var b=a.method||Em.value,c;if(Em[b]==null)H("Unrecognized imputation method: "+b);else return b===Em.value?(c=a.value!==void 0?a.value:0,function(){return c}):Em[b]}function FW(a){var b=a.field;return function(c){return c?b(c):NaN}}DW.transform=function(a,b){var c=b.fork(b.ALL),d=EW(a),e=FW(a),f=_a(a.field),g=_a(a.key),h=(a.groupby||[]).map(_a),i=GW(b.source,a.groupby,a.key,a.keyvals),j=[],k=this.value,l=i.domain.length,m,n,o,p,q,r,s,t,w,v;for(q=0,t=i.length;q<t;++q)for(m=i[q],o=m.values,n=NaN,s=0;s<l;++s){if(m[s]!=null)continue;for(p=i.domain[s],v={_impute:!0},r=0,w=o.length;r<w;++r)v[h[r]]=o[r];v[g]=p,v[f]=Number.isNaN(n)?n=d(m,e):n,j.push(xa(v))}return j.length&&(c.add=c.materialize(c.ADD).add.concat(j)),k.length&&(c.rem=c.materialize(c.REM).rem.concat(k)),this.value=j,c};function GW(a,b,c,d){var e=function(r){return r(q)},f=[],g=d?d.slice():[],h={},i={},j,k,l,m,n,o,p,q;for(g.forEach(function(r,s){h[r]=s+1}),m=0,p=a.length;m<p;++m)q=a[m],o=c(q),n=h[o]||(h[o]=g.push(o)),k=(j=b?b.map(e):CW)+"",(l=i[k])||(l=i[k]=[],f.push(l),l.values=j),l[n-1]=q;return f.domain=g,f}function xs(a){og.call(this,a)}xs.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:qj},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var BC=N(xs,og);BC.transform=function(a,b){var c=this,d=a.modified(),e;return c.value&&(d||b.modified(c._inputs,!0))?(e=c.value=d?c.init(a):{},b.visit(b.SOURCE,function(f){c.add(f)})):(e=c.value=c.value||this.init(a),b.visit(b.REM,function(f){c.rem(f)}),b.visit(b.ADD,function(f){c.add(f)})),c.changes(),b.visit(b.SOURCE,function(f){la(f,e[c.cellkey(f)].tuple)}),b.reflow(d).modifies(this._outputs)},BC.changes=function(){var a=this._adds,b=this._mods,c,d;for(c=0,d=this._alen;c<d;++c)this.celltuple(a[c]),a[c]=null;for(c=0,d=this._mlen;c<d;++c)this.celltuple(b[c]),b[c]=null;this._alen=this._mlen=0};function ys(a){E.call(this,null,a)}ys.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};var HW=N(ys,E);HW.transform=function(a,b){var c=b.fork(b.NO_SOURCE|b.NO_FIELDS);if(!this.value||b.changed()||a.modified()){const d=b.materialize(b.SOURCE).source,e=os(d,a.groupby,a.field),f=(a.groupby||[]).map(_a),g=a.bandwidth,h=a.cumulative?"cdf":"pdf",i=a.as||["value","density"],j=[];let k=a.extent,l=a.steps||a.minsteps||25,m=a.steps||a.maxsteps||200;h!=="pdf"&&h!=="cdf"&&H("Invalid density method: "+h),a.resolve==="shared"&&(k||(k=pe(d,a.field)),l=m=a.steps||m),e.forEach(n=>{const o=Yr(n,g)[h],p=a.counts?n.length:1,q=k||pe(n);Cm(o,q,l,m).forEach(r=>{const s={};for(let t=0;t<f.length;++t)s[f[t]]=n.dims[t];s[i[0]]=r[0],s[i[1]]=r[1]*p,j.push(xa(s))})}),this.value&&(c.rem=this.value),this.value=c.add=c.source=j}return c};function CC(a){Ga.call(this,null,IW,a)}N(CC,Ga);function IW(a){return this.value&&!a.modified()?this.value:lA(a.fields,a.flat)}function DC(a){E.call(this,[],a),this._pending=null}var JW=N(DC,E);JW.transform=function(a,b){const c=b.dataflow;if(this._pending)return zs(this,b,this._pending);if(KW(a))return b.StopPropagation;if(a.values)return zs(this,b,c.parse(a.values,a.format));if(a.async){const d=c.request(a.url,a.format).then(e=>(this._pending=T(e.data),f=>f.touch(this)));return{async:d}}else return c.request(a.url,a.format).then(d=>zs(this,b,T(d.data)))};function KW(a){return a.modified("async")&&!(a.modified("values")||a.modified("url")||a.modified("format"))}function zs(a,b,c){c.forEach(xa);const d=b.fork(b.NO_FIELDS&b.NO_SOURCE);return d.rem=a.value,a.value=d.source=d.add=c,a._pending=null,d.rem.length&&d.clean(!0),d}function As(a){E.call(this,{},a)}As.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};var LW=N(As,E);LW.transform=function(a,b){var c=b,d=a.as,e=a.fields,f=a.index,g=a.values,h=a.default==null?null:a.default,i=a.modified(),j=i?b.SOURCE:b.ADD,k=e.length,l,m,n;return g?(m=g.length,k>1&&!d&&H('Multi-field lookup requires explicit "as" parameter.'),d&&d.length!==k*m&&H('The "as" parameter has too few output field names.'),d=d||g.map(_a),l=function(o){for(var p=0,q=0,r,s;p<k;++p){s=f.get(e[p](o));if(s==null)for(r=0;r<m;++r,++q)o[d[q]]=h;else for(r=0;r<m;++r,++q)o[d[q]]=g[r](s)}}):(d||H("Missing output field names."),l=function(o){for(var p=0,q;p<k;++p)q=f.get(e[p](o)),o[d[p]]=q==null?h:q}),i?c=b.reflow(!0):(n=e.some(function(o){return b.modified(o.fields)}),j|=n?b.MOD:0),b.visit(j,l),c.modifies(d)};function EC(a){Ga.call(this,null,MW,a)}N(EC,Ga);function MW(a){if(this.value&&!a.modified())return this.value;var b=Infinity,c=-Infinity,d=a.extents,e,f,g;for(e=0,f=d.length;e<f;++e)g=d[e],g[0]<b&&(b=g[0]),g[1]>c&&(c=g[1]);return[b,c]}function FC(a){Ga.call(this,null,NW,a)}N(FC,Ga);function NW(a){return this.value&&!a.modified()?this.value:a.values.reduce(function(b,c){return b.concat(c)},[])}function Bs(a){E.call(this,null,a)}N(Bs,E),Bs.prototype.transform=function(a,b){return this.modified(a.modified()),this.value=a,b.fork(b.NO_SOURCE|b.NO_FIELDS)};function Cs(a){og.call(this,a)}Cs.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:qj,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var Ds=N(Cs,og);Ds._transform=Ds.transform,Ds.transform=function(a,b){return this._transform(OW(a,b),b)};function OW(a,b){var c=a.field,d=a.value,e=(a.op==="count"?"__count__":a.op)||"sum",f=Tb(c).concat(Tb(d)),g=QW(c,a.limit||0,b);return b.changed()&&a.set("__pivot__",null,null,!0),{key:a.key,groupby:a.groupby,ops:g.map(function(){return e}),fields:g.map(function(h){return PW(h,c,d,f)}),as:g.map(function(h){return h+""}),modified:a.modified.bind(a)}}function PW(a,b,c,d){return Cc(function(e){return b(e)===a?c(e):NaN},d,a+"")}function QW(a,b,c){var d={},e=[];return c.visit(c.SOURCE,function(f){var g=a(f);d[g]||(d[g]=1,e.push(g))}),e.sort(function(f,g){return(f<g||f==null)&&g!=null?-1:(f>g||g==null)&&f!=null?1:(g=g instanceof Date?+g:g,f=f instanceof Date?+f:f)!==f&&g===g?-1:g!==g&&f===f?1:0}),b?e.slice(0,b):e}function GC(a){Dm.call(this,a)}const RW=N(GC,Dm);RW.transform=function(a,b){const c=a.subflow,d=a.field,e=f=>this.subflow(aa(f),c,b,f);return(a.modified("field")||d&&b.modified(Tb(d)))&&H("PreFacet does not support field modification."),this.initTargets(),d?(b.visit(b.MOD,f=>{const g=e(f);d(f).forEach(h=>g.mod(h))}),b.visit(b.ADD,f=>{const g=e(f);d(f).forEach(h=>g.add(xa(h)))}),b.visit(b.REM,f=>{const g=e(f);d(f).forEach(h=>g.rem(h))})):(b.visit(b.MOD,f=>e(f).mod(f)),b.visit(b.ADD,f=>e(f).add(f)),b.visit(b.REM,f=>e(f).rem(f))),b.clean()&&b.runAfter(()=>this.clean()),b};function Es(a){E.call(this,null,a)}Es.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};var SW=N(Es,E);SW.transform=function(a,b){var c=a.fields,d=wC(a.fields,a.as||[]),e=c?function(h,i){return TW(h,i,c,d)}:_q,f,g;return this.value?g=this.value:(b=b.addAll(),g=this.value={}),f=b.fork(b.NO_SOURCE),b.visit(b.REM,function(h){var i=aa(h);f.rem.push(g[i]),g[i]=null}),b.visit(b.ADD,function(h){var i=e(h,xa({}));g[aa(h)]=i,f.add.push(i)}),b.visit(b.MOD,function(h){f.mod.push(e(h,g[aa(h)]))}),f};function TW(a,b,c,d){for(var e=0,f=c.length;e<f;++e)b[d[e]]=c[e](a);return b}function HC(a){E.call(this,null,a)}var UW=N(HC,E);UW.transform=function(a,b){return this.value=a.value,a.modified("value")?b.fork(b.NO_SOURCE|b.NO_FIELDS):b.StopPropagation};function Fs(a){E.call(this,null,a)}Fs.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var VW=N(Fs,E),WW=1e-14;VW.transform=function(a,b){var c=b.fork(b.NO_SOURCE|b.NO_FIELDS),d=a.as||["prob","value"];if(this.value&&!a.modified()&&!b.changed())return c.source=this.value,c;const e=b.materialize(b.SOURCE).source,f=os(e,a.groupby,a.field),g=(a.groupby||[]).map(_a),h=[],i=a.step||.01,j=a.probs||gg(i/2,1-WW,i),k=j.length;return f.forEach(l=>{const m=Tr(l,j);for(let n=0;n<k;++n){const o={};for(let p=0;p<g.length;++p)o[g[p]]=l.dims[p];o[d[0]]=j[n],o[d[1]]=m[n],h.push(xa(o))}}),this.value&&(c.rem=this.value),this.value=c.add=c.source=h,c};function IC(a){E.call(this,null,a)}var XW=N(IC,E);XW.transform=function(a,b){var c,d;return this.value?d=this.value:(c=b=b.addAll(),d=this.value={}),a.derive&&(c=b.fork(b.NO_SOURCE),b.visit(b.REM,e=>{var f=aa(e);c.rem.push(d[f]),d[f]=null}),b.visit(b.ADD,e=>{var f=Zq(e);d[aa(e)]=f,c.add.push(f)}),b.visit(b.MOD,e=>{var f=d[aa(e)],g;for(g in e)f[g]=e[g],c.modifies(g);c.mod.push(f)})),c};function Gs(a){E.call(this,[],a),this.count=0}Gs.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var YW=N(Gs,E);YW.transform=function(a,b){var c=b.fork(b.NO_SOURCE),d=a.modified("size"),e=a.size,f=this.value,g=this.count,h=0,i=f.reduce(function(m,n){return m[aa(n)]=1,m},{});function j(m){var n,o;f.length<e?f.push(m):(o=~~((g+1)*Qc()),o<f.length&&o>=h&&(n=f[o],i[aa(n)]&&c.rem.push(n),f[o]=m)),++g}b.rem.length&&(b.visit(b.REM,function(m){var n=aa(m);i[n]&&(i[n]=-1,c.rem.push(m)),--g}),f=f.filter(function(m){return i[aa(m)]!==-1})),(b.rem.length||d)&&f.length<e&&b.source&&(h=g=f.length,b.visit(b.SOURCE,function(m){i[aa(m)]||j(m)}),h=-1);if(d&&f.length>e){for(var k=0,l=f.length-e;k<l;++k)i[aa(f[k])]=-1,c.rem.push(f[k]);f=f.slice(l)}return b.mod.length&&b.visit(b.MOD,function(m){i[aa(m)]&&c.mod.push(m)}),b.add.length&&b.visit(b.ADD,j),(b.add.length||h<0)&&(c.add=f.filter(function(m){return!i[aa(m)]})),this.count=g,this.value=c.source=f,c};function Hs(a){E.call(this,null,a)}Hs.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var ZW=N(Hs,E);ZW.transform=function(a,b){if(this.value&&!a.modified())return;var c=b.materialize().fork(b.MOD),d=a.as||"data";return c.rem=this.value?b.rem.concat(this.value):b.rem,this.value=gg(a.start,a.stop,a.step||1).map(function(e){var f={};return f[d]=e,xa(f)}),c.add=b.add.concat(this.value),c};function JC(a){E.call(this,null,a),this.modified(!0)}var _W=N(JC,E);_W.transform=function(a,b){return this.value=b.source,b.changed()?b.fork(b.NO_SOURCE|b.NO_FIELDS):b.StopPropagation};function Is(a){E.call(this,null,a)}const KC=["unit0","unit1"];Is.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:pr,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:KC}]};var LC=N(Is,E);LC.transform=function(a,b){var c=a.field,d=a.interval!==!1,e=a.timezone==="utc",f=this._floor(a,b),g=(e?Bh:Ah)(f.unit).offset,h=a.as||KC,i=h[0],j=h[1],k=f.start||Infinity,l=f.stop||-Infinity,m=f.step,n=b.ADD;return(a.modified()||b.modified(Tb(c)))&&(b=b.reflow(!0),n=b.SOURCE,k=Infinity,l=-Infinity),b.visit(n,function(o){var p=c(o),q,r;p==null?(o[i]=null,d&&(o[j]=null)):(o[i]=q=r=f(p),d&&(o[j]=r=g(q,m)),q<k&&(k=q),r>l&&(l=r))}),f.start=k,f.stop=l,b.modifies(d?h:i)},LC._floor=function(a,b){const c=a.timezone==="utc";let{units:d,step:e}=a.units?{units:a.units,step:a.step||1}:vB({extent:a.extent||pe(b.materialize(b.SOURCE).source,a.field),maxbins:a.maxbins});d=rr(d);const f=this.value||{},g=(c?kB:jB)(d,e);return g.unit=ra(d),g.units=d,g.step=e,g.start=f.start,g.stop=f.stop,this.value=g};function MC(a){E.call(this,Zi(),a)}var $W=N(MC,E);$W.transform=function(a,b){var c=b.dataflow,d=a.field,e=this.value,f=!0;function g(h){e.set(d(h),h)}return a.modified("field")||b.modified(d.fields)?(e.clear(),b.visit(b.SOURCE,g)):b.changed()?(b.visit(b.REM,function(h){e.delete(d(h))}),b.visit(b.ADD,g)):f=!1,this.modified(f),e.empty>c.cleanThreshold&&c.runAfter(e.clean),b.fork()};function NC(a){E.call(this,null,a)}var aX=N(NC,E);aX.transform=function(a,b){var c=!this.value||a.modified("field")||a.modified("sort")||b.changed()||a.sort&&b.modified(a.sort.fields);c&&(this.value=(a.sort?b.source.slice().sort(eg(a.sort)):b.source).map(a.field))};function bX(a,b,c,d){let e=vj[a](b,c);return{init:e.init||$f,update:function(f,g){g[d]=e.next(f)}}}const vj={row_number:function(){return{next:a=>a.index+1}},rank:function(){let a;return{init:()=>a=1,next:b=>{let c=b.index,d=b.data;return c&&b.compare(d[c-1],d[c])?a=c+1:a}}},dense_rank:function(){let a;return{init:()=>a=1,next:b=>{let c=b.index,d=b.data;return c&&b.compare(d[c-1],d[c])?++a:a}}},percent_rank:function(){let a=vj.rank(),b=a.next;return{init:a.init,next:c=>(b(c)-1)/(c.data.length-1)}},cume_dist:function(){let a;return{init:()=>a=0,next:b=>{let c=b.index,d=b.data,e=b.compare;if(a<c){for(;c+1<d.length&&!e(d[c],d[c+1]);)++c;a=c}return(1+a)/d.length}}},ntile:function(a,b){b=+b,b>0||H("ntile num must be greater than zero.");let c=vj.cume_dist(),d=c.next;return{init:c.init,next:e=>Math.ceil(b*d(e))}},lag:function(a,b){return b=+b||1,{next:c=>{let d=c.index-b;return d>=0?a(c.data[d]):null}}},lead:function(a,b){return b=+b||1,{next:c=>{let d=c.index+b,e=c.data;return d<e.length?a(e[d]):null}}},first_value:function(a){return{next:b=>a(b.data[b.i0])}},last_value:function(a){return{next:b=>a(b.data[b.i1-1])}},nth_value:function(a,b){return b=+b,b>0||H("nth_value nth must be greater than zero."),{next:c=>{let d=c.i0+(b-1);return d<c.i1?a(c.data[d]):null}}},prev_value:function(a){let b;return{init:()=>b=null,next:c=>{let d=a(c.data[c.index]);return d!=null?b=d:b}}},next_value:function(a){let b,c;return{init:()=>(b=null,c=-1),next:d=>{let e=d.data;return d.index<=c?b:(c=cX(a,e,d.index))<0?(c=e.length,b=null):b=a(e[c])}}}};function cX(a,b,c){for(let d=b.length;c<d;++c){let e=a(b[c]);if(e!=null)return c}return-1}var dX=Object.keys(vj);function OC(a){let b=this,c=T(a.ops),d=T(a.fields),e=T(a.params),f=T(a.as),g=b.outputs=[],h=b.windows=[],i={},j={},k=!0,l=[],m=[];function n(o){T(Tb(o)).forEach(p=>i[p]=1)}n(a.sort),c.forEach(function(o,p){let q=d[p],r=_a(q),s=YB(o,r,f[p]);n(q),g.push(s);if(_(vj,o))h.push(bX(o,d[p],e[p],s));else{q==null&&o!=="count"&&H("Null aggregate field specified.");if(o==="count"){l.push(s);return}k=!1;let t=j[r];t||(t=j[r]=[],t.field=q,m.push(t)),t.push(ZB(o,s))}}),(l.length||m.length)&&(b.cell=eX(m,l,k)),b.inputs=Object.keys(i)}const PC=OC.prototype;PC.init=function(){this.windows.forEach(a=>a.init()),this.cell&&this.cell.init()},PC.update=function(a,b){let c=this,d=c.cell,e=c.windows,f=a.data,g=e&&e.length,h;if(d){for(h=a.p0;h<a.i0;++h)d.rem(f[h]);for(h=a.p1;h<a.i1;++h)d.add(f[h]);d.set(b)}for(h=0;h<g;++h)e[h].update(a,b)};function eX(a,b,c){a=a.map(i=>$B(i,i.field));let d={num:0,agg:null,store:!1,count:b};if(!c)for(var e=a.length,f=d.agg=Array(e),g=0;g<e;++g)f[g]=new a[g](d);if(d.store)var h=d.data=new hs();return d.add=function(i){d.num+=1;if(c)return;h&&h.add(i);for(let j=0;j<e;++j)f[j].add(f[j].get(i),i)},d.rem=function(i){d.num-=1;if(c)return;h&&h.rem(i);for(let j=0;j<e;++j)f[j].rem(f[j].get(i),i)},d.set=function(i){let j,k;for(h&&h.values(),j=0,k=b.length;j<k;++j)i[b[j]]=d.num;if(!c)for(j=0,k=f.length;j<k;++j)f[j].set(i)},d.init=function(){d.num=0,h&&h.reset();for(let i=0;i<e;++i)f[i].init()},d}function Js(a){E.call(this,{},a),this._mlen=0,this._mods=[]}Js.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:dX.concat(qj)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var QC=N(Js,E);QC.transform=function(a,b){var c=this,d=c.state,e=a.modified(),f=eg(a.sort),g,h;this.stamp=b.stamp,(!d||e)&&(d=c.state=new OC(a));var i=Rr(a.groupby);function j(k){return c.group(i(k))}for(e||b.modified(d.inputs)?(c.value={},b.visit(b.SOURCE,function(k){j(k).add(k)})):(b.visit(b.REM,function(k){j(k).remove(k)}),b.visit(b.ADD,function(k){j(k).add(k)})),g=0,h=c._mlen;g<h;++g)fX(c._mods[g],d,f,a);return c._mlen=0,c._mods=[],b.reflow(e).modifies(d.outputs)},QC.group=function(a){var b=this,c=b.value[a];return c||(c=b.value[a]=qC(aa),c.stamp=-1),c.stamp<b.stamp&&(c.stamp=b.stamp,b._mods[b._mlen++]=c),c};function fX(a,b,c,d){var e=d.sort,f=e&&!d.ignorePeers,g=d.frame||[null,0],h=a.data(c),i=h.length,j=0,k=f?im(e):null,l={i0:0,i1:0,p0:0,p1:0,index:0,data:h,compare:e||Vb(-1)};for(b.init();j<i;++j)gX(l,g,j,i),f&&hX(l,k),b.update(l,h[j])}function gX(a,b,c,d){a.p0=a.i0,a.p1=a.i1,a.i0=b[0]==null?0:Math.max(0,c-Math.abs(b[0])),a.i1=b[1]==null?d:Math.min(d,c+Math.abs(b[1])+1),a.index=c}function hX(a,b){var c=a.i0,d=a.i1-1,e=a.compare,f=a.data,g=f.length-1;c>0&&!e(f[c],f[c-1])&&(a.i0=b.left(f,f[c])),d<g&&!e(f[d],f[d+1])&&(a.i1=b.right(f,f[d]))}var iX=Object.freeze({__proto__:null,aggregate:og,bin:is,collect:js,compare:rC,countpattern:ks,cross:ms,density:ns,dotbin:ps,expression:yC,extent:qs,facet:Dm,field:zC,filter:ss,flatten:ts,fold:us,formula:vs,generate:AC,impute:ws,joinaggregate:xs,kde:ys,key:CC,load:DC,lookup:As,multiextent:EC,multivalues:FC,params:Bs,pivot:Cs,prefacet:GC,project:Es,proxy:HC,quantile:Fs,relay:IC,sample:Gs,sequence:Hs,sieve:JC,subflow:rs,timeunit:Is,tupleindex:MC,values:NC,window:Js});const Jh="top",jd="left",kd="right",df="bottom",jX="top-left",kX="top-right",lX="bottom-left",mX="bottom-right",Ks="start",Ls="middle",Wb="end",nX="x",oX="y",Fm="group",Ms="axis",Ns="title",pX="frame",qX="scope",Os="legend",RC="row-header",SC="row-footer",TC="row-title",UC="column-header",VC="column-footer",WC="column-title",rX="padding",sX="symbol",XC="fit",tX="fit-x",uX="fit-y",vX="pad",Ps="none",Gm="all",Qs="each",Rs="flush",ef="column",ff="row";var YC=0;function wX(){YC=0}const Hm="p_";function Ss(a){return a&&a.gradient}function ZC(a,b,c){let d=a.id,e=a.gradient,f=e==="radial"?Hm:"";return d||(d=a.id="gradient_"+YC++,e==="radial"?(a.x1=Jd(a.x1,.5),a.y1=Jd(a.y1,.5),a.r1=Jd(a.r1,0),a.x2=Jd(a.x2,.5),a.y2=Jd(a.y2,.5),a.r2=Jd(a.r2,.5),f=Hm):(a.x1=Jd(a.x1,0),a.y1=Jd(a.y1,0),a.x2=Jd(a.x2,1),a.y2=Jd(a.y2,0))),b[d]=a,"url("+(c||"")+"#"+f+d+")"}function Jd(a,b){return a!=null?a:b}function _C(a,b){var c=[],d;return d={gradient:"linear",x1:a?a[0]:0,y1:a?a[1]:0,x2:b?b[0]:1,y2:b?b[1]:0,stops:c,stop:function(e,f){return c.push({offset:e,color:f}),d}}}var Ts=Math.PI,Us=2*Ts,pg=1e-6,xX=Us-pg;function Vs(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function qg(){return new Vs()}Vs.prototype=qg.prototype={constructor:Vs,moveTo:function(a,b){this._+="M"+(this._x0=this._x1=+a)+","+(this._y0=this._y1=+b)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(a,b){this._+="L"+(this._x1=+a)+","+(this._y1=+b)},quadraticCurveTo:function(a,b,c,d){this._+="Q"+ +a+","+ +b+","+(this._x1=+c)+","+(this._y1=+d)},bezierCurveTo:function(a,b,c,d,e,f){this._+="C"+ +a+","+ +b+","+ +c+","+ +d+","+(this._x1=+e)+","+(this._y1=+f)},arcTo:function(a,b,c,d,e){a=+a,b=+b,c=+c,d=+d,e=+e;var f=this._x1,g=this._y1,h=c-a,i=d-b,j=f-a,k=g-b,l=j*j+k*k;if(e<0)throw new Error("negative radius: "+e);if(this._x1===null)this._+="M"+(this._x1=a)+","+(this._y1=b);else if(l>pg)if(!(Math.abs(k*h-i*j)>pg)||!e)this._+="L"+(this._x1=a)+","+(this._y1=b);else{var m=c-f,n=d-g,o=h*h+i*i,p=m*m+n*n,q=Math.sqrt(o),r=Math.sqrt(l),s=e*Math.tan((Ts-Math.acos((o+l-p)/(2*q*r)))/2),t=s/r,w=s/q;Math.abs(t-1)>pg&&(this._+="L"+(a+t*j)+","+(b+t*k)),this._+="A"+e+","+e+",0,0,"+ +(k*m>j*n)+","+(this._x1=a+w*h)+","+(this._y1=b+w*i)}},arc:function(a,b,c,d,e,f){a=+a,b=+b,c=+c,f=!!f;var g=c*Math.cos(d),h=c*Math.sin(d),i=a+g,j=b+h,k=1^f,l=f?d-e:e-d;if(c<0)throw new Error("negative radius: "+c);this._x1===null?this._+="M"+i+","+j:(Math.abs(this._x1-i)>pg||Math.abs(this._y1-j)>pg)&&(this._+="L"+i+","+j);if(!c)return;l<0&&(l=l%Us+Us),l>xX?this._+="A"+c+","+c+",0,1,"+k+","+(a-g)+","+(b-h)+"A"+c+","+c+",0,1,"+k+","+(this._x1=i)+","+(this._y1=j):l>pg&&(this._+="A"+c+","+c+",0,"+ +(l>=Ts)+","+k+","+(this._x1=a+c*Math.cos(e))+","+(this._y1=b+c*Math.sin(e)))},rect:function(a,b,c,d){this._+="M"+(this._x0=this._x1=+a)+","+(this._y0=this._y1=+b)+"h"+ +c+"v"+ +d+"h"+-c+"Z"},toString:function(){return this._}};function Ka(a){return function b(){return a}}var $C=Math.abs,Ib=Math.atan2,rg=Math.cos,yX=Math.max,Ws=Math.min,Kd=Math.sin,Kh=Math.sqrt,Jb=1e-12,Lh=Math.PI,Im=Lh/2,aD=2*Lh;function zX(a){return a>1?0:a<-1?Lh:Math.acos(a)}function bD(a){return a>=1?Im:a<=-1?-Im:Math.asin(a)}function AX(a){return a.innerRadius}function BX(a){return a.outerRadius}function CX(a){return a.startAngle}function DX(a){return a.endAngle}function EX(a){return a&&a.padAngle}function FX(a,b,c,d,e,f,g,h){var i=c-a,j=d-b,k=g-e,l=h-f,m=l*i-k*j;return m*m<Jb?void 0:(m=(k*(b-f)-l*(a-e))/m,[a+m*i,b+m*j])}function Jm(a,b,c,d,e,f,g){var h=a-c,i=b-d,j=(g?f:-f)/Kh(h*h+i*i),k=j*i,l=-j*h,m=a+k,n=b+l,o=c+k,p=d+l,q=(m+o)/2,r=(n+p)/2,s=o-m,t=p-n,w=s*s+t*t,v=e-f,x=m*p-o*n,u=(t<0?-1:1)*Kh(yX(0,v*v*w-x*x)),z=(x*t-s*u)/w,y=(-x*s-t*u)/w,B=(x*t+s*u)/w,A=(-x*s+t*u)/w,C=z-q,F=y-r,K=B-q,D=A-r;return C*C+F*F>K*K+D*D&&(z=B,y=A),{cx:z,cy:y,x01:-k,y01:-l,x11:z*(e/v-1),y11:y*(e/v-1)}}function GX(){var a=AX,b=BX,c=Ka(0),d=null,e=CX,f=DX,g=EX,h=null;function i(){var j,k,l=+a.apply(this,arguments),m=+b.apply(this,arguments),n=e.apply(this,arguments)-Im,o=f.apply(this,arguments)-Im,p=$C(o-n),q=o>n;h||(h=j=qg()),m<l&&(k=m,m=l,l=k);if(!(m>Jb))h.moveTo(0,0);else if(p>aD-Jb)h.moveTo(m*rg(n),m*Kd(n)),h.arc(0,0,m,n,o,!q),l>Jb&&(h.moveTo(l*rg(o),l*Kd(o)),h.arc(0,0,l,o,n,q));else{var r=n,s=o,t=n,w=o,v=p,x=p,u=g.apply(this,arguments)/2,z=u>Jb&&(d?+d.apply(this,arguments):Kh(l*l+m*m)),y=Ws($C(m-l)/2,+c.apply(this,arguments)),B=y,A=y,C,F;if(z>Jb){var K=bD(z/l*Kd(u)),D=bD(z/m*Kd(u));(v-=K*2)>Jb?(K*=q?1:-1,t+=K,w-=K):(v=0,t=w=(n+o)/2),(x-=D*2)>Jb?(D*=q?1:-1,r+=D,s-=D):(x=0,r=s=(n+o)/2)}var I=m*rg(r),S=m*Kd(r),X=l*rg(w),Y=l*Kd(w);if(y>Jb){var wa=m*rg(s),Qa=m*Kd(s),tb=l*rg(t),ub=l*Kd(t),bb;if(p<Lh&&(bb=FX(I,S,tb,ub,wa,Qa,X,Y))){var Rb=I-bb[0],Dd=S-bb[1],rh=wa-bb[0],Vf=Qa-bb[1],U=1/Kd(zX((Rb*rh+Dd*Vf)/(Kh(Rb*Rb+Dd*Dd)*Kh(rh*rh+Vf*Vf)))/2),ja=Kh(bb[0]*bb[0]+bb[1]*bb[1]);B=Ws(y,(l-ja)/(U-1)),A=Ws(y,(m-ja)/(U+1))}}x>Jb?A>Jb?(C=Jm(tb,ub,I,S,m,A,q),F=Jm(wa,Qa,X,Y,m,A,q),h.moveTo(C.cx+C.x01,C.cy+C.y01),A<y?h.arc(C.cx,C.cy,A,Ib(C.y01,C.x01),Ib(F.y01,F.x01),!q):(h.arc(C.cx,C.cy,A,Ib(C.y01,C.x01),Ib(C.y11,C.x11),!q),h.arc(0,0,m,Ib(C.cy+C.y11,C.cx+C.x11),Ib(F.cy+F.y11,F.cx+F.x11),!q),h.arc(F.cx,F.cy,A,Ib(F.y11,F.x11),Ib(F.y01,F.x01),!q))):(h.moveTo(I,S),h.arc(0,0,m,r,s,!q)):h.moveTo(I,S),!(l>Jb)||!(v>Jb)?h.lineTo(X,Y):B>Jb?(C=Jm(X,Y,wa,Qa,l,-B,q),F=Jm(I,S,tb,ub,l,-B,q),h.lineTo(C.cx+C.x01,C.cy+C.y01),B<y?h.arc(C.cx,C.cy,B,Ib(C.y01,C.x01),Ib(F.y01,F.x01),!q):(h.arc(C.cx,C.cy,B,Ib(C.y01,C.x01),Ib(C.y11,C.x11),!q),h.arc(0,0,l,Ib(C.cy+C.y11,C.cx+C.x11),Ib(F.cy+F.y11,F.cx+F.x11),q),h.arc(F.cx,F.cy,B,Ib(F.y11,F.x11),Ib(F.y01,F.x01),!q))):h.arc(0,0,l,w,t,q)}h.closePath();if(j)return h=null,j+""||null}return i.centroid=function(){var j=(+a.apply(this,arguments)+ +b.apply(this,arguments))/2,k=(+e.apply(this,arguments)+ +f.apply(this,arguments))/2-Lh/2;return[rg(k)*j,Kd(k)*j]},i.innerRadius=function(j){return arguments.length?(a=typeof j==="function"?j:Ka(+j),i):a},i.outerRadius=function(j){return arguments.length?(b=typeof j==="function"?j:Ka(+j),i):b},i.cornerRadius=function(j){return arguments.length?(c=typeof j==="function"?j:Ka(+j),i):c},i.padRadius=function(j){return arguments.length?(d=j==null?null:typeof j==="function"?j:Ka(+j),i):d},i.startAngle=function(j){return arguments.length?(e=typeof j==="function"?j:Ka(+j),i):e},i.endAngle=function(j){return arguments.length?(f=typeof j==="function"?j:Ka(+j),i):f},i.padAngle=function(j){return arguments.length?(g=typeof j==="function"?j:Ka(+j),i):g},i.context=function(j){return arguments.length?(h=j==null?null:j,i):h},i}function cD(a){this._context=a}cD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b);break;case 1:this._point=2;default:this._context.lineTo(a,b);break}}};function Xs(a){return new cD(a)}function dD(a){return a[0]}function eD(a){return a[1]}function fD(){var a=dD,b=eD,c=Ka(!0),d=null,e=Xs,f=null;function g(h){var i,j=h.length,k,l=!1,m;for(d==null&&(f=e(m=qg())),i=0;i<=j;++i)!(i<j&&c(k=h[i],i,h))===l&&((l=!l)?f.lineStart():f.lineEnd()),l&&f.point(+a(k,i,h),+b(k,i,h));if(m)return f=null,m+""||null}return g.x=function(h){return arguments.length?(a=typeof h==="function"?h:Ka(+h),g):a},g.y=function(h){return arguments.length?(b=typeof h==="function"?h:Ka(+h),g):b},g.defined=function(h){return arguments.length?(c=typeof h==="function"?h:Ka(!!h),g):c},g.curve=function(h){return arguments.length?(e=h,d!=null&&(f=e(d)),g):e},g.context=function(h){return arguments.length?(h==null?d=f=null:f=e(d=h),g):d},g}function gD(){var a=dD,b=null,c=Ka(0),d=eD,e=Ka(!0),f=null,g=Xs,h=null;function i(k){var l,m,n,o=k.length,p,q=!1,r,s=new Array(o),t=new Array(o);for(f==null&&(h=g(r=qg())),l=0;l<=o;++l){if(!(l<o&&e(p=k[l],l,k))===q)if(q=!q)m=l,h.areaStart(),h.lineStart();else{for(h.lineEnd(),h.lineStart(),n=l-1;n>=m;--n)h.point(s[n],t[n]);h.lineEnd(),h.areaEnd()}q&&(s[l]=+a(p,l,k),t[l]=+c(p,l,k),h.point(b?+b(p,l,k):s[l],d?+d(p,l,k):t[l]))}if(r)return h=null,r+""||null}function j(){return fD().defined(e).curve(g).context(f)}return i.x=function(k){return arguments.length?(a=typeof k==="function"?k:Ka(+k),b=null,i):a},i.x0=function(k){return arguments.length?(a=typeof k==="function"?k:Ka(+k),i):a},i.x1=function(k){return arguments.length?(b=k==null?null:typeof k==="function"?k:Ka(+k),i):b},i.y=function(k){return arguments.length?(c=typeof k==="function"?k:Ka(+k),d=null,i):c},i.y0=function(k){return arguments.length?(c=typeof k==="function"?k:Ka(+k),i):c},i.y1=function(k){return arguments.length?(d=k==null?null:typeof k==="function"?k:Ka(+k),i):d},i.lineX0=i.lineY0=function(){return j().x(a).y(c)},i.lineY1=function(){return j().x(a).y(d)},i.lineX1=function(){return j().x(b).y(c)},i.defined=function(k){return arguments.length?(e=typeof k==="function"?k:Ka(!!k),i):e},i.curve=function(k){return arguments.length?(g=k,f!=null&&(h=g(f)),i):g},i.context=function(k){return arguments.length?(k==null?f=h=null:h=g(f=k),i):f},i}var HX={draw:function(a,b){var c=Math.sqrt(b/Lh);a.moveTo(c,0),a.arc(0,0,c,0,aD)}};function IX(){var a=Ka(HX),b=Ka(64),c=null;function d(){var e;c||(c=e=qg()),a.apply(this,arguments).draw(c,+b.apply(this,arguments));if(e)return c=null,e+""||null}return d.type=function(e){return arguments.length?(a=typeof e==="function"?e:Ka(e),d):a},d.size=function(e){return arguments.length?(b=typeof e==="function"?e:Ka(+e),d):b},d.context=function(e){return arguments.length?(c=e==null?null:e,d):c},d}function gf(){}function Km(a,b,c){a._context.bezierCurveTo((2*a._x0+a._x1)/3,(2*a._y0+a._y1)/3,(a._x0+2*a._x1)/3,(a._y0+2*a._y1)/3,(a._x0+4*a._x1+b)/6,(a._y0+4*a._y1+c)/6)}function Lm(a){this._context=a}Lm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Km(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Km(this,a,b);break}this._x0=this._x1,this._x1=a,this._y0=this._y1,this._y1=b}};function JX(a){return new Lm(a)}function hD(a){this._context=a}hD.prototype={areaStart:gf,areaEnd:gf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1,this._x2=a,this._y2=b;break;case 1:this._point=2,this._x3=a,this._y3=b;break;case 2:this._point=3,this._x4=a,this._y4=b,this._context.moveTo((this._x0+4*this._x1+a)/6,(this._y0+4*this._y1+b)/6);break;default:Km(this,a,b);break}this._x0=this._x1,this._x1=a,this._y0=this._y1,this._y1=b}};function KX(a){return new hD(a)}function iD(a){this._context=a}iD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var c=(this._x0+4*this._x1+a)/6,d=(this._y0+4*this._y1+b)/6;this._line?this._context.lineTo(c,d):this._context.moveTo(c,d);break;case 3:this._point=4;default:Km(this,a,b);break}this._x0=this._x1,this._x1=a,this._y0=this._y1,this._y1=b}};function LX(a){return new iD(a)}function jD(a,b){this._basis=new Lm(a),this._beta=b}jD.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var a=this._x,b=this._y,c=a.length-1;if(c>0)for(var d=a[0],e=b[0],f=a[c]-d,g=b[c]-e,h=-1,i;++h<=c;)i=h/c,this._basis.point(this._beta*a[h]+(1-this._beta)*(d+i*f),this._beta*b[h]+(1-this._beta)*(e+i*g));this._x=this._y=null,this._basis.lineEnd()},point:function(a,b){this._x.push(+a),this._y.push(+b)}};var MX=function a(b){function c(d){return b===1?new Lm(d):new jD(d,b)}return c.beta=function(d){return a(+d)},c}(.85);function Mm(a,b,c){a._context.bezierCurveTo(a._x1+a._k*(a._x2-a._x0),a._y1+a._k*(a._y2-a._y0),a._x2+a._k*(a._x1-b),a._y2+a._k*(a._y1-c),a._x2,a._y2)}function Ys(a,b){this._context=a,this._k=(1-b)/6}Ys.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Mm(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b);break;case 1:this._point=2,this._x1=a,this._y1=b;break;case 2:this._point=3;default:Mm(this,a,b);break}this._x0=this._x1,this._x1=this._x2,this._x2=a,this._y0=this._y1,this._y1=this._y2,this._y2=b}};var NX=function a(b){function c(d){return new Ys(d,b)}return c.tension=function(d){return a(+d)},c}(0);function Zs(a,b){this._context=a,this._k=(1-b)/6}Zs.prototype={areaStart:gf,areaEnd:gf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1,this._x3=a,this._y3=b;break;case 1:this._point=2,this._context.moveTo(this._x4=a,this._y4=b);break;case 2:this._point=3,this._x5=a,this._y5=b;break;default:Mm(this,a,b);break}this._x0=this._x1,this._x1=this._x2,this._x2=a,this._y0=this._y1,this._y1=this._y2,this._y2=b}};var OX=function a(b){function c(d){return new Zs(d,b)}return c.tension=function(d){return a(+d)},c}(0);function _s(a,b){this._context=a,this._k=(1-b)/6}_s.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Mm(this,a,b);break}this._x0=this._x1,this._x1=this._x2,this._x2=a,this._y0=this._y1,this._y1=this._y2,this._y2=b}};var PX=function a(b){function c(d){return new _s(d,b)}return c.tension=function(d){return a(+d)},c}(0);function $s(a,b,c){var d=a._x1,e=a._y1,f=a._x2,g=a._y2;if(a._l01_a>Jb){var h=2*a._l01_2a+3*a._l01_a*a._l12_a+a._l12_2a,i=3*a._l01_a*(a._l01_a+a._l12_a);d=(d*h-a._x0*a._l12_2a+a._x2*a._l01_2a)/i,e=(e*h-a._y0*a._l12_2a+a._y2*a._l01_2a)/i}if(a._l23_a>Jb){var j=2*a._l23_2a+3*a._l23_a*a._l12_a+a._l12_2a,k=3*a._l23_a*(a._l23_a+a._l12_a);f=(f*j+a._x1*a._l23_2a-b*a._l12_2a)/k,g=(g*j+a._y1*a._l23_2a-c*a._l12_2a)/k}a._context.bezierCurveTo(d,e,f,g,a._x2,a._y2)}function kD(a,b){this._context=a,this._alpha=b}kD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;if(this._point){var c=this._x2-a,d=this._y2-b;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(c*c+d*d,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b);break;case 1:this._point=2;break;case 2:this._point=3;default:$s(this,a,b);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=a,this._y0=this._y1,this._y1=this._y2,this._y2=b}};var QX=function a(b){function c(d){return b?new kD(d,b):new Ys(d,0)}return c.alpha=function(d){return a(+d)},c}(.5);function lD(a,b){this._context=a,this._alpha=b}lD.prototype={areaStart:gf,areaEnd:gf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(a,b){a=+a,b=+b;if(this._point){var c=this._x2-a,d=this._y2-b;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(c*c+d*d,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=a,this._y3=b;break;case 1:this._point=2,this._context.moveTo(this._x4=a,this._y4=b);break;case 2:this._point=3,this._x5=a,this._y5=b;break;default:$s(this,a,b);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=a,this._y0=this._y1,this._y1=this._y2,this._y2=b}};var RX=function a(b){function c(d){return b?new lD(d,b):new Zs(d,0)}return c.alpha=function(d){return a(+d)},c}(.5);function mD(a,b){this._context=a,this._alpha=b}mD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){a=+a,b=+b;if(this._point){var c=this._x2-a,d=this._y2-b;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(c*c+d*d,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:$s(this,a,b);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=a,this._y0=this._y1,this._y1=this._y2,this._y2=b}};var SX=function a(b){function c(d){return b?new mD(d,b):new _s(d,0)}return c.alpha=function(d){return a(+d)},c}(.5);function nD(a){this._context=a}nD.prototype={areaStart:gf,areaEnd:gf,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(a,b){a=+a,b=+b,this._point?this._context.lineTo(a,b):(this._point=1,this._context.moveTo(a,b))}};function TX(a){return new nD(a)}function oD(a){return a<0?-1:1}function pD(a,b,c){var d=a._x1-a._x0,e=b-a._x1,f=(a._y1-a._y0)/(d||e<0&&-0),g=(c-a._y1)/(e||d<0&&-0),h=(f*e+g*d)/(d+e);return(oD(f)+oD(g))*Math.min(Math.abs(f),Math.abs(g),.5*Math.abs(h))||0}function qD(a,b){var c=a._x1-a._x0;return c?(3*(a._y1-a._y0)/c-b)/2:b}function at(a,b,c){var d=a._x0,e=a._y0,f=a._x1,g=a._y1,h=(f-d)/3;a._context.bezierCurveTo(d+h,e+h*b,f-h,g-h*c,f,g)}function Nm(a){this._context=a}Nm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:at(this,this._t0,qD(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(a,b){var c=NaN;a=+a,b=+b;if(a===this._x1&&b===this._y1)return;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b);break;case 1:this._point=2;break;case 2:this._point=3,at(this,qD(this,c=pD(this,a,b)),c);break;default:at(this,this._t0,c=pD(this,a,b));break}this._x0=this._x1,this._x1=a,this._y0=this._y1,this._y1=b,this._t0=c}};function rD(a){this._context=new sD(a)}(rD.prototype=Object.create(Nm.prototype)).point=function(a,b){Nm.prototype.point.call(this,b,a)};function sD(a){this._context=a}sD.prototype={moveTo:function(a,b){this._context.moveTo(b,a)},closePath:function(){this._context.closePath()},lineTo:function(a,b){this._context.lineTo(b,a)},bezierCurveTo:function(a,b,c,d,e,f){this._context.bezierCurveTo(b,a,d,c,f,e)}};function UX(a){return new Nm(a)}function VX(a){return new rD(a)}function tD(a){this._context=a}tD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var a=this._x,b=this._y,c=a.length;if(c){this._line?this._context.lineTo(a[0],b[0]):this._context.moveTo(a[0],b[0]);if(c===2)this._context.lineTo(a[1],b[1]);else for(var d=uD(a),e=uD(b),f=0,g=1;g<c;++f,++g)this._context.bezierCurveTo(d[0][f],e[0][f],d[1][f],e[1][f],a[g],b[g])}(this._line||this._line!==0&&c===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(a,b){this._x.push(+a),this._y.push(+b)}};function uD(a){var b,c=a.length-1,d,e=new Array(c),f=new Array(c),g=new Array(c);for(e[0]=0,f[0]=2,g[0]=a[0]+2*a[1],b=1;b<c-1;++b)e[b]=1,f[b]=4,g[b]=4*a[b]+2*a[b+1];for(e[c-1]=2,f[c-1]=7,g[c-1]=8*a[c-1]+a[c],b=1;b<c;++b)d=e[b]/f[b-1],f[b]-=d,g[b]-=d*g[b-1];for(e[c-1]=g[c-1]/f[c-1],b=c-2;b>=0;--b)e[b]=(g[b]-e[b+1])/f[b];for(f[c-1]=(a[c]+e[c-1])/2,b=0;b<c-1;++b)f[b]=2*a[b+1]-e[b+1];return[e,f]}function WX(a){return new tD(a)}function Om(a,b){this._context=a,this._t=b}Om.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(a,b){a=+a,b=+b;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,b),this._context.lineTo(a,b);else{var c=this._x*(1-this._t)+a*this._t;this._context.lineTo(c,this._y),this._context.lineTo(c,b)}break}}this._x=a,this._y=b}};function XX(a){return new Om(a,.5)}function YX(a){return new Om(a,0)}function ZX(a){return new Om(a,1)}var vD={basis:{curve:JX},"basis-closed":{curve:KX},"basis-open":{curve:LX},bundle:{curve:MX,tension:"beta",value:.85},cardinal:{curve:NX,tension:"tension",value:0},"cardinal-open":{curve:PX,tension:"tension",value:0},"cardinal-closed":{curve:OX,tension:"tension",value:0},"catmull-rom":{curve:QX,tension:"alpha",value:.5},"catmull-rom-closed":{curve:RX,tension:"alpha",value:.5},"catmull-rom-open":{curve:SX,tension:"alpha",value:.5},linear:{curve:Xs},"linear-closed":{curve:TX},monotone:{horizontal:VX,vertical:UX},natural:{curve:WX},step:{curve:XX},"step-after":{curve:ZX},"step-before":{curve:YX}};function bt(a,b,c){var d=_(vD,a)&&vD[a],e=null;return d&&(e=d.curve||d[b||"vertical"],d.tension&&c!=null&&(e=e[d.tension](c))),e}var _X={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Pm=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function Mh(a){var b=[],c,d,e,f,g,h,i,j,k,l,m;for(c=a.slice().replace(Pm[0],"###$1").split(Pm[1]).slice(1),j=0,l=c.length;j<l;++j){for(d=c[j],e=d.slice(1).trim().replace(Pm[2],"$1###$2").split(Pm[3]),h=d.charAt(0),f=[h],k=0,m=e.length;k<m;++k)(g=+e[k])===g&&f.push(g);i=_X[h.toLowerCase()];if(f.length-1>i)for(k=1,m=f.length;k<m;k+=i)b.push([h].concat(f.slice(k,k+i)));else b.push(f)}return b}const se=Math.PI/180,$X=1e-14,sg=Math.PI/2,Ld=Math.PI*2,Nh=Math.sqrt(3)/2;var ct={},dt={},wD=[].join;function aY(a,b,c,d,e,f,g,h,i){var j=wD.call(arguments);if(ct[j])return ct[j];var k=g*se,l=Math.sin(k),m=Math.cos(k);c=Math.abs(c),d=Math.abs(d);var n=m*(h-a)*.5+l*(i-b)*.5,o=m*(i-b)*.5-l*(h-a)*.5,p=n*n/(c*c)+o*o/(d*d);p>1&&(p=Math.sqrt(p),c*=p,d*=p);var q=m/c,r=l/c,s=-l/d,t=m/d,w=q*h+r*i,v=s*h+t*i,x=q*a+r*b,u=s*a+t*b,z=(x-w)*(x-w)+(u-v)*(u-v),y=1/z-.25;y<0&&(y=0);var B=Math.sqrt(y);f==e&&(B=-B);var A=.5*(w+x)-B*(u-v),C=.5*(v+u)+B*(x-w),F=Math.atan2(v-C,w-A),K=Math.atan2(u-C,x-A),D=K-F;D<0&&f===1?D+=Ld:D>0&&f===0&&(D-=Ld);for(var I=Math.ceil(Math.abs(D/(sg+.001))),S=[],X=0;X<I;++X){var Y=F+X*D/I,wa=F+(X+1)*D/I;S[X]=[A,C,Y,wa,c,d,l,m]}return ct[j]=S}function bY(a){var b=wD.call(a);if(dt[b])return dt[b];var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=j*g,l=-i*h,m=i*g,n=j*h,o=Math.cos(e),p=Math.sin(e),q=Math.cos(f),r=Math.sin(f),s=.5*(f-e),t=Math.sin(s*.5),w=8/3*t*t/Math.sin(s),v=c+o-w*p,x=d+p+w*o,u=c+q,z=d+r,y=u+w*r,B=z-w*q;return dt[b]=[k*v+l*x,m*v+n*x,k*y+l*B,m*y+n*B,k*u+l*z,m*u+n*z]}var Sc=["l",0,0,0,0,0,0,0];function cY(a,b,c){var d=Sc[0]=a[0];if(d==="a"||d==="A")Sc[1]=b*a[1],Sc[2]=c*a[2],Sc[3]=a[3],Sc[4]=a[4],Sc[5]=a[5],Sc[6]=b*a[6],Sc[7]=c*a[7];else if(d==="h"||d==="H")Sc[1]=b*a[1];else if(d==="v"||d==="V")Sc[1]=c*a[1];else for(var e=1,f=a.length;e<f;++e)Sc[e]=(e%2==1?b:c)*a[e];return Sc}function wj(a,b,c,d,e,f){var g,h=null,i=0,j=0,k=0,l=0,m,n,o,p;c==null&&(c=0),d==null&&(d=0),e==null&&(e=1),f==null&&(f=e),a.beginPath&&a.beginPath();for(var q=0,r=b.length;q<r;++q){g=b[q],(e!==1||f!==1)&&(g=cY(g,e,f));switch(g[0]){case"l":i+=g[1],j+=g[2],a.lineTo(i+c,j+d);break;case"L":i=g[1],j=g[2],a.lineTo(i+c,j+d);break;case"h":i+=g[1],a.lineTo(i+c,j+d);break;case"H":i=g[1],a.lineTo(i+c,j+d);break;case"v":j+=g[1],a.lineTo(i+c,j+d);break;case"V":j=g[1],a.lineTo(i+c,j+d);break;case"m":i+=g[1],j+=g[2],a.moveTo(i+c,j+d);break;case"M":i=g[1],j=g[2],a.moveTo(i+c,j+d);break;case"c":m=i+g[5],n=j+g[6],k=i+g[3],l=j+g[4],a.bezierCurveTo(i+g[1]+c,j+g[2]+d,k+c,l+d,m+c,n+d),i=m,j=n;break;case"C":i=g[5],j=g[6],k=g[3],l=g[4],a.bezierCurveTo(g[1]+c,g[2]+d,k+c,l+d,i+c,j+d);break;case"s":m=i+g[3],n=j+g[4],k=2*i-k,l=2*j-l,a.bezierCurveTo(k+c,l+d,i+g[1]+c,j+g[2]+d,m+c,n+d),k=i+g[1],l=j+g[2],i=m,j=n;break;case"S":m=g[3],n=g[4],k=2*i-k,l=2*j-l,a.bezierCurveTo(k+c,l+d,g[1]+c,g[2]+d,m+c,n+d),i=m,j=n,k=g[1],l=g[2];break;case"q":m=i+g[3],n=j+g[4],k=i+g[1],l=j+g[2],a.quadraticCurveTo(k+c,l+d,m+c,n+d),i=m,j=n;break;case"Q":m=g[3],n=g[4],a.quadraticCurveTo(g[1]+c,g[2]+d,m+c,n+d),i=m,j=n,k=g[1],l=g[2];break;case"t":m=i+g[1],n=j+g[2],h[0].match(/[QqTt]/)===null?(k=i,l=j):h[0]==="t"?(k=2*i-o,l=2*j-p):h[0]==="q"&&(k=2*i-k,l=2*j-l),o=k,p=l,a.quadraticCurveTo(k+c,l+d,m+c,n+d),i=m,j=n,k=i+g[1],l=j+g[2];break;case"T":m=g[1],n=g[2],k=2*i-k,l=2*j-l,a.quadraticCurveTo(k+c,l+d,m+c,n+d),i=m,j=n;break;case"a":xD(a,i+c,j+d,[g[1],g[2],g[3],g[4],g[5],g[6]+i+c,g[7]+j+d]),i+=g[6],j+=g[7];break;case"A":xD(a,i+c,j+d,[g[1],g[2],g[3],g[4],g[5],g[6]+c,g[7]+d]),i=g[6],j=g[7];break;case"z":case"Z":a.closePath();break}h=g}}function xD(a,b,c,d){for(var e=aY(d[5],d[6],d[0],d[1],d[3],d[4],d[2],b,c),f=0;f<e.length;++f){var g=bY(e[f]);a.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5])}}var yD=.5773502691896257,zD={circle:{draw:function(a,b){var c=Math.sqrt(b)/2;a.moveTo(c,0),a.arc(0,0,c,0,Ld)}},cross:{draw:function(a,b){var c=Math.sqrt(b)/2,d=c/2.5;a.moveTo(-c,-d),a.lineTo(-c,d),a.lineTo(-d,d),a.lineTo(-d,c),a.lineTo(d,c),a.lineTo(d,d),a.lineTo(c,d),a.lineTo(c,-d),a.lineTo(d,-d),a.lineTo(d,-c),a.lineTo(-d,-c),a.lineTo(-d,-d),a.closePath()}},diamond:{draw:function(a,b){var c=Math.sqrt(b)/2;a.moveTo(-c,0),a.lineTo(0,-c),a.lineTo(c,0),a.lineTo(0,c),a.closePath()}},square:{draw:function(a,b){var c=Math.sqrt(b),d=-c/2;a.rect(d,d,c,c)}},arrow:{draw:function(a,b){var c=Math.sqrt(b)/2,d=c/7,e=c/2.5,f=c/8;a.moveTo(-d,c),a.lineTo(d,c),a.lineTo(d,-f),a.lineTo(e,-f),a.lineTo(0,-c),a.lineTo(-e,-f),a.lineTo(-d,-f),a.closePath()}},wedge:{draw:function(a,b){var c=Math.sqrt(b)/2,d=Nh*c,e=d-c*yD,f=c/4;a.moveTo(0,-d-e),a.lineTo(-f,d-e),a.lineTo(f,d-e),a.closePath()}},triangle:{draw:function(a,b){var c=Math.sqrt(b)/2,d=Nh*c,e=d-c*yD;a.moveTo(0,-d-e),a.lineTo(-c,d-e),a.lineTo(c,d-e),a.closePath()}},"triangle-up":{draw:function(a,b){var c=Math.sqrt(b)/2,d=Nh*c;a.moveTo(0,-d),a.lineTo(-c,d),a.lineTo(c,d),a.closePath()}},"triangle-down":{draw:function(a,b){var c=Math.sqrt(b)/2,d=Nh*c;a.moveTo(0,d),a.lineTo(-c,-d),a.lineTo(c,-d),a.closePath()}},"triangle-right":{draw:function(a,b){var c=Math.sqrt(b)/2,d=Nh*c;a.moveTo(d,0),a.lineTo(-d,-c),a.lineTo(-d,c),a.closePath()}},"triangle-left":{draw:function(a,b){var c=Math.sqrt(b)/2,d=Nh*c;a.moveTo(-d,0),a.lineTo(d,-c),a.lineTo(d,c),a.closePath()}},stroke:{draw:function(a,b){var c=Math.sqrt(b)/2;a.moveTo(-c,0),a.lineTo(c,0)}}};function AD(a){return _(zD,a)?zD[a]:dY(a)}var et={};function dY(a){if(!_(et,a)){var b=Mh(a);et[a]={draw:function(c,d){wj(c,b,0,0,Math.sqrt(d)/2)}}}return et[a]}const hf=.448084975506;function eY(a){return a.x}function fY(a){return a.y}function gY(a){return a.width}function hY(a){return a.height}function te(a){return typeof a==="function"?a:()=>+a}function Qm(a,b,c){return Math.max(b,Math.min(a,c))}function BD(){var a=eY,b=fY,c=gY,d=hY,e=te(0),f=e,g=e,h=e,i=null;function j(k,l,m){var n,o=l!=null?l:+a.call(this,k),p=m!=null?m:+b.call(this,k),q=+c.call(this,k),r=+d.call(this,k),s=Math.min(q,r)/2,t=Qm(+e.call(this,k),0,s),w=Qm(+f.call(this,k),0,s),v=Qm(+g.call(this,k),0,s),x=Qm(+h.call(this,k),0,s);i||(i=n=qg());if(t<=0&&w<=0&&v<=0&&x<=0)i.rect(o,p,q,r);else{var u=o+q,z=p+r;i.moveTo(o+t,p),i.lineTo(u-w,p),i.bezierCurveTo(u-hf*w,p,u,p+hf*w,u,p+w),i.lineTo(u,z-x),i.bezierCurveTo(u,z-hf*x,u-hf*x,z,u-x,z),i.lineTo(o+v,z),i.bezierCurveTo(o+hf*v,z,o,z-hf*v,o,z-v),i.lineTo(o,p+t),i.bezierCurveTo(o,p+hf*t,o+hf*t,p,o+t,p),i.closePath()}if(n)return i=null,n+""||null}return j.x=function(k){return arguments.length?(a=te(k),j):a},j.y=function(k){return arguments.length?(b=te(k),j):b},j.width=function(k){return arguments.length?(c=te(k),j):c},j.height=function(k){return arguments.length?(d=te(k),j):d},j.cornerRadius=function(k,l,m,n){return arguments.length?(e=te(k),f=l!=null?te(l):e,h=m!=null?te(m):e,g=n!=null?te(n):f,j):e},j.context=function(k){return arguments.length?(i=k==null?null:k,j):i},j}function CD(){var a,b,c,d,e=null,f,g,h,i;function j(l,m,n){var o=n/2;if(f){var p=h-m,q=l-g;if(p||q){var r=Math.sqrt(p*p+q*q),s=(p/=r)*i,t=(q/=r)*i,w=Math.atan2(q,p);e.moveTo(g-s,h-t),e.lineTo(l-p*o,m-q*o),e.arc(l,m,o,w-Math.PI,w),e.lineTo(g+s,h+t),e.arc(g,h,i,w,w+Math.PI)}else e.arc(l,m,o,0,Ld);e.closePath()}else f=1;g=l,h=m,i=o}function k(l){var m,n=l.length,o,p=!1,q;for(e==null&&(e=q=qg()),m=0;m<=n;++m)!(m<n&&d(o=l[m],m,l))===p&&((p=!p)&&(f=0)),p&&j(+a(o,m,l),+b(o,m,l),+c(o,m,l));if(q)return e=null,q+""||null}return k.x=function(l){return arguments.length?(a=l,k):a},k.y=function(l){return arguments.length?(b=l,k):b},k.size=function(l){return arguments.length?(c=l,k):c},k.defined=function(l){return arguments.length?(d=l,k):d},k.context=function(l){return arguments.length?(l==null?e=null:e=l,k):e},k}function xj(a,b){return a!=null?a:b}const yj=a=>a.x||0,zj=a=>a.y||0,iY=a=>a.width||0,jY=a=>a.height||0,kY=a=>(a.x||0)+(a.width||0),lY=a=>(a.y||0)+(a.height||0),mY=a=>a.startAngle||0,nY=a=>a.endAngle||0,oY=a=>a.padAngle||0,pY=a=>a.innerRadius||0,qY=a=>a.outerRadius||0,rY=a=>a.cornerRadius||0,sY=a=>xj(a.cornerRadiusTopLeft,a.cornerRadius)||0,tY=a=>xj(a.cornerRadiusTopRight,a.cornerRadius)||0,uY=a=>xj(a.cornerRadiusBottomRight,a.cornerRadius)||0,vY=a=>xj(a.cornerRadiusBottomLeft,a.cornerRadius)||0,wY=a=>xj(a.size,64),xY=a=>a.size||1,Rm=a=>!(a.defined===!1),yY=a=>AD(a.shape||"circle"),zY=GX().startAngle(mY).endAngle(nY).padAngle(oY).innerRadius(pY).outerRadius(qY).cornerRadius(rY),AY=gD().x(yj).y1(zj).y0(lY).defined(Rm),BY=gD().y(zj).x1(yj).x0(kY).defined(Rm),CY=fD().x(yj).y(zj).defined(Rm),DY=BD().x(yj).y(zj).width(iY).height(jY).cornerRadius(sY,tY,uY,vY),EY=IX().type(yY).size(wY),FY=CD().x(yj).y(zj).defined(Rm).size(xY);function ft(a){return a.cornerRadius||a.cornerRadiusTopLeft||a.cornerRadiusTopRight||a.cornerRadiusBottomRight||a.cornerRadiusBottomLeft}function GY(a,b){return zY.context(a)(b)}function HY(a,b){var c=b[0],d=c.interpolate||"linear";return(c.orient==="horizontal"?BY:AY).curve(bt(d,c.orient,c.tension)).context(a)(b)}function IY(a,b){var c=b[0],d=c.interpolate||"linear";return CY.curve(bt(d,c.orient,c.tension)).context(a)(b)}function Oh(a,b,c,d){return DY.context(a)(b,c,d)}function JY(a,b){return(b.mark.shape||b.shape).context(a)(b)}function KY(a,b){return EY.context(a)(b)}function LY(a,b){return FY.context(a)(b)}var DD=1;function ED(){DD=1}function gt(a,b,c){var d=b.clip,e=a._defs,f=b.clip_id||(b.clip_id="clip"+DD++),g=e.clipping[f]||(e.clipping[f]={id:f});return pa(d)?g.path=d(null):ft(c)?g.path=Oh(null,c,0,0):(g.width=c.width||0,g.height=c.height||0),"url(#"+f+")"}function gb(a){this.clear(),a&&this.union(a)}var cb=gb.prototype;cb.clone=function(){return new gb(this)},cb.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},cb.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},cb.equals=function(a){return this.x1===a.x1&&this.y1===a.y1&&this.x2===a.x2&&this.y2===a.y2},cb.set=function(a,b,c,d){return c<a?(this.x2=a,this.x1=c):(this.x1=a,this.x2=c),d<b?(this.y2=b,this.y1=d):(this.y1=b,this.y2=d),this},cb.add=function(a,b){return a<this.x1&&(this.x1=a),b<this.y1&&(this.y1=b),a>this.x2&&(this.x2=a),b>this.y2&&(this.y2=b),this},cb.expand=function(a){return this.x1-=a,this.y1-=a,this.x2+=a,this.y2+=a,this},cb.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},cb.scale=function(a){return this.x1*=a,this.y1*=a,this.x2*=a,this.y2*=a,this},cb.translate=function(a,b){return this.x1+=a,this.x2+=a,this.y1+=b,this.y2+=b,this},cb.rotate=function(a,b,c){const d=this.rotatedPoints(a,b,c);return this.clear().add(d[0],d[1]).add(d[2],d[3]).add(d[4],d[5]).add(d[6],d[7])},cb.rotatedPoints=function(a,b,c){var{x1:d,y1:e,x2:f,y2:g}=this,h=Math.cos(a),i=Math.sin(a),j=b-b*h+c*i,k=c-b*i-c*h;return[h*d-i*e+j,i*d+h*e+k,h*d-i*g+j,i*d+h*g+k,h*f-i*e+j,i*f+h*e+k,h*f-i*g+j,i*f+h*g+k]},cb.union=function(a){return a.x1<this.x1&&(this.x1=a.x1),a.y1<this.y1&&(this.y1=a.y1),a.x2>this.x2&&(this.x2=a.x2),a.y2>this.y2&&(this.y2=a.y2),this},cb.intersect=function(a){return a.x1>this.x1&&(this.x1=a.x1),a.y1>this.y1&&(this.y1=a.y1),a.x2<this.x2&&(this.x2=a.x2),a.y2<this.y2&&(this.y2=a.y2),this},cb.encloses=function(a){return a&&(this.x1<=a.x1&&this.x2>=a.x2&&this.y1<=a.y1&&this.y2>=a.y2)},cb.alignsWith=function(a){return a&&(this.x1==a.x1||this.x2==a.x2||this.y1==a.y1||this.y2==a.y2)},cb.intersects=function(a){return a&&!(this.x2<a.x1||this.x1>a.x2||this.y2<a.y1||this.y1>a.y2)},cb.contains=function(a,b){return!(a<this.x1||a>this.x2||b<this.y1||b>this.y2)},cb.width=function(){return this.x2-this.x1},cb.height=function(){return this.y2-this.y1};function Sm(a){this.mark=a,this.bounds=this.bounds||new gb()}function Tm(a){Sm.call(this,a),this.items=this.items||[]}N(Tm,Sm);function Aj(a,b){if(typeof document!=="undefined"&&document.createElement){var c=document.createElement("canvas");if(c&&c.getContext)return c.width=a,c.height=b,c}return null}function MY(){return typeof Image!=="undefined"?Image:null}function ht(a){this._pending=0,this._loader=a||vm()}var Um=ht.prototype;Um.pending=function(){return this._pending};function FD(a){a._pending+=1}function Bj(a){a._pending-=1}Um.sanitizeURL=function(a){var b=this;return FD(b),b._loader.sanitize(a,{context:"href"}).then(function(c){return Bj(b),c}).catch(function(){return Bj(b),null})},Um.loadImage=function(a){const b=this,c=MY();return FD(b),b._loader.sanitize(a,{context:"image"}).then(function(d){const e=d.href;if(!e||!c)throw{url:e};const f=new c(),g=_(d,"crossOrigin")?d.crossOrigin:"anonymous";return g!=null&&(f.crossOrigin=g),f.onload=()=>Bj(b),f.onerror=()=>Bj(b),f.src=e,f}).catch(function(d){return Bj(b),{complete:!1,width:0,height:0,src:d&&d.url||""}})},Um.ready=function(){var a=this;return new Promise(function(b){function c(d){a.pending()?setTimeout(function(){c(!0)},10):b(d)}c(!1)})};function ue(a,b,c){if(b.stroke&&b.opacity!==0&&b.strokeOpacity!==0){const d=b.strokeWidth!=null?+b.strokeWidth:1;a.expand(d+(c?NY(b,d):0))}return a}function NY(a,b){return a.strokeJoin&&a.strokeJoin!=="miter"?0:b}var Vm,Wm,Xm,OY=Ld-1e-8;function mc(a){return Vm=a,mc}function GD(){}function tg(a,b){Vm.add(a,b)}function Cj(a,b){tg(Wm=a,Xm=b)}function HD(a){tg(a,Vm.y1)}function ID(a){tg(Vm.x1,a)}mc.beginPath=GD,mc.closePath=GD,mc.moveTo=Cj,mc.lineTo=Cj,mc.rect=function(a,b,c,d){tg(a+c,b+d),Cj(a,b)},mc.quadraticCurveTo=function(a,b,c,d){JD(Wm,a,c,HD),JD(Xm,b,d,ID),Cj(c,d)};function JD(a,b,c,d){const e=(a-b)/(a+c-2*b);0<e&&e<1&&d(a+(b-a)*e)}mc.bezierCurveTo=function(a,b,c,d,e,f){KD(Wm,a,c,e,HD),KD(Xm,b,d,f,ID),Cj(e,f)};function KD(a,b,c,d,e){const f=d-a+3*b-3*c,g=a+c-2*b,h=a-b;let i=0,j=0,k;Math.abs(f)>$X?(k=g*g+h*f,k>=0&&(k=Math.sqrt(k),i=(-g+k)/f,j=(-g-k)/f)):i=.5*h/g,0<i&&i<1&&e(LD(i,a,b,c,d)),0<j&&j<1&&e(LD(j,a,b,c,d))}function LD(a,b,c,d,e){const f=1-a,g=f*f,h=a*a;return g*f*b+3*g*a*c+3*f*h*d+h*a*e}mc.arc=function(a,b,c,d,e,f){Wm=c*Math.cos(e)+a,Xm=c*Math.sin(e)+b;if(Math.abs(e-d)>OY)tg(a-c,b-c),tg(a+c,b+c);else{const g=j=>tg(c*Math.cos(j)+a,c*Math.sin(j)+b);let h,i;g(d),g(e);if(e!==d){d=d%Ld,d<0&&(d+=Ld),e=e%Ld,e<0&&(e+=Ld),e<d&&(f=!f,h=d,d=e,e=h);if(f)for(e-=Ld,h=d-d%sg,i=0;i<4&&h>e;++i,h-=sg)g(h);else for(h=d-d%sg+sg,i=0;i<4&&h<e;++i,h=h+sg)g(h)}}};var jf=(jf=Aj(1,1))?jf.getContext("2d"):null;const it=new gb();function jt(a){return function(b,c){if(!jf)return!0;a(jf,b),it.clear().union(b.bounds).intersect(c).round();const{x1:d,y1:e,x2:f,y2:g}=it;for(let h=e;h<=g;++h)for(let i=d;i<=f;++i)if(jf.isPointInPath(i,h))return!0;return!1}}function kt(a,b){return b.contains(a.x||0,a.y||0)}function MD(a,b){const c=a.x||0,d=a.y||0,e=a.width||0,f=a.height||0;return b.intersects(it.set(c,d,c+e,d+f))}function ND(a,b){const c=a.x||0,d=a.y||0,e=a.x2!=null?a.x2:c,f=a.y2!=null?a.y2:d;return Ph(b,c,d,e,f)}function Ph(a,b,c,d,e){const{x1:f,y1:g,x2:h,y2:i}=a,j=d-b,k=e-c;let l=0,m=1,n,o,p,q;for(q=0;q<4;++q){q===0&&(n=-j,o=-(f-b)),q===1&&(n=j,o=h-b),q===2&&(n=-k,o=-(g-c)),q===3&&(n=k,o=i-c);if(Math.abs(n)<1e-10&&o<0)return!1;p=o/n;if(n<0){if(p>m)return!1;p>l&&(l=p)}else if(n>0){if(p<l)return!1;p<m&&(m=p)}}return!0}function Qh(a,b){a.globalCompositeOperation=b.blend||"source-over"}function ld(a,b){return a==null?b:a}function OD(a,b){const c=b.length;for(let d=0;d<c;++d)a.addColorStop(b[d].offset,b[d].color);return a}function PY(a,b,c){const d=c.width(),e=c.height();let f;if(b.gradient==="radial")f=a.createRadialGradient(c.x1+ld(b.x1,.5)*d,c.y1+ld(b.y1,.5)*e,Math.max(d,e)*ld(b.r1,0),c.x1+ld(b.x2,.5)*d,c.y1+ld(b.y2,.5)*e,Math.max(d,e)*ld(b.r2,.5));else{const g=ld(b.x1,0),h=ld(b.y1,0),i=ld(b.x2,1),j=ld(b.y2,0);if(g===i||h===j||d===e)f=a.createLinearGradient(c.x1+g*d,c.y1+h*e,c.x1+i*d,c.y1+j*e);else{const k=Aj(Math.ceil(d),Math.ceil(e)),l=k.getContext("2d");return l.scale(d,e),l.fillStyle=OD(l.createLinearGradient(g,h,i,j),b.stops),l.fillRect(0,0,d,e),a.createPattern(k,"no-repeat")}}return OD(f,b.stops)}function PD(a,b,c){return Ss(c)?PY(a,c,b.bounds):c}function Ym(a,b,c){return c*=b.fillOpacity==null?1:b.fillOpacity,c>0?(a.globalAlpha=c,a.fillStyle=PD(a,b,b.fill),!0):!1}var QY=[];function Rh(a,b,c){var d=(d=b.strokeWidth)!=null?d:1;return d<=0?!1:(c*=b.strokeOpacity==null?1:b.strokeOpacity,c>0?(a.globalAlpha=c,a.strokeStyle=PD(a,b,b.stroke),a.lineWidth=d,a.lineCap=b.strokeCap||"butt",a.lineJoin=b.strokeJoin||"miter",a.miterLimit=b.strokeMiterLimit||10,a.setLineDash&&(a.setLineDash(b.strokeDash||QY),a.lineDashOffset=b.strokeDashOffset||0),!0):!1)}function RY(a,b){return a.zindex-b.zindex||a.index-b.index}function lt(a){if(!a.zdirty)return a.zitems;var b=a.items,c=[],d,e,f;for(e=0,f=b.length;e<f;++e)d=b[e],d.index=e,d.zindex&&c.push(d);return a.zdirty=!1,a.zitems=c.sort(RY)}function md(a,b){var c=a.items,d,e;if(!c||!c.length)return;var f=lt(a);if(f&&f.length){for(d=0,e=c.length;d<e;++d)c[d].zindex||b(c[d]);c=f}for(d=0,e=c.length;d<e;++d)b(c[d])}function Zm(a,b){var c=a.items,d,e;if(!c||!c.length)return null;var f=lt(a);for(f&&f.length&&(c=f),e=c.length;--e>=0;)if(d=b(c[e]))return d;if(c===f){for(c=a.items,e=c.length;--e>=0;)if(!c[e].zindex){if(d=b(c[e]))return d}}return null}function mt(a){return function(b,c,d){md(c,function(e){(!d||d.intersects(e.bounds))&&QD(a,b,e,e)})}}function SY(a){return function(b,c,d){c.items.length&&(!d||d.intersects(c.bounds))&&QD(a,b,c.items[0],c.items)}}function QD(a,b,c,d){var e=c.opacity==null?1:c.opacity;if(e===0)return;if(a(b,d))return;Qh(b,c),c.fill&&Ym(b,c,e)&&b.fill(),c.stroke&&Rh(b,c,e)&&b.stroke()}function _m(a){return a=a||Gd,function(b,c,d,e,f,g){return d*=b.pixelRatio,e*=b.pixelRatio,Zm(c,function(h){var i=h.bounds;if(i&&!i.contains(f,g)||!i)return;if(a(b,h,d,e,f,g))return h})}}function $m(a,b){return function(c,d,e,f){var g=Array.isArray(d)?d[0]:d,h=b==null?g.fill:b,i=g.stroke&&c.isPointInStroke,j,k;return i&&(j=g.strokeWidth,k=g.strokeCap,c.lineWidth=j!=null?j:1,c.lineCap=k!=null?k:"butt"),a(c,d)?!1:h&&c.isPointInPath(e,f)||i&&c.isPointInStroke(e,f)}}function nt(a){return _m($m(a))}function Sh(a,b){return"translate("+a+","+b+")"}function RD(a){return"rotate("+a+")"}function TY(a,b){return"scale("+a+","+b+")"}function SD(a){return Sh(a.x||0,a.y||0)}function TD(a){return Sh(a.x||0,a.y||0)+(a.angle?" "+RD(a.angle):"")+(a.scaleX||a.scaleY?" "+TY(a.scaleX||1,a.scaleY||1):"")}function ot(a,b,c){function d(g,h){g("transform",TD(h)),g("d",b(null,h))}function e(g,h){var i=h.x||0,j=h.y||0;return b(mc(g),h),ue(g,h).translate(i,j),h.angle&&g.rotate(h.angle*se,i,j),g}function f(g,h){var i=h.x||0,j=h.y||0,k=h.angle||0;g.translate(i,j),k&&g.rotate(k*=se),g.beginPath(),b(g,h),k&&g.rotate(-k),g.translate(-i,-j)}return{type:a,tag:"path",nested:!1,attr:d,bound:e,draw:mt(f),pick:nt(f),isect:c||jt(f)}}var UY=ot("arc",GY);function VY(a,b){for(var c=a[0].orient==="horizontal"?b[1]:b[0],d=a[0].orient==="horizontal"?"y":"x",e=a.length,f=Infinity,g,h;--e>=0;){if(a[e].defined===!1)continue;h=Math.abs(a[e][d]-c),h<f&&(f=h,g=a[e])}return g}function WY(a,b){for(var c=Math.pow(a[0].strokeWidth||1,2),d=a.length,e,f,g;--d>=0;){if(a[d].defined===!1)continue;e=a[d].x-b[0],f=a[d].y-b[1],g=e*e+f*f;if(g<c)return a[d]}return null}function XY(a,b){for(var c=a.length,d,e,f;--c>=0;){if(a[c].defined===!1)continue;d=a[c].x-b[0],e=a[c].y-b[1],f=d*d+e*e,d=a[c].size||1;if(f<d*d)return a[c]}return null}function pt(a,b,c){function d(i,j){var k=j.mark.items;k.length&&i("d",b(null,k))}function e(i,j){var k=j.items;return k.length===0?i:(b(mc(i),k),ue(i,k[0]))}function f(i,j){i.beginPath(),b(i,j)}var g=$m(f);function h(i,j,k,l,m,n){var o=j.items,p=j.bounds;return!o||!o.length||p&&!p.contains(m,n)?null:(k*=i.pixelRatio,l*=i.pixelRatio,g(i,o,k,l)?o[0]:null)}return{type:a,tag:"path",nested:!0,attr:d,bound:e,draw:SY(f),pick:h,isect:kt,tip:c}}var YY=pt("area",HY,VY);function ZY(a,b){var c=b.clip;a.save(),pa(c)?(a.beginPath(),c(a),a.clip()):UD(a,b.group)}function UD(a,b){a.beginPath(),ft(b)?Oh(a,b,0,0):a.rect(0,0,b.width||0,b.height||0),a.clip()}function VD(a){const b=ld(a.strokeWidth,1);return a.strokeOffset!=null?a.strokeOffset:a.stroke&&b>.5&&b<1.5?.5-Math.abs(b-1):0}function _Y(a,b){a("transform",SD(b))}function WD(a,b){const c=VD(b);a("d",Oh(null,b,c,c))}function $Y(a,b){a("class","background"),a("aria-hidden",!0),WD(a,b)}function aZ(a,b){a("class","foreground"),a("aria-hidden",!0),b.strokeForeground?WD(a,b):a("d","")}function bZ(a,b,c){const d=b.clip?gt(c,b,b):null;a("clip-path",d)}function cZ(a,b){if(!b.clip&&b.items){const c=b.items,d=c.length;for(let e=0;e<d;++e)a.union(c[e].bounds)}return(b.clip||b.width||b.height)&&!b.noBound&&a.add(0,0).add(b.width||0,b.height||0),ue(a,b),a.translate(b.x||0,b.y||0)}function an(a,b,c,d){const e=VD(b);a.beginPath(),Oh(a,b,(c||0)+e,(d||0)+e)}const XD=$m(an),dZ=$m(an,!1);function eZ(a,b,c){md(b,d=>{const e=d.x||0,f=d.y||0,g=d.strokeForeground,h=d.opacity==null?1:d.opacity;(d.stroke||d.fill)&&h&&(an(a,d,e,f),Qh(a,d),d.fill&&Ym(a,d,h)&&a.fill(),d.stroke&&!g&&Rh(a,d,h)&&a.stroke()),a.save(),a.translate(e,f),d.clip&&UD(a,d),c&&c.translate(-e,-f),md(d,i=>{this.draw(a,i,c)}),c&&c.translate(e,f),a.restore(),g&&d.stroke&&h&&(an(a,d,e,f),Qh(a,d),Rh(a,d,h)&&a.stroke())})}function fZ(a,b,c,d,e,f){if(b.bounds&&!b.bounds.contains(e,f)||!b.items)return null;const g=c*a.pixelRatio,h=d*a.pixelRatio;return Zm(b,i=>{let j,k,l,m,n,o,p,q,r;return q=i.bounds,q&&!q.contains(e,f)?void 0:(m=i.x||0,n=i.y||0,o=m+(i.width||0),p=n+(i.height||0),r=i.clip,r&&(e<m||e>o||f<n||f>p)?void 0:(a.save(),a.translate(m,n),m=e-m,n=f-n,r&&ft(i)&&!XD(a,i,g,h)?(a.restore(),null):(k=i.strokeForeground,l=b.interactive!==!1,l&&k&&i.stroke&&dZ(a,i,g,h)?(a.restore(),i):(j=Zm(i,s=>gZ(s,m,n)?this.pick(s,c,d,m,n):null),!j&&l&&(i.fill||!k&&i.stroke)&&XD(a,i,g,h)&&(j=i),a.restore(),j||null))))})}function gZ(a,b,c){return(a.interactive!==!1||a.marktype==="group")&&a.bounds&&a.bounds.contains(b,c)}var hZ={type:"group",tag:"g",nested:!1,attr:_Y,bound:cZ,draw:eZ,pick:fZ,isect:MD,content:bZ,background:$Y,foreground:aZ},Th={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function qt(a,b){var c=a.image;return(!c||a.url&&a.url!==c.url)&&(c={complete:!1,width:0,height:0},b.loadImage(a.url).then(d=>{a.image=d,a.image.url=a.url})),c}function rt(a,b){return a.width!=null?a.width:!b||!b.width?0:a.aspect!==!1&&a.height?a.height*b.width/b.height:b.width}function st(a,b){return a.height!=null?a.height:!b||!b.height?0:a.aspect!==!1&&a.width?a.width*b.height/b.width:b.height}function bn(a,b){return a==="center"?b/2:a==="right"?b:0}function cn(a,b){return a==="middle"?b/2:a==="bottom"?b:0}function iZ(a,b,c){const d=qt(b,c),e=rt(b,d),f=st(b,d),g=(b.x||0)-bn(b.align,e),h=(b.y||0)-cn(b.baseline,f),i=!d.src&&d.toDataURL?d.toDataURL():d.src||"";a("href",i,Th["xmlns:xlink"],"xlink:href"),a("transform",Sh(g,h)),a("width",e),a("height",f),a("preserveAspectRatio",b.aspect===!1?"none":"xMidYMid")}function jZ(a,b){const c=b.image,d=rt(b,c),e=st(b,c),f=(b.x||0)-bn(b.align,d),g=(b.y||0)-cn(b.baseline,e);return a.set(f,g,f+d,g+e)}function kZ(a,b,c){md(b,d=>{if(c&&!c.intersects(d.bounds))return;let e=qt(d,this),f=rt(d,e),g=st(d,e),h=(d.x||0)-bn(d.align,f),i=(d.y||0)-cn(d.baseline,g),j,k,l,m;d.aspect!==!1&&(k=e.width/e.height,l=d.width/d.height,k===k&&l===l&&k!==l&&(l<k?(m=f/k,i+=(g-m)/2,g=m):(m=g*k,h+=(f-m)/2,f=m))),(e.complete||e.toDataURL)&&(Qh(a,d),a.globalAlpha=(j=d.opacity)!=null?j:1,a.imageSmoothingEnabled=d.smooth!==!1,a.drawImage(e,h,i,f,g))})}var lZ={type:"image",tag:"image",nested:!1,attr:iZ,bound:jZ,draw:kZ,pick:_m(),isect:Gd,get:qt,xOffset:bn,yOffset:cn},mZ=pt("line",IY,WY);function nZ(a,b){var c=b.scaleX||1,d=b.scaleY||1;(c!==1||d!==1)&&a("vector-effect","non-scaling-stroke"),a("transform",TD(b)),a("d",b.path)}function dn(a,b){var c=b.path;if(c==null)return!0;var d=b.x||0,e=b.y||0,f=b.scaleX||1,g=b.scaleY||1,h=(b.angle||0)*se,i=b.pathCache;(!i||i.path!==c)&&((b.pathCache=i=Mh(c)).path=c),h&&a.rotate&&a.translate?(a.translate(d,e),a.rotate(h),wj(a,i,0,0,f,g),a.rotate(-h),a.translate(-d,-e)):wj(a,i,d,e,f,g)}function oZ(a,b){return dn(mc(a),b)?a.set(0,0,0,0):ue(a,b,!0),b.angle&&a.rotate(b.angle*se,b.x||0,b.y||0),a}var pZ={type:"path",tag:"path",nested:!1,attr:nZ,bound:oZ,draw:mt(dn),pick:nt(dn),isect:jt(dn)};function qZ(a,b){a("d",Oh(null,b))}function rZ(a,b){var c,d;return ue(a.set(c=b.x||0,d=b.y||0,c+b.width||0,d+b.height||0),b)}function YD(a,b){a.beginPath(),Oh(a,b)}var sZ={type:"rect",tag:"path",nested:!1,attr:qZ,bound:rZ,draw:mt(YD),pick:nt(YD),isect:MD};function tZ(a,b){a("transform",SD(b)),a("x2",b.x2!=null?b.x2-(b.x||0):0),a("y2",b.y2!=null?b.y2-(b.y||0):0)}function uZ(a,b){var c,d;return ue(a.set(c=b.x||0,d=b.y||0,b.x2!=null?b.x2:c,b.y2!=null?b.y2:d),b)}function ZD(a,b,c){var d,e,f,g;return b.stroke&&Rh(a,b,c)?(d=b.x||0,e=b.y||0,f=b.x2!=null?b.x2:d,g=b.y2!=null?b.y2:e,a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),!0):!1}function vZ(a,b,c){md(b,function(d){if(c&&!c.intersects(d.bounds))return;var e=d.opacity==null?1:d.opacity;e&&ZD(a,d,e)&&(Qh(a,d),a.stroke())})}function wZ(a,b,c,d){return a.isPointInStroke?ZD(a,b,1)&&a.isPointInStroke(c,d):!1}var xZ={type:"rule",tag:"line",nested:!1,attr:tZ,bound:uZ,draw:vZ,pick:_m(wZ),isect:ND},yZ=ot("shape",JY),zZ=ot("symbol",KY,kt);const _D=WS();var Uh={height:Md,measureWidth:ut,estimateWidth:tt,width:tt,canvas:$D};$D(!0);function $D(a){Uh.width=a&&jf?ut:tt}function tt(a,b){return aE(lf(a,b),Md(a))}function aE(a,b){return~~(.8*a.length*b)}function ut(a,b){return Md(a)<=0||!(b=lf(a,b))?0:bE(b,en(a))}function bE(a,b){const c=`(${b}) ${a}`;let d=_D.get(c);return d===void 0&&(jf.font=b,d=jf.measureText(a).width,_D.set(c,d)),d}function Md(a){return a.fontSize!=null?+a.fontSize||0:11}function kf(a){return a.lineHeight!=null?a.lineHeight:Md(a)+2}function AZ(a){return J(a)?a.length>1?a:a[0]:a}function Dj(a){return AZ(a.lineBreak&&a.text&&!J(a.text)?a.text.split(a.lineBreak):a.text)}function vt(a){const b=Dj(a);return(J(b)?b.length-1:0)*kf(a)}function lf(a,b){const c=b==null?"":(b+"").trim();return a.limit>0&&c.length?CZ(a,c):c}function BZ(a){if(Uh.width===ut){const b=en(a);return c=>bE(c,b)}else{const b=Md(a);return c=>aE(c,b)}}function CZ(a,b){var c=+a.limit,d=BZ(a);if(d(b)<c)return b;var e=a.ellipsis||"…",f=a.dir==="rtl",g=0,h=b.length,i;c-=d(e);if(f){for(;g<h;)i=g+h>>>1,d(b.slice(i))>c?g=i+1:h=i;return e+b.slice(g)}else{for(;g<h;)i=1+(g+h>>>1),d(b.slice(0,i))<c?g=i:h=i-1;return b.slice(0,g)+e}}function Ej(a,b){var c=a.font;return(b&&c?String(c).replace(/"/g,"'"):c)||"sans-serif"}function en(a,b){return""+(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+Md(a)+"px "+Ej(a,b)}function wt(a){var b=a.baseline,c=Md(a);return Math.round(b==="top"?.79*c:b==="middle"?.3*c:b==="bottom"?-.21*c:b==="line-top"?.29*c+.5*kf(a):b==="line-bottom"?.29*c-.5*kf(a):0)}var DZ={left:"start",center:"middle",right:"end"},Fj=new gb();function fn(a){var b=a.x||0,c=a.y||0,d=a.radius||0,e;return d&&(e=(a.theta||0)-sg,b+=d*Math.cos(e),c+=d*Math.sin(e)),Fj.x1=b,Fj.y1=c,Fj}function EZ(a,b){var c=b.dx||0,d=(b.dy||0)+wt(b),e=fn(b),f=e.x1,g=e.y1,h=b.angle||0,i;a("text-anchor",DZ[b.align]||"start"),h?(i=Sh(f,g)+" "+RD(h),(c||d)&&(i+=" "+Sh(c,d))):i=Sh(f+c,g+d),a("transform",i)}function xt(a,b,c){var d=Uh.height(b),e=b.align,f=fn(b),g=f.x1,h=f.y1,i=b.dx||0,j=(b.dy||0)+wt(b)-Math.round(.8*d),k=Dj(b),l;J(k)?(d+=kf(b)*(k.length-1),l=k.reduce((m,n)=>Math.max(m,Uh.width(b,n)),0)):l=Uh.width(b,k),e==="center"?i-=l/2:e==="right"&&(i-=l),a.set(i+=g,j+=h,i+l,j+d);if(b.angle&&!c)a.rotate(b.angle*se,g,h);else if(c===2)return a.rotatedPoints(b.angle*se,g,h);return a}function FZ(a,b,c){md(b,function(d){var e=d.opacity==null?1:d.opacity,f,g,h,i,j,k,l;if(c&&!c.intersects(d.bounds)||e===0||d.fontSize<=0||d.text==null||d.text.length===0)return;a.font=en(d),a.textAlign=d.align||"left",f=fn(d),g=f.x1,h=f.y1,d.angle&&(a.save(),a.translate(g,h),a.rotate(d.angle*se),g=h=0),g+=d.dx||0,h+=(d.dy||0)+wt(d),k=Dj(d),Qh(a,d);if(J(k))for(j=kf(d),i=0;i<k.length;++i)l=lf(d,k[i]),d.fill&&Ym(a,d,e)&&a.fillText(l,g,h),d.stroke&&Rh(a,d,e)&&a.strokeText(l,g,h),h+=j;else l=lf(d,k),d.fill&&Ym(a,d,e)&&a.fillText(l,g,h),d.stroke&&Rh(a,d,e)&&a.strokeText(l,g,h);d.angle&&a.restore()})}function GZ(a,b,c,d,e,f){if(b.fontSize<=0)return!1;if(!b.angle)return!0;var g=fn(b),h=g.x1,i=g.y1,j=xt(Fj,b,1),k=-b.angle*se,l=Math.cos(k),m=Math.sin(k),n=l*e-m*f+(h-l*h+m*i),o=m*e+l*f+(i-m*h-l*i);return j.contains(n,o)}function HZ(a,b){var c=xt(Fj,a,2);return Ph(b,c[0],c[1],c[2],c[3])||Ph(b,c[0],c[1],c[4],c[5])||Ph(b,c[4],c[5],c[6],c[7])||Ph(b,c[2],c[3],c[6],c[7])}var IZ={type:"text",tag:"text",nested:!1,attr:EZ,bound:xt,draw:FZ,pick:_m(GZ),isect:HZ},JZ=pt("trail",LY,XY),Tc={arc:UY,area:YY,group:hZ,image:lZ,line:mZ,path:pZ,rect:sZ,rule:xZ,shape:yZ,symbol:zZ,text:IZ,trail:JZ};function yt(a,b,c){var d=Tc[a.mark.marktype],e=b||d.bound;return d.nested&&(a=a.mark),e(a.bounds||(a.bounds=new gb()),a,c)}var cE={mark:null};function dE(a,b,c){var d=Tc[a.marktype],e=d.bound,f=a.items,g=f&&f.length,h,i,j,k;if(d.nested)return g?j=f[0]:(cE.mark=a,j=cE),k=yt(j,e,c),b=b&&b.union(k)||k,b;b=b||a.bounds&&a.bounds.clear()||new gb();if(g)for(h=0,i=f.length;h<i;++h)b.union(yt(f[h],e,c));return a.bounds=b}var KZ=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function eE(a,b){return JSON.stringify(a,KZ,b)}function fE(a){var b=typeof a==="string"?JSON.parse(a):a;return gE(b)}function gE(a){var b=a.marktype,c=a.items,d,e,f;if(c)for(e=0,f=c.length;e<f;++e)d=b?"mark":"group",c[e][d]=a,c[e].zindex&&(c[e][d].zdirty=!0),"group"===(b||d)&&gE(c[e]);return b&&dE(a),a}function zt(a){arguments.length?this.root=fE(a):(this.root=iE({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Tm(this.root)])}var hE=zt.prototype;hE.toJSON=function(a){return eE(this.root,a||0)},hE.mark=function(a,b,c){b=b||this.root.items[0];var d=iE(a,b);return b.items[c]=d,d.zindex&&(d.group.zdirty=!0),d};function iE(a,b){const c={bounds:new gb(),clip:!!a.clip,group:b,interactive:a.interactive===!1?!1:!0,items:[],marktype:a.marktype,name:a.name||void 0,role:a.role||void 0,zindex:a.zindex||0};return a.aria!=null&&(c.aria=a.aria),a.description&&(c.description=a.description),c}function mf(a,b,c){return!a&&typeof document!=="undefined"&&document.createElement&&(a=document),a?c?a.createElementNS(c,b):a.createElement(b):null}function At(a,b){b=b.toLowerCase();for(var c=a.childNodes,d=0,e=c.length;d<e;++d)if(c[d].tagName.toLowerCase()===b)return c[d]}function Fc(a,b,c,d){var e=a.childNodes[b],f;return(!e||e.tagName.toLowerCase()!==c.toLowerCase())&&(f=e||null,e=mf(a.ownerDocument,c,d),a.insertBefore(e,f)),e}function nd(a,b){for(var c=a.childNodes,d=c.length;d>b;)a.removeChild(c[--d]);return a}function jE(a){return"mark-"+a.marktype+(a.role?" role-"+a.role:"")+(a.name?" "+a.name:"")}function gn(a,b){var c=b.getBoundingClientRect();return[a.clientX-c.left-(b.clientLeft||0),a.clientY-c.top-(b.clientTop||0)]}function LZ(a,b,c,d){var e=a&&a.mark,f,g;if(e&&(f=Tc[e.marktype]).tip){for(g=gn(b,c),g[0]-=d[0],g[1]-=d[1];a=a.mark.group;)g[0]-=a.x||0,g[1]-=a.y||0;a=f.tip(e.items,g)}return a}function nf(a,b){this._active=null,this._handlers={},this._loader=a||vm(),this._tooltip=b||MZ}function MZ(a,b,c,d){a.element().setAttribute("title",d||"")}const Gc=nf.prototype;Gc.initialize=function(a,b,c){return this._el=a,this._obj=c||null,this.origin(b)},Gc.element=function(){return this._el},Gc.canvas=function(){return this._el&&this._el.firstChild},Gc.origin=function(a){return arguments.length?(this._origin=a||[0,0],this):this._origin.slice()},Gc.scene=function(a){return arguments.length?(this._scene=a,this):this._scene},Gc.on=function(){},Gc.off=function(){},Gc._handlerIndex=function(a,b,c){for(let d=a?a.length:0;--d>=0;)if(a[d].type===b&&(!c||a[d].handler===c))return d;return-1},Gc.handlers=function(a){const b=this._handlers,c=[];if(a)c.push.apply(c,b[this.eventName(a)]);else for(const d in b)c.push.apply(c,b[d]);return c},Gc.eventName=function(a){const b=a.indexOf(".");return b<0?a:a.slice(0,b)},Gc.handleHref=function(a,b,c){this._loader.sanitize(c,{context:"href"}).then(d=>{const e=new MouseEvent(a.type,a),f=mf(null,"a");for(const g in d)f.setAttribute(g,d[g]);f.dispatchEvent(e)}).catch(function(){})},Gc.handleTooltip=function(a,b,c){if(b&&b.tooltip!=null){b=LZ(b,a,this.canvas(),this._origin);const d=c&&b&&b.tooltip||null;this._tooltip.call(this._obj,this,a,b,d)}},Gc.getItemBoundingClientRect=function(a){const b=this.canvas();if(!b)return;const c=b.getBoundingClientRect(),d=this._origin,e=a.bounds,f=e.width(),g=e.height();let h=e.x1+d[0]+c.left,i=e.y1+d[1]+c.top;for(;a.mark&&(a=a.mark.group);)h+=a.x||0,i+=a.y||0;return{x:h,y:i,width:f,height:g,left:h,top:i,right:h+f,bottom:i+g}};function od(a){this._el=null,this._bgcolor=null,this._loader=new ht(a)}var Uc=od.prototype;Uc.initialize=function(a,b,c,d,e){return this._el=a,this.resize(b,c,d,e)},Uc.element=function(){return this._el},Uc.canvas=function(){return this._el&&this._el.firstChild},Uc.background=function(a){return arguments.length===0?this._bgcolor:(this._bgcolor=a,this)},Uc.resize=function(a,b,c,d){return this._width=a,this._height=b,this._origin=c||[0,0],this._scale=d||1,this},Uc.dirty=function(){},Uc.render=function(a){var b=this;return b._call=function(){b._render(a)},b._call(),b._call=null,b},Uc._render=function(){},Uc.renderAsync=function(a){var b=this.render(a);return this._ready?this._ready.then(function(){return b}):Promise.resolve(b)},Uc._load=function(a,b){var c=this,d=c._loader[a](b);if(!c._ready){var e=c._call;c._ready=c._loader.ready().then(function(f){f&&e(),c._ready=null})}return d},Uc.sanitizeURL=function(a){return this._load("sanitizeURL",a)},Uc.loadImage=function(a){return this._load("loadImage",a)};const NZ="keydown",OZ="keypress",PZ="keyup",kE="dragenter",hn="dragleave",lE="dragover",Bt="mousedown",QZ="mouseup",jn="mousemove",Gj="mouseout",mE="mouseover",kn="click",RZ="dblclick",SZ="wheel",nE="mousewheel",ln="touchstart",mn="touchmove",nn="touchend",TZ=[NZ,OZ,PZ,kE,hn,lE,Bt,QZ,jn,Gj,mE,kn,RZ,SZ,nE,ln,mn,nn],Ct=jn,Hj=Gj,Dt=kn;function Ij(a,b){nf.call(this,a,b),this._down=null,this._touch=null,this._first=!0,this._events={}}const hb=N(Ij,nf);hb.initialize=function(a,b,c){return this._canvas=a&&At(a,"canvas"),[kn,Bt,jn,Gj,hn].forEach(d=>oE(this,d)),nf.prototype.initialize.call(this,a,b,c)};const UZ=a=>a===ln||a===mn||a===nn?[ln,mn,nn]:[a];function oE(a,b){UZ(b).forEach(c=>VZ(a,c))}function VZ(a,b){const c=a.canvas();c&&!a._events[b]&&(a._events[b]=1,c.addEventListener(b,a[b]?d=>a[b](d):d=>a.fire(b,d)))}hb.canvas=function(){return this._canvas},hb.context=function(){return this._canvas.getContext("2d")},hb.events=TZ;function pE(a,b,c){return function(d){const e=this._active,f=this.pickEvent(d);f===e?this.fire(a,d):((!e||!e.exit)&&this.fire(c,d),this._active=f,this.fire(b,d),this.fire(a,d))}}function qE(a){return function(b){this.fire(a,b),this._active=null}}hb.DOMMouseScroll=function(a){this.fire(nE,a)},hb.mousemove=pE(jn,mE,Gj),hb.dragover=pE(lE,kE,hn),hb.mouseout=qE(Gj),hb.dragleave=qE(hn),hb.mousedown=function(a){this._down=this._active,this.fire(Bt,a)},hb.click=function(a){this._down===this._active&&(this.fire(kn,a),this._down=null)},hb.touchstart=function(a){this._touch=this.pickEvent(a.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(ln,a,!0)},hb.touchmove=function(a){this.fire(mn,a,!0)},hb.touchend=function(a){this.fire(nn,a,!0),this._touch=null},hb.fire=function(a,b,c){const d=c?this._touch:this._active,e=this._handlers[a];b.vegaType=a,a===Dt&&d&&d.href?this.handleHref(b,d,d.href):(a===Ct||a===Hj)&&this.handleTooltip(b,d,a!==Hj);if(e)for(let f=0,g=e.length;f<g;++f)e[f].handler.call(this._obj,b,d)},hb.on=function(a,b){const c=this.eventName(a),d=this._handlers,e=this._handlerIndex(d[c],a,b);return e<0&&(oE(this,a),(d[c]||(d[c]=[])).push({type:a,handler:b})),this},hb.off=function(a,b){const c=this.eventName(a),d=this._handlers[c],e=this._handlerIndex(d,a,b);return e>=0&&d.splice(e,1),this},hb.pickEvent=function(a){const b=gn(a,this._canvas),c=this._origin;return this.pick(this._scene,b[0],b[1],b[0]-c[0],b[1]-c[1])},hb.pick=function(a,b,c,d,e){const f=this.context(),g=Tc[a.marktype];return g.pick.call(this,f,a,b,c,d,e)};function WZ(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var XZ=WZ();function YZ(a,b,c,d,e,f){const g=typeof HTMLElement!=="undefined"&&a instanceof HTMLElement&&a.parentNode!=null,h=a.getContext("2d"),i=g?XZ:e;a.width=b*i,a.height=c*i;for(const j in f)h[j]=f[j];return g&&i!==1&&(a.style.width=b+"px",a.style.height=c+"px"),h.pixelRatio=i,h.setTransform(i,0,0,i,i*d[0],i*d[1]),a}function on(a){od.call(this,a),this._options={},this._redraw=!1,this._dirty=new gb(),this._tempb=new gb()}const of=N(on,od),rE=od.prototype;of.initialize=function(a,b,c,d,e,f){return this._options=f||{},this._canvas=this._options.externalContext?null:Aj(1,1,this._options.type),a&&this._canvas&&(nd(a,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),rE.initialize.call(this,a,b,c,d,e)},of.resize=function(a,b,c,d){rE.resize.call(this,a,b,c,d);if(this._canvas)YZ(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||H("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},of.canvas=function(){return this._canvas},of.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},of.dirty=function(a){let b=this._tempb.clear().union(a.bounds),c=a.mark.group;for(;c;)b.translate(c.x||0,c.y||0),c=c.mark.group;this._dirty.union(b)};function ZZ(a,b,c){return b.expand(1).round(),a.pixelRatio%1&&b.scale(a.pixelRatio).round().scale(1/a.pixelRatio),b.translate(-(c[0]%1),-(c[1]%1)),a.beginPath(),a.rect(b.x1,b.y1,b.width(),b.height()),a.clip(),b}const _Z=(a,b,c)=>new gb().set(0,0,b,c).translate(-a[0],-a[1]);of._render=function(a){const b=this.context(),c=this._origin,d=this._width,e=this._height,f=this._dirty,g=_Z(c,d,e);b.save();const h=this._redraw||f.empty()?(this._redraw=!1,g.expand(1)):ZZ(b,g.intersect(f),c);return this.clear(-c[0],-c[1],d,e),this.draw(b,a,h),b.restore(),f.clear(),this},of.draw=function(a,b,c){const d=Tc[b.marktype];b.clip&&ZY(a,b),d.draw.call(this,a,b,c),b.clip&&a.restore()},of.clear=function(a,b,c,d){const e=this._options,f=this.context();e.type!=="pdf"&&!e.externalContext&&f.clearRect(a,b,c,d),this._bgcolor!=null&&(f.fillStyle=this._bgcolor,f.fillRect(a,b,c,d))};function Et(a,b){nf.call(this,a,b);const c=this;c._hrefHandler=Ft(c,(d,e)=>{e&&e.href&&c.handleHref(d,e,e.href)}),c._tooltipHandler=Ft(c,(d,e)=>{c.handleTooltip(d,e,d.type!==Hj)})}const pn=N(Et,nf);pn.initialize=function(a,b,c){let d=this._svg;return d&&(d.removeEventListener(Dt,this._hrefHandler),d.removeEventListener(Ct,this._tooltipHandler),d.removeEventListener(Hj,this._tooltipHandler)),this._svg=d=a&&At(a,"svg"),d&&(d.addEventListener(Dt,this._hrefHandler),d.addEventListener(Ct,this._tooltipHandler),d.addEventListener(Hj,this._tooltipHandler)),nf.prototype.initialize.call(this,a,b,c)},pn.canvas=function(){return this._svg};const Ft=(a,b)=>c=>{let d=c.target.__data__;d=Array.isArray(d)?d[0]:d,c.vegaType=c.type,b.call(a._obj,c,d)};pn.on=function(a,b){const c=this.eventName(a),d=this._handlers,e=this._handlerIndex(d[c],a,b);if(e<0){const f={type:a,handler:b,listener:Ft(this,b)};(d[c]||(d[c]=[])).push(f),this._svg&&this._svg.addEventListener(c,f.listener)}return this},pn.off=function(a,b){const c=this.eventName(a),d=this._handlers[c],e=this._handlerIndex(d,a,b);return e>=0&&(this._svg&&this._svg.removeEventListener(c,d[e].listener),d.splice(e,1)),this};function Gt(a,b,c){var d=a-b+c*2;return a?d>0?d:1:0}const $Z="identity",Vh="linear",ve="log",Jj="pow",Kj="sqrt",qn="symlog",ug="time",vg="utc",Nd="sequential",Wh="diverging",Xh="quantile",rn="quantize",sn="threshold",Ht="ordinal",It="point",sE="band",Jt="bin-ordinal",ib="continuous",Lj="discrete",Mj="discretizing",Vc="interpolating",Kt="temporal";function a_(a){return function(b){var c=b[0],d=b[1],e;return d<c&&(e=c,c=d,d=e),[a.invert(c),a.invert(d)]}}function b_(a){return function(b){var c=a.range(),d=b[0],e=b[1],f=-1,g,h,i,j;for(e<d&&(h=d,d=e,e=h),i=0,j=c.length;i<j;++i)c[i]>=d&&c[i]<=e&&(f<0&&(f=i),g=i);return f<0?void 0:(d=a.invertExtent(c[f]),e=a.invertExtent(c[g]),[d[0]===void 0?d[1]:d[0],e[1]===void 0?e[0]:e[1]])}}function Od(a,b){switch(arguments.length){case 0:break;case 1:this.range(a);break;default:this.range(b).domain(a);break}return this}function pf(a,b){switch(arguments.length){case 0:break;case 1:{typeof a==="function"?this.interpolator(a):this.range(a);break}default:{this.domain(a),typeof b==="function"?this.interpolator(b):this.range(b);break}}return this}const Lt=Symbol("implicit");function Mt(){var a=new Map(),b=[],c=[],d=Lt;function e(f){var g=f+"",h=a.get(g);if(!h){if(d!==Lt)return d;a.set(g,h=b.push(f))}return c[(h-1)%c.length]}return e.domain=function(f){if(!arguments.length)return b.slice();b=[],a=new Map();for(const g of f){const h=g+"";if(a.has(h))continue;a.set(h,b.push(g))}return e},e.range=function(f){return arguments.length?(c=Array.from(f),e):c.slice()},e.unknown=function(f){return arguments.length?(d=f,e):d},e.copy=function(){return Mt(b,c).unknown(d)},Od.apply(e,arguments),e}function Yh(a,b,c){a.prototype=b.prototype=c,c.constructor=a}function Nj(a,b){var c=Object.create(a.prototype);for(var d in b)c[d]=b[d];return c}function qf(){}var wg=.7,Zh=1/wg,_h="\\s*([+-]?\\d+)\\s*",Oj="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c_=/^#([0-9a-f]{3,8})$/,d_=new RegExp("^rgb\\("+[_h,_h,_h]+"\\)$"),e_=new RegExp("^rgb\\("+[Pd,Pd,Pd]+"\\)$"),f_=new RegExp("^rgba\\("+[_h,_h,_h,Oj]+"\\)$"),g_=new RegExp("^rgba\\("+[Pd,Pd,Pd,Oj]+"\\)$"),h_=new RegExp("^hsl\\("+[Oj,Pd,Pd]+"\\)$"),i_=new RegExp("^hsla\\("+[Oj,Pd,Pd,Oj]+"\\)$"),tE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yh(qf,Pj,{copy:function(a){return Object.assign(new this.constructor(),this,a)},displayable:function(){return this.rgb().displayable()},hex:uE,formatHex:uE,formatHsl:j_,formatRgb:vE,toString:vE});function uE(){return this.rgb().formatHex()}function j_(){return AE(this).formatHsl()}function vE(){return this.rgb().formatRgb()}function Pj(a){var b,c;return a=(a+"").trim().toLowerCase(),(b=c_.exec(a))?(c=b[1].length,b=parseInt(b[1],16),c===6?wE(b):c===3?new zb(b>>8&15|b>>4&240,b>>4&15|b&240,(b&15)<<4|b&15,1):c===8?tn(b>>24&255,b>>16&255,b>>8&255,(b&255)/255):c===4?tn(b>>12&15|b>>8&240,b>>8&15|b>>4&240,b>>4&15|b&240,((b&15)<<4|b&15)/255):null):(b=d_.exec(a))?new zb(b[1],b[2],b[3],1):(b=e_.exec(a))?new zb(b[1]*255/100,b[2]*255/100,b[3]*255/100,1):(b=f_.exec(a))?tn(b[1],b[2],b[3],b[4]):(b=g_.exec(a))?tn(b[1]*255/100,b[2]*255/100,b[3]*255/100,b[4]):(b=h_.exec(a))?zE(b[1],b[2]/100,b[3]/100,1):(b=i_.exec(a))?zE(b[1],b[2]/100,b[3]/100,b[4]):tE.hasOwnProperty(a)?wE(tE[a]):a==="transparent"?new zb(NaN,NaN,NaN,0):null}function wE(a){return new zb(a>>16&255,a>>8&255,a&255,1)}function tn(a,b,c,d){return d<=0&&(a=b=c=NaN),new zb(a,b,c,d)}function Nt(a){return a instanceof qf||(a=Pj(a)),a?(a=a.rgb(),new zb(a.r,a.g,a.b,a.opacity)):new zb()}function rf(a,b,c,d){return arguments.length===1?Nt(a):new zb(a,b,c,d==null?1:d)}function zb(a,b,c,d){this.r=+a,this.g=+b,this.b=+c,this.opacity=+d}Yh(zb,rf,Nj(qf,{brighter:function(a){return a=a==null?Zh:Math.pow(Zh,a),new zb(this.r*a,this.g*a,this.b*a,this.opacity)},darker:function(a){return a=a==null?wg:Math.pow(wg,a),new zb(this.r*a,this.g*a,this.b*a,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&(-.5<=this.g&&this.g<255.5)&&(-.5<=this.b&&this.b<255.5)&&(0<=this.opacity&&this.opacity<=1)},hex:xE,formatHex:xE,formatRgb:yE,toString:yE}));function xE(){return"#"+Ot(this.r)+Ot(this.g)+Ot(this.b)}function yE(){var a=this.opacity;return a=isNaN(a)?1:Math.max(0,Math.min(1,a)),(a===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(a===1?")":", "+a+")")}function Ot(a){return a=Math.max(0,Math.min(255,Math.round(a)||0)),(a<16?"0":"")+a.toString(16)}function zE(a,b,c,d){return d<=0?a=b=c=NaN:c<=0||c>=1?a=b=NaN:b<=0&&(a=NaN),new Qd(a,b,c,d)}function AE(a){if(a instanceof Qd)return new Qd(a.h,a.s,a.l,a.opacity);a instanceof qf||(a=Pj(a));if(!a)return new Qd();if(a instanceof Qd)return a;a=a.rgb();var b=a.r/255,c=a.g/255,d=a.b/255,e=Math.min(b,c,d),f=Math.max(b,c,d),g=NaN,h=f-e,i=(f+e)/2;return h?(b===f?g=(c-d)/h+(c<d)*6:c===f?g=(d-b)/h+2:g=(b-c)/h+4,h/=i<.5?f+e:2-f-e,g*=60):h=i>0&&i<1?0:g,new Qd(g,h,i,a.opacity)}function un(a,b,c,d){return arguments.length===1?AE(a):new Qd(a,b,c,d==null?1:d)}function Qd(a,b,c,d){this.h=+a,this.s=+b,this.l=+c,this.opacity=+d}Yh(Qd,un,Nj(qf,{brighter:function(a){return a=a==null?Zh:Math.pow(Zh,a),new Qd(this.h,this.s,this.l*a,this.opacity)},darker:function(a){return a=a==null?wg:Math.pow(wg,a),new Qd(this.h,this.s,this.l*a,this.opacity)},rgb:function(){var a=this.h%360+(this.h<0)*360,b=isNaN(a)||isNaN(this.s)?0:this.s,c=this.l,d=c+(c<.5?c:1-c)*b,e=2*c-d;return new zb(Pt(a>=240?a-240:a+120,e,d),Pt(a,e,d),Pt(a<120?a+240:a-120,e,d),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)},formatHsl:function(){var a=this.opacity;return a=isNaN(a)?1:Math.max(0,Math.min(1,a)),(a===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(a===1?")":", "+a+")")}}));function Pt(a,b,c){return(a<60?b+(c-b)*a/60:a<180?c:a<240?b+(c-b)*(240-a)/60:b)*255}var BE=Math.PI/180,CE=180/Math.PI,vn=18,DE=.96422,EE=1,FE=.82521,GE=4/29,$h=6/29,HE=3*$h*$h,k_=$h*$h*$h;function IE(a){if(a instanceof Rd)return new Rd(a.l,a.a,a.b,a.opacity);if(a instanceof we)return JE(a);a instanceof zb||(a=Nt(a));var b=Tt(a.r),c=Tt(a.g),d=Tt(a.b),e=Qt((.2225045*b+.7168786*c+.0606169*d)/EE),f,g;return b===c&&c===d?f=g=e:(f=Qt((.4360747*b+.3850649*c+.1430804*d)/DE),g=Qt((.0139322*b+.0971045*c+.7141733*d)/FE)),new Rd(116*e-16,500*(f-e),200*(e-g),a.opacity)}function wn(a,b,c,d){return arguments.length===1?IE(a):new Rd(a,b,c,d==null?1:d)}function Rd(a,b,c,d){this.l=+a,this.a=+b,this.b=+c,this.opacity=+d}Yh(Rd,wn,Nj(qf,{brighter:function(a){return new Rd(this.l+vn*(a==null?1:a),this.a,this.b,this.opacity)},darker:function(a){return new Rd(this.l-vn*(a==null?1:a),this.a,this.b,this.opacity)},rgb:function(){var a=(this.l+16)/116,b=isNaN(this.a)?a:a+this.a/500,c=isNaN(this.b)?a:a-this.b/200;return b=DE*Rt(b),a=EE*Rt(a),c=FE*Rt(c),new zb(St(3.1338561*b-1.6168667*a-.4906146*c),St(-.9787684*b+1.9161415*a+.033454*c),St(.0719453*b-.2289914*a+1.4052427*c),this.opacity)}}));function Qt(a){return a>k_?Math.pow(a,1/3):a/HE+GE}function Rt(a){return a>$h?a*a*a:HE*(a-GE)}function St(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Tt(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function l_(a){if(a instanceof we)return new we(a.h,a.c,a.l,a.opacity);a instanceof Rd||(a=IE(a));if(a.a===0&&a.b===0)return new we(NaN,0<a.l&&a.l<100?0:NaN,a.l,a.opacity);var b=Math.atan2(a.b,a.a)*CE;return new we(b<0?b+360:b,Math.sqrt(a.a*a.a+a.b*a.b),a.l,a.opacity)}function xn(a,b,c,d){return arguments.length===1?l_(a):new we(a,b,c,d==null?1:d)}function we(a,b,c,d){this.h=+a,this.c=+b,this.l=+c,this.opacity=+d}function JE(a){if(isNaN(a.h))return new Rd(a.l,0,0,a.opacity);var b=a.h*BE;return new Rd(a.l,Math.cos(b)*a.c,Math.sin(b)*a.c,a.opacity)}Yh(we,xn,Nj(qf,{brighter:function(a){return new we(this.h,this.c,this.l+vn*(a==null?1:a),this.opacity)},darker:function(a){return new we(this.h,this.c,this.l-vn*(a==null?1:a),this.opacity)},rgb:function(){return JE(this).rgb()}}));var KE=-.14861,Ut=1.78277,Vt=-.29227,yn=-.90649,Qj=1.97294,LE=Qj*yn,ME=Qj*Ut,NE=Ut*Vt-yn*KE;function m_(a){if(a instanceof xg)return new xg(a.h,a.s,a.l,a.opacity);a instanceof zb||(a=Nt(a));var b=a.r/255,c=a.g/255,d=a.b/255,e=(NE*d+LE*b-ME*c)/(NE+LE-ME),f=d-e,g=(Qj*(c-e)-Vt*f)/yn,h=Math.sqrt(g*g+f*f)/(Qj*e*(1-e)),i=h?Math.atan2(g,f)*CE-120:NaN;return new xg(i<0?i+360:i,h,e,a.opacity)}function Wt(a,b,c,d){return arguments.length===1?m_(a):new xg(a,b,c,d==null?1:d)}function xg(a,b,c,d){this.h=+a,this.s=+b,this.l=+c,this.opacity=+d}Yh(xg,Wt,Nj(qf,{brighter:function(a){return a=a==null?Zh:Math.pow(Zh,a),new xg(this.h,this.s,this.l*a,this.opacity)},darker:function(a){return a=a==null?wg:Math.pow(wg,a),new xg(this.h,this.s,this.l*a,this.opacity)},rgb:function(){var a=isNaN(this.h)?0:(this.h+120)*BE,b=+this.l,c=isNaN(this.s)?0:this.s*b*(1-b),d=Math.cos(a),e=Math.sin(a);return new zb(255*(b+c*(KE*d+Ut*e)),255*(b+c*(Vt*d+yn*e)),255*(b+c*(Qj*d)),this.opacity)}}));function OE(a,b,c,d,e){var f=a*a,g=f*a;return((1-3*a+3*f-g)*b+(4-6*f+3*g)*c+(1+3*a+3*f-3*g)*d+g*e)/6}function PE(a){var b=a.length-1;return function(c){var d=c<=0?c=0:c>=1?(c=1,b-1):Math.floor(c*b),e=a[d],f=a[d+1],g=d>0?a[d-1]:2*e-f,h=d<b-1?a[d+2]:2*f-e;return OE((c-d/b)*b,g,e,f,h)}}function QE(a){var b=a.length;return function(c){var d=Math.floor(((c%=1)<0?++c:c)*b),e=a[(d+b-1)%b],f=a[d%b],g=a[(d+1)%b],h=a[(d+2)%b];return OE((c-d/b)*b,e,f,g,h)}}function zn(a){return function(){return a}}function RE(a,b){return function(c){return a+c*b}}function n_(a,b,c){return a=Math.pow(a,c),b=Math.pow(b,c)-a,c=1/c,function(d){return Math.pow(a+d*b,c)}}function An(a,b){var c=b-a;return c?RE(a,c>180||c<-180?c-360*Math.round(c/360):c):zn(isNaN(a)?b:a)}function o_(a){return(a=+a)===1?nb:function(b,c){return c-b?n_(b,c,a):zn(isNaN(b)?c:b)}}function nb(a,b){var c=b-a;return c?RE(a,c):zn(isNaN(a)?b:a)}var Xt=function a(b){var c=o_(b);function d(e,f){var g=c((e=rf(e)).r,(f=rf(f)).r),h=c(e.g,f.g),i=c(e.b,f.b),j=nb(e.opacity,f.opacity);return function(k){return e.r=g(k),e.g=h(k),e.b=i(k),e.opacity=j(k),e+""}}return d.gamma=a,d}(1);function SE(a){return function(b){var c=b.length,d=new Array(c),e=new Array(c),f=new Array(c),g,h;for(g=0;g<c;++g)h=rf(b[g]),d[g]=h.r||0,e[g]=h.g||0,f[g]=h.b||0;return d=a(d),e=a(e),f=a(f),h.opacity=1,function(i){return h.r=d(i),h.g=e(i),h.b=f(i),h+""}}}var p_=SE(PE),q_=SE(QE);function Yt(a,b){b||(b=[]);var c=a?Math.min(b.length,a.length):0,d=b.slice(),e;return function(f){for(e=0;e<c;++e)d[e]=a[e]*(1-f)+b[e]*f;return d}}function TE(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function r_(a,b){return(TE(b)?Yt:UE)(a,b)}function UE(a,b){var c=b?b.length:0,d=a?Math.min(c,a.length):0,e=new Array(d),f=new Array(c),g;for(g=0;g<d;++g)e[g]=yg(a[g],b[g]);for(;g<c;++g)f[g]=b[g];return function(h){for(g=0;g<d;++g)f[g]=e[g](h);return f}}function VE(a,b){var c=new Date();return a=+a,b=+b,function(d){return c.setTime(a*(1-d)+b*d),c}}function pd(a,b){return a=+a,b=+b,function(c){return a*(1-c)+b*c}}function WE(a,b){var c={},d={},e;(a===null||typeof a!=="object")&&(a={}),(b===null||typeof b!=="object")&&(b={});for(e in b)e in a?c[e]=yg(a[e],b[e]):d[e]=b[e];return function(f){for(e in c)d[e]=c[e](f);return d}}var Zt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_t=new RegExp(Zt.source,"g");function s_(a){return function(){return a}}function t_(a){return function(b){return a(b)+""}}function XE(a,b){var c=Zt.lastIndex=_t.lastIndex=0,d,e,f,g=-1,h=[],i=[];for(a=a+"",b=b+"";(d=Zt.exec(a))&&(e=_t.exec(b));)(f=e.index)>c&&(f=b.slice(c,f),h[g]?h[g]+=f:h[++g]=f),(d=d[0])===(e=e[0])?h[g]?h[g]+=e:h[++g]=e:(h[++g]=null,i.push({i:g,x:pd(d,e)})),c=_t.lastIndex;return c<b.length&&(f=b.slice(c),h[g]?h[g]+=f:h[++g]=f),h.length<2?i[0]?t_(i[0].x):s_(b):(b=i.length,function(j){for(var k=0,l;k<b;++k)h[(l=i[k]).i]=l.x(j);return h.join("")})}function yg(a,b){var c=typeof b,d;return b==null||c==="boolean"?zn(b):(c==="number"?pd:c==="string"?(d=Pj(b))?(b=d,Xt):XE:b instanceof Pj?Xt:b instanceof Date?VE:TE(b)?Yt:Array.isArray(b)?UE:typeof b.valueOf!=="function"&&typeof b.toString!=="function"||isNaN(b)?WE:pd)(a,b)}function u_(a){var b=a.length;return function(c){return a[Math.max(0,Math.min(b-1,Math.floor(c*b)))]}}function v_(a,b){var c=An(+a,+b);return function(d){var e=c(d);return e-360*Math.floor(e/360)}}function Rj(a,b){return a=+a,b=+b,function(c){return Math.round(a*(1-c)+b*c)}}var YE=180/Math.PI,$t={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ZE(a,b,c,d,e,f){var g,h,i;return(g=Math.sqrt(a*a+b*b))&&(a/=g,b/=g),(i=a*c+b*d)&&(c-=a*i,d-=b*i),(h=Math.sqrt(c*c+d*d))&&(c/=h,d/=h,i/=h),a*d<b*c&&(a=-a,b=-b,i=-i,g=-g),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*YE,skewX:Math.atan(i)*YE,scaleX:g,scaleY:h}}var Sj,au,_E,Bn;function w_(a){return a==="none"?$t:(Sj||(Sj=document.createElement("DIV"),au=document.documentElement,_E=document.defaultView),Sj.style.transform=a,a=_E.getComputedStyle(au.appendChild(Sj),null).getPropertyValue("transform"),au.removeChild(Sj),a=a.slice(7,-1).split(","),ZE(+a[0],+a[1],+a[2],+a[3],+a[4],+a[5]))}function x_(a){return a==null?$t:(Bn||(Bn=document.createElementNS("http://www.w3.org/2000/svg","g")),Bn.setAttribute("transform",a),(a=Bn.transform.baseVal.consolidate())?(a=a.matrix,ZE(a.a,a.b,a.c,a.d,a.e,a.f)):$t)}function $E(a,b,c,d){function e(j){return j.length?j.pop()+" ":""}function f(j,k,l,m,n,o){if(j!==l||k!==m){var p=n.push("translate(",null,b,null,c);o.push({i:p-4,x:pd(j,l)},{i:p-2,x:pd(k,m)})}else(l||m)&&n.push("translate("+l+b+m+c)}function g(j,k,l,m){j!==k?(j-k>180?k+=360:k-j>180&&(j+=360),m.push({i:l.push(e(l)+"rotate(",null,d)-2,x:pd(j,k)})):k&&l.push(e(l)+"rotate("+k+d)}function h(j,k,l,m){j!==k?m.push({i:l.push(e(l)+"skewX(",null,d)-2,x:pd(j,k)}):k&&l.push(e(l)+"skewX("+k+d)}function i(j,k,l,m,n,o){if(j!==l||k!==m){var p=n.push(e(n)+"scale(",null,",",null,")");o.push({i:p-4,x:pd(j,l)},{i:p-2,x:pd(k,m)})}else(l!==1||m!==1)&&n.push(e(n)+"scale("+l+","+m+")")}return function(j,k){var l=[],m=[];return j=a(j),k=a(k),f(j.translateX,j.translateY,k.translateX,k.translateY,l,m),g(j.rotate,k.rotate,l,m),h(j.skewX,k.skewX,l,m),i(j.scaleX,j.scaleY,k.scaleX,k.scaleY,l,m),j=k=null,function(n){for(var o=-1,p=m.length,q;++o<p;)l[(q=m[o]).i]=q.x(n);return l.join("")}}}var y_=$E(w_,"px, ","px)","deg)"),z_=$E(x_,", ",")",")"),Tj=Math.SQRT2,bu=2,aF=4,A_=1e-12;function bF(a){return((a=Math.exp(a))+1/a)/2}function B_(a){return((a=Math.exp(a))-1/a)/2}function C_(a){return((a=Math.exp(2*a))-1)/(a+1)}function D_(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2],i=f-c,j=g-d,k=i*i+j*j,l,m;if(k<A_)m=Math.log(h/e)/Tj,l=function(s){return[c+s*i,d+s*j,e*Math.exp(Tj*s*m)]};else{var n=Math.sqrt(k),o=(h*h-e*e+aF*k)/(2*e*bu*n),p=(h*h-e*e-aF*k)/(2*h*bu*n),q=Math.log(Math.sqrt(o*o+1)-o),r=Math.log(Math.sqrt(p*p+1)-p);m=(r-q)/Tj,l=function(s){var t=s*m,w=bF(q),v=e/(bu*n)*(w*C_(Tj*t+q)-B_(q));return[c+v*i,d+v*j,e*w/bF(Tj*t+q)]}}return l.duration=m*1e3,l}function cF(a){return function(b,c){var d=a((b=un(b)).h,(c=un(c)).h),e=nb(b.s,c.s),f=nb(b.l,c.l),g=nb(b.opacity,c.opacity);return function(h){return b.h=d(h),b.s=e(h),b.l=f(h),b.opacity=g(h),b+""}}}var E_=cF(An),F_=cF(nb);function G_(a,b){var c=nb((a=wn(a)).l,(b=wn(b)).l),d=nb(a.a,b.a),e=nb(a.b,b.b),f=nb(a.opacity,b.opacity);return function(g){return a.l=c(g),a.a=d(g),a.b=e(g),a.opacity=f(g),a+""}}function dF(a){return function(b,c){var d=a((b=xn(b)).h,(c=xn(c)).h),e=nb(b.c,c.c),f=nb(b.l,c.l),g=nb(b.opacity,c.opacity);return function(h){return b.h=d(h),b.c=e(h),b.l=f(h),b.opacity=g(h),b+""}}}var H_=dF(An),I_=dF(nb);function eF(a){return function b(c){c=+c;function d(e,f){var g=a((e=Wt(e)).h,(f=Wt(f)).h),h=nb(e.s,f.s),i=nb(e.l,f.l),j=nb(e.opacity,f.opacity);return function(k){return e.h=g(k),e.s=h(k),e.l=i(Math.pow(k,c)),e.opacity=j(k),e+""}}return d.gamma=b,d}(1)}var J_=eF(An),K_=eF(nb);function cu(a,b){for(var c=0,d=b.length-1,e=b[0],f=new Array(d<0?0:d);c<d;)f[c]=a(e,e=b[++c]);return function(g){var h=Math.max(0,Math.min(d-1,Math.floor(g*=d)));return f[h](g-h)}}function L_(a,b){for(var c=new Array(b),d=0;d<b;++d)c[d]=a(d/(b-1));return c}var M_=Object.freeze({__proto__:null,interpolate:yg,interpolateArray:r_,interpolateBasis:PE,interpolateBasisClosed:QE,interpolateDate:VE,interpolateDiscrete:u_,interpolateHue:v_,interpolateNumber:pd,interpolateNumberArray:Yt,interpolateObject:WE,interpolateRound:Rj,interpolateString:XE,interpolateTransformCss:y_,interpolateTransformSvg:z_,interpolateZoom:D_,interpolateRgb:Xt,interpolateRgbBasis:p_,interpolateRgbBasisClosed:q_,interpolateHsl:E_,interpolateHslLong:F_,interpolateLab:G_,interpolateHcl:H_,interpolateHclLong:I_,interpolateCubehelix:J_,interpolateCubehelixLong:K_,piecewise:cu,quantize:L_});function N_(a){return function(){return a}}function du(a){return+a}var fF=[0,1];function nc(a){return a}function eu(a,b){return(b-=a=+a)?function(c){return(c-a)/b}:N_(isNaN(b)?NaN:.5)}function O_(a,b){var c;return a>b&&(c=a,a=b,b=c),function(d){return Math.max(a,Math.min(b,d))}}function P_(a,b,c){var d=a[0],e=a[1],f=b[0],g=b[1];return e<d?(d=eu(e,d),f=c(g,f)):(d=eu(d,e),f=c(f,g)),function(h){return f(d(h))}}function Q_(a,b,c){var d=Math.min(a.length,b.length)-1,e=new Array(d),f=new Array(d),g=-1;for(a[d]<a[0]&&(a=a.slice().reverse(),b=b.slice().reverse());++g<d;)e[g]=eu(a[g],a[g+1]),f[g]=c(b[g],b[g+1]);return function(h){var i=Ze(a,h,1,d)-1;return f[i](e[i](h))}}function Uj(a,b){return b.domain(a.domain()).range(a.range()).interpolate(a.interpolate()).clamp(a.clamp()).unknown(a.unknown())}function Cn(){var a=fF,b=fF,c=yg,d,e,f,g=nc,h,i,j;function k(){var m=Math.min(a.length,b.length);return g!==nc&&(g=O_(a[0],a[m-1])),h=m>2?Q_:P_,i=j=null,l}function l(m){return isNaN(m=+m)?f:(i||(i=h(a.map(d),b,c)))(d(g(m)))}return l.invert=function(m){return g(e((j||(j=h(b,a.map(d),pd)))(m)))},l.domain=function(m){return arguments.length?(a=Array.from(m,du),k()):a.slice()},l.range=function(m){return arguments.length?(b=Array.from(m),k()):b.slice()},l.rangeRound=function(m){return b=Array.from(m),c=Rj,k()},l.clamp=function(m){return arguments.length?(g=m?!0:nc,k()):g!==nc},l.interpolate=function(m){return arguments.length?(c=m,k()):c},l.unknown=function(m){return arguments.length?(f=m,l):f},function(m,n){return d=m,e=n,k()}}function gF(){return Cn()(nc,nc)}function hF(a,b,c,d){var e=_e(a,b,c),f;d=xh(d==null?",f":d);switch(d.type){case"s":{var g=Math.max(Math.abs(a),Math.abs(b));return d.precision==null&&!isNaN(f=SA(e,g))&&(d.precision=f),nr(d,g)}case"":case"e":case"g":case"p":case"r":{d.precision==null&&!isNaN(f=TA(e,Math.max(Math.abs(a),Math.abs(b))))&&(d.precision=f-(d.type==="e"));break}case"f":case"%":{d.precision==null&&!isNaN(f=RA(e))&&(d.precision=f-(d.type==="%")*2);break}}return nm(d)}function zg(a){var b=a.domain;return a.ticks=function(c){var d=b();return kr(d[0],d[d.length-1],c==null?10:c)},a.tickFormat=function(c,d){var e=b();return hF(e[0],e[e.length-1],c==null?10:c,d)},a.nice=function(c){c==null&&(c=10);var d=b(),e=0,f=d.length-1,g=d[e],h=d[f],i;return h<g&&(i=g,g=h,h=i,i=e,e=f,f=i),i=jm(g,h,c),i>0?(g=Math.floor(g/i)*i,h=Math.ceil(h/i)*i,i=jm(g,h,c)):i<0&&(g=Math.ceil(g*i)/i,h=Math.floor(h*i)/i,i=jm(g,h,c)),i>0?(d[e]=Math.floor(g/i)*i,d[f]=Math.ceil(h/i)*i,b(d)):i<0&&(d[e]=Math.ceil(g*i)/i,d[f]=Math.floor(h*i)/i,b(d)),a},a}function iF(){var a=gF();return a.copy=function(){return Uj(a,iF())},Od.apply(a,arguments),zg(a)}function jF(a){var b;function c(d){return isNaN(d=+d)?b:d}return c.invert=c,c.domain=c.range=function(d){return arguments.length?(a=Array.from(d,du),c):a.slice()},c.unknown=function(d){return arguments.length?(b=d,c):b},c.copy=function(){return jF(a).unknown(b)},a=arguments.length?Array.from(a,du):[0,1],zg(c)}function kF(a,b){a=a.slice();var c=0,d=a.length-1,e=a[c],f=a[d],g;return f<e&&(g=c,c=d,d=g,g=e,e=f,f=g),a[c]=b.floor(e),a[d]=b.ceil(f),a}function lF(a){return Math.log(a)}function mF(a){return Math.exp(a)}function R_(a){return-Math.log(-a)}function S_(a){return-Math.exp(-a)}function T_(a){return isFinite(a)?+("1e"+a):a<0?0:a}function U_(a){return a===10?T_:a===Math.E?Math.exp:function(b){return Math.pow(a,b)}}function V_(a){return a===Math.E?Math.log:a===10&&Math.log10||a===2&&Math.log2||(a=Math.log(a),function(b){return Math.log(b)/a})}function nF(a){return function(b){return-a(-b)}}function fu(a){var b=a(lF,mF),c=b.domain,d=10,e,f;function g(){return e=V_(d),f=U_(d),c()[0]<0?(e=nF(e),f=nF(f),a(R_,S_)):a(lF,mF),b}return b.base=function(h){return arguments.length?(d=+h,g()):d},b.domain=function(h){return arguments.length?(c(h),g()):c()},b.ticks=function(h){var i=c(),j=i[0],k=i[i.length-1],l;(l=k<j)&&(m=j,j=k,k=m);var m=e(j),n=e(k),o,p,q,r=h==null?10:+h,s=[];if(!(d%1)&&n-m<r){m=Math.floor(m),n=Math.ceil(n);if(j>0)for(;m<=n;++m)for(p=1,o=f(m);p<d;++p){q=o*p;if(q<j)continue;if(q>k)break;s.push(q)}else for(;m<=n;++m)for(p=d-1,o=f(m);p>=1;--p){q=o*p;if(q<j)continue;if(q>k)break;s.push(q)}s.length*2<r&&(s=kr(j,k,r))}else s=kr(m,n,Math.min(n-m,r)).map(f);return l?s.reverse():s},b.tickFormat=function(h,i){i==null&&(i=d===10?".0e":","),typeof i!=="function"&&(i=nm(i));if(h===Infinity)return i;h==null&&(h=10);var j=Math.max(1,d*h/b.ticks().length);return function(k){var l=k/f(Math.round(e(k)));return l*d<d-.5&&(l*=d),l<=j?i(k):""}},b.nice=function(){return c(kF(c(),{floor:function(h){return f(Math.floor(e(h)))},ceil:function(h){return f(Math.ceil(e(h)))}}))},b}function oF(){var a=fu(Cn()).domain([1,10]);return a.copy=function(){return Uj(a,oF()).base(a.base())},Od.apply(a,arguments),a}function pF(a){return function(b){return Math.sign(b)*Math.log1p(Math.abs(b/a))}}function qF(a){return function(b){return Math.sign(b)*Math.expm1(Math.abs(b))*a}}function gu(a){var b=1,c=a(pF(b),qF(b));return c.constant=function(d){return arguments.length?a(pF(b=+d),qF(b)):b},zg(c)}function rF(){var a=gu(Cn());return a.copy=function(){return Uj(a,rF()).constant(a.constant())},Od.apply(a,arguments)}function sF(a){return function(b){return b<0?-Math.pow(-b,a):Math.pow(b,a)}}function W_(a){return a<0?-Math.sqrt(-a):Math.sqrt(a)}function X_(a){return a<0?-a*a:a*a}function hu(a){var b=a(nc,nc),c=1;function d(){return c===1?a(nc,nc):c===.5?a(W_,X_):a(sF(c),sF(1/c))}return b.exponent=function(e){return arguments.length?(c=+e,d()):c},zg(b)}function iu(){var a=hu(Cn());return a.copy=function(){return Uj(a,iu()).exponent(a.exponent())},Od.apply(a,arguments),a}function Y_(){return iu.apply(null,arguments).exponent(.5)}function tF(){var a=[],b=[],c=[],d;function e(){var g=0,h=Math.max(1,b.length);for(c=new Array(h-1);++g<h;)c[g-1]=km(a,g/h);return f}function f(g){return isNaN(g=+g)?d:b[Ze(c,g)]}return f.invertExtent=function(g){var h=b.indexOf(g);return h<0?[NaN,NaN]:[h>0?c[h-1]:a[0],h<c.length?c[h]:a[a.length-1]]},f.domain=function(g){if(!arguments.length)return a.slice();a=[];for(let h of g)h!=null&&!isNaN(h=+h)&&a.push(h);return a.sort(vh),e()},f.range=function(g){return arguments.length?(b=Array.from(g),e()):b.slice()},f.unknown=function(g){return arguments.length?(d=g,f):d},f.quantiles=function(){return c.slice()},f.copy=function(){return tF().domain(a).range(b).unknown(d)},Od.apply(f,arguments)}function uF(){var a=0,b=1,c=1,d=[.5],e=[0,1],f;function g(i){return i<=i?e[Ze(d,i,0,c)]:f}function h(){var i=-1;for(d=new Array(c);++i<c;)d[i]=((i+1)*b-(i-c)*a)/(c+1);return g}return g.domain=function(i){return arguments.length?([a,b]=i,a=+a,b=+b,h()):[a,b]},g.range=function(i){return arguments.length?(c=(e=Array.from(i)).length-1,h()):e.slice()},g.invertExtent=function(i){var j=e.indexOf(i);return j<0?[NaN,NaN]:j<1?[a,d[0]]:j>=c?[d[c-1],b]:[d[j-1],d[j]]},g.unknown=function(i){return arguments.length?(f=i,g):g},g.thresholds=function(){return d.slice()},g.copy=function(){return uF().domain([a,b]).range(e).unknown(f)},Od.apply(zg(g),arguments)}function vF(){var a=[.5],b=[0,1],c,d=1;function e(f){return f<=f?b[Ze(a,f,0,d)]:c}return e.domain=function(f){return arguments.length?(a=Array.from(f),d=Math.min(a.length,b.length-1),e):a.slice()},e.range=function(f){return arguments.length?(b=Array.from(f),d=Math.min(a.length,b.length-1),e):b.slice()},e.invertExtent=function(f){var g=b.indexOf(f);return[a[g-1],a[g]]},e.unknown=function(f){return arguments.length?(c=f,e):c},e.copy=function(){return vF().domain(a).range(b).unknown(c)},Od.apply(e,arguments)}var Vj=1e3,Wj=Vj*60,Xj=Wj*60,Yj=Xj*24,Z_=Yj*7,wF=Yj*30,ju=Yj*365;function __(a){return new Date(a)}function $_(a){return a instanceof Date?+a:+new Date(+a)}function ku(a,b,c,d,e,f,g,h,i){var j=gF(),k=j.invert,l=j.domain,m=i(".%L"),n=i(":%S"),o=i("%I:%M"),p=i("%I %p"),q=i("%a %d"),r=i("%b %d"),s=i("%B"),t=i("%Y"),w=[[g,1,Vj],[g,5,5*Vj],[g,15,15*Vj],[g,30,30*Vj],[f,1,Wj],[f,5,5*Wj],[f,15,15*Wj],[f,30,30*Wj],[e,1,Xj],[e,3,3*Xj],[e,6,6*Xj],[e,12,12*Xj],[d,1,Yj],[d,2,2*Yj],[c,1,Z_],[b,1,wF],[b,3,3*wF],[a,1,ju]];function v(u){return(g(u)<u?m:f(u)<u?n:e(u)<u?o:d(u)<u?p:b(u)<u?c(u)<u?q:r:a(u)<u?s:t)(u)}function x(u,z,y){u==null&&(u=10);if(typeof u==="number"){var B=Math.abs(y-z)/u,A=im(function(F){return F[2]}).right(w,B),C;return A===w.length?(C=_e(z/ju,y/ju,u),u=a):A?(A=w[B/w[A-1][2]<w[A][2]/B?A-1:A],C=A[1],u=A[0]):(C=Math.max(_e(z,y,u),1),u=h),u.every(C)}return u}return j.invert=function(u){return new Date(k(u))},j.domain=function(u){return arguments.length?l(Array.from(u,$_)):l().map(__)},j.ticks=function(u){var z=l(),y=z[0],B=z[z.length-1],A=B<y,C;return A&&(C=y,y=B,B=C),C=x(u,y,B),C=C?C.range(y,B+1):[],A?C.reverse():C},j.tickFormat=function(u,z){return z==null?v:i(z)},j.nice=function(u){var z=l();return(u=x(u,z[0],z[z.length-1]))?l(kF(z,u)):j},j.copy=function(){return Uj(j,ku(a,b,c,d,e,f,g,h,i))},j}function a$(){return Od.apply(ku($e,wr,sm,jg,$A,_A,rm,yh,Ir).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function b$(){return Od.apply(ku(af,zr,tm,lg,bB,aB,rm,yh,Jr).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Dn(){var a=0,b=1,c,d,e,f,g=nc,h=!1,i;function j(l){return isNaN(l=+l)?i:g(e===0?.5:(l=(f(l)-c)*e,h?Math.max(0,Math.min(1,l)):l))}j.domain=function(l){return arguments.length?([a,b]=l,c=f(a=+a),d=f(b=+b),e=c===d?0:1/(d-c),j):[a,b]},j.clamp=function(l){return arguments.length?(h=!!l,j):h},j.interpolator=function(l){return arguments.length?(g=l,j):g};function k(l){return function(m){var n,o;return arguments.length?([n,o]=m,g=l(n,o),j):[g(0),g(1)]}}return j.range=k(yg),j.rangeRound=k(Rj),j.unknown=function(l){return arguments.length?(i=l,j):i},function(l){return f=l,c=l(a),d=l(b),e=c===d?0:1/(d-c),j}}function sf(a,b){return b.domain(a.domain()).interpolator(a.interpolator()).clamp(a.clamp()).unknown(a.unknown())}function lu(){var a=zg(Dn()(nc));return a.copy=function(){return sf(a,lu())},pf.apply(a,arguments)}function xF(){var a=fu(Dn()).domain([1,10]);return a.copy=function(){return sf(a,xF()).base(a.base())},pf.apply(a,arguments)}function yF(){var a=gu(Dn());return a.copy=function(){return sf(a,yF()).constant(a.constant())},pf.apply(a,arguments)}function mu(){var a=hu(Dn());return a.copy=function(){return sf(a,mu()).exponent(a.exponent())},pf.apply(a,arguments)}function c$(){return mu.apply(null,arguments).exponent(.5)}function En(){var a=0,b=.5,c=1,d=1,e,f,g,h,i,j=nc,k,l=!1,m;function n(p){return isNaN(p=+p)?m:(p=.5+((p=+k(p))-f)*(d*p<d*f?h:i),j(l?Math.max(0,Math.min(1,p)):p))}n.domain=function(p){return arguments.length?([a,b,c]=p,e=k(a=+a),f=k(b=+b),g=k(c=+c),h=e===f?0:.5/(f-e),i=f===g?0:.5/(g-f),d=f<e?-1:1,n):[a,b,c]},n.clamp=function(p){return arguments.length?(l=!!p,n):l},n.interpolator=function(p){return arguments.length?(j=p,n):j};function o(p){return function(q){var r,s,t;return arguments.length?([r,s,t]=q,j=cu(p,[r,s,t]),n):[j(0),j(.5),j(1)]}}return n.range=o(yg),n.rangeRound=o(Rj),n.unknown=function(p){return arguments.length?(m=p,n):m},function(p){return k=p,e=p(a),f=p(b),g=p(c),h=e===f?0:.5/(f-e),i=f===g?0:.5/(g-f),d=f<e?-1:1,n}}function zF(){var a=zg(En()(nc));return a.copy=function(){return sf(a,zF())},pf.apply(a,arguments)}function AF(){var a=fu(En()).domain([.1,1,10]);return a.copy=function(){return sf(a,AF()).base(a.base())},pf.apply(a,arguments)}function BF(){var a=gu(En());return a.copy=function(){return sf(a,BF()).constant(a.constant())},pf.apply(a,arguments)}function nu(){var a=hu(En());return a.copy=function(){return sf(a,nu()).exponent(a.exponent())},pf.apply(a,arguments)}function d$(){return nu.apply(null,arguments).exponent(.5)}function ou(){var a=Mt().unknown(void 0),b=a.domain,c=a.range,d=[0,1],e,f,g=!1,h=0,i=0,j=.5;delete a.unknown;function k(){var l=b().length,m=d[1]<d[0],n=d[m-0],o=d[1-m],p=Gt(l,h,i);e=(o-n)/(p||1),g&&(e=Math.floor(e)),n+=(o-n-e*(l-h))*j,f=e*(1-h),g&&(n=Math.round(n),f=Math.round(f));var q=gg(l).map(function(r){return n+e*r});return c(m?q.reverse():q)}return a.domain=function(l){return arguments.length?(b(l),k()):b()},a.range=function(l){return arguments.length?(d=[+l[0],+l[1]],k()):d.slice()},a.rangeRound=function(l){return d=[+l[0],+l[1]],g=!0,k()},a.bandwidth=function(){return f},a.step=function(){return e},a.round=function(l){return arguments.length?(g=!!l,k()):g},a.padding=function(l){return arguments.length?(i=Math.max(0,Math.min(1,l)),h=i,k()):h},a.paddingInner=function(l){return arguments.length?(h=Math.max(0,Math.min(1,l)),k()):h},a.paddingOuter=function(l){return arguments.length?(i=Math.max(0,Math.min(1,l)),k()):i},a.align=function(l){return arguments.length?(j=Math.max(0,Math.min(1,l)),k()):j},a.invertRange=function(l){if(l[0]==null||l[1]==null)return;var m=+l[0],n=+l[1],o=d[1]<d[0],p=o?c().reverse():c(),q=p.length-1,r,s,t;return m!==m||n!==n?void 0:(n<m&&(t=m,m=n,n=t),n<p[0]||m>d[1-o]?void 0:(r=Math.max(0,Ze(p,m)-1),s=m===n?r:Ze(p,n)-1,m-p[r]>f+1e-10&&++r,o&&(t=r,r=q-s,s=q-t),r>s?void 0:b().slice(r,s+1)))},a.invert=function(l){var m=a.invertRange([l,l]);return m?m[0]:m},a.copy=function(){return ou().domain(b()).range(d).round(g).paddingInner(h).paddingOuter(i).align(j)},k()}function CF(a){var b=a.copy;return a.padding=a.paddingOuter,delete a.paddingInner,a.copy=function(){return CF(b())},a}function e$(){return CF(ou().paddingInner(1))}var f$=Array.prototype.map;function g$(a){return f$.call(a,function(b){return+b})}var h$=Array.prototype.slice;function DF(){var a=[],b=[];function c(d){return d==null||d!==d?void 0:b[(Ze(a,d)-1)%b.length]}return c.domain=function(d){return arguments.length?(a=g$(d),c):a.slice()},c.range=function(d){return arguments.length?(b=h$.call(d),c):b.slice()},c.tickFormat=function(d,e){return hF(a[0],ra(a),d==null?10:d,e)},c.copy=function(){return DF().domain(c.domain()).range(c.range())},c}const Fn={};function i$(a,b,c){const d=function e(){var f=b();return f.invertRange||(f.invertRange=f.invert?a_(f):f.invertExtent?b_(f):void 0),f.type=a,f};return d.metadata=wb(T(c)),d}function va(a,b,c){return arguments.length>1?(Fn[a]=i$(a,b,c),this):EF(a)?Fn[a]:void 0}va($Z,jF),va(Vh,iF,ib),va(ve,oF,[ib,ve]),va(Jj,iu,ib),va(Kj,Y_,ib),va(qn,rF,ib),va(ug,a$,[ib,Kt]),va(vg,b$,[ib,Kt]),va(Nd,lu,[ib,Vc]),va(`${Nd}-${Vh}`,lu,[ib,Vc]),va(`${Nd}-${ve}`,xF,[ib,Vc,ve]),va(`${Nd}-${Jj}`,mu,[ib,Vc]),va(`${Nd}-${Kj}`,c$,[ib,Vc]),va(`${Nd}-${qn}`,yF,[ib,Vc]),va(`${Wh}-${Vh}`,zF,[ib,Vc]),va(`${Wh}-${ve}`,AF,[ib,Vc,ve]),va(`${Wh}-${Jj}`,nu,[ib,Vc]),va(`${Wh}-${Kj}`,d$,[ib,Vc]),va(`${Wh}-${qn}`,BF,[ib,Vc]),va(Xh,tF,[Mj,Xh]),va(rn,uF,Mj),va(sn,vF,Mj),va(Jt,DF,[Lj,Mj]),va(Ht,Mt,Lj),va(sE,ou,Lj),va(It,e$,Lj);function EF(a){return _(Fn,a)}function Ag(a,b){const c=Fn[a];return c&&c.metadata[b]}function pu(a){return Ag(a,ib)}function ai(a){return Ag(a,Lj)}function qu(a){return Ag(a,Mj)}function FF(a){return Ag(a,ve)}function j$(a){return Ag(a,Kt)}function GF(a){return Ag(a,Vc)}function HF(a){return Ag(a,Xh)}const k$=["clamp","base","constant","exponent"];function IF(a,b){var c=b[0],d=ra(b)-c;return function(e){return a(c+e*d)}}function Gn(a,b,c){return cu(ru(b||"rgb",c),a)}function JF(a,b){for(var c=new Array(b),d=b+1,e=0;e<b;)c[e]=a(++e/d);return c}function KF(a,b,c){var d=c-b,e,f,g;return!d||!Number.isFinite(d)?Vb(.5):(e=(f=a.type).indexOf("-"),f=e<0?f:f.slice(e+1),g=va(f)().domain([b,c]).range([0,1]),k$.forEach(h=>a[h]?g[h](a[h]()):0),g)}function ru(a,b){var c=M_[l$(a)];return b!=null&&c&&c.gamma?c.gamma(b):c}function l$(a){return"interpolate"+a.toLowerCase().split("-").map(function(b){return b[0].toUpperCase()+b.slice(1)}).join("")}const m$={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},n$={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function LF(a){for(var b=a.length/6|0,c=new Array(b),d=0;d<b;)c[d]="#"+a.slice(d*6,++d*6);return c}function MF(a,b){for(let c in a)su(c,b(a[c]))}const NF={};MF(n$,LF),MF(m$,a=>Gn(LF(a)));function su(a,b){return a=a&&a.toLowerCase(),arguments.length>1?(NF[a]=b,this):NF[a]}var Hn="symbol",o$="discrete",p$="gradient";const q$=a=>J(a)?a.map(b=>String(b)):String(a),r$=(a,b)=>a[1]-b[1],s$=(a,b)=>b[1]-a[1];function tu(a,b,c){var d;return Fa(b)&&(a.bins&&(b=Math.max(b,a.bins.length)),c!=null&&(b=Math.min(b,Math.floor($l(a.domain())/c||1)))),Z(b)&&(d=b.step,b=b.interval),V(b)&&(b=a.type===ug?Ah(b):a.type==vg?Bh(b):H("Only time and utc scales accept interval strings."),d&&(b=b.every(d))),b}function OF(a,b,c){let d=a.range(),e=d[0],f=ra(d),g=r$;e>f&&(d=f,f=e,e=d,g=s$),e=Math.floor(e),f=Math.ceil(f),b=b.map(h=>[h,a(h)]).filter(h=>e<=h[1]&&h[1]<=f).sort(g).map(h=>h[0]);if(c>0&&b.length>1){const h=[b[0],ra(b)];for(;b.length>c&&b.length>=3;)b=b.filter((i,j)=>!(j%2));b.length<3&&(b=h)}return b}function uu(a,b){return a.bins?OF(a,a.bins):a.ticks?a.ticks(b):a.domain()}function PF(a,b,c,d,e,f){var g=b.type;let h=q$;if(g===ug||e===ug)h=a.timeFormat(d);else if(g===vg||e===vg)h=a.utcFormat(d);else if(FF(g)){const i=a.formatFloat(d);if(f||b.bins)h=i;else{const j=QF(b,c,!1);h=k=>j(k)?i(k):""}}else if(b.tickFormat){const i=b.domain();h=a.formatSpan(i[0],i[i.length-1],c,d)}else d&&(h=a.format(d));return h}function QF(a,b,c){const d=uu(a,b),e=a.base(),f=Math.log(e),g=Math.max(1,e*b/d.length),h=i=>{let j=i/Math.pow(e,Math.round(Math.log(i)/f));return j*e<e-.5&&(j*=e),j<=g};return c?d.filter(h):h}const vu={[Xh]:"quantiles",[rn]:"thresholds",[sn]:"domain"},RF={[Xh]:"quantiles",[rn]:"domain"};function SF(a,b){return a.bins?v$(a.bins):a.type===ve?QF(a,b,!0):vu[a.type]?u$(a[vu[a.type]]()):uu(a,b)}function t$(a,b,c){var d=b[RF[b.type]](),e=d.length,f=e>1?d[1]-d[0]:d[0],g;for(g=1;g<e;++g)f=Math.min(f,d[g]-d[g-1]);return a.formatSpan(0,f,3*10,c)}function u$(a){const b=[-Infinity].concat(a);return b.max=Infinity,b}function v$(a){const b=a.slice(0,-1);return b.max=ra(a),b}function w$(a){return vu[a.type]||a.bins}function TF(a,b,c,d,e,f,g){const h=RF[b.type]&&f!==ug&&f!==vg?t$(a,b,e):PF(a,b,c,e,f,g);return d===Hn&&w$(b)?x$(h):d===o$?y$(h):z$(h)}function x$(a){return(b,c,d)=>{var e=UF(d[c+1],UF(d.max,Infinity)),f=VF(b,a),g=VF(e,a);return f&&g?f+" – "+g:g?"< "+g:"≥ "+f}}function UF(a,b){return a!=null?a:b}function y$(a){return(b,c)=>c?a(b):null}function z$(a){return b=>a(b)}function VF(a,b){return Number.isFinite(a)?b(a):null}function A$(a){var b=a.domain(),c=b.length-1,d=+b[0],e=+ra(b),f=e-d;if(a.type===sn){const g=c?f/c:.1;d-=g,e+=g,f=e-d}return g=>(g-d)/f}function B$(a,b,c,d){const e=d||b.type;return V(c)&&j$(e)&&(c=c.replace(/%a/g,"%A").replace(/%b/g,"%B")),!c&&e===ug?a.timeFormat("%A, %d %B %Y, %X"):!c&&e===vg?a.utcFormat("%A, %d %B %Y, %X UTC"):TF(a,b,5,null,c,d,!0)}function WF(a,b,c){c=c||{};const d=Math.max(3,c.maxlen||7),e=B$(a,b,c.format,c.formatType);if(qu(b.type)){const f=SF(b).slice(1).map(e),g=f.length;return`${g} boundar${g===1?"y":"ies"}: ${f.join(", ")}`}else if(ai(b.type)){const f=b.domain(),g=f.length,h=g>d?f.slice(0,d-2).map(e).join(", ")+", ending with "+f.slice(-1).map(e):f.map(e).join(", ");return`${g} value${g===1?"":"s"}: ${h}`}else{const f=b.domain();return`values from ${e(f[0])} to ${e(ra(f))}`}}const XF="aria-hidden",wu="aria-label",xu="role",yu="aria-roledescription",YF="graphics-object",zu="graphics-symbol",ZF=(a,b,c)=>({[xu]:a,[yu]:b,[wu]:c||void 0}),C$=wb(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),_F={axis:{desc:"axis",caption:F$},legend:{desc:"legend",caption:G$},"title-text":{desc:"title",caption:a=>`Title text '${cG(a)}'`},"title-subtitle":{desc:"subtitle",caption:a=>`Subtitle text '${cG(a)}'`}},$F={ariaRole:xu,ariaRoleDescription:yu,description:wu};function aG(a,b){const c=b.aria===!1;a(XF,c||void 0);if(c||b.description==null)for(const d in $F)a($F[d],void 0);else{const d=b.mark.marktype;a(wu,b.description),a(xu,b.ariaRole||(d==="group"?YF:zu)),a(yu,b.ariaRoleDescription||`${d} mark`)}}function bG(a){return a.aria===!1?{[XF]:!0}:C$[a.role]?null:_F[a.role]?E$(a,_F[a.role]):D$(a)}function D$(a){const b=a.marktype,c=b==="group"||b==="text"||a.items.some(d=>d.description!=null&&d.aria!==!1);return ZF(c?YF:zu,`${b} mark container`,a.description)}function E$(a,b){try{const c=a.items[0],d=b.caption||(()=>"");return ZF(b.role||zu,b.desc,c.description||d(c))}catch(c){return null}}function cG(a){return T(a.text).join(" ")}function F$(a){const b=a.datum,c=a.orient,d=b.title?dG(a):null,e=a.context,f=e.scales[b.scale].value,g=e.dataflow.locale(),h=f.type,i=c==="left"||c==="right"?"Y":"X";return`${i}-axis`+(d?` titled '${d}'`:"")+` for a ${ai(h)?"discrete":h} scale with ${WF(g,f,a)}`}function G$(a){const b=a.datum,c=b.title?dG(a):null,d=`${b.type||""} legend`.trim(),e=b.scales,f=Object.keys(e),g=a.context,h=g.scales[e[f[0]]].value,i=g.dataflow.locale();return I$(d)+(c?` titled '${c}'`:"")+` for ${H$(f)} with ${WF(i,h,a)}`}function dG(a){try{return T(ra(a.items).items[0].text).join(" ")}catch(b){return null}}function H$(a){return a=a.map(b=>b+(b==="fill"||b==="stroke"?" color":"")),a.length<2?a[0]:a.slice(0,-1).join(", ")+" and "+ra(a)}function I$(a){return a.length?a[0].toUpperCase()+a.slice(1):a}const J$=a=>(a+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function Ra(a,b,c){var d="<"+a,e,f;if(b)for(e in b)f=b[e],f!=null&&(d+=" "+e+'="'+J$(f)+'"');return c&&(d+=" "+c),d+">"}function Ua(a){return"</"+a+">"}const In={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Au={fill:"none","stroke-miterlimit":10},Jn=0,Ab=Th.xmlns;function Bu(a){od.call(this,a),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var oc=N(Bu,od),Cu=od.prototype;oc.initialize=function(a,b,c,d){this._defs={gradient:{},clipping:{}};if(a){this._svg=Fc(a,0,"svg",Ab),this._svg.setAttribute("class","marks"),nd(a,1),this._root=Fc(this._svg,Jn,"g",Ab);for(const e in Au)this._root.setAttribute(e,Au[e]);nd(this._svg,Jn+1)}return this.background(this._bgcolor),Cu.initialize.call(this,a,b,c,d)},oc.background=function(a){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",a),Cu.background.apply(this,arguments)},oc.resize=function(a,b,c,d){return Cu.resize.call(this,a,b,c,d),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},oc.canvas=function(){return this._svg},oc.svg=function(){if(!this._svg)return null;var a={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var b in Th)a[b]=Th[b];var c=this._bgcolor?Ra("rect",{width:this._width,height:this._height,fill:this._bgcolor})+Ua("rect"):"";return Ra("svg",a)+(this._defs.el?this._defs.el.outerHTML:"")+c+this._root.outerHTML+Ua("svg")},oc._render=function(a){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,a),nd(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},oc.updateDefs=function(){const a=this._svg,b=this._defs;let c=b.el,d=0;for(const e in b.gradient)c||(b.el=c=Fc(a,Jn,"defs",Ab)),d=K$(c,b.gradient[e],d);for(const e in b.clipping)c||(b.el=c=Fc(a,Jn,"defs",Ab)),d=L$(c,b.clipping[e],d);c&&(d===0?(a.removeChild(c),b.el=null):nd(c,d))};function K$(a,b,c){var d,e,f;if(b.gradient==="radial"){var g=Fc(a,c++,"pattern",Ab);g.setAttribute("id",Hm+b.id),g.setAttribute("viewBox","0,0,1,1"),g.setAttribute("width","100%"),g.setAttribute("height","100%"),g.setAttribute("preserveAspectRatio","xMidYMid slice"),g=Fc(g,0,"rect",Ab),g.setAttribute("width","1"),g.setAttribute("height","1"),g.setAttribute("fill","url("+gG()+"#"+b.id+")"),a=Fc(a,c++,"radialGradient",Ab),a.setAttribute("id",b.id),a.setAttribute("fx",b.x1),a.setAttribute("fy",b.y1),a.setAttribute("fr",b.r1),a.setAttribute("cx",b.x2),a.setAttribute("cy",b.y2),a.setAttribute("r",b.r2)}else a=Fc(a,c++,"linearGradient",Ab),a.setAttribute("id",b.id),a.setAttribute("x1",b.x1),a.setAttribute("x2",b.x2),a.setAttribute("y1",b.y1),a.setAttribute("y2",b.y2);for(d=0,e=b.stops.length;d<e;++d)f=Fc(a,d,"stop",Ab),f.setAttribute("offset",b.stops[d].offset),f.setAttribute("stop-color",b.stops[d].color);return nd(a,d),c}function L$(a,b,c){var d;return a=Fc(a,c,"clipPath",Ab),a.setAttribute("id",b.id),b.path?(d=Fc(a,0,"path",Ab),d.setAttribute("d",b.path)):(d=Fc(a,0,"rect",Ab),d.setAttribute("x",0),d.setAttribute("y",0),d.setAttribute("width",b.width),d.setAttribute("height",b.height)),nd(a,1),c+1}oc._resetDefs=function(){var a=this._defs;a.gradient={},a.clipping={}},oc.dirty=function(a){a.dirty!==this._dirtyID&&(a.dirty=this._dirtyID,this._dirty.push(a))},oc.isDirty=function(a){return this._dirtyAll||!a._svg||a.dirty===this._dirtyID},oc._dirtyCheck=function(){this._dirtyAll=!0;var a=this._dirty;if(!a.length||!this._dirtyID)return!0;var b=++this._dirtyID,c,d,e,f,g,h,i;for(g=0,h=a.length;g<h;++g){c=a[g],d=c.mark,d.marktype!==e&&(e=d.marktype,f=Tc[e]),d.zdirty&&d.dirty!==b&&(this._dirtyAll=!1,eG(c,b),d.items.forEach(function(j){j.dirty=b}));if(d.zdirty)continue;if(c.exit){f.nested&&d.items.length?(i=d.items[0],i._svg&&this._update(f,i._svg,i)):c._svg&&(i=c._svg.parentNode,i&&i.removeChild(c._svg)),c._svg=null;continue}c=f.nested?d.items[0]:c;if(c._update===b)continue;!c._svg||!c._svg.ownerSVGElement?(this._dirtyAll=!1,eG(c,b)):this._update(f,c._svg,c),c._update=b}return!this._dirtyAll};function eG(a,b){for(;a&&a.dirty!==b;a=a.mark.group){a.dirty=b;if(a.mark&&a.mark.dirty!==b)a.mark.dirty=b;else return}}oc.draw=function(a,b,c){if(!this.isDirty(b))return b._svg;var d=this._svg,e=Tc[b.marktype],f=b.interactive===!1?"none":null,g=e.tag==="g",h=null,i=0,j;j=fG(b,a,c,"g",d),j.setAttribute("class",jE(b));const k=bG(b);for(const m in k)pc(j,m,k[m]);g||pc(j,"pointer-events",f),pc(j,"clip-path",b.clip?gt(this,b,b.group):null);const l=m=>{const n=this.isDirty(m),o=fG(m,j,h,e.tag,d);n&&(this._update(e,o,m),g&&M$(this,o,m)),h=o,++i};return e.nested?b.items.length&&l(b.items[0]):md(b,l),nd(j,i),j};function M$(a,b,c){b=b.lastChild.previousSibling;let d,e=0;md(c,f=>{d=a.draw(b,f,d),++e}),nd(b,1+e)}function fG(a,b,c,d,e){let f=a._svg,g;if(!f){g=b.ownerDocument,f=mf(g,d,Ab),a._svg=f;if(a.mark){f.__data__=a,f.__values__={fill:"default"};if(d==="g"){const h=mf(g,"path",Ab);f.appendChild(h),h.__data__=a;const i=mf(g,"g",Ab);f.appendChild(i),i.__data__=a;const j=mf(g,"path",Ab);f.appendChild(j),j.__data__=a,j.__values__={fill:"default"}}}}return(f.ownerSVGElement!==e||N$(f,c))&&b.insertBefore(f,c?c.nextSibling:b.firstChild),f}function N$(a,b){return a.parentNode&&a.parentNode.childNodes.length>1&&a.previousSibling!=b}var xe=null,Kb=null,O$={group:function(a,b,c){const d=xe=b.childNodes[2];Kb=d.__values__,a.foreground(Zj,c,this),Kb=b.__values__,xe=b.childNodes[1],a.content(Zj,c,this);const e=xe=b.childNodes[0];a.background(Zj,c,this);const f=c.mark.interactive===!1?"none":null;f!==Kb.events&&(pc(d,"pointer-events",f),pc(e,"pointer-events",f),Kb.events=f);if(c.strokeForeground&&c.stroke){const g=c.fill;pc(d,"display",null),this.style(e,c),pc(e,"stroke",null),g&&(c.fill=null),Kb=d.__values__,this.style(d,c),g&&(c.fill=g),xe=null}else pc(d,"display","none")},image:function(a,b,c){c.smooth===!1?(Du(b,"image-rendering","optimizeSpeed"),Du(b,"image-rendering","pixelated")):Du(b,"image-rendering",null)},text:function(a,b,c){let d=Dj(c),e,f,g,h;J(d)?(f=d.map(i=>lf(c,i)),e=f.join(`
`),e!==Kb.text&&(nd(b,0),g=b.ownerDocument,h=kf(c),f.forEach((i,j)=>{const k=mf(g,"tspan",Ab);k.__data__=c,k.textContent=i,j&&(k.setAttribute("x",0),k.setAttribute("dy",h)),b.appendChild(k)}),Kb.text=e)):(f=lf(c,d),f!==Kb.text&&(b.textContent=f,Kb.text=f)),pc(b,"font-family",Ej(c)),pc(b,"font-size",Md(c)+"px"),pc(b,"font-style",c.fontStyle),pc(b,"font-variant",c.fontVariant),pc(b,"font-weight",c.fontWeight)}};function Du(a,b,c){c!==Kb[b]&&(c==null?a.style.removeProperty(b):a.style.setProperty(b,c+""),Kb[b]=c)}oc._update=function(a,b,c){xe=b,Kb=b.__values__,aG(Zj,c),a.attr(Zj,c,this);const d=O$[a.type];d&&d.call(this,a,b,c),xe&&this.style(xe,c)};function Zj(a,b,c){if(b===Kb[a])return;c?P$(xe,a,b,c):pc(xe,a,b),Kb[a]=b}function pc(a,b,c){c!=null?a.setAttribute(b,c):a.removeAttribute(b)}function P$(a,b,c,d){c!=null?a.setAttributeNS(d,b,c):a.removeAttributeNS(d,b)}oc.style=function(a,b){if(b==null)return;for(const c in In){let d=c==="font"?Ej(b):b[c];if(d===Kb[c])continue;const e=In[c];d==null?a.removeAttribute(e):(Ss(d)&&(d=ZC(d,this._defs.gradient,gG())),a.setAttribute(e,d+"")),Kb[c]=d}};function gG(){let a;return typeof window==="undefined"?"":(a=window.location).hash?a.href.slice(0,-a.hash.length):a.href}function Eu(a){od.call(this,a),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}var ye=N(Eu,od),hG=od.prototype;ye.resize=function(a,b,c,d){hG.resize.call(this,a,b,c,d);var e=this._origin,f=this._text,g={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var h in Th)g[h]=Th[h];f.head=Ra("svg",g);var i=this._bgcolor;return(i==="transparent"||i==="none")&&(i=null),i?f.bg=Ra("rect",{width:this._width,height:this._height,fill:i})+Ua("rect"):f.bg="",f.root=Ra("g",la({},Au,{transform:"translate("+e+")"})),f.foot=Ua("g")+Ua("svg"),this},ye.background=function(){var a=hG.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),a},ye.svg=function(){var a=this._text;return a.head+a.defs+a.bg+a.root+a.body+a.foot},ye._render=function(a){return this._text.body=this.mark(a),this._text.defs=this.buildDefs(),this},ye.buildDefs=function(){let a="",b;for(const c in this._defs.gradient){const d=this._defs.gradient[c],e=d.stops;d.gradient==="radial"?(a+=Ra(b="pattern",{id:Hm+c,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),a+=Ra("rect",{width:"1",height:"1",fill:"url(#"+c+")"})+Ua("rect"),a+=Ua(b),a+=Ra(b="radialGradient",{id:c,fx:d.x1,fy:d.y1,fr:d.r1,cx:d.x2,cy:d.y2,r:d.r2})):a+=Ra(b="linearGradient",{id:c,x1:d.x1,x2:d.x2,y1:d.y1,y2:d.y2});for(let f=0;f<e.length;++f)a+=Ra("stop",{offset:e[f].offset,"stop-color":e[f].color})+Ua("stop");a+=Ua(b)}for(const c in this._defs.clipping){const d=this._defs.clipping[c];a+=Ra("clipPath",{id:c}),d.path?a+=Ra("path",{d:d.path})+Ua("path"):a+=Ra("rect",{x:0,y:0,width:d.width,height:d.height})+Ua("rect"),a+=Ua("clipPath")}return a?Ra("defs")+a+Ua("defs"):""},ye.attr=function(a,b,c,d){const e={},f=(g,h,i,j)=>{e[j||g]=h};return Array.isArray(c)?c.forEach(g=>g(f,b,this)):c(f,b,this),d&&Q$(e,b,a,d,this._defs),e},ye.href=function(a){var b=this,c=a.href,d;if(c){if(d=b._hrefs&&b._hrefs[c])return d;b.sanitizeURL(c).then(e=>{e["xlink:href"]=e.href,e.href=null,(b._hrefs||(b._hrefs={}))[c]=e})}return null},ye.mark=function(a){const b=Tc[a.marktype],c=b.tag,d=[aG,b.attr];let e="";e+=Ra("g",la({class:jE(a),"clip-path":a.clip?gt(this,a,a.group):null},bG(a),{"pointer-events":c!=="g"&&a.interactive===!1?"none":null}));const f=g=>{const h=this.href(g);h&&(e+=Ra("a",h)),e+=Ra(c,this.attr(a,g,d,c!=="g"?c:null));if(c==="text"){const i=Dj(g);if(J(i)){const j={x:0,dy:kf(g)};for(let k=0;k<i.length;++k)e+=Ra("tspan",k?j:null)+iG(lf(g,i[k]))+Ua("tspan")}else e+=iG(lf(g,i))}else if(c==="g"){const i=g.strokeForeground,j=g.fill,k=g.stroke;i&&k&&(g.stroke=null),e+=Ra("path",this.attr(a,g,b.background,"bgrect"))+Ua("path"),e+=Ra("g",this.attr(a,g,b.content))+this.markGroup(g)+Ua("g"),i&&k?(j&&(g.fill=null),g.stroke=k,e+=Ra("path",this.attr(a,g,b.foreground,"bgrect"))+Ua("path"),j&&(g.fill=j)):e+=Ra("path",this.attr(a,g,b.foreground,"bgfore"))+Ua("path")}e+=Ua(c),h&&(e+=Ua("a"))};return b.nested?a.items&&a.items.length&&f(a.items[0]):md(a,f),e+Ua("g")},ye.markGroup=function(a){let b="";return md(a,c=>{b+=this.mark(c)}),b};function Q$(a,b,c,d,e){if(b==null)return a;d==="bgrect"&&c.interactive===!1&&(a["pointer-events"]="none");if(d==="bgfore"){c.interactive===!1&&(a["pointer-events"]="none"),a.display="none";if(b.fill!==null)return a}d==="image"&&b.smooth===!1&&(a.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),d==="text"&&(a["font-family"]=Ej(b),a["font-size"]=Md(b)+"px",b.fontStyle&&(a["font-style"]=b.fontStyle),b.fontVariant&&(a["font-variant"]=b.fontVariant),b.fontWeight&&(a["font-weight"]=b.fontWeight));for(const f in In){let g=b[f];const h=In[f];g==="transparent"&&(h==="fill"||h==="stroke")||g!=null&&(Ss(g)&&(g=ZC(g,e.gradient,"")),a[h]=g)}return a}function iG(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var jG="canvas",kG="png",lG="svg",mG="none",tf={Canvas:jG,PNG:kG,SVG:lG,None:mG},bi={};bi[jG]=bi[kG]={renderer:on,headless:on,handler:Ij},bi[lG]={renderer:Bu,headless:Eu,handler:Et},bi[mG]={};function Kn(a,b){return a=String(a||"").toLowerCase(),arguments.length>1?(bi[a]=b,this):bi[a]}function nG(a,b,c){const d=[],e=new gb().union(b),f=a.marktype;return f?oG(a,e,c,d):f==="group"?pG(a,e,c,d):H("Intersect scene must be mark node or group item.")}function oG(a,b,c,d){if(R$(a,b,c)){const e=a.items,f=a.marktype,g=e.length;let h=0;if(f==="group")for(;h<g;++h)pG(e[h],b,c,d);else for(const i=Tc[f].isect;h<g;++h){let j=e[h];qG(j,b,i)&&d.push(j)}}return d}function R$(a,b,c){return a.bounds&&b.intersects(a.bounds)&&(a.marktype==="group"||a.interactive!==!1&&(!c||c(a)))}function pG(a,b,c,d){c&&c(a.mark)&&qG(a,b,Tc.group.isect)&&d.push(a);const e=a.items,f=e&&e.length;if(f){const g=a.x||0,h=a.y||0;b.translate(-g,-h);for(let i=0;i<f;++i)oG(e[i],b,c,d);b.translate(g,h)}return d}function qG(a,b,c){const d=a.bounds;return b.encloses(d)||b.intersects(d)&&c(a,b)}var Fu=new gb();function rG(a){var b=a.clip;if(pa(b))b(mc(Fu.clear()));else if(b)Fu.set(0,0,a.group.width,a.group.height);else return;a.bounds.intersect(Fu)}var S$=1e-9;function Gu(a,b,c){return a===b?!0:c==="path"?sG(a,b):a instanceof Date&&b instanceof Date?+a===+b:Fa(a)&&Fa(b)?Math.abs(a-b)<=S$:!a||!b||!Z(a)&&!Z(b)?a==b:a==null||b==null?!1:T$(a,b)}function sG(a,b){return Gu(Mh(a),Mh(b))}function T$(a,b){var c=Object.keys(a),d=Object.keys(b),e,f;if(c.length!==d.length)return!1;for(c.sort(),d.sort(),f=c.length-1;f>=0;f--)if(c[f]!=d[f])return!1;for(f=c.length-1;f>=0;f--){e=c[f];if(!Gu(a[e],b[e],e))return!1}return typeof a===typeof b}function U$(){ED(),wX()}function tG(a){E.call(this,null,a)}var V$=N(tG,E);V$.transform=function(a,b){var c=b.dataflow,d=a.mark,e=d.marktype,f=Tc[e],g=f.bound,h=d.bounds,i;if(f.nested)d.items.length&&c.dirty(d.items[0]),h=Ln(d,g),d.items.forEach(function(j){j.bounds.clear().union(h)});else if(e===Fm||a.modified()){b.visit(b.MOD,j=>c.dirty(j)),h.clear(),d.items.forEach(j=>h.union(Ln(j,g)));switch(d.role){case Ms:case Os:case Ns:b.reflow()}}else i=b.changed(b.REM),b.visit(b.ADD,j=>{h.union(Ln(j,g))}),b.visit(b.MOD,j=>{i=i||h.alignsWith(j.bounds),c.dirty(j),h.union(Ln(j,g))}),i&&(h.clear(),d.items.forEach(j=>h.union(j.bounds)));return rG(d),b.modifies("bounds")};function Ln(a,b,c){return b(a.bounds.clear(),a,c)}var uG=":vega_identifier:";function Hu(a){E.call(this,0,a)}Hu.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};var W$=N(Hu,E);W$.transform=function(a,b){var c=X$(b.dataflow),d=c.value,e=a.as;return b.visit(b.ADD,f=>{f[e]||(f[e]=++d)}),c.set(this.value=d),b};function X$(a){var b=a._signals[uG];return b||(a._signals[uG]=b=a.add(0)),b}function vG(a){E.call(this,null,a)}var Y$=N(vG,E);Y$.transform=function(a,b){var c=this.value;c||(c=b.dataflow.scenegraph().mark(a.markdef,Z$(a),a.index),c.group.context=a.context,a.context.group||(a.context.group=c.group),c.source=this.source,c.clip=a.clip,c.interactive=a.interactive,this.value=c);var d=c.marktype===Fm?Tm:Sm;return b.visit(b.ADD,e=>d.call(e,c)),(a.modified("clip")||a.modified("interactive"))&&(c.clip=a.clip,c.interactive=!!a.interactive,c.zdirty=!0,b.reflow()),c.items=b.source,b};function Z$(a){var b=a.groups,c=a.parent;return b&&b.size===1?b.get(Object.keys(b.object)[0]):b&&c?b.lookup(c):null}function wG(a){E.call(this,null,a)}var _$=N(wG,E),xG={parity:a=>a.filter((b,c)=>c%2?b.opacity=0:1),greedy:(a,b)=>{var c;return a.filter((d,e)=>!e||!yG(c.bounds,d.bounds,b)?(c=d,1):d.opacity=0)}};function yG(a,b,c){return c>Math.max(b.x1-a.x2,a.x1-b.x2,b.y1-a.y2,a.y1-b.y2)}function zG(a,b){for(var c=1,d=a.length,e=a[0].bounds,f;c<d;e=f,++c)if(yG(e,f=a[c].bounds,b))return!0}function $$(a){var b=a.bounds;return b.width()>1&&b.height()>1}function a0(a,b,c){var d=a.range(),e=new gb();return b===Jh||b===df?e.set(d[0],-Infinity,d[1],Infinity):e.set(-Infinity,d[0],Infinity,d[1]),e.expand(c||1),f=>e.encloses(f.bounds)}function AG(a){return a.forEach(b=>b.opacity=1),a}function BG(a,b){return a.reflow(b.modified()).modifies("opacity")}_$.transform=function(a,b){var c=xG[a.method]||xG.parity,d=b.materialize(b.SOURCE).source,e=a.separation||0,f,g,h;if(!d||!d.length)return;if(!a.method)return a.modified("method")&&(AG(d),b=BG(b,a)),b;d=d.filter($$);if(!d.length)return;a.sort&&(d=d.slice().sort(a.sort)),f=AG(d),b=BG(b,a);if(f.length>=3&&zG(f,e)){do f=c(f,e);while(f.length>=3&&zG(f,e));f.length<3&&!ra(d).opacity&&(f.length>1&&(ra(f).opacity=0),ra(d).opacity=1)}return a.boundScale&&a.boundTolerance>=0&&(g=a0(a.boundScale,a.boundOrient,+a.boundTolerance),d.forEach(i=>{g(i)||(i.opacity=0)})),h=f[0].mark.bounds.clear(),d.forEach(i=>{i.opacity&&h.union(i.bounds)}),b};function CG(a){E.call(this,null,a)}var b0=N(CG,E);b0.transform=function(a,b){var c=b.dataflow;b.visit(b.ALL,e=>c.dirty(e));if(b.fields&&b.fields.zindex){var d=b.source&&b.source[0];d&&(d.mark.zdirty=!0)}};const Lb=new gb();function ci(a,b,c){return a[b]===c?0:(a[b]=c,1)}function c0(a){var b=a.items[0].orient;return b===jd||b===kd}function d0(a){var b=+a.grid;return[a.ticks?b++:-1,a.labels?b++:-1,b+ +a.domain]}function e0(a,b,c,d){var e=b.items[0],f=e.datum,g=e.translate!=null?e.translate:.5,h=e.orient,i=d0(f),j=e.range,k=e.offset,l=e.position,m=e.minExtent,n=e.maxExtent,o=f.title&&e.items[i[2]].items[0],p=e.titlePadding,q=e.bounds,r=o&&vt(o),s=0,t=0,w,v;Lb.clear().union(q),q.clear(),(w=i[0])>-1&&q.union(e.items[w].bounds),(w=i[1])>-1&&q.union(e.items[w].bounds);switch(h){case Jh:s=l||0,t=-k,v=Math.max(m,Math.min(n,-q.y1)),q.add(0,-v).add(j,0),o&&Mn(a,o,v,p,r,0,-1,q);break;case jd:s=-k,t=l||0,v=Math.max(m,Math.min(n,-q.x1)),q.add(-v,0).add(0,j),o&&Mn(a,o,v,p,r,1,-1,q);break;case kd:s=c+k,t=l||0,v=Math.max(m,Math.min(n,q.x2)),q.add(0,0).add(v,j),o&&Mn(a,o,v,p,r,1,1,q);break;case df:s=l||0,t=d+k,v=Math.max(m,Math.min(n,q.y2)),q.add(0,0).add(j,v),o&&Mn(a,o,v,p,0,0,1,q);break;default:s=e.x,t=e.y}return ue(q.translate(s,t),e),ci(e,"x",s+g)|ci(e,"y",t+g)&&(e.bounds=Lb,a.dirty(e),e.bounds=q,a.dirty(e)),e.mark.bounds.clear().union(q)}function Mn(a,b,c,d,e,f,g,h){const i=b.bounds;if(b.auto){const j=g*(c+e+d);let k=0,l=0;a.dirty(b),f?k=(b.x||0)-(b.x=j):l=(b.y||0)-(b.y=j),b.mark.bounds.clear().union(i.translate(-k,-l)),a.dirty(b)}h.union(i)}const DG=(a,b)=>Math.floor(Math.min(a,b)),EG=(a,b)=>Math.ceil(Math.max(a,b));function f0(a){for(var b=a.items,c=b.length,d=0,e,f,g={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};d<c;++d){e=b[d],f=e.items;if(e.marktype===Fm)switch(e.role){case Ms:case Os:case Ns:break;case RC:g.rowheaders.push(...f);break;case SC:g.rowfooters.push(...f);break;case UC:g.colheaders.push(...f);break;case VC:g.colfooters.push(...f);break;case TC:g.rowtitle=f[0];break;case WC:g.coltitle=f[0];break;default:g.marks.push(...f)}}return g}function g0(a){return new gb().set(0,0,a.width||0,a.height||0)}function h0(a){var b=a.bounds.clone();return b.empty()?b.set(0,0,0,0):b.translate(-(a.x||0),-(a.y||0))}function Na(a,b,c){var d=Z(a)?a[b]:a;return d!=null?d:c!==void 0?c:0}function FG(a){return a<0?Math.ceil(-a):0}function GG(a,b,c){var d=!c.nodirty,e=c.bounds===Rs?g0:h0,f=Lb.set(0,0,0,0),g=Na(c.align,ef),h=Na(c.align,ff),i=Na(c.padding,ef),j=Na(c.padding,ff),k=c.columns||b.length,l=k<=0?1:Math.ceil(b.length/k),m=b.length,n=Array(m),o=Array(k),p=0,q=Array(m),r=Array(l),s=0,t=Array(m),w=Array(m),v=Array(m),x,u,z,y,B,A,C,F,K,D,I;for(u=0;u<k;++u)o[u]=0;for(u=0;u<l;++u)r[u]=0;for(u=0;u<m;++u)A=b[u],B=v[u]=e(A),A.x=A.x||0,t[u]=0,A.y=A.y||0,w[u]=0,z=u%k,y=~~(u/k),p=Math.max(p,C=Math.ceil(B.x2)),s=Math.max(s,F=Math.ceil(B.y2)),o[z]=Math.max(o[z],C),r[y]=Math.max(r[y],F),n[u]=i+FG(B.x1),q[u]=j+FG(B.y1),d&&a.dirty(b[u]);for(u=0;u<m;++u)u%k===0&&(n[u]=0),u<k&&(q[u]=0);if(g===Qs)for(z=1;z<k;++z){for(I=0,u=z;u<m;u+=k)I<n[u]&&(I=n[u]);for(u=z;u<m;u+=k)n[u]=I+o[z-1]}else if(g===Gm){for(I=0,u=0;u<m;++u)u%k&&I<n[u]&&(I=n[u]);for(u=0;u<m;++u)u%k&&(n[u]=I+p)}else for(g=!1,z=1;z<k;++z)for(u=z;u<m;u+=k)n[u]+=o[z-1];if(h===Qs)for(y=1;y<l;++y){for(I=0,u=y*k,x=u+k;u<x;++u)I<q[u]&&(I=q[u]);for(u=y*k;u<x;++u)q[u]=I+r[y-1]}else if(h===Gm){for(I=0,u=k;u<m;++u)I<q[u]&&(I=q[u]);for(u=k;u<m;++u)q[u]=I+s}else for(h=!1,y=1;y<l;++y)for(u=y*k,x=u+k;u<x;++u)q[u]+=r[y-1];for(K=0,u=0;u<m;++u)K=n[u]+(u%k?K:0),t[u]+=K-b[u].x;for(z=0;z<k;++z)for(D=0,u=z;u<m;u+=k)D+=q[u],w[u]+=D-b[u].y;if(g&&Na(c.center,ef)&&l>1)for(u=0;u<m;++u)B=g===Gm?p:o[u%k],K=B-v[u].x2-b[u].x-t[u],K>0&&(t[u]+=K/2);if(h&&Na(c.center,ff)&&k!==1)for(u=0;u<m;++u)B=h===Gm?s:r[~~(u/k)],D=B-v[u].y2-b[u].y-w[u],D>0&&(w[u]+=D/2);for(u=0;u<m;++u)f.union(v[u].translate(t[u],w[u]));K=Na(c.anchor,nX),D=Na(c.anchor,oX);switch(Na(c.anchor,ef)){case Wb:K-=f.width();break;case Ls:K-=f.width()/2}switch(Na(c.anchor,ff)){case Wb:D-=f.height();break;case Ls:D-=f.height()/2}for(K=Math.round(K),D=Math.round(D),f.clear(),u=0;u<m;++u)b[u].mark.bounds.clear();for(u=0;u<m;++u)A=b[u],A.x+=t[u]+=K,A.y+=w[u]+=D,f.union(A.mark.bounds.union(A.bounds.translate(t[u],w[u]))),d&&a.dirty(A);return f}function i0(a,b,c){var d=f0(b),e=d.marks,f=c.bounds===Rs?j0:k0,g=c.offset,h=c.columns||e.length,i=h<=0?1:Math.ceil(e.length/h),j=i*h,k,l,m,n,o,p,q;const r=GG(a,e,c);r.empty()&&r.set(0,0,0,0),d.rowheaders&&(p=Na(c.headerBand,ff,null),k=Nn(a,d.rowheaders,e,h,i,-Na(g,"rowHeader"),DG,0,f,"x1",0,h,1,p)),d.colheaders&&(p=Na(c.headerBand,ef,null),l=Nn(a,d.colheaders,e,h,h,-Na(g,"columnHeader"),DG,1,f,"y1",0,1,h,p)),d.rowfooters&&(p=Na(c.footerBand,ff,null),m=Nn(a,d.rowfooters,e,h,i,Na(g,"rowFooter"),EG,0,f,"x2",h-1,h,1,p)),d.colfooters&&(p=Na(c.footerBand,ef,null),n=Nn(a,d.colfooters,e,h,h,Na(g,"columnFooter"),EG,1,f,"y2",j-h,1,h,p)),d.rowtitle&&(o=Na(c.titleAnchor,ff),q=Na(g,"rowTitle"),q=o===Wb?m+q:k-q,p=Na(c.titleBand,ff,.5),HG(a,d.rowtitle,q,0,r,p)),d.coltitle&&(o=Na(c.titleAnchor,ef),q=Na(g,"columnTitle"),q=o===Wb?n+q:l-q,p=Na(c.titleBand,ef,.5),HG(a,d.coltitle,q,1,r,p))}function j0(a,b){return b==="x1"?a.x||0:b==="y1"?a.y||0:b==="x2"?(a.x||0)+(a.width||0):b==="y2"?(a.y||0)+(a.height||0):void 0}function k0(a,b){return a.bounds[b]}function Nn(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=c.length,p=0,q=0,r,s,t,w,v,x,u,z,y;if(!o)return p;for(r=k;r<o;r+=l)c[r]&&(p=g(p,i(c[r],j)));if(!b.length)return p;for(b.length>e&&(a.warn("Grid headers exceed limit: "+e),b=b.slice(0,e)),p+=f,s=0,w=b.length;s<w;++s)a.dirty(b[s]),b[s].mark.bounds.clear();for(r=k,s=0,w=b.length;s<w;++s,r+=l){for(x=b[s],v=x.mark.bounds,t=r;t>=0&&(u=c[t])==null;t-=m);h?(z=n==null?u.x:Math.round(u.bounds.x1+n*u.bounds.width()),y=p):(z=p,y=n==null?u.y:Math.round(u.bounds.y1+n*u.bounds.height())),v.union(x.bounds.translate(z-(x.x||0),y-(x.y||0))),x.x=z,x.y=y,a.dirty(x),q=g(q,v[j])}return q}function HG(a,b,c,d,e,f){if(!b)return;a.dirty(b);var g=c,h=c;d?g=Math.round(e.x1+f*e.width()):h=Math.round(e.y1+f*e.height()),b.bounds.translate(g-(b.x||0),h-(b.y||0)),b.mark.bounds.clear().union(b.bounds),b.x=g,b.y=h,a.dirty(b)}function l0(a,b){const c=a[b]||{};return(d,e)=>c[d]!=null?c[d]:a[d]!=null?a[d]:e}function m0(a,b){var c=-Infinity;return a.forEach(d=>{d.offset!=null&&(c=Math.max(c,d.offset))}),c>-Infinity?c:b}function n0(a,b,c,d,e,f,g){const h=l0(c,b),i=m0(a,h("offset",0)),j=h("anchor",Ks),k=j===Wb?1:j===Ls?.5:0,l={align:Qs,bounds:h("bounds",Rs),columns:h("direction")==="vertical"?1:a.length,padding:h("margin",8),center:h("center"),nodirty:!0};switch(b){case jd:l.anchor={x:Math.floor(d.x1)-i,column:Wb,y:k*(g||d.height()+2*d.y1),row:j};break;case kd:l.anchor={x:Math.ceil(d.x2)+i,y:k*(g||d.height()+2*d.y1),row:j};break;case Jh:l.anchor={y:Math.floor(e.y1)-i,row:Wb,x:k*(f||e.width()+2*e.x1),column:j};break;case df:l.anchor={y:Math.ceil(e.y2)+i,x:k*(f||e.width()+2*e.x1),column:j};break;case jX:l.anchor={x:i,y:i};break;case kX:l.anchor={x:f-i,y:i,column:Wb};break;case lX:l.anchor={x:i,y:g-i,row:Wb};break;case mX:l.anchor={x:f-i,y:g-i,column:Wb,row:Wb};break}return l}function o0(a,b){var c=b.items[0],d=c.datum,e=c.orient,f=c.bounds,g=c.x,h=c.y,i,j;return c._bounds?c._bounds.clear().union(f):c._bounds=f.clone(),f.clear(),q0(a,c,c.items[0].items[0]),f=p0(c,f),i=2*c.padding,j=2*c.padding,f.empty()||(i=Math.ceil(f.width()+i),j=Math.ceil(f.height()+j)),d.type===sX&&r0(c.items[0].items[0].items[0].items),e!==Ps&&(c.x=g=0,c.y=h=0),c.width=i,c.height=j,ue(f.set(g,h,g+i,h+j),c),c.mark.bounds.clear().union(f),c}function p0(a,b){return a.items.forEach(c=>b.union(c.bounds)),b.x1=a.padding,b.y1=a.padding,b}function q0(a,b,c){var d=b.padding,e=d-c.x,f=d-c.y;if(!b.datum.title)(e||f)&&_j(a,c,e,f);else{var g=b.items[1].items[0],h=g.anchor,i=b.titlePadding||0,j=d-g.x,k=d-g.y;switch(g.orient){case jd:e+=Math.ceil(g.bounds.width())+i;break;case kd:case df:break;default:f+=g.bounds.height()+i}(e||f)&&_j(a,c,e,f);switch(g.orient){case jd:k+=di(b,c,g,h,1,1);break;case kd:j+=di(b,c,g,Wb,0,0)+i,k+=di(b,c,g,h,1,1);break;case df:j+=di(b,c,g,h,0,0),k+=di(b,c,g,Wb,-1,0,1)+i;break;default:j+=di(b,c,g,h,0,0)}(j||k)&&_j(a,g,j,k),(j=Math.round(g.bounds.x1-d))<0&&(_j(a,c,-j,0),_j(a,g,-j,0))}}function di(a,b,c,d,e,f,g){const h=a.datum.type!=="symbol",i=c.datum.vgrad,j=h&&(f||!i)&&!g?b.items[0]:b,k=j.bounds[e?"y2":"x2"]-a.padding,l=i&&f?k:0,m=i&&f?0:k,n=e<=0?0:vt(c);return Math.round(d===Ks?l:d===Wb?m-n:.5*(k-n))}function _j(a,b,c,d){b.x+=c,b.y+=d,b.bounds.translate(c,d),b.mark.bounds.translate(c,d),a.dirty(b)}function r0(a){var b=a.reduce((c,d)=>(c[d.column]=Math.max(d.bounds.x2-d.x,c[d.column]||0),c),{});a.forEach(c=>{c.width=b[c.column],c.height=c.bounds.y2-c.y})}function s0(a,b,c,d,e){var f=b.items[0],g=f.frame,h=f.orient,i=f.anchor,j=f.offset,k=f.padding,l=f.items[0].items[0],m=f.items[1]&&f.items[1].items[0],n=h===jd||h===kd?d:c,o=0,p=0,q=0,r=0,s=0,t;g!==Fm?h===jd?(o=e.y2,n=e.y1):h===kd?(o=e.y1,n=e.y2):(o=e.x1,n=e.x2):h===jd&&(o=d,n=0),t=i===Ks?o:i===Wb?n:(o+n)/2;if(m&&m.text){switch(h){case Jh:case df:s=l.bounds.height()+k;break;case jd:r=l.bounds.width()+k;break;case kd:r=-l.bounds.width()-k;break}Lb.clear().union(m.bounds),Lb.translate(r-(m.x||0),s-(m.y||0)),ci(m,"x",r)|ci(m,"y",s)&&(a.dirty(m),m.bounds.clear().union(Lb),m.mark.bounds.clear().union(Lb),a.dirty(m)),Lb.clear().union(m.bounds)}else Lb.clear();Lb.union(l.bounds);switch(h){case Jh:p=t,q=e.y1-Lb.height()-j;break;case jd:p=e.x1-Lb.width()-j,q=t;break;case kd:p=e.x2+Lb.width()+j,q=t;break;case df:p=t,q=e.y2+j;break;default:p=f.x,q=f.y}return ci(f,"x",p)|ci(f,"y",q)&&(Lb.translate(p,q),a.dirty(f),f.bounds.clear().union(Lb),b.bounds.clear().union(Lb),a.dirty(f)),f.bounds}function IG(a){E.call(this,null,a)}var t0=N(IG,E);t0.transform=function(a,b){var c=b.dataflow;return a.mark.items.forEach(d=>{a.layout&&i0(c,d,a.layout),v0(c,d,a)}),u0(a.mark.group)?b.reflow():b};function u0(a){return a&&a.mark.role!=="legend-entry"}function v0(a,b,c){var d=b.items,e=Math.max(0,b.width||0),f=Math.max(0,b.height||0),g=new gb().set(0,0,e,f),h=g.clone(),i=g.clone(),j=[],k,l,m,n,o,p;for(o=0,p=d.length;o<p;++o){l=d[o];switch(l.role){case Ms:n=c0(l)?h:i,n.union(e0(a,l,e,f));break;case Ns:k=l;break;case Os:j.push(o0(a,l));break;case pX:case qX:case RC:case SC:case TC:case UC:case VC:case WC:h.union(l.bounds),i.union(l.bounds);break;default:g.union(l.bounds)}}if(j.length){const q={};j.forEach(r=>{m=r.orient||kd,m!==Ps&&(q[m]||(q[m]=[])).push(r)});for(let r in q){const s=q[r];GG(a,s,n0(s,r,c.legends,h,i,e,f))}j.forEach(r=>{const s=r.bounds;s.equals(r._bounds)||(r.bounds=r._bounds,a.dirty(r),r.bounds=s,a.dirty(r));if(c.autosize&&c.autosize.type===XC)switch(r.orient){case jd:case kd:g.add(s.x1,0).add(s.x2,0);break;case Jh:case df:g.add(0,s.y1).add(0,s.y2)}else g.union(s)})}g.union(h).union(i),k&&g.union(s0(a,k,e,f,g)),b.clip&&g.set(0,0,b.width||0,b.height||0),w0(a,b,g,c)}function w0(a,b,c,d){const e=d.autosize||{},f=e.type;if(a._autosize<1||!f)return;let g=a._width,h=a._height,i=Math.max(0,b.width||0),j=Math.max(0,Math.ceil(-c.x1)),k=Math.max(0,Math.ceil(c.x2-i)),l=Math.max(0,b.height||0),m=Math.max(0,Math.ceil(-c.y1)),n=Math.max(0,Math.ceil(c.y2-l));if(e.contains===rX){const o=a.padding();g-=o.left+o.right,h-=o.top+o.bottom}f===Ps?(j=0,m=0,i=g,l=h):f===XC?(i=Math.max(0,g-j-k),l=Math.max(0,h-m-n)):f===tX?(i=Math.max(0,g-j-k),h=l+m+n):f===uX?(g=i+j+k,l=Math.max(0,h-m-n)):f===vX&&(g=i+j+k,h=l+m+n),a._resizeView(g,h,i,l,[j,m],e.resize)}var x0=Object.freeze({__proto__:null,bound:tG,identifier:Hu,mark:vG,overlap:wG,render:CG,viewlayout:IG});function JG(a){E.call(this,null,a)}var y0=N(JG,E);y0.transform=function(a,b){if(this.value&&!a.modified())return b.StopPropagation;var c=b.dataflow.locale(),d=b.fork(b.NO_SOURCE|b.NO_FIELDS),e=this.value,f=a.scale,g=a.count==null?a.values?a.values.length:10:a.count,h=tu(f,g,a.minstep),i=a.format||PF(c,f,h,a.formatSpecifier,a.formatType,!!a.values),j=a.values?OF(f,a.values,h):uu(f,h);return e&&(d.rem=e),e=j.map(function(k,l){return xa({index:l/(j.length-1||1),value:k,label:i(k)})}),a.extra&&e.length&&e.push(xa({index:-1,extra:{value:e[0].value},label:""})),d.source=e,d.add=e,this.value=e,d};function KG(a){E.call(this,null,a)}var z0=N(KG,E);function A0(){return xa({})}function B0(a){const b=Zi().test(c=>c.exit);return b.lookup=c=>b.get(a(c)),b}z0.transform=function(a,b){var c=b.dataflow,d=b.fork(b.NO_SOURCE|b.NO_FIELDS),e=a.item||A0,f=a.key||aa,g=this.value;return J(d.encode)&&(d.encode=null),g&&(a.modified("key")||b.modified(f))&&H("DataJoin does not support modified key function or fields."),g||(b=b.addAll(),this.value=g=B0(f)),b.visit(b.ADD,h=>{const i=f(h);let j=g.get(i);j?j.exit?(g.empty--,d.add.push(j)):d.mod.push(j):(j=e(h),g.set(i,j),d.add.push(j)),j.datum=h,j.exit=!1}),b.visit(b.MOD,h=>{const i=f(h),j=g.get(i);j&&(j.datum=h,d.mod.push(j))}),b.visit(b.REM,h=>{const i=f(h),j=g.get(i);h===j.datum&&!j.exit&&(d.rem.push(j),j.exit=!0,++g.empty)}),b.changed(b.ADD_MOD)&&d.modifies("datum"),(b.clean()||a.clean&&g.empty>c.cleanThreshold)&&c.runAfter(g.clean),d};function LG(a){E.call(this,null,a)}var C0=N(LG,E);C0.transform=function(a,b){var c=b.fork(b.ADD_REM),d=a.mod||!1,e=a.encoders,f=b.encode;if(J(f))if(c.changed()||f.every(function(m){return e[m]}))f=f[0],c.encode=null;else return b.StopPropagation;var g=f==="enter",h=e.update||ag,i=e.enter||ag,j=e.exit||ag,k=(f&&!g?e[f]:h)||ag;b.changed(b.ADD)&&(b.visit(b.ADD,function(m){i(m,a),h(m,a)}),c.modifies(i.output),c.modifies(h.output),k!==ag&&k!==h&&(b.visit(b.ADD,function(m){k(m,a)}),c.modifies(k.output))),b.changed(b.REM)&&j!==ag&&(b.visit(b.REM,function(m){j(m,a)}),c.modifies(j.output));if(g||k!==ag){var l=b.MOD|(a.modified()?b.REFLOW:0);g?(b.visit(l,function(m){var n=i(m,a)||d;(k(m,a)||n)&&c.mod.push(m)}),c.mod.length&&c.modifies(i.output)):b.visit(l,function(m){(k(m,a)||d)&&c.mod.push(m)}),c.mod.length&&c.modifies(k.output)}return c.changed()?c:b.StopPropagation};function MG(a){E.call(this,[],a)}var D0=N(MG,E);D0.transform=function(a,b){if(this.value!=null&&!a.modified())return b.StopPropagation;var c=b.dataflow.locale(),d=b.fork(b.NO_SOURCE|b.NO_FIELDS),e=this.value,f=a.type||Hn,g=a.scale,h=+a.limit,i=tu(g,a.count==null?5:a.count,a.minstep),j=!!a.values||f===Hn,k=a.format||TF(c,g,i,f,a.formatSpecifier,a.formatType,j),l=a.values||SF(g,i),m,n,o,p,q;return e&&(d.rem=e),f===Hn?(h&&l.length>h?(b.dataflow.warn("Symbol legend count exceeds limit, filtering items."),e=l.slice(0,h-1),q=!0):e=l,pa(o=a.size)?(!a.values&&g(e[0])===0&&(e=e.slice(1)),p=e.reduce(function(r,s){return Math.max(r,o(s,a))},0)):o=Vb(p=o||8),e=e.map(function(r,s){return xa({index:s,label:k(r,s,e),value:r,offset:p,size:o(r,a)})}),q&&(q=l[e.length],e.push(xa({index:e.length,label:`…${l.length-e.length} entries`,value:q,offset:p,size:o(q,a)})))):f===p$?(m=g.domain(),n=KF(g,m[0],ra(m)),l.length<3&&!a.values&&m[0]!==ra(m)&&(l=[m[0],ra(m)]),e=l.map(function(r,s){return xa({index:s,label:k(r,s,l),value:r,perc:n(r)})})):(o=l.length-1,n=A$(g),e=l.map(function(r,s){return xa({index:s,label:k(r,s,l),value:r,perc:s?n(r):0,perc2:s===o?1:n(l[s+1])})})),d.source=e,d.add=e,this.value=e,d};var NG=Zi({line:OG,"line-radial":J0,arc:PG,"arc-radial":K0,curve:QG,"curve-radial":L0,"orthogonal-horizontal":M0,"orthogonal-vertical":N0,"orthogonal-radial":O0,"diagonal-horizontal":P0,"diagonal-vertical":Q0,"diagonal-radial":R0});function E0(a){return a.source.x}function F0(a){return a.source.y}function G0(a){return a.target.x}function H0(a){return a.target.y}function Iu(a){E.call(this,{},a)}Iu.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var I0=N(Iu,E);I0.transform=function(a,b){var c=a.sourceX||E0,d=a.sourceY||F0,e=a.targetX||G0,f=a.targetY||H0,g=a.as||"path",h=a.orient||"vertical",i=a.shape||"line",j=NG.get(i+"-"+h)||NG.get(i);return j||H("LinkPath unsupported type: "+a.shape+(a.orient?"-"+a.orient:"")),b.visit(b.SOURCE,function(k){k[g]=j(c(k),d(k),e(k),f(k))}),b.reflow(a.modified()).modifies(g)};function OG(a,b,c,d){return"M"+a+","+b+"L"+c+","+d}function J0(a,b,c,d){return OG(b*Math.cos(a),b*Math.sin(a),d*Math.cos(c),d*Math.sin(c))}function PG(a,b,c,d){var e=c-a,f=d-b,g=Math.sqrt(e*e+f*f)/2,h=180*Math.atan2(f,e)/Math.PI;return"M"+a+","+b+"A"+g+","+g+" "+h+" 0 1 "+c+","+d}function K0(a,b,c,d){return PG(b*Math.cos(a),b*Math.sin(a),d*Math.cos(c),d*Math.sin(c))}function QG(a,b,c,d){var e=c-a,f=d-b,g=.2*(e+f),h=.2*(f-e);return"M"+a+","+b+"C"+(a+g)+","+(b+h)+" "+(c+h)+","+(d-g)+" "+c+","+d}function L0(a,b,c,d){return QG(b*Math.cos(a),b*Math.sin(a),d*Math.cos(c),d*Math.sin(c))}function M0(a,b,c,d){return"M"+a+","+b+"V"+d+"H"+c}function N0(a,b,c,d){return"M"+a+","+b+"H"+c+"V"+d}function O0(a,b,c,d){var e=Math.cos(a),f=Math.sin(a),g=Math.cos(c),h=Math.sin(c),i=Math.abs(c-a)>Math.PI?c<=a:c>a;return"M"+b*e+","+b*f+"A"+b+","+b+" 0 0,"+(i?1:0)+" "+b*g+","+b*h+"L"+d*g+","+d*h}function P0(a,b,c,d){var e=(a+c)/2;return"M"+a+","+b+"C"+e+","+b+" "+e+","+d+" "+c+","+d}function Q0(a,b,c,d){var e=(b+d)/2;return"M"+a+","+b+"C"+a+","+e+" "+c+","+e+" "+c+","+d}function R0(a,b,c,d){var e=Math.cos(a),f=Math.sin(a),g=Math.cos(c),h=Math.sin(c),i=(b+d)/2;return"M"+b*e+","+b*f+"C"+i*e+","+i*f+" "+i*g+","+i*h+" "+d*g+","+d*h}function Ju(a){E.call(this,null,a)}Ju.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};var S0=N(Ju,E);S0.transform=function(a,b){var c=a.as||["startAngle","endAngle"],d=c[0],e=c[1],f=a.field||Xi,g=a.startAngle||0,h=a.endAngle!=null?a.endAngle:2*Math.PI,i=b.source,j=i.map(f),k=j.length,l=g,m=(h-g)/JA(j),n=gg(k),o,p,q;for(a.sort&&n.sort(function(r,s){return j[r]-j[s]}),o=0;o<k;++o)q=j[n[o]],p=i[n[o]],p[d]=l,p[e]=l+=q*m;return this.value=j,b.reflow(a.modified()).modifies(c)};var T0=5;function U0(a){const b=a.type;return!a.bins&&(b===Vh||b===Jj||b===Kj)}function RG(a){return pu(a)&&a!==Nd}var V0=wb(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function SG(a){E.call(this,null,a),this.modified(!0)}var W0=N(SG,E);W0.transform=function(a,b){var c=b.dataflow,d=this.value,e=X0(a);(!d||e!==d.type)&&(this.value=d=va(e)());for(e in a)if(!V0[e]){if(e==="padding"&&RG(d.type))continue;pa(d[e])?d[e](a[e]):c.warn("Unsupported scale property: "+e)}return b1(d,a,a1(d,a,Z0(d,a,c))),b.fork(b.NO_SOURCE|b.NO_FIELDS)};function X0(a){var b=a.type,c="",d;return b===Nd?Nd+"-"+Vh:(Y0(a)&&(d=a.rawDomain?a.rawDomain.length:a.domain?a.domain.length+ +(a.domainMid!=null):0,c=d===2?Nd+"-":d===3?Wh+"-":""),(c+b||Vh).toLowerCase())}function Y0(a){const b=a.type;return pu(b)&&b!==ug&&b!==vg&&(a.scheme||a.range&&a.range.length&&a.range.every(V))}function Z0(a,b,c){var d=_0(a,b.domainRaw,c);if(d>-1)return d;var e=b.domain,f=a.type,g=b.zero||b.zero===void 0&&U0(a),h,i;if(!e)return 0;RG(f)&&b.padding&&e[0]!==ra(e)&&(e=$0(f,e,b.range,b.padding,b.exponent,b.constant));if(g||b.domainMin!=null||b.domainMax!=null||b.domainMid!=null){h=(e=e.slice()).length-1||1,g&&(e[0]>0&&(e[0]=0),e[h]<0&&(e[h]=0)),b.domainMin!=null&&(e[0]=b.domainMin),b.domainMax!=null&&(e[h]=b.domainMax);if(b.domainMid!=null){i=b.domainMid;const j=i>e[h]?h+1:i<e[0]?0:h;j!==h&&c.warn("Scale domainMid exceeds domain min or max.",i),e.splice(j,0,i)}}return a.domain(TG(f,e,c)),f===Ht&&a.unknown(b.domainImplicit?Lt:void 0),b.nice&&a.nice&&a.nice(b.nice!==!0&&tu(a,b.nice)||null),e.length}function _0(a,b,c){return b?(a.domain(TG(a.type,b,c)),b.length):-1}function $0(a,b,c,d,e,f){var g=Math.abs(ra(c)-c[0]),h=g/(g-2*d),i=a===ve?gA(b,null,h):a===Kj?Yq(b,null,h,.5):a===Jj?Yq(b,null,h,e||1):a===qn?hA(b,null,h,f||1):fA(b,null,h);return b=b.slice(),b[0]=i[0],b[b.length-1]=i[1],b}function TG(a,b,c){if(FF(a)){var d=Math.abs(b.reduce(function(e,f){return e+(f<0?-1:f>0?1:0)},0));d!==b.length&&c.warn("Log scale domain includes zero: "+P(b))}return b}function a1(a,b,c){let d=b.bins;if(d&&!J(d)){let e=a.domain(),f=e[0],g=ra(e),h=d.start==null?f:d.start,i=d.stop==null?g:d.stop,j=d.step;j||H("Scale bins parameter missing step property."),h<f&&(h=j*Math.ceil(f/j)),i>g&&(i=j*Math.floor(g/j)),d=gg(h,i+j/2,j)}return d?a.bins=d:a.bins&&delete a.bins,a.type===Jt&&(d?!b.domain&&!b.domainRaw&&(a.domain(d),c=d.length):a.bins=a.domain()),c}function b1(a,b,c){var d=a.type,e=b.round||!1,f=b.range;if(b.rangeStep!=null)f=c1(d,b,c);else if(b.scheme){f=d1(d,b,c);if(pa(f)){if(a.interpolator)return a.interpolator(f);H(`Scale type ${d} does not support interpolating color schemes.`)}}if(f&&GF(d))return a.interpolator(Gn(Ku(f,b.reverse),b.interpolate,b.interpolateGamma));f&&b.interpolate&&a.interpolate?a.interpolate(ru(b.interpolate,b.interpolateGamma)):pa(a.round)?a.round(e):pa(a.rangeRound)&&a.interpolate(e?Rj:yg),f&&a.range(Ku(f,b.reverse))}function c1(a,b,c){a!==sE&&a!==It&&H("Only band and point scales support rangeStep.");var d=(b.paddingOuter!=null?b.paddingOuter:b.padding)||0,e=a===It?1:(b.paddingInner!=null?b.paddingInner:b.padding)||0;return[0,b.rangeStep*Gt(c,e,d)]}function d1(a,b,c){var d=b.schemeExtent,e,f;return J(b.scheme)?f=Gn(b.scheme,b.interpolate,b.interpolateGamma):(e=b.scheme.toLowerCase(),f=su(e),f||H(`Unrecognized scheme name: ${b.scheme}`)),c=a===sn?c+1:a===Jt?c-1:a===Xh||a===rn?+b.schemeCount||T0:c,GF(a)?UG(f,d,b.reverse):pa(f)?JF(UG(f,d),c):a===Ht?f:f.slice(0,c)}function UG(a,b,c){return pa(a)&&(b||c)?IF(a,Ku(b||[0,1],c)):a}function Ku(a,b){return b?a.slice().reverse():a}function VG(a){E.call(this,null,a)}var e1=N(VG,E);e1.transform=function(a,b){var c=a.modified("sort")||b.changed(b.ADD)||b.modified(a.sort.fields)||b.modified("datum");return c&&b.source.sort(eg(a.sort)),this.modified(c),b};var WG="zero",XG="center",YG="normalize",ZG=["y0","y1"];function Lu(a){E.call(this,null,a)}Lu.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:WG,values:[WG,XG,YG]},{name:"as",type:"string",array:!0,length:2,default:ZG}]};var f1=N(Lu,E);f1.transform=function(a,b){var c=a.as||ZG,d=c[0],e=c[1],f=eg(a.sort),g=a.field||Xi,h=a.offset===XG?g1:a.offset===YG?h1:i1,i,j,k,l;for(i=j1(b.source,a.groupby,f,g),j=0,k=i.length,l=i.max;j<k;++j)h(i[j],l,g,d,e);return b.reflow(a.modified()).modifies(c)};function g1(a,b,c,d,e){for(var f=(b-a.sum)/2,g=a.length,h=0,i;h<g;++h)i=a[h],i[d]=f,i[e]=f+=Math.abs(c(i))}function h1(a,b,c,d,e){for(var f=1/a.sum,g=0,h=a.length,i=0,j=0,k;i<h;++i)k=a[i],k[d]=g,k[e]=g=f*(j+=Math.abs(c(k)))}function i1(a,b,c,d,e){for(var f=0,g=0,h=a.length,i=0,j,k;i<h;++i)k=a[i],j=+c(k),j<0?(k[d]=g,k[e]=g+=j):(k[d]=f,k[e]=f+=j)}function j1(a,b,c,d){var e=[],f=function(p){return p(k)},g,h,i,j,k,l,m,n,o;if(b==null)e.push(a.slice());else for(g={},h=0,i=a.length;h<i;++h)k=a[h],l=b.map(f),m=g[l],m||(g[l]=m=[],e.push(m)),m.push(k);for(l=0,o=0,j=e.length;l<j;++l){for(m=e[l],h=0,n=0,i=m.length;h<i;++h)n+=Math.abs(d(m[h]));m.sum=n,n>o&&(o=n),c&&m.sort(c)}return e.max=o,e}var k1=Object.freeze({__proto__:null,axisticks:JG,datajoin:KG,encode:LG,legendentries:MG,linkpath:Iu,pie:Ju,scale:SG,sortitems:VG,stack:Lu});function l1(){}const ze=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function _G(){var a=1,b=1,c=h;function d(i,j){return j.map(k=>e(i,k))}function e(i,j){var k=[],l=[];return f(i,j,function(m){c(m,i,j),m1(m)>0?k.push([m]):l.push(m)}),l.forEach(function(m){for(var n=0,o=k.length,p;n<o;++n)if(n1((p=k[n])[0],m)!==-1){p.push(m);return}}),{type:"MultiPolygon",value:j,coordinates:k}}function f(i,j,k){var l=new Array(),m=new Array(),n,o,p,q,r,s;for(n=o=-1,q=i[0]>=j,ze[q<<1].forEach(t);++n<a-1;)p=q,q=i[n+1]>=j,ze[p|q<<1].forEach(t);for(ze[q<<0].forEach(t);++o<b-1;){for(n=-1,q=i[o*a+a]>=j,r=i[o*a]>=j,ze[q<<1|r<<2].forEach(t);++n<a-1;)p=q,q=i[o*a+a+n+1]>=j,s=r,r=i[o*a+n+1]>=j,ze[p|q<<1|r<<2|s<<3].forEach(t);ze[q|r<<3].forEach(t)}for(n=-1,r=i[o*a]>=j,ze[r<<2].forEach(t);++n<a-1;)s=r,r=i[o*a+n+1]>=j,ze[r<<2|s<<3].forEach(t);ze[r<<3].forEach(t);function t(w){var v=[w[0][0]+n,w[0][1]+o],x=[w[1][0]+n,w[1][1]+o],u=g(v),z=g(x),y,B;(y=m[u])?(B=l[z])?(delete m[y.end],delete l[B.start],y===B?(y.ring.push(x),k(y.ring)):l[y.start]=m[B.end]={start:y.start,end:B.end,ring:y.ring.concat(B.ring)}):(delete m[y.end],y.ring.push(x),m[y.end=z]=y):(y=l[z])?(B=m[u])?(delete l[y.start],delete m[B.end],y===B?(y.ring.push(x),k(y.ring)):l[B.start]=m[y.end]={start:B.start,end:y.end,ring:B.ring.concat(y.ring)}):(delete l[y.start],y.ring.unshift(v),l[y.start=u]=y):l[u]=m[z]={start:u,end:z,ring:[v,x]}}}function g(i){return i[0]*2+i[1]*(a+1)*4}function h(i,j,k){i.forEach(function(l){var m=l[0],n=l[1],o=m|0,p=n|0,q,r=j[p*a+o];m>0&&m<a&&o===m&&(q=j[p*a+o-1],l[0]=m+(k-q)/(r-q)-.5),n>0&&n<b&&p===n&&(q=j[(p-1)*a+o],l[1]=n+(k-q)/(r-q)-.5)})}return d.contour=e,d.size=function(i){if(!arguments.length)return[a,b];var j=Math.floor(i[0]),k=Math.floor(i[1]);return j>=0&&k>=0||H("invalid size"),a=j,b=k,d},d.smooth=function(i){return arguments.length?(c=i?h:l1,d):c===h},d}function m1(a){for(var b=0,c=a.length,d=a[c-1][1]*a[0][0]-a[c-1][0]*a[0][1];++b<c;)d+=a[b-1][1]*a[b][0]-a[b-1][0]*a[b][1];return d}function n1(a,b){for(var c=-1,d=b.length,e;++c<d;)if(e=o1(a,b[c]))return e;return 0}function o1(a,b){for(var c=b[0],d=b[1],e=-1,f=0,g=a.length,h=g-1;f<g;h=f++){var i=a[f],j=i[0],k=i[1],l=a[h],m=l[0],n=l[1];if(p1(i,l,b))return 0;k>d!==n>d&&c<(m-j)*(d-k)/(n-k)+j&&(e=-e)}return e}function p1(a,b,c){var d;return q1(a,b,c)&&r1(a[d=+(a[0]===b[0])],c[d],b[d])}function q1(a,b,c){return(b[0]-a[0])*(c[1]-a[1])===(c[0]-a[0])*(b[1]-a[1])}function r1(a,b,c){return a<=b&&b<=c||c<=b&&b<=a}function $G(a,b,c){return function(d){var e=pe(d),f=c?Math.min(e[0],0):e[0],g=e[1],h=g-f,i=b?_e(f,g,a):h/(a+1);return gg(i,g,i)}}function Mu(a){E.call(this,null,a)}Mu.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};var s1=N(Mu,E);s1.transform=function(a,b){if(this.value&&!b.changed()&&!a.modified())return b.StopPropagation;var c=b.fork(b.NO_SOURCE|b.NO_FIELDS),d=b.materialize(b.SOURCE).source,e=a.field||Ub,f=_G().smooth(a.smooth!==!1),g=a.thresholds||t1(d,e,a),h=a.as===null?null:a.as||"contour",i=[];return d.forEach(j=>{const k=e(j),l=f.size([k.width,k.height])(k.values,J(g)?g:g(k.values));u1(l,k,j,a),l.forEach(m=>{i.push(_q(j,xa(h!=null?{[h]:m}:m)))})}),this.value&&(c.rem=this.value),this.value=c.source=c.add=i,c};function t1(a,b,c){const d=$G(c.levels||10,c.nice,c.zero!==!1);return c.resolve!=="shared"?d:d(a.map(e=>hg(b(e).values)))}function u1(a,b,c,d){let e=d.scale||b.scale,f=d.translate||b.translate;pa(e)&&(e=e(c,d)),pa(f)&&(f=f(c,d));if((e===1||e==null)&&!f)return;const g=(Fa(e)?e:e[0])||1,h=(Fa(e)?e:e[1])||1,i=f&&f[0]||0,j=f&&f[1]||0;a.forEach(aH(b,g,h,i,j))}function aH(a,b,c,d,e){const f=a.x1||0,g=a.y1||0,h=b*c<0;function i(l){l.forEach(j)}function j(l){h&&l.reverse(),l.forEach(k)}function k(l){l[0]=(l[0]-f)*b+d,l[1]=(l[1]-g)*c+e}return function(l){return l.coordinates.forEach(i),l}}function bH(a,b,c){const d=a>=0?a:Vr(b,c);return Math.round((Math.sqrt(4*d*d+1)-1)/2)}function Nu(a){return pa(a)?a:Vb(+a)}function cH(){var a=i=>i[0],b=i=>i[1],c=Xi,d=[-1,-1],e=960,f=500,g=2;function h(i,j){const k=bH(d[0],i,a)>>g,l=bH(d[1],i,b)>>g,m=k?k+2:0,n=l?l+2:0,o=2*m+(e>>g),p=2*n+(f>>g),q=new Float32Array(o*p),r=new Float32Array(o*p);let s=q;i.forEach(w=>{const v=m+(+a(w)>>g),x=n+(+b(w)>>g);v>=0&&v<o&&x>=0&&x<p&&(q[v+x*o]+=+c(w))}),k>0&&l>0?(ei(o,p,q,r,k),fi(o,p,r,q,l),ei(o,p,q,r,k),fi(o,p,r,q,l),ei(o,p,q,r,k),fi(o,p,r,q,l)):k>0?(ei(o,p,q,r,k),ei(o,p,r,q,k),ei(o,p,q,r,k),s=r):l>0&&(fi(o,p,q,r,l),fi(o,p,r,q,l),fi(o,p,q,r,l),s=r);let t=j?Math.pow(2,-2*g):1/JA(s);for(let w=0,v=o*p;w<v;++w)s[w]*=t;return{values:s,scale:1<<g,width:o,height:p,x1:m,y1:n,x2:m+(e>>g),y2:n+(f>>g)}}return h.x=function(i){return arguments.length?(a=Nu(i),h):a},h.y=function(i){return arguments.length?(b=Nu(i),h):b},h.weight=function(i){return arguments.length?(c=Nu(i),h):c},h.size=function(i){if(!arguments.length)return[e,f];var j=+i[0],k=+i[1];return j>=0&&k>=0||H("invalid size"),e=j,f=k,h},h.cellSize=function(i){return arguments.length?((i=+i)>=1||H("invalid cell size"),g=Math.floor(Math.log(i)/Math.LN2),h):1<<g},h.bandwidth=function(i){return arguments.length?(i=T(i),i.length===1&&(i=[+i[0],+i[0]]),i.length!==2&&H("invalid bandwidth"),d=i,h):d},h}function ei(a,b,c,d,e){const f=(e<<1)+1;for(let g=0;g<b;++g)for(let h=0,i=0;h<a+e;++h)h<a&&(i+=c[h+g*a]),h>=e&&(h>=f&&(i-=c[h-f+g*a]),d[h-e+g*a]=i/Math.min(h+1,a-1+f-h,f))}function fi(a,b,c,d,e){const f=(e<<1)+1;for(let g=0;g<a;++g)for(let h=0,i=0;h<b+e;++h)h<b&&(i+=c[g+h*a]),h>=e&&(h>=f&&(i-=c[g+(h-f)*a]),d[g+(h-e)*a]=i/Math.min(h+1,b-1+f-h,f))}function Ou(a){E.call(this,null,a)}Ou.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var v1=N(Ou,E);const w1=["x","y","weight","size","cellSize","bandwidth"];function dH(a,b){return w1.forEach(c=>b[c]!=null?a[c](b[c]):0),a}v1.transform=function(a,b){if(this.value&&!b.changed()&&!a.modified())return b.StopPropagation;var c=b.fork(b.NO_SOURCE|b.NO_FIELDS),d=b.materialize(b.SOURCE).source,e=x1(d,a.groupby),f=(a.groupby||[]).map(_a),g=dH(cH(),a),h=a.as||"grid",i=[];function j(k,l){for(let m=0;m<f.length;++m)k[f[m]]=l[m];return k}return i=e.map(k=>xa(j({[h]:g(k,a.counts)},k.dims))),this.value&&(c.rem=this.value),this.value=c.source=c.add=i,c};function x1(a,b){var c=[],d=k=>k(h),e,f,g,h,i,j;if(b==null)c.push(a);else for(e={},f=0,g=a.length;f<g;++f)h=a[f],i=b.map(d),j=e[i],j||(e[i]=j=[],j.dims=i,c.push(j)),j.push(h);return c}function Pu(a){E.call(this,null,a)}Pu.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};var y1=N(Pu,E);y1.transform=function(a,b){if(this.value&&!b.changed()&&!a.modified())return b.StopPropagation;var c=b.fork(b.NO_SOURCE|b.NO_FIELDS),d=_G().smooth(a.smooth!==!1),e=a.values,f=a.thresholds||$G(a.count||10,a.nice,!!e),g=a.size,h,i;return e||(e=b.materialize(b.SOURCE).source,h=dH(cH(),a)(e,!0),i=aH(h,h.scale||1,h.scale||1,0,0),g=[h.width,h.height],e=h.values),f=J(f)?f:f(e),e=d.size(g)(e,f),i&&e.forEach(i),this.value&&(c.rem=this.value),this.value=c.source=c.add=(e||[]).map(xa),c};var Qu="Feature",Ru="FeatureCollection",z1="MultiPoint";function Su(a){E.call(this,null,a)}Su.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};var A1=N(Su,E);A1.transform=function(a,b){var c=this._features,d=this._points,e=a.fields,f=e&&e[0],g=e&&e[1],h=a.geojson||!e&&Ub,i=b.ADD,j;j=a.modified()||b.changed(b.REM)||b.modified(Tb(h))||f&&b.modified(Tb(f))||g&&b.modified(Tb(g)),(!this.value||j)&&(i=b.SOURCE,this._features=c=[],this._points=d=[]),h&&b.visit(i,function(k){c.push(h(k))}),f&&g&&(b.visit(i,function(k){var l=f(k),m=g(k);l!=null&&m!=null&&(l=+l)===l&&(m=+m)===m&&d.push([l,m])}),c=c.concat({type:Qu,geometry:{type:z1,coordinates:d}})),this.value={type:Ru,features:c}};function Bg(){return new On()}function On(){this.reset()}On.prototype={constructor:On,reset:function(){this.s=this.t=0},add:function(a){eH(Pn,a,this.t),eH(this,Pn.s,this.s),this.s?this.t+=Pn.t:this.s=Pn.t},valueOf:function(){return this.s}};var Pn=new On();function eH(a,b,c){var d=a.s=b+c,e=d-b,f=d-e;a.t=b-f+(c-e)}var da=1e-6,Tu=1e-12,ma=Math.PI,Va=ma/2,Qn=ma/4,Xb=ma*2,$a=180/ma,na=ma/180,sa=Math.abs,gi=Math.atan,Wc=Math.atan2,ea=Math.cos,Rn=Math.ceil,fH=Math.exp,Sn=Math.log,Uu=Math.pow,ba=Math.sin,Xc=Math.sign||function(a){return a>0?1:a<0?-1:0},Bb=Math.sqrt,Vu=Math.tan;function gH(a){return a>1?0:a<-1?ma:Math.acos(a)}function qc(a){return a>1?Va:a<-1?-Va:Math.asin(a)}function Cb(){}function Tn(a,b){a&&iH.hasOwnProperty(a.type)&&iH[a.type](a,b)}var hH={Feature:function(a,b){Tn(a.geometry,b)},FeatureCollection:function(a,b){for(var c=a.features,d=-1,e=c.length;++d<e;)Tn(c[d].geometry,b)}},iH={Sphere:function(a,b){b.sphere()},Point:function(a,b){a=a.coordinates,b.point(a[0],a[1],a[2])},MultiPoint:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)a=c[d],b.point(a[0],a[1],a[2])},LineString:function(a,b){Wu(a.coordinates,b,0)},MultiLineString:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)Wu(c[d],b,0)},Polygon:function(a,b){jH(a.coordinates,b)},MultiPolygon:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)jH(c[d],b)},GeometryCollection:function(a,b){for(var c=a.geometries,d=-1,e=c.length;++d<e;)Tn(c[d],b)}};function Wu(a,b,c){var d=-1,e=a.length-c,f;for(b.lineStart();++d<e;)f=a[d],b.point(f[0],f[1],f[2]);b.lineEnd()}function jH(a,b){var c=-1,d=a.length;for(b.polygonStart();++c<d;)Wu(a[c],b,1);b.polygonEnd()}function Ae(a,b){a&&hH.hasOwnProperty(a.type)?hH[a.type](a,b):Tn(a,b)}var Un=Bg(),Vn=Bg(),kH,lH,Xu,Yu,Zu,Sd={point:Cb,lineStart:Cb,lineEnd:Cb,polygonStart:function(){Un.reset(),Sd.lineStart=B1,Sd.lineEnd=C1},polygonEnd:function(){var a=+Un;Vn.add(a<0?Xb+a:a),this.lineStart=this.lineEnd=this.point=Cb},sphere:function(){Vn.add(Xb)}};function B1(){Sd.point=D1}function C1(){mH(kH,lH)}function D1(a,b){Sd.point=mH,kH=a,lH=b,a*=na,b*=na,Xu=a,Yu=ea(b=b/2+Qn),Zu=ba(b)}function mH(a,b){a*=na,b*=na,b=b/2+Qn;var c=a-Xu,d=c>=0?1:-1,e=d*c,f=ea(b),g=ba(b),h=Zu*g,i=Yu*f+h*ea(e),j=h*d*ba(e);Un.add(Wc(j,i)),Xu=a,Yu=f,Zu=g}function E1(a){return Vn.reset(),Ae(a,Sd),Vn*2}function Wn(a){return[Wc(a[1],a[0]),qc(a[2])]}function Cg(a){var b=a[0],c=a[1],d=ea(c);return[d*ea(b),d*ba(b),ba(c)]}function Xn(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function hi(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function _u(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function Yn(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function Zn(a){var b=Bb(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=b,a[1]/=b,a[2]/=b}var Sa,rc,Wa,Hc,Dg,nH,oH,ii,$j=Bg(),uf,Be,Ce={point:$u,lineStart:qH,lineEnd:rH,polygonStart:function(){Ce.point=sH,Ce.lineStart=F1,Ce.lineEnd=G1,$j.reset(),Sd.polygonStart()},polygonEnd:function(){Sd.polygonEnd(),Ce.point=$u,Ce.lineStart=qH,Ce.lineEnd=rH,Un<0?(Sa=-(Wa=180),rc=-(Hc=90)):$j>da?Hc=90:$j<-da&&(rc=-90),Be[0]=Sa,Be[1]=Wa},sphere:function(){Sa=-(Wa=180),rc=-(Hc=90)}};function $u(a,b){uf.push(Be=[Sa=a,Wa=a]),b<rc&&(rc=b),b>Hc&&(Hc=b)}function pH(a,b){var c=Cg([a*na,b*na]);if(ii){var d=hi(ii,c),e=[d[1],-d[0],0],f=hi(e,d);Zn(f),f=Wn(f);var g=a-Dg,h=g>0?1:-1,i=f[0]*$a*h,j,k=sa(g)>180;k^(h*Dg<i&&i<h*a)?(j=f[1]*$a,j>Hc&&(Hc=j)):(i=(i+360)%360-180,k^(h*Dg<i&&i<h*a))?(j=-f[1]*$a,j<rc&&(rc=j)):(b<rc&&(rc=b),b>Hc&&(Hc=b)),k?a<Dg?Ic(Sa,a)>Ic(Sa,Wa)&&(Wa=a):Ic(a,Wa)>Ic(Sa,Wa)&&(Sa=a):Wa>=Sa?(a<Sa&&(Sa=a),a>Wa&&(Wa=a)):a>Dg?Ic(Sa,a)>Ic(Sa,Wa)&&(Wa=a):Ic(a,Wa)>Ic(Sa,Wa)&&(Sa=a)}else uf.push(Be=[Sa=a,Wa=a]);b<rc&&(rc=b),b>Hc&&(Hc=b),ii=c,Dg=a}function qH(){Ce.point=pH}function rH(){Be[0]=Sa,Be[1]=Wa,Ce.point=$u,ii=null}function sH(a,b){if(ii){var c=a-Dg;$j.add(sa(c)>180?c+(c>0?360:-360):c)}else nH=a,oH=b;Sd.point(a,b),pH(a,b)}function F1(){Sd.lineStart()}function G1(){sH(nH,oH),Sd.lineEnd(),sa($j)>da&&(Sa=-(Wa=180)),Be[0]=Sa,Be[1]=Wa,ii=null}function Ic(a,b){return(b-=a)<0?b+360:b}function H1(a,b){return a[0]-b[0]}function tH(a,b){return a[0]<=a[1]?a[0]<=b&&b<=a[1]:b<a[0]||a[1]<b}function I1(a){var b,c,d,e,f,g,h;Hc=Wa=-(Sa=rc=Infinity),uf=[],Ae(a,Ce);if(c=uf.length){for(uf.sort(H1),b=1,d=uf[0],f=[d];b<c;++b)e=uf[b],tH(d,e[0])||tH(d,e[1])?(Ic(d[0],e[1])>Ic(d[0],d[1])&&(d[1]=e[1]),Ic(e[0],d[1])>Ic(d[0],d[1])&&(d[0]=e[0])):f.push(d=e);for(g=-Infinity,c=f.length-1,b=0,d=f[c];b<=c;d=e,++b)e=f[b],(h=Ic(d[1],e[0]))>g&&(g=h,Sa=e[0],Wa=d[1])}return uf=Be=null,Sa===Infinity||rc===Infinity?[[NaN,NaN],[NaN,NaN]]:[[Sa,rc],[Wa,Hc]]}var ak,_n,$n,ao,bo,co,eo,fo,av,bv,cv,uH,vH,Yb,Zb,_b,qd={sphere:Cb,point:dv,lineStart:wH,lineEnd:xH,polygonStart:function(){qd.lineStart=L1,qd.lineEnd=M1},polygonEnd:function(){qd.lineStart=wH,qd.lineEnd=xH}};function dv(a,b){a*=na,b*=na;var c=ea(b);bk(c*ea(a),c*ba(a),ba(b))}function bk(a,b,c){++ak,$n+=(a-$n)/ak,ao+=(b-ao)/ak,bo+=(c-bo)/ak}function wH(){qd.point=J1}function J1(a,b){a*=na,b*=na;var c=ea(b);Yb=c*ea(a),Zb=c*ba(a),_b=ba(b),qd.point=K1,bk(Yb,Zb,_b)}function K1(a,b){a*=na,b*=na;var c=ea(b),d=c*ea(a),e=c*ba(a),f=ba(b),g=Wc(Bb((g=Zb*f-_b*e)*g+(g=_b*d-Yb*f)*g+(g=Yb*e-Zb*d)*g),Yb*d+Zb*e+_b*f);_n+=g,co+=g*(Yb+(Yb=d)),eo+=g*(Zb+(Zb=e)),fo+=g*(_b+(_b=f)),bk(Yb,Zb,_b)}function xH(){qd.point=dv}function L1(){qd.point=N1}function M1(){yH(uH,vH),qd.point=dv}function N1(a,b){uH=a,vH=b,a*=na,b*=na,qd.point=yH;var c=ea(b);Yb=c*ea(a),Zb=c*ba(a),_b=ba(b),bk(Yb,Zb,_b)}function yH(a,b){a*=na,b*=na;var c=ea(b),d=c*ea(a),e=c*ba(a),f=ba(b),g=Zb*f-_b*e,h=_b*d-Yb*f,i=Yb*e-Zb*d,j=Bb(g*g+h*h+i*i),k=qc(j),l=j&&-k/j;av+=l*g,bv+=l*h,cv+=l*i,_n+=k,co+=k*(Yb+(Yb=d)),eo+=k*(Zb+(Zb=e)),fo+=k*(_b+(_b=f)),bk(Yb,Zb,_b)}function O1(a){ak=_n=$n=ao=bo=co=eo=fo=av=bv=cv=0,Ae(a,qd);var b=av,c=bv,d=cv,e=b*b+c*c+d*d;if(e<Tu){b=co,c=eo,d=fo,_n<da&&(b=$n,c=ao,d=bo),e=b*b+c*c+d*d;if(e<Tu)return[NaN,NaN]}return[Wc(c,b)*$a,qc(d/Bb(e))*$a]}function ev(a,b){function c(d,e){return d=a(d,e),b(d[0],d[1])}return a.invert&&b.invert&&(c.invert=function(d,e){return d=b.invert(d,e),d&&a.invert(d[0],d[1])}),c}function fv(a,b){return[sa(a)>ma?a+Math.round(-a/Xb)*Xb:a,b]}fv.invert=fv;function zH(a,b,c){return(a%=Xb)?b||c?ev(BH(a),CH(b,c)):BH(a):b||c?CH(b,c):fv}function AH(a){return function(b,c){return b+=a,[b>ma?b-Xb:b<-ma?b+Xb:b,c]}}function BH(a){var b=AH(a);return b.invert=AH(-a),b}function CH(a,b){var c=ea(a),d=ba(a),e=ea(b),f=ba(b);function g(h,i){var j=ea(i),k=ea(h)*j,l=ba(h)*j,m=ba(i),n=m*c+k*d;return[Wc(l*e-n*f,k*c-m*d),qc(n*e+l*f)]}return g.invert=function(h,i){var j=ea(i),k=ea(h)*j,l=ba(h)*j,m=ba(i),n=m*e-l*f;return[Wc(l*e+m*f,k*c+n*d),qc(n*c-k*d)]},g}function P1(a){a=zH(a[0]*na,a[1]*na,a.length>2?a[2]*na:0);function b(c){return c=a(c[0]*na,c[1]*na),c[0]*=$a,c[1]*=$a,c}return b.invert=function(c){return c=a.invert(c[0]*na,c[1]*na),c[0]*=$a,c[1]*=$a,c},b}function Q1(a,b,c,d,e,f){if(!c)return;var g=ea(b),h=ba(b),i=d*c;e==null?(e=b+d*Xb,f=b-i/2):(e=DH(g,e),f=DH(g,f),(d>0?e<f:e>f)&&(e+=d*Xb));for(var j,k=e;d>0?k>f:k<f;k-=i)j=Wn([g,-h*ea(k),-h*ba(k)]),a.point(j[0],j[1])}function DH(a,b){b=Cg(b),b[0]-=a,Zn(b);var c=gH(-b[1]);return((-b[2]<0?-c:c)+Xb-da)%Xb}function EH(){var a=[],b;return{point:function(c,d,e){b.push([c,d,e])},lineStart:function(){a.push(b=[])},lineEnd:Cb,rejoin:function(){a.length>1&&a.push(a.pop().concat(a.shift()))},result:function(){var c=a;return a=[],b=null,c}}}function go(a,b){return sa(a[0]-b[0])<da&&sa(a[1]-b[1])<da}function ho(a,b,c,d){this.x=a,this.z=b,this.o=c,this.e=d,this.v=!1,this.n=this.p=null}function FH(a,b,c,d,e){var f=[],g=[],h,i;a.forEach(function(o){if((p=o.length-1)<=0)return;var p,q=o[0],r=o[p],s;if(go(q,r)){if(!q[2]&&!r[2]){for(e.lineStart(),h=0;h<p;++h)e.point((q=o[h])[0],q[1]);e.lineEnd();return}r[0]+=2*da}f.push(s=new ho(q,o,null,!0)),g.push(s.o=new ho(q,null,s,!1)),f.push(s=new ho(r,o,null,!1)),g.push(s.o=new ho(r,null,s,!0))});if(!f.length)return;for(g.sort(b),GH(f),GH(g),h=0,i=g.length;h<i;++h)g[h].e=c=!c;for(var j=f[0],k,l;;){for(var m=j,n=!0;m.v;)if((m=m.n)===j)return;k=m.z,e.lineStart();do{m.v=m.o.v=!0;if(m.e){if(n)for(h=0,i=k.length;h<i;++h)e.point((l=k[h])[0],l[1]);else d(m.x,m.n.x,1,e);m=m.n}else{if(n)for(k=m.p.z,h=k.length-1;h>=0;--h)e.point((l=k[h])[0],l[1]);else d(m.x,m.p.x,-1,e);m=m.p}m=m.o,k=m.z,n=!n}while(!m.v);e.lineEnd()}}function GH(a){if(!(b=a.length))return;for(var b,c=0,d=a[0],e;++c<b;)d.n=e=a[c],e.p=d,d=e;d.n=e=a[0],e.p=d}var gv=Bg();function hv(a){return sa(a[0])<=ma?a[0]:Xc(a[0])*((sa(a[0])+ma)%Xb-ma)}function R1(a,b){var c=hv(b),d=b[1],e=ba(d),f=[ba(c),-ea(c),0],g=0,h=0;gv.reset(),e===1?d=Va+da:e===-1&&(d=-Va-da);for(var i=0,j=a.length;i<j;++i){if(!(l=(k=a[i]).length))continue;for(var k,l,m=k[l-1],n=hv(m),o=m[1]/2+Qn,p=ba(o),q=ea(o),r=0;r<l;++r,n=t,p=v,q=x,m=s){var s=k[r],t=hv(s),w=s[1]/2+Qn,v=ba(w),x=ea(w),u=t-n,z=u>=0?1:-1,y=z*u,B=y>ma,A=p*v;gv.add(Wc(A*z*ba(y),q*x+A*ea(y))),g+=B?u+z*Xb:u;if(B^n>=c^t>=c){var C=hi(Cg(m),Cg(s));Zn(C);var F=hi(f,C);Zn(F);var K=(B^u>=0?-1:1)*qc(F[2]);(d>K||d===K&&(C[0]||C[1]))&&(h+=B^u>=0?1:-1)}}}return(g<-da||g<da&&gv<-da)^h&1}function HH(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function S1(a){return a.length===1&&(a=T1(a)),{left:function(b,c,d,e){for(d==null&&(d=0),e==null&&(e=b.length);d<e;){var f=d+e>>>1;a(b[f],c)<0?d=f+1:e=f}return d},right:function(b,c,d,e){for(d==null&&(d=0),e==null&&(e=b.length);d<e;){var f=d+e>>>1;a(b[f],c)>0?e=f:d=f+1}return d}}}function T1(a){return function(b,c){return HH(a(b),c)}}var Gma=S1(HH);function ji(a,b,c){a=+a,b=+b,c=(e=arguments.length)<2?(b=a,a=0,1):e<3?1:+c;for(var d=-1,e=Math.max(0,Math.ceil((b-a)/c))|0,f=new Array(e);++d<e;)f[d]=a+d*c;return f}function IH(a){for(var b=a.length,c,d=-1,e=0,f,g;++d<b;)e+=a[d].length;for(f=new Array(e);--b>=0;)for(g=a[b],c=g.length;--c>=0;)f[--e]=g[c];return f}function JH(a,b,c,d){return function(e){var f=b(e),g=EH(),h=b(g),i=!1,j,k,l,m={point:n,lineStart:p,lineEnd:q,polygonStart:function(){m.point=r,m.lineStart=s,m.lineEnd=t,k=[],j=[]},polygonEnd:function(){m.point=n,m.lineStart=p,m.lineEnd=q,k=IH(k);var w=R1(j,d);k.length?(i||(e.polygonStart(),i=!0),FH(k,V1,w,c,e)):w&&(i||(e.polygonStart(),i=!0),e.lineStart(),c(null,null,1,e),e.lineEnd()),i&&(e.polygonEnd(),i=!1),k=j=null},sphere:function(){e.polygonStart(),e.lineStart(),c(null,null,1,e),e.lineEnd(),e.polygonEnd()}};function n(w,v){a(w,v)&&e.point(w,v)}function o(w,v){f.point(w,v)}function p(){m.point=o,f.lineStart()}function q(){m.point=n,f.lineEnd()}function r(w,v){l.push([w,v]),h.point(w,v)}function s(){h.lineStart(),l=[]}function t(){r(l[0][0],l[0][1]),h.lineEnd();var w=h.clean(),v=g.result(),x,u=v.length,z,y,B;l.pop(),j.push(l),l=null;if(!u)return;if(w&1){y=v[0];if((z=y.length-1)>0){for(i||(e.polygonStart(),i=!0),e.lineStart(),x=0;x<z;++x)e.point((B=y[x])[0],B[1]);e.lineEnd()}return}u>1&&w&2&&v.push(v.pop().concat(v.shift())),k.push(v.filter(U1))}return m}}function U1(a){return a.length>1}function V1(a,b){return((a=a.x)[0]<0?a[1]-Va-da:Va-a[1])-((b=b.x)[0]<0?b[1]-Va-da:Va-b[1])}var KH=JH(function(){return!0},W1,Y1,[-ma,-Va]);function W1(a){var b=NaN,c=NaN,d=NaN,e;return{lineStart:function(){a.lineStart(),e=1},point:function(f,g){var h=f>0?ma:-ma,i=sa(f-b);sa(i-ma)<da?(a.point(b,c=(c+g)/2>0?Va:-Va),a.point(d,c),a.lineEnd(),a.lineStart(),a.point(h,c),a.point(f,c),e=0):d!==h&&i>=ma&&(sa(b-d)<da&&(b-=d*da),sa(f-h)<da&&(f-=h*da),c=X1(b,c,f,g),a.point(d,c),a.lineEnd(),a.lineStart(),a.point(h,c),e=0),a.point(b=f,c=g),d=h},lineEnd:function(){a.lineEnd(),b=c=NaN},clean:function(){return 2-e}}}function X1(a,b,c,d){var e,f,g=ba(a-c);return sa(g)>da?gi((ba(b)*(f=ea(d))*ba(c)-ba(d)*(e=ea(b))*ba(a))/(e*f*g)):(b+d)/2}function Y1(a,b,c,d){var e;if(a==null)e=c*Va,d.point(-ma,e),d.point(0,e),d.point(ma,e),d.point(ma,0),d.point(ma,-e),d.point(0,-e),d.point(-ma,-e),d.point(-ma,0),d.point(-ma,e);else if(sa(a[0]-b[0])>da){var f=a[0]<b[0]?ma:-ma;e=c*f/2,d.point(-f,e),d.point(0,e),d.point(f,e)}else d.point(b[0],b[1])}function Z1(a){var b=ea(a),c=6*na,d=b>0,e=sa(b)>da;function f(k,l,m,n){Q1(n,a,c,m,k,l)}function g(k,l){return ea(k)*ea(l)>b}function h(k){var l,m,n,o,p;return{lineStart:function(){o=n=!1,p=1},point:function(q,r){var s=[q,r],t,w=g(q,r),v=d?w?0:j(q,r):w?j(q+(q<0?ma:-ma),r):0;!l&&(o=n=w)&&k.lineStart(),w!==n&&(t=i(l,s),(!t||go(l,t)||go(s,t))&&(s[2]=1));if(w!==n)p=0,w?(k.lineStart(),t=i(s,l),k.point(t[0],t[1])):(t=i(l,s),k.point(t[0],t[1],2),k.lineEnd()),l=t;else if(e&&l&&d^w){var x;!(v&m)&&(x=i(s,l,!0))&&(p=0,d?(k.lineStart(),k.point(x[0][0],x[0][1]),k.point(x[1][0],x[1][1]),k.lineEnd()):(k.point(x[1][0],x[1][1]),k.lineEnd(),k.lineStart(),k.point(x[0][0],x[0][1],3)))}w&&(!l||!go(l,s))&&k.point(s[0],s[1]),l=s,n=w,m=v},lineEnd:function(){n&&k.lineEnd(),l=null},clean:function(){return p|(o&&n)<<1}}}function i(k,l,m){var n=Cg(k),o=Cg(l),p=[1,0,0],q=hi(n,o),r=Xn(q,q),s=q[0],t=r-s*s;if(!t)return!m&&k;var w=b*r/t,v=-b*s/t,x=hi(p,q),u=Yn(p,w),z=Yn(q,v);_u(u,z);var y=x,B=Xn(u,y),A=Xn(y,y),C=B*B-A*(Xn(u,u)-1);if(C<0)return;var F=Bb(C),K=Yn(y,(-B-F)/A);_u(K,u),K=Wn(K);if(!m)return K;var D=k[0],I=l[0],S=k[1],X=l[1],Y;I<D&&(Y=D,D=I,I=Y);var wa=I-D,Qa=sa(wa-ma)<da,tb=Qa||wa<da;!Qa&&X<S&&(Y=S,S=X,X=Y);if(tb?Qa?S+X>0^K[1]<(sa(K[0]-D)<da?S:X):S<=K[1]&&K[1]<=X:wa>ma^(D<=K[0]&&K[0]<=I)){var ub=Yn(y,(-B+F)/A);return _u(ub,u),[K,Wn(ub)]}}function j(k,l){var m=d?a:ma-a,n=0;return k<-m?n|=1:k>m&&(n|=2),l<-m?n|=4:l>m&&(n|=8),n}return JH(g,h,f,d?[0,-a]:[-ma,a-ma])}function _1(a,b,c,d,e,f){var g=a[0],h=a[1],i=b[0],j=b[1],k=0,l=1,m=i-g,n=j-h,o;o=c-g;if(!m&&o>0)return;o/=m;if(m<0){if(o<k)return;o<l&&(l=o)}else if(m>0){if(o>l)return;o>k&&(k=o)}o=e-g;if(!m&&o<0)return;o/=m;if(m<0){if(o>l)return;o>k&&(k=o)}else if(m>0){if(o<k)return;o<l&&(l=o)}o=d-h;if(!n&&o>0)return;o/=n;if(n<0){if(o<k)return;o<l&&(l=o)}else if(n>0){if(o>l)return;o>k&&(k=o)}o=f-h;if(!n&&o<0)return;o/=n;if(n<0){if(o>l)return;o>k&&(k=o)}else if(n>0){if(o<k)return;o<l&&(l=o)}return k>0&&(a[0]=g+k*m,a[1]=h+k*n),l<1&&(b[0]=g+l*m,b[1]=h+l*n),!0}var ck=1e9,io=-ck;function LH(a,b,c,d){function e(j,k){return a<=j&&j<=c&&b<=k&&k<=d}function f(j,k,l,m){var n=0,o=0;if(j==null||(n=g(j,l))!==(o=g(k,l))||i(j,k)<0^l>0)do m.point(n===0||n===3?a:c,n>1?d:b);while((n=(n+l+4)%4)!==o);else m.point(k[0],k[1])}function g(j,k){return sa(j[0]-a)<da?k>0?0:3:sa(j[0]-c)<da?k>0?2:1:sa(j[1]-b)<da?k>0?1:0:k>0?3:2}function h(j,k){return i(j.x,k.x)}function i(j,k){var l=g(j,1),m=g(k,1);return l!==m?l-m:l===0?k[1]-j[1]:l===1?j[0]-k[0]:l===2?j[1]-k[1]:k[0]-j[0]}return function(j){var k=j,l=EH(),m,n,o,p,q,r,s,t,w,v,x,u={point:z,lineStart:C,lineEnd:F,polygonStart:B,polygonEnd:A};function z(D,I){e(D,I)&&k.point(D,I)}function y(){for(var D=0,I=0,S=n.length;I<S;++I)for(var X=n[I],Y=1,wa=X.length,Qa=X[0],tb,ub,bb=Qa[0],Rb=Qa[1];Y<wa;++Y)tb=bb,ub=Rb,Qa=X[Y],bb=Qa[0],Rb=Qa[1],ub<=d?Rb>d&&(bb-tb)*(d-ub)>(Rb-ub)*(a-tb)&&++D:Rb<=d&&(bb-tb)*(d-ub)<(Rb-ub)*(a-tb)&&--D;return D}function B(){k=l,m=[],n=[],x=!0}function A(){var D=y(),I=x&&D,S=(m=IH(m)).length;(I||S)&&(j.polygonStart(),I&&(j.lineStart(),f(null,null,1,j),j.lineEnd()),S&&FH(m,h,D,f,j),j.polygonEnd()),k=j,m=n=o=null}function C(){u.point=K,n&&n.push(o=[]),v=!0,w=!1,s=t=NaN}function F(){m&&(K(p,q),r&&w&&l.rejoin(),m.push(l.result())),u.point=z,w&&k.lineEnd()}function K(D,I){var S=e(D,I);n&&o.push([D,I]);if(v)p=D,q=I,r=S,v=!1,S&&(k.lineStart(),k.point(D,I));else if(S&&w)k.point(D,I);else{var X=[s=Math.max(io,Math.min(ck,s)),t=Math.max(io,Math.min(ck,t))],Y=[D=Math.max(io,Math.min(ck,D)),I=Math.max(io,Math.min(ck,I))];_1(X,Y,a,b,c,d)?(w||(k.lineStart(),k.point(X[0],X[1])),k.point(Y[0],Y[1]),S||k.lineEnd(),x=!1):S&&(k.lineStart(),k.point(D,I),x=!1)}s=D,t=I,w=S}return u}}function MH(a,b,c){var d=ji(a,b-da,c).concat(b);return function(e){return d.map(function(f){return[e,f]})}}function NH(a,b,c){var d=ji(a,b-da,c).concat(b);return function(e){return d.map(function(f){return[f,e]})}}function $1(){var a,b,c,d,e,f,g,h,i=10,j=i,k=90,l=360,m,n,o,p,q=2.5;function r(){return{type:"MultiLineString",coordinates:s()}}function s(){return ji(Rn(d/k)*k,c,k).map(o).concat(ji(Rn(h/l)*l,g,l).map(p)).concat(ji(Rn(b/i)*i,a,i).filter(function(t){return sa(t%k)>da}).map(m)).concat(ji(Rn(f/j)*j,e,j).filter(function(t){return sa(t%l)>da}).map(n))}return r.lines=function(){return s().map(function(t){return{type:"LineString",coordinates:t}})},r.outline=function(){return{type:"Polygon",coordinates:[o(d).concat(p(g).slice(1),o(c).reverse().slice(1),p(h).reverse().slice(1))]}},r.extent=function(t){return arguments.length?r.extentMajor(t).extentMinor(t):r.extentMinor()},r.extentMajor=function(t){return arguments.length?(d=+t[0][0],c=+t[1][0],h=+t[0][1],g=+t[1][1],d>c&&(t=d,d=c,c=t),h>g&&(t=h,h=g,g=t),r.precision(q)):[[d,h],[c,g]]},r.extentMinor=function(t){return arguments.length?(b=+t[0][0],a=+t[1][0],f=+t[0][1],e=+t[1][1],b>a&&(t=b,b=a,a=t),f>e&&(t=f,f=e,e=t),r.precision(q)):[[b,f],[a,e]]},r.step=function(t){return arguments.length?r.stepMajor(t).stepMinor(t):r.stepMinor()},r.stepMajor=function(t){return arguments.length?(k=+t[0],l=+t[1],r):[k,l]},r.stepMinor=function(t){return arguments.length?(i=+t[0],j=+t[1],r):[i,j]},r.precision=function(t){return arguments.length?(q=+t,m=MH(f,e,90),n=NH(b,a,q),o=MH(h,g,90),p=NH(d,c,q),r):q},r.extentMajor([[-180,-90+da],[180,90-da]]).extentMinor([[-180,-80-da],[180,80+da]])}function dk(a){return a}var iv=Bg(),jv=Bg(),OH,PH,kv,lv,De={point:Cb,lineStart:Cb,lineEnd:Cb,polygonStart:function(){De.lineStart=a2,De.lineEnd=c2},polygonEnd:function(){De.lineStart=De.lineEnd=De.point=Cb,iv.add(sa(jv)),jv.reset()},result:function(){var a=iv/2;return iv.reset(),a}};function a2(){De.point=b2}function b2(a,b){De.point=QH,OH=kv=a,PH=lv=b}function QH(a,b){jv.add(lv*a-kv*b),kv=a,lv=b}function c2(){QH(OH,PH)}var ki=Infinity,jo=ki,ek=-ki,ko=ek,lo={point:d2,lineStart:Cb,lineEnd:Cb,polygonStart:Cb,polygonEnd:Cb,result:function(){var a=[[ki,jo],[ek,ko]];return ek=ko=-(jo=ki=Infinity),a}};function d2(a,b){a<ki&&(ki=a),a>ek&&(ek=a),b<jo&&(jo=b),b>ko&&(ko=b)}var mv=0,nv=0,fk=0,mo=0,no=0,li=0,ov=0,pv=0,gk=0,RH,SH,Td,Ud,Yc={point:Eg,lineStart:TH,lineEnd:UH,polygonStart:function(){Yc.lineStart=g2,Yc.lineEnd=h2},polygonEnd:function(){Yc.point=Eg,Yc.lineStart=TH,Yc.lineEnd=UH},result:function(){var a=gk?[ov/gk,pv/gk]:li?[mo/li,no/li]:fk?[mv/fk,nv/fk]:[NaN,NaN];return mv=nv=fk=mo=no=li=ov=pv=gk=0,a}};function Eg(a,b){mv+=a,nv+=b,++fk}function TH(){Yc.point=e2}function e2(a,b){Yc.point=f2,Eg(Td=a,Ud=b)}function f2(a,b){var c=a-Td,d=b-Ud,e=Bb(c*c+d*d);mo+=e*(Td+a)/2,no+=e*(Ud+b)/2,li+=e,Eg(Td=a,Ud=b)}function UH(){Yc.point=Eg}function g2(){Yc.point=i2}function h2(){VH(RH,SH)}function i2(a,b){Yc.point=VH,Eg(RH=Td=a,SH=Ud=b)}function VH(a,b){var c=a-Td,d=b-Ud,e=Bb(c*c+d*d);mo+=e*(Td+a)/2,no+=e*(Ud+b)/2,li+=e,e=Ud*a-Td*b,ov+=e*(Td+a),pv+=e*(Ud+b),gk+=e*3,Eg(Td=a,Ud=b)}function WH(a){this._context=a}WH.prototype={_radius:4.5,pointRadius:function(a){return this._radius=a,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(a,b){switch(this._point){case 0:{this._context.moveTo(a,b),this._point=1;break}case 1:{this._context.lineTo(a,b);break}default:{this._context.moveTo(a+this._radius,b),this._context.arc(a,b,this._radius,0,Xb);break}}},result:Cb};var qv=Bg(),rv,XH,YH,hk,ik,jk={point:Cb,lineStart:function(){jk.point=j2},lineEnd:function(){rv&&ZH(XH,YH),jk.point=Cb},polygonStart:function(){rv=!0},polygonEnd:function(){rv=null},result:function(){var a=+qv;return qv.reset(),a}};function j2(a,b){jk.point=ZH,XH=hk=a,YH=ik=b}function ZH(a,b){hk-=a,ik-=b,qv.add(Bb(hk*hk+ik*ik)),hk=a,ik=b}function _H(){this._string=[]}_H.prototype={_radius:4.5,_circle:$H(4.5),pointRadius:function(a){return(a=+a)!==this._radius&&(this._radius=a,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(a,b){switch(this._point){case 0:{this._string.push("M",a,",",b),this._point=1;break}case 1:{this._string.push("L",a,",",b);break}default:{this._circle==null&&(this._circle=$H(this._radius)),this._string.push("M",a,",",b,this._circle);break}}},result:function(){if(this._string.length){var a=this._string.join("");return this._string=[],a}else return null}};function $H(a){return"m0,"+a+"a"+a+","+a+" 0 1,1 0,"+-2*a+"a"+a+","+a+" 0 1,1 0,"+2*a+"z"}function aI(a,b){var c=4.5,d,e;function f(g){return g&&(typeof c==="function"&&e.pointRadius(+c.apply(this,arguments)),Ae(g,d(e))),e.result()}return f.area=function(g){return Ae(g,d(De)),De.result()},f.measure=function(g){return Ae(g,d(jk)),jk.result()},f.bounds=function(g){return Ae(g,d(lo)),lo.result()},f.centroid=function(g){return Ae(g,d(Yc)),Yc.result()},f.projection=function(g){return arguments.length?(d=g==null?(a=null,dk):(a=g).stream,f):a},f.context=function(g){return arguments.length?(e=g==null?(b=null,new _H()):new WH(b=g),typeof c!=="function"&&e.pointRadius(c),f):b},f.pointRadius=function(g){return arguments.length?(c=typeof g==="function"?g:(e.pointRadius(+g),+g),f):c},f.projection(a).context(b)}function oo(a){return function(b){var c=new sv();for(var d in a)c[d]=a[d];return c.stream=b,c}}function sv(){}sv.prototype={constructor:sv,point:function(a,b){this.stream.point(a,b)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function tv(a,b,c){var d=a.clipExtent&&a.clipExtent();return a.scale(150).translate([0,0]),d!=null&&a.clipExtent(null),Ae(c,a.stream(lo)),b(lo.result()),d!=null&&a.clipExtent(d),a}function po(a,b,c){return tv(a,function(d){var e=b[1][0]-b[0][0],f=b[1][1]-b[0][1],g=Math.min(e/(d[1][0]-d[0][0]),f/(d[1][1]-d[0][1])),h=+b[0][0]+(e-g*(d[1][0]+d[0][0]))/2,i=+b[0][1]+(f-g*(d[1][1]+d[0][1]))/2;a.scale(150*g).translate([h,i])},c)}function uv(a,b,c){return po(a,[[0,0],b],c)}function vv(a,b,c){return tv(a,function(d){var e=+b,f=e/(d[1][0]-d[0][0]),g=(e-f*(d[1][0]+d[0][0]))/2,h=-f*d[0][1];a.scale(150*f).translate([g,h])},c)}function wv(a,b,c){return tv(a,function(d){var e=+b,f=e/(d[1][1]-d[0][1]),g=-f*d[0][0],h=(e-f*(d[1][1]+d[0][1]))/2;a.scale(150*f).translate([g,h])},c)}var bI=16,k2=ea(30*na);function cI(a,b){return+b?m2(a,b):l2(a)}function l2(a){return oo({point:function(b,c){b=a(b,c),this.stream.point(b[0],b[1])}})}function m2(a,b){function c(d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=j-d,s=k-e,t=r*r+s*s;if(t>4*b&&p--){var w=g+m,v=h+n,x=i+o,u=Bb(w*w+v*v+x*x),z=qc(x/=u),y=sa(sa(x)-1)<da||sa(f-l)<da?(f+l)/2:Wc(v,w),B=a(y,z),A=B[0],C=B[1],F=A-d,K=C-e,D=s*F-r*K;(D*D/t>b||sa((r*F+s*K)/t-.5)>.3||g*m+h*n+i*o<k2)&&(c(d,e,f,g,h,i,A,C,y,w/=u,v/=u,x,p,q),q.point(A,C),c(A,C,y,w,v,x,j,k,l,m,n,o,p,q))}}return function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q={point:r,lineStart:s,lineEnd:w,polygonStart:function(){d.polygonStart(),q.lineStart=v},polygonEnd:function(){d.polygonEnd(),q.lineStart=s}};function r(z,y){z=a(z,y),d.point(z[0],z[1])}function s(){l=NaN,q.point=t,d.lineStart()}function t(z,y){var B=Cg([z,y]),A=a(z,y);c(l,m,k,n,o,p,l=A[0],m=A[1],k=z,n=B[0],o=B[1],p=B[2],bI,d),d.point(l,m)}function w(){q.point=r,d.lineEnd()}function v(){s(),q.point=x,q.lineEnd=u}function x(z,y){t(e=z,y),f=l,g=m,h=n,i=o,j=p,q.point=t}function u(){c(l,m,k,n,o,p,f,g,e,h,i,j,bI,d),q.lineEnd=w,w()}return q}}var n2=oo({point:function(a,b){this.stream.point(a*na,b*na)}});function o2(a){return oo({point:function(b,c){var d=a(b,c);return this.stream.point(d[0],d[1])}})}function p2(a,b,c,d,e){function f(g,h){return g*=d,h*=e,[b+a*g,c-a*h]}return f.invert=function(g,h){return[(g-b)/a*d,(c-h)/a*e]},f}function dI(a,b,c,d,e,f){var g=ea(f),h=ba(f),i=g*a,j=h*a,k=g/a,l=h/a,m=(h*c-g*b)/a,n=(h*b+g*c)/a;function o(p,q){return p*=d,q*=e,[i*p-j*q+b,c-j*p-i*q]}return o.invert=function(p,q){return[d*(k*p-l*q+m),e*(n-l*p-k*q)]},o}function Vd(a){return eI(function(){return a})()}function eI(a){var b,c=150,d=480,e=250,f=0,g=0,h=0,i=0,j=0,k,l=0,m=1,n=1,o=null,p=KH,q=null,r,s,t,w=dk,v=.5,x,u,z,y,B;function A(D){return z(D[0]*na,D[1]*na)}function C(D){return D=z.invert(D[0],D[1]),D&&[D[0]*$a,D[1]*$a]}A.stream=function(D){return y&&B===D?y:y=n2(o2(k)(p(x(w(B=D)))))},A.preclip=function(D){return arguments.length?(p=D,o=void 0,K()):p},A.postclip=function(D){return arguments.length?(w=D,q=r=s=t=null,K()):w},A.clipAngle=function(D){return arguments.length?(p=+D?Z1(o=D*na):(o=null,KH),K()):o*$a},A.clipExtent=function(D){return arguments.length?(w=D==null?(q=r=s=t=null,dk):LH(q=+D[0][0],r=+D[0][1],s=+D[1][0],t=+D[1][1]),K()):q==null?null:[[q,r],[s,t]]},A.scale=function(D){return arguments.length?(c=+D,F()):c},A.translate=function(D){return arguments.length?(d=+D[0],e=+D[1],F()):[d,e]},A.center=function(D){return arguments.length?(f=D[0]%360*na,g=D[1]%360*na,F()):[f*$a,g*$a]},A.rotate=function(D){return arguments.length?(h=D[0]%360*na,i=D[1]%360*na,j=D.length>2?D[2]%360*na:0,F()):[h*$a,i*$a,j*$a]},A.angle=function(D){return arguments.length?(l=D%360*na,F()):l*$a},A.reflectX=function(D){return arguments.length?(m=D?-1:1,F()):m<0},A.reflectY=function(D){return arguments.length?(n=D?-1:1,F()):n<0},A.precision=function(D){return arguments.length?(x=cI(u,v=D*D),K()):Bb(v)},A.fitExtent=function(D,I){return po(A,D,I)},A.fitSize=function(D,I){return uv(A,D,I)},A.fitWidth=function(D,I){return vv(A,D,I)},A.fitHeight=function(D,I){return wv(A,D,I)};function F(){var D=dI(c,0,0,m,n,l).apply(null,b(f,g)),I=(l?dI:p2)(c,d-D[0],e-D[1],m,n,l);return k=zH(h,i,j),u=ev(b,I),z=ev(k,u),x=cI(u,v),K()}function K(){return y=B=null,A}return function(){return b=a.apply(this,arguments),A.invert=b.invert&&C,F()}}function xv(a){var b=0,c=ma/3,d=eI(a),e=d(b,c);return e.parallels=function(f){return arguments.length?d(b=f[0]*na,c=f[1]*na):[b*$a,c*$a]},e}function q2(a){var b=ea(a);function c(d,e){return[d*b,ba(e)/b]}return c.invert=function(d,e){return[d/b,qc(e*b)]},c}function r2(a,b){var c=ba(a),d=(c+ba(b))/2;if(sa(d)<da)return q2(a);var e=1+c*(2*d-c),f=Bb(e)/d;function g(h,i){var j=Bb(e-2*d*ba(i))/d;return[j*ba(h*=d),f-j*ea(h)]}return g.invert=function(h,i){var j=f-i,k=Wc(h,sa(j))*Xc(j);return j*d<0&&(k-=ma*Xc(h)*Xc(j)),[k/d,qc((e-(h*h+j*j)*d*d)/(2*d))]},g}function qo(){return xv(r2).scale(155.424).center([0,33.6442])}function fI(){return qo().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function s2(a){var b=a.length;return{point:function(c,d){for(var e=-1;++e<b;)a[e].point(c,d)},sphere:function(){for(var c=-1;++c<b;)a[c].sphere()},lineStart:function(){for(var c=-1;++c<b;)a[c].lineStart()},lineEnd:function(){for(var c=-1;++c<b;)a[c].lineEnd()},polygonStart:function(){for(var c=-1;++c<b;)a[c].polygonStart()},polygonEnd:function(){for(var c=-1;++c<b;)a[c].polygonEnd()}}}function t2(){var a,b,c=fI(),d,e=qo().rotate([154,0]).center([-2,58.5]).parallels([55,65]),f,g=qo().rotate([157,0]).center([-3,19.9]).parallels([8,18]),h,i,j={point:function(m,n){i=[m,n]}};function k(m){var n=m[0],o=m[1];return i=null,(d.point(n,o),i)||(f.point(n,o),i)||(h.point(n,o),i)}k.invert=function(m){var n=c.scale(),o=c.translate(),p=(m[0]-o[0])/n,q=(m[1]-o[1])/n;return(q>=.12&&q<.234&&p>=-.425&&p<-.214?e:q>=.166&&q<.234&&p>=-.214&&p<-.115?g:c).invert(m)},k.stream=function(m){return a&&b===m?a:a=s2([c.stream(b=m),e.stream(m),g.stream(m)])},k.precision=function(m){return arguments.length?(c.precision(m),e.precision(m),g.precision(m),l()):c.precision()},k.scale=function(m){return arguments.length?(c.scale(m),e.scale(m*.35),g.scale(m),k.translate(c.translate())):c.scale()},k.translate=function(m){if(!arguments.length)return c.translate();var n=c.scale(),o=+m[0],p=+m[1];return d=c.translate(m).clipExtent([[o-.455*n,p-.238*n],[o+.455*n,p+.238*n]]).stream(j),f=e.translate([o-.307*n,p+.201*n]).clipExtent([[o-.425*n+da,p+.12*n+da],[o-.214*n-da,p+.234*n-da]]).stream(j),h=g.translate([o-.205*n,p+.212*n]).clipExtent([[o-.214*n+da,p+.166*n+da],[o-.115*n-da,p+.234*n-da]]).stream(j),l()},k.fitExtent=function(m,n){return po(k,m,n)},k.fitSize=function(m,n){return uv(k,m,n)},k.fitWidth=function(m,n){return vv(k,m,n)},k.fitHeight=function(m,n){return wv(k,m,n)};function l(){return a=b=null,k}return k.scale(1070)}function gI(a){return function(b,c){var d=ea(b),e=ea(c),f=a(d*e);return[f*e*ba(b),f*ba(c)]}}function kk(a){return function(b,c){var d=Bb(b*b+c*c),e=a(d),f=ba(e),g=ea(e);return[Wc(b*f,d*g),qc(d&&c*f/d)]}}var hI=gI(function(a){return Bb(2/(1+a))});hI.invert=kk(function(a){return 2*qc(a/2)});function u2(){return Vd(hI).scale(124.75).clipAngle(180-.001)}var iI=gI(function(a){return(a=gH(a))&&a/ba(a)});iI.invert=kk(function(a){return a});function v2(){return Vd(iI).scale(79.4188).clipAngle(180-.001)}function ro(a,b){return[a,Sn(Vu((Va+b)/2))]}ro.invert=function(a,b){return[a,2*gi(fH(b))-Va]};function w2(){return jI(ro).scale(961/Xb)}function jI(a){var b=Vd(a),c=b.center,d=b.scale,e=b.translate,f=b.clipExtent,g=null,h,i,j;b.scale=function(l){return arguments.length?(d(l),k()):d()},b.translate=function(l){return arguments.length?(e(l),k()):e()},b.center=function(l){return arguments.length?(c(l),k()):c()},b.clipExtent=function(l){return arguments.length?(l==null?g=h=i=j=null:(g=+l[0][0],h=+l[0][1],i=+l[1][0],j=+l[1][1]),k()):g==null?null:[[g,h],[i,j]]};function k(){var l=ma*d(),m=b(P1(b.rotate()).invert([0,0]));return f(g==null?[[m[0]-l,m[1]-l],[m[0]+l,m[1]+l]]:a===ro?[[Math.max(m[0]-l,g),h],[Math.min(m[0]+l,i),j]]:[[g,Math.max(m[1]-l,h)],[i,Math.min(m[1]+l,j)]])}return k()}function so(a){return Vu((Va+a)/2)}function x2(a,b){var c=ea(a),d=a===b?ba(a):Sn(c/ea(b))/Sn(so(b)/so(a)),e=c*Uu(so(a),d)/d;if(!d)return ro;function f(g,h){e>0?h<-Va+da&&(h=-Va+da):h>Va-da&&(h=Va-da);var i=e/Uu(so(h),d);return[i*ba(d*g),e-i*ea(d*g)]}return f.invert=function(g,h){var i=e-h,j=Xc(d)*Bb(g*g+i*i),k=Wc(g,sa(i))*Xc(i);return i*d<0&&(k-=ma*Xc(g)*Xc(i)),[k/d,2*gi(Uu(e/j,1/d))-Va]},f}function y2(){return xv(x2).scale(109.5).parallels([30,30])}function to(a,b){return[a,b]}to.invert=to;function z2(){return Vd(to).scale(152.63)}function A2(a,b){var c=ea(a),d=a===b?ba(a):(c-ea(b))/(b-a),e=c/d+a;if(sa(d)<da)return to;function f(g,h){var i=e-h,j=d*g;return[i*ba(j),e-i*ea(j)]}return f.invert=function(g,h){var i=e-h,j=Wc(g,sa(i))*Xc(i);return i*d<0&&(j-=ma*Xc(g)*Xc(i)),[j/d,e-Xc(d)*Bb(g*g+i*i)]},f}function B2(){return xv(A2).scale(131.154).center([0,13.9389])}var lk=1.340264,mk=-.081106,nk=893e-6,ok=.003796,uo=Bb(3)/2,C2=12;function kI(a,b){var c=qc(uo*ba(b)),d=c*c,e=d*d*d;return[a*ea(c)/(uo*(lk+3*mk*d+e*(7*nk+9*ok*d))),c*(lk+mk*d+e*(nk+ok*d))]}kI.invert=function(a,b){for(var c=b,d=c*c,e=d*d*d,f=0,g,h,i;f<C2;++f){h=c*(lk+mk*d+e*(nk+ok*d))-b,i=lk+3*mk*d+e*(7*nk+9*ok*d),c-=g=h/i,d=c*c,e=d*d*d;if(sa(g)<Tu)break}return[uo*a*(lk+3*mk*d+e*(7*nk+9*ok*d))/ea(c),qc(ba(c)/uo)]};function D2(){return Vd(kI).scale(177.158)}function lI(a,b){var c=ea(b),d=ea(a)*c;return[c*ba(a)/d,ba(b)/d]}lI.invert=kk(gi);function E2(){return Vd(lI).scale(144.049).clipAngle(60)}function F2(){var a=1,b=0,c=0,d=1,e=1,f=0,g,h,i=null,j,k,l,m=1,n=1,o=oo({point:function(w,v){var x=t([w,v]);this.stream.point(x[0],x[1])}}),p=dk,q,r;function s(){return m=a*d,n=a*e,q=r=null,t}function t(w){var v=w[0]*m,x=w[1]*n;if(f){var u=x*g-v*h;v=v*g+x*h,x=u}return[v+b,x+c]}return t.invert=function(w){var v=w[0]-b,x=w[1]-c;if(f){var u=x*g+v*h;v=v*g-x*h,x=u}return[v/m,x/n]},t.stream=function(w){return q&&r===w?q:q=o(p(r=w))},t.postclip=function(w){return arguments.length?(p=w,i=j=k=l=null,s()):p},t.clipExtent=function(w){return arguments.length?(p=w==null?(i=j=k=l=null,dk):LH(i=+w[0][0],j=+w[0][1],k=+w[1][0],l=+w[1][1]),s()):i==null?null:[[i,j],[k,l]]},t.scale=function(w){return arguments.length?(a=+w,s()):a},t.translate=function(w){return arguments.length?(b=+w[0],c=+w[1],s()):[b,c]},t.angle=function(w){return arguments.length?(f=w%360*na,h=ba(f),g=ea(f),s()):f*$a},t.reflectX=function(w){return arguments.length?(d=w?-1:1,s()):d<0},t.reflectY=function(w){return arguments.length?(e=w?-1:1,s()):e<0},t.fitExtent=function(w,v){return po(t,w,v)},t.fitSize=function(w,v){return uv(t,w,v)},t.fitWidth=function(w,v){return vv(t,w,v)},t.fitHeight=function(w,v){return wv(t,w,v)},t}function mI(a,b){var c=b*b,d=c*c;return[a*(.8707-.131979*c+d*(-.013791+d*(.003971*c-.001529*d))),b*(1.007226+c*(.015085+d*(-.044475+.028874*c-.005916*d)))]}mI.invert=function(a,b){var c=b,d=25,e;do{var f=c*c,g=f*f;c-=e=(c*(1.007226+f*(.015085+g*(-.044475+.028874*f-.005916*g)))-b)/(1.007226+f*(.015085*3+g*(-.044475*7+.028874*9*f-.005916*11*g)))}while(sa(e)>da&&--d>0);return[a/(.8707+(f=c*c)*(-.131979+f*(-.013791+f*f*f*(.003971-.001529*f)))),c]};function G2(){return Vd(mI).scale(175.295)}function nI(a,b){return[ea(b)*ba(a),ba(b)]}nI.invert=kk(qc);function H2(){return Vd(nI).scale(249.5).clipAngle(90+da)}function oI(a,b){var c=ea(b),d=1+ea(a)*c;return[c*ba(a)/d,ba(b)/d]}oI.invert=kk(function(a){return 2*gi(a)});function I2(){return Vd(oI).scale(250).clipAngle(142)}function pI(a,b){return[Sn(Vu((Va+b)/2)),-a]}pI.invert=function(a,b){return[-b,2*gi(fH(a))-Va]};function J2(){var a=jI(pI),b=a.center,c=a.rotate;return a.center=function(d){return arguments.length?b([-d[1],d[0]]):(d=b(),[d[1],-d[0]])},a.rotate=function(d){return arguments.length?c([d[0],d[1],d.length>2?d[2]+90:90]):(d=c(),[d[0],d[1],d[2]-90])},c([0,0,90]).scale(159.155)}var K2=Math.abs,yv=Math.cos,vo=Math.sin,L2=1e-6,qI=Math.PI,zv=qI/2,rI=M2(2);function sI(a){return a>1?zv:a<-1?-zv:Math.asin(a)}function M2(a){return a>0?Math.sqrt(a):0}function N2(a,b){var c=a*vo(b),d=30,e;do b-=e=(b+vo(b)-c)/(1+yv(b));while(K2(e)>L2&&--d>0);return b/2}function O2(a,b,c){function d(e,f){return[a*e*yv(f=N2(c,f)),b*vo(f)]}return d.invert=function(e,f){return f=sI(f/b),[e/(a*yv(f)),sI((2*f+vo(2*f))/c)]},d}var P2=O2(rI/zv,rI,qI);function Q2(){return Vd(P2).scale(169.529)}var R2=aI(),Av=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function S2(a,b){return function c(){var d=b();return d.type=a,d.path=aI().projection(d),d.copy=d.copy||function(){var e=c();return Av.forEach(function(f){d[f]&&e[f](d[f]())}),e.path.pointRadius(d.path.pointRadius()),e},d}}function Bv(a,b){if(!a||typeof a!=="string")throw new Error("Projection type must be a name string.");return a=a.toLowerCase(),arguments.length>1?(wo[a]=S2(a,b),this):wo[a]||null}function tI(a){return a&&a.path||R2}var wo={albers:fI,albersusa:t2,azimuthalequalarea:u2,azimuthalequidistant:v2,conicconformal:y2,conicequalarea:qo,conicequidistant:B2,equalEarth:D2,equirectangular:z2,gnomonic:E2,identity:F2,mercator:w2,mollweide:Q2,naturalEarth1:G2,orthographic:H2,stereographic:I2,transversemercator:J2};for(var uI in wo)Bv(uI,wo[uI]);function Cv(a){E.call(this,null,a)}Cv.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};var T2=N(Cv,E);T2.transform=function(a,b){var c=b.fork(b.ALL),d=this.value,e=a.field||Ub,f=a.as||"path",g=c.SOURCE;function h(j){j[f]=d(e(j))}!d||a.modified()?(this.value=d=tI(a.projection),c.materialize().reflow()):g=e===Ub||b.modified(e.fields)?c.ADD_MOD:c.ADD;var i=U2(d,a.pointRadius);return c.visit(g,h),d.pointRadius(i),c.modifies(f)};function U2(a,b){var c=a.pointRadius();return a.context(null),b!=null&&a.pointRadius(b),c}function Dv(a){E.call(this,null,a)}Dv.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};var V2=N(Dv,E);V2.transform=function(a,b){var c=a.projection,d=a.fields[0],e=a.fields[1],f=a.as||["x","y"],g=f[0],h=f[1],i;function j(k){var l=c([d(k),e(k)]);l?(k[g]=l[0],k[h]=l[1]):(k[g]=void 0,k[h]=void 0)}return a.modified()?b=b.materialize().reflow(!0).visit(b.SOURCE,j):(i=b.modified(d.fields)||b.modified(e.fields),b.visit(i?b.ADD_MOD:b.ADD,j)),b.modifies(f)};function Ev(a){E.call(this,null,a)}Ev.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};var W2=N(Ev,E);W2.transform=function(a,b){var c=b.fork(b.ALL),d=this.value,e=a.as||"shape",f=c.ADD;return(!d||a.modified())&&(this.value=d=X2(tI(a.projection),a.field||Fd("datum"),a.pointRadius),c.materialize().reflow(),f=c.SOURCE),c.visit(f,function(g){g[e]=d}),c.modifies(e)};function X2(a,b,c){var d=c==null?function(e){return a(b(e))}:function(e){var f=a.pointRadius(),g=a.pointRadius(c)(b(e));return a.pointRadius(f),g};return d.context=function(e){return a.context(e),d},d}function Fv(a){E.call(this,[],a),this.generator=$1()}Fv.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var Y2=N(Fv,E);Y2.transform=function(a,b){var c=this.value,d=this.generator,e;if(!c.length||a.modified())for(var f in a)pa(d[f])&&d[f](a[f]);return e=d(),c.length?b.mod.push(rA(c[0],e)):b.add.push(xa(e)),c[0]=e,b};function Gv(a){E.call(this,null,a)}Gv.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};var Z2=N(Gv,E);Z2.transform=function(a,b){if(!b.changed()&&!a.modified())return b.StopPropagation;var c=b.materialize(b.SOURCE).source,d=a.resolve==="shared",e=a.field||Ub,f=$2(a.opacity,a),g=_2(a.color,a),h=a.as||"image",i={$x:0,$y:0,$value:0,$max:d?hg(c.map(j=>hg(e(j).values))):0};return c.forEach(j=>{const k=e(j),l=la({},j,i);d||(l.$max=hg(k.values||[])),j[h]=a3(k,l,g.dep?g:Vb(g(l)),f.dep?f:Vb(f(l)))}),b.reflow(!0).modifies(h)};function _2(a,b){let c;return pa(a)?(c=d=>rf(a(d,b)),c.dep=vI(a)):c=Vb(rf(a||"#888")),c}function $2(a,b){let c;return pa(a)?(c=d=>a(d,b),c.dep=vI(a)):a?c=Vb(a):(c=d=>d.$value/d.$max||0,c.dep=!0),c}function vI(a){if(!pa(a))return!1;const b=wb(Tb(a));return b.$x||b.$y||b.$value||b.$max}function a3(a,b,c,d){const e=a.width,f=a.height,g=a.x1||0,h=a.y1||0,i=a.x2||e,j=a.y2||f,k=a.values,l=k?q=>k[q]:$f,m=Aj(i-g,j-h),n=m.getContext("2d"),o=n.getImageData(0,0,i-g,j-h),p=o.data;for(let q=h,r=0;q<j;++q){b.$y=q-h;for(let s=g,t=q*e;s<i;++s,r+=4){b.$x=s-g,b.$value=l(s+t);const w=c(b);p[r+0]=w.r,p[r+1]=w.g,p[r+2]=w.b,p[r+3]=~~(255*d(b))}}return n.putImageData(o,0,0),m}function wI(a){E.call(this,null,a),this.modified(!0)}var b3=N(wI,E);b3.transform=function(a,b){var c=this.value;return!c||a.modified("type")?(this.value=c=d3(a.type),Av.forEach(function(d){a[d]!=null&&xI(c,d,a[d])})):Av.forEach(function(d){a.modified(d)&&xI(c,d,a[d])}),a.pointRadius!=null&&c.path.pointRadius(a.pointRadius),a.fit&&c3(c,a),b.fork(b.NO_SOURCE|b.NO_FIELDS)};function c3(a,b){var c=e3(b.fit);b.extent?a.fitExtent(b.extent,c):b.size&&a.fitSize(b.size,c)}function d3(a){var b=Bv((a||"mercator").toLowerCase());return b||H("Unrecognized projection type: "+a),b()}function xI(a,b,c){pa(a[b])&&a[b](c)}function e3(a){return a=T(a),a.length===1?a[0]:{type:Ru,features:a.reduce((b,c)=>b.concat(f3(c)),[])}}function f3(a){return a.type===Ru?a.features:T(a).filter(b=>b!=null).map(b=>b.type===Qu?b:{type:Qu,geometry:b})}var g3=Object.freeze({__proto__:null,contour:Pu,geojson:Su,geopath:Cv,geopoint:Dv,geoshape:Ev,graticule:Fv,heatmap:Gv,isocontour:Mu,kde2d:Ou,projection:wI});function h3(a,b){var c;a==null&&(a=0),b==null&&(b=0);function d(){var e,f=c.length,g,h=0,i=0;for(e=0;e<f;++e)g=c[e],h+=g.x,i+=g.y;for(h=h/f-a,i=i/f-b,e=0;e<f;++e)g=c[e],g.x-=h,g.y-=i}return d.initialize=function(e){c=e},d.x=function(e){return arguments.length?(a=+e,d):a},d.y=function(e){return arguments.length?(b=+e,d):b},d}function i3(a){var b=+this._x.call(null,a),c=+this._y.call(null,a);return yI(this.cover(b,c),b,c,a)}function yI(a,b,c,d){if(isNaN(b)||isNaN(c))return a;var e,f=a._root,g={data:d},h=a._x0,i=a._y0,j=a._x1,k=a._y1,l,m,n,o,p,q,r,s;if(!f)return a._root=g,a;for(;f.length;){(p=b>=(l=(h+j)/2))?h=l:j=l,(q=c>=(m=(i+k)/2))?i=m:k=m;if(e=f,!(f=f[r=q<<1|p]))return e[r]=g,a}n=+a._x.call(null,f.data),o=+a._y.call(null,f.data);if(b===n&&c===o)return g.next=f,e?e[r]=g:a._root=g,a;do e=e?e[r]=new Array(4):a._root=new Array(4),(p=b>=(l=(h+j)/2))?h=l:j=l,(q=c>=(m=(i+k)/2))?i=m:k=m;while((r=q<<1|p)===(s=(o>=m)<<1|n>=l));return e[s]=f,e[r]=g,a}function j3(a){var b,c,d=a.length,e,f,g=new Array(d),h=new Array(d),i=Infinity,j=Infinity,k=-Infinity,l=-Infinity;for(c=0;c<d;++c){if(isNaN(e=+this._x.call(null,b=a[c]))||isNaN(f=+this._y.call(null,b)))continue;g[c]=e,h[c]=f,e<i&&(i=e),e>k&&(k=e),f<j&&(j=f),f>l&&(l=f)}if(i>k||j>l)return this;for(this.cover(i,j).cover(k,l),c=0;c<d;++c)yI(this,g[c],h[c],a[c]);return this}function k3(a,b){if(isNaN(a=+a)||isNaN(b=+b))return this;var c=this._x0,d=this._y0,e=this._x1,f=this._y1;if(isNaN(c))e=(c=Math.floor(a))+1,f=(d=Math.floor(b))+1;else{for(var g=e-c,h=this._root,i,j;c>a||a>=e||d>b||b>=f;){j=(b<d)<<1|a<c,i=new Array(4),i[j]=h,h=i,g*=2;switch(j){case 0:e=c+g,f=d+g;break;case 1:c=e-g,f=d+g;break;case 2:e=c+g,d=f-g;break;case 3:c=e-g,d=f-g;break}}this._root&&this._root.length&&(this._root=h)}return this._x0=c,this._y0=d,this._x1=e,this._y1=f,this}function l3(){var a=[];return this.visit(function(b){if(!b.length)do a.push(b.data);while(b=b.next)}),a}function m3(a){return arguments.length?this.cover(+a[0][0],+a[0][1]).cover(+a[1][0],+a[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function $b(a,b,c,d,e){this.node=a,this.x0=b,this.y0=c,this.x1=d,this.y1=e}function n3(a,b,c){var d,e=this._x0,f=this._y0,g,h,i,j,k=this._x1,l=this._y1,m=[],n=this._root,o,p;for(n&&m.push(new $b(n,e,f,k,l)),c==null?c=Infinity:(e=a-c,f=b-c,k=a+c,l=b+c,c*=c);o=m.pop();){if(!(n=o.node)||(g=o.x0)>k||(h=o.y0)>l||(i=o.x1)<e||(j=o.y1)<f)continue;if(n.length){var q=(g+i)/2,r=(h+j)/2;m.push(new $b(n[3],q,r,i,j),new $b(n[2],g,r,q,j),new $b(n[1],q,h,i,r),new $b(n[0],g,h,q,r)),(p=(b>=r)<<1|a>=q)&&(o=m[m.length-1],m[m.length-1]=m[m.length-1-p],m[m.length-1-p]=o)}else{var s=a-+this._x.call(null,n.data),t=b-+this._y.call(null,n.data),w=s*s+t*t;if(w<c){var v=Math.sqrt(c=w);e=a-v,f=b-v,k=a+v,l=b+v,d=n.data}}}return d}function o3(a){if(isNaN(k=+this._x.call(null,a))||isNaN(l=+this._y.call(null,a)))return this;var b,c=this._root,d,e,f,g=this._x0,h=this._y0,i=this._x1,j=this._y1,k,l,m,n,o,p,q,r;if(!c)return this;if(c.length)for(;;){(o=k>=(m=(g+i)/2))?g=m:i=m,(p=l>=(n=(h+j)/2))?h=n:j=n;if(!(b=c,c=c[q=p<<1|o]))return this;if(!c.length)break;(b[q+1&3]||b[q+2&3]||b[q+3&3])&&(d=b,r=q)}for(;c.data!==a;)if(!(e=c,c=c.next))return this;return(f=c.next)&&delete c.next,e?(f?e.next=f:delete e.next,this):b?(f?b[q]=f:delete b[q],(c=b[0]||b[1]||b[2]||b[3])&&c===(b[3]||b[2]||b[1]||b[0])&&!c.length&&(d?d[r]=c:this._root=c),this):(this._root=f,this)}function p3(a){for(var b=0,c=a.length;b<c;++b)this.remove(a[b]);return this}function q3(){return this._root}function r3(){var a=0;return this.visit(function(b){if(!b.length)do++a;while(b=b.next)}),a}function s3(a){var b=[],c,d=this._root,e,f,g,h,i;for(d&&b.push(new $b(d,this._x0,this._y0,this._x1,this._y1));c=b.pop();)if(!a(d=c.node,f=c.x0,g=c.y0,h=c.x1,i=c.y1)&&d.length){var j=(f+h)/2,k=(g+i)/2;(e=d[3])&&b.push(new $b(e,j,k,h,i)),(e=d[2])&&b.push(new $b(e,f,k,j,i)),(e=d[1])&&b.push(new $b(e,j,g,h,k)),(e=d[0])&&b.push(new $b(e,f,g,j,k))}return this}function t3(a){var b=[],c=[],d;for(this._root&&b.push(new $b(this._root,this._x0,this._y0,this._x1,this._y1));d=b.pop();){var e=d.node;if(e.length){var f,g=d.x0,h=d.y0,i=d.x1,j=d.y1,k=(g+i)/2,l=(h+j)/2;(f=e[0])&&b.push(new $b(f,g,h,k,l)),(f=e[1])&&b.push(new $b(f,k,h,i,l)),(f=e[2])&&b.push(new $b(f,g,l,k,j)),(f=e[3])&&b.push(new $b(f,k,l,i,j))}c.push(d)}for(;d=c.pop();)a(d.node,d.x0,d.y0,d.x1,d.y1);return this}function u3(a){return a[0]}function v3(a){return arguments.length?(this._x=a,this):this._x}function w3(a){return a[1]}function x3(a){return arguments.length?(this._y=a,this):this._y}function Hv(a,b,c){var d=new Iv(b==null?u3:b,c==null?w3:c,NaN,NaN,NaN,NaN);return a==null?d:d.addAll(a)}function Iv(a,b,c,d,e,f){this._x=a,this._y=b,this._x0=c,this._y0=d,this._x1=e,this._y1=f,this._root=void 0}function zI(a){for(var b={data:a.data},c=b;a=a.next;)c=c.next={data:a.data};return b}var ac=Hv.prototype=Iv.prototype;ac.copy=function(){var a=new Iv(this._x,this._y,this._x0,this._y0,this._x1,this._y1),b=this._root,c,d;if(!b)return a;if(!b.length)return a._root=zI(b),a;for(c=[{source:b,target:a._root=new Array(4)}];b=c.pop();)for(var e=0;e<4;++e)(d=b.source[e])&&(d.length?c.push({source:d,target:b.target[e]=new Array(4)}):b.target[e]=zI(d));return a},ac.add=i3,ac.addAll=j3,ac.cover=k3,ac.data=l3,ac.extent=m3,ac.find=n3,ac.remove=o3,ac.removeAll=p3,ac.root=q3,ac.size=r3,ac.visit=s3,ac.visitAfter=t3,ac.x=v3,ac.y=x3;function bc(a){return function(){return a}}function vf(){return(Math.random()-.5)*1e-6}function y3(a){return a.x+a.vx}function z3(a){return a.y+a.vy}function A3(a){var b,c,d=1,e=1;typeof a!=="function"&&(a=bc(a==null?1:+a));function f(){for(var i,j=b.length,k,l,m,n,o,p,q=0;q<e;++q)for(k=Hv(b,y3,z3).visitAfter(g),i=0;i<j;++i)l=b[i],o=c[l.index],p=o*o,m=l.x+l.vx,n=l.y+l.vy,k.visit(r);function r(s,t,w,v,x){var u=s.data,z=s.r,y=o+z;if(u){if(u.index>l.index){var B=m-u.x-u.vx,A=n-u.y-u.vy,C=B*B+A*A;C<y*y&&(B===0&&(B=vf(),C+=B*B),A===0&&(A=vf(),C+=A*A),C=(y-(C=Math.sqrt(C)))/C*d,l.vx+=(B*=C)*(y=(z*=z)/(p+z)),l.vy+=(A*=C)*y,u.vx-=B*(y=1-y),u.vy-=A*y)}return}return t>m+y||v<m-y||w>n+y||x<n-y}}function g(i){if(i.data)return i.r=c[i.data.index];for(var j=i.r=0;j<4;++j)i[j]&&i[j].r>i.r&&(i.r=i[j].r)}function h(){if(!b)return;var i,j=b.length,k;for(c=new Array(j),i=0;i<j;++i)k=b[i],c[k.index]=+a(k,i,b)}return f.initialize=function(i){b=i,h()},f.iterations=function(i){return arguments.length?(e=+i,f):e},f.strength=function(i){return arguments.length?(d=+i,f):d},f.radius=function(i){return arguments.length?(a=typeof i==="function"?i:bc(+i),h(),f):a},f}function B3(a){return a.index}function AI(a,b){var c=a.get(b);if(!c)throw new Error("missing: "+b);return c}function C3(a){var b=B3,c=k,d,e=bc(30),f,g,h,i,j=1;a==null&&(a=[]);function k(p){return 1/Math.min(h[p.source.index],h[p.target.index])}function l(p){for(var q=0,r=a.length;q<j;++q)for(var s=0,t,w,v,x,u,z,y;s<r;++s)t=a[s],w=t.source,v=t.target,x=v.x+v.vx-w.x-w.vx||vf(),u=v.y+v.vy-w.y-w.vy||vf(),z=Math.sqrt(x*x+u*u),z=(z-f[s])/z*p*d[s],x*=z,u*=z,v.vx-=x*(y=i[s]),v.vy-=u*y,w.vx+=x*(y=1-y),w.vy+=u*y}function m(){if(!g)return;var p,q=g.length,r=a.length,s=new Map(g.map((w,v)=>[b(w,v,g),w])),t;for(p=0,h=new Array(q);p<r;++p)t=a[p],t.index=p,typeof t.source!=="object"&&(t.source=AI(s,t.source)),typeof t.target!=="object"&&(t.target=AI(s,t.target)),h[t.source.index]=(h[t.source.index]||0)+1,h[t.target.index]=(h[t.target.index]||0)+1;for(p=0,i=new Array(r);p<r;++p)t=a[p],i[p]=h[t.source.index]/(h[t.source.index]+h[t.target.index]);d=new Array(r),n(),f=new Array(r),o()}function n(){if(!g)return;for(var p=0,q=a.length;p<q;++p)d[p]=+c(a[p],p,a)}function o(){if(!g)return;for(var p=0,q=a.length;p<q;++p)f[p]=+e(a[p],p,a)}return l.initialize=function(p){g=p,m()},l.links=function(p){return arguments.length?(a=p,m(),l):a},l.id=function(p){return arguments.length?(b=p,l):b},l.iterations=function(p){return arguments.length?(j=+p,l):j},l.strength=function(p){return arguments.length?(c=typeof p==="function"?p:bc(+p),n(),l):c},l.distance=function(p){return arguments.length?(e=typeof p==="function"?p:bc(+p),o(),l):e},l}var D3={value:function(){}};function BI(){for(var a=0,b=arguments.length,c={},d;a<b;++a){if(!(d=arguments[a]+"")||d in c||/[\s.]/.test(d))throw new Error("illegal type: "+d);c[d]=[]}return new xo(c)}function xo(a){this._=a}function E3(a,b){return a.trim().split(/^|\s+/).map(function(c){var d="",e=c.indexOf(".");e>=0&&(d=c.slice(e+1),c=c.slice(0,e));if(c&&!b.hasOwnProperty(c))throw new Error("unknown type: "+c);return{type:c,name:d}})}xo.prototype=BI.prototype={constructor:xo,on:function(a,b){var c=this._,d=E3(a+"",c),e,f=-1,g=d.length;if(arguments.length<2){for(;++f<g;)if((e=(a=d[f]).type)&&(e=F3(c[e],a.name)))return e;return}if(b!=null&&typeof b!=="function")throw new Error("invalid callback: "+b);for(;++f<g;)if(e=(a=d[f]).type)c[e]=CI(c[e],a.name,b);else if(b==null)for(e in c)c[e]=CI(c[e],a.name,null);return this},copy:function(){var a={},b=this._;for(var c in b)a[c]=b[c].slice();return new xo(a)},call:function(a,b){if((e=arguments.length-2)>0)for(var c=new Array(e),d=0,e,f;d<e;++d)c[d]=arguments[d+2];if(!this._.hasOwnProperty(a))throw new Error("unknown type: "+a);for(f=this._[a],d=0,e=f.length;d<e;++d)f[d].value.apply(b,c)},apply:function(a,b,c){if(!this._.hasOwnProperty(a))throw new Error("unknown type: "+a);for(var d=this._[a],e=0,f=d.length;e<f;++e)d[e].value.apply(b,c)}};function F3(a,b){for(var c=0,d=a.length,e;c<d;++c)if((e=a[c]).name===b)return e.value}function CI(a,b,c){for(var d=0,e=a.length;d<e;++d)if(a[d].name===b){a[d]=D3,a=a.slice(0,d).concat(a.slice(d+1));break}return c!=null&&a.push({name:b,value:c}),a}var mi=0,pk=0,qk=0,DI=1e3,yo,rk,zo=0,Fg=0,Ao=0,sk=typeof performance==="object"&&performance.now?performance:Date,EI=typeof window==="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(a){setTimeout(a,17)};function Jv(){return Fg||(EI(G3),Fg=sk.now()+Ao)}function G3(){Fg=0}function Bo(){this._call=this._time=this._next=null}Bo.prototype=FI.prototype={constructor:Bo,restart:function(a,b,c){if(typeof a!=="function")throw new TypeError("callback is not a function");c=(c==null?Jv():+c)+(b==null?0:+b),!this._next&&rk!==this&&(rk?rk._next=this:yo=this,rk=this),this._call=a,this._time=c,Kv()},stop:function(){this._call&&(this._call=null,this._time=Infinity,Kv())}};function FI(a,b,c){var d=new Bo();return d.restart(a,b,c),d}function H3(){Jv(),++mi;for(var a=yo,b;a;)(b=Fg-a._time)>=0&&a._call.call(null,b),a=a._next;--mi}function GI(){Fg=(zo=sk.now())+Ao,mi=pk=0;try{H3()}finally{mi=0,J3(),Fg=0}}function I3(){var a=sk.now(),b=a-zo;b>DI&&(Ao-=b,zo=a)}function J3(){for(var a,b=yo,c,d=Infinity;b;)b._call?(d>b._time&&(d=b._time),a=b,b=b._next):(c=b._next,b._next=null,b=a?a._next=c:yo=c);rk=a,Kv(d)}function Kv(a){if(mi)return;pk&&(pk=clearTimeout(pk));var b=a-Fg;b>24?(a<Infinity&&(pk=setTimeout(GI,a-sk.now()-Ao)),qk&&(qk=clearInterval(qk))):(qk||(zo=sk.now(),qk=setInterval(I3,DI)),mi=1,EI(GI))}function K3(a,b,c){var d=new Bo(),e=b;return b==null?(d.restart(a,b,c),d):(b=+b,c=c==null?Jv():+c,d.restart(function f(g){g+=e,d.restart(f,e+=b,c),a(g)},b,c),d)}function L3(a){return a.x}function M3(a){return a.y}var N3=10,O3=Math.PI*(3-Math.sqrt(5));function P3(a){var b,c=1,d=.001,e=1-Math.pow(d,1/300),f=0,g=.6,h=new Map(),i=FI(k),j=BI("tick","end");a==null&&(a=[]);function k(){l(),j.call("tick",b),c<d&&(i.stop(),j.call("end",b))}function l(o){var p,q=a.length,r;o===void 0&&(o=1);for(var s=0;s<o;++s)for(c+=(f-c)*e,h.forEach(function(t){t(c)}),p=0;p<q;++p)r=a[p],r.fx==null?r.x+=r.vx*=g:(r.x=r.fx,r.vx=0),r.fy==null?r.y+=r.vy*=g:(r.y=r.fy,r.vy=0);return b}function m(){for(var o=0,p=a.length,q;o<p;++o){q=a[o],q.index=o,q.fx!=null&&(q.x=q.fx),q.fy!=null&&(q.y=q.fy);if(isNaN(q.x)||isNaN(q.y)){var r=N3*Math.sqrt(o),s=o*O3;q.x=r*Math.cos(s),q.y=r*Math.sin(s)}(isNaN(q.vx)||isNaN(q.vy))&&(q.vx=q.vy=0)}}function n(o){return o.initialize&&o.initialize(a),o}return m(),b={tick:l,restart:function(){return i.restart(k),b},stop:function(){return i.stop(),b},nodes:function(o){return arguments.length?(a=o,m(),h.forEach(n),b):a},alpha:function(o){return arguments.length?(c=+o,b):c},alphaMin:function(o){return arguments.length?(d=+o,b):d},alphaDecay:function(o){return arguments.length?(e=+o,b):+e},alphaTarget:function(o){return arguments.length?(f=+o,b):f},velocityDecay:function(o){return arguments.length?(g=1-o,b):1-g},force:function(o,p){return arguments.length>1?(p==null?h.delete(o):h.set(o,n(p)),b):h.get(o)},find:function(o,p,q){var r=0,s=a.length,t,w,v,x,u;for(q==null?q=Infinity:q*=q,r=0;r<s;++r)x=a[r],t=o-x.x,w=p-x.y,v=t*t+w*w,v<q&&(u=x,q=v);return u},on:function(o,p){return arguments.length>1?(j.on(o,p),b):j.on(o)}}}function Q3(){var a,b,c,d=bc(-30),e,f=1,g=Infinity,h=.81;function i(m){var n,o=a.length,p=Hv(a,L3,M3).visitAfter(k);for(c=m,n=0;n<o;++n)b=a[n],p.visit(l)}function j(){if(!a)return;var m,n=a.length,o;for(e=new Array(n),m=0;m<n;++m)o=a[m],e[o.index]=+d(o,m,a)}function k(m){var n=0,o,p,q=0,r,s,t;if(m.length){for(r=s=t=0;t<4;++t)(o=m[t])&&(p=Math.abs(o.value))&&(n+=o.value,q+=p,r+=p*o.x,s+=p*o.y);m.x=r/q,m.y=s/q}else{o=m,o.x=o.data.x,o.y=o.data.y;do n+=e[o.data.index];while(o=o.next)}m.value=n}function l(m,n,o,p){if(!m.value)return!0;var q=m.x-b.x,r=m.y-b.y,s=p-n,t=q*q+r*r;if(s*s/h<t)return t<g&&(q===0&&(q=vf(),t+=q*q),r===0&&(r=vf(),t+=r*r),t<f&&(t=Math.sqrt(f*t)),b.vx+=q*m.value*c/t,b.vy+=r*m.value*c/t),!0;if(m.length||t>=g)return;(m.data!==b||m.next)&&(q===0&&(q=vf(),t+=q*q),r===0&&(r=vf(),t+=r*r),t<f&&(t=Math.sqrt(f*t)));do m.data!==b&&(s=e[m.data.index]*c/t,b.vx+=q*s,b.vy+=r*s);while(m=m.next)}return i.initialize=function(m){a=m,j()},i.strength=function(m){return arguments.length?(d=typeof m==="function"?m:bc(+m),j(),i):d},i.distanceMin=function(m){return arguments.length?(f=m*m,i):Math.sqrt(f)},i.distanceMax=function(m){return arguments.length?(g=m*m,i):Math.sqrt(g)},i.theta=function(m){return arguments.length?(h=m*m,i):Math.sqrt(h)},i}function R3(a){var b=bc(.1),c,d,e;typeof a!=="function"&&(a=bc(a==null?0:+a));function f(h){for(var i=0,j=c.length,k;i<j;++i)k=c[i],k.vx+=(e[i]-k.x)*d[i]*h}function g(){if(!c)return;var h,i=c.length;for(d=new Array(i),e=new Array(i),h=0;h<i;++h)d[h]=isNaN(e[h]=+a(c[h],h,c))?0:+b(c[h],h,c)}return f.initialize=function(h){c=h,g()},f.strength=function(h){return arguments.length?(b=typeof h==="function"?h:bc(+h),g(),f):b},f.x=function(h){return arguments.length?(a=typeof h==="function"?h:bc(+h),g(),f):a},f}function S3(a){var b=bc(.1),c,d,e;typeof a!=="function"&&(a=bc(a==null?0:+a));function f(h){for(var i=0,j=c.length,k;i<j;++i)k=c[i],k.vy+=(e[i]-k.y)*d[i]*h}function g(){if(!c)return;var h,i=c.length;for(d=new Array(i),e=new Array(i),h=0;h<i;++h)d[h]=isNaN(e[h]=+a(c[h],h,c))?0:+b(c[h],h,c)}return f.initialize=function(h){c=h,g()},f.strength=function(h){return arguments.length?(b=typeof h==="function"?h:bc(+h),g(),f):b},f.y=function(h){return arguments.length?(a=typeof h==="function"?h:bc(+h),g(),f):a},f}var HI={center:h3,collide:A3,nbody:Q3,link:C3,x:R3,y:S3},tk="forces",Lv=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],T3=["static","iterations"],II=["x","y","vx","vy"];function Mv(a){E.call(this,null,a)}Mv.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:II}]};var JI=N(Mv,E);JI.transform=function(a,b){var c=this.value,d=b.changed(b.ADD_REM),e=a.modified(Lv),f=a.iterations||300;c?(d&&(b.modifies("index"),c.nodes(b.source)),(e||b.changed(b.MOD))&&KI(c,a,0,b)):(this.value=c=V3(b.source,a),c.on("tick",U3(b.dataflow,this)),a.static||(d=!0,c.tick()),b.modifies("index"));if(e||d||a.modified(T3)||b.changed()&&a.restart){c.alpha(Math.max(c.alpha(),a.alpha||1)).alphaDecay(1-Math.pow(c.alphaMin(),1/f));if(a.static)for(c.stop();--f>=0;)c.tick();else{c.stopped()&&c.restart();if(!d)return b.StopPropagation}}return this.finish(a,b)},JI.finish=function(a,b){for(var c=b.dataflow,d=this._argops,e=0,f=d.length,g;e<f;++e){g=d[e];if(g.name!==tk||g.op._argval.force!=="link")continue;for(var h=g.op._argops,i=0,j=h.length,k;i<j;++i)if(h[i].name==="links"&&(k=h[i].op.source)){c.pulse(k,c.changeset().reflow());break}}return b.reflow(a.modified()).modifies(II)};function U3(a,b){return function(){a.touch(b).run()}}function V3(a,b){var c=P3(a),d=!1,e=c.stop,f=c.restart;return c.stopped=function(){return d},c.restart=function(){return d=!1,f()},c.stop=function(){return d=!0,e()},KI(c,b,!0).on("end",function(){d=!0})}function KI(a,b,c,d){var e=T(b.forces),f,g,h,i;for(f=0,g=Lv.length;f<g;++f)h=Lv[f],h!==tk&&b.modified(h)&&a[h](b[h]);for(f=0,g=e.length;f<g;++f)i=tk+f,h=c||b.modified(tk,f)?X3(e[f]):d&&W3(e[f],d)?a.force(i):null,h&&a.force(i,h);for(g=a.numForces||0;f<g;++f)a.force(tk+f,null);return a.numForces=e.length,a}function W3(a,b){var c,d;for(c in a)if(pa(d=a[c])&&b.modified(Tb(d)))return 1;return 0}function X3(a){var b,c;_(HI,a.force)||H("Unrecognized force: "+a.force),b=HI[a.force]();for(c in a)pa(b[c])&&Y3(b[c],a[c],a);return b}function Y3(a,b,c){a(pa(b)?function(d){return b(d,c)}:b)}var Z3=Object.freeze({__proto__:null,force:Mv});function Nv(a,b,c){var d={};return a.each(function(e){var f=e.data;c(f)&&(d[b(f)]=e)}),a.lookup=d,a}function _3(a,b){return a.parent===b.parent?1:2}function $3(a){return a.reduce(a4,0)/a.length}function a4(a,b){return a+b.x}function b4(a){return 1+a.reduce(c4,0)}function c4(a,b){return Math.max(a,b.y)}function d4(a){for(var b;b=a.children;)a=b[0];return a}function e4(a){for(var b;b=a.children;)a=b[b.length-1];return a}function f4(){var a=_3,b=1,c=1,d=!1;function e(f){var g,h=0;f.eachAfter(function(m){var n=m.children;n?(m.x=$3(n),m.y=b4(n)):(m.x=g?h+=a(m,g):0,m.y=0,g=m)});var i=d4(f),j=e4(f),k=i.x-a(i,j)/2,l=j.x+a(j,i)/2;return f.eachAfter(d?function(m){m.x=(m.x-f.x)*b,m.y=(f.y-m.y)*c}:function(m){m.x=(m.x-k)/(l-k)*b,m.y=(1-(f.y?m.y/f.y:1))*c})}return e.separation=function(f){return arguments.length?(a=f,e):a},e.size=function(f){return arguments.length?(d=!1,b=+f[0],c=+f[1],e):d?null:[b,c]},e.nodeSize=function(f){return arguments.length?(d=!0,b=+f[0],c=+f[1],e):d?[b,c]:null},e}function g4(a){var b=0,c=a.children,d=c&&c.length;if(!d)b=1;else for(;--d>=0;)b+=c[d].value;a.value=b}function h4(){return this.eachAfter(g4)}function i4(a){var b=this,c,d=[b],e,f,g;do for(c=d.reverse(),d=[];b=c.pop();){a(b),e=b.children;if(e)for(f=0,g=e.length;f<g;++f)d.push(e[f])}while(d.length);return this}function j4(a){for(var b=this,c=[b],d,e;b=c.pop();){a(b),d=b.children;if(d)for(e=d.length-1;e>=0;--e)c.push(d[e])}return this}function k4(a){for(var b=this,c=[b],d=[],e,f,g;b=c.pop();){d.push(b),e=b.children;if(e)for(f=0,g=e.length;f<g;++f)c.push(e[f])}for(;b=d.pop();)a(b);return this}function l4(a){return this.eachAfter(function(b){for(var c=+a(b.data)||0,d=b.children,e=d&&d.length;--e>=0;)c+=d[e].value;b.value=c})}function m4(a){return this.eachBefore(function(b){b.children&&b.children.sort(a)})}function n4(a){for(var b=this,c=o4(b,a),d=[b];b!==c;)b=b.parent,d.push(b);for(var e=d.length;a!==c;)d.splice(e,0,a),a=a.parent;return d}function o4(a,b){if(a===b)return a;var c=a.ancestors(),d=b.ancestors(),e=null;for(a=c.pop(),b=d.pop();a===b;)e=a,a=c.pop(),b=d.pop();return e}function p4(){for(var a=this,b=[a];a=a.parent;)b.push(a);return b}function q4(){var a=[];return this.each(function(b){a.push(b)}),a}function r4(){var a=[];return this.eachBefore(function(b){b.children||a.push(b)}),a}function s4(){var a=this,b=[];return a.each(function(c){c!==a&&b.push({source:c.parent,target:c})}),b}function Ov(a,b){var c=new ni(a),d=+a.value&&(c.value=a.value),e,f=[c],g,h,i,j;for(b==null&&(b=u4);e=f.pop();){d&&(e.value=+e.data.value);if((h=b(e.data))&&(j=h.length))for(e.children=new Array(j),i=j-1;i>=0;--i)f.push(g=e.children[i]=new ni(h[i])),g.parent=e,g.depth=e.depth+1}return c.eachBefore(LI)}function t4(){return Ov(this).eachBefore(v4)}function u4(a){return a.children}function v4(a){a.data=a.data.data}function LI(a){var b=0;do a.height=b;while((a=a.parent)&&a.height<++b)}function ni(a){this.data=a,this.depth=this.height=0,this.parent=null}ni.prototype=Ov.prototype={constructor:ni,count:h4,each:i4,eachAfter:k4,eachBefore:j4,sum:l4,sort:m4,path:n4,ancestors:p4,descendants:q4,leaves:r4,links:s4,copy:t4};var w4=Array.prototype.slice;function x4(a){for(var b=a.length,c,d;b;)d=Math.random()*b--|0,c=a[b],a[b]=a[d],a[d]=c;return a}function y4(a){for(var b=0,c=(a=x4(w4.call(a))).length,d=[],e,f;b<c;)e=a[b],f&&MI(f,e)?++b:(f=A4(d=z4(d,e)),b=0);return f}function z4(a,b){var c,d;if(Pv(b,a))return[b];for(c=0;c<a.length;++c)if(Co(b,a[c])&&Pv(uk(a[c],b),a))return[a[c],b];for(c=0;c<a.length-1;++c)for(d=c+1;d<a.length;++d)if(Co(uk(a[c],a[d]),b)&&Co(uk(a[c],b),a[d])&&Co(uk(a[d],b),a[c])&&Pv(NI(a[c],a[d],b),a))return[a[c],a[d],b];throw new Error()}function Co(a,b){var c=a.r-b.r,d=b.x-a.x,e=b.y-a.y;return c<0||c*c<d*d+e*e}function MI(a,b){var c=a.r-b.r+1e-6,d=b.x-a.x,e=b.y-a.y;return c>0&&c*c>d*d+e*e}function Pv(a,b){for(var c=0;c<b.length;++c)if(!MI(a,b[c]))return!1;return!0}function A4(a){switch(a.length){case 1:return B4(a[0]);case 2:return uk(a[0],a[1]);case 3:return NI(a[0],a[1],a[2])}}function B4(a){return{x:a.x,y:a.y,r:a.r}}function uk(a,b){var c=a.x,d=a.y,e=a.r,f=b.x,g=b.y,h=b.r,i=f-c,j=g-d,k=h-e,l=Math.sqrt(i*i+j*j);return{x:(c+f+i/l*k)/2,y:(d+g+j/l*k)/2,r:(l+e+h)/2}}function NI(a,b,c){var d=a.x,e=a.y,f=a.r,g=b.x,h=b.y,i=b.r,j=c.x,k=c.y,l=c.r,m=d-g,n=d-j,o=e-h,p=e-k,q=i-f,r=l-f,s=d*d+e*e-f*f,t=s-g*g-h*h+i*i,w=s-j*j-k*k+l*l,v=n*o-m*p,x=(o*w-p*t)/(v*2)-d,u=(p*q-o*r)/v,z=(n*t-m*w)/(v*2)-e,y=(m*r-n*q)/v,B=u*u+y*y-1,A=2*(f+x*u+z*y),C=x*x+z*z-f*f,F=-(B?(A+Math.sqrt(A*A-4*B*C))/(2*B):C/A);return{x:d+x+u*F,y:e+z+y*F,r:F}}function OI(a,b,c){var d=a.x-b.x,e,f,g=a.y-b.y,h,i,j=d*d+g*g;j?(f=b.r+c.r,f*=f,i=a.r+c.r,i*=i,f>i?(e=(j+i-f)/(2*j),h=Math.sqrt(Math.max(0,i/j-e*e)),c.x=a.x-e*d-h*g,c.y=a.y-e*g+h*d):(e=(j+f-i)/(2*j),h=Math.sqrt(Math.max(0,f/j-e*e)),c.x=b.x+e*d-h*g,c.y=b.y+e*g+h*d)):(c.x=b.x+c.r,c.y=b.y)}function PI(a,b){var c=a.r+b.r-1e-6,d=b.x-a.x,e=b.y-a.y;return c>0&&c*c>d*d+e*e}function QI(a){var b=a._,c=a.next._,d=b.r+c.r,e=(b.x*c.r+c.x*b.r)/d,f=(b.y*c.r+c.y*b.r)/d;return e*e+f*f}function Do(a){this._=a,this.next=null,this.previous=null}function C4(a){if(!(e=a.length))return 0;var b,c,d,e,f,g,h,i,j,k,l;b=a[0],b.x=0,b.y=0;if(!(e>1))return b.r;c=a[1],b.x=-c.r,c.x=b.r,c.y=0;if(!(e>2))return b.r+c.r;OI(c,b,d=a[2]),b=new Do(b),c=new Do(c),d=new Do(d),b.next=d.previous=c,c.next=b.previous=d,d.next=c.previous=b;Ve:for(h=3;h<e;++h){OI(b._,c._,d=a[h]),d=new Do(d),i=c.next,j=b.previous,k=c._.r,l=b._.r;do if(k<=l){if(PI(i._,d._)){c=i,b.next=c,c.previous=b,--h;continue Ve}k+=i._.r,i=i.next}else{if(PI(j._,d._)){b=j,b.next=c,c.previous=b,--h;continue Ve}l+=j._.r,j=j.previous}while(i!==j.next);for(d.previous=b,d.next=c,b.next=c.previous=c=d,f=QI(b);(d=d.next)!==c;)(g=QI(d))<f&&(b=d,f=g);c=b.next}for(b=[c._],d=c;(d=d.next)!==c;)b.push(d._);for(d=y4(b),h=0;h<e;++h)b=a[h],b.x-=d.x,b.y-=d.y;return d.r}function D4(a){return a==null?null:Eo(a)}function Eo(a){if(typeof a!=="function")throw new Error();return a}function Gg(){return 0}function oi(a){return function(){return a}}function E4(a){return Math.sqrt(a.value)}function F4(){var a=null,b=1,c=1,d=Gg;function e(f){return f.x=b/2,f.y=c/2,a?f.eachBefore(RI(a)).eachAfter(Qv(d,.5)).eachBefore(SI(1)):f.eachBefore(RI(E4)).eachAfter(Qv(Gg,1)).eachAfter(Qv(d,f.r/Math.min(b,c))).eachBefore(SI(Math.min(b,c)/(2*f.r))),f}return e.radius=function(f){return arguments.length?(a=D4(f),e):a},e.size=function(f){return arguments.length?(b=+f[0],c=+f[1],e):[b,c]},e.padding=function(f){return arguments.length?(d=typeof f==="function"?f:oi(+f),e):d},e}function RI(a){return function(b){b.children||(b.r=Math.max(0,+a(b)||0))}}function Qv(a,b){return function(c){if(d=c.children){var d,e,f=d.length,g=a(c)*b||0,h;if(g)for(e=0;e<f;++e)d[e].r+=g;h=C4(d);if(g)for(e=0;e<f;++e)d[e].r-=g;c.r=h+g}}}function SI(a){return function(b){var c=b.parent;b.r*=a,c&&(b.x=c.x+a*b.x,b.y=c.y+a*b.y)}}function TI(a){a.x0=Math.round(a.x0),a.y0=Math.round(a.y0),a.x1=Math.round(a.x1),a.y1=Math.round(a.y1)}function vk(a,b,c,d,e){for(var f=a.children,g,h=-1,i=f.length,j=a.value&&(d-b)/a.value;++h<i;)g=f[h],g.y0=c,g.y1=e,g.x0=b,g.x1=b+=g.value*j}function G4(){var a=1,b=1,c=0,d=!1;function e(g){var h=g.height+1;return g.x0=g.y0=c,g.x1=a,g.y1=b/h,g.eachBefore(f(b,h)),d&&g.eachBefore(TI),g}function f(g,h){return function(i){i.children&&vk(i,i.x0,g*(i.depth+1)/h,i.x1,g*(i.depth+2)/h);var j=i.x0,k=i.y0,l=i.x1-c,m=i.y1-c;l<j&&(j=l=(j+l)/2),m<k&&(k=m=(k+m)/2),i.x0=j,i.y0=k,i.x1=l,i.y1=m}}return e.round=function(g){return arguments.length?(d=!!g,e):d},e.size=function(g){return arguments.length?(a=+g[0],b=+g[1],e):[a,b]},e.padding=function(g){return arguments.length?(c=+g,e):c},e}var UI="$",H4={depth:-1},VI={};function I4(a){return a.id}function J4(a){return a.parentId}function WI(){var a=I4,b=J4;function c(d){var e,f,g=d.length,h,i,j,k=new Array(g),l,m,n={};for(f=0;f<g;++f)e=d[f],j=k[f]=new ni(e),(l=a(e,f,d))!=null&&(l+="")&&(m=UI+(j.id=l),n[m]=m in n?VI:j);for(f=0;f<g;++f){j=k[f],l=b(d[f],f,d);if(l==null||!(l+="")){if(h)throw new Error("multiple roots");h=j}else{i=n[UI+l];if(!i)throw new Error("missing: "+l);if(i===VI)throw new Error("ambiguous: "+l);i.children?i.children.push(j):i.children=[j],j.parent=i}}if(!h)throw new Error("no root");h.parent=H4,h.eachBefore(function(o){o.depth=o.parent.depth+1,--g}).eachBefore(LI),h.parent=null;if(g>0)throw new Error("cycle");return h}return c.id=function(d){return arguments.length?(a=Eo(d),c):a},c.parentId=function(d){return arguments.length?(b=Eo(d),c):b},c}function K4(a,b){return a.parent===b.parent?1:2}function Rv(a){var b=a.children;return b?b[0]:a.t}function Sv(a){var b=a.children;return b?b[b.length-1]:a.t}function L4(a,b,c){var d=c/(b.i-a.i);b.c-=d,b.s+=c,a.c+=d,b.z+=c,b.m+=c}function M4(a){for(var b=0,c=0,d=a.children,e=d.length,f;--e>=0;)f=d[e],f.z+=b,f.m+=b,b+=f.s+(c+=f.c)}function N4(a,b,c){return a.a.parent===b.parent?a.a:c}function Fo(a,b){this._=a,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=b}Fo.prototype=Object.create(ni.prototype);function O4(a){for(var b=new Fo(a,0),c,d=[b],e,f,g,h;c=d.pop();)if(f=c._.children)for(c.children=new Array(h=f.length),g=h-1;g>=0;--g)d.push(e=c.children[g]=new Fo(f[g],g)),e.parent=c;return(b.parent=new Fo(null,0)).children=[b],b}function P4(){var a=K4,b=1,c=1,d=null;function e(j){var k=O4(j);k.eachAfter(f),k.parent.m=-k.z,k.eachBefore(g);if(d)j.eachBefore(i);else{var l=j,m=j,n=j;j.eachBefore(function(s){s.x<l.x&&(l=s),s.x>m.x&&(m=s),s.depth>n.depth&&(n=s)});var o=l===m?1:a(l,m)/2,p=o-l.x,q=b/(m.x+o+p),r=c/(n.depth||1);j.eachBefore(function(s){s.x=(s.x+p)*q,s.y=s.depth*r})}return j}function f(j){var k=j.children,l=j.parent.children,m=j.i?l[j.i-1]:null;if(k){M4(j);var n=(k[0].z+k[k.length-1].z)/2;m?(j.z=m.z+a(j._,m._),j.m=j.z-n):j.z=n}else m&&(j.z=m.z+a(j._,m._));j.parent.A=h(j,m,j.parent.A||l[0])}function g(j){j._.x=j.z+j.parent.m,j.m+=j.parent.m}function h(j,k,l){if(k){for(var m=j,n=j,o=k,p=m.parent.children[0],q=m.m,r=n.m,s=o.m,t=p.m,w;o=Sv(o),m=Rv(m),o&&m;)p=Rv(p),n=Sv(n),n.a=j,w=o.z+s-m.z-q+a(o._,m._),w>0&&(L4(N4(o,j,l),j,w),q+=w,r+=w),s+=o.m,q+=m.m,t+=p.m,r+=n.m;o&&!Sv(n)&&(n.t=o,n.m+=s-r),m&&!Rv(p)&&(p.t=m,p.m+=q-t,l=j)}return l}function i(j){j.x*=b,j.y=j.depth*c}return e.separation=function(j){return arguments.length?(a=j,e):a},e.size=function(j){return arguments.length?(d=!1,b=+j[0],c=+j[1],e):d?null:[b,c]},e.nodeSize=function(j){return arguments.length?(d=!0,b=+j[0],c=+j[1],e):d?[b,c]:null},e}function Go(a,b,c,d,e){for(var f=a.children,g,h=-1,i=f.length,j=a.value&&(e-c)/a.value;++h<i;)g=f[h],g.x0=b,g.x1=d,g.y0=c,g.y1=c+=g.value*j}var XI=(1+Math.sqrt(5))/2;function YI(a,b,c,d,e,f){for(var g=[],h=b.children,i,j,k=0,l=0,m=h.length,n,o,p=b.value,q,r,s,t,w,v,x;k<m;){n=e-c,o=f-d;do q=h[l++].value;while(!q&&l<m);for(r=s=q,v=Math.max(o/n,n/o)/(p*a),x=q*q*v,w=Math.max(s/x,x/r);l<m;++l){q+=j=h[l].value,j<r&&(r=j),j>s&&(s=j),x=q*q*v,t=Math.max(s/x,x/r);if(t>w){q-=j;break}w=t}g.push(i={value:q,dice:n<o,children:h.slice(k,l)}),i.dice?vk(i,c,d,e,p?d+=o*q/p:f):Go(i,c,d,p?c+=n*q/p:e,f),p-=q,k=l}return g}var ZI=function a(b){function c(d,e,f,g,h){YI(b,d,e,f,g,h)}return c.ratio=function(d){return a((d=+d)>1?d:1)},c}(XI);function Q4(){var a=ZI,b=!1,c=1,d=1,e=[0],f=Gg,g=Gg,h=Gg,i=Gg,j=Gg;function k(m){return m.x0=m.y0=0,m.x1=c,m.y1=d,m.eachBefore(l),e=[0],b&&m.eachBefore(TI),m}function l(m){var n=e[m.depth],o=m.x0+n,p=m.y0+n,q=m.x1-n,r=m.y1-n;q<o&&(o=q=(o+q)/2),r<p&&(p=r=(p+r)/2),m.x0=o,m.y0=p,m.x1=q,m.y1=r,m.children&&(n=e[m.depth+1]=f(m)/2,o+=j(m)-n,p+=g(m)-n,q-=h(m)-n,r-=i(m)-n,q<o&&(o=q=(o+q)/2),r<p&&(p=r=(p+r)/2),a(m,o,p,q,r))}return k.round=function(m){return arguments.length?(b=!!m,k):b},k.size=function(m){return arguments.length?(c=+m[0],d=+m[1],k):[c,d]},k.tile=function(m){return arguments.length?(a=Eo(m),k):a},k.padding=function(m){return arguments.length?k.paddingInner(m).paddingOuter(m):k.paddingInner()},k.paddingInner=function(m){return arguments.length?(f=typeof m==="function"?m:oi(+m),k):f},k.paddingOuter=function(m){return arguments.length?k.paddingTop(m).paddingRight(m).paddingBottom(m).paddingLeft(m):k.paddingTop()},k.paddingTop=function(m){return arguments.length?(g=typeof m==="function"?m:oi(+m),k):g},k.paddingRight=function(m){return arguments.length?(h=typeof m==="function"?m:oi(+m),k):h},k.paddingBottom=function(m){return arguments.length?(i=typeof m==="function"?m:oi(+m),k):i},k.paddingLeft=function(m){return arguments.length?(j=typeof m==="function"?m:oi(+m),k):j},k}function R4(a,b,c,d,e){var f=a.children,g,h=f.length,i,j=new Array(h+1);for(j[0]=i=g=0;g<h;++g)j[g+1]=i+=f[g].value;k(0,h,a.value,b,c,d,e);function k(l,m,n,o,p,q,r){if(l>=m-1){var s=f[l];s.x0=o,s.y0=p,s.x1=q,s.y1=r;return}for(var t=j[l],w=n/2+t,v=l+1,x=m-1;v<x;){var u=v+x>>>1;j[u]<w?v=u+1:x=u}w-j[v-1]<j[v]-w&&l+1<v&&--v;var z=j[v]-t,y=n-z;if(q-o>r-p){var B=(o*y+q*z)/n;k(l,v,z,o,p,B,r),k(v,m,y,B,p,q,r)}else{var A=(p*y+r*z)/n;k(l,v,z,o,p,q,A),k(v,m,y,o,A,q,r)}}}function S4(a,b,c,d,e){(a.depth&1?Go:vk)(a,b,c,d,e)}var T4=function a(b){function c(d,e,f,g,h){if((i=d._squarify)&&i.ratio===b)for(var i,j,k,l,m=-1,n,o=i.length,p=d.value;++m<o;){for(j=i[m],k=j.children,l=j.value=0,n=k.length;l<n;++l)j.value+=k[l].value;j.dice?vk(j,e,f,g,f+=(h-f)*j.value/p):Go(j,e,f,e+=(g-e)*j.value/p,h),p-=j.value}else d._squarify=i=YI(b,d,e,f,g,h),i.ratio=b}return c.ratio=function(d){return a((d=+d)>1?d:1)},c}(XI);function Tv(a){E.call(this,null,a)}Tv.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var U4=N(Tv,E);function V4(a){return a.values}U4.transform=function(a,b){b.source||H("Nest transform requires an upstream data source.");var c=a.generate,d=a.modified(),e=b.clone(),f=this.value;return(!f||d||b.changed())&&(f&&f.each(g=>{g.children&&cm(g.data)&&e.rem.push(g.data)}),this.value=f=Ov({values:T(a.keys).reduce((g,h)=>(g.key(h),g),W4()).entries(e.source)},V4),c&&f.each(g=>{g.children&&(g=xa(g.data),e.add.push(g),e.source.push(g))}),Nv(f,aa,aa)),e.source.root=f,e};function W4(){var a=[],b;function c(e,f){if(f>=a.length)return e;for(var g=-1,h=e.length,i=a[f++],j,k,l={},m,n={};++g<h;)j=i(k=e[g])+"",(m=l[j])?m.push(k):l[j]=[k];for(j in l)n[j]=c(l[j],f);return n}function d(e,f){if(++f>a.length)return e;var g=[],h;for(h in e)g.push({key:h,values:d(e[h],f)});return g}return b={entries:e=>d(c(e,0),0),key:e=>(a.push(e),b)}}function Ee(a){E.call(this,null,a)}var X4=N(Ee,E);X4.transform=function(a,b){(!b.source||!b.source.root)&&H(this.constructor.name+" transform requires a backing tree data source.");var c=this.layout(a.method),d=this.fields,e=b.source.root,f=a.as||d;a.field?e.sum(a.field):e.count(),a.sort&&e.sort(eg(a.sort,g=>g.data)),Y4(c,this.params,a),c.separation&&c.separation(a.separation!==!1?_4:Xi);try{this.value=c(e)}catch(g){H(g)}return e.each(function(g){Z4(g,d,f)}),b.reflow(a.modified()).modifies(f).modifies("leaf")};function Y4(a,b,c){for(var d,e=0,f=b.length;e<f;++e)d=b[e],d in c&&a[d](c[d])}function Z4(a,b,c){for(var d=a.data,e=0,f=b.length-1;e<f;++e)d[c[e]]=a[b[e]];d[c[f]]=a.children?a.children.length:0}function _4(a,b){return a.parent===b.parent?1:2}var Uv=["x","y","r","depth","children"];function Vv(a){Ee.call(this,a)}Vv.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Uv.length,default:Uv}]};var Wv=N(Vv,Ee);Wv.layout=F4,Wv.params=["radius","size","padding"],Wv.fields=Uv;var Xv=["x0","y0","x1","y1","depth","children"];function Yv(a){Ee.call(this,a)}Yv.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Xv.length,default:Xv}]};var Zv=N(Yv,Ee);Zv.layout=G4,Zv.params=["size","round","padding"],Zv.fields=Xv;function _v(a){E.call(this,null,a)}_v.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};var $4=N(_v,E);$4.transform=function(a,b){b.source||H("Stratify transform requires an upstream data source.");var c=this.value,d=a.modified(),e=b.fork(b.ALL).materialize(b.SOURCE),f=!this.value||d||b.changed(b.ADD_REM)||b.modified(a.key.fields)||b.modified(a.parentKey.fields);return e.source=e.source.slice(),f&&(e.source.length?c=Nv(WI().id(a.key).parentId(a.parentKey)(e.source),a.key,Gd):c=Nv(WI()([{}]),a.key,a.key)),e.source.root=this.value=c,e};var _I={tidy:P4,cluster:f4},$v=["x","y","depth","children"];function aw(a){Ee.call(this,a)}aw.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:$v.length,default:$v}]};var bw=N(aw,Ee);bw.layout=function(a){var b=a||"tidy";if(_(_I,b))return _I[b]();H("Unrecognized Tree layout method: "+b)},bw.params=["size","nodeSize"],bw.fields=$v;function cw(a){E.call(this,[],a)}cw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};var a5=N(cw,E);a5.transform=function(a,b){var c=this.value,d=b.source&&b.source.root,e=b.fork(b.NO_SOURCE),f={};return d||H("TreeLinks transform requires a tree data source."),b.changed(b.ADD_REM)?(e.rem=c,b.visit(b.SOURCE,function(g){f[aa(g)]=1}),d.each(function(g){var h=g.data,i=g.parent&&g.parent.data;i&&f[aa(h)]&&f[aa(i)]&&e.add.push(xa({source:i,target:h}))}),this.value=e.add):b.changed(b.MOD)&&(b.visit(b.MOD,function(g){f[aa(g)]=1}),c.forEach(function(g){(f[aa(g.source)]||f[aa(g.target)])&&e.mod.push(g)})),e};var $I={binary:R4,dice:vk,slice:Go,slicedice:S4,squarify:ZI,resquarify:T4},dw=["x0","y0","x1","y1","depth","children"];function ew(a){Ee.call(this,a)}ew.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:dw.length,default:dw}]};var fw=N(ew,Ee);fw.layout=function(){var a=Q4();return a.ratio=function(b){var c=a.tile();c.ratio&&a.tile(c.ratio(b))},a.method=function(b){_($I,b)?a.tile($I[b]):H("Unrecognized Treemap layout method: "+b)},a},fw.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fw.fields=dw;var b5=Object.freeze({__proto__:null,nest:Tv,pack:Vv,partition:Yv,stratify:_v,tree:aw,treelinks:cw,treemap:ew});function aJ(a,b){var c=[],d=function(k){return k(h)},e,f,g,h,i,j;if(b==null)c.push(a);else for(e={},f=0,g=a.length;f<g;++f)h=a[f],i=b.map(d),j=e[i],j||(e[i]=j=[],j.dims=i,c.push(j)),j.push(h);return c}function gw(a){E.call(this,null,a)}gw.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};var c5=N(gw,E);c5.transform=function(a,b){var c=b.fork(b.NO_SOURCE|b.NO_FIELDS);if(!this.value||b.changed()||a.modified()){const d=b.materialize(b.SOURCE).source,e=aJ(d,a.groupby),f=(a.groupby||[]).map(_a),g=f.length,h=a.as||[_a(a.x),_a(a.y)],i=[];e.forEach(j=>{oC(j,a.x,a.y,a.bandwidth||.3).forEach(k=>{const l={};for(let m=0;m<g;++m)l[f[m]]=j.dims[m];l[h[0]]=k[0],l[h[1]]=k[1],i.push(xa(l))})}),this.value&&(c.rem=this.value),this.value=c.add=c.source=i}return c};const hw={linear:fs,log:iC,exp:jC,pow:kC,quad:gs,poly:lC};function d5(a,b){return a==="poly"?b:a==="quad"?2:1}function iw(a){E.call(this,null,a)}iw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(hw)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};var e5=N(iw,E);e5.transform=function(a,b){var c=b.fork(b.NO_SOURCE|b.NO_FIELDS);if(!this.value||b.changed()||a.modified()){const d=b.materialize(b.SOURCE).source,e=aJ(d,a.groupby),f=(a.groupby||[]).map(_a),g=a.method||"linear",h=a.order||3,i=d5(g,h),j=a.as||[_a(a.x),_a(a.y)],k=hw[g],l=[];let m=a.extent;_(hw,g)||H("Invalid regression method: "+g),m!=null&&(g==="log"&&m[0]<=0&&(b.dataflow.warn("Ignoring extent with values <= 0 for log regression."),m=null)),e.forEach(n=>{const o=n.length;if(o<=i){b.dataflow.warn("Skipping regression with more parameters than data points.");return}const p=k(n,a.x,a.y,h);if(a.params){l.push(xa({keys:n.dims,coef:p.coef,rSquared:p.rSquared}));return}const q=m||pe(n,a.x),r=s=>{const t={};for(let w=0;w<f.length;++w)t[f[w]]=n.dims[w];t[j[0]]=s[0],t[j[1]]=s[1],l.push(xa(t))};g==="linear"?q.forEach(s=>r([s,p.predict(s)])):Cm(p.predict,q,25,200).forEach(r)}),this.value&&(c.rem=this.value),this.value=c.add=c.source=l}return c};var f5=Object.freeze({__proto__:null,loess:gw,regression:iw});const bJ=Math.pow(2,-52),Ho=new Uint32Array(512);class jw{static from(a,b=k5,c=l5){const d=a.length,e=new Float64Array(d*2);for(let f=0;f<d;f++){const g=a[f];e[2*f]=b(g),e[2*f+1]=c(g)}return new jw(e)}constructor(a){const b=a.length>>1;if(b>0&&typeof a[0]!=="number")throw new Error("Expected coords to contain numbers.");this.coords=a;const c=Math.max(2*b-5,0);this._triangles=new Uint32Array(c*3),this._halfedges=new Int32Array(c*3),this._hashSize=Math.ceil(Math.sqrt(b)),this._hullPrev=new Uint32Array(b),this._hullNext=new Uint32Array(b),this._hullTri=new Uint32Array(b),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(b),this._dists=new Float64Array(b),this.update()}update(){const{coords:a,_hullPrev:b,_hullNext:c,_hullTri:d,_hullHash:e}=this,f=a.length>>1;let g=Infinity,h=Infinity,i=-Infinity,j=-Infinity;for(let y=0;y<f;y++){const B=a[2*y],A=a[2*y+1];B<g&&(g=B),A<h&&(h=A),B>i&&(i=B),A>j&&(j=A),this._ids[y]=y}const k=(g+i)/2,l=(h+j)/2;let m=Infinity,n,o,p;for(let y=0;y<f;y++){const B=kw(k,l,a[2*y],a[2*y+1]);B<m&&(n=y,m=B)}const q=a[2*n],r=a[2*n+1];m=Infinity;for(let y=0;y<f;y++){if(y===n)continue;const B=kw(q,r,a[2*y],a[2*y+1]);B<m&&B>0&&(o=y,m=B)}let s=a[2*o],t=a[2*o+1],w=Infinity;for(let y=0;y<f;y++){if(y===n||y===o)continue;const B=i5(q,r,s,t,a[2*y],a[2*y+1]);B<w&&(p=y,w=B)}let v=a[2*p],x=a[2*p+1];if(w===Infinity){for(let A=0;A<f;A++)this._dists[A]=a[2*A]-a[0]||a[2*A+1]-a[1];pi(this._ids,this._dists,0,f-1);const y=new Uint32Array(f);let B=0;for(let A=0,C=-Infinity;A<f;A++){const F=this._ids[A];this._dists[F]>C&&(y[B++]=F,C=this._dists[F])}this.hull=y.subarray(0,B),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Io(q,r,s,t,v,x)){const y=o,B=s,A=t;o=p,s=v,t=x,p=y,v=B,x=A}const u=j5(q,r,s,t,v,x);this._cx=u.x,this._cy=u.y;for(let y=0;y<f;y++)this._dists[y]=kw(a[2*y],a[2*y+1],u.x,u.y);pi(this._ids,this._dists,0,f-1),this._hullStart=n;let z=3;c[n]=b[p]=o,c[o]=b[n]=p,c[p]=b[o]=n,d[n]=0,d[o]=1,d[p]=2,e.fill(-1),e[this._hashKey(q,r)]=n,e[this._hashKey(s,t)]=o,e[this._hashKey(v,x)]=p,this.trianglesLen=0,this._addTriangle(n,o,p,-1,-1,-1);for(let y=0,B,A;y<this._ids.length;y++){const C=this._ids[y],F=a[2*C],K=a[2*C+1];if(y>0&&Math.abs(F-B)<=bJ&&Math.abs(K-A)<=bJ)continue;B=F,A=K;if(C===n||C===o||C===p)continue;let D=0;for(let wa=0,Qa=this._hashKey(F,K);wa<this._hashSize;wa++){D=e[(Qa+wa)%this._hashSize];if(D!==-1&&D!==c[D])break}D=b[D];let I=D,S;for(;S=c[I],!Io(F,K,a[2*I],a[2*I+1],a[2*S],a[2*S+1]);){I=S;if(I===D){I=-1;break}}if(I===-1)continue;let X=this._addTriangle(I,C,c[I],-1,-1,d[I]);d[C]=this._legalize(X+2),d[I]=X,z++;let Y=c[I];for(;S=c[Y],Io(F,K,a[2*Y],a[2*Y+1],a[2*S],a[2*S+1]);)X=this._addTriangle(Y,C,S,d[C],-1,d[Y]),d[C]=this._legalize(X+2),c[Y]=Y,z--,Y=S;if(I===D)for(;S=b[I],Io(F,K,a[2*S],a[2*S+1],a[2*I],a[2*I+1]);)X=this._addTriangle(S,C,I,-1,d[I],d[S]),this._legalize(X+2),d[S]=X,c[I]=I,z--,I=S;this._hullStart=b[C]=I,c[I]=b[Y]=C,c[C]=Y,e[this._hashKey(F,K)]=C,e[this._hashKey(a[2*I],a[2*I+1])]=I}this.hull=new Uint32Array(z);for(let y=0,B=this._hullStart;y<z;y++)this.hull[y]=B,B=c[B];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(a,b){return Math.floor(g5(a-this._cx,b-this._cy)*this._hashSize)%this._hashSize}_legalize(a){const{_triangles:b,_halfedges:c,coords:d}=this;let e=0,f=0;for(;;){const g=c[a],h=a-a%3;f=h+(a+2)%3;if(g===-1){if(e===0)break;a=Ho[--e];continue}const i=g-g%3,j=h+(a+1)%3,k=i+(g+2)%3,l=b[f],m=b[a],n=b[j],o=b[k],p=h5(d[2*l],d[2*l+1],d[2*m],d[2*m+1],d[2*n],d[2*n+1],d[2*o],d[2*o+1]);if(p){b[a]=o,b[g]=l;const q=c[k];if(q===-1){let s=this._hullStart;do{if(this._hullTri[s]===k){this._hullTri[s]=a;break}s=this._hullPrev[s]}while(s!==this._hullStart)}this._link(a,q),this._link(g,c[f]),this._link(f,k);const r=i+(g+1)%3;e<Ho.length&&(Ho[e++]=r)}else{if(e===0)break;a=Ho[--e]}}return f}_link(a,b){this._halfedges[a]=b,b!==-1&&(this._halfedges[b]=a)}_addTriangle(a,b,c,d,e,f){const g=this.trianglesLen;return this._triangles[g]=a,this._triangles[g+1]=b,this._triangles[g+2]=c,this._link(g,d),this._link(g+1,e),this._link(g+2,f),this.trianglesLen+=3,g}}function g5(a,b){const c=a/(Math.abs(a)+Math.abs(b));return(b>0?3-c:1+c)/4}function kw(a,b,c,d){const e=a-c,f=b-d;return e*e+f*f}function lw(a,b,c,d,e,f){const g=(d-b)*(e-a),h=(c-a)*(f-b);return Math.abs(g-h)>=33306690738754716e-32*Math.abs(g+h)?g-h:0}function Io(a,b,c,d,e,f){const g=lw(e,f,a,b,c,d)||lw(a,b,c,d,e,f)||lw(c,d,e,f,a,b);return g<0}function h5(a,b,c,d,e,f,g,h){const i=a-g,j=b-h,k=c-g,l=d-h,m=e-g,n=f-h,o=i*i+j*j,p=k*k+l*l,q=m*m+n*n;return i*(l*q-p*n)-j*(k*q-p*m)+o*(k*n-l*m)<0}function i5(a,b,c,d,e,f){const g=c-a,h=d-b,i=e-a,j=f-b,k=g*g+h*h,l=i*i+j*j,m=.5/(g*j-h*i),n=(j*k-h*l)*m,o=(g*l-i*k)*m;return n*n+o*o}function j5(a,b,c,d,e,f){const g=c-a,h=d-b,i=e-a,j=f-b,k=g*g+h*h,l=i*i+j*j,m=.5/(g*j-h*i),n=a+(j*k-h*l)*m,o=b+(g*l-i*k)*m;return{x:n,y:o}}function pi(a,b,c,d){if(d-c<=20)for(let e=c+1;e<=d;e++){const f=a[e],g=b[f];let h=e-1;for(;h>=c&&b[a[h]]>g;)a[h+1]=a[h--];a[h+1]=f}else{const e=c+d>>1;let f=c+1,g=d;wk(a,e,f),b[a[c]]>b[a[d]]&&wk(a,c,d),b[a[f]]>b[a[d]]&&wk(a,f,d),b[a[c]]>b[a[f]]&&wk(a,c,f);const h=a[f],i=b[h];for(;;){do f++;while(b[a[f]]<i);do g--;while(b[a[g]]>i);if(g<f)break;wk(a,f,g)}a[c+1]=a[g],a[g]=h,d-f+1>=g-c?(pi(a,b,f,d),pi(a,b,c,g-1)):(pi(a,b,c,g-1),pi(a,b,f,d))}}function wk(a,b,c){const d=a[b];a[b]=a[c],a[c]=d}function k5(a){return a[0]}function l5(a){return a[1]}const cJ=1e-6;class Hg{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(a,b){this._+=`M${this._x0=this._x1=+a},${this._y0=this._y1=+b}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(a,b){this._+=`L${this._x1=+a},${this._y1=+b}`}arc(a,b,c){a=+a,b=+b,c=+c;const d=a+c,e=b;if(c<0)throw new Error("negative radius");this._x1===null?this._+=`M${d},${e}`:(Math.abs(this._x1-d)>cJ||Math.abs(this._y1-e)>cJ)&&(this._+="L"+d+","+e);if(!c)return;this._+=`A${c},${c},0,1,1,${a-c},${b}A${c},${c},0,1,1,${this._x1=d},${this._y1=e}`}rect(a,b,c,d){this._+=`M${this._x0=this._x1=+a},${this._y0=this._y1=+b}h${+c}v${+d}h${-c}Z`}value(){return this._||null}}class mw{constructor(){this._=[]}moveTo(a,b){this._.push([a,b])}closePath(){this._.push(this._[0].slice())}lineTo(a,b){this._.push([a,b])}value(){return this._.length?this._:null}}class m5{constructor(a,[b,c,d,e]=[0,0,960,500]){if(!((d=+d)>=(b=+b))||!((e=+e)>=(c=+c)))throw new Error("invalid bounds");this.delaunay=a,this._circumcenters=new Float64Array(a.points.length*2),this.vectors=new Float64Array(a.points.length*2),this.xmax=d,this.xmin=b,this.ymax=e,this.ymin=c,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:a,hull:b,triangles:c},vectors:d}=this,e=this.circumcenters=this._circumcenters.subarray(0,c.length/3*2);for(let m=0,n=0,o=c.length,p,q;m<o;m+=3,n+=2){const r=c[m]*2,s=c[m+1]*2,t=c[m+2]*2,w=a[r],v=a[r+1],x=a[s],u=a[s+1],z=a[t],y=a[t+1],B=x-w,A=u-v,C=z-w,F=y-v,K=B*B+A*A,D=C*C+F*F,I=(B*F-A*C)*2;if(!I)p=(w+z)/2-1e8*F,q=(v+y)/2+1e8*C;else if(Math.abs(I)<1e-8)p=(w+z)/2,q=(v+y)/2;else{const S=1/I;p=w+(F*K-A*D)*S,q=v+(B*D-C*K)*S}e[n]=p,e[n+1]=q}let f=b[b.length-1],g,h=f*4,i,j=a[2*f],k,l=a[2*f+1];d.fill(0);for(let m=0;m<b.length;++m)f=b[m],g=h,i=j,k=l,h=f*4,j=a[2*f],l=a[2*f+1],d[g+2]=d[h]=k-l,d[g+3]=d[h+1]=j-i}render(a){const b=a==null?a=new Hg():void 0,{delaunay:{halfedges:c,inedges:d,hull:e},circumcenters:f,vectors:g}=this;if(e.length<=1)return null;for(let j=0,k=c.length;j<k;++j){const l=c[j];if(l<j)continue;const m=Math.floor(j/3)*2,n=Math.floor(l/3)*2,o=f[m],p=f[m+1],q=f[n],r=f[n+1];this._renderSegment(o,p,q,r,a)}let h,i=e[e.length-1];for(let j=0;j<e.length;++j){h=i,i=e[j];const k=Math.floor(d[i]/3)*2,l=f[k],m=f[k+1],n=h*4,o=this._project(l,m,g[n+2],g[n+3]);o&&this._renderSegment(l,m,o[0],o[1],a)}return b&&b.value()}renderBounds(a){const b=a==null?a=new Hg():void 0;return a.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),b&&b.value()}renderCell(a,b){const c=b==null?b=new Hg():void 0,d=this._clip(a);if(d===null||!d.length)return;b.moveTo(d[0],d[1]);let e=d.length;for(;d[0]===d[e-2]&&d[1]===d[e-1]&&e>1;)e-=2;for(let f=2;f<e;f+=2)(d[f]!==d[f-2]||d[f+1]!==d[f-1])&&b.lineTo(d[f],d[f+1]);return b.closePath(),c&&c.value()}*cellPolygons(){const{delaunay:{points:a}}=this;for(let b=0,c=a.length/2;b<c;++b){const d=this.cellPolygon(b);d&&(d.index=b,yield d)}}cellPolygon(a){const b=new mw();return this.renderCell(a,b),b.value()}_renderSegment(a,b,c,d,e){let f;const g=this._regioncode(a,b),h=this._regioncode(c,d);g===0&&h===0?(e.moveTo(a,b),e.lineTo(c,d)):(f=this._clipSegment(a,b,c,d,g,h))&&(e.moveTo(f[0],f[1]),e.lineTo(f[2],f[3]))}contains(a,b,c){return(b=+b,b!==b)||(c=+c,c!==c)?!1:this.delaunay._step(a,b,c)===a}*neighbors(a){const b=this._clip(a);if(b)for(const c of this.delaunay.neighbors(a)){const d=this._clip(c);if(d)Ve:for(let e=0,f=b.length;e<f;e+=2)for(let g=0,h=d.length;g<h;g+=2)if(b[e]==d[g]&&b[e+1]==d[g+1]&&b[(e+2)%f]==d[(g+h-2)%h]&&b[(e+3)%f]==d[(g+h-1)%h]){yield c;break Ve}}}_cell(a){const{circumcenters:b,delaunay:{inedges:c,halfedges:d,triangles:e}}=this,f=c[a];if(f===-1)return null;const g=[];let h=f;do{const i=Math.floor(h/3);g.push(b[i*2],b[i*2+1]),h=h%3===2?h-2:h+1;if(e[h]!==a)break;h=d[h]}while(h!==f&&h!==-1);return g}_clip(a){if(a===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const b=this._cell(a);if(b===null)return null;const{vectors:c}=this,d=a*4;return c[d]||c[d+1]?this._clipInfinite(a,b,c[d],c[d+1],c[d+2],c[d+3]):this._clipFinite(a,b)}_clipFinite(a,b){const c=b.length;let d=null,e,f,g=b[c-2],h=b[c-1],i,j=this._regioncode(g,h),k,l;for(let m=0;m<c;m+=2){e=g,f=h,g=b[m],h=b[m+1],i=j,j=this._regioncode(g,h);if(i===0&&j===0)k=l,l=0,d?d.push(g,h):d=[g,h];else{let n,o,p,q,r;if(i===0){if((n=this._clipSegment(e,f,g,h,i,j))===null)continue;[o,p,q,r]=n}else{if((n=this._clipSegment(g,h,e,f,j,i))===null)continue;[q,r,o,p]=n,k=l,l=this._edgecode(o,p),k&&l&&this._edge(a,k,l,d,d.length),d?d.push(o,p):d=[o,p]}k=l,l=this._edgecode(q,r),k&&l&&this._edge(a,k,l,d,d.length),d?d.push(q,r):d=[q,r]}}if(d)k=l,l=this._edgecode(d[0],d[1]),k&&l&&this._edge(a,k,l,d,d.length);else if(this.contains(a,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return d}_clipSegment(a,b,c,d,e,f){for(;;){if(e===0&&f===0)return[a,b,c,d];if(e&f)return null;let g,h,i=e||f;i&8?(g=a+(c-a)*(this.ymax-b)/(d-b),h=this.ymax):i&4?(g=a+(c-a)*(this.ymin-b)/(d-b),h=this.ymin):i&2?(h=b+(d-b)*(this.xmax-a)/(c-a),g=this.xmax):(h=b+(d-b)*(this.xmin-a)/(c-a),g=this.xmin),e?(a=g,b=h,e=this._regioncode(a,b)):(c=g,d=h,f=this._regioncode(c,d))}}_clipInfinite(a,b,c,d,e,f){let g=Array.from(b),h;(h=this._project(g[0],g[1],c,d))&&g.unshift(h[0],h[1]),(h=this._project(g[g.length-2],g[g.length-1],e,f))&&g.push(h[0],h[1]);if(g=this._clipFinite(a,g))for(let i=0,j=g.length,k,l=this._edgecode(g[j-2],g[j-1]);i<j;i+=2)k=l,l=this._edgecode(g[i],g[i+1]),k&&l&&(i=this._edge(a,k,l,g,i),j=g.length);else this.contains(a,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(g=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return g}_edge(a,b,c,d,e){for(;b!==c;){let f,g;switch(b){case 5:b=4;continue;case 4:b=6,f=this.xmax,g=this.ymin;break;case 6:b=2;continue;case 2:b=10,f=this.xmax,g=this.ymax;break;case 10:b=8;continue;case 8:b=9,f=this.xmin,g=this.ymax;break;case 9:b=1;continue;case 1:b=5,f=this.xmin,g=this.ymin;break}(d[e]!==f||d[e+1]!==g)&&this.contains(a,f,g)&&(d.splice(e,0,f,g),e+=2)}if(d.length>4)for(let f=0;f<d.length;f+=2){const g=(f+2)%d.length,h=(f+4)%d.length;(d[f]===d[g]&&d[g]===d[h]||d[f+1]===d[g+1]&&d[g+1]===d[h+1])&&(d.splice(g,2),f-=2)}return e}_project(a,b,c,d){let e=Infinity,f,g,h;if(d<0){if(b<=this.ymin)return null;(f=(this.ymin-b)/d)<e&&(h=this.ymin,g=a+(e=f)*c)}else if(d>0){if(b>=this.ymax)return null;(f=(this.ymax-b)/d)<e&&(h=this.ymax,g=a+(e=f)*c)}if(c>0){if(a>=this.xmax)return null;(f=(this.xmax-a)/c)<e&&(g=this.xmax,h=b+(e=f)*d)}else if(c<0){if(a<=this.xmin)return null;(f=(this.xmin-a)/c)<e&&(g=this.xmin,h=b+(e=f)*d)}return[g,h]}_edgecode(a,b){return(a===this.xmin?1:a===this.xmax?2:0)|(b===this.ymin?4:b===this.ymax?8:0)}_regioncode(a,b){return(a<this.xmin?1:a>this.xmax?2:0)|(b<this.ymin?4:b>this.ymax?8:0)}}const n5=2*Math.PI,qi=Math.pow;function o5(a){return a[0]}function p5(a){return a[1]}function q5(a){const{triangles:b,coords:c}=a;for(let d=0;d<b.length;d+=3){const e=2*b[d],f=2*b[d+1],g=2*b[d+2],h=(c[g]-c[e])*(c[f+1]-c[e+1])-(c[f]-c[e])*(c[g+1]-c[e+1]);if(h>1e-10)return!1}return!0}function r5(a,b,c){return[a+Math.sin(a+b)*c,b+Math.cos(a-b)*c]}class dJ{static from(a,b=o5,c=p5,d){return new dJ("length"in a?s5(a,b,c,d):Float64Array.from(t5(a,b,c,d)))}constructor(a){this._delaunator=new jw(a),this.inedges=new Int32Array(a.length/2),this._hullIndex=new Int32Array(a.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const a=this._delaunator,b=this.points;if(a.hull&&a.hull.length>2&&q5(a)){this.collinear=Int32Array.from({length:b.length/2},(l,m)=>m).sort((l,m)=>b[2*l]-b[2*m]||b[2*l+1]-b[2*m+1]);const h=this.collinear[0],i=this.collinear[this.collinear.length-1],j=[b[2*h],b[2*h+1],b[2*i],b[2*i+1]],k=1e-8*Math.hypot(j[3]-j[1],j[2]-j[0]);for(let l=0,m=b.length/2;l<m;++l){const n=r5(b[2*l],b[2*l+1],k);b[2*l]=n[0],b[2*l+1]=n[1]}this._delaunator=new jw(b)}else delete this.collinear;const c=this.halfedges=this._delaunator.halfedges,d=this.hull=this._delaunator.hull,e=this.triangles=this._delaunator.triangles,f=this.inedges.fill(-1),g=this._hullIndex.fill(-1);for(let h=0,i=c.length;h<i;++h){const j=e[h%3===2?h-2:h+1];(c[h]===-1||f[j]===-1)&&(f[j]=h)}for(let h=0,i=d.length;h<i;++h)g[d[h]]=h;d.length<=2&&d.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=d[0],this.triangles[1]=d[1],this.triangles[2]=d[1],f[d[0]]=1,d.length===2&&(f[d[1]]=0))}voronoi(a){return new m5(this,a)}*neighbors(a){const{inedges:b,hull:c,_hullIndex:d,halfedges:e,triangles:f,collinear:g}=this;if(g){const k=g.indexOf(a);k>0&&(yield g[k-1]),k<g.length-1&&(yield g[k+1]);return}const h=b[a];if(h===-1)return;let i=h,j=-1;do{yield j=f[i],i=i%3===2?i-2:i+1;if(f[i]!==a)return;i=e[i];if(i===-1){const k=c[(d[a]+1)%c.length];k!==j&&(yield k);return}}while(i!==h)}find(a,b,c=0){if((a=+a,a!==a)||(b=+b,b!==b))return-1;const d=c;let e;for(;(e=this._step(c,a,b))>=0&&e!==c&&e!==d;)c=e;return e}_step(a,b,c){const{inedges:d,hull:e,_hullIndex:f,halfedges:g,triangles:h,points:i}=this;if(d[a]===-1||!i.length)return(a+1)%(i.length>>1);let j=a,k=qi(b-i[a*2],2)+qi(c-i[a*2+1],2);const l=d[a];let m=l;do{let n=h[m];const o=qi(b-i[n*2],2)+qi(c-i[n*2+1],2);o<k&&(k=o,j=n),m=m%3===2?m-2:m+1;if(h[m]!==a)break;m=g[m];if(m===-1){m=e[(f[a]+1)%e.length];if(m!==n){if(qi(b-i[m*2],2)+qi(c-i[m*2+1],2)<k)return m}break}}while(m!==l);return j}render(a){const b=a==null?a=new Hg():void 0,{points:c,halfedges:d,triangles:e}=this;for(let f=0,g=d.length;f<g;++f){const h=d[f];if(h<f)continue;const i=e[f]*2,j=e[h]*2;a.moveTo(c[i],c[i+1]),a.lineTo(c[j],c[j+1])}return this.renderHull(a),b&&b.value()}renderPoints(a,b=2){const c=a==null?a=new Hg():void 0,{points:d}=this;for(let e=0,f=d.length;e<f;e+=2){const g=d[e],h=d[e+1];a.moveTo(g+b,h),a.arc(g,h,b,0,n5)}return c&&c.value()}renderHull(a){const b=a==null?a=new Hg():void 0,{hull:c,points:d}=this,e=c[0]*2,f=c.length;a.moveTo(d[e],d[e+1]);for(let g=1;g<f;++g){const h=2*c[g];a.lineTo(d[h],d[h+1])}return a.closePath(),b&&b.value()}hullPolygon(){const a=new mw();return this.renderHull(a),a.value()}renderTriangle(a,b){const c=b==null?b=new Hg():void 0,{points:d,triangles:e}=this,f=e[a*=3]*2,g=e[a+1]*2,h=e[a+2]*2;return b.moveTo(d[f],d[f+1]),b.lineTo(d[g],d[g+1]),b.lineTo(d[h],d[h+1]),b.closePath(),c&&c.value()}*trianglePolygons(){const{triangles:a}=this;for(let b=0,c=a.length/3;b<c;++b)yield this.trianglePolygon(b)}trianglePolygon(a){const b=new mw();return this.renderTriangle(a,b),b.value()}}function s5(a,b,c,d){const e=a.length,f=new Float64Array(e*2);for(let g=0;g<e;++g){const h=a[g];f[g*2]=b.call(d,h,g,a),f[g*2+1]=c.call(d,h,g,a)}return f}function*t5(a,b,c,d){let e=0;for(const f of a)yield b.call(d,f,e,a),yield c.call(d,f,e,a),++e}function nw(a){E.call(this,null,a)}nw.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const u5=N(nw,E),v5=[-1e5,-1e5,1e5,1e5];u5.transform=function(a,b){const c=a.as||"path",d=b.source;if(!d||!d.length)return b;let e=a.size;e=e?[0,0,e[0],e[1]]:(e=a.extent)?[e[0][0],e[0][1],e[1][0],e[1][1]]:v5;const f=this.value=dJ.from(d,a.x,a.y).voronoi(e);for(let g=0,h=d.length;g<h;++g){const i=f.cellPolygon(g);d[g][c]=i?w5(i):null}return b.reflow(a.modified()).modifies(c)};function w5(a){const b=a[0][0],c=a[0][1];let d=a.length-1;for(;a[d][0]===b&&a[d][1]===c;--d);return"M"+a.slice(0,d+1).join("L")+"Z"}var x5=Object.freeze({__proto__:null,voronoi:nw}),ow=Math.PI/180,xk=1<<11>>5,Jo=1<<11;function y5(){var a=[256,256],b,c,d,e,f,g,h,i=eJ,j=[],k=Math.random,l={};l.layout=function(){for(var o=m(Aj()),p=E5((a[0]>>5)*a[1]),q=null,r=j.length,s=-1,t=[],w=j.map(function(x){return{text:b(x),font:c(x),style:e(x),weight:f(x),rotate:g(x),size:~~(d(x)+1e-14),padding:h(x),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:x}}).sort(function(x,u){return u.size-x.size});++s<r;){var v=w[s];v.x=a[0]*(k()+.5)>>1,v.y=a[1]*(k()+.5)>>1,z5(o,v,w,s),v.hasText&&n(p,v,q)&&(t.push(v),q?B5(q,v):q=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=a[0]>>1,v.y-=a[1]>>1)}return t};function m(o){o.width=o.height=1;var p=Math.sqrt(o.getContext("2d").getImageData(0,0,1,1).data.length>>2);o.width=(xk<<5)/p,o.height=Jo/p;var q=o.getContext("2d");return q.fillStyle=q.strokeStyle="red",q.textAlign="center",{context:q,ratio:p}}function n(o,p,q){for(var r=p.x,s=p.y,t=Math.sqrt(a[0]*a[0]+a[1]*a[1]),w=i(a),v=k()<.5?1:-1,x=-v,u,z,y;u=w(x+=v);){z=~~u[0],y=~~u[1];if(Math.min(Math.abs(z),Math.abs(y))>=t)break;p.x=r+z,p.y=s+y;if(p.x+p.x0<0||p.y+p.y0<0||p.x+p.x1>a[0]||p.y+p.y1>a[1])continue;if(!q||!A5(p,o,a[0])){if(!q||C5(p,q)){for(var B=p.sprite,A=p.width>>5,C=a[0]>>5,F=p.x-(A<<4),K=F&127,D=32-K,I=p.y1-p.y0,S=(p.y+p.y0)*C+(F>>5),X,Y=0;Y<I;Y++){X=0;for(var wa=0;wa<=A;wa++)o[S+wa]|=X<<D|(wa<A?(X=B[Y*A+wa])>>>K:0);S+=C}return p.sprite=null,!0}}}return!1}return l.words=function(o){return arguments.length?(j=o,l):j},l.size=function(o){return arguments.length?(a=[+o[0],+o[1]],l):a},l.font=function(o){return arguments.length?(c=Ig(o),l):c},l.fontStyle=function(o){return arguments.length?(e=Ig(o),l):e},l.fontWeight=function(o){return arguments.length?(f=Ig(o),l):f},l.rotate=function(o){return arguments.length?(g=Ig(o),l):g},l.text=function(o){return arguments.length?(b=Ig(o),l):b},l.spiral=function(o){return arguments.length?(i=F5[o]||o,l):i},l.fontSize=function(o){return arguments.length?(d=Ig(o),l):d},l.padding=function(o){return arguments.length?(h=Ig(o),l):h},l.random=function(o){return arguments.length?(k=o,l):k},l}function z5(a,b,c,d){if(b.sprite)return;var e=a.context,f=a.ratio;e.clearRect(0,0,(xk<<5)/f,Jo/f);var g=0,h=0,i=0,j=c.length,k,l,m,n,o;for(--d;++d<j;){b=c[d],e.save(),e.font=b.style+" "+b.weight+" "+~~((b.size+1)/f)+"px "+b.font,k=e.measureText(b.text+"m").width*f,m=b.size<<1;if(b.rotate){var p=Math.sin(b.rotate*ow),q=Math.cos(b.rotate*ow),r=k*q,s=k*p,t=m*q,w=m*p;k=Math.max(Math.abs(r+w),Math.abs(r-w))+31>>5<<5,m=~~Math.max(Math.abs(s+t),Math.abs(s-t))}else k=k+31>>5<<5;m>i&&(i=m),g+k>=xk<<5&&(g=0,h+=i,i=0);if(h+m>=Jo)break;e.translate((g+(k>>1))/f,(h+(m>>1))/f),b.rotate&&e.rotate(b.rotate*ow),e.fillText(b.text,0,0),b.padding&&(e.lineWidth=2*b.padding,e.strokeText(b.text,0,0)),e.restore(),b.width=k,b.height=m,b.xoff=g,b.yoff=h,b.x1=k>>1,b.y1=m>>1,b.x0=-b.x1,b.y0=-b.y1,b.hasText=!0,g+=k}for(var v=e.getImageData(0,0,(xk<<5)/f,Jo/f).data,x=[];--d>=0;){b=c[d];if(!b.hasText)continue;for(k=b.width,l=k>>5,m=b.y1-b.y0,n=0;n<m*l;n++)x[n]=0;g=b.xoff;if(g==null)return;h=b.yoff;var u=0,z=-1;for(o=0;o<m;o++){for(n=0;n<k;n++){var y=l*o+(n>>5),B=v[(h+o)*(xk<<5)+(g+n)<<2]?1<<31-n%32:0;x[y]|=B,u|=B}u?z=o:(b.y0++,m--,o--,h++)}b.y1=b.y0+z,b.sprite=x.slice(0,(b.y1-b.y0)*l)}}function A5(a,b,c){c>>=5;for(var d=a.sprite,e=a.width>>5,f=a.x-(e<<4),g=f&127,h=32-g,i=a.y1-a.y0,j=(a.y+a.y0)*c+(f>>5),k,l=0;l<i;l++){k=0;for(var m=0;m<=e;m++)if((k<<h|(m<e?(k=d[l*e+m])>>>g:0))&b[j+m])return!0;j+=c}return!1}function B5(a,b){var c=a[0],d=a[1];b.x+b.x0<c.x&&(c.x=b.x+b.x0),b.y+b.y0<c.y&&(c.y=b.y+b.y0),b.x+b.x1>d.x&&(d.x=b.x+b.x1),b.y+b.y1>d.y&&(d.y=b.y+b.y1)}function C5(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function eJ(a){var b=a[0]/a[1];return function(c){return[b*(c*=.1)*Math.cos(c),c*Math.sin(c)]}}function D5(a){var b=4,c=b*a[0]/a[1],d=0,e=0;return function(f){var g=f<0?-1:1;switch(Math.sqrt(1+4*g*f)-g&3){case 0:d+=c;break;case 1:e+=b;break;case 2:d-=c;break;default:e-=b;break}return[d,e]}}function E5(a){for(var b=[],c=-1;++c<a;)b[c]=0;return b}function Ig(a){return typeof a==="function"?a:function(){return a}}var F5={archimedean:eJ,rectangular:D5},fJ=["x","y","font","fontSize","fontStyle","fontWeight","angle"],G5=["text","font","rotate","fontSize","fontStyle","fontWeight"];function pw(a){E.call(this,y5(),a)}pw.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:fJ}]};var H5=N(pw,E);H5.transform=function(a,b){a.size&&!(a.size[0]&&a.size[1])&&H("Wordcloud size dimensions must be non-zero.");function c(t){var w=a[t];return pa(w)&&b.modified(w.fields)}var d=a.modified();if(!(d||b.changed(b.ADD_REM)||G5.some(c)))return;var e=b.materialize(b.SOURCE).source,f=this.value,g=a.as||fJ,h=a.fontSize||14,i;pa(h)?i=a.fontSizeRange:h=Vb(h);if(i){var j=h,k=va("sqrt")().domain(pe(e,j)).range(i);h=function(t){return k(j(t))}}e.forEach(function(t){t[g[0]]=NaN,t[g[1]]=NaN,t[g[3]]=0});for(var l=f.words(e).text(a.text).size(a.size||[500,500]).padding(a.padding||1).spiral(a.spiral||"archimedean").rotate(a.rotate||0).font(a.font||"sans-serif").fontStyle(a.fontStyle||"normal").fontWeight(a.fontWeight||"normal").fontSize(h).random(Qc).layout(),m=f.size(),n=m[0]>>1,o=m[1]>>1,p=0,q=l.length,r,s;p<q;++p)r=l[p],s=r.datum,s[g[0]]=r.x+n,s[g[1]]=r.y+o,s[g[2]]=r.font,s[g[3]]=r.size,s[g[4]]=r.style,s[g[5]]=r.weight,s[g[6]]=r.rotate;return b.reflow(d).modifies(g)};var I5=Object.freeze({__proto__:null,wordcloud:pw});function J5(a){return new Uint8Array(a)}function K5(a){return new Uint16Array(a)}function yk(a){return new Uint32Array(a)}function L5(){var a=8,b=[],c=yk(0),d=Ko(0,a),e=Ko(0,a);return{data:function(){return b},seen:function(){return c=M5(c,b.length)},add:function(f){for(var g=0,h=b.length,i=f.length,j;g<i;++g)j=f[g],j._index=h++,b.push(j)},remove:function(f,g){var h=b.length,i=Array(h-f),j=b,k,l,m;for(l=0;!g[l]&&l<h;++l)i[l]=b[l],j[l]=l;for(m=l;l<h;++l)k=b[l],g[l]?j[l]=-1:(j[l]=m,d[m]=d[l],e[m]=e[l],i[m]=k,k._index=m++),d[l]=0;return b=i,j},size:function(){return b.length},curr:function(){return d},prev:function(){return e},reset:function(f){e[f]=d[f]},all:function(){return a<257?255:a<65537?65535:4294967295},set:function(f,g){d[f]|=g},clear:function(f,g){d[f]&=~g},resize:function(f,g){var h=d.length;(f>h||g>a)&&(a=Math.max(g,a),d=Ko(f,a,d),e=Ko(f,a))}}}function M5(a,b,c){return a.length>=b?a:(c=c||new a.constructor(b),c.set(a),c)}function Ko(a,b,c){var d=(b<257?J5:b<65537?K5:yk)(a);return c&&d.set(c),d}function gJ(a,b,c){var d=1<<b;return{one:d,zero:~d,range:c.slice(),bisect:a.bisect,index:a.index,size:a.size,onAdd:function(e,f){var g=this,h=g.bisect(g.range,e.value),i=e.index,j=h[0],k=h[1],l=i.length,m;for(m=0;m<j;++m)f[i[m]]|=d;for(m=k;m<l;++m)f[i[m]]|=d;return g}}}function hJ(){var a=yk(0),b=[],c=0;function d(h,i,j){if(!i.length)return[];var k=c,l=i.length,m=Array(l),n=yk(l),o,p,q;for(q=0;q<l;++q)m[q]=h(i[q]),n[q]=q;m=N5(m,n);if(k)o=b,p=a,b=Array(k+l),a=yk(k+l),O5(j,o,p,k,m,n,l,b,a);else{if(j>0)for(q=0;q<l;++q)n[q]+=j;b=m,a=n}return c=k+l,{index:n,value:m}}function e(h,i){var j=c,k,l,m;for(l=0;!i[a[l]]&&l<j;++l);for(m=l;l<j;++l)i[k=a[l]]||(a[m]=k,b[m]=b[l],++m);c=j-h}function f(h){for(var i=0,j=c;i<j;++i)a[i]=h[a[i]]}function g(h,i){var j;return i?j=i.length:(i=b,j=c),[OT(i,h[0],0,j),Ze(i,h[1],0,j)]}return{insert:d,remove:e,bisect:g,reindex:f,index:function(){return a},size:function(){return c}}}function N5(a,b){return a.sort.call(b,function(c,d){var e=a[c],f=a[d];return e<f?-1:e>f?1:0}),VT(a,b)}function O5(a,b,c,d,e,f,g,h,i){var j=0,k=0,l;for(l=0;j<d&&k<g;++l)b[j]<e[k]?(h[l]=b[j],i[l]=c[j++]):(h[l]=e[k],i[l]=f[k++]+a);for(;j<d;++j,++l)h[l]=b[j],i[l]=c[j];for(;k<g;++k,++l)h[l]=e[k],i[l]=f[k]+a}function qw(a){E.call(this,L5(),a),this._indices=null,this._dims=null}qw.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var rd=N(qw,E);rd.transform=function(a,b){if(this._dims){var c=a.modified("fields")||a.fields.some(function(d){return b.modified(d.fields)});return c?this.reinit(a,b):this.eval(a,b)}else return this.init(a,b)},rd.init=function(a,b){for(var c=a.fields,d=a.query,e=this._indices={},f=this._dims=[],g=d.length,h=0,i,j;h<g;++h)i=c[h].fname,j=e[i]||(e[i]=hJ()),f.push(gJ(j,h,d[h]));return this.eval(a,b)},rd.reinit=function(a,b){var c=b.materialize().fork(),d=a.fields,e=a.query,f=this._indices,g=this._dims,h=this.value,i=h.curr(),j=h.prev(),k=h.all(),l=c.rem=c.add,m=c.mod,n=e.length,o={},p,q,r,s,t,w,v,x,u;j.set(i),b.rem.length&&(t=this.remove(a,b,c)),b.add.length&&h.add(b.add);if(b.mod.length)for(w={},s=b.mod,v=0,x=s.length;v<x;++v)w[s[v]._index]=1;for(v=0;v<n;++v)u=d[v],(!g[v]||a.modified("fields",v)||b.modified(u.fields))&&(r=u.fname,(p=o[r])||(f[r]=q=hJ(),o[r]=p=q.insert(u,b.source,0)),g[v]=gJ(q,v,e[v]).onAdd(p,i));for(v=0,x=h.data().length;v<x;++v){if(t[v])continue;j[v]!==i[v]?l.push(v):w[v]&&i[v]!==k&&m.push(v)}return h.mask=(1<<n)-1,c},rd.eval=function(a,b){var c=b.materialize().fork(),d=this._dims.length,e=0;return b.rem.length&&(this.remove(a,b,c),e|=(1<<d)-1),a.modified("query")&&!a.modified("fields")&&(e|=this.update(a,b,c)),b.add.length&&(this.insert(a,b,c),e|=(1<<d)-1),b.mod.length&&(this.modify(b,c),e|=(1<<d)-1),this.value.mask=e,c},rd.insert=function(a,b,c){var d=b.add,e=this.value,f=this._dims,g=this._indices,h=a.fields,i={},j=c.add,k=e.size(),l=k+d.length,m=f.length,n,o,p;e.resize(l,m),e.add(d);var q=e.curr(),r=e.prev(),s=e.all();for(n=0;n<m;++n)o=h[n].fname,p=i[o]||(i[o]=g[o].insert(h[n],d,k)),f[n].onAdd(p,q);for(;k<l;++k)r[k]=s,q[k]!==s&&j.push(k)},rd.modify=function(a,b){var c=b.mod,d=this.value,e=d.curr(),f=d.all(),g=a.mod,h,i,j;for(h=0,i=g.length;h<i;++h)j=g[h]._index,e[j]!==f&&c.push(j)},rd.remove=function(a,b,c){var d=this._indices,e=this.value,f=e.curr(),g=e.prev(),h=e.all(),i={},j=c.rem,k=b.rem,l,m,n,o;for(l=0,m=k.length;l<m;++l)n=k[l]._index,i[n]=1,g[n]=o=f[n],f[n]=h,o!==h&&j.push(n);for(n in d)d[n].remove(m,i);return this.reindex(b,m,i),i},rd.reindex=function(a,b,c){var d=this._indices,e=this.value;a.runAfter(function(){var f=e.remove(b,c);for(var g in d)d[g].reindex(f)})},rd.update=function(a,b,c){var d=this._dims,e=a.query,f=b.stamp,g=d.length,h=0,i,j;for(c.filters=0,j=0;j<g;++j)a.modified("query",j)&&(i=j,++h);if(h===1)h=d[i].one,this.incrementOne(d[i],e[i],c.add,c.rem);else for(j=0,h=0;j<g;++j){if(!a.modified("query",j))continue;h|=d[j].one,this.incrementAll(d[j],e[j],f,c.add),c.rem=c.add}return h},rd.incrementAll=function(a,b,c,d){var e=this.value,f=e.seen(),g=e.curr(),h=e.prev(),i=a.index(),j=a.bisect(a.range),k=a.bisect(b),l=k[0],m=k[1],n=j[0],o=j[1],p=a.one,q,r,s;if(l<n)for(q=l,r=Math.min(n,m);q<r;++q)s=i[q],f[s]!==c&&(h[s]=g[s],f[s]=c,d.push(s)),g[s]^=p;else if(l>n)for(q=n,r=Math.min(l,o);q<r;++q)s=i[q],f[s]!==c&&(h[s]=g[s],f[s]=c,d.push(s)),g[s]^=p;if(m>o)for(q=Math.max(l,o),r=m;q<r;++q)s=i[q],f[s]!==c&&(h[s]=g[s],f[s]=c,d.push(s)),g[s]^=p;else if(m<o)for(q=Math.max(n,m),r=o;q<r;++q)s=i[q],f[s]!==c&&(h[s]=g[s],f[s]=c,d.push(s)),g[s]^=p;a.range=b.slice()},rd.incrementOne=function(a,b,c,d){var e=this.value,f=e.curr(),g=a.index(),h=a.bisect(a.range),i=a.bisect(b),j=i[0],k=i[1],l=h[0],m=h[1],n=a.one,o,p,q;if(j<l)for(o=j,p=Math.min(l,k);o<p;++o)q=g[o],f[q]^=n,c.push(q);else if(j>l)for(o=l,p=Math.min(j,m);o<p;++o)q=g[o],f[q]^=n,d.push(q);if(k>m)for(o=Math.max(j,m),p=k;o<p;++o)q=g[o],f[q]^=n,c.push(q);else if(k<m)for(o=Math.max(l,k),p=m;o<p;++o)q=g[o],f[q]^=n,d.push(q);a.range=b.slice()};function rw(a){E.call(this,null,a)}rw.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var P5=N(rw,E);P5.transform=function(a,b){var c=~(a.ignore||0),d=a.filter,e=d.mask;if((e&c)===0)return b.StopPropagation;var f=b.fork(b.ALL),g=d.data(),h=d.curr(),i=d.prev(),j=function(k){return h[k]&c?null:g[k]};return f.filter(f.MOD,j),e&e-1?(f.filter(f.ADD,function(k){var l=h[k]&c,m=!l&&l^i[k]&c;return m?g[k]:null}),f.filter(f.REM,function(k){var l=h[k]&c,m=l&&!(l^(l^i[k]&c));return m?g[k]:null})):(f.filter(f.ADD,j),f.filter(f.REM,function(k){return(h[k]&c)===e?g[k]:null})),f.filter(f.SOURCE,function(k){return j(k._index)})};var Q5=Object.freeze({__proto__:null,crossfilter:qw,resolvefilter:rw});const R5="5.13.0";function S5(a){const b=a.container();b&&(b.setAttribute("role","graphics-document"),b.setAttribute("aria-roleDescription","visualization"),iJ(b,a.description()))}function iJ(a,b){a&&(b==null?a.removeAttribute("aria-label"):a.setAttribute("aria-label",b))}function T5(a){a.add(null,b=>(a._background=b.bg,a._resize=1,b.bg),{bg:a._signals.background})}const sw="default";function U5(a){const b=a._signals.cursor||(a._signals.cursor=a.add({user:sw,item:null}));a.on(a.events("view","mousemove"),b,function(c,d){const e=b.value,f=e?V(e)?e:e.user:sw,g=d.item&&d.item.cursor||null;return e&&f===e.user&&g==e.item?e:{user:f,item:g}}),a.add(null,function(c){let d=c.cursor,e=this.value;return V(d)||(e=d.item,d=d.user),tw(a,d&&d!==sw?d:e||d),e},{cursor:b})}function tw(a,b){const c=a.globalCursor()?typeof document!=="undefined"&&document.body:a.container();if(c)return b==null?c.style.removeProperty("cursor"):c.style.cursor=b}function Lo(a,b){var c=a._runtime.data;return _(c,b)||H("Unrecognized data set: "+b),c[b]}function V5(a,b){return arguments.length<2?Lo(this,a).values.value:Mo.call(this,a,fg().remove(Gd).insert(b))}function Mo(a,b){sA(b)||H("Second argument to changes must be a changeset.");var c=Lo(this,a);return c.modified=!0,this.pulse(c.input,b)}function W5(a,b){return Mo.call(this,a,fg().insert(b))}function X5(a,b){return Mo.call(this,a,fg().remove(b))}function jJ(a){var b=a.padding();return Math.max(0,a._viewWidth+b.left+b.right)}function kJ(a){var b=a.padding();return Math.max(0,a._viewHeight+b.top+b.bottom)}function No(a){var b=a.padding(),c=a._origin;return[b.left+c[0],b.top+c[1]]}function Y5(a){var b=No(a),c=jJ(a),d=kJ(a);a._renderer.background(a.background()),a._renderer.resize(c,d,b),a._handler.origin(b),a._resizeListeners.forEach(function(e){try{e(c,d)}catch(f){a.error(f)}})}function Z5(a,b,c){var d=a._renderer,e=d&&d.canvas(),f,g,h;return e&&(h=No(a),g=b.changedTouches?b.changedTouches[0]:b,f=gn(g,e),f[0]-=h[0],f[1]-=h[1]),b.dataflow=a,b.item=c,b.vega=_5(a,c,f),b}function _5(a,b,c){var d=b?b.mark.marktype==="group"?b:b.mark.group:null;function e(g){var h=d,i;if(g){for(i=b;i;i=i.mark.group)if(i.mark.name===g){h=i;break}}return h&&h.mark&&h.mark.interactive?h:{}}function f(g){if(!g)return c;V(g)&&(g=e(g));for(var h=c.slice();g;)h[0]-=g.x||0,h[1]-=g.y||0,g=g.mark&&g.mark.group;return h}return{view:Vb(a),item:Vb(b||{}),group:e,xy:f,x:function(g){return f(g)[0]},y:function(g){return f(g)[1]}}}const lJ="view",$5="timer",a6="window",b6={trap:!1};function c6(a){const b=la({defaults:{}},a),c=(d,e)=>{e.forEach(f=>{J(d[f])&&(d[f]=wb(d[f]))})};return c(b.defaults,["prevent","allow"]),c(b,["view","window","selector"]),b}function d6(a,b){var c=a._eventConfig.defaults,d=c.prevent,e=c.allow;return d===!1||e===!0?!1:d===!0||e===!1?!0:d?d[b]:e?!e[b]:a.preventDefault()}function Oo(a,b,c){const d=a._eventConfig&&a._eventConfig[b];return d===!1||Z(d)&&!d[c]?(a.warn(`Blocked ${b} ${c} event listener.`),!1):!0}function e6(a,b,c){var d=this,e=new fm(c),f=function(j,k){d.runAsync(null,()=>{a===lJ&&d6(d,b)&&j.preventDefault(),e.receive(Z5(d,j,k))})},g;if(a===$5)Oo(d,"timer",b)&&d.timer(f,b);else if(a===lJ)Oo(d,"view",b)&&d.addEventListener(b,f,b6);else{a===a6?Oo(d,"window",b)&&typeof window!=="undefined"&&(g=[window]):typeof document!=="undefined"&&(Oo(d,"selector",b)&&(g=document.querySelectorAll(a)));if(!g)d.warn("Can not resolve event source: "+a);else{for(var h=0,i=g.length;h<i;++h)g[h].addEventListener(b,f);d._eventListeners.push({type:b,sources:g,handler:f})}}return e}function mJ(a){return a.item}function nJ(a){return a.item.mark.source}function oJ(a){return function(b,c){return c.vega.view().changeset().encode(c.item,a)}}function f6(a,b){return a=[a||"hover"],b=[b||"update",a[0]],this.on(this.events("view","mouseover",mJ),nJ,oJ(a)),this.on(this.events("view","mouseout",mJ),nJ,oJ(b)),this}function g6(){var a=this._tooltip,b=this._timers,c=this._eventListeners,d,e,f;for(d=b.length;--d>=0;)b[d].stop();for(d=c.length;--d>=0;)for(f=c[d],e=f.sources.length;--e>=0;)f.sources[e].removeEventListener(f.type,f.handler);return a&&a.call(this,this._handler,null,null,null),this}function Jc(a,b,c){var d=document.createElement(a);for(var e in b)d.setAttribute(e,b[e]);return c!=null&&(d.textContent=c),d}const h6="vega-bind",i6="vega-bind-name",j6="vega-bind-radio";function k6(a,b,c){if(!b)return;const d=c.param;let e=c.state;return e||(e=c.state={elements:null,active:!1,set:null,update:f=>{f!==a.signal(d.signal)&&a.runAsync(null,function(){e.source=!0,a.signal(d.signal,f)})}},d.debounce&&(e.update=kA(d.debounce,e.update))),l6(e,b,d,a.signal(d.signal)),e.active||(a.on(a._signals[d.signal],null,()=>{e.source?e.source=!1:e.set(a.signal(d.signal))}),e.active=!0),e}function l6(a,b,c,d){const e=Jc("div",{class:h6}),f=c.input==="radio"?e:e.appendChild(Jc("label"));f.appendChild(Jc("span",{class:i6},c.name||c.signal)),b.appendChild(e);let g=m6;switch(c.input){case"checkbox":g=n6;break;case"select":g=o6;break;case"radio":g=p6;break;case"range":g=q6;break}g(a,f,c,d)}function m6(a,b,c,d){const e=Jc("input");for(const f in c)f!=="signal"&&f!=="element"&&e.setAttribute(f==="input"?"type":f,c[f]);e.setAttribute("name",c.signal),e.value=d,b.appendChild(e),e.addEventListener("input",()=>a.update(e.value)),a.elements=[e],a.set=f=>e.value=f}function n6(a,b,c,d){const e={type:"checkbox",name:c.signal};d&&(e.checked=!0);const f=Jc("input",e);b.appendChild(f),f.addEventListener("change",()=>a.update(f.checked)),a.elements=[f],a.set=g=>f.checked=!!g||null}function o6(a,b,c,d){const e=Jc("select",{name:c.signal}),f=c.labels||[];c.options.forEach((g,h)=>{const i={value:g};Po(g,d)&&(i.selected=!0),e.appendChild(Jc("option",i,(f[h]||g)+""))}),b.appendChild(e),e.addEventListener("change",()=>{a.update(c.options[e.selectedIndex])}),a.elements=[e],a.set=g=>{for(let h=0,i=c.options.length;h<i;++h)if(Po(c.options[h],g)){e.selectedIndex=h;return}}}function p6(a,b,c,d){const e=Jc("span",{class:j6}),f=c.labels||[];b.appendChild(e),a.elements=c.options.map((g,h)=>{const i={type:"radio",name:c.signal,value:g};Po(g,d)&&(i.checked=!0);const j=Jc("input",i);j.addEventListener("change",()=>a.update(g));const k=Jc("label",{},(f[h]||g)+"");return k.prepend(j),e.appendChild(k),j}),a.set=g=>{const h=a.elements,i=h.length;for(let j=0;j<i;++j)Po(h[j].value,g)&&(h[j].checked=!0)}}function q6(a,b,c,d){d=d!==void 0?d:(+c.max+ +c.min)/2;const e=c.max!=null?c.max:Math.max(100,+d)||100,f=c.min||Math.min(0,e,+d)||0,g=c.step||_e(f,e,100),h=Jc("input",{type:"range",name:c.signal,min:f,max:e,step:g});h.value=d;const i=Jc("span",{},+d);b.appendChild(h),b.appendChild(i);const j=()=>{i.textContent=h.value,a.update(+h.value)};h.addEventListener("input",j),h.addEventListener("change",j),a.elements=[h],a.set=k=>{h.value=k,i.textContent=k}}function Po(a,b){return a===b||a+""===b+""}function pJ(a,b,c,d,e,f){return b=b||new d(a.loader()),b.initialize(c,jJ(a),kJ(a),No(a),e,f).background(a.background())}function uw(a,b){return b?function(){try{b.apply(this,arguments)}catch(c){a.error(c)}}:null}function r6(a,b,c,d){var e=new d(a.loader(),uw(a,a.tooltip())).scene(a.scenegraph().root).initialize(c,No(a),a);return b&&b.handlers().forEach(function(f){e.on(f.type,f.handler)}),e}function s6(a,b){const c=this,d=c._renderType,e=c._eventConfig.bind,f=Kn(d);a=c._el=a?vw(c,a):null,S5(c),f||c.error("Unrecognized renderer type: "+d);const g=f.handler||Ij,h=a?f.renderer:f.headless;return c._renderer=h?pJ(c,c._renderer,a,h):null,c._handler=r6(c,c._handler,a,g),c._redraw=!0,a&&e!=="none"&&(b=b?c._elBind=vw(c,b):a.appendChild(Jc("form",{class:"vega-bindings"})),c._bind.forEach(function(i){i.param.element&&e!=="container"&&(i.element=vw(c,i.param.element))}),c._bind.forEach(function(i){k6(c,i.element||b,i)})),c}function vw(a,b){if(typeof b==="string")if(typeof document!=="undefined"){b=document.querySelector(b);if(!b)return a.error("Signal bind element not found: "+b),null}else return a.error("DOM document instance not found."),null;if(b)try{b.innerHTML=""}catch(c){b=null,a.error(c)}return b}const zk=a=>+a||0,t6=a=>({top:a,bottom:a,left:a,right:a});function qJ(a){return Z(a)?{top:zk(a.top),bottom:zk(a.bottom),left:zk(a.left),right:zk(a.right)}:t6(zk(a))}async function ww(a,b,c,d){const e=Kn(b),f=e&&e.headless;return f||H("Unrecognized renderer type: "+b),await a.runAsync(),pJ(a,null,null,f,c,d).renderAsync(a._scenegraph.root)}async function u6(a,b){a!==tf.Canvas&&a!==tf.SVG&&a!==tf.PNG&&H("Unrecognized image type: "+a);const c=await ww(this,a,b);return a===tf.SVG?v6(c.svg(),"image/svg+xml"):c.canvas().toDataURL("image/png")}function v6(a,b){var c=new Blob([a],{type:b});return window.URL.createObjectURL(c)}async function w6(a,b){const c=await ww(this,tf.Canvas,a,b);return c.canvas()}async function x6(a){const b=await ww(this,tf.SVG,a);return b.svg()}function rJ(a){const b=this.context.data[a];return b?b.values.value:[]}function y6(a,b,c){const d=this.context.data[a]["index:"+b],e=d?d.value.get(c):void 0;return e?e.count:e}function z6(a,b){const c=this.context.dataflow,d=this.context.data[a],e=d.input;return c.pulse(e,c.changeset().remove(Gd).insert(b)),1}function A6(a,b,c){if(a){const d=this.context.dataflow,e=a.mark.source;d.pulse(e,d.changeset().encode(a,b))}return c!==void 0?c:a}const Ak=a=>function(b,c){const d=this.context.dataflow.locale();return d[a](c)(b)},B6=Ak("format"),sJ=Ak("timeFormat"),C6=Ak("utcFormat"),D6=Ak("timeParse"),E6=Ak("utcParse");var Qo=new Date(2e3,0,1);function Ro(a,b,c){return!Number.isInteger(a)||!Number.isInteger(b)?"":(Qo.setYear(2e3),Qo.setMonth(a),Qo.setDate(b),sJ.call(this,Qo,c))}function F6(a){return Ro.call(this,a,1,"%B")}function G6(a){return Ro.call(this,a,1,"%b")}function H6(a){return Ro.call(this,0,2+a,"%A")}function I6(a){return Ro.call(this,0,2+a,"%a")}const J6=":",K6="@",xw="%",tJ="$";var L6="RawCode",Jg="Literal",M6="Property",N6="Identifier",O6="ArrayExpression",P6="BinaryExpression",uJ="CallExpression",Q6="ConditionalExpression",R6="LogicalExpression",S6="MemberExpression",T6="ObjectExpression",U6="UnaryExpression";function sd(a){this.type=a}sd.prototype.visit=function(a){var b=this,c,d,e;if(a(b))return 1;for(c=V6(b),d=0,e=c.length;d<e;++d)if(c[d].visit(a))return 1};function V6(a){switch(a.type){case O6:return a.elements;case P6:case R6:return[a.left,a.right];case uJ:var b=a.arguments.slice();return b.unshift(a.callee),b;case Q6:return[a.test,a.consequent,a.alternate];case S6:return[a.object,a.property];case T6:return a.properties;case M6:return[a.key,a.value];case U6:return[a.argument];case N6:case Jg:case L6:default:return[]}}var Wd,W,G,Mb,Ba,So=1,Bk=2,Kg=3,wf=4,To=5,Lg=6,sc=7,Ck=8,W6=9;Wd={},Wd[So]="Boolean",Wd[Bk]="<end>",Wd[Kg]="Identifier",Wd[wf]="Keyword",Wd[To]="Null",Wd[Lg]="Numeric",Wd[sc]="Punctuator",Wd[Ck]="String",Wd[W6]="RegularExpression";var X6="ArrayExpression",Y6="BinaryExpression",Z6="CallExpression",_6="ConditionalExpression",vJ="Identifier",$6="Literal",a7="LogicalExpression",b7="MemberExpression",c7="ObjectExpression",d7="Property",e7="UnaryExpression",Db="Unexpected token %0",f7="Unexpected number",g7="Unexpected string",h7="Unexpected identifier",i7="Unexpected reserved word",j7="Unexpected end of input",yw="Invalid regular expression",zw="Invalid regular expression: missing /",wJ="Octal literals are not allowed in strict mode.",k7="Duplicate data property in object literal not allowed in strict mode",Nb="ILLEGAL",Dk="Disabled.",l7=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),m7=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Uo(a,b){if(!a)throw new Error("ASSERT: "+b)}function Fe(a){return a>=48&&a<=57}function Aw(a){return"0123456789abcdefABCDEF".indexOf(a)>=0}function Ek(a){return"01234567".indexOf(a)>=0}function n7(a){return a===32||a===9||a===11||a===12||a===160||a>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(a)>=0}function Fk(a){return a===10||a===13||a===8232||a===8233}function Gk(a){return a===36||a===95||a>=65&&a<=90||a>=97&&a<=122||a===92||a>=128&&l7.test(String.fromCharCode(a))}function Vo(a){return a===36||a===95||a>=65&&a<=90||a>=97&&a<=122||a>=48&&a<=57||a===92||a>=128&&m7.test(String.fromCharCode(a))}var o7={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function xJ(){for(var a;G<Mb;){a=W.charCodeAt(G);if(n7(a)||Fk(a))++G;else break}}function Bw(a){var b,c,d,e=0;for(c=a==="u"?4:2,b=0;b<c;++b)G<Mb&&Aw(W[G])?(d=W[G++],e=e*16+"0123456789abcdef".indexOf(d.toLowerCase())):ya({},Db,Nb);return String.fromCharCode(e)}function p7(){var a,b,c,d;for(a=W[G],b=0,a==="}"&&ya({},Db,Nb);G<Mb;){a=W[G++];if(!Aw(a))break;b=b*16+"0123456789abcdef".indexOf(a.toLowerCase())}return(b>1114111||a!=="}")&&ya({},Db,Nb),b<=65535?String.fromCharCode(b):(c=(b-65536>>10)+55296,d=(b-65536&1023)+56320,String.fromCharCode(c,d))}function yJ(){var a,b;for(a=W.charCodeAt(G++),b=String.fromCharCode(a),a===92&&(W.charCodeAt(G)!==117&&ya({},Db,Nb),++G,a=Bw("u"),(!a||a==="\\"||!Gk(a.charCodeAt(0)))&&ya({},Db,Nb),b=a);G<Mb;){a=W.charCodeAt(G);if(!Vo(a))break;++G,b+=String.fromCharCode(a),a===92&&(b=b.substr(0,b.length-1),W.charCodeAt(G)!==117&&ya({},Db,Nb),++G,a=Bw("u"),(!a||a==="\\"||!Vo(a.charCodeAt(0)))&&ya({},Db,Nb),b+=a)}return b}function q7(){var a,b;for(a=G++;G<Mb;){b=W.charCodeAt(G);if(b===92)return G=a,yJ();if(Vo(b))++G;else break}return W.slice(a,G)}function r7(){var a,b,c;return a=G,b=W.charCodeAt(G)===92?yJ():q7(),b.length===1?c=Kg:o7.hasOwnProperty(b)?c=wf:b==="null"?c=To:b==="true"||b==="false"?c=So:c=Kg,{type:c,value:b,start:a,end:G}}function Cw(){var a=G,b=W.charCodeAt(G),c,d=W[G],e,f,g;switch(b){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++G,{type:sc,value:String.fromCharCode(b),start:a,end:G};default:c=W.charCodeAt(G+1);if(c===61)switch(b){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return G+=2,{type:sc,value:String.fromCharCode(b)+String.fromCharCode(c),start:a,end:G};case 33:case 61:return G+=2,W.charCodeAt(G)===61&&++G,{type:sc,value:W.slice(a,G),start:a,end:G}}}g=W.substr(G,4);if(g===">>>=")return G+=4,{type:sc,value:g,start:a,end:G};f=g.substr(0,3);if(f===">>>"||f==="<<="||f===">>=")return G+=3,{type:sc,value:f,start:a,end:G};e=f.substr(0,2);if(d===e[1]&&"+-<>&|".indexOf(d)>=0||e==="=>")return G+=2,{type:sc,value:e,start:a,end:G};if("<>=!+-*%&|^/".indexOf(d)>=0)return++G,{type:sc,value:d,start:a,end:G};ya({},Db,Nb)}function s7(a){for(var b="";G<Mb;){if(!Aw(W[G]))break;b+=W[G++]}return b.length===0&&ya({},Db,Nb),Gk(W.charCodeAt(G))&&ya({},Db,Nb),{type:Lg,value:parseInt("0x"+b,16),start:a,end:G}}function t7(a){for(var b="0"+W[G++];G<Mb;){if(!Ek(W[G]))break;b+=W[G++]}return(Gk(W.charCodeAt(G))||Fe(W.charCodeAt(G)))&&ya({},Db,Nb),{type:Lg,value:parseInt(b,8),octal:!0,start:a,end:G}}function zJ(){var a,b,c;c=W[G],Uo(Fe(c.charCodeAt(0))||c===".","Numeric literal must start with a decimal digit or a decimal point"),b=G,a="";if(c!=="."){a=W[G++],c=W[G];if(a==="0"){if(c==="x"||c==="X")return++G,s7(b);if(Ek(c))return t7(b);c&&Fe(c.charCodeAt(0))&&ya({},Db,Nb)}for(;Fe(W.charCodeAt(G));)a+=W[G++];c=W[G]}if(c==="."){for(a+=W[G++];Fe(W.charCodeAt(G));)a+=W[G++];c=W[G]}if(c==="e"||c==="E"){a+=W[G++],c=W[G],(c==="+"||c==="-")&&(a+=W[G++]);if(Fe(W.charCodeAt(G)))for(;Fe(W.charCodeAt(G));)a+=W[G++];else ya({},Db,Nb)}return Gk(W.charCodeAt(G))&&ya({},Db,Nb),{type:Lg,value:parseFloat(a),start:b,end:G}}function u7(){var a="",b,c,d,e,f=!1;for(b=W[G],Uo(b==="'"||b==='"',"String literal must starts with a quote"),c=G,++G;G<Mb;){d=W[G++];if(d===b){b="";break}else if(d==="\\"){d=W[G++];if(!d||!Fk(d.charCodeAt(0)))switch(d){case"u":case"x":W[G]==="{"?(++G,a+=p7()):a+=Bw(d);break;case"n":a+=`
`;break;case"r":a+="\r";break;case"t":a+="	";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;default:Ek(d)?(e="01234567".indexOf(d),e!==0&&(f=!0),G<Mb&&Ek(W[G])&&(f=!0,e=e*8+"01234567".indexOf(W[G++]),"0123".indexOf(d)>=0&&G<Mb&&Ek(W[G])&&(e=e*8+"01234567".indexOf(W[G++]))),a+=String.fromCharCode(e)):a+=d;break}else d==="\r"&&W[G]===`
`&&++G}else{if(Fk(d.charCodeAt(0)))break;a+=d}}return b!==""&&ya({},Db,Nb),{type:Ck,value:a,octal:f,start:c,end:G}}function v7(a,b){var c=a;b.indexOf("u")>=0&&(c=c.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(d,e){if(parseInt(e,16)<=1114111)return"x";ya({},yw)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(c)}catch(d){ya({},yw)}try{return new RegExp(a,b)}catch(d){return null}}function w7(){var a,b,c,d,e;for(a=W[G],Uo(a==="/","Regular expression literal must start with a slash"),b=W[G++],c=!1,d=!1;G<Mb;){a=W[G++],b+=a;if(a==="\\")a=W[G++],Fk(a.charCodeAt(0))&&ya({},zw),b+=a;else if(Fk(a.charCodeAt(0)))ya({},zw);else if(c)a==="]"&&(c=!1);else if(a==="/"){d=!0;break}else a==="["&&(c=!0)}return d||ya({},zw),e=b.substr(1,b.length-2),{value:e,literal:b}}function x7(){var a,b,c;for(b="",c="";G<Mb;){a=W[G];if(!Vo(a.charCodeAt(0)))break;++G,a==="\\"&&G<Mb?ya({},Db,Nb):(c+=a,b+=a)}return c.search(/[^gimuy]/g)>=0&&ya({},yw,c),{value:c,literal:b}}function y7(){var a,b,c,d;return Ba=null,xJ(),a=G,b=w7(),c=x7(),d=v7(b.value,c.value),{literal:b.literal+c.literal,value:d,regex:{pattern:b.value,flags:c.value},start:a,end:G}}function z7(a){return a.type===Kg||a.type===wf||a.type===So||a.type===To}function AJ(){var a;return xJ(),G>=Mb?{type:Bk,start:G,end:G}:(a=W.charCodeAt(G),Gk(a)?r7():a===40||a===41||a===59?Cw():a===39||a===34?u7():a===46?Fe(W.charCodeAt(G+1))?zJ():Cw():Fe(a)?zJ():Cw())}function tc(){var a;return a=Ba,G=a.end,Ba=AJ(),G=a.end,a}function BJ(){var a;a=G,Ba=AJ(),G=a}function A7(a){var b=new sd(X6);return b.elements=a,b}function CJ(a,b,c){var d=new sd(a==="||"||a==="&&"?a7:Y6);return d.operator=a,d.left=b,d.right=c,d}function B7(a,b){var c=new sd(Z6);return c.callee=a,c.arguments=b,c}function C7(a,b,c){var d=new sd(_6);return d.test=a,d.consequent=b,d.alternate=c,d}function Dw(a){var b=new sd(vJ);return b.name=a,b}function Hk(a){var b=new sd($6);return b.value=a.value,b.raw=W.slice(a.start,a.end),a.regex&&(b.raw==="//"&&(b.raw="/(?:)/"),b.regex=a.regex),b}function DJ(a,b,c){var d=new sd(b7);return d.computed=a==="[",d.object=b,d.property=c,d.computed||(c.member=!0),d}function D7(a){var b=new sd(c7);return b.properties=a,b}function EJ(a,b,c){var d=new sd(d7);return d.key=b,d.value=c,d.kind=a,d}function E7(a,b){var c=new sd(e7);return c.operator=a,c.argument=b,c.prefix=!0,c}function ya(a,b){var c,d=Array.prototype.slice.call(arguments,2),e=b.replace(/%(\d)/g,function(f,g){return Uo(g<d.length,"Message reference must be in range"),d[g]});throw c=new Error(e),c.index=G,c.description=e,c}function Wo(a){a.type===Bk&&ya(a,j7),a.type===Lg&&ya(a,f7),a.type===Ck&&ya(a,g7),a.type===Kg&&ya(a,h7),a.type===wf&&ya(a,i7),ya(a,Db,a.value)}function Ob(a){var b=tc();(b.type!==sc||b.value!==a)&&Wo(b)}function La(a){return Ba.type===sc&&Ba.value===a}function Ew(a){return Ba.type===wf&&Ba.value===a}function F7(){var a=[];for(G=Ba.start,Ob("[");!La("]");)La(",")?(tc(),a.push(null)):(a.push(Mg()),La("]")||Ob(","));return tc(),A7(a)}function FJ(){var a;return G=Ba.start,a=tc(),a.type===Ck||a.type===Lg?(a.octal&&ya(a,wJ),Hk(a)):Dw(a.value)}function G7(){var a,b,c,d;G=Ba.start,a=Ba;if(a.type===Kg)return c=FJ(),Ob(":"),d=Mg(),EJ("init",c,d);if(a.type===Bk||a.type===sc)Wo(a);else return b=FJ(),Ob(":"),d=Mg(),EJ("init",b,d)}function H7(){var a=[],b,c,d,e={},f=String;for(G=Ba.start,Ob("{");!La("}");)b=G7(),b.key.type===vJ?c=b.key.name:c=f(b.key.value),d="$"+c,Object.prototype.hasOwnProperty.call(e,d)?ya({},k7):e[d]=!0,a.push(b),La("}")||Ob(",");return Ob("}"),D7(a)}function I7(){var a;return Ob("("),a=Fw(),Ob(")"),a}var J7={if:1};function K7(){var a,b,c;if(La("("))return I7();if(La("["))return F7();if(La("{"))return H7();a=Ba.type,G=Ba.start;if(a===Kg||J7[Ba.value])c=Dw(tc().value);else if(a===Ck||a===Lg)Ba.octal&&ya(Ba,wJ),c=Hk(tc());else{if(a===wf)throw new Error(Dk);a===So?(b=tc(),b.value=b.value==="true",c=Hk(b)):a===To?(b=tc(),b.value=null,c=Hk(b)):La("/")||La("/=")?(c=Hk(y7()),BJ()):Wo(tc())}return c}function L7(){var a=[];Ob("(");if(!La(")"))for(;G<Mb;){a.push(Mg());if(La(")"))break;Ob(",")}return Ob(")"),a}function M7(){var a;return G=Ba.start,a=tc(),z7(a)||Wo(a),Dw(a.value)}function N7(){return Ob("."),M7()}function O7(){var a;return Ob("["),a=Fw(),Ob("]"),a}function P7(){var a,b,c;for(a=K7();;)if(La("."))c=N7(),a=DJ(".",a,c);else if(La("("))b=L7(),a=B7(a,b);else if(La("["))c=O7(),a=DJ("[",a,c);else break;return a}function GJ(){var a=P7();if(Ba.type===sc){if(La("++")||La("--"))throw new Error(Dk)}return a}function Xo(){var a,b;if(Ba.type!==sc&&Ba.type!==wf)b=GJ();else{if(La("++")||La("--"))throw new Error(Dk);if(La("+")||La("-")||La("~")||La("!"))a=tc(),b=Xo(),b=E7(a.value,b);else{if(Ew("delete")||Ew("void")||Ew("typeof"))throw new Error(Dk);b=GJ()}}return b}function HJ(a){var b=0;if(a.type!==sc&&a.type!==wf)return 0;switch(a.value){case"||":b=1;break;case"&&":b=2;break;case"|":b=3;break;case"^":b=4;break;case"&":b=5;break;case"==":case"!=":case"===":case"!==":b=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":b=7;break;case"<<":case">>":case">>>":b=8;break;case"+":case"-":b=9;break;case"*":case"/":case"%":b=11;break}return b}function Q7(){var a,b,c,d,e,f,g,h,i,j;a=Ba,i=Xo(),d=Ba,e=HJ(d);if(e===0)return i;for(d.prec=e,tc(),b=[a,Ba],g=Xo(),f=[i,d,g];(e=HJ(Ba))>0;){for(;f.length>2&&e<=f[f.length-2].prec;)g=f.pop(),h=f.pop().value,i=f.pop(),b.pop(),c=CJ(h,i,g),f.push(c);d=tc(),d.prec=e,f.push(d),b.push(Ba),c=Xo(),f.push(c)}for(j=f.length-1,c=f[j],b.pop();j>1;)b.pop(),c=CJ(f[j-1].value,f[j-2],c),j-=2;return c}function Mg(){var a,b,c;return a=Q7(),La("?")&&(tc(),b=Mg(),Ob(":"),c=Mg(),a=C7(a,b,c)),a}function Fw(){var a=Mg();if(La(","))throw new Error(Dk);return a}function IJ(a){W=a,G=0,Mb=W.length,Ba=null,BJ();var b=Fw();if(Ba.type!==Bk)throw new Error("Unexpect token after expression.");return b}var JJ={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function KJ(a){function b(g,h,i,j){var k=a(h[0]);return i&&(k=i+"("+k+")",i.lastIndexOf("new ",0)===0&&(k="("+k+")")),k+"."+g+(j<0?"":j===0?"()":"("+h.slice(1).map(a).join(",")+")")}function c(g,h,i){return function(j){return b(g,j,h,i)}}var d="new Date",e="String",f="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(g){g.length<3&&H("Missing arguments to clamp function."),g.length>3&&H("Too many arguments to clamp function.");var h=g.map(a);return"Math.max("+h[1]+", Math.min("+h[2]+","+h[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:d,date:c("getDate",d,0),day:c("getDay",d,0),year:c("getFullYear",d,0),month:c("getMonth",d,0),hours:c("getHours",d,0),minutes:c("getMinutes",d,0),seconds:c("getSeconds",d,0),milliseconds:c("getMilliseconds",d,0),time:c("getTime",d,0),timezoneoffset:c("getTimezoneOffset",d,0),utcdate:c("getUTCDate",d,0),utcday:c("getUTCDay",d,0),utcyear:c("getUTCFullYear",d,0),utcmonth:c("getUTCMonth",d,0),utchours:c("getUTCHours",d,0),utcminutes:c("getUTCMinutes",d,0),utcseconds:c("getUTCSeconds",d,0),utcmilliseconds:c("getUTCMilliseconds",d,0),length:c("length",null,-1),join:c("join",null),indexof:c("indexOf",null),lastindexof:c("lastIndexOf",null),slice:c("slice",null),reverse:function(g){return"("+a(g[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:c("toUpperCase",e,0),lower:c("toLowerCase",e,0),substring:c("substring",e),split:c("split",e),replace:c("replace",e),trim:c("trim",e,0),regexp:f,test:c("test",f),if:function(g){g.length<3&&H("Missing arguments to if function."),g.length>3&&H("Too many arguments to if function.");var h=g.map(a);return"("+h[0]+"?"+h[1]+":"+h[2]+")"}}}function R7(a){var b=a&&a.length-1;return b&&(a[0]==='"'&&a[b]==='"'||a[0]==="'"&&a[b]==="'")?a.slice(1,-1):a}function S7(a){a=a||{};var b=a.whitelist?wb(a.whitelist):{},c=a.blacklist?wb(a.blacklist):{},d=a.constants||JJ,e=(a.functions||KJ)(l),f=a.globalvar,g=a.fieldvar,h={},i={},j=0,k=pa(f)?f:function(o){return f+'["'+o+'"]'};function l(o){if(V(o))return o;var p=m[o.type];return p==null&&H("Unsupported type: "+o.type),p(o)}var m={Literal:function(o){return o.raw},Identifier:function(o){var p=o.name;return j>0?p:_(c,p)?H("Illegal identifier: "+p):_(d,p)?d[p]:_(b,p)?p:(h[p]=1,k(p))},MemberExpression:function(o){var p=!o.computed,q=l(o.object);p&&(j+=1);var r=l(o.property);return q===g&&(i[R7(r)]=1),p&&(j-=1),q+(p?"."+r:"["+r+"]")},CallExpression:function(o){o.callee.type!=="Identifier"&&H("Illegal callee type: "+o.callee.type);var p=o.callee.name,q=o.arguments,r=_(e,p)&&e[p];return r||H("Unrecognized function: "+p),pa(r)?r(q):r+"("+q.map(l).join(",")+")"},ArrayExpression:function(o){return"["+o.elements.map(l).join(",")+"]"},BinaryExpression:function(o){return"("+l(o.left)+o.operator+l(o.right)+")"},UnaryExpression:function(o){return"("+o.operator+l(o.argument)+")"},ConditionalExpression:function(o){return"("+l(o.test)+"?"+l(o.consequent)+":"+l(o.alternate)+")"},LogicalExpression:function(o){return"("+l(o.left)+o.operator+l(o.right)+")"},ObjectExpression:function(o){return"{"+o.properties.map(l).join(",")+"}"},Property:function(o){j+=1;var p=l(o.key);return j-=1,p+":"+l(o.value)}};function n(o){var p={code:l(o),globals:Object.keys(h),fields:Object.keys(i)};return h={},i={},p}return n.functions=e,n.constants=d,n}function Gw(a,b,c,d){b[0].type!==Jg&&H("First argument to data functions must be a string literal.");const e=b[0].value,f=J6+e;if(!_(f,d))try{d[f]=c.getData(e).tuplesRef()}catch(g){}}function T7(a,b,c,d){b[0].type!==Jg&&H("First argument to indata must be a string literal."),b[1].type!==Jg&&H("Second argument to indata must be a string literal.");const e=b[0].value,f=b[1].value,g=K6+f;_(g,d)||(d[g]=c.getData(e).indataRef(c,f))}function uc(a,b,c,d){if(b[0].type===Jg)LJ(c,d,b[0].value);else for(a in c.scales)LJ(c,d,a)}function LJ(a,b,c){const d=xw+c;if(!_(b,d))try{b[d]=a.scaleRef(c)}catch(e){}}function Ge(a,b){let c;return pa(a)?a:V(a)?(c=b.scales[a])&&c.value:void 0}function U7(a,b,c){b.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,c._bandwidth=uc,c._range=uc,c._scale=uc;const d=e=>"_["+(e.type===Jg?P(xw+e.value):P(xw)+"+"+a(e))+"]";return{_bandwidth:e=>`this.__bandwidth(${d(e[0])})`,_range:e=>`${d(e[0])}.range()`,_scale:e=>`${d(e[0])}(${a(e[1])})`}}function Hw(a,b){return function(c,d,e){if(c){const f=Ge(c,(e||this).context);return f&&f.path[a](d)}else return b(d)}}const V7=Hw("area",E1),W7=Hw("bounds",I1),X7=Hw("centroid",O1);function Y7(a){let b=this.context.group,c=!1;if(b)for(;a;){if(a===b){c=!0;break}a=a.mark.group}return c}function Iw(a,b,c){try{a[b].apply(a,["EXPRESSION"].concat([].slice.call(c)))}catch(d){a.warn(d)}return c[c.length-1]}function Z7(){return Iw(this.context.dataflow,"warn",arguments)}function _7(){return Iw(this.context.dataflow,"info",arguments)}function $7(){return Iw(this.context.dataflow,"debug",arguments)}function Jw(a){const b=a/255;return b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4)}function Kw(a){const b=rf(a),c=Jw(b.r),d=Jw(b.g),e=Jw(b.b);return .2126*c+.7152*d+.0722*e}function a8(a,b){const c=Kw(a),d=Kw(b),e=Math.max(c,d),f=Math.min(c,d);return(e+.05)/(f+.05)}function b8(){var a=[].slice.call(arguments);return a.unshift({}),la.apply(null,a)}function MJ(a,b){return a===b||a!==a&&b!==b?!0:J(a)?J(b)&&a.length===b.length?c8(a,b):!1:Z(a)&&Z(b)?NJ(a,b):!1}function c8(a,b){for(let c=0,d=a.length;c<d;++c)if(!MJ(a[c],b[c]))return!1;return!0}function NJ(a,b){for(let c in a)if(!MJ(a[c],b[c]))return!1;return!0}function OJ(a){return b=>NJ(a,b)}function d8(a,b,c,d,e,f){let g=this.context.dataflow,h=this.context.data[a],i=h.input,j=h.changes,k=g.stamp(),l,m;if(g._trigger===!1||!(i.value.length||b||d))return 0;(!j||j.stamp<k)&&(h.changes=j=g.changeset(),j.stamp=k,g.runAfter(function(){h.modified=!0,g.pulse(i,j).run()},!0,1)),c&&(l=c===!0?Gd:J(c)||cm(c)?c:OJ(c),j.remove(l)),b&&j.insert(b),d&&(l=OJ(d),i.value.some(l)?j.remove(l):j.insert(d));if(e)for(m in f)j.modify(e,m,f[m]);return 1}function e8(a){const b=a.touches,c=b[0].clientX-b[1].clientX,d=b[0].clientY-b[1].clientY;return Math.sqrt(c*c+d*d)}function f8(a){const b=a.touches;return Math.atan2(b[0].clientY-b[1].clientY,b[0].clientX-b[1].clientX)}function g8(a,b,c){return Gt(a||0,b||0,c||0)}function h8(a,b){const c=Ge(a,(b||this).context);return c&&c.bandwidth?c.bandwidth():0}function i8(a,b){const c=Ge(a,(b||this).context);return c?c.copy():void 0}function j8(a,b){const c=Ge(a,(b||this).context);return c?c.domain():[]}function k8(a,b,c){const d=Ge(a,(c||this).context);return d?J(b)?(d.invertRange||d.invert)(b):(d.invert||d.invertExtent)(b):void 0}function l8(a,b){const c=Ge(a,(b||this).context);return c&&c.range?c.range():[]}function m8(a,b,c){const d=Ge(a,(c||this).context);return d?d(b):void 0}function n8(a,b,c,d,e){a=Ge(a,(e||this).context);const f=_C(b,c);let g=a.domain(),h=g[0],i=ra(g),j=Ub;return i-h?j=KF(a,h,i):a=(a.interpolator?va("sequential")().interpolator(a.interpolator()):va("linear")().interpolate(a.interpolate()).range(a.range())).domain([h=0,i=1]),a.ticks&&(g=a.ticks(+d||15),h!==g[0]&&g.unshift(h),i!==ra(g)&&g.push(i)),g.forEach(k=>f.stop(j(k),a(k))),f}function o8(a,b,c){const d=Ge(a,(c||this).context);return function(e){return d?d.path.context(e)(b):""}}function p8(a){let b=null;return function(c){return c?wj(c,b=b||Mh(a)):a}}const PJ=a=>a.data;function QJ(a,b){const c=rJ.call(b,a);return c.root&&c.root.lookup||{}}function q8(a,b,c){const d=QJ(a,this),e=d[b],f=d[c];return e&&f?e.path(f).map(PJ):void 0}function r8(a,b){const c=QJ(a,this)[b];return c?c.ancestors().map(PJ):void 0}const RJ=()=>typeof window!=="undefined"&&window||null;function s8(){const a=RJ();return a?a.screen:{}}function t8(){const a=RJ();return a?[a.innerWidth,a.innerHeight]:[void 0,void 0]}function u8(){const a=this.context.dataflow,b=a.container&&a.container();return b?[b.clientWidth,b.clientHeight]:[void 0,void 0]}const SJ="intersect",TJ="union",v8="vlMulti",UJ="or",w8="and";var x8="E",y8="R",z8="R-E",A8="R-LE",B8="R-RE",VJ="index:unit";function WJ(a,b){for(var c=b.fields,d=b.values,e=c.length,f=0,g,h;f<e;++f){h=c[f],h.getter=Fd.getter||Fd(h.field),g=h.getter(a),cg(g)&&(g=ic(g)),cg(d[f])&&(d[f]=ic(d[f])),cg(d[f][0])&&(d[f]=d[f].map(ic));if(h.type===x8){if(J(d[f])?d[f].indexOf(g)<0:g!==d[f])return!1}else if(h.type===y8){if(!_i(g,d[f]))return!1}else if(h.type===B8){if(!_i(g,d[f],!0,!1))return!1}else if(h.type===z8){if(!_i(g,d[f],!1,!1))return!1}else if(h.type===A8){if(!_i(g,d[f],!1,!0))return!1}}return!0}function C8(a,b,c){for(var d=this.context.data[a],e=d?d.values.value:[],f=d?d[VJ]&&d[VJ].value:void 0,g=c===SJ,h=e.length,i=0,j,k,l,m,n;i<h;++i){j=e[i];if(f&&g){k=k||{},l=k[m=j.unit]||0;if(l===-1)continue;n=WJ(b,j),k[m]=n?-1:++l;if(n&&f.size===1)return!0;if(!n&&l===f.get(m).count)return!1}else{n=WJ(b,j);if(g^n)return n}}return h&&g}function D8(a,b,c){for(var d=this.context.data[a],e=d?d.values.value:[],f={},g={},h={},i,j,k,l,m,n,o,p,q,r=e.length,s=0,t,w;s<r;++s){for(i=e[s],l=i.unit,j=i.fields,k=i.values,t=0,w=j.length;t<w;++t)m=j[t],n=f[m.field]||(f[m.field]={}),o=n[l]||(n[l]=[]),h[m.field]=p=m.type.charAt(0),q=XJ[p+"_union"],n[l]=q(o,T(k[t]));c&&(o=g[l]||(g[l]=[]),o.push(T(k).reduce((v,x,u)=>(v[j[u].field]=x,v),{})))}return b=b||TJ,Object.keys(f).forEach(function(v){f[v]=Object.keys(f[v]).map(x=>f[v][x]).reduce((x,u)=>x===void 0?u:XJ[h[v]+"_"+b](x,u))}),e=Object.keys(g),c&&e.length&&(f[v8]=b===TJ?{[UJ]:e.reduce((v,x)=>(v.push.apply(v,g[x]),v),[])}:{[w8]:e.map(v=>({[UJ]:g[v]}))}),f}var XJ={E_union:function(a,b){if(!a.length)return b;for(var c=0,d=b.length;c<d;++c)a.indexOf(b[c])<0&&a.push(b[c]);return a},E_intersect:function(a,b){return a.length?a.filter(function(c){return b.indexOf(c)>=0}):b},R_union:function(a,b){var c=ic(b[0]),d=ic(b[1]);return c>d&&(c=b[1],d=b[0]),a.length?(a[0]>c&&(a[0]=c),a[1]<d&&(a[1]=d),a):[c,d]},R_intersect:function(a,b){var c=ic(b[0]),d=ic(b[1]);return c>d&&(c=b[1],d=b[0]),a.length?d<a[0]||a[1]<c?[]:(a[0]<c&&(a[0]=c),a[1]>d&&(a[1]=d),a):[c,d]}};const E8=":",F8="@";function YJ(a,b,c,d){b[0].type!==Jg&&H("First argument to selection functions must be a string literal.");const e=b[0].value,f=b.length>=2&&ra(b).value,g="unit",h=F8+g,i=E8+e;f===SJ&&!_(d,h)&&(d[h]=c.getData(e).indataRef(c,g)),_(d,i)||(d[i]=c.getData(e).tuplesRef())}function G8(a,b,c){if(!a)return[];const[d,e]=a,f=new gb().set(d[0],d[1],e[0],e[1]),g=c||this.context.dataflow.scenegraph().root;return nG(g,f,H8(b))}function H8(a){let b=null;if(a){const c=T(a.marktype),d=T(a.markname);b=e=>(!c.length||c.some(f=>e.marktype===f))&&(!d.length||d.some(f=>e.name===f))}return b}const Ik={random:function(){return Qc()},cumulativeNormal:zm,cumulativeLogNormal:$r,cumulativeUniform:ds,densityNormal:Wr,densityLogNormal:_r,densityUniform:cs,quantileNormal:Am,quantileLogNormal:as,quantileUniform:es,sampleNormal:ym,sampleLogNormal:Zr,sampleUniform:bs,isArray:J,isBoolean:bg,isDate:cg,isDefined:function(a){return a!==void 0},isNumber:Fa,isObject:Z,isRegExp:TS,isString:V,isTuple:cm,isValid:function(a){return a!=null&&a===a},toBoolean:mA,toDate:nA,toNumber:ic,toString:oA,flush:SS,lerp:US,merge:b8,pad:YS,peek:ra,span:$l,inrange:_i,truncate:_S,rgb:rf,lab:wn,hcl:xn,hsl:un,luminance:Kw,contrast:a8,sequence:gg,format:B6,utcFormat:C6,utcParse:E6,utcOffset:nB,utcSequence:qB,timeFormat:sJ,timeParse:D6,timeOffset:mB,timeSequence:pB,timeUnitSpecifier:XA,monthFormat:F6,monthAbbrevFormat:G6,dayFormat:H6,dayAbbrevFormat:I6,quarter:JS,utcquarter:KS,week:dB,utcweek:gB,dayofyear:cB,utcdayofyear:fB,warn:Z7,info:_7,debug:$7,extent:pe,inScope:Y7,intersect:G8,clampRange:LS,pinchDistance:e8,pinchAngle:f8,screen:s8,containerSize:u8,windowSize:t8,bandspace:g8,setdata:z6,pathShape:p8,panLinear:FS,panLog:GS,panPow:HS,panSymlog:IS,zoomLinear:fA,zoomLog:gA,zoomPow:Yq,zoomSymlog:hA,encode:A6,modify:d8},I8=["view","item","group","xy","x","y"],J8="event.vega.",ZJ="this.",Lw={};function K8(a){const b=KJ(a);I8.forEach(c=>b[c]=J8+c);for(let c in Ik)b[c]=ZJ+c;return la(b,U7(a,Ik,Lw)),b}function ob(a,b,c){return arguments.length===1?Ik[a]:(Ik[a]=b,c&&(Lw[a]=c),Mw&&(Mw.functions[a]=ZJ+a),this)}ob("bandwidth",h8,uc),ob("copy",i8,uc),ob("domain",j8,uc),ob("range",l8,uc),ob("invert",k8,uc),ob("scale",m8,uc),ob("gradient",n8,uc),ob("geoArea",V7,uc),ob("geoBounds",W7,uc),ob("geoCentroid",X7,uc),ob("geoShape",o8,uc),ob("indata",y6,T7),ob("data",rJ,Gw),ob("treePath",q8,Gw),ob("treeAncestors",r8,Gw),ob("vlSelectionTest",C8,YJ),ob("vlSelectionResolve",D8,YJ);const _J={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:a=>"_["+P(tJ+a)+"]",functions:K8,constants:JJ,visitors:Lw};var Mw=S7(_J);function Xd(a,b){var c={},d,e;try{a=V(a)?a:P(a)+"",d=IJ(a)}catch(f){H("Expression parse error: "+a)}return d.visit(f=>{if(f.type!==uJ)return;var g=f.callee.name,h=_J.visitors[g];h&&h(g,f.arguments,b,c)}),e=Mw(d),e.globals.forEach(f=>{var g=tJ+f;!_(c,g)&&b.getSignal(f)&&(c[g]=b.signalRef(f))}),{$expr:la({code:e.code},b.options.ast?{ast:d}:null),$fields:e.fields,$params:c}}function L8(a){const b=this,c=a.operators||[];return a.background&&(b.background=a.background),a.eventConfig&&(b.eventConfig=a.eventConfig),a.locale&&(b.locale=a.locale),c.forEach(d=>b.parseOperator(d)),c.forEach(d=>b.parseOperatorParameters(d)),(a.streams||[]).forEach(d=>b.parseStream(d)),(a.updates||[]).forEach(d=>b.parseUpdate(d)),b.resolve()}const M8=wb(["rule"]),$J=wb(["group","image","rect"]);function N8(a,b){let c="";return M8[b]?c:(a.x2&&(a.x?($J[b]&&(c+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),c+="o.width=o.x2-o.x;"):c+="o.x=o.x2-(o.width||0);"),a.xc&&(c+="o.x=o.xc-(o.width||0)/2;"),a.y2&&(a.y?($J[b]&&(c+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),c+="o.height=o.y2-o.y;"):c+="o.y=o.y2-(o.height||0);"),a.yc&&(c+="o.y=o.yc-(o.height||0)/2;"),c)}function Nw(a){return(a+"").toLowerCase()}function O8(a){return Nw(a)==="operator"}function P8(a){return Nw(a)==="collect"}function Jk(a,b,c){c[c.length-1]!==";"&&(c="return("+c+");");var d=Function.apply(null,b.concat(c));return a&&a.functions?d.bind(a.functions):d}function Q8(a,b,c,d){return`((u = ${a}) < (v = ${b}) || u == null) && v != null ? ${c}
  : (u > v || v == null) && u != null ? ${d}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${c}
  : v !== v && u === u ? ${d} : `}var R8={operator:(a,b)=>Jk(a,["_"],b.code),parameter:(a,b)=>Jk(a,["datum","_"],b.code),event:(a,b)=>Jk(a,["event"],b.code),handler:(a,b)=>{const c=`var datum=event.item&&event.item.datum;return ${b.code};`;return Jk(a,["_","event"],c)},encode:(a,b)=>{const{marktype:c,channels:d}=b;let e="var o=item,datum=o.datum,m=0,$;";for(const f in d){const g="o["+P(f)+"]";e+=`$=${d[f].code};if(${g}!==$)${g}=$,m=1;`}return e+=N8(d,c),e+="return m;",Jk(a,["item","_"],e)},codegen:{get(a){const b=`[${a.map(P).join("][")}]`,c=Function("_",`return _${b};`);return c.path=b,c},comparator(a,b){let c;const d=(f,g)=>{const h=b[g];let i,j;return f.path?(i=`a${f.path}`,j=`b${f.path}`):((c=c||{})["f"+g]=f,i=`this.f${g}(a)`,j=`this.f${g}(b)`),Q8(i,j,-h,h)},e=Function("a","b","var u, v; return "+a.map(d).join("")+"0;");return c?e.bind(c):e}}};function S8(a){const b=this;O8(a.type)||!a.type?b.operator(a,a.update?b.operatorExpression(a.update):null):b.transform(a,a.type)}function T8(a){const b=this;if(a.params){const c=b.get(a.id);c||H("Invalid operator id: "+a.id),b.dataflow.connect(c,c.parameters(b.parseParameters(a.params),a.react,a.initonly))}}function U8(a,b){b=b||{};const c=this;for(const d in a){const e=a[d];b[d]=J(e)?e.map(f=>aK(f,c,b)):aK(e,c,b)}return b}function aK(a,b,c){if(!a||!Z(a))return a;for(let d=0,e=bK.length,f;d<e;++d){f=bK[d];if(_(a,f.key))return f.parse(a,b,c)}return a}var bK=[{key:"$ref",parse:V8},{key:"$key",parse:X8},{key:"$expr",parse:W8},{key:"$field",parse:Y8},{key:"$encode",parse:_8},{key:"$compare",parse:Z8},{key:"$context",parse:$8},{key:"$subflow",parse:a9},{key:"$tupleid",parse:b9}];function V8(a,b){return b.get(a.$ref)||H("Operator not defined: "+a.$ref)}function W8(a,b,c){a.$params&&b.parseParameters(a.$params,c);const d="e:"+a.$expr.code+"_"+a.$name;return b.fn[d]||(b.fn[d]=Cc(b.parameterExpression(a.$expr),a.$fields,a.$name))}function X8(a,b){const c="k:"+a.$key+"_"+!!a.$flat;return b.fn[c]||(b.fn[c]=lA(a.$key,a.$flat,b.expr.codegen))}function Y8(a,b){if(!a.$field)return null;const c="f:"+a.$field+"_"+a.$name;return b.fn[c]||(b.fn[c]=Fd(a.$field,a.$name,b.expr.codegen))}function Z8(a,b){const c="c:"+a.$compare+"_"+a.$order,d=T(a.$compare).map(e=>e&&e.$tupleid?aa:e);return b.fn[c]||(b.fn[c]=iA(d,a.$order,b.expr.codegen))}function _8(a,b){const c=a.$encode,d={};for(const e in c){const f=c[e];d[e]=Cc(b.encodeExpression(f.$expr),f.$fields),d[e].output=f.$output}return d}function $8(a,b){return b}function a9(a,b){const c=a.$subflow;return function(d,e,f){const g=b.fork().parse(c),h=g.get(c.operators[0].id),i=g.signals.parent;return i&&i.set(f),h.detachSubflow=()=>b.detach(g),h}}function b9(){return aa}function c9(a){var b=this,c=a.filter!=null?b.eventExpression(a.filter):void 0,d=a.stream!=null?b.get(a.stream):void 0,e;a.source?d=b.events(a.source,a.type,c):a.merge&&(e=a.merge.map(f=>b.get(f)),d=e[0].merge.apply(e[0],e.slice(1))),a.between&&(e=a.between.map(f=>b.get(f)),d=d.between(e[0],e[1])),a.filter&&(d=d.filter(c)),a.throttle!=null&&(d=d.throttle(+a.throttle)),a.debounce!=null&&(d=d.debounce(+a.debounce)),d==null&&H("Invalid stream definition: "+JSON.stringify(a)),a.consume&&d.consume(!0),b.stream(a,d)}function d9(a){var b=this,c=Z(c=a.source)?c.$ref:c,d=b.get(c),e=null,f=a.update,g=void 0;d||H("Source not defined: "+a.source),e=a.target&&a.target.$expr?b.eventExpression(a.target.$expr):b.get(a.target),f&&f.$expr&&(f.$params&&(g=b.parseParameters(f.$params)),f=b.handlerExpression(f.$expr)),b.update(a,d,e,f,g)}var e9={skip:!0};function f9(a){var b=this,c={};if(a.signals){var d=c.signals={};Object.keys(b.signals).forEach(f=>{var g=b.signals[f];a.signals(f,g)&&(d[f]=g.value)})}if(a.data){var e=c.data={};Object.keys(b.data).forEach(f=>{var g=b.data[f];a.data(f,g)&&(e[f]=g.input.value)})}return b.subcontext&&a.recurse!==!1&&(c.subcontext=b.subcontext.map(f=>f.getState(a))),c}function g9(a){var b=this,c=b.dataflow,d=a.data,e=a.signals;Object.keys(e||{}).forEach(f=>{c.update(b.signals[f],e[f],e9)}),Object.keys(d||{}).forEach(f=>{c.pulse(b.data[f].input,c.changeset().remove(Gd).insert(d[f]))}),(a.subcontext||[]).forEach((f,g)=>{var h=b.subcontext[g];h&&h.setState(f)})}function cK(a,b,c,d){return new dK(a,b,c,d)}function dK(a,b,c,d){this.dataflow=a,this.transforms=b,this.events=a.events.bind(a),this.expr=d||R8,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},c&&(this.functions=Object.create(c),this.functions.context=this)}function eK(a){this.dataflow=a.dataflow,this.transforms=a.transforms,this.events=a.events,this.expr=a.expr,this.signals=Object.create(a.signals),this.scales=Object.create(a.scales),this.nodes=Object.create(a.nodes),this.data=Object.create(a.data),this.fn=Object.create(a.fn),a.functions&&(this.functions=Object.create(a.functions),this.functions.context=this)}dK.prototype=eK.prototype={fork(){const a=new eK(this);return(this.subcontext||(this.subcontext=[])).push(a),a},detach(a){this.subcontext=this.subcontext.filter(c=>c!==a);const b=Object.keys(a.nodes);for(const c of b)a.nodes[c]._targets=null;for(const c of b)a.nodes[c].detach();a.nodes=null},get(a){return this.nodes[a]},set(a,b){return this.nodes[a]=b},add(a,b){const c=this,d=c.dataflow,e=a.value;c.set(a.id,b),P8(a.type)&&e&&(e.$ingest?d.ingest(b,e.$ingest,e.$format):e.$request?d.preload(b,e.$request,e.$format):d.pulse(b,d.changeset().insert(e))),a.root&&(c.root=b);if(a.parent){var f=c.get(a.parent.$ref);f?(d.connect(f,[b]),b.targets().add(f)):(c.unresolved=c.unresolved||[]).push(()=>{f=c.get(a.parent.$ref),d.connect(f,[b]),b.targets().add(f)})}a.signal&&(c.signals[a.signal]=b),a.scale&&(c.scales[a.scale]=b);if(a.data)for(const g in a.data){const h=c.data[g]||(c.data[g]={});a.data[g].forEach(i=>h[i]=b)}},resolve(){return(this.unresolved||[]).forEach(a=>a()),delete this.unresolved,this},operator(a,b){this.add(a,this.dataflow.add(a.value,b))},transform(a,b){this.add(a,this.dataflow.add(this.transforms[Nw(b)]))},stream(a,b){this.set(a.id,b)},update(a,b,c,d,e){this.dataflow.on(b,c,d,e,a.options)},operatorExpression(a){return this.expr.operator(this,a)},parameterExpression(a){return this.expr.parameter(this,a)},eventExpression(a){return this.expr.event(this,a)},handlerExpression(a){return this.expr.handler(this,a)},encodeExpression(a){return this.expr.encode(this,a)},parse:L8,parseOperator:S8,parseOperatorParameters:T8,parseParameters:U8,parseStream:c9,parseUpdate:d9,getState:f9,setState:g9};function h9(a,b,c){return cK(a,Gh,Ik,c).parse(b)}function i9(a){var b=this._runtime.scales;return _(b,a)||H("Unrecognized scale or projection: "+a),b[a].value}var fK="width",gK="height",Ow="padding",hK={skip:!0};function iK(a,b){var c=a.autosize(),d=a.padding();return b-(c&&c.contains===Ow?d.left+d.right:0)}function jK(a,b){var c=a.autosize(),d=a.padding();return b-(c&&c.contains===Ow?d.top+d.bottom:0)}function j9(a){var b=a._signals,c=b[fK],d=b[gK],e=b[Ow];function f(){a._autosize=a._resize=1}a._resizeWidth=a.add(null,function(h){a._width=h.size,a._viewWidth=iK(a,h.size),f()},{size:c}),a._resizeHeight=a.add(null,function(h){a._height=h.size,a._viewHeight=jK(a,h.size),f()},{size:d});var g=a.add(null,f,{pad:e});a._resizeWidth.rank=c.rank+1,a._resizeHeight.rank=d.rank+1,g.rank=e.rank+1}function k9(a,b,c,d,e,f){this.runAfter(function(g){var h=0;g._autosize=0,g.width()!==c&&(h=1,g.signal(fK,c,hK),g._resizeWidth.skip(!0)),g.height()!==d&&(h=1,g.signal(gK,d,hK),g._resizeHeight.skip(!0)),g._viewWidth!==a&&(g._resize=1,g._viewWidth=a),g._viewHeight!==b&&(g._resize=1,g._viewHeight=b),(g._origin[0]!==e[0]||g._origin[1]!==e[1])&&(g._resize=1,g._origin=e),h&&g.run("enter"),f&&g.runAfter(i=>i.resize())},!1,1)}function l9(a){return this._runtime.getState(a||{data:m9,signals:n9,recurse:!0})}function m9(a,b){return b.modified&&J(b.input.value)&&a.indexOf("_:vega:_")}function n9(a,b){return!(a==="parent"||b instanceof Gh.proxy)}function o9(a){return this.runAsync(null,b=>{b._trigger=!1,b._runtime.setState(a)},b=>{b._trigger=!0}),this}function p9(a,b){function c(d){a({timestamp:Date.now(),elapsed:d})}this._timers.push(K3(c,b))}function q9(a,b,c,d){var e=a.element();e&&e.setAttribute("title",r9(d))}function r9(a){return a==null?"":J(a)?kK(a):Z(a)&&!cg(a)?s9(a):a+""}function s9(a){return Object.keys(a).map(function(b){var c=a[b];return b+": "+(J(c)?kK(c):lK(c))}).join(`
`)}function kK(a){return"["+a.map(lK).join(", ")+"]"}function lK(a){return J(a)?"[…]":Z(a)&&!cg(a)?"{…}":a}function mK(a,b){const c=this;b=b||{},Fh.call(c),b.loader&&c.loader(b.loader),b.logger&&c.logger(b.logger),b.logLevel!=null&&c.logLevel(b.logLevel);if(b.locale||a.locale){const f=la({},a.locale,b.locale);c.locale(NB(f.number,f.time))}c._el=null,c._elBind=null,c._renderType=b.renderer||tf.Canvas,c._scenegraph=new zt();const d=c._scenegraph.root;c._renderer=null,c._tooltip=b.tooltip||q9,c._redraw=!0,c._handler=new Ij().scene(d),c._globalCursor=!1,c._preventDefault=!1,c._timers=[],c._eventListeners=[],c._resizeListeners=[],c._eventConfig=c6(a.eventConfig),c.globalCursor(c._eventConfig.globalCursor);const e=h9(c,a,b.expr);c._runtime=e,c._signals=e.signals,c._bind=(a.bindings||[]).map(f=>({state:null,param:la({},f)})),e.root&&e.root.set(d),d.source=e.data.root.input,c.pulse(e.data.root.input,c.changeset().insert(d.items)),c._width=c.width(),c._height=c.height(),c._viewWidth=iK(c,c._width),c._viewHeight=jK(c,c._height),c._origin=[0,0],c._resize=0,c._autosize=1,j9(c),T5(c),U5(c),c.description(a.description),b.hover&&c.hover(),b.container&&c.initialize(b.container,b.bind)}var ia=N(mK,Fh);ia.evaluate=async function(a,b,c){await Fh.prototype.evaluate.call(this,a,b);if(this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Y5(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(d){this.error(d)}return c&&bm(this,c),this},ia.dirty=function(a){this._redraw=!0,this._renderer&&this._renderer.dirty(a)},ia.description=function(a){if(arguments.length){const b=a!=null?a+"":null;return b!==this._desc&&iJ(this._el,this._desc=b),this}return this._desc},ia.container=function(){return this._el},ia.scenegraph=function(){return this._scenegraph},ia.origin=function(){return this._origin.slice()};function Yo(a,b){return _(a._signals,b)?a._signals[b]:H("Unrecognized signal name: "+P(b))}ia.signal=function(a,b,c){var d=Yo(this,a);return arguments.length===1?d.value:this.update(d,b,c)},ia.width=function(a){return arguments.length?this.signal("width",a):this.signal("width")},ia.height=function(a){return arguments.length?this.signal("height",a):this.signal("height")},ia.padding=function(a){return arguments.length?this.signal("padding",qJ(a)):qJ(this.signal("padding"))},ia.autosize=function(a){return arguments.length?this.signal("autosize",a):this.signal("autosize")},ia.background=function(a){return arguments.length?this.signal("background",a):this.signal("background")},ia.renderer=function(a){return arguments.length?(Kn(a)||H("Unrecognized renderer type: "+a),a!==this._renderType&&(this._renderType=a,this._resetRenderer()),this):this._renderType},ia.tooltip=function(a){return arguments.length?(a!==this._tooltip&&(this._tooltip=a,this._resetRenderer()),this):this._tooltip},ia.loader=function(a){return arguments.length?(a!==this._loader&&(Fh.prototype.loader.call(this,a),this._resetRenderer()),this):this._loader},ia.resize=function(){return this._autosize=1,this.touch(Yo(this,"autosize"))},ia._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},ia._resizeView=k9,ia.addEventListener=function(a,b,c){var d=b;return c&&c.trap===!1||(d=uw(this,b),d.raw=b),this._handler.on(a,d),this},ia.removeEventListener=function(a,b){for(var c=this._handler.handlers(a),d=c.length,e,f;--d>=0;){f=c[d].type,e=c[d].handler;if(a===f&&(b===e||b===e.raw)){this._handler.off(f,e);break}}return this},ia.addResizeListener=function(a){var b=this._resizeListeners;return b.indexOf(a)<0&&b.push(a),this},ia.removeResizeListener=function(a){var b=this._resizeListeners,c=b.indexOf(a);return c>=0&&b.splice(c,1),this};function nK(a,b){const c=(a._targets||[]).filter(d=>d._update&&d._update.handler===b);return c.length?c[0]:null}function oK(a,b,c,d){var e=nK(c,d);return e||(e=uw(a,()=>d(b,c.value)),e.handler=d,a.on(c,null,e)),a}function pK(a,b,c){var d=nK(b,c);return d&&b._targets.remove(d),a}ia.addSignalListener=function(a,b){return oK(this,a,Yo(this,a),b)},ia.removeSignalListener=function(a,b){return pK(this,Yo(this,a),b)},ia.addDataListener=function(a,b){return oK(this,a,Lo(this,a).values,b)},ia.removeDataListener=function(a,b){return pK(this,Lo(this,a).values,b)},ia.globalCursor=function(a){if(arguments.length){if(this._globalCursor!==!!a){const b=tw(this,null);this._globalCursor=!!a,b&&tw(this,b)}return this}else return this._globalCursor},ia.preventDefault=function(a){return arguments.length?(this._preventDefault=a,this):this._preventDefault},ia.timer=p9,ia.events=e6,ia.finalize=g6,ia.hover=f6,ia.data=V5,ia.change=Mo,ia.insert=W5,ia.remove=X5,ia.scale=i9,ia.initialize=s6,ia.toImageURL=u6,ia.toCanvas=w6,ia.toSVG=x6,ia.getState=l9,ia.setState=o9;function t9(a){return Z(a)?a:{type:a||"pad"}}const Kk=a=>+a||0,u9=a=>({top:a,bottom:a,left:a,right:a});function v9(a){return Z(a)?a.signal?a:{top:Kk(a.top),bottom:Kk(a.bottom),left:Kk(a.left),right:Kk(a.right)}:u9(Kk(a))}const pb=a=>Z(a)&&!J(a)?la({},a):{value:a};function qK(a,b,c,d){return c!=null?(Z(c)&&!J(c)?a.update[b]=c:a[d||"enter"][b]={value:c},1):0}function Eb(a,b,c){for(const d in b)qK(a,d,b[d]);for(const d in c)qK(a,d,c[d],"update")}function ri(a,b,c){for(const d in b){if(c&&_(c,d))continue;a[d]=la(a[d]||{},b[d])}return a}function si(a,b){return b&&(b.enter&&b.enter[a]||b.update&&b.update[a])}var Pw="mark",Qw="frame",Rw="scope",w9="axis",x9="axis-domain",y9="axis-grid",z9="axis-label",A9="axis-tick",B9="axis-title",C9="legend",D9="legend-band",E9="legend-entry",F9="legend-gradient",rK="legend-label",G9="legend-symbol",H9="legend-title",I9="title",J9="title-text",K9="title-subtitle";function L9(a,b,c,d,e){const f={},g={};let h,i,j,k;i="lineBreak",b==="text"&&e[i]!=null&&!si(i,a)&&Sw(f,i,e[i]),(c=="legend"||String(c).startsWith("axis"))&&(c=null),k=c===Qw?e.group:c===Pw?la({},e.mark,e[b]):null;for(i in k)j=si(i,a)||(i==="fill"||i==="stroke")&&(si("fill",a)||si("stroke",a)),j||Sw(f,i,k[i]);T(d).forEach(l=>{const m=e.style&&e.style[l];for(const n in m)si(n,a)||Sw(f,n,m[n])}),a=la({},a);for(i in f)k=f[i],k.signal?(h=h||{})[i]=k:g[i]=k;return a.enter=la(g,a.enter),h&&(a.update=la(h,a.update)),a}function Sw(a,b,c){a[b]=c&&c.signal?{signal:c.signal}:{value:c}}const sK=a=>V(a)?P(a):a.signal?`(${a.signal})`:tK(a);function Zo(a){if(a.gradient!=null)return N9(a);let b=a.signal?`(${a.signal})`:a.color?M9(a.color):a.field!=null?tK(a.field):a.value!==void 0?P(a.value):void 0;return a.scale!=null&&(b=O9(a,b)),b===void 0&&(b=null),a.exponent!=null&&(b=`pow(${b},${$o(a.exponent)})`),a.mult!=null&&(b+=`*${$o(a.mult)}`),a.offset!=null&&(b+=`+${$o(a.offset)}`),a.round&&(b=`round(${b})`),b}const _o=(a,b,c,d)=>`(${a}(${[b,c,d].map(Zo).join(",")})+'')`;function M9(a){return a.c?_o("hcl",a.h,a.c,a.l):a.h||a.s?_o("hsl",a.h,a.s,a.l):a.l||a.a?_o("lab",a.l,a.a,a.b):a.r||a.g||a.b?_o("rgb",a.r,a.g,a.b):null}function N9(a){const b=[a.start,a.stop,a.count].map(c=>c==null?null:P(c));for(;b.length&&ra(b)==null;)b.pop();return b.unshift(sK(a.gradient)),`gradient(${b.join(",")})`}function $o(a){return Z(a)?"("+Zo(a)+")":a}function tK(a){return uK(Z(a)?a:{datum:a})}function uK(a){let b,c,d;if(a.signal)b="datum",d=a.signal;else if(a.group||a.parent){for(c=Math.max(1,a.level||1),b="item";c-- >0;)b+=".mark.group";a.parent?(d=a.parent,b+=".datum"):d=a.group}else a.datum?(b="datum",d=a.datum):H("Invalid field reference: "+P(a));return a.signal||(d=V(d)?oe(d).map(P).join("]["):uK(d)),b+"["+d+"]"}function O9(a,b){const c=sK(a.scale);return a.range!=null?b=`lerp(_range(${c}), ${+a.range})`:(b!==void 0&&(b=`_scale(${c}, ${b})`),a.band&&(b=(b?b+"+":"")+`_bandwidth(${c})`+(+a.band===1?"":"*"+$o(a.band)),a.extra&&(b=`(datum.extra ? _scale(${c}, datum.extra.value) : ${b})`)),b==null&&(b="0")),b}function P9(a){let b="";return a.forEach(c=>{const d=Zo(c);b+=c.test?`(${c.test})?${d}:`:d}),ra(b)===":"&&(b+="null"),b}function vK(a,b,c,d,e,f){const g={};f=f||{},f.encoders={$encode:g},a=L9(a,b,c,d,e.config);for(const h in a)g[h]=Q9(a[h],b,f,e);return f}function Q9(a,b,c,d){const e={},f={};for(const g in a)a[g]!=null&&(e[g]=S9(R9(a[g]),d,c,f));return{$expr:{marktype:b,channels:e},$fields:Object.keys(f),$output:Object.keys(a)}}function R9(a){return J(a)?P9(a):Zo(a)}function S9(a,b,c,d){const e=Xd(a,b);return e.$fields.forEach(f=>d[f]=1),la(c,e.$params),e.$expr}var T9="outer",U9=["value","update","init","react","bind"];function wK(a,b){H(a+' for "outer" push: '+P(b))}function xK(a,b){var c=a.name;if(a.push===T9)b.signals[c]||wK("No prior signal definition",c),U9.forEach(function(e){a[e]!==void 0&&wK("Invalid property ",e)});else{var d=b.addSignal(c,a.value);a.react===!1&&(d.react=!1),a.bind&&b.addBinding(c,a.bind)}}function Tw(a,b,c,d){this.id=-1,this.type=a,this.value=b,this.params=c,d&&(this.parent=d)}function ap(a,b,c,d){return new Tw(a,b,c,d)}function bp(a,b){return ap("operator",a,b)}function ca(a){var b={$ref:a.id};return a.id<0&&(a.refs=a.refs||[]).push(b),b}function Lk(a,b){return b?{$field:a,$name:b}:{$field:a}}var Uw=Lk("key");function yK(a,b){return{$compare:a,$order:b}}function V9(a,b){var c={$key:a};return b&&(c.$flat=!0),c}var W9="ascending",X9="descending";function Y9(a){return Z(a)?(a.order===X9?"-":"+")+cp(a.op,a.field):""}function cp(a,b){return(a&&a.signal?"$"+a.signal:a||"")+(a&&b?"_":"")+(b&&b.signal?"$"+b.signal:b||"")}var Vw="scope",Ww="view";function qb(a){return a&&a.signal}function Z9(a){return a&&a.expr}function Mk(a){if(qb(a))return!0;if(Z(a)){for(var b in a)if(Mk(a[b]))return!0}return!1}function td(a,b){return a!=null?a:b}function Ng(a){return a&&a.signal||a}var zK="timer";function Nk(a,b){var c=a.merge?$9:a.stream?aaa:a.type?baa:H("Invalid stream specification: "+P(a));return c(a,b)}function _9(a){return a===Vw?Ww:a||Ww}function $9(a,b){var c=a.merge.map(e=>Nk(e,b)),d=Xw({merge:c},a,b);return b.addStream(d).id}function aaa(a,b){var c=Nk(a.stream,b),d=Xw({stream:c},a,b);return b.addStream(d).id}function baa(a,b){var c,d;return a.type===zK?(c=b.event(zK,a.throttle),a={between:a.between,filter:a.filter}):c=b.event(_9(a.source),a.type),d=Xw({stream:c},a,b),Object.keys(d).length===1?c:b.addStream(d).id}function Xw(a,b,c){var d=b.between;return d&&(d.length!==2&&H('Stream "between" parameter must have 2 entries: '+P(b)),a.between=[Nk(d[0],c),Nk(d[1],c)]),d=b.filter?[].concat(b.filter):[],(b.marktype||b.markname||b.markrole)&&d.push(caa(b.marktype,b.markname,b.markrole)),b.source===Vw&&d.push("inScope(event.item)"),d.length&&(a.filter=Xd("("+d.join(")&&(")+")",c).$expr),(d=b.throttle)!=null&&(a.throttle=+d),(d=b.debounce)!=null&&(a.debounce=+d),b.consume&&(a.consume=!0),a}function caa(a,b,c){var d="event.item";return d+(a&&a!=="*"?"&&"+d+".mark.marktype==='"+a+"'":"")+(c?"&&"+d+".mark.role==='"+c+"'":"")+(b?"&&"+d+".mark.name==='"+b+"'":"")}function Og(a,b,c){return DK=b||daa,EK=c||iaa,FK(a.trim()).map(Yw)}var daa="view",dp="[",ep="]",AK="{",BK="}",eaa=":",CK=",",faa="@",gaa=">",haa=/[[\]{}]/,DK,EK,iaa={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function jaa(a){return EK[a]}function Ok(a,b,c,d,e){for(var f=0,g=a.length,h;b<g;++b){h=a[b];if(!f&&h===c)return b;e&&e.indexOf(h)>=0?--f:d&&d.indexOf(h)>=0&&++f}return b}function FK(a){for(var b=[],c=0,d=a.length,e=0;e<d;)e=Ok(a,e,CK,dp+AK,ep+BK),b.push(a.substring(c,e).trim()),c=++e;if(b.length===0)throw"Empty event selector: "+a;return b}function Yw(a){return a[0]==="["?kaa(a):laa(a)}function kaa(a){var b=a.length,c=1,d,e;c=Ok(a,c,ep,dp,ep);if(c===b)throw"Empty between selector: "+a;d=FK(a.substring(1,c));if(d.length!==2)throw"Between selector must have two elements: "+a;a=a.slice(c+1).trim();if(a[0]!==gaa)throw"Expected '>' after between selector: "+a;return d=d.map(Yw),e=Yw(a.slice(1).trim()),e.between?{between:d,stream:e}:(e.between=d,e)}function laa(a){var b={source:DK},c=[],d=[0,0],e=0,f=0,g=a.length,h=0,i,j;if(a[g-1]===BK){h=a.lastIndexOf(AK);if(h>=0){try{d=maa(a.substring(h+1,g-1))}catch(k){throw"Invalid throttle specification: "+a}a=a.slice(0,h).trim(),g=a.length}else throw"Unmatched right brace: "+a;h=0}if(!g)throw a;a[0]===faa&&(e=++h),i=Ok(a,h,eaa),i<g&&(c.push(a.substring(f,i).trim()),f=h=++i),h=Ok(a,h,dp);if(h===g)c.push(a.substring(f,g).trim());else{c.push(a.substring(f,h).trim()),j=[],f=++h;if(f===g)throw"Unmatched left bracket: "+a}for(;h<g;){h=Ok(a,h,ep);if(h===g)throw"Unmatched left bracket: "+a;j.push(a.substring(f,h).trim());if(h<g-1&&a[++h]!==dp)throw"Expected left bracket: "+a;f=++h}if(!(g=c.length)||haa.test(c[g-1]))throw"Invalid event selector: "+a;return g>1?(b.type=c[1],e?b.markname=c[0].slice(1):jaa(c[0])?b.marktype=c[0]:b.source=c[0]):b.type=c[0],b.type.slice(-1)==="!"&&(b.consume=!0,b.type=b.type.slice(0,-1)),j!=null&&(b.filter=j),d[0]&&(b.throttle=d[0]),d[1]&&(b.debounce=d[1]),b}function maa(a){var b=a.split(CK);if(!a.length||b.length>2)throw a;return b.map(function(c){var d=+c;if(d!==d)throw a;return d})}const naa={code:"_.$value",ast:{type:"Identifier",value:"value"}};function oaa(a,b,c){var d=a.events,e=a.update,f=a.encode,g=[],h={target:c};d||H("Signal update missing events specification."),V(d)&&(d=Og(d,b.isSubscope()?Vw:Ww)),d=T(d).filter(i=>i.signal||i.scale?(g.push(i),0):1),g.length>1&&(g=[qaa(g)]),d.length&&g.push(d.length>1?{merge:d}:d[0]),f!=null&&(e&&H("Signal encode and update are mutually exclusive."),e="encode(item(),"+P(f)+")"),h.update=V(e)?Xd(e,b):e.expr!=null?Xd(e.expr,b):e.value!=null?e.value:e.signal!=null?{$expr:naa,$params:{$value:b.signalRef(e.signal)}}:H("Invalid signal update specification."),a.force&&(h.options={force:!0}),g.forEach(function(i){b.addUpdate(la(paa(i,b),h))})}function paa(a,b){return{source:a.signal?b.signalRef(a.signal):a.scale?b.scaleRef(a.scale):Nk(a,b)}}function qaa(a){return{signal:"["+a.map(b=>b.scale?'scale("'+b.scale+'")':b.signal)+"]"}}function raa(a,b){var c=b.getSignal(a.name),d=a.update;a.init&&(d?H("Signals can not include both init and update expressions."):(d=a.init,c.initonly=!0)),d&&(d=Xd(d,b),c.update=d.$expr,c.params=d.$params),a.on&&a.on.forEach(function(e){oaa(e,b,c.id)})}const Da=a=>(b,c,d)=>ap(a,c,b||void 0,d);var GK=Da("aggregate"),saa=Da("axisticks"),HK=Da("bound"),ud=Da("collect"),IK=Da("compare"),taa=Da("datajoin"),JK=Da("encode"),uaa=Da("expression"),vaa=Da("facet"),waa=Da("field"),xaa=Da("key"),yaa=Da("legendentries"),zaa=Da("load"),Aaa=Da("mark"),Baa=Da("multiextent"),Caa=Da("multivalues"),Daa=Da("overlap"),Eaa=Da("params"),KK=Da("prefacet"),Faa=Da("projection"),Gaa=Da("proxy"),Haa=Da("relay"),LK=Da("render"),Iaa=Da("scale"),Pg=Da("sieve"),Jaa=Da("sortitems"),MK=Da("viewlayout"),Kaa=Da("values"),Laa=0,NK={min:"min",max:"max",count:"sum"};function Maa(a,b){var c=a.type||"linear";EF(c)||H("Unrecognized scale type: "+P(c)),b.addScale(a.name,{type:c,domain:void 0})}function Naa(a,b){var c=b.getScale(a.name).params,d;c.domain=OK(a.domain,a,b),a.range!=null&&(c.range=QK(a,b,c)),a.interpolate!=null&&Xaa(a.interpolate,c),a.nice!=null&&(c.nice=Waa(a.nice)),a.bins!=null&&(c.bins=Vaa(a.bins,b));for(d in a){if(_(c,d)||d==="name")continue;c[d]=Zc(a[d],b)}}function Zc(a,b){return Z(a)?a.signal?b.signalRef(a.signal):H("Unsupported object: "+P(a)):a}function fp(a,b){return a.signal?b.signalRef(a.signal):a.map(c=>Zc(c,b))}function gp(a){H("Can not find data set: "+P(a))}function OK(a,b,c){if(!a){(b.domainMin!=null||b.domainMax!=null)&&H("No scale domain defined for domainMin/domainMax to override.");return}return a.signal?c.signalRef(a.signal):(J(a)?Oaa:a.fields?Qaa:Paa)(a,b,c)}function Oaa(a,b,c){return a.map(function(d){return Zc(d,c)})}function Paa(a,b,c){var d=c.getData(a.data);return d||gp(a.data),ai(b.type)?d.valuesRef(c,a.field,PK(a.sort,!1)):HF(b.type)?d.domainRef(c,a.field):d.extentRef(c,a.field)}function Qaa(a,b,c){var d=a.data,e=a.fields.reduce(function(f,g){return g=V(g)?{data:d,field:g}:J(g)||g.signal?Raa(g,c):g,f.push(g),f},[]);return(ai(b.type)?Saa:HF(b.type)?Taa:Uaa)(a,c,e)}function Raa(a,b){var c="_:vega:_"+Laa++,d=ud({});if(J(a))d.value={$ingest:a};else if(a.signal){var e="setdata("+P(c)+","+a.signal+")";d.params.input=b.signalRef(e)}return b.addDataPipeline(c,[d,Pg({})]),{data:c,field:"data"}}function Saa(a,b,c){var d=PK(a.sort,!0),e,f,g,h,i;return e=c.map(function(j){var k=b.getData(j.data);return k||gp(j.data),k.countsRef(b,j.field,d)}),f={groupby:Uw,pulse:e},d&&(g=d.op||"count",i=d.field?cp(g,d.field):"count",f.ops=[NK[g]],f.fields=[b.fieldRef(i)],f.as=[i]),g=b.add(GK(f)),h=b.add(ud({pulse:ca(g)})),i=b.add(Kaa({field:Uw,sort:b.sortRef(d),pulse:ca(h)})),ca(i)}function PK(a,b){return a&&(!a.field&&!a.op?Z(a)?a.field="key":a={field:"key"}:!a.field&&a.op!=="count"?H("No field provided for sort aggregate op: "+a.op):b&&a.field&&(a.op&&!NK[a.op]&&H("Multiple domain scales can not be sorted using "+a.op))),a}function Taa(a,b,c){var d=c.map(function(e){var f=b.getData(e.data);return f||gp(e.data),f.domainRef(b,e.field)});return ca(b.add(Caa({values:d})))}function Uaa(a,b,c){var d=c.map(function(e){var f=b.getData(e.data);return f||gp(e.data),f.extentRef(b,e.field)});return ca(b.add(Baa({extents:d})))}function Vaa(a,b){return a.signal||J(a)?fp(a,b):b.objectProperty(a)}function Waa(a){return Z(a)?{interval:Zc(a.interval),step:Zc(a.step)}:Zc(a)}function Xaa(a,b){b.interpolate=Zc(a.type||a),a.gamma!=null&&(b.interpolateGamma=Zc(a.gamma))}function QK(a,b,c){var d=a.range,e=b.config.range;if(d.signal)return b.signalRef(d.signal);if(V(d)){if(e&&_(e,d))return a=la({},a,{range:e[d]}),QK(a,b,c);d==="width"?d=[0,{signal:"width"}]:d==="height"?d=ai(a.type)?[0,{signal:"height"}]:[{signal:"height"},0]:H("Unrecognized scale range value: "+P(d))}else if(d.scheme){c.scheme=J(d.scheme)?fp(d.scheme,b):Zc(d.scheme,b),d.extent&&(c.schemeExtent=fp(d.extent,b)),d.count&&(c.schemeCount=Zc(d.count,b));return}else if(d.step){c.rangeStep=Zc(d.step,b);return}else{if(ai(a.type)&&!J(d))return OK(d,a,b);J(d)||H("Unsupported range type: "+P(d))}return d.map(f=>(J(f)?fp:Zc)(f,b))}function Yaa(a,b){var c=b.config.projection||{},d={};for(var e in a){if(e==="name")continue;d[e]=Zw(a[e],e,b)}for(e in c)d[e]==null&&(d[e]=Zw(c[e],e,b));b.addProjection(a.name,d)}function Zw(a,b,c){return J(a)?a.map(function(d){return Zw(d,b,c)}):Z(a)?a.signal?c.signalRef(a.signal):b==="fit"?a:H("Unsupported parameter object: "+P(a)):a}const vd="top",ti="left",ui="right",xf="bottom",RK="center",Zaa="vertical",_aa="start",$aa="middle",aba="end",_w="index",$w="label",bba="offset",vi="perc",cba="perc2",_c="value",Pk="guide-label",ax="guide-title",dba="group-title",eba="group-subtitle",SK="symbol",hp="gradient",bx="discrete",cx="size",fba="shape",gba="fill",hba="stroke",iba="strokeWidth",jba="strokeDash",kba="opacity",dx=[cx,fba,gba,hba,iba,jba,kba],Qk={name:1,style:1,interactive:1},ta={value:0},$c={value:1};var ip="group",TK="rect",ex="rule",lba="symbol",Qg="text";function Rk(a){return a.type=ip,a.interactive=a.interactive||!1,a}function vc(a,b){const c=(d,e)=>td(a[d],td(b[d],e));return c.isVertical=d=>Zaa===td(a.direction,b.direction||(d?b.symbolDirection:b.gradientDirection)),c.gradientLength=()=>td(a.gradientLength,b.gradientLength||b.gradientWidth),c.gradientThickness=()=>td(a.gradientThickness,b.gradientThickness||b.gradientHeight),c.entryColumns=()=>td(a.columns,td(b.columns,+c.isVertical(!0))),c}function UK(a,b){var c=b&&(b.update&&b.update[a]||b.enter&&b.enter[a]);return c&&c.signal?c:c?c.value:null}function mba(a,b,c){var d=b.config.style[c];return d&&d[a]}function jp(a,b,c){return`item.anchor === '${_aa}' ? ${a} : item.anchor === '${aba}' ? ${b} : ${c}`}const fx=jp(P(ti),P(ui),P(RK));function nba(a){let b=a("tickBand"),c=a("tickOffset"),d,e;return b?b.signal?(d={signal:`(${b.signal}) === 'extent' ? 1 : 0.5`},e={signal:`(${b.signal}) === 'extent'`},Z(c)||(c={signal:`(${b.signal}) === 'extent' ? 0 : ${c}`})):b==="extent"?(d=1,e=!0,c=0):(d=.5,e=!1):(d=a("bandPosition"),e=a("tickExtra")),{extra:e,band:d,offset:c}}function VK(a,b){return b?a?Z(a)?Object.assign({},a,{offset:VK(a.offset,b)}):{value:a,offset:b}:b:a}function Kc(a,b){return b?(a.name=b.name,a.style=b.style||a.style,a.interactive=!!b.interactive,a.encode=ri(a.encode,b,Qk)):a.interactive=!1,a}function oba(a,b,c,d){var e=vc(a,c),f=e.isVertical(),g=e.gradientThickness(),h=e.gradientLength(),i,j,k,l,m,n;return f?(k=[0,1],l=[0,0],m=g,n=h):(k=[0,0],l=[1,0],m=h,n=g),i={enter:j={opacity:ta,x:ta,y:ta,width:pb(m),height:pb(n)},update:la({},j,{opacity:$c,fill:{gradient:b,start:k,stop:l}}),exit:{opacity:ta}},Eb(i,{stroke:e("gradientStrokeColor"),strokeWidth:e("gradientStrokeWidth")},{opacity:e("gradientOpacity")}),Kc({type:TK,role:F9,encode:i},d)}function pba(a,b,c,d,e){var f=vc(a,c),g=f.isVertical(),h=f.gradientThickness(),i=f.gradientLength(),j,k,l,m,n,o,p="";return g?(l="y",n="y2",m="x",o="width",p="1-"):(l="x",n="x2",m="y",o="height"),k={opacity:ta,fill:{scale:b,field:_c}},k[l]={signal:p+"datum."+vi,mult:i},k[m]=ta,k[n]={signal:p+"datum."+cba,mult:i},k[o]=pb(h),j={enter:k,update:la({},k,{opacity:$c}),exit:{opacity:ta}},Eb(j,{stroke:f("gradientStrokeColor"),strokeWidth:f("gradientStrokeWidth")},{opacity:f("gradientOpacity")}),Kc({type:TK,role:D9,key:_c,from:e,encode:j},d)}const qba=`datum.${vi}<=0?"${ti}":datum.${vi}>=1?"${ui}":"${RK}"`,rba=`datum.${vi}<=0?"${xf}":datum.${vi}>=1?"${vd}":"${$aa}"`;function WK(a,b,c,d){var e=vc(a,b),f=e.isVertical(),g=pb(e.gradientThickness()),h=e.gradientLength(),i=e("labelOverlap"),j,k,l,m,n,o="";return j={enter:k={opacity:ta},update:l={opacity:$c,text:{field:$w}},exit:{opacity:ta}},Eb(j,{fill:e("labelColor"),fillOpacity:e("labelOpacity"),font:e("labelFont"),fontSize:e("labelFontSize"),fontStyle:e("labelFontStyle"),fontWeight:e("labelFontWeight"),limit:td(a.labelLimit,b.gradientLabelLimit)}),f?(k.align={value:"left"},k.baseline=l.baseline={signal:rba},m="y",n="x",o="1-"):(k.align=l.align={signal:qba},k.baseline={value:"top"},m="x",n="y"),k[m]=l[m]={signal:o+"datum."+vi,mult:h},k[n]=l[n]=g,g.offset=td(a.labelOffset,b.gradientLabelOffset)||0,i=i?{separation:e("labelSeparation"),method:i,order:"datum."+_w}:void 0,Kc({type:Qg,role:rK,style:Pk,key:_c,from:d,encode:j,overlap:i},c)}function sba(a,b,c,d,e){var f=vc(a,b),g=c.entries,h=!!(g&&g.interactive),i=g?g.name:void 0,j=f("clipHeight"),k=f("symbolOffset"),l={data:"value"},m={},n=`(${e}) ? datum.${bba} : datum.${cx}`,o=j?pb(j):{field:cx},p=`datum.${_w}`,q=`max(1, ${e})`,r,s,t,w,v,x,u;o.mult=.5,m={enter:r={opacity:ta,x:{signal:n,mult:.5,offset:k},y:o},update:s={opacity:$c,x:r.x,y:r.y},exit:{opacity:ta}};var z=null,y=null;return a.fill||(z=b.symbolBaseFillColor,y=b.symbolBaseStrokeColor),Eb(m,{fill:f("symbolFillColor",z),shape:f("symbolType"),size:f("symbolSize"),stroke:f("symbolStrokeColor",y),strokeDash:f("symbolDash"),strokeDashOffset:f("symbolDashOffset"),strokeWidth:f("symbolStrokeWidth")},{opacity:f("symbolOpacity")}),dx.forEach(function(B){a[B]&&(s[B]=r[B]={scale:a[B],field:_c})}),w=Kc({type:lba,role:G9,key:_c,from:l,clip:j?!0:void 0,encode:m},c.symbols),t=pb(k),t.offset=f("labelOffset"),m={enter:r={opacity:ta,x:{signal:n,offset:t},y:o},update:s={opacity:$c,text:{field:$w},x:r.x,y:r.y},exit:{opacity:ta}},Eb(m,{align:f("labelAlign"),baseline:f("labelBaseline"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontStyle:f("labelFontStyle"),fontWeight:f("labelFontWeight"),limit:f("labelLimit")}),v=Kc({type:Qg,role:rK,style:Pk,key:_c,from:l,encode:m},c.labels),m={enter:{noBound:{value:!j},width:ta,height:j?pb(j):ta,opacity:ta},exit:{opacity:ta},update:s={opacity:$c,row:{signal:null},column:{signal:null}}},f.isVertical(!0)?(x=`ceil(item.mark.items.length / ${q})`,s.row.signal=`${p}%${x}`,s.column.signal=`floor(${p} / ${x})`,u={field:["row",p]}):(s.row.signal=`floor(${p} / ${q})`,s.column.signal=`${p} % ${q}`,u={field:p}),s.column.signal=`(${e})?${s.column.signal}:${p}`,d={facet:{data:d,name:"value",groupby:_w}},Rk({role:Rw,from:d,encode:ri(m,g,Qk),marks:[w,v],name:i,interactive:h,sort:u})}function tba(a,b){const c=vc(a,b);return{align:c("gridAlign"),columns:c.entryColumns(),center:{row:!0,column:!1},padding:{row:c("rowPadding"),column:c("columnPadding")}}}const gx='item.orient === "left"',hx='item.orient === "right"',kp=`(${gx} || ${hx})`,uba=`datum.vgrad && ${kp}`,vba=jp('"top"','"bottom"','"middle"'),wba=jp('"right"','"left"','"center"'),xba=`datum.vgrad && ${hx} ? (${wba}) : (${kp} && !(datum.vgrad && ${gx})) ? "left" : ${fx}`,yba=`item._anchor || (${kp} ? "middle" : "start")`,zba=`${uba} ? (${gx} ? -90 : 90) : 0`,Aba=`${kp} ? (datum.vgrad ? (${hx} ? "bottom" : "top") : ${vba}) : "top"`;function Bba(a,b,c,d){var e=vc(a,b),f;return f={enter:{opacity:ta},update:{opacity:$c,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:ta}},Eb(f,{orient:e("titleOrient"),_anchor:e("titleAnchor"),anchor:{signal:yba},angle:{signal:zba},align:{signal:xba},baseline:{signal:Aba},text:a.title,fill:e("titleColor"),fillOpacity:e("titleOpacity"),font:e("titleFont"),fontSize:e("titleFontSize"),fontStyle:e("titleFontStyle"),fontWeight:e("titleFontWeight"),limit:e("titleLimit"),lineHeight:e("titleLineHeight")},{align:e("titleAlign"),baseline:e("titleBaseline")}),Kc({type:Qg,role:H9,style:ax,from:d,encode:f},c)}function Cba(a,b){var c;return Z(a)&&(a.signal?c=a.signal:a.path?c="pathShape("+XK(a.path)+")":a.sphere&&(c="geoShape("+XK(a.sphere)+', {type: "Sphere"})')),c?b.signalRef(c):!!a}function XK(a){return Z(a)&&a.signal?a.signal:P(a)}function YK(a){var b=a.role||"";return!b.indexOf("axis")||!b.indexOf("legend")||!b.indexOf("title")?b:a.type===ip?Rw:b||Pw}function Dba(a){return{marktype:a.type,name:a.name||void 0,role:a.role||YK(a),zindex:+a.zindex||void 0,aria:a.aria,description:a.description}}function Eba(a,b){return a&&a.signal?b.signalRef(a.signal):a===!1?!1:!0}function ix(a,b){var c=WB(a.type);c||H("Unrecognized transform type: "+P(a.type));var d=ap(c.type.toLowerCase(),null,ZK(c,a,b));return a.signal&&b.addSignal(a.signal,b.proxy(d)),d.metadata=c.metadata||{},d}function ZK(a,b,c){var d={},e,f,g;for(f=0,g=a.params.length;f<g;++f)e=a.params[f],d[e.name]=Fba(e,b,c);return d}function Fba(a,b,c){var d=a.type,e=b[a.name];if(d==="index")return Gba(a,b,c);if(e===void 0){a.required&&H("Missing required "+P(b.type)+" parameter: "+P(a.name));return}else{if(d==="param")return Hba(a,b,c);if(d==="projection")return c.projectionRef(b[a.name])}return a.array&&!qb(e)?e.map(function(f){return _K(a,f,c)}):_K(a,e,c)}function _K(a,b,c){var d=a.type;if(qb(b))return aL(d)?H("Expression references can not be signals."):jx(d)?c.fieldRef(b):bL(d)?c.compareRef(b):c.signalRef(b.signal);{var e=a.expr||jx(d);return e&&Iba(b)?c.exprRef(b.expr,b.as):e&&Jba(b)?Lk(b.field,b.as):aL(d)?Xd(b,c):Kba(d)?ca(c.getData(b).values):jx(d)?Lk(b):bL(d)?c.compareRef(b):b}}function Gba(a,b,c){return V(b.from)||H('Lookup "from" parameter must be a string literal.'),c.getData(b.from).lookupRef(c,b.key)}function Hba(a,b,c){var d=b[a.name];return a.array?(J(d)||H("Expected an array of sub-parameters. Instead: "+P(d)),d.map(function(e){return $K(a,e,c)})):$K(a,d,c)}function $K(a,b,c){var d,e,f,g,h;for(g=0,h=a.params.length;g<h;++g){e=a.params[g];for(f in e.key)if(e.key[f]!==b[f]){e=null;break}if(e)break}return e||H("Unsupported parameter: "+P(b)),d=la(ZK(e,b,c),e.key),ca(c.add(Eaa(d)))}function Iba(a){return a&&a.expr}function Jba(a){return a&&a.field}function Kba(a){return a==="data"}function aL(a){return a==="expr"}function jx(a){return a==="field"}function bL(a){return a==="compare"}function Lba(a,b,c){var d,e,f,g,h;return a?(d=a.facet)&&(b||H("Only group marks can be faceted."),d.field!=null?g=h=lp(d,c):(a.data?h=ca(c.getData(a.data).aggregate):(f=ix(la({type:"aggregate",groupby:T(d.groupby)},d.aggregate),c),f.params.key=c.keyRef(d.groupby),f.params.pulse=lp(d,c),g=h=ca(c.add(f))),e=c.keyRef(d.groupby,!0))):g=ca(c.add(ud(null,[{}]))),g||(g=lp(a,c)),{key:e,pulse:g,parent:h}}function lp(a,b){return a.$ref?a:a.data&&a.data.$ref?a.data:ca(b.getData(a.data).output)}function Rg(a,b,c,d,e){this.scope=a,this.input=b,this.output=c,this.values=d,this.aggregate=e,this.index={}}Rg.fromEntries=function(a,b){var c=b.length,d=1,e=b[0],f=b[c-1],g=b[c-2],h=null;for(e&&e.type==="load"&&(e=b[1]),a.add(b[0]);d<c;++d)b[d].params.pulse=ca(b[d-1]),a.add(b[d]),b[d].type==="aggregate"&&(h=b[d]);return new Rg(a,e,g,f,h)};var Sg=Rg.prototype;Sg.countsRef=function(a,b,c){var d=this,e=d.counts||(d.counts={}),f=cL(b),g,h,i;return f!=null&&(a=d.scope,g=e[f]),g?c&&c.field&&dL(a,g.agg.params,c):(i={groupby:a.fieldRef(b,"key"),pulse:ca(d.output)},c&&c.field&&dL(a,i,c),h=a.add(GK(i)),g=a.add(ud({pulse:ca(h)})),g={agg:h,ref:ca(g)},f!=null&&(e[f]=g)),g.ref};function cL(a){return V(a)?a:null}function dL(a,b,c){var d=cp(c.op,c.field),e;if(b.ops){for(var f=0,g=b.as.length;f<g;++f)if(b.as[f]===d)return}else b.ops=["count"],b.fields=[null],b.as=["count"];c.op&&(b.ops.push((e=c.op.signal)?a.signalRef(e):c.op),b.fields.push(a.fieldRef(c.field)),b.as.push(d))}function Sk(a,b,c,d,e,f,g){var h=b[c]||(b[c]={}),i=Y9(f),j=cL(e),k,l;j!=null&&(a=b.scope,j=j+(i?"|"+i:""),k=h[j]);if(!k){var m=f?{field:Uw,pulse:b.countsRef(a,e,f)}:{field:a.fieldRef(e),pulse:ca(b.output)};i&&(m.sort=a.sortRef(f)),l=a.add(ap(d,void 0,m)),g&&(b.index[e]=l),k=ca(l),j!=null&&(h[j]=k)}return k}Sg.tuplesRef=function(){return ca(this.values)},Sg.extentRef=function(a,b){return Sk(a,this,"extent","extent",b,!1)},Sg.domainRef=function(a,b){return Sk(a,this,"domain","values",b,!1)},Sg.valuesRef=function(a,b,c){return Sk(a,this,"vals","values",b,c||!0)},Sg.lookupRef=function(a,b){return Sk(a,this,"lookup","tupleindex",b,!1)},Sg.indataRef=function(a,b){return Sk(a,this,"indata","tupleindex",b,!0,!0)};function Mba(a,b,c){var d=a.from.facet,e=d.name,f=lp(d,b),g,h,i,j;d.name||H("Facet must have a name: "+P(d)),d.data||H("Facet must reference a data set: "+P(d)),d.field?j=b.add(KK({field:b.fieldRef(d.field),pulse:f})):d.groupby?j=b.add(vaa({key:b.keyRef(d.groupby),group:ca(b.proxy(c.parent)),pulse:f})):H("Facet must specify groupby or field: "+P(d)),g=b.fork(),h=g.add(ud()),i=g.add(Pg({pulse:ca(h)})),g.addData(e,new Rg(g,h,h,i)),g.addSignal("parent",null),j.params.subflow={$subflow:g.parse(a).toRuntime()}}function Nba(a,b,c){var d=b.add(KK({pulse:c.pulse})),e=b.fork();e.add(Pg()),e.addSignal("parent",null),d.params.subflow={$subflow:e.parse(a).toRuntime()}}function eL(a,b,c){var d=a.remove,e=a.insert,f=a.toggle,g=a.modify,h=a.values,i=b.add(bp()),j,k;j="if("+a.trigger+',modify("'+c+'",'+[e,d,f,g,h].map(function(l){return l==null?"null":l}).join(",")+"),0)",k=Xd(j,b),i.update=k.$expr,i.params=k.$params}function mp(a,b){var c=YK(a),d=a.type===ip,e=a.from&&a.from.facet,f=a.layout||c===Rw||c===Qw,g=c===Pw||f||e,h=a.overlap,i,j,k,l,m,n,o,p,q,r,s,t,w,v;k=Lba(a.from,d,b),j=b.add(taa({key:k.key||(a.key?Lk(a.key):void 0),pulse:k.pulse,clean:!d})),r=ca(j),j=l=b.add(ud({pulse:r})),j=b.add(Aaa({markdef:Dba(a),interactive:Eba(a.interactive,b),clip:Cba(a.clip,b),context:{$context:!0},groups:b.lookup(),parent:b.signals.parent?b.signalRef("parent"):null,index:b.markpath(),pulse:ca(j)})),s=ca(j),j=m=b.add(JK(vK(a.encode,a.type,c,a.style,b,{mod:!1,pulse:s}))),j.params.parent=b.encode(),a.transform&&a.transform.forEach(function(x){const u=ix(x,b),z=u.metadata;(z.generates||z.changes)&&H("Mark transforms should not generate new data."),z.nomod||(m.params.mod=!0),u.params.pulse=ca(j),b.add(j=u)}),a.sort&&(j=b.add(Jaa({sort:b.compareRef(a.sort),pulse:ca(j)}))),t=ca(j),(e||f)&&(f=b.add(MK({layout:b.objectProperty(a.layout),legends:b.legends,mark:s,pulse:t})),w=ca(f)),n=b.add(HK({mark:s,pulse:w||t})),v=ca(n),d&&(g&&(i=b.operators,i.pop(),f&&i.pop()),b.pushState(t,w||v,r),e?Mba(a,b,k):g?Nba(a,b,k):b.parse(a),b.popState(),g&&(f&&i.push(f),i.push(n))),h&&(v=Oba(h,v,b)),o=b.add(LK({pulse:v})),p=b.add(Pg({pulse:ca(o)},void 0,b.parent())),a.name!=null&&(q=a.name,b.addData(q,new Rg(b,l,o,p)),a.on&&a.on.forEach(function(x){(x.insert||x.remove||x.toggle)&&H("Marks only support modify triggers."),eL(x,b,q)}))}function Oba(a,b,c){var d=a.method,e=a.bound,f=a.separation,g,h={separation:qb(f)?c.signalRef(f.signal):f,method:qb(d)?c.signalRef(d.signal):d,pulse:b};return a.order&&(h.sort=c.compareRef({field:a.order})),e&&(g=e.tolerance,h.boundTolerance=qb(g)?c.signalRef(g.signal):+g,h.boundScale=c.scaleRef(e.scale),h.boundOrient=e.orient),ca(c.add(Daa(h)))}function Pba(a,b){var c=b.config.legend,d=a.encode||{},e=d.legend||{},f=e.name||void 0,g=e.interactive,h=e.style,i=vc(a,c),j={},k=0,l,m,n,o,p,q,r,s;return dx.forEach(t=>a[t]?(j[t]=a[t],k=k||a[t]):0),k||H("Missing valid scale for legend."),p=Qba(a,b.scaleType(k)),q={title:a.title!=null,scales:j,type:p,vgrad:p!=="symbol"&&i.isVertical()},r=ca(b.add(ud(null,[q]))),e=ri(Sba(i,a,c),e,Qk),l={enter:{x:{value:0},y:{value:0}}},s=ca(b.add(yaa(n={type:p,scale:b.scaleRef(k),count:b.objectProperty(i("tickCount")),limit:b.property(i("symbolLimit")),values:b.objectProperty(a.values),minstep:b.property(a.tickMinStep),formatType:b.property(a.formatType),formatSpecifier:b.property(a.format)}))),p===hp?(o=[oba(a,k,c,d.gradient),WK(a,c,d.labels,s)],n.count=n.count||b.signalRef(`max(2,2*floor((${Ng(i.gradientLength())})/100))`)):p===bx?o=[pba(a,k,c,d.gradient,s),WK(a,c,d.labels,s)]:(m=tba(a,c),o=[sba(a,c,d,s,Ng(m.columns))],n.size=Tba(a,b,o[0].marks)),o=[Rk({role:E9,from:r,encode:l,marks:o,layout:m,interactive:g})],q.title&&o.push(Bba(a,c,d.title,r)),mp(Rk({role:C9,from:r,encode:e,marks:o,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:f,interactive:g,style:h}),b)}function Qba(a,b){var c=a.type||SK;return!a.type&&Rba(a)===1&&(a.fill||a.stroke)&&(c=pu(b)?hp:qu(b)?bx:SK),c!==hp?c:qu(b)?bx:hp}function Rba(a){return dx.reduce(function(b,c){return b+(a[c]?1:0)},0)}function Sba(a,b,c){var d={enter:{},update:{}};return Eb(d,{orient:a("orient"),offset:a("offset"),padding:a("padding"),titlePadding:a("titlePadding"),cornerRadius:a("cornerRadius"),fill:a("fillColor"),stroke:a("strokeColor"),strokeWidth:c.strokeWidth,strokeDash:c.strokeDash,x:a("legendX"),y:a("legendY"),format:b.format,formatType:b.formatType}),d}function Tba(a,b,c){var d=Ng(fL("size",a,c)),e=Ng(fL("strokeWidth",a,c)),f=Ng(Uba(c[1].encode,b,Pk));return Xd(`max(ceil(sqrt(${d})+${e}),${f})`,b)}function fL(a,b,c){return b[a]?`scale("${b[a]}",datum)`:UK(a,c[0].encode)}function Uba(a,b,c){return UK("fontSize",a)||mba("fontSize",b,c)}const Vba=`item.orient==="${ti}"?-90:item.orient==="${ui}"?90:0`;function Wba(a,b){a=V(a)?{text:a}:a;var c=vc(a,b.config.title),d=a.encode||{},e=d.group||{},f=e.name||void 0,g=e.interactive,h=e.style,i=[],j,k;return j={},k=ca(b.add(ud(null,[j]))),i.push(Zba(a,c,Xba(a),k)),a.subtitle&&i.push(_ba(a,c,d.subtitle,k)),mp(Rk({role:I9,from:k,encode:Yba(c,e),marks:i,aria:c("aria"),description:c("description"),zindex:c("zindex"),name:f,interactive:g,style:h}),b)}function Xba(a){const b=a.encode;return b&&b.title||la({name:a.name,interactive:a.interactive,style:a.style},b)}function Yba(a,b){var c={enter:{},update:{}};return Eb(c,{orient:a("orient"),anchor:a("anchor"),align:{signal:fx},angle:{signal:Vba},limit:a("limit"),frame:a("frame"),offset:a("offset")||0,padding:a("subtitlePadding")}),ri(c,b,Qk)}function Zba(a,b,c,d){var e={value:0},f=a.text,g={enter:{opacity:e},update:{opacity:{value:1}},exit:{opacity:e}};return Eb(g,{text:f,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:b("dx"),dy:b("dy"),fill:b("color"),font:b("font"),fontSize:b("fontSize"),fontStyle:b("fontStyle"),fontWeight:b("fontWeight"),lineHeight:b("lineHeight")},{align:b("align"),angle:b("angle"),baseline:b("baseline")}),Kc({type:Qg,role:J9,style:dba,from:d,encode:g},c)}function _ba(a,b,c,d){var e={value:0},f=a.subtitle,g={enter:{opacity:e},update:{opacity:{value:1}},exit:{opacity:e}};return Eb(g,{text:f,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:b("dx"),dy:b("dy"),fill:b("subtitleColor"),font:b("subtitleFont"),fontSize:b("subtitleFontSize"),fontStyle:b("subtitleFontStyle"),fontWeight:b("subtitleFontWeight"),lineHeight:b("subtitleLineHeight")},{align:b("align"),angle:b("angle"),baseline:b("baseline")}),Kc({type:Qg,role:K9,style:eba,from:d,encode:g},c)}function $ba(a,b){var c=[];a.transform&&a.transform.forEach(function(d){c.push(ix(d,b))}),a.on&&a.on.forEach(function(d){eL(d,b,a.name)}),b.addDataPipeline(a.name,aca(a,b,c))}function aca(a,b,c){var d=[],e=null,f=!1,g=!1,h,i,j,k,l;for(a.values?Mk(a.values)||Mk(a.format)?(d.push(gL(b,a)),d.push(e=Tg())):d.push(e=Tg({$ingest:a.values,$format:a.format})):a.url?Mk(a.url)||Mk(a.format)?(d.push(gL(b,a)),d.push(e=Tg())):d.push(e=Tg({$request:a.url,$format:a.format})):a.source&&(e=h=T(a.source).map(function(m){return ca(b.getData(m).output)}),d.push(null)),i=0,j=c.length;i<j;++i)k=c[i],l=k.metadata,!e&&!l.source&&d.push(e=Tg()),d.push(k),l.generates&&(g=!0),l.modifies&&!g&&(f=!0),l.source?e=k:l.changes&&(e=null);return h&&(j=h.length-1,d[0]=Haa({derive:f,pulse:j?h:h[0]}),(f||j)&&d.splice(1,0,Tg())),e||d.push(Tg()),d.push(Pg({})),d}function Tg(a){var b=ud({},a);return b.metadata={source:!0},b}function gL(a,b){return zaa({url:b.url?a.property(b.url):void 0,async:b.async?a.property(b.async):void 0,values:b.values?a.property(b.values):void 0,format:a.objectProperty(b.format)})}const hL=a=>a===xf||a===vd,np=(a,b,c)=>qb(a)?eca(a.signal,b,c):a===ti||a===vd?b:c,rb=(a,b,c)=>qb(a)?cca(a.signal,b,c):hL(a)?b:c,wd=(a,b,c)=>qb(a)?dca(a.signal,b,c):hL(a)?c:b,iL=(a,b,c)=>qb(a)?fca(a.signal,b,c):a===vd?{value:b}:{value:c},bca=(a,b,c)=>qb(a)?gca(a.signal,b,c):a===ui?{value:b}:{value:c},cca=(a,b,c)=>jL(`${a} === '${vd}' || ${a} === '${xf}'`,b,c),dca=(a,b,c)=>jL(`${a} !== '${vd}' && ${a} !== '${xf}'`,b,c),eca=(a,b,c)=>kx(`${a} === '${ti}' || ${a} === '${vd}'`,b,c),fca=(a,b,c)=>kx(`${a} === '${vd}'`,b,c),gca=(a,b,c)=>kx(`${a} === '${ui}'`,b,c),jL=(a,b,c)=>(b=b!=null?pb(b):b,c=c!=null?pb(c):c,kL(b)&&kL(c)?(b=b?b.signal||P(b.value):null,c=c?c.signal||P(c.value):null,{signal:`${a} ? (${b}) : (${c})`}):[la({test:a},b)].concat(c||[])),kL=a=>a==null||Object.keys(a).length===1,kx=(a,b,c)=>({signal:`${a} ? (${wi(b)}) : (${wi(c)})`}),hca=(a,b,c,d,e)=>({signal:(d!=null?`${a} === '${ti}' ? (${wi(d)}) : `:"")+(c!=null?`${a} === '${xf}' ? (${wi(c)}) : `:"")+(e!=null?`${a} === '${ui}' ? (${wi(e)}) : `:"")+(b!=null?`${a} === '${vd}' ? (${wi(b)}) : `:"")+"(null)"}),wi=a=>qb(a)?a.signal:a==null?null:P(a),ica=(a,b)=>b===0?0:qb(a)?{signal:`(${a.signal}) * ${b}`}:{value:a*b},xi=(a,b)=>{const c=a.signal;return c&&c.endsWith("(null)")?{signal:c.slice(0,-6)+b.signal}:a};function yi(a,b,c,d){let e;if(b&&_(b,a))return b[a];{if(_(c,a))return c[a];if(a.startsWith("title")){switch(a){case"titleColor":e="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":e=a[5].toLowerCase()+a.slice(6)}return d[ax][e]}else if(a.startsWith("label")){switch(a){case"labelColor":e="fill";break;case"labelFont":case"labelFontSize":e=a[5].toLowerCase()+a.slice(6)}return d[Pk][e]}}return null}function lL(a){const b={};for(const c of a){if(!c)continue;for(const d in c)b[d]=1}return Object.keys(b)}function jca(a,b){var c=b.config,d=c.style,e=c.axis,f=b.scaleType(a.scale)==="band"&&c.axisBand,g=a.orient,h,i,j;if(qb(g)){const l=lL([c.axisX,c.axisY]),m=lL([c.axisTop,c.axisBottom,c.axisLeft,c.axisRight]);h={};for(j of l)h[j]=rb(g,yi(j,c.axisX,e,d),yi(j,c.axisY,e,d));i={};for(j of m)i[j]=hca(g.signal,yi(j,c.axisTop,e,d),yi(j,c.axisBottom,e,d),yi(j,c.axisLeft,e,d),yi(j,c.axisRight,e,d))}else h=g===vd||g===xf?c.axisX:c.axisY,i=c["axis"+g[0].toUpperCase()+g.slice(1)];var k=h||i||f?la({},e,h,i,f):e;return k}function kca(a,b,c,d){var e=vc(a,b),f=a.orient,g,h,i;g={enter:h={opacity:ta},update:i={opacity:$c},exit:{opacity:ta}},Eb(g,{stroke:e("domainColor"),strokeCap:e("domainCap"),strokeDash:e("domainDash"),strokeDashOffset:e("domainDashOffset"),strokeWidth:e("domainWidth"),strokeOpacity:e("domainOpacity")});const j=mL(a,0),k=mL(a,1);return h.x=i.x=rb(f,j,ta),h.x2=i.x2=rb(f,k),h.y=i.y=wd(f,j,ta),h.y2=i.y2=wd(f,k),Kc({type:ex,role:x9,from:d,encode:g},c)}function mL(a,b){return{scale:a.scale,range:b}}function lca(a,b,c,d,e){var f=vc(a,b),g=a.orient,h=a.gridScale,i=np(g,1,-1),j=mca(a.offset,i),k,l,m,n,o,p,q,r;return k={enter:l={opacity:ta},update:n={opacity:$c},exit:m={opacity:ta}},Eb(k,{stroke:f("gridColor"),strokeCap:f("gridCap"),strokeDash:f("gridDash"),strokeDashOffset:f("gridDashOffset"),strokeOpacity:f("gridOpacity"),strokeWidth:f("gridWidth")}),o={scale:a.scale,field:_c,band:e.band,extra:e.extra,offset:e.offset,round:f("tickRound")},r=rb(g,{signal:"height"},{signal:"width"}),p=h?{scale:h,range:0,mult:i,offset:j}:{value:0,offset:j},q=h?{scale:h,range:1,mult:i,offset:j}:la(r,{mult:i,offset:j}),l.x=n.x=rb(g,o,p),l.y=n.y=wd(g,o,p),l.x2=n.x2=wd(g,q),l.y2=n.y2=rb(g,q),m.x=rb(g,o),m.y=wd(g,o),Kc({type:ex,role:y9,key:_c,from:d,encode:k},c)}function mca(a,b){if(!(b===1))if(!Z(a))a=qb(b)?{signal:`(${b.signal}) * (${a||0})`}:b*(a||0);else{let c=a=la({},a);for(;c.mult!=null;)if(Z(c.mult))c=c.mult=la({},c.mult);else return c.mult=qb(b)?{signal:`(${c.mult}) * (${b.signal})`}:c.mult*b,a;c.mult=b}return a}function nca(a,b,c,d,e,f){var g=vc(a,b),h=a.orient,i=np(h,-1,1),j,k,l,m,n,o;return j={enter:k={opacity:ta},update:m={opacity:$c},exit:l={opacity:ta}},Eb(j,{stroke:g("tickColor"),strokeCap:g("tickCap"),strokeDash:g("tickDash"),strokeDashOffset:g("tickDashOffset"),strokeOpacity:g("tickOpacity"),strokeWidth:g("tickWidth")}),n=pb(e),n.mult=i,o={scale:a.scale,field:_c,band:f.band,extra:f.extra,offset:f.offset,round:g("tickRound")},m.y=k.y=rb(h,ta,o),m.y2=k.y2=rb(h,n),l.x=rb(h,o),m.x=k.x=wd(h,ta,o),m.x2=k.x2=wd(h,n),l.y=wd(h,o),Kc({type:ex,role:A9,key:_c,from:d,encode:j},c)}function lx(a,b,c,d,e){return{signal:'flush(range("'+a+'"), scale("'+a+'", datum.value), '+b+","+c+","+d+","+e+")"}}function oca(a,b,c,d,e,f){var g=vc(a,b),h=a.orient,i=a.scale,j=np(h,-1,1),k=Ng(g("labelFlush")),l=Ng(g("labelFlushOffset")),m=k===0||!!k,n=g("labelAlign"),o=g("labelBaseline"),p,q,r,s,t,w,v,x,u,z;return s=pb(e),s.mult=j,s.offset=pb(g("labelPadding")||0),s.offset.mult=j,t={scale:i,field:_c,band:.5,offset:VK(f.offset,g("labelOffset"))},w=rb(h,m?lx(i,k,'"left"','"right"','"center"'):{value:"center"},bca(h,"left","right")),v=rb(h,iL(h,"bottom","top"),m?lx(i,k,'"top"','"bottom"','"middle"'):{value:"middle"}),z=lx(i,k,`-(${l})`,l,0),m=m&&l,q={opacity:ta,x:rb(h,t,s),y:wd(h,t,s)},p={enter:q,update:r={opacity:$c,text:{field:$w},x:q.x,y:q.y,align:w,baseline:v},exit:{opacity:ta,x:q.x,y:q.y}},Eb(p,{dx:!n&&m?rb(h,z):null,dy:!o&&m?wd(h,z):null}),Eb(p,{angle:g("labelAngle"),fill:g("labelColor"),fillOpacity:g("labelOpacity"),font:g("labelFont"),fontSize:g("labelFontSize"),fontWeight:g("labelFontWeight"),fontStyle:g("labelFontStyle"),limit:g("labelLimit"),lineHeight:g("labelLineHeight")},{align:n,baseline:o}),x=g("labelBound"),u=g("labelOverlap"),u=u||x?{separation:g("labelSeparation"),method:u,order:"datum.index",bound:x?{scale:i,orient:h,tolerance:x}:null}:void 0,r.align!==w&&(r.align=xi(r.align,w)),r.baseline!==v&&(r.baseline=xi(r.baseline,v)),Kc({type:Qg,role:z9,style:Pk,key:_c,from:d,encode:p,overlap:u},c)}function pca(a,b,c,d){var e=vc(a,b),f=a.orient,g=np(f,-1,1),h,i,j,k;return h={enter:i={opacity:ta,anchor:pb(e("titleAnchor",null)),align:{signal:fx}},update:j=la({},i,{opacity:$c,text:pb(a.title)}),exit:{opacity:ta}},k={signal:`lerp(range("${a.scale}"), ${jp(0,1,.5)})`},j.x=rb(f,k),j.y=wd(f,k),i.angle=rb(f,ta,ica(g,90)),i.baseline=rb(f,iL(f,xf,vd),{value:xf}),j.angle=i.angle,j.baseline=i.baseline,Eb(h,{fill:e("titleColor"),fillOpacity:e("titleOpacity"),font:e("titleFont"),fontSize:e("titleFontSize"),fontStyle:e("titleFontStyle"),fontWeight:e("titleFontWeight"),limit:e("titleLimit"),lineHeight:e("titleLineHeight")},{align:e("titleAlign"),angle:e("titleAngle"),baseline:e("titleBaseline")}),qca(e,f,h,c),h.update.align=xi(h.update.align,i.align),h.update.angle=xi(h.update.angle,i.angle),h.update.baseline=xi(h.update.baseline,i.baseline),Kc({type:Qg,role:B9,style:ax,from:d,encode:h},c)}function qca(a,b,c,d){const e=(h,i)=>h!=null?(c.update[i]=xi(pb(h),c.update[i]),!1):si(i,d)?!1:!0,f=e(a("titleX"),"x"),g=e(a("titleY"),"y");c.enter.auto=g===f?pb(g):rb(b,pb(g),pb(f))}function rca(a,b){var c=jca(a,b),d=a.encode||{},e=d.axis||{},f=e.name||void 0,g=e.interactive,h=e.style,i=vc(a,c),j=nba(i),k,l,m,n,o;return k={scale:a.scale,ticks:!!i("ticks"),labels:!!i("labels"),grid:!!i("grid"),domain:!!i("domain"),title:a.title!=null},l=ca(b.add(ud({},[k]))),e=ri(sca(i,a),e,Qk),m=ca(b.add(saa({scale:b.scaleRef(a.scale),extra:b.property(j.extra),count:b.objectProperty(a.tickCount),values:b.objectProperty(a.values),minstep:b.property(a.tickMinStep),formatType:b.property(a.formatType),formatSpecifier:b.property(a.format)}))),o=[],k.grid&&o.push(lca(a,c,d.grid,m,j)),k.ticks&&(n=i("tickSize"),o.push(nca(a,c,d.ticks,m,n,j))),k.labels&&(n=k.ticks?n:0,o.push(oca(a,c,d.labels,m,n,j))),k.domain&&o.push(kca(a,c,d.domain,l)),k.title&&o.push(pca(a,c,d.title,l)),mp(Rk({role:w9,from:l,encode:e,marks:o,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:f,interactive:g,style:h}),b)}function sca(a,b){var c={enter:{},update:{}};return Eb(c,{orient:a("orient"),offset:a("offset")||0,position:td(b.position,0),titlePadding:a("titlePadding"),minExtent:a("minExtent"),maxExtent:a("maxExtent"),range:{signal:`abs(span(range("${b.scale}")))`},translate:a("translate"),format:b.format,formatType:b.formatType}),c}function nL(a,b,c){var d=T(a.signals),e=T(a.scales);return c||d.forEach(f=>xK(f,b)),T(a.projections).forEach(f=>Yaa(f,b)),e.forEach(f=>Maa(f,b)),T(a.data).forEach(f=>$ba(f,b)),e.forEach(f=>Naa(f,b)),(c||d).forEach(f=>raa(f,b)),T(a.axes).forEach(f=>rca(f,b)),T(a.marks).forEach(f=>mp(f,b)),T(a.legends).forEach(f=>Pba(f,b)),a.title&&Wba(a.title,b),b.parseLambdas(),b}const tca=a=>ri({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},a);function uca(a,b){const c=b.config,d=ca(b.root=b.add(bp())),e=vca(a,c);e.forEach(j=>xK(j,b)),b.description=a.description||c.description,b.eventConfig=c.events,b.legends=b.objectProperty(c.legend&&c.legend.layout),b.locale=c.locale;const f=b.add(ud()),g=b.add(JK(vK(tca(a.encode),ip,Qw,a.style,b,{pulse:ca(f)}))),h=b.add(MK({layout:b.objectProperty(a.layout),legends:b.legends,autosize:b.signalRef("autosize"),mark:d,pulse:ca(g)}));b.operators.pop(),b.pushState(ca(g),ca(h),null),nL(a,b,e),b.operators.push(h);let i=b.add(HK({mark:d,pulse:ca(h)}));return i=b.add(LK({pulse:ca(i)})),i=b.add(Pg({pulse:ca(i)})),b.addData("root",new Rg(b,f,f,i)),b}function Tk(a,b){return b&&b.signal?{name:a,update:b.signal}:{name:a,value:b}}function vca(a,b){const c=g=>td(a[g],b[g]),d=[Tk("background",c("background")),Tk("autosize",t9(c("autosize"))),Tk("padding",v9(c("padding"))),Tk("width",c("width")||0),Tk("height",c("height")||0)],e=d.reduce((g,h)=>(g[h.name]=h,g),{}),f={};return T(a.signals).forEach(g=>{_(e,g.name)?g=la(e[g.name],g):d.push(g),f[g.name]=g}),T(b.signals).forEach(g=>{!_(f,g.name)&&!_(e,g.name)&&d.push(g)}),d}function oL(a,b){this.config=a||{},this.options=b||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function pL(a){this.config=a.config,this.options=a.options,this.legends=a.legends,this.field=Object.create(a.field),this.signals=Object.create(a.signals),this.lambdas=Object.create(a.lambdas),this.scales=Object.create(a.scales),this.events=Object.create(a.events),this.data=Object.create(a.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++a._nextsub[0],this._nextsub=a._nextsub,this._parent=a._parent.slice(),this._encode=a._encode.slice(),this._lookup=a._lookup.slice(),this._markpath=a._markpath}var ka=oL.prototype=pL.prototype;ka.parse=function(a){return nL(a,this)},ka.fork=function(){return new pL(this)},ka.isSubscope=function(){return this._subid>0},ka.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},ka.id=function(){return(this._subid?this._subid+":":0)+this._id++},ka.add=function(a){return this.operators.push(a),a.id=this.id(),a.refs&&(a.refs.forEach(function(b){b.$ref=a.id}),a.refs=null),a},ka.proxy=function(a){var b=a instanceof Tw?ca(a):a;return this.add(Gaa({value:b}))},ka.addStream=function(a){return this.streams.push(a),a.id=this.id(),a},ka.addUpdate=function(a){return this.updates.push(a),a},ka.finish=function(){var a,b;this.root&&(this.root.root=!0);for(a in this.signals)this.signals[a].signal=a;for(a in this.scales)this.scales[a].scale=a;function c(e,f,g){var h,i;e&&(h=e.data||(e.data={}),i=h[f]||(h[f]=[]),i.push(g))}for(a in this.data){b=this.data[a],c(b.input,a,"input"),c(b.output,a,"output"),c(b.values,a,"values");for(var d in b.index)c(b.index[d],a,"index:"+d)}return this},ka.pushState=function(a,b,c){this._encode.push(ca(this.add(Pg({pulse:a})))),this._parent.push(b),this._lookup.push(c?ca(this.proxy(c)):null),this._markpath.push(-1)},ka.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},ka.parent=function(){return ra(this._parent)},ka.encode=function(){return ra(this._encode)},ka.lookup=function(){return ra(this._lookup)},ka.markpath=function(){var a=this._markpath;return++a[a.length-1]},ka.fieldRef=function(a,b){if(V(a))return Lk(a,b);a.signal||H("Unsupported field reference: "+P(a));var c=a.signal,d=this.field[c],e;return d||(e={name:this.signalRef(c)},b&&(e.as=b),this.field[c]=d=ca(this.add(waa(e)))),d},ka.compareRef=function(a){function b(g){return qb(g)?(d=!0,c.signalRef(g.signal)):Z9(g)?(d=!0,c.exprRef(g.expr)):g}var c=this,d=!1,e=T(a.field).map(b),f=T(a.order).map(b);return d?ca(this.add(IK({fields:e,orders:f}))):yK(e,f)},ka.keyRef=function(a,b){function c(f){return qb(f)?(e=!0,ca(d[f.signal])):f}var d=this.signals,e=!1;return a=T(a).map(c),e?ca(this.add(xaa({fields:a,flat:b}))):V9(a,b)},ka.sortRef=function(a){if(!a)return a;var b=cp(a.op,a.field),c=a.order||W9;return c.signal?ca(this.add(IK({fields:b,orders:this.signalRef(c.signal)}))):yK(b,c)},ka.event=function(a,b){var c=a+":"+b;if(!this.events[c]){var d=this.id();this.streams.push({id:d,source:a,type:b}),this.events[c]=d}return this.events[c]},ka.hasOwnSignal=function(a){return _(this.signals,a)},ka.addSignal=function(a,b){this.hasOwnSignal(a)&&H("Duplicate signal name: "+P(a));var c=b instanceof Tw?b:this.add(bp(b));return this.signals[a]=c},ka.getSignal=function(a){return this.signals[a]||H("Unrecognized signal name: "+P(a)),this.signals[a]},ka.signalRef=function(a){return this.signals[a]?ca(this.signals[a]):(_(this.lambdas,a)||(this.lambdas[a]=this.add(bp(null))),ca(this.lambdas[a]))},ka.parseLambdas=function(){for(var a=Object.keys(this.lambdas),b=0,c=a.length;b<c;++b){var d=a[b],e=Xd(d,this),f=this.lambdas[d];f.params=e.$params,f.update=e.$expr}},ka.property=function(a){return a&&a.signal?this.signalRef(a.signal):a},ka.objectProperty=function(a){return!a||!Z(a)?a:this.signalRef(a.signal||mx(a))};function mx(a){return(J(a)?wca:xca)(a)}function wca(a){for(var b="[",c=0,d=a.length,e;c<d;++c)e=a[c],b+=(c>0?",":"")+(Z(e)?e.signal||mx(e):P(e));return b+"]"}function xca(a){var b="{",c=0,d,e;for(d in a)e=a[d],b+=(++c>1?",":"")+P(d)+":"+(Z(e)?e.signal||mx(e):P(e));return b+"}"}ka.exprRef=function(a,b){var c={expr:Xd(a,this)};return b&&(c.expr.$name=b),ca(this.add(uaa(c)))},ka.addBinding=function(a,b){this.bindings||H("Nested signals do not support binding: "+P(a)),this.bindings.push(la({signal:a},b))},ka.addScaleProj=function(a,b){_(this.scales,a)&&H("Duplicate scale or projection name: "+P(a)),this.scales[a]=this.add(b)},ka.addScale=function(a,b){this.addScaleProj(a,Iaa(b))},ka.addProjection=function(a,b){this.addScaleProj(a,Faa(b))},ka.getScale=function(a){return this.scales[a]||H("Unrecognized scale name: "+P(a)),this.scales[a]},ka.projectionRef=ka.scaleRef=function(a){return ca(this.getScale(a))},ka.projectionType=ka.scaleType=function(a){return this.getScale(a).params.type},ka.addData=function(a,b){return _(this.data,a)&&H("Duplicate data set name: "+P(a)),this.data[a]=b},ka.getData=function(a){return this.data[a]||H("Undefined data set name: "+P(a)),this.data[a]},ka.addDataPipeline=function(a,b){return _(this.data,a)&&H("Duplicate data set name: "+P(a)),this.addData(a,Rg.fromEntries(this,b))};function yca(){const a="sans-serif",b=30,c=2,d="#4c78a8",e="#000",f="#888",g="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:d},area:{fill:d},image:null,line:{stroke:d,strokeWidth:c},path:{stroke:d},rect:{fill:d},rule:{stroke:e},shape:{stroke:d},symbol:{fill:d,size:64},text:{fill:e,font:a,fontSize:11},trail:{fill:d,size:c},style:{"guide-label":{fill:e,font:a,fontSize:10},"guide-title":{fill:e,font:a,fontSize:11,fontWeight:"bold"},"group-title":{fill:e,font:a,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:e,font:a,fontSize:12},point:{size:b,strokeWidth:c,shape:"circle"},circle:{size:b,strokeWidth:c},square:{size:b,strokeWidth:c,shape:"square"},cell:{fill:"transparent",stroke:g}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:f,grid:!1,gridWidth:1,gridColor:g,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:f,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:g,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:f,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function zca(a,b,c){return Z(a)||H("Input Vega specification must be an object."),b=Yi(yca(),b,a.config),uca(a,new oL(b,c)).toRuntime()}Tz(Gh,iX,x0,k1,g3,Z3,b5,f5,x5,I5,Q5);var Aca=Object.freeze({__proto__:null,version:R5,Dataflow:Fh,EventStream:fm,Parameters:em,Pulse:cf,MultiPulse:Or,Operator:Ga,Transform:E,changeset:fg,ingest:xa,isTuple:cm,definition:WB,transform:XB,transforms:Gh,tupleid:aa,scale:va,scheme:su,interpolate:ru,interpolateColors:Gn,interpolateRange:IF,quantizeInterpolator:JF,projection:Bv,View:mK,formatLocale:om,timeFormatLocale:mj,locale:NB,defaultLocale:Mr,resetDefaultLocale:nV,expressionFunction:ob,parse:zca,runtimeContext:cK,bandwidthNRD:Vr,bin:bC,bootstrapCI:cC,dotbin:dC,quantiles:Tr,quartiles:Ur,get random(){return Qc},setRandom:WV,randomLCG:YV,randomInteger:ZV,randomKDE:Yr,randomLogNormal:fC,sampleLogNormal:Zr,densityLogNormal:_r,cumulativeLogNormal:$r,quantileLogNormal:as,randomMixture:gC,randomNormal:Xr,sampleNormal:ym,densityNormal:Wr,cumulativeNormal:zm,quantileNormal:Am,randomUniform:hC,sampleUniform:bs,densityUniform:cs,cumulativeUniform:ds,quantileUniform:es,regressionLinear:fs,regressionLog:iC,regressionExp:jC,regressionPow:kC,regressionQuad:gs,regressionPoly:lC,regressionLoess:oC,sampleCurve:Cm,TIME_UNITS:pr,YEAR:xb,QUARTER:kc,MONTH:Gb,WEEK:fb,DATE:lc,DAY:Hb,DAYOFYEAR:Hd,HOURS:Dc,MINUTES:Ec,SECONDS:Pc,MILLISECONDS:id,timeUnitSpecifier:XA,timeUnits:rr,dayofyear:cB,week:dB,utcdayofyear:fB,utcweek:gB,timeFloor:jB,utcFloor:kB,timeInterval:Ah,timeOffset:mB,timeSequence:pB,utcInterval:Bh,utcOffset:nB,utcSequence:qB,timeBin:vB,accessor:ne,accessorName:BR,accessorFields:Gz,id:ER,identity:Uq,zero:FR,one:GR,truthy:HR,falsy:IR,logger:JR,None:Iz,Error:Jz,Warn:Kz,Info:Lz,Debug:Mz,mergeConfig:KR,writeConfig:Pl,panLinear:MR,panLog:NR,panPow:OR,panSymlog:PR,zoomLinear:QR,zoomLog:RR,zoomPow:SR,zoomSymlog:TR,quarter:UR,utcquarter:VR,array:Ui,clampRange:WR,compare:YR,constant:aS,debounce:bS,error:Ll,extend:Tz,extent:cS,extentIndex:dS,fastmap:fS,field:Tq,flush:gS,hasOwnProperty:_f,inherits:hS,inrange:iS,isArray:Nl,isBoolean:jS,isDate:Uz,isFunction:Wq,isNumber:Vz,isObject:Ol,isRegExp:kS,isString:Wz,key:lS,lerp:mS,lruCache:oS,merge:pS,pad:qS,peek:uh,repeat:Vi,span:rS,splitAccessPath:Sq,stringValue:Xz,toBoolean:sS,toDate:uS,toNumber:Vq,toString:vS,toSet:wS,truncate:xS,visitArray:yS,read:OB,inferType:vA,inferTypes:wA,typeParsers:ar,format:hm,formats:gr,responseType:FA,loader:vm,Bounds:gb,Gradient:_C,GroupItem:Tm,ResourceLoader:ht,Item:Sm,Scenegraph:zt,Handler:nf,Renderer:od,CanvasHandler:Ij,CanvasRenderer:on,SVGHandler:Et,SVGRenderer:Bu,SVGStringRenderer:Eu,RenderType:tf,renderModule:Kn,intersect:nG,Marks:Tc,boundClip:rG,boundContext:mc,boundStroke:ue,boundItem:yt,boundMark:dE,pathCurves:bt,pathSymbols:AD,pathRectangle:BD,pathTrail:CD,pathParse:Mh,pathRender:wj,point:gn,domCreate:mf,domFind:At,domChild:Fc,domClear:nd,openTag:Ra,closeTag:Ua,font:en,fontFamily:Ej,fontSize:Md,lineHeight:kf,multiLineOffset:vt,textMetrics:Uh,sceneEqual:Gu,pathEqual:sG,sceneToJSON:eE,sceneFromJSON:fE,intersectPath:jt,intersectPoint:kt,intersectRule:ND,intersectBoxLine:Ph,sceneZOrder:lt,sceneVisit:md,scenePickVisit:Zm,resetSVGClipId:ED,resetSVGDefIds:U$});const Bca="vega-lite",Cca='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Dca="4.13.1",Eca=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Fca="https://vega.github.io/vega-lite/",Gca="Vega-Lite is a concise high-level language for interactive visualization.",Hca="build/vega-lite.js",Ica="build/vega-lite.min.js",Jca="build/vega-lite.min.js",Kca="build/src/index",Lca="build/src/index.d.ts",Mca={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Nca={test:"test"},Oca={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},Pca={type:"git",url:"https://github.com/vega/vega-lite.git"},Qca="BSD-3-Clause",Rca={url:"https://github.com/vega/vega-lite/issues"},Sca={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},Tca={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},Uca={vega:"^5.12.1"},Vca={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1};var Wca={name:Bca,author:Cca,version:Dca,collaborators:Eca,homepage:Fca,description:Gca,main:Hca,unpkg:Ica,jsdelivr:Jca,module:Kca,types:Lca,bin:Mca,directories:Nca,scripts:Oca,repository:Pca,license:Qca,bugs:Rca,devDependencies:Sca,dependencies:Tca,peerDependencies:Uca,jest:Vca};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function a(){var b=isNaN(arguments[0])?1:Number(arguments[0]);return b?Array.prototype.reduce.call(this,function(c,d){return Array.isArray(d)?c.push.apply(c,a.call(d,b-1)):c.push(d),c},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(a){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Xca=Cq(function(a){var b=function(){function c(m,n){return n!=null&&m instanceof n}var d;try{d=Map}catch(m){d=function(){}}var e;try{e=Set}catch(m){e=function(){}}var f;try{f=Promise}catch(m){f=function(){}}function g(m,n,o,p,q){typeof n==="object"&&(o=n.depth,p=n.prototype,q=n.includeNonEnumerable,n=n.circular);var r=[],s=[],t=typeof Buffer!="undefined";typeof n=="undefined"&&(n=!0),typeof o=="undefined"&&(o=Infinity);function w(v,x){if(v===null)return null;if(x===0)return v;var u,z;if(typeof v!="object")return v;if(c(v,d))u=new d();else if(c(v,e))u=new e();else if(c(v,f))u=new f(function(S,X){v.then(function(Y){S(w(Y,x-1))},function(Y){X(w(Y,x-1))})});else if(g.__isArray(v))u=[];else if(g.__isRegExp(v))u=new RegExp(v.source,l(v)),v.lastIndex&&(u.lastIndex=v.lastIndex);else if(g.__isDate(v))u=new Date(v.getTime());else{if(t&&Buffer.isBuffer(v))return Buffer.allocUnsafe?u=Buffer.allocUnsafe(v.length):u=new Buffer(v.length),v.copy(u),u;c(v,Error)?u=Object.create(v):typeof p=="undefined"?(z=Object.getPrototypeOf(v),u=Object.create(z)):(u=Object.create(p),z=p)}if(n){var y=r.indexOf(v);if(y!=-1)return s[y];r.push(v),s.push(u)}c(v,d)&&v.forEach(function(S,X){var Y=w(X,x-1),wa=w(S,x-1);u.set(Y,wa)}),c(v,e)&&v.forEach(function(S){var X=w(S,x-1);u.add(X)});for(var B in v){var A;z&&(A=Object.getOwnPropertyDescriptor(z,B));if(A&&A.set==null)continue;u[B]=w(v[B],x-1)}if(Object.getOwnPropertySymbols)for(var C=Object.getOwnPropertySymbols(v),B=0;B<C.length;B++){var F=C[B],K=Object.getOwnPropertyDescriptor(v,F);if(K&&!K.enumerable&&!q)continue;u[F]=w(v[F],x-1),K.enumerable||Object.defineProperty(u,F,{enumerable:!1})}if(q)for(var D=Object.getOwnPropertyNames(v),B=0;B<D.length;B++){var I=D[B],K=Object.getOwnPropertyDescriptor(v,I);if(K&&K.enumerable)continue;u[I]=w(v[I],x-1),Object.defineProperty(u,I,{enumerable:!1})}return u}return w(m,o)}g.clonePrototype=function m(n){if(n===null)return null;var o=function(){};return o.prototype=n,new o()};function h(m){return Object.prototype.toString.call(m)}g.__objToStr=h;function i(m){return typeof m==="object"&&h(m)==="[object Date]"}g.__isDate=i;function j(m){return typeof m==="object"&&h(m)==="[object Array]"}g.__isArray=j;function k(m){return typeof m==="object"&&h(m)==="[object RegExp]"}g.__isRegExp=k;function l(m){var n="";return m.global&&(n+="g"),m.ignoreCase&&(n+="i"),m.multiline&&(n+="m"),n}return g.__getRegExpFlags=l,g}();a.exports&&(a.exports=b)}),Yca=function a(b,c){if(b===c)return!0;if(b&&c&&typeof b=="object"&&typeof c=="object"){if(b.constructor!==c.constructor)return!1;var d,e,f;if(Array.isArray(b)){d=b.length;if(d!=c.length)return!1;for(e=d;e--!==0;)if(!a(b[e],c[e]))return!1;return!0}if(b.constructor===RegExp)return b.source===c.source&&b.flags===c.flags;if(b.valueOf!==Object.prototype.valueOf)return b.valueOf()===c.valueOf();if(b.toString!==Object.prototype.toString)return b.toString()===c.toString();f=Object.keys(b),d=f.length;if(d!==Object.keys(c).length)return!1;for(e=d;e--!==0;)if(!Object.prototype.hasOwnProperty.call(c,f[e]))return!1;for(e=d;e--!==0;){var g=f[e];if(!a(b[g],c[g]))return!1}return!0}return b!==b&&c!==c},Uk=function(a,b){b||(b={}),typeof b==="function"&&(b={cmp:b});var c=typeof b.cycles==="boolean"?b.cycles:!1,d=b.cmp&&function(f){return function(g){return function(h,i){var j={key:h,value:g[h]},k={key:i,value:g[i]};return f(j,k)}}}(b.cmp),e=[];return function f(g){g&&g.toJSON&&typeof g.toJSON==="function"&&(g=g.toJSON());if(g===void 0)return;if(typeof g=="number")return isFinite(g)?""+g:"null";if(typeof g!=="object")return JSON.stringify(g);var h,i;if(Array.isArray(g)){for(i="[",h=0;h<g.length;h++)h&&(i+=","),i+=f(g[h])||"null";return i+"]"}if(g===null)return"null";if(e.indexOf(g)!==-1){if(c)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var j=e.push(g)-1,k=Object.keys(g).sort(d&&d(g));for(i="",h=0;h<k.length;h++){var l=k[h],m=f(g[l]);if(!m)continue;i&&(i+=","),i+=JSON.stringify(l)+":"+m}return e.splice(j,1),"{"+i+"}"}(a)};function nx(a){return!!a.or}function ox(a){return!!a.and}function px(a){return!!a.not}function op(a,b){if(px(a))op(a.not,b);else if(ox(a))for(const c of a.and)op(c,b);else if(nx(a))for(const c of a.or)op(c,b);else b(a)}function pp(a,b){return px(a)?{not:pp(a.not,b)}:ox(a)?{and:a.and.map(c=>pp(c,b))}:nx(a)?{or:a.or.map(c=>pp(c,b))}:b(a)}const Vk=Yca,oa=Xca;function Wk(a,b){const c={};for(const d of b)_(a,d)&&(c[d]=a[d]);return c}function He(a,b){const c=Object.assign({},a);for(const d of b)delete c[d];return c}Set.prototype.toJSON=function(){return`Set(${[...this].map(a=>Uk(a)).join(",")})`};const Oa=Uk;function ua(a){if(Fa(a))return a;const b=V(a)?a:Uk(a);if(b.length<250)return b;let c=0;for(let d=0;d<b.length;d++){const e=b.charCodeAt(d);c=(c<<5)-c+e,c=c&c}return c}function qL(a){return a===!1||a===null}function fa(a,b){return a.indexOf(b)>-1}function Xk(a,b){let c=0;for(const[d,e]of a.entries())if(b(e,d,c++))return!0;return!1}function rL(a,b){let c=0;for(const[d,e]of a.entries())if(!b(e,d,c++))return!1;return!0}function Zca(a,...b){for(const c of b)_ca(a,c!==null&&c!==void 0?c:{});return a}function _ca(a,b){for(const c of O(b))Xq(a,c,b[c],!0)}function yf(a,b){const c=[],d={};let e;for(const f of a){e=b(f);if(e in d)continue;d[e]=1,c.push(f)}return c}function $ca(a,b){if(a.size!==b.size)return!1;for(const c of a)if(!b.has(c))return!1;return!0}function sL(a,b){for(const c of a)if(b.has(c))return!0;return!1}function tL(a){const b=new Set();for(const c of a){const d=oe(c),e=d.map((g,h)=>h===0?g:`[${g}]`),f=e.map((g,h)=>e.slice(0,h+1).join(""));for(const g of f)b.add(g)}return b}function uL(a,b){return a===void 0||b===void 0?!0:sL(tL(a),tL(b))}function Ha(a){return O(a).length===0}const O=Object.keys,zf=Object.values;function vL(a){const b=[];for(const c in a)_(a,c)&&b.push({key:c,value:a[c]});return b}function qp(a){return a===!0||a===!1}function Pa(a){const b=a.replace(/\W/g,"_");return(a.match(/^\d+/)?"_":"")+b}function Yk(a,b){return px(a)?"!("+Yk(a.not,b)+")":ox(a)?"("+a.and.map(c=>Yk(c,b)).join(") && (")+")":nx(a)?"("+a.or.map(c=>Yk(c,b)).join(") || (")+")":b(a)}function qx(a,b){if(b.length===0)return!0;const c=b.shift();return c in a&&qx(a[c],b)&&delete a[c],Ha(a)}function rp(a){return a.charAt(0).toUpperCase()+a.substr(1)}function wL(a,b="datum"){const c=oe(a),d=[];for(let e=1;e<=c.length;e++){const f=`[${c.slice(0,e).map(P).join("][")}]`;d.push(`${b}${f}`)}return d.join(" && ")}function ada(a,b="datum"){return`${b}[${P(oe(a).join("."))}]`}function bda(a){return a.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Af(a){return`${oe(a).map(bda).join("\\.")}`}function zi(a,b,c){return a.replace(new RegExp(b.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),c)}function xL(a){return`${oe(a).join(".")}`}function Zk(a){return a?oe(a).length:0}function db(...a){for(const b of a)if(b!==void 0)return b;return}let cda=42;function dda(a){const b=++cda;return a?String(a)+b:b}function eda(a){return fda(a)?a:`__${a}`}function fda(a){return a.indexOf("__")===0}function sp(a){return a===void 0?void 0:(a%360+360)%360}function rx(a){return Fa(a)?!0:!isNaN(a)&&!isNaN(parseFloat(a))}const yL={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function sx(a){return a&&a.condition}const zL=["domain","grid","labels","ticks","title"],gda={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},AL={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},hda=Object.assign(Object.assign({},AL),{style:1,labelExpr:1,encoding:1});function BL(a){return!!hda[a]}const cc={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},CL=cc.arc,tp=cc.area,up=cc.bar,ida=cc.image,vp=cc.line,wp=cc.point,jda=cc.rect,xp=cc.rule,DL=cc.text,tx=cc.tick,kda=cc.trail,ux=cc.circle,vx=cc.square,EL=cc.geoshape;function Ug(a){return fa(["line","area","trail"],a)}function FL(a){return fa(["rect","bar","image","arc"],a)}const GL=O(cc);function Yd(a){return a.type}const Hma=wb(GL),lda=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],mda=["fill","fillOpacity"],nda=[...lda,...mda],oda={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},HL=O(oda),pda={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},qda={color:"#4c78a8",invalid:"filter",timeUnitBand:1},rda={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},IL=5,sda={binSpacing:1,continuousBandSize:IL,timeUnitBandPosition:.5},tda={binSpacing:0,continuousBandSize:IL,timeUnitBandPosition:.5},uda={thickness:1};function vda(a){return Yd(a)?a.type:a}function Ie(a){return"mark"in a}class yp{constructor(a,b){this.name=a,this.run=b}hasMatchingType(a){return Ie(a)?vda(a.mark)===this.name:!1}}const wda={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},xda={count:1,min:1,max:1};function Bf(a){return!!a&&!!a.argmin}function Vg(a){return!!a&&!!a.argmax}function wx(a){return V(a)&&!!wda[a]}const yda=["count","valid","missing","distinct"];function JL(a){return V(a)&&fa(yda,a)}function zda(a){return V(a)&&fa(["min","max"],a)}const Ada=["count","sum","distinct","valid","missing"],Bda=["mean","average","median","q1","q3","min","max"],Cda=wb(Bda),Je="row",Ke="column",zp="facet",Ta="x",jb="y",xd="x2",Zd="y2",_d="radius",Le="radius2",yd="theta",Me="theta2",$d="latitude",ae="longitude",zd="latitude2",ad="longitude2",wc="color",be="fill",ce="stroke",xc="shape",Ne="size",Wg="angle",Oe="opacity",Cf="fillOpacity",Df="strokeOpacity",Ef="strokeWidth",Ff="strokeDash",_k="text",$k="order",al="detail",Ap="key",Xg="tooltip",Bp="href",Cp="url",Dp="description",Dda={x:1,y:1,x2:1,y2:1},KL={theta:1,theta2:1,radius:1,radius2:1};function LL(a){return a in KL}const xx={longitude:1,longitude2:1,latitude:1,latitude2:1};function Eda(a){switch(a){case $d:return"y";case zd:return"y2";case ae:return"x";case ad:return"x2"}}function Fda(a){return a in xx}const Gda=O(xx),ML=Object.assign(Object.assign(Object.assign(Object.assign({},Dda),KL),xx),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Ai(a){return a===wc||a===be||a===ce}const NL={row:1,column:1,facet:1},bd=O(NL),yx=Object.assign(Object.assign({},ML),NL),OL=O(yx),Hda=$(yx,["order","detail","tooltip"]),Ida=$(Hda,["row","column","facet"]);function Jda(a){return!!Ida[a]}function PL(a){return!!yx[a]}const Kda=[xd,Zd,zd,ad,Me,Le];function QL(a){const b=Yg(a);return b!==a}function Yg(a){switch(a){case xd:return Ta;case Zd:return jb;case zd:return $d;case ad:return ae;case Me:return yd;case Le:return _d}return a}function Gf(a){if(LL(a))switch(a){case yd:return"startAngle";case Me:return"endAngle";case _d:return"outerRadius";case Le:return"innerRadius"}return a}function de(a){switch(a){case Ta:return xd;case jb:return Zd;case $d:return zd;case ae:return ad;case yd:return Me;case _d:return Le}return}function ee(a){switch(a){case Ta:case xd:return"width";case jb:case Zd:return"height"}return}function Lda(a){switch(a){case Ta:return"xOffset";case jb:return"yOffset";case xd:return"x2Offset";case Zd:return"y2Offset";case yd:return"thetaOffset";case _d:return"radiusOffset";case Me:return"theta2Offset";case Le:return"radius2Offset"}return}const zx=$(ML,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Mda=O(zx),Hf={x:1,y:1},cd=O(Hf);function fe(a){return a in Hf}const Ax={theta:1,radius:1},Nda=O(Ax);function Ep(a){return a==="width"?Ta:jb}const RL=$(zx,["text","tooltip","href","url","description","detail","key","order"]),Oda=O(RL);function Pda(a){return!!zx[a]}function Qda(a){switch(a){case wc:case be:case ce:case Ne:case xc:case Oe:case Ef:case Ff:return!0;case Cf:case Df:case Wg:return!1}}const SL=Object.assign(Object.assign(Object.assign({},Hf),Ax),RL),Fp=O(SL);function If(a){return!!SL[a]}function Rda(a,b){return Tda(a)[b]}const TL={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Sda=$(TL,["geoshape"]);function Tda(a){switch(a){case wc:case be:case ce:case Dp:case al:case Ap:case Xg:case Bp:case $k:case Oe:case Cf:case Df:case Ef:case zp:case Je:case Ke:return TL;case Ta:case jb:case $d:case ae:return Sda;case xd:case Zd:case zd:case ad:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Ne:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Ff:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case xc:return{point:"always",geoshape:"always"};case _k:return{text:"always"};case Wg:return{point:"always",square:"always",text:"always"};case Cp:return{image:"always"};case yd:return{text:"always",arc:"always"};case _d:return{text:"always",arc:"always"};case Me:case Le:return{arc:"always"}}}function Gp(a){switch(a){case Ta:case jb:case yd:case _d:case Ne:case Wg:case Ef:case Oe:case Cf:case Df:case xd:case Zd:case Me:case Le:return;case zp:case Je:case Ke:case xc:case Ff:case _k:case Xg:case Bp:case Cp:case Dp:return"discrete";case wc:case be:case ce:return"flexible";case $d:case ae:case zd:case ad:case al:case Ap:case $k:return}}function UL(a){return bg(a)&&(a=Sp(a,void 0)),"bin"+O(a).map(b=>Hp(a[b])?Pa(`_${b}_${Object.entries(a[b])}`):Pa(`_${b}_${a[b]}`)).join("")}function Ia(a){return a===!0||bl(a)&&!a.binned}function dc(a){return a==="binned"||bl(a)&&a.binned===!0}function bl(a){return Z(a)}function Hp(a){return a===null||a===void 0?void 0:a.selection}function VL(a){switch(a){case Je:case Ke:case Ne:case wc:case be:case ce:case Ef:case Oe:case Cf:case Df:case xc:return 6;case Ff:return 4;default:return 10}}function Bx(a){return`Invalid specification ${JSON.stringify(a)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Uda='Autosize "fit" only works for single views and layered views.';function WL(a){const b=a=="width"?"Width":"Height";return`${b} "container" only works for single views and layered views.`}function XL(a){const b=a=="width"?"Width":"Height",c=a=="width"?"x":"y";return`${b} "container" only works well with autosize "fit" or "fit-${c}".`}function YL(a){return a?`Dropping "fit-${a}" because spec has discrete ${ee(a)}.`:'Dropping "fit" because spec has discrete size.'}function ZL(a){return`Cannot project a selection on encoding channel "${a}", which has no field.`}function Vda(a,b){return`Cannot project a selection on encoding channel "${a}" as it uses an aggregate function ("${b}").`}function Wda(a){return`The "nearest" transform is not supported for ${a} marks.`}function _L(a){return`Selection not supported for ${a} yet.`}function Xda(a){return`Cannot find a selection named "${a}".`}const Yda="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Zda="Legend bindings are only supported for selections over an individual field or encoding channel.";function _da(a){return`Cannot define and lookup the "${a}" selection in the same view. Try moving the lookup into a second, layered view?`}function $da(a){return`Unknown repeated value "${a}".`}function $L(a){return`The "columns" property cannot be used when "${a}" has nested row/column.`}const aea="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function bea(a){return`Unrecognized parse "${a}".`}function aM(a,b,c){return`An ancestor parsed field "${a}" as ${c} but a child wants to parse the field as ${b}.`}function cea(a){return`Ignoring an invalid transform: ${Oa(a)}.`}const dea='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function bM(a){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${a} are dropped.`}function eea(a){return`Layer's shared ${a.join(",")} channel ${a.length===1?"is":"are"} overriden.`}function fea(a){const{parentProjection:b,projection:c}=a;return`Layer's shared projection ${Oa(b)} is overridden by a child projection ${Oa(c)}.`}const gea="Arc marks uses theta channel rather than angle, replacing angle with theta.";function hea(a,b,c){return`Channel ${a} is a ${b}. Converted to {value: ${Oa(c)}}.`}function cM(a){return`Invalid field type "${a}".`}function iea(a,b){return`Invalid field type "${a}" for aggregate: "${b}", using "quantitative" instead.`}function jea(a){return`Invalid aggregation operator "${a}".`}function kea(a,b){return`Missing type for channel "${a}", using "${b}" instead.`}function dM(a,b){const{fill:c,stroke:d}=b;return`Dropping color ${a} as the plot also has ${c&&d?"fill and stroke":c?"fill":"stroke"}.`}function Cx(a,b){return`Dropping ${Oa(a)} from channel "${b}" since it does not contain any data field, datum, value, or signal.`}const lea="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ip(a,b,c){return`${a} dropped as it is incompatible with "${b}"${c?` when ${c}`:""}.`}function mea(a){return`${a}-encoding is dropped as ${a} is not a valid encoding channel.`}function nea(a){return`${a} encoding should be discrete (ordinal / nominal / binned).`}function oea(a){return`Facet encoding dropped as ${a.join(" and ")} ${a.length>1?"are":"is"} also specified.`}function Dx(a,b){return`Using discrete channel "${a}" to encode "${b}" field can be misleading as it does not encode ${b==="ordinal"?"order":"magnitude"}.`}function pea(a,b){const c=a&&b?"x2 and y2":a?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${c}. We will use the rule mark (line segments) instead.`}function qea(a,b){return`Specified orient "${a}" overridden with "${b}".`}const rea=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function sea(a){return`Cannot use the scale property "${a}" with non-color channel.`}function tea(a){return`Using unaggregated domain with raw field has no effect (${Oa(a)}).`}function uea(a){return`Unaggregated domain not applicable for "${a}" since it produces values outside the origin domain of the source data.`}function vea(a){return`Unaggregated domain is currently unsupported for log scale (${Oa(a)}).`}function wea(a){return`Cannot apply size to non-oriented mark "${a}".`}function xea(a,b,c){return`Channel "${a}" does not work with "${b}" scale. We are using "${c}" scale instead.`}function yea(a,b){return`FieldDef does not work with "${a}" scale. We are using "${b}" scale instead.`}function eM(a,b,c){return`${c}-scale's "${b}" is dropped as it does not work with ${a} scale.`}function fM(a){return`The step for "${a}" is dropped because the ${a==="width"?"x":"y"} is continuous.`}function zea(a,b,c,d){return`Conflicting ${b.toString()} property "${a.toString()}" (${Oa(c)} and ${Oa(d)}). Using ${Oa(c)}.`}function Aea(a,b,c,d){return`Conflicting ${b.toString()} property "${a.toString()}" (${Oa(c)} and ${Oa(d)}). Using the union of the two domains.`}function Bea(a){return`Setting the scale to be independent for "${a}" means we also have to set the guide (axis or legend) to be independent.`}function Cea(a){return`Dropping sort property ${Oa(a)} as unioned domains only support boolean or op "count", "min", and "max".`}const gM="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Dea="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Eea="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Fea="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Gea(a){return`Cannot stack "${a}" if there is already "${a}2".`}function Hea(a){return`Cannot stack non-linear scale (${a}).`}function Iea(a){return`Stacking is applied even though the aggregate function is non-summative ("${a}").`}function Jp(a,b){return`Invalid ${a}: ${Oa(b)}.`}function Jea(a){return`Dropping day from datetime ${Oa(a)} as day cannot be combined with other units.`}function Kea(a,b){return`${b?"extent ":""}${b&&a?"and ":""}${a?"center ":""}${b&&a?"are ":"is "}not needed when data are aggregated.`}function Lea(a,b,c){return`${a} is not usually used with ${b} for ${c}.`}function Mea(a,b){return`Continuous axis should not have customized aggregation function ${a}; ${b} already agregates the axis.`}function Nea(a,b){return`Center is not needed to be specified in ${b} when extent is ${a}.`}function hM(a){return`1D error band does not support ${a}.`}function iM(a){return`Channel ${a} is required for "binned" bin.`}function Oea(a){return`Domain for ${a} is required for threshold scale.`}const jM=$z(_z);let Bi=jM;function Pea(a){return Bi=a,Bi}function Qea(){return Bi=jM,Bi}function L(...a){Bi.warn(...a)}function Rea(...a){Bi.debug(...a)}function Ci(a){if(a&&Z(a)){for(const b of Fx)if(b in a)return!0}return!1}const kM=["january","february","march","april","may","june","july","august","september","october","november","december"],Sea=kM.map(a=>a.substr(0,3)),lM=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Tea=lM.map(a=>a.substr(0,3));function Uea(a){rx(a)&&(a=+a);if(Fa(a))return a>4&&L(Jp("quarter",a)),a-1;throw new Error(Jp("quarter",a))}function Vea(a){rx(a)&&(a=+a);if(Fa(a))return a-1;{const b=a.toLowerCase(),c=kM.indexOf(b);if(c!==-1)return c;const d=b.substr(0,3),e=Sea.indexOf(d);if(e!==-1)return e;throw new Error(Jp("month",a))}}function Wea(a){rx(a)&&(a=+a);if(Fa(a))return a%7;{const b=a.toLowerCase(),c=lM.indexOf(b);if(c!==-1)return c;const d=b.substr(0,3),e=Tea.indexOf(d);if(e!==-1)return e;throw new Error(Jp("day",a))}}function Ex(a,b){const c=[];b&&a.day!==void 0&&(O(a).length>1&&(L(Jea(a)),a=oa(a),delete a.day)),a.year!==void 0?c.push(a.year):c.push(2012);if(a.month!==void 0){const d=b?Vea(a.month):a.month;c.push(d)}else if(a.quarter!==void 0){const d=b?Uea(a.quarter):a.quarter;c.push(Fa(d)?d*3:d+"*3")}else c.push(0);if(a.date!==void 0)c.push(a.date);else if(a.day!==void 0){const d=b?Wea(a.day):a.day;c.push(Fa(d)?d+1:d+"+1")}else c.push(1);for(const d of["hours","minutes","seconds","milliseconds"]){const e=a[d];c.push(typeof e==="undefined"?0:e)}return c}function cl(a){const b=Ex(a,!0),c=b.join(", ");return a.utc?`utc(${c})`:`datetime(${c})`}function Xea(a){const b=Ex(a,!1),c=b.join(", ");return a.utc?`utc(${c})`:`datetime(${c})`}function Yea(a){const b=Ex(a,!0);return a.utc?+new Date(Date.UTC(...b)):+new Date(...b)}const mM={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Fx=O(mM);function Zea(a){return!!mM[a]}function Gx(a){return a.startsWith("utc")}function _ea(a){return a.substr(3)}const $ea={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Hx(a){const b=[];for(const c of Fx)nM(a,c)&&b.push(c);return b}function nM(a,b){const c=a.indexOf(b);return c<0?!1:c>0&&b==="seconds"&&a.charAt(c-1)==="i"?!1:a.length>c+3&&b==="day"&&a.charAt(c+3)==="o"?!1:c>0&&b==="year"&&a.charAt(c-1)==="f"?!1:!0}function afa(a,b,{end:c}={end:!1}){const d=wL(b),e=Gx(a)?"utc":"";function f(i){return i==="quarter"?`(${e}quarter(${d})-1)`:`${e}${i}(${d})`}let g;const h={};for(const i of Fx)nM(a,i)&&(h[i]=f(i),g=i);return c&&(h[g]+="+1"),Xea(h)}function oM(a){if(!a)return;const b=Hx(a);return`timeUnitSpecifier(${Uk(b)}, ${Uk($ea)})`}function bfa(a,b,c){if(!a)return;const d=oM(a),e=c||Gx(a);return`${e?"utc":"time"}Format(${b}, ${d})`}function ec(a){if(!a)return;let b;return V(a)?b={unit:a}:Z(a)&&(b=Object.assign(Object.assign({},a),a.unit?{unit:a.unit}:{})),Gx(b.unit)&&(b.utc=!0,b.unit=_ea(b.unit)),b}function cfa(a){const b=ec(a),{utc:c}=b,d=$(b,["utc"]);return d.unit?(c?"utc":"")+O(d).map(e=>Pa(`${e==="unit"?"":`_${e}_`}${d[e]}`)).join(""):(c?"utc":"")+"timeunit"+O(d).map(e=>Pa(`_${e}_${d[e]}`)).join("")}function ga(a){return a&&!!a.signal}function Jf(a){return!!a.step}function dfa(a){return J(a)?!1:"fields"in a&&!("data"in a)}function efa(a){return J(a)?!1:"fields"in a&&"data"in a}function Kf(a){return J(a)?!1:"field"in a&&"data"in a}const ffa={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},gfa=O(ffa),hfa={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Ix=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function ifa(a){return a===null||a===void 0?void 0:a.selection}function Jx(a){return a&&!!a.field&&a.equal!==void 0}function pM(a){return a&&!!a.field&&a.lt!==void 0}function qM(a){return a&&!!a.field&&a.lte!==void 0}function rM(a){return a&&!!a.field&&a.gt!==void 0}function sM(a){return a&&!!a.field&&a.gte!==void 0}function Kx(a){if(a&&a.field){if(J(a.range)&&a.range.length===2)return!0;if(ga(a.range))return!0}return!1}function Lx(a){return a&&!!a.field&&(J(a.oneOf)||J(a.in))}function jfa(a){return a&&!!a.field&&a.valid!==void 0}function tM(a){return Lx(a)||Jx(a)||Kx(a)||pM(a)||rM(a)||qM(a)||sM(a)}function ge(a,b){return by(a,{timeUnit:b,wrapTime:!0})}function kfa(a,b){return a.map(c=>ge(c,b))}function uM(a,b=!0){var c;const{field:d}=a,e=(c=ec(a.timeUnit))===null||c===void 0?void 0:c.unit,f=e?"time("+afa(e,d)+")":Q(a,{expr:"datum"});if(Jx(a))return f+"==="+ge(a.equal,e);if(pM(a)){const g=a.lt;return`${f}<${ge(g,e)}`}else if(rM(a)){const g=a.gt;return`${f}>${ge(g,e)}`}else if(qM(a)){const g=a.lte;return`${f}<=${ge(g,e)}`}else if(sM(a)){const g=a.gte;return`${f}>=${ge(g,e)}`}else{if(Lx(a))return`indexof([${kfa(a.oneOf,e).join(",")}], ${f}) !== -1`;{if(jfa(a))return Mx(f,a.valid);if(Kx(a)){const{range:g}=a,h=ga(g)?{signal:`${g.signal}[0]`}:g[0],i=ga(g)?{signal:`${g.signal}[1]`}:g[1];if(h!==null&&i!==null&&b)return"inrange("+f+", ["+ge(h,e)+", "+ge(i,e)+"])";const j=[];return h!==null&&j.push(`${f} >= ${ge(h,e)}`),i!==null&&j.push(`${f} <= ${ge(i,e)}`),j.length>0?j.join(" && "):"true"}}}throw new Error(`Invalid field predicate: ${JSON.stringify(a)}`)}function Mx(a,b=!0){return b?`isValid(${a}) && isFinite(+${a})`:`!isValid(${a}) || !isFinite(+${a})`}function lfa(a){var b;return tM(a)&&a.timeUnit?Object.assign(Object.assign({},a),{timeUnit:(b=ec(a.timeUnit))===null||b===void 0?void 0:b.unit}):a}const Di={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Zg=Di.quantitative,Nx=Di.ordinal,Ei=Di.temporal,Ox=Di.nominal,Fi=Di.geojson,mfa=O(Di);function nfa(a){if(a){a=a.toLowerCase();switch(a){case"q":case Zg:return"quantitative";case"t":case Ei:return"temporal";case"o":case Nx:return"ordinal";case"n":case Ox:return"nominal";case Fi:return"geojson"}}return}const eb={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Px={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},ofa=O(Px);function pfa(a,b){const c=Px[a],d=Px[b];return c===d||c==="ordinal-position"&&d==="time"||d==="ordinal-position"&&c==="time"}const qfa={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function vM(a){return qfa[a]}const wM=["linear","log","pow","sqrt","symlog","time","utc"],rfa=wb(wM),sfa=["linear","log","pow","sqrt","symlog"],tfa=wb(sfa);function ufa(a){return a in tfa}const vfa=["quantile","quantize","threshold"],wfa=wb(vfa),xfa=wM.concat(["quantile","quantize","threshold","sequential","identity"]),yfa=wb(xfa),zfa=["ordinal","bin-ordinal","point","band"],Afa=wb(zfa);function yc(a){return a in Afa}function dd(a){return a in yfa}function Ad(a){return a in rfa}function Kp(a){return a in wfa}const Bfa={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Cfa(a){return!V(a)&&!!a.name}function xM(a){return a===null||a===void 0?void 0:a.selection}function Dfa(a){return a&&a.unionWith}const Efa={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Ffa=$(Efa,["type","domain","range","scheme"]),Gfa=O(Ffa),Ima=Hfa();function yM(a,b){switch(b){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!fa(["point","band","identity"],a);case"bins":return!fa(["point","band","identity","ordinal"],a);case"round":return Ad(a)||a==="band"||a==="point";case"padding":return Ad(a)||fa(["point","band"],a);case"paddingOuter":case"align":return fa(["point","band"],a);case"paddingInner":return a==="band";case"domainMid":case"clamp":return Ad(a);case"nice":return Ad(a)||a==="quantize"||a==="threshold";case"exponent":return a==="pow";case"base":return a==="log";case"constant":return a==="symlog";case"zero":return dd(a)&&!fa(["log","time","utc","threshold","quantile"],a)}}function zM(a,b){switch(b){case"interpolate":case"scheme":case"domainMid":return Ai(a)?void 0:sea(a);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function AM(a,b){if(fa([Nx,Ox],b))return a===void 0||yc(a);{if(b===Ei)return fa([eb.TIME,eb.UTC,void 0],a);if(b===Zg)return fa([eb.LOG,eb.POW,eb.SQRT,eb.SYMLOG,eb.QUANTILE,eb.QUANTIZE,eb.THRESHOLD,eb.LINEAR,void 0],a)}return!0}function BM(a,b){if(!If(a))return!1;switch(a){case Ta:case jb:case yd:case _d:return Ad(b)||fa(["band","point"],b);case Ne:case Ef:case Oe:case Cf:case Df:case Wg:return Ad(b)||Kp(b)||fa(["band","point","ordinal"],b);case wc:case be:case ce:return b!=="band";case Ff:return b==="ordinal"||Kp(b);case xc:return b==="ordinal"}}function Hfa(){var a;const b={};for(const c of OL)for(const d of mfa)for(const e of ofa){const f=Ifa(c,d);BM(c,e)&&AM(e,d)&&(b[f]=(a=b[f])!==null&&a!==void 0?a:[],b[f].push(e))}return b}function Ifa(a,b){return a+"_"+b}function Qx(a){const{channel:b,channelDef:c,markDef:d,scale:e,config:f}=a,g=DM(a);return R(c)&&!JL(c.aggregate)&&e&&Ad(e.get("type"))&&e.get("zero")===!1?CM({fieldDef:c,channel:b,markDef:d,ref:g,config:f}):g}function CM({fieldDef:a,channel:b,markDef:c,ref:d,config:e}){if(Ug(c.type))return d;const f=Aa("invalid",c,e);return f===null?d:[Jfa(a,b),d]}function Jfa(a,b){const c=Rx(a,!0),d=Yg(b),e=d==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:c},e)}function Rx(a,b=!0){return Mx(V(a)?a:Q(a,{expr:"datum"}),!b)}function Kfa(a){const{datum:b}=a;return Ci(b)?cl(b):`${JSON.stringify(b)}`}function _g(a,b,c,d){const e={};b&&(e.scale=b);if(Mf(a)){const{datum:f}=a;Ci(f)?e.signal=cl(f):ga(f)?e.signal=f.signal:e.value=f}else e.field=Q(a,c);if(d){const{offset:f,band:g}=d;f&&(e.offset=f),g&&(e.band=g)}return e}function Lp({scaleName:a,fieldOrDatumDef:b,fieldOrDatumDef2:c,offset:d,startSuffix:e,band:f=.5}){const g=0<f&&f<1?"datum":void 0,h=Q(b,{expr:g,suffix:e}),i=c!==void 0?Q(c,{expr:g}):Q(b,{suffix:"end",expr:g}),j={};if(f===0||f===1){j.scale=a;const k=f===0?h:i;j.field=k}else{const k=`${f} * ${h} + ${1-f} * ${i}`;j.signal=`scale("${a}", ${k})`}return d&&(j.offset=d),j}function DM({channel:a,channelDef:b,channel2Def:c,markDef:d,config:e,scaleName:f,scale:g,stack:h,offset:i,defaultRef:j,band:k}){var l;if(b){if(ha(b)){if(Lc(b)){k=k!==null&&k!==void 0?k:fl({channel:a,fieldDef:b,fieldDef2:c,markDef:d,stack:h,config:e,isMidPoint:!0});const{bin:n,timeUnit:o,type:p}=b;if(Ia(n)||k&&o&&p===Ei)return h&&h.impute?_g(b,f,{binSuffix:"mid"},{offset:i}):k?Lp({scaleName:f,fieldOrDatumDef:b,band:k,offset:i}):_g(b,f,gl(b,a)?{binSuffix:"range"}:{},{offset:i});if(dc(n)){if(R(c))return Lp({scaleName:f,fieldOrDatumDef:b,fieldOrDatumDef2:c,band:k,offset:i});{const q=a===Ta?xd:Zd;L(iM(q))}}}const m=g===null||g===void 0?void 0:g.get("type");return _g(b,f,yc(m)?{binSuffix:"range"}:{},{offset:i,band:m==="band"?(l=k!==null&&k!==void 0?k:b.band)!==null&&l!==void 0?l:.5:void 0})}else if(Pe(b)){const m=b.value,n=i?{offset:i}:{};return Object.assign(Object.assign({},dl(a,m)),n)}}return pa(j)&&(j=j()),j?Object.assign(Object.assign({},j),i?{offset:i}:{}):j}function dl(a,b){return fa(["x","x2"],a)&&b==="width"?{field:{group:"width"}}:fa(["y","y2"],a)&&b==="height"?{field:{group:"height"}}:ab(b)}function $g(a){return a&&a!=="number"&&a!=="time"}function EM(a,b,c){return`${a}(${b}${c?`, ${JSON.stringify(c)}`:""})`}const Lfa=" – ";function Sx({fieldOrDatumDef:a,format:b,formatType:c,expr:d,normalizeStack:e,config:f}){var g,h;if($g(c))return Tx({fieldOrDatumDef:a,format:b,formatType:c,expr:d,config:f});const i=FM(a,d,e);if(Tp(a)){const j=Nfa(i,R(a)?(g=ec(a.timeUnit))===null||g===void 0?void 0:g.unit:void 0,b,f.timeFormat,Zx(a)&&((h=a.scale)===null||h===void 0?void 0:h.type)===eb.UTC);return j?{signal:j}:void 0}b=IM(Lf(a),b,f);if(R(a)&&Ia(a.bin)){const j=Q(a,{expr:d,binSuffix:"end"});return{signal:Mp(i,j,b,c,f)}}else return b||Lf(a)==="quantitative"?{signal:`${JM(i,b)}`}:{signal:`isValid(${i}) ? ${i} : ""+${i}`}}function FM(a,b,c){return R(a)?c?`${Q(a,{expr:b,suffix:"end"})}-${Q(a,{expr:b,suffix:"start"})}`:Q(a,{expr:b}):Kfa(a)}function Tx({fieldOrDatumDef:a,format:b,formatType:c,expr:d,normalizeStack:e,config:f,field:g}){g=g!==null&&g!==void 0?g:FM(a,d,e);if(R(a)&&Ia(a.bin)){const h=Q(a,{expr:d,binSuffix:"end"});return{signal:Mp(g,h,b,c,f)}}return{signal:EM(c,g,b)}}function GM(a,b,c,d,e,f){var g;if($g(d))return;if(Tp(a)){const h=R(a)?(g=ec(a.timeUnit))===null||g===void 0?void 0:g.unit:void 0;return Mfa(c,h,e,f)}return IM(b,c,e)}function HM(a,b,c){return a&&(ga(a)||a==="number"||a==="time")?a:Tp(b)&&c!=="time"&&c!=="utc"?"time":void 0}function IM(a,b,c){return V(b)?b:a===Zg?c.numberFormat:void 0}function Mfa(a,b,c,d){return a?a:b?{signal:oM(b)}:d?void 0:c.timeFormat}function JM(a,b){return`format(${a}, "${b||""}")`}function KM(a,b,c,d){var e;return $g(c)?EM(c,a,b):JM(a,(e=V(b)?b:void 0)!==null&&e!==void 0?e:d.numberFormat)}function Mp(a,b,c,d,e){const f=KM(a,c,d,e),g=KM(b,c,d,e);return`${Mx(a,!1)} ? "null" : ${f} + "${Lfa}" + ${g}`}function Nfa(a,b,c,d,e){return!b||c?(c=V(c)?c:d,`${e?"utc":"time"}Format(${a}, '${c}')`):bfa(b,a,e)}const Np="min",Ofa={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function LM(a){return a in Ofa}function MM(a){return!!a&&!!a.encoding}function he(a){return!!a&&(a.op==="count"||!!a.field)}function NM(a){return!!a&&J(a)}function el(a){return"row"in a||"column"in a}function Ux(a){return!!a&&"header"in a}function Op(a){return"facet"in a}function Pfa(a){return a.selection}function Qfa(a){return a&&!V(a)&&"repeat"in a}function OM(a){const{field:b,timeUnit:c,bin:d,aggregate:e}=a;return Object.assign(Object.assign(Object.assign(Object.assign({},c?{timeUnit:c}:{}),d?{bin:d}:{}),e?{aggregate:e}:{}),{field:b})}function PM(a){return Lc(a)&&"sort"in a}function fl({channel:a,fieldDef:b,fieldDef2:c,markDef:d,stack:e,config:f,isMidPoint:g}){if(ha(b)&&b.band!==void 0)return b.band;if(R(b)){const{timeUnit:h,bin:i}=b;if(h&&!c)return g?ch("timeUnitBandPosition",d,f):FL(d.type)?ch("timeUnitBand",d,f):0;if(Ia(i))return FL(d.type)&&!g?1:.5}return(e===null||e===void 0?void 0:e.fieldChannel)===a&&g?.5:void 0}function Vx(a,b,c,d,e,f){return Ia(b.bin)||b.timeUnit&&Lc(b)&&b.type==="temporal"?!!fl({channel:a,fieldDef:b,fieldDef2:c,stack:d,markDef:e,config:f}):!1}function Wx(a){return!!a&&"condition"in a}function Pp(a){const b=a&&a.condition;return!!b&&!J(b)&&R(b)}function Xx(a){const b=a&&a.condition;return!!b&&!J(b)&&ha(b)}function Rfa(a){const b=a&&a.condition;return!!b&&(J(b)||Pe(b))}function R(a){return!!a&&(!!a.field||a.aggregate==="count")}function Lf(a){return a&&a.type}function Mf(a){return!!a&&"datum"in a}function ie(a){return Lc(a)&&TM(a)||Yx(a)}function Yx(a){return Mf(a)&&Fa(a.datum)}function ha(a){return R(a)||Mf(a)}function Lc(a){return!!a&&("field"in a&&"type"in a||a.aggregate==="count")}function Pe(a){return a&&"value"in a&&"value"in a}function Zx(a){return!!a&&("scale"in a||"sort"in a)}function _x(a){return a&&("axis"in a||"stack"in a||"impute"in a)}function QM(a){return!!a&&"legend"in a}function RM(a){return!!a&&("format"in a||"formatType"in a)}function Sfa(a){return"op"in a}function Q(a,b={}){var c,d,e;let f=a.field;const g=b.prefix;let h=b.suffix,i="";if(Tfa(a))f=eda("count");else{let j;if(!b.nofn)if(Sfa(a))j=a.op;else{const{bin:k,aggregate:l,timeUnit:m}=a;Ia(k)?(j=UL(k),h=((c=b.binSuffix)!==null&&c!==void 0?c:"")+((d=b.suffix)!==null&&d!==void 0?d:"")):l?Vg(l)?(i=`["${f}"]`,f=`argmax_${l.argmax}`):Bf(l)?(i=`["${f}"]`,f=`argmin_${l.argmin}`):j=String(l):m&&(j=cfa(m),h=(!fa(["range","mid"],b.binSuffix)&&b.binSuffix||"")+((e=b.suffix)!==null&&e!==void 0?e:""))}j&&(f=f?`${j}_${f}`:j)}return h&&(f=`${f}_${h}`),g&&(f=`${g}_${f}`),b.forAs?xL(f):b.expr?ada(f,b.expr)+i:Af(f)+i}function SM(a){switch(a.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return R(a)&&!!a.bin;case"temporal":return!1}throw new Error(cM(a.type))}function TM(a){return!SM(a)}function Tfa(a){return a.aggregate==="count"}function Ufa(a,b){var c;const{field:d,bin:e,timeUnit:f,aggregate:g}=a;if(g==="count")return b.countTitle;{if(Ia(e))return`${d} (binned)`;if(f){const h=(c=ec(f))===null||c===void 0?void 0:c.unit;if(h)return`${d} (${Hx(h).join("-")})`}else if(g)return Vg(g)?`${d} for max ${g.argmax}`:Bf(g)?`${d} for min ${g.argmin}`:`${rp(g)} of ${d}`}return d}function Vfa(a){const{aggregate:b,bin:c,timeUnit:d,field:e}=a;if(Vg(b))return`${e} for argmax(${b.argmax})`;if(Bf(b))return`${e} for argmin(${b.argmin})`;const f=ec(d),g=b||(f===null||f===void 0?void 0:f.unit)||(f===null||f===void 0?void 0:f.maxbins)&&"timeunit"||Ia(c)&&"bin";return g?g.toUpperCase()+"("+e+")":e}const UM=(a,b)=>{switch(b.fieldTitle){case"plain":return a.field;case"functional":return Vfa(a);default:return Ufa(a,b)}};let VM=UM;function WM(a){VM=a}function Wfa(){WM(UM)}function ah(a,b,{allowDisabling:c,includeDefault:d=!0}){var e,f;const g=(e=$x(a))!==null&&e!==void 0?e:{},h=g.title;if(!R(a))return h;const i=a,j=d?XM(i,b):void 0;return c?db(h,i.title,j):(f=h!==null&&h!==void 0?h:i.title)!==null&&f!==void 0?f:j}function $x(a){if(_x(a)&&a.axis)return a.axis;{if(QM(a)&&a.legend)return a.legend;if(Ux(a)&&a.header)return a.header}return}function XM(a,b){return VM(a,b)}function Qp(a){var b;if(RM(a)){const{format:c,formatType:d}=a;return{format:c,formatType:d}}else{const c=(b=$x(a))!==null&&b!==void 0?b:{},{format:d,formatType:e}=c;return{format:d,formatType:e}}}function Xfa(a,b){if(a.timeUnit)return"temporal";if(Ia(a.bin))return"quantitative";switch(Gp(b)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function je(a){return R(a)?a:Pp(a)?a.condition:void 0}function kb(a){return ha(a)?a:Xx(a)?a.condition:void 0}function ay(a,b,c){if(V(a)||Fa(a)||bg(a)){const d=V(a)?"string":Fa(a)?"number":"boolean";return L(hea(b,d,a)),{value:a}}return ha(a)?Rp(a,b,c):Xx(a)?Object.assign(Object.assign({},a),{condition:Rp(a.condition,b,c)}):a}function Rp(a,b,c){if(RM(a)){const{format:d,formatType:e}=a,f=$(a,["format","formatType"]);if($g(e)&&!c.customFormatTypes)return L(bM(b)),Rp(f,b,c)}else{const d=_x(a)?"axis":QM(a)?"legend":Ux(a)?"header":null;if(d&&a[d]){const e=a[d],{format:f,formatType:g}=e,h=$(e,["format","formatType"]);if($g(g)&&!c.customFormatTypes)return L(bM(b)),Rp(Object.assign(Object.assign({},a),{[d]:h}),b,c)}}return R(a)?YM(a,b):Yfa(a)}function Yfa(a){let b=a.type;if(b)return a;const{datum:c}=a;return b=Fa(c)?"quantitative":V(c)?"nominal":Ci(c)?"temporal":void 0,Object.assign(Object.assign({},a),{type:b})}function YM(a,b){const{aggregate:c,timeUnit:d,bin:e,field:f}=a,g=Object.assign({},a);c&&!wx(c)&&!Vg(c)&&!Bf(c)&&(L(jea(c)),delete g.aggregate),d&&(g.timeUnit=ec(d)),f&&(g.field=`${f}`),Ia(e)&&(g.bin=Sp(e,b)),dc(e)&&!fe(b)&&L(`Channel ${b} should not be used with "binned" bin.`);if(Lc(g)){const{type:h}=g,i=nfa(h);h!==i&&(g.type=i),h!=="quantitative"&&(JL(c)&&(L(iea(h,c)),g.type="quantitative"))}else if(!QL(b)){const h=Xfa(g,b);L(kea(b,h)),g.type=h}if(Lc(g)){const{compatible:h,warning:i}=Zfa(g,b);h||L(i)}if(PM(g)&&V(g.sort)){const{sort:h}=g;if(LM(h))return Object.assign(Object.assign({},g),{sort:{encoding:h}});const i=h.substr(1);if(h.charAt(0)==="-"&&LM(i))return Object.assign(Object.assign({},g),{sort:{encoding:i,order:"descending"}})}if(Ux(g)){const{header:h}=g,{orient:i}=h,j=$(h,["orient"]);if(i)return Object.assign(Object.assign({},g),{header:Object.assign(Object.assign({},j),{labelOrient:h.labelOrient||i,titleOrient:h.titleOrient||i})})}return g}function Sp(a,b){return bg(a)?{maxbins:VL(b)}:a==="binned"?{binned:!0}:!a.maxbins&&!a.step?Object.assign(Object.assign({},a),{maxbins:VL(b)}):a}const bh={compatible:!0};function Zfa(a,b){const c=a.type;if(c==="geojson"&&b!=="shape")return{compatible:!1,warning:`Channel ${b} should not be used with a geojson data.`};switch(b){case Je:case Ke:case zp:return TM(a)?{compatible:!1,warning:nea(b)}:bh;case Ta:case jb:case wc:case be:case ce:case _k:case al:case Ap:case Xg:case Bp:case Cp:case Wg:case yd:case _d:case Dp:return bh;case ae:case ad:case $d:case zd:return c!==Zg?{compatible:!1,warning:`Channel ${b} should be used with a quantitative field only, not ${a.type} field.`}:bh;case Oe:case Cf:case Df:case Ef:case Ne:case Me:case Le:case xd:case Zd:return c==="nominal"&&!a.sort?{compatible:!1,warning:`Channel ${b} should not be used with an unsorted discrete field.`}:bh;case Ff:return fa(["ordinal","nominal"],a.type)?bh:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case xc:return fa(["ordinal","nominal","geojson"],a.type)?bh:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case $k:return a.type==="nominal"&&!("sort"in a)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:bh}}function Tp(a){const{formatType:b}=Qp(a);return b==="time"||!b&&_fa(a)}function _fa(a){return a&&(a.type==="temporal"||R(a)&&!!a.timeUnit)}function by(a,{timeUnit:b,type:c,wrapTime:d,undefinedIfExprNotRequired:e}){var f;const g=b&&((f=ec(b))===null||f===void 0?void 0:f.unit);let h=g||c==="temporal",i;return ga(a)?i=a.signal:Ci(a)?(h=!0,i=cl(a)):(V(a)||Fa(a))&&(h&&(i=`datetime(${JSON.stringify(a)})`,Zea(g)&&((Fa(a)&&a<1e4||V(a)&&isNaN(Date.parse(a)))&&(i=cl({[g]:a}))))),i?d&&h?`time(${i})`:i:e?void 0:JSON.stringify(a)}function ZM(a,b){const{type:c}=a;return b.map(d=>{const e=by(d,{timeUnit:R(a)?a.timeUnit:void 0,type:c,undefinedIfExprNotRequired:!0});return e!==void 0?{signal:e}:d})}function gl(a,b){return Ia(a.bin)?If(b)&&fa(["ordinal","nominal"],a.type):(console.warn("Only call this method for binned field defs."),!1)}function _M(a){const{anchor:b,frame:c,offset:d,orient:e,color:f,subtitleColor:g,subtitleFont:h,subtitleFontSize:i,subtitleFontStyle:j,subtitleFontWeight:k,subtitleLineHeight:l,subtitlePadding:m}=a,n=$(a,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),o=Object.assign(Object.assign({},n),f?{fill:f}:{}),p=Object.assign(Object.assign(Object.assign(Object.assign({},b?{anchor:b}:{}),c?{frame:c}:{}),d?{offset:d}:{}),e?{orient:e}:{}),q=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},g?{subtitleColor:g}:{}),h?{subtitleFont:h}:{}),i?{subtitleFontSize:i}:{}),j?{subtitleFontStyle:j}:{}),k?{subtitleFontWeight:k}:{}),l?{subtitleLineHeight:l}:{}),m?{subtitlePadding:m}:{}),r=Wk(o,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:o,subtitleMarkConfig:r,nonMark:p,subtitle:q}}function Nf(a){return V(a)||J(a)&&V(a[0])}function ab(a){return ga(a)?a:a!==void 0?{value:a}:void 0}function $M(a){return ga(a)?a.signal:P(a.value)}function hl(a){return ga(a)?a.signal:a==null?null:P(a)}function $fa(a,b,c){for(const d of c){const e=ch(d,b.markDef,b.config);e!==void 0&&(a[d]=ab(e))}return a}function aN(a){var b;return[].concat(a.type,(b=a.style)!==null&&b!==void 0?b:[])}function Aa(a,b,c,d={}){const{vgChannel:e,ignoreVgConfig:f}=d;if(e&&b[e]!==void 0)return b[e];{if(b[a]!==void 0)return b[a];if(f&&(!e||e===a))return}return ch(a,b,c,d)}function ch(a,b,c,{vgChannel:d}={}){return db(d?Up(a,b,c.style):void 0,Up(a,b,c.style),d?c[b.type][d]:void 0,c[b.type][a],d?c.mark[d]:c.mark[a])}function Up(a,b,c){return bN(a,aN(b),c)}function bN(a,b,c){b=T(b);let d;for(const e of b){const f=c[e];f&&f[a]!==void 0&&(d=f[a])}return d}function cN(a,b){return T(a).reduce((c,d)=>{var e;return c.field.push(Q(d,b)),c.order.push((e=d.sort)!==null&&e!==void 0?e:"ascending"),c},{field:[],order:[]})}function dN(a,b){const c=[...a];return b.forEach(d=>{for(const e of c)if(Vk(e,d))return;c.push(d)}),c}function eN(a,b){return Vk(a,b)||!b?a:a?[...T(a),...T(b)].join(", "):b}function fN(a,b){const c=a.value,d=b.value;if(c==null||d===null)return{explicit:a.explicit,value:null};{if((Nf(c)||ga(c))&&(Nf(d)||ga(d)))return{explicit:a.explicit,value:eN(c,d)};{if(Nf(c)||ga(c))return{explicit:a.explicit,value:c};{if(Nf(d)||ga(d))return{explicit:a.explicit,value:d};if(!Nf(c)&&!ga(c)&&!Nf(d)&&!ga(d))return{explicit:a.explicit,value:dN(c,d)}}}}throw new Error("It should never reach here")}function dh(a,b){const c=a&&a[b];return c?J(c)?Xk(c,d=>!!d.field):R(c)||Pp(c):!1}function cy(a){return Xk(OL,b=>{if(dh(a,b)){const c=a[b];if(J(c))return Xk(c,d=>!!d.aggregate);{const d=je(c);return d&&!!d.aggregate}}return!1})}function dy(a,b){const c=[],d=[],e=[],f=[],g={};return ey(a,(h,i)=>{if(R(h)){const{field:j,aggregate:k,bin:l,timeUnit:m}=h,n=$(h,["field","aggregate","bin","timeUnit"]);if(k||m||l){const o=$x(h),p=o&&o.title;let q=Q(h,{forAs:!0});const r=Object.assign(Object.assign(Object.assign({},p?[]:{title:ah(h,b,{allowDisabling:!0})}),n),{field:q});if(k){let s;Vg(k)?(s="argmax",q=Q({op:"argmax",field:k.argmax},{forAs:!0}),r.field=`${q}.${j}`):Bf(k)?(s="argmin",q=Q({op:"argmin",field:k.argmin},{forAs:!0}),r.field=`${q}.${j}`):k!=="boxplot"&&k!=="errorbar"&&k!=="errorband"&&(s=k);if(s){const t={op:s,as:q};j&&(t.field=j),f.push(t)}}else{c.push(q);if(Lc(h)&&Ia(l)){d.push({bin:l,field:j,as:q}),c.push(Q(h,{binSuffix:"end"})),gl(h,i)&&c.push(Q(h,{binSuffix:"range"}));if(fe(i)){const s={field:q+"_end"};g[i+"2"]=s}r.bin="binned",QL(i)||(r.type=Zg)}else if(m){e.push({timeUnit:m,field:j,as:q});const s=Lc(h)&&h.type!==Ei&&"time";s&&(i===_k||i===Xg?r.formatType=s:Pda(i)?r.legend=Object.assign({formatType:s},r.legend):fe(i)&&(r.axis=Object.assign({formatType:s},r.axis)))}}g[i]=r}else c.push(j),g[i]=a[i]}else g[i]=a[i]}),{bins:d,timeUnits:e,aggregate:f,groupby:c,encoding:g}}function aga(a,b,c){const d=Rda(b,c);if(d){if(d==="binned"){const e=a[b===xd?Ta:jb];return R(e)&&R(a[b])&&dc(e.bin)?!0:!1}}else return!1;return!0}function bga(a,b,c){const d=b.type;return O(a).reduce((e,f)=>{if(!PL(f))return L(mea(f)),e;const g=a[f];f==="angle"&&d==="arc"&&!a.theta&&(L(gea),f=yd);if(!aga(a,f,d))return L(Ip(f,d)),e;if(f===Ne&&d==="line"){const h=je(a[f]);if(h===null||h===void 0?void 0:h.aggregate)return L(lea),e}if(f===wc&&(b.filled?"fill"in a:"stroke"in a))return L(dM("encoding",{fill:"fill"in a,stroke:"stroke"in a})),e;if(f===al||f===$k&&!J(g)&&!Pe(g)||f===Xg&&J(g))g&&(e[f]=T(g).reduce((h,i)=>(R(i)?h.push(YM(i,f)):L(Cx(i,f)),h),[]));else{if(f===Xg&&g===null)e[f]=null;else if(!R(g)&&!Mf(g)&&!Pe(g)&&!Wx(g)&&!ga(g))return L(Cx(g,f)),e;e[f]=ay(g,f,c)}return e},{})}function cga(a){const b=[];for(const c of O(a))if(dh(a,c)){const d=a[c],e=T(d);for(const f of e)R(f)?b.push(f):Pp(f)&&b.push(f.condition)}return b}function ey(a,b,c){if(!a)return;for(const d of O(a)){const e=a[d];if(J(e))for(const f of e)b.call(c,f,d);else b.call(c,e,d)}}function gN(a,b,c,d){return a?O(a).reduce((e,f)=>{const g=a[f];return J(g)?g.reduce((h,i)=>b.call(d,h,i,f),e):b.call(d,e,g,f)},c):c}function hN(a,b){return O(b).reduce((c,d)=>{switch(d){case Ta:case jb:case Bp:case Dp:case Cp:case xd:case Zd:case yd:case Me:case _d:case Le:case $d:case ae:case zd:case ad:case _k:case xc:case Wg:case Xg:return c;case $k:if(a==="line"||a==="trail")return c;case al:case Ap:{const e=b[d];if(J(e)||R(e))for(const f of T(e))f.aggregate||c.push(Q(f,{}));return c}case Ne:if(a==="trail")return c;case wc:case be:case ce:case Oe:case Cf:case Df:case Ff:case Ef:{const e=je(b[d]);return e&&!e.aggregate&&c.push(Q(e,{})),c}}},[])}function dga(a){const{tooltip:b}=a,c=$(a,["tooltip"]);if(!b)return{filteredEncoding:a};let d,e;if(J(b)){for(const f of b)f.aggregate?(d||(d=[]),d.push(f)):(e||(e=[]),e.push(f));d&&(c.tooltip=d)}else b.aggregate?c.tooltip=b:e=b;return J(e)&&e.length===1&&(e=e[0]),{customTooltipWithoutAggregatedField:e,filteredEncoding:c}}function fy(a,b,c,d=!0){if("tooltip"in c)return{tooltip:c.tooltip};const e=a.map(({fieldPrefix:f,titlePrefix:g})=>{const h=d?` of ${b.field}`:"";return{field:f+b.field,type:b.type,title:ga(g)?{signal:g+`"${escape(h)}"`}:g+h}});return{tooltip:[...e,...cga(c)]}}function iN(a){const{axis:b,title:c,field:d}=a;return b&&b.title!==void 0?void 0:db(c,d)}function gy(a,b,c,d,e){const{scale:f,axis:g}=c;return({partName:h,mark:i,positionPrefix:j,endPositionPrefix:k=void 0,aria:l,extraEncoding:m={}})=>{const n=iN(c);return jN(a,h,e,l,{mark:i,encoding:Object.assign(Object.assign(Object.assign({[b]:Object.assign(Object.assign(Object.assign({field:j+"_"+c.field,type:c.type},n!==void 0?{title:n}:{}),f!==void 0?{scale:f}:{}),g!==void 0?{axis:g}:{})},V(k)?{[b+"2"]:{field:k+"_"+c.field}}:{}),d),m)})}}function jN(a,b,c,d,e){const{clip:f,color:g,opacity:h}=a,i=a.type;return a[b]||a[b]===void 0&&c[b]?[Object.assign(Object.assign({},e),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c[b]),f?{clip:f}:{}),g?{color:g}:{}),h?{opacity:h}:{}),Yd(e.mark)?e.mark:{type:e.mark}),{style:`${i}-${b}`}),bg(a[b])?{}:a[b]),d===!1?{aria:d}:{})})]:[]}function kN(a,b,c){const{encoding:d}=a,e=b==="vertical"?"y":"x",f=d[e],g=d[e+"2"],h=d[e+"Error"],i=d[e+"Error2"];return{continuousAxisChannelDef:Vp(f,c),continuousAxisChannelDef2:Vp(g,c),continuousAxisChannelDefError:Vp(h,c),continuousAxisChannelDefError2:Vp(i,c),continuousAxis:e}}function Vp(a,b){if(a&&a.aggregate){const{aggregate:c}=a,d=$(a,["aggregate"]);return c!==b&&L(Mea(c,b)),d}else return a}function lN(a,b){const{mark:c,encoding:d}=a,{x:e,y:f}=d;if(ie(e)){if(ie(f)){const g=R(e)&&e.aggregate,h=R(f)&&f.aggregate;if(!g&&h===b)return"vertical";{if(!h&&g===b)return"horizontal";{if(g===b&&h===b)throw new Error("Both x and y cannot have aggregate");return Yd(c)&&c.orient?c.orient:"vertical"}}}return"horizontal"}else{if(ie(f))return"vertical";throw new Error("Need a valid continuous axis for "+b+"s")}}const Wp="boxplot",ega=["box","median","outliers","rule","ticks"],fga=new yp(Wp,nN);function mN(a){return Fa(a)?"tukey":a}function nN(a,{config:b}){var c,d;const{mark:e,encoding:f,selection:g,projection:h}=a,i=$(a,["mark","encoding","selection","projection"]),j=Yd(e)?e:{type:e};g&&L(_L("boxplot"));const k=(c=j.extent)!==null&&c!==void 0?c:b.boxplot.extent,l=Aa("size",j,b),m=mN(k),{transform:n,continuousAxisChannelDef:o,continuousAxis:p,groupby:q,aggregate:r,encodingWithoutContinuousAxis:s,ticksOrient:t,boxOrient:w,customTooltipWithoutAggregatedField:v}=gga(a,k,b),{color:x,size:u}=s,z=$(s,["color","size"]),y=Y=>gy(j,p,o,Y,b.boxplot),B=y(z),A=y(s),C=y(Object.assign(Object.assign({},z),u?{size:u}:{})),F=fy([{fieldPrefix:m==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:m==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],o,s),K={type:"tick",color:"black",opacity:1,orient:t,invalid:null},D=m==="min-max"?F:fy([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],o,s),I=[...B({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:D}),...B({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:D}),...B({partName:"ticks",mark:K,positionPrefix:"lower_whisker",aria:!1,extraEncoding:D}),...B({partName:"ticks",mark:K,positionPrefix:"upper_whisker",aria:!1,extraEncoding:D})],S=[...m!=="tukey"?I:[],...A({partName:"box",mark:Object.assign(Object.assign({type:"bar"},l?{size:l}:{}),{orient:w,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:F}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Z(b.boxplot.median)&&b.boxplot.median.color?{color:b.boxplot.median.color}:{}),l?{size:l}:{}),{orient:t,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:F})];let X;if(m!=="min-max"){const Y=`datum["lower_box_${o.field}"]`,wa=`datum["upper_box_${o.field}"]`,Qa=`(${wa} - ${Y})`,tb=`${Y} - ${k} * ${Qa}`,ub=`${wa} + ${k} * ${Qa}`,bb=`datum["${o.field}"]`,Rb={joinaggregate:oN(o.field),groupby:q};let Dd;m==="tukey"&&(Dd={transform:[{filter:`(${tb} <= ${bb}) && (${bb} <= ${ub})`},{aggregate:[{op:"min",field:o.field,as:"lower_whisker_"+o.field},{op:"max",field:o.field,as:"upper_whisker_"+o.field},{op:"min",field:"lower_box_"+o.field,as:"lower_box_"+o.field},{op:"max",field:"upper_box_"+o.field,as:"upper_box_"+o.field},...r],groupby:q}],layer:I});const rh=$(z,["tooltip"]),{scale:Vf,axis:U}=o,ja=iN(o),qa=jN(j,"outliers",b.boxplot,!0,{transform:[{filter:`(${bb} < ${tb}) || (${bb} > ${ub})`}],mark:"point",encoding:Object.assign(Object.assign({[p]:Object.assign(Object.assign(Object.assign({field:o.field,type:o.type},ja!==void 0?{title:ja}:{}),Vf!==void 0?{scale:Vf}:{}),U!==void 0?{axis:U}:{})},rh),v?{tooltip:v}:{})})[0];qa&&Dd?X={transform:[Rb],layer:[qa,Dd]}:qa?(X=qa,X.transform.unshift(Rb)):Dd&&(X=Dd,X.transform.unshift(Rb))}return X?Object.assign(Object.assign({},i),{layer:[X,{transform:n,layer:S}]}):Object.assign(Object.assign({},i),{transform:((d=i.transform)!==null&&d!==void 0?d:[]).concat(n),layer:S})}function oN(a){return[{op:"q1",field:a,as:"lower_box_"+a},{op:"q3",field:a,as:"upper_box_"+a}]}function gga(a,b,c){const d=lN(a,Wp),{continuousAxisChannelDef:e,continuousAxis:f}=kN(a,d,Wp),g=e.field,h=mN(b),i=[...oN(g),{op:"median",field:g,as:"mid_box_"+g},{op:"min",field:g,as:(h==="min-max"?"lower_whisker_":"min_")+g},{op:"max",field:g,as:(h==="min-max"?"upper_whisker_":"max_")+g}],j=h==="min-max"||h==="tukey"?[]:[{calculate:`datum["upper_box_${g}"] - datum["lower_box_${g}"]`,as:"iqr_"+g},{calculate:`min(datum["upper_box_${g}"] + datum["iqr_${g}"] * ${b}, datum["max_${g}"])`,as:"upper_whisker_"+g},{calculate:`max(datum["lower_box_${g}"] - datum["iqr_${g}"] * ${b}, datum["min_${g}"])`,as:"lower_whisker_"+g}],k=a.encoding,l=f,m=k[l],n=$(k,[typeof l==="symbol"?l:l+""]),{customTooltipWithoutAggregatedField:o,filteredEncoding:p}=dga(n),{bins:q,timeUnits:r,aggregate:s,groupby:t,encoding:w}=dy(p,c),v=d==="vertical"?"horizontal":"vertical",x=d,u=[...q,...r,{aggregate:[...s,...i],groupby:t},...j];return{transform:u,groupby:t,aggregate:s,continuousAxisChannelDef:e,continuousAxis:f,encodingWithoutContinuousAxis:w,ticksOrient:v,boxOrient:x,customTooltipWithoutAggregatedField:o}}const hy="errorbar",hga=["ticks","rule"],iga=new yp(hy,pN);function pN(a,{config:b}){const{transform:c,continuousAxisChannelDef:d,continuousAxis:e,encodingWithoutContinuousAxis:f,ticksOrient:g,markDef:h,outerSpec:i,tooltipEncoding:j}=qN(a,hy,b),k=gy(h,e,d,f,b.errorbar),l={type:"tick",orient:g},m=[...k({partName:"ticks",mark:l,positionPrefix:"lower",aria:!1,extraEncoding:j}),...k({partName:"ticks",mark:l,positionPrefix:"upper",aria:!1,extraEncoding:j}),...k({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:j})];return Object.assign(Object.assign(Object.assign({},i),{transform:c}),m.length>1?{layer:m}:Object.assign({},m[0]))}function jga(a,b){const{encoding:c}=a;if(kga(c))return{orient:lN(a,b),inputType:"raw"};const d=lga(c),e=mga(c),f=c.x,g=c.y;if(d){if(e)throw new Error(`${b} cannot be both type aggregated-upper-lower and aggregated-error`);const h=c.x2,i=c.y2;if(ha(h)&&ha(i))throw new Error(`${b} cannot have both x2 and y2`);if(ha(h)){if(ie(f))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${b}`)}else if(ha(i)){if(ie(g))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${b}`)}throw new Error("No ranged axis")}else{const h=c.xError,i=c.xError2,j=c.yError,k=c.yError2;if(ha(i)&&!ha(h))throw new Error(`${b} cannot have xError2 without xError`);if(ha(k)&&!ha(j))throw new Error(`${b} cannot have yError2 without yError`);if(ha(h)&&ha(j))throw new Error(`${b} cannot have both xError and yError with both are quantiative`);if(ha(h)){if(ie(f))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(ha(j)){if(ie(g))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function kga(a){return(ha(a.x)||ha(a.y))&&!ha(a.x2)&&!ha(a.y2)&&!ha(a.xError)&&!ha(a.xError2)&&!ha(a.yError)&&!ha(a.yError2)}function lga(a){return ha(a.x2)||ha(a.y2)}function mga(a){return ha(a.xError)||ha(a.xError2)||ha(a.yError)||ha(a.yError2)}function qN(a,b,c){var d;const{mark:e,encoding:f,selection:g,projection:h}=a,i=$(a,["mark","encoding","selection","projection"]),j=Yd(e)?e:{type:e};g&&L(_L(b));const{orient:k,inputType:l}=jga(a,b),{continuousAxisChannelDef:m,continuousAxisChannelDef2:n,continuousAxisChannelDefError:o,continuousAxisChannelDefError2:p,continuousAxis:q}=kN(a,k,b),{errorBarSpecificAggregate:r,postAggregateCalculates:s,tooltipSummary:t,tooltipTitleWithFieldName:w}=nga(j,m,n,o,p,l,b,c),v=f,x=q,u=v[x],z=q==="x"?"x2":"y2",y=v[z],B=q==="x"?"xError":"yError",A=v[B],C=q==="x"?"xError2":"yError2",F=v[C],K=$(v,[typeof x==="symbol"?x:x+"",typeof z==="symbol"?z:z+"",typeof B==="symbol"?B:B+"",typeof C==="symbol"?C:C+""]),{bins:D,timeUnits:I,aggregate:S,groupby:X,encoding:Y}=dy(K,c),wa=[...S,...r],Qa=l!=="raw"?[]:X,tb=fy(t,m,Y,w);return{transform:[...(d=i.transform)!==null&&d!==void 0?d:[],...D,...I,...wa.length===0?[]:[{aggregate:wa,groupby:Qa}],...s],groupby:Qa,continuousAxisChannelDef:m,continuousAxis:q,encodingWithoutContinuousAxis:Y,ticksOrient:k==="vertical"?"horizontal":"vertical",markDef:j,outerSpec:i,tooltipEncoding:tb}}function nga(a,b,c,d,e,f,g,h){let i=[],j=[];const k=b.field;let l,m=!1;if(f==="raw"){const n=a.center?a.center:a.extent?a.extent==="iqr"?"median":"mean":h.errorbar.center,o=a.extent?a.extent:n==="mean"?"stderr":"iqr";n==="median"!==(o==="iqr")&&L(Lea(n,o,g));if(o==="stderr"||o==="stdev")i=[{op:o,field:k,as:"extent_"+k},{op:n,field:k,as:"center_"+k}],j=[{calculate:`datum["center_${k}"] + datum["extent_${k}"]`,as:"upper_"+k},{calculate:`datum["center_${k}"] - datum["extent_${k}"]`,as:"lower_"+k}],l=[{fieldPrefix:"center_",titlePrefix:rp(n)},{fieldPrefix:"upper_",titlePrefix:rN(n,o,"+")},{fieldPrefix:"lower_",titlePrefix:rN(n,o,"-")}],m=!0;else{a.center&&a.extent&&L(Nea(a.extent,g));let p,q,r;o==="ci"?(p="mean",q="ci0",r="ci1"):(p="median",q="q1",r="q3"),i=[{op:q,field:k,as:"lower_"+k},{op:r,field:k,as:"upper_"+k},{op:p,field:k,as:"center_"+k}],l=[{fieldPrefix:"upper_",titlePrefix:ah({field:k,aggregate:r,type:"quantitative"},h,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:ah({field:k,aggregate:q,type:"quantitative"},h,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:ah({field:k,aggregate:p,type:"quantitative"},h,{allowDisabling:!1})}]}}else{(a.center||a.extent)&&L(Kea(a.center,a.extent)),f==="aggregated-upper-lower"?(l=[],j=[{calculate:`datum["${c.field}"]`,as:"upper_"+k},{calculate:`datum["${k}"]`,as:"lower_"+k}]):f==="aggregated-error"&&(l=[{fieldPrefix:"",titlePrefix:k}],j=[{calculate:`datum["${k}"] + datum["${d.field}"]`,as:"upper_"+k}],e?j.push({calculate:`datum["${k}"] + datum["${e.field}"]`,as:"lower_"+k}):j.push({calculate:`datum["${k}"] - datum["${d.field}"]`,as:"lower_"+k}));for(const n of j)l.push({fieldPrefix:n.as.substring(0,6),titlePrefix:zi(zi(n.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:j,errorBarSpecificAggregate:i,tooltipSummary:l,tooltipTitleWithFieldName:m}}function rN(a,b,c){return rp(a)+" "+c+" "+b}const iy="errorband",oga=["band","borders"],pga=new yp(iy,sN);function sN(a,{config:b}){const{transform:c,continuousAxisChannelDef:d,continuousAxis:e,encodingWithoutContinuousAxis:f,markDef:g,outerSpec:h,tooltipEncoding:i}=qN(a,iy,b),j=g,k=gy(j,e,d,f,b.errorband),l=a.encoding.x!==void 0&&a.encoding.y!==void 0;let m={type:l?"area":"rect"},n={type:l?"line":"rule"};const o=Object.assign(Object.assign({},j.interpolate?{interpolate:j.interpolate}:{}),j.tension&&j.interpolate?{tension:j.tension}:{});return l?(m=Object.assign(Object.assign(Object.assign({},m),o),{ariaRoleDescription:"errorband"}),n=Object.assign(Object.assign({},n),o)):j.interpolate?L(hM("interpolate")):j.tension&&L(hM("tension")),Object.assign(Object.assign({},h),{transform:c,layer:[...k({partName:"band",mark:m,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:i}),...k({partName:"borders",mark:n,positionPrefix:"lower",aria:!1,extraEncoding:i}),...k({partName:"borders",mark:n,positionPrefix:"upper",aria:!1,extraEncoding:i})]})}const tN={};function jy(a,b,c){const d=new yp(a,b);tN[a]={normalizer:d,parts:c}}function qga(){return O(tN)}jy(Wp,nN,ega),jy(hy,pN,hga),jy(iy,sN,oga);const rga=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],uN=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],sga={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},tga={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},uga={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Gi="_vgsid_",vga={single:{on:"click",fields:[Gi],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Gi],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function ky(a){return!!a&&(a==="legend"||!!a.legend)}function ly(a){return ky(a)&&Z(a)}function wga(a){return Xp(a)||ny(a)||my(a)}function my(a){return"concat"in a}function Xp(a){return"vconcat"in a}function ny(a){return"hconcat"in a}function ke(a){return Z(a)&&a.step!==void 0}function vN(a){return a.view||a.width||a.height}const wN=20,xga={align:1,bounds:1,center:1,columns:1,spacing:1},yga=O(xga);function zga(a,b,c){var d,e;const f=c[b],g={},{spacing:h,columns:i}=f;h!==void 0&&(g.spacing=h),i!==void 0&&((Op(a)&&!el(a.facet)||my(a))&&(g.columns=i)),Xp(a)&&(g.columns=1);for(const j of yga)if(a[j]!==void 0)if(j==="spacing"){const k=a[j];g[j]=Fa(k)?k:{row:(d=k.row)!==null&&d!==void 0?d:h,column:(e=k.column)!==null&&e!==void 0?e:h}}else g[j]=a[j];return g}function oy(a,b){var c;return(c=a[b])!==null&&c!==void 0?c:a[b==="width"?"continuousWidth":"continuousHeight"]}function Yp(a,b){const c=il(a,b);return ke(c)?c.step:py}function il(a,b){var c;const d=(c=a[b])!==null&&c!==void 0?c:a[b==="width"?"discreteWidth":"discreteHeight"];return db(d,{step:a.step})}const py=20,Aga={continuousWidth:200,continuousHeight:200,step:py},Bga={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Aga,mark:qda,arc:{},area:{},bar:sda,circle:{},geoshape:{},image:{},line:{},point:{},rect:tda,rule:{color:"black"},square:{},text:{color:"black"},tick:uda,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Bfa,projection:{},legend:tga,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:vga,style:{},title:{},facet:{spacing:wN},concat:{spacing:wN}},Qe=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],xN={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},yN={blue:Qe[0],orange:Qe[1],red:Qe[2],teal:Qe[3],green:Qe[4],yellow:Qe[5],purple:Qe[6],pink:Qe[7],brown:Qe[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Cga(a={}){return{signals:[{name:"color",value:Z(a)?Object.assign(Object.assign({},yN),a):yN}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Dga(a){return{signals:[{name:"fontSize",value:Z(a)?Object.assign(Object.assign({},xN),a):xN}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Ega(a){return{text:{font:a},style:{"guide-label":{font:a},"guide-title":{font:a},"group-title":{font:a},"group-subtitle":{font:a}}}}function zN(a={}){const{color:b,font:c,fontSize:d}=a,e=$(a,["color","font","fontSize"]);return Yi({},Bga,c?Ega(c):{},b?Cga(b):{},d?Dga(d):{},e||{})}const Fga=["view",...GL],Gga=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Hga=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},pda);function Iga(a){a=oa(a);for(const b of Gga)delete a[b];if(a.axis)for(const b in a.axis)sx(a.axis[b])&&delete a.axis[b];if(a.legend)for(const b of rga)delete a.legend[b];if(a.mark){for(const b of HL)delete a.mark[b];a.mark.tooltip&&Z(a.mark.tooltip)&&delete a.mark.tooltip}for(const b of Fga){for(const d of HL)delete a[b][d];const c=Hga[b];if(c)for(const d of c)delete a[b][d];Kga(a,b)}for(const b of qga())delete a[b];Jga(a);for(const b in a)Z(a[b])&&Ha(a[b])&&delete a[b];return Ha(a)?void 0:a}function Jga(a){const{titleMarkConfig:b,subtitleMarkConfig:c,subtitle:d}=_M(a.title);Ha(b)||(a.style["group-title"]=Object.assign(Object.assign({},a.style["group-title"]),b)),Ha(c)||(a.style["group-subtitle"]=Object.assign(Object.assign({},a.style["group-subtitle"]),c)),Ha(d)?delete a.title:a.title=d}function Kga(a,b,c,d){const e=d?a[b][d]:a[b];b==="view"&&(c="cell");const f=Object.assign(Object.assign({},e),a.style[c!==null&&c!==void 0?c:b]);Ha(f)||(a.style[c!==null&&c!==void 0?c:b]=f),d||delete a[b]}function Zp(a){return"layer"in a}function Lga(a){return"repeat"in a}function Mga(a){return!J(a.repeat)&&a.repeat.layer}class AN{map(a,b){return Op(a)?this.mapFacet(a,b):Lga(a)?this.mapRepeat(a,b):ny(a)?this.mapHConcat(a,b):Xp(a)?this.mapVConcat(a,b):my(a)?this.mapConcat(a,b):this.mapLayerOrUnit(a,b)}mapLayerOrUnit(a,b){if(Zp(a))return this.mapLayer(a,b);if(Ie(a))return this.mapUnit(a,b);throw new Error(Bx(a))}mapLayer(a,b){return Object.assign(Object.assign({},a),{layer:a.layer.map(c=>this.mapLayerOrUnit(c,b))})}mapHConcat(a,b){return Object.assign(Object.assign({},a),{hconcat:a.hconcat.map(c=>this.map(c,b))})}mapVConcat(a,b){return Object.assign(Object.assign({},a),{vconcat:a.vconcat.map(c=>this.map(c,b))})}mapConcat(a,b){const{concat:c}=a,d=$(a,["concat"]);return Object.assign(Object.assign({},d),{concat:c.map(e=>this.map(e,b))})}mapFacet(a,b){return Object.assign(Object.assign({},a),{spec:this.map(a.spec,b)})}mapRepeat(a,b){return Object.assign(Object.assign({},a),{spec:this.map(a.spec,b)})}}const Nga={zero:1,center:1,normalize:1};function Oga(a){return a in Nga}const Pga=new Set([CL,up,tp,xp,wp,ux,vx,vp,DL,tx]),Qga=new Set([up,tp,CL]);function BN(a,b){var c,d;const e=b==="x"?"y":"radius",f=a[b],g=a[e];if(R(f)&&R(g))if(Lf(f)==="quantitative"&&Lf(g)==="quantitative"){if(f.stack)return b;if(g.stack)return e;const h=R(f)&&!!f.aggregate,i=R(g)&&!!g.aggregate;if(h!==i)return h?b:e;{const j=(c=f.scale)===null||c===void 0?void 0:c.type,k=(d=g.scale)===null||d===void 0?void 0:d.type;if(j&&j!=="linear")return e;if(k&&k!=="linear")return b}}else{if(Lf(f)==="quantitative")return b;if(Lf(g)==="quantitative")return e}else{if(Lf(f)==="quantitative")return b;if(Lf(g)==="quantitative")return e}return}function Rga(a){switch(a){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function CN(a,b,c={}){const d=Yd(a)?a.type:a;if(!Pga.has(d))return null;const e=BN(b,"x")||BN(b,"theta");if(!e)return null;const f=b[e],g=R(f)?Q(f,{}):void 0;let h=Rga(e),i=b[h],j=R(i)?Q(i,{}):void 0;j===g&&(j=void 0,i=void 0,h=void 0);const k=Mda.reduce((m,n)=>{if(n!=="tooltip"&&dh(b,n)){const o=b[n];for(const p of T(o)){const q=je(p);if(q.aggregate)continue;const r=Q(q,{});(!r||r!==j)&&m.push({channel:n,fieldDef:q})}}return m},[]);let l;f.stack!==void 0?bg(f.stack)?l=f.stack?"zero":null:l=f.stack:k.length>0&&Qga.has(d)&&(l="zero");if(!l||!Oga(l))return null;if(cy(b)&&k.length===0)return null;if(f.scale&&f.scale.type&&f.scale.type!==eb.LINEAR){if(c.disallowNonLinearStack)return null;L(Hea(f.scale.type))}return ha(b[de(e)])?(f.stack!==void 0&&L(Gea(e)),null):(R(f)&&f.aggregate&&!fa(Ada,f.aggregate)&&L(Iea(f.aggregate)),{groupbyChannel:i?h:void 0,groupbyField:j,fieldChannel:e,impute:f.impute===null?!1:Ug(d),stackBy:k,offset:l})}function Sga(a){const b=$(a,["point","line"]);return O(b).length>1?b:b.type}function Tga(a){for(const b of["line","area","rule","trail"])a[b]&&(a=Object.assign(Object.assign({},a),{[b]:He(a[b],["point","line"])}));return a}function qy(a,b={},c){return a.point==="transparent"?{opacity:0}:a.point?Z(a.point)?a.point:{}:a.point!==void 0?null:b.point||c.shape?Z(b.point)?b.point:{}:void 0}function DN(a,b={}){return a.line?a.line===!0?{}:a.line:a.line!==void 0?null:b.line?b.line===!0?{}:b.line:void 0}class Uga{constructor(){this.name="path-overlay"}hasMatchingType(a,b){if(Ie(a)){const{mark:c,encoding:d}=a,e=Yd(c)?c:{type:c};switch(e.type){case"line":case"rule":case"trail":return!!qy(e,b[e.type],d);case"area":return!!qy(e,b[e.type],d)||!!DN(e,b[e.type])}}return!1}run(a,b,c){const{config:d}=b,{selection:e,projection:f,encoding:g,mark:h}=a,i=$(a,["selection","projection","encoding","mark"]),j=Yd(h)?h:{type:h},k=qy(j,d[j.type],g),l=j.type==="area"&&DN(j,d[j.type]),m=[Object.assign(Object.assign({},e?{selection:e}:{}),{mark:Sga(Object.assign(Object.assign({},j.type==="area"&&j.opacity===void 0&&j.fillOpacity===void 0?{opacity:.7}:{}),j)),encoding:He(g,["shape"])})],n=CN(j,g);let o=g;if(n){const{fieldChannel:p,offset:q}=n;o=Object.assign(Object.assign({},g),{[p]:Object.assign(Object.assign({},g[p]),q?{stack:q}:{})})}return l&&m.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"line"},Wk(j,["clip","interpolate","tension","tooltip"])),l),encoding:o})),k&&m.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Wk(j,["clip","tooltip"])),k),encoding:o})),c(Object.assign(Object.assign({},i),{layer:m}),Object.assign(Object.assign({},b),{config:Tga(d)}))}}class Vga{constructor(){this.name="RangeStep"}hasMatchingType(a){var b;if(Ie(a)&&a.encoding)for(const c of cd){const d=a.encoding[c];if(d&&ha(d)){if((b=d===null||d===void 0?void 0:d.scale)===null||b===void 0?void 0:b.rangeStep)return!0}}return!1}run(a){var b;const c={};let d=Object.assign({},a.encoding);for(const e of cd){const f=ee(e),g=d[e];if(g&&ha(g)){if((b=g===null||g===void 0?void 0:g.scale)===null||b===void 0?void 0:b.rangeStep){const{scale:h}=g,i=$(g,["scale"]),j=h,k=$(j,["rangeStep"]);c[f]={step:h.rangeStep},L(rea),d=Object.assign(Object.assign({},d),{[e]:Object.assign(Object.assign({},i),Ha(k)?{}:{scale:k})})}}}return Object.assign(Object.assign(Object.assign({},c),a),{encoding:d})}}function Wga(a,b){return b?el(a)?HN(a,b):EN(a,b):a}function ry(a,b){return b?HN(a,b):a}function sy(a,b,c){const d=b[a];if(Qfa(d)){if(d.repeat in c)return Object.assign(Object.assign({},b),{[a]:c[d.repeat]});{L($da(d.repeat));return}}return b}function EN(a,b){a=sy("field",a,b);if(a===void 0)return;if(a===null)return null;if(PM(a)&&he(a.sort)){const c=sy("field",a.sort,b);a=Object.assign(Object.assign({},a),c?{sort:c}:{})}return a}function FN(a,b){if(R(a))return EN(a,b);{const c=sy("datum",a,b);return c!==a&&!c.type&&(c.type="nominal"),c}}function GN(a,b){if(ha(a)){const c=FN(a,b);if(c)return c;if(Wx(a))return{condition:a.condition}}else{if(Xx(a)){const c=FN(a.condition,b);if(c)return Object.assign(Object.assign({},a),{condition:c});{const d=$(a,["condition"]);return d}}return a}return}function HN(a,b){const c={};for(const d in a)if(_(a,d)){const e=a[d];if(J(e))c[d]=e.map(f=>GN(f,b)).filter(f=>f);else{const f=GN(e,b);f!==void 0&&(c[d]=f)}}return c}class Xga{constructor(){this.name="RuleForRangedLine"}hasMatchingType(a){if(Ie(a)){const{encoding:b,mark:c}=a;if(c==="line")for(const d of Kda){const e=Yg(d),f=b[e];if(b[d]){if(R(f)&&!dc(f.bin)||Mf(f))return!0}}}return!1}run(a,b,c){const{encoding:d}=a;return L(pea(!!d.x2,!!d.y2)),c(Object.assign(Object.assign({},a),{mark:"rule"}),b)}}class Yga extends AN{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[fga,iga,pga,new Uga(),new Xga(),new Vga()]}map(a,b){if(Ie(a)){const c=dh(a.encoding,Je),d=dh(a.encoding,Ke),e=dh(a.encoding,zp);if(c||d||e)return this.mapFacetedUnit(a,b)}return super.map(a,b)}mapUnit(a,b){const{parentEncoding:c,parentProjection:d}=b,e=Object.assign(Object.assign({},a),{encoding:ry(a.encoding,b.repeater)});if(c||d)return this.mapUnitWithParentEncodingOrProjection(e,b);const f=this.mapLayerOrUnit.bind(this);for(const g of this.nonFacetUnitNormalizers)if(g.hasMatchingType(e,b.config))return g.run(e,b,f);return e}mapRepeat(a,b){return Mga(a)?this.mapLayerRepeat(a,b):this.mapNonLayerRepeat(a,b)}mapLayerRepeat(a,b){const{repeat:c,spec:d}=a,e=$(a,["repeat","spec"]),{row:f,column:g,layer:h}=c,{repeater:i={},repeaterPrefix:j=""}=b;return f||g?this.mapRepeat(Object.assign(Object.assign({},a),{repeat:Object.assign(Object.assign({},f?{row:f}:{}),g?{column:g}:{}),spec:{repeat:{layer:h},spec:d}}),b):Object.assign(Object.assign({},e),{layer:h.map(k=>{const l=Object.assign(Object.assign({},i),{layer:k}),m=(d.name||"")+j+`child__layer_${Pa(k)}`,n=this.mapLayerOrUnit(d,Object.assign(Object.assign({},b),{repeater:l,repeaterPrefix:m}));return n.name=m,n})})}mapNonLayerRepeat(a,b){var c;const{repeat:d,spec:e,data:f}=a,g=$(a,["repeat","spec","data"]);!J(d)&&a.columns&&(a=He(a,["columns"]),L($L("repeat")));const h=[],{repeater:i={},repeaterPrefix:j=""}=b,k=!J(d)&&d.row||[i?i.row:null],l=!J(d)&&d.column||[i?i.column:null],m=J(d)&&d||[i?i.repeat:null];for(const o of m)for(const p of k)for(const q of l){const r={repeat:o,row:p,column:q,layer:i.layer},s=(e.name||"")+j+"child__"+(J(d)?`${Pa(o)}`:(d.row?`row_${Pa(p)}`:"")+(d.column?`column_${Pa(q)}`:"")),t=this.map(e,Object.assign(Object.assign({},b),{repeater:r,repeaterPrefix:s}));t.name=s,h.push(He(t,["data"]))}const n=J(d)?a.columns:d.column?d.column.length:1;return Object.assign(Object.assign({data:(c=e.data)!==null&&c!==void 0?c:f,align:"all"},g),{columns:n,concat:h})}mapFacet(a,b){const{facet:c}=a;return el(c)&&a.columns&&(a=He(a,["columns"]),L($L("facet"))),super.mapFacet(a,b)}mapUnitWithParentEncodingOrProjection(a,b){const{encoding:c,projection:d}=a,{parentEncoding:e,parentProjection:f,config:g}=b,h=JN({parentProjection:f,projection:d}),i=IN({parentEncoding:e,encoding:ry(c,b.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},a),h?{projection:h}:{}),i?{encoding:i}:{}),{config:g})}mapFacetedUnit(a,b){const c=a.encoding,{row:d,column:e,facet:f}=c,g=$(c,["row","column","facet"]),{mark:h,width:i,projection:j,height:k,view:l,selection:m,encoding:n}=a,o=$(a,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:p,layout:q}=this.getFacetMappingAndLayout({row:d,column:e,facet:f},b),r=ry(g,b.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},o),q),{facet:p,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},i?{width:i}:{}),k?{height:k}:{}),l?{view:l}:{}),j?{projection:j}:{}),{mark:h,encoding:r}),m?{selection:m}:{})}),b)}getFacetMappingAndLayout(a,b){var c;const{row:d,column:e,facet:f}=a;if(d||e){f&&L(oea([...d?[Je]:[],...e?[Ke]:[]]));const g={},h={};for(const i of[Je,Ke]){const j=a[i];if(j){const k=$(j,["align","center","spacing","columns"]);g[i]=k;for(const l of["align","center","spacing"])j[l]!==void 0&&(h[l]=(c=h[l])!==null&&c!==void 0?c:{},h[l][i]=j[l])}}return{facetMapping:g,layout:h}}else{const{align:g,center:h,spacing:i,columns:j}=f,k=$(f,["align","center","spacing","columns"]);return{facetMapping:Wga(k,b.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},g?{align:g}:{}),h?{center:h}:{}),i?{spacing:i}:{}),j?{columns:j}:{})}}}mapLayer(a,b){var{parentEncoding:c,parentProjection:d}=b,e=$(b,["parentEncoding","parentProjection"]);const{encoding:f,projection:g}=a,h=$(a,["encoding","projection"]),i=Object.assign(Object.assign({},e),{parentEncoding:IN({parentEncoding:c,encoding:f}),parentProjection:JN({parentProjection:d,projection:g})});return super.mapLayer(h,i)}}function IN(a){const{parentEncoding:b,encoding:c}=a;if(b&&c){const e=O(b).reduce((f,g)=>(c[g]&&f.push(g),f),[]);e.length>0&&L(eea(e))}const d=Object.assign(Object.assign({},b!==null&&b!==void 0?b:{}),c!==null&&c!==void 0?c:{});return Ha(d)?void 0:d}function JN(a){const{parentProjection:b,projection:c}=a;return b&&c&&L(fea({parentProjection:b,projection:c})),c!==null&&c!==void 0?c:b}function KN(a,b){b===void 0&&(b=zN(a.config));const c=_ga(a,b),{width:d,height:e}=a,f=$ga(c,{width:d,height:e,autosize:a.autosize},b);return Object.assign(Object.assign({},c),f?{autosize:f}:{})}const Zga=new Yga();function _ga(a,b={}){return Zga.map(a,{config:b})}function LN(a){return V(a)?{type:a}:a!==null&&a!==void 0?a:{}}function $ga(a,b,c){let{width:d,height:e}=b;const f=Ie(a)||Zp(a),g={};f?d=="container"&&e=="container"?(g.type="fit",g.contains="padding"):d=="container"?(g.type="fit-x",g.contains="padding"):e=="container"&&(g.type="fit-y",g.contains="padding"):(d=="container"&&(L(WL("width")),d=void 0),e=="container"&&(L(WL("height")),e=void 0));const h=Object.assign(Object.assign(Object.assign({type:"pad"},g),c?LN(c.autosize):{}),LN(a.autosize));return h.type==="fit"&&!f&&(L(Uda),h.type="pad"),d=="container"&&!(h.type=="fit"||h.type=="fit-x")&&L(XL("width")),e=="container"&&!(h.type=="fit"||h.type=="fit-y")&&L(XL("height")),Vk(h,{type:"pad"})?void 0:h}function aha(a){return a==="fit"||a==="fit-x"||a==="fit-y"}function bha(a){return a?`fit-${Ep(a)}`:"fit"}const cha=["background","padding"];function MN(a){return cha.reduce((b,c)=>(a&&a[c]!==void 0&&(b[c]=a[c]),b),{})}class Of{constructor(a={},b={}){this.explicit=a,this.implicit=b}clone(){return new Of(oa(this.explicit),oa(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(a){return db(this.explicit[a],this.implicit[a])}getWithExplicit(a){return this.explicit[a]!==void 0?{explicit:!0,value:this.explicit[a]}:this.implicit[a]!==void 0?{explicit:!1,value:this.implicit[a]}:{explicit:!1,value:void 0}}setWithExplicit(a,b){b.value!==void 0&&this.set(a,b.value,b.explicit)}set(a,b,c){return delete this[c?"implicit":"explicit"][a],this[c?"explicit":"implicit"][a]=b,this}copyKeyFromSplit(a,b){b.explicit[a]!==void 0?this.set(a,b.explicit[a],!0):b.implicit[a]!==void 0&&this.set(a,b.implicit[a],!1)}copyKeyFromObject(a,b){b[a]!==void 0&&this.set(a,b[a],!0)}copyAll(a){for(const b of O(a.combine())){const c=a.getWithExplicit(b);this.setWithExplicit(b,c)}}}function eh(a){return{explicit:!0,value:a}}function Mc(a){return{explicit:!1,value:a}}function NN(a){return(b,c,d,e)=>{const f=a(b.value,c.value);return f>0?b:f<0?c:_p(b,c,d,e)}}function _p(a,b,c,d){return a.explicit&&b.explicit&&L(zea(c,d,a.value,b.value)),a}function Pf(a,b,c,d,e=_p){return a===void 0||a.value===void 0?b:a.explicit&&!b.explicit?a:b.explicit&&!a.explicit?b:Vk(a.value,b.value)?a:e(a,b,c,d)}class dha extends Of{constructor(a={},b={},c=!1){super(a,b);this.explicit=a,this.implicit=b,this.parseNothing=c}clone(){const a=super.clone();return a.parseNothing=this.parseNothing,a}}function jl(a){return"url"in a}function $p(a){return"values"in a}function ON(a){return"name"in a&&!jl(a)&&!$p(a)&&!fh(a)}function fh(a){return a&&(PN(a)||QN(a)||ty(a))}function PN(a){return"sequence"in a}function QN(a){return"sphere"in a}function ty(a){return"graticule"in a}const Pb="main",aq="raw";function RN(a){return"filter"in a}function eha(a){return(a===null||a===void 0?void 0:a.stop)!==void 0}function fha(a){return"lookup"in a}function gha(a){return"data"in a}function hha(a){return"selection"in a}function iha(a){return"pivot"in a}function jha(a){return"density"in a}function kha(a){return"quantile"in a}function lha(a){return"regression"in a}function mha(a){return"loess"in a}function nha(a){return"sample"in a}function oha(a){return"window"in a}function pha(a){return"joinaggregate"in a}function qha(a){return"flatten"in a}function rha(a){return"calculate"in a}function sha(a){return"bin"in a}function tha(a){return"impute"in a}function uha(a){return"timeUnit"in a}function vha(a){return"aggregate"in a}function wha(a){return"stack"in a}function xha(a){return"fold"in a}function yha(a){return a.map(b=>RN(b)?{filter:pp(b.filter,lfa)}:b)}function kl(a,b,c,d){const e=Wx(b)&&b.condition,f=d(b);if(e){const g=T(e),h=g.map(i=>{const j=d(i),k=Pfa(i)?pO(a,i.selection):gq(a,i.test);return Object.assign({test:k},j)});return{[c]:[...h,...f!==void 0?[f]:[]]}}else return f!==void 0?{[c]:f}:{}}function uy(a,b="text"){const c=a.encoding[b];return kl(a,c,b,d=>bq(d,a.config))}function bq(a,b,c="datum"){if(a){if(Pe(a))return ab(a.value);if(ha(a)){const{format:d,formatType:e}=Qp(a);return Sx({fieldOrDatumDef:a,format:d,formatType:e,expr:c,config:b})}}return}function SN(a,b={}){const{encoding:c,markDef:d,config:e,stack:f}=a,g=c.tooltip;if(J(g))return{tooltip:UN({tooltip:g},f,e,b)};{const h=b.reactiveGeom?"datum.datum":"datum";return kl(a,g,"tooltip",i=>{const j=bq(i,e,h);if(j)return j;if(i===null)return;let k=Aa("tooltip",d,e);return k===!0&&(k={content:"encoding"}),V(k)?{value:k}:Z(k)?k.content==="encoding"?UN(c,f,e,b):{signal:h}:void 0})}}function TN(a,b,c,{reactiveGeom:d}={}){const e={},f=d?"datum.datum":"datum",g=[];function h(j,k){const l=Yg(k),m=Lc(j)?j:Object.assign(Object.assign({},j),{type:a[l].type}),n=T(ah(m,c,{allowDisabling:!1})).join(", ");let o;if(fe(k)){const p=k==="x"?"x2":"y2",q=je(a[p]);if(dc(m.bin)&&q){const r=Q(m,{expr:f}),s=Q(q,{expr:f}),{format:t,formatType:w}=Qp(m);o=Mp(r,s,t,w,c),e[p]=!0}else if(b&&b.fieldChannel===k&&b.offset==="normalize"){const{format:r,formatType:s}=Qp(m);o=Sx({fieldOrDatumDef:m,format:r,formatType:s,expr:f,config:c,normalizeStack:!0}).signal}}o=o!==null&&o!==void 0?o:bq(m,c,f).signal,g.push({channel:k,key:n,value:o})}ey(a,(j,k)=>{R(j)?h(j,k):Pp(j)&&h(j.condition,k)});const i={};for(const{channel:j,key:k,value:l}of g)!e[j]&&!i[k]&&(i[P(k)]=l);return i}function UN(a,b,c,{reactiveGeom:d}={}){const e=TN(a,b,c,{reactiveGeom:d}),f=vL(e).map(({key:g,value:h})=>`${g}: ${h}`);return f.length>0?{signal:`{${f.join(", ")}}`}:void 0}function zha(a){const{markDef:b,config:c}=a,d=Aa("aria",b,c);return d===!1?{}:Object.assign(Object.assign(Object.assign({},d?{aria:d}:{}),Aha(a)),Bha(a))}function Aha(a){const{mark:b,markDef:c,config:d}=a;if(d.aria===!1)return{};const e=Aa("ariaRoleDescription",c,d);return e!=null?{ariaRoleDescription:{value:e}}:b in hfa?{}:{ariaRoleDescription:{value:b}}}function Bha(a){const{encoding:b,markDef:c,config:d,stack:e}=a,f=b.description;if(f)return kl(a,f,"description",i=>bq(i,a.config));const g=Aa("description",c,d);if(g!=null)return{description:ab(g)};if(d.aria===!1)return{};const h=TN(b,e,d);return Ha(h)?void 0:{description:{signal:vL(h).map(({key:i,value:j})=>`${i} + ": " + (${j})`).join(' + "; " + ')}}}function sb(a,b,c={}){const{markDef:d,encoding:e,config:f}=b,{vgChannel:g}=c;let{defaultRef:h,defaultValue:i}=c;h===void 0&&(i=i!==null&&i!==void 0?i:Aa(a,d,f,{vgChannel:g,ignoreVgConfig:!0}),i!==void 0&&(h=ab(i)));const j=e[a];return kl(b,j,g!==null&&g!==void 0?g:a,k=>DM({channel:a,channelDef:k,markDef:d,config:f,scaleName:b.scaleName(a),scale:b.getScaleComponent(a),stack:null,defaultRef:h}))}function VN(a,b={filled:void 0}){var c,d,e,f;const{markDef:g,encoding:h,config:i}=a,{type:j}=g,k=(c=b.filled)!==null&&c!==void 0?c:Aa("filled",g,i),l=fa(["bar","point","circle","square","geoshape"],j)?"transparent":void 0,m=(e=(d=Aa(k===!0?"color":void 0,g,i,{vgChannel:"fill"}))!==null&&d!==void 0?d:i.mark[k===!0&&"color"])!==null&&e!==void 0?e:l,n=(f=Aa(k===!1?"color":void 0,g,i,{vgChannel:"stroke"}))!==null&&f!==void 0?f:i.mark[k===!1&&"color"],o=k?"fill":"stroke",p=Object.assign(Object.assign({},m?{fill:ab(m)}:{}),n?{stroke:ab(n)}:{});return g.color&&(k?g.fill:g.stroke)&&L(dM("property",{fill:"fill"in g,stroke:"stroke"in g})),Object.assign(Object.assign(Object.assign(Object.assign({},p),sb("color",a,{vgChannel:o,defaultValue:k?m:n})),sb("fill",a,{defaultValue:h.fill?m:void 0})),sb("stroke",a,{defaultValue:h.stroke?n:void 0}))}function ll(a,b){const c=Lda(a),d=b[c];return d?d:void 0}function Qb(a,b,{defaultPos:c,vgChannel:d,isMidPoint:e}){const{encoding:f,markDef:g,config:h,stack:i}=b,j=f[a],k=f[de(a)],l=b.scaleName(a),m=b.getScaleComponent(a),n=ll(a,g),o=vy({model:b,defaultPos:c,channel:a,scaleName:l,scale:m}),p=!j&&fe(a)&&(f.latitude||f.longitude)?{field:b.getName(a)}:Cha({channel:a,channelDef:j,channel2Def:k,markDef:g,config:h,isMidPoint:e,scaleName:l,scale:m,stack:i,offset:n,defaultRef:o});return p?{[d||a]:p}:void 0}function Cha(a){const{channel:b,channelDef:c,isMidPoint:d,scaleName:e,stack:f,offset:g,markDef:h,config:i}=a;if(ha(c)&&f&&b===f.fieldChannel){if(R(c)){const j=fl({channel:b,fieldDef:c,isMidPoint:d,markDef:h,stack:f,config:i});if(j!==void 0)return Lp({scaleName:e,fieldOrDatumDef:c,startSuffix:"start",band:j,offset:g})}return _g(c,e,{suffix:"end"},{offset:g})}return Qx(a)}function vy({model:a,defaultPos:b,channel:c,scaleName:d,scale:e}){const{markDef:f,config:g}=a;return()=>{const h=Yg(c),i=Gf(c),j=Aa(c,f,g,{vgChannel:i});if(j!==void 0)return dl(c,j);switch(b){case"zeroOrMin":case"zeroOrMax":if(d){const k=e.get("type");if(!fa([eb.LOG,eb.TIME,eb.UTC],k)){if(e.domainDefinitelyIncludesZero())return{scale:d,value:0}}}if(b==="zeroOrMin")return h==="y"?{field:{group:"height"}}:{value:0};switch(h){case"radius":return{signal:`min(${a.width.signal},${a.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const k=a[ee(c)];return Object.assign(Object.assign({},k),{mult:.5})}}return}}const Dha={left:"x",center:"xc",right:"x2"},Eha={top:"y",middle:"yc",bottom:"y2"};function WN(a,b,c,d="middle"){if(a==="radius"||a==="theta")return Gf(a);const e=a==="x"?"align":"baseline",f=Aa(e,b,c);return a==="x"?Dha[f||(d==="top"?"left":"center")]:Eha[f||d]}function cq(a,b,{defaultPos:c,defaultPos2:d,range:e}){return e?XN(a,b,{defaultPos:c,defaultPos2:d}):Qb(a,b,{defaultPos:c})}function XN(a,b,{defaultPos:c,defaultPos2:d}){const{markDef:e,config:f}=b,g=de(a),h=ee(a),i=Fha(b,d,g),j=i[h]?WN(a,e,f):Gf(a);return Object.assign(Object.assign({},Qb(a,b,{defaultPos:c,vgChannel:j})),i)}function Fha(a,b,c){const{encoding:d,mark:e,markDef:f,stack:g,config:h}=a,i=Yg(c),j=ee(c),k=Gf(c),l=d[i],m=a.scaleName(i),n=a.getScaleComponent(i),o=c in d||c in f?ll(c,a.markDef):ll(i,a.markDef);if(!l&&(c==="x2"||c==="y2")&&(d.latitude||d.longitude))return{[k]:{field:a.getName(c)}};const p=Gha({channel:c,channelDef:l,channel2Def:d[c],markDef:f,config:h,scaleName:m,scale:n,stack:g,offset:o,defaultRef:void 0});return p!==void 0?{[k]:p}:dq(c,f)||dq(c,{[c]:Up(c,f,h.style),[j]:Up(j,f,h.style)})||dq(c,h[e])||dq(c,h.mark)||{[k]:vy({model:a,defaultPos:b,channel:c,scaleName:m,scale:n})()}}function Gha({channel:a,channelDef:b,channel2Def:c,markDef:d,config:e,scaleName:f,scale:g,stack:h,offset:i,defaultRef:j}){return ha(b)&&h&&a.charAt(0)===h.fieldChannel.charAt(0)?_g(b,f,{suffix:"start"},{offset:i}):Qx({channel:a,channelDef:c,scaleName:f,scale:g,stack:h,markDef:d,config:e,offset:i,defaultRef:j})}function dq(a,b){const c=ee(a),d=Gf(a);if(b[d]!==void 0)return{[d]:dl(a,b[d])};{if(b[a]!==void 0)return{[d]:dl(a,b[a])};if(b[c])return{[c]:dl(a,b[c])}}return}function Qf(a,b,c){var d,e,f,g;const{config:h,encoding:i,markDef:j,stack:k}=a,l=de(b),m=ee(b),n=i[b],o=i[l],p=a.getScaleComponent(b),q=p?p.get("type"):void 0,r=a.scaleName(b),s=j.orient,t=(e=(d=i[m])!==null&&d!==void 0?d:i.size)!==null&&e!==void 0?e:Aa("size",j,h,{vgChannel:m}),w=c==="bar"&&(b==="x"?s==="vertical":s==="horizontal");if(R(n)&&(Ia(n.bin)||dc(n.bin)||n.timeUnit&&!o)&&!t&&!yc(q)){const v=fl({channel:b,fieldDef:n,stack:k,markDef:j,config:h}),x=(f=a.component.axes[b])===null||f===void 0?void 0:f[0],u=(g=x===null||x===void 0?void 0:x.get("translate"))!==null&&g!==void 0?g:.5;return Jha({fieldDef:n,fieldDef2:o,channel:b,markDef:j,scaleName:r,band:v,axisTranslate:u,spacing:fe(b)?Aa("binSpacing",j,h):void 0,reverse:p.get("reverse"),config:h})}else return(ha(n)&&yc(q)||w)&&!o?Iha(c,n,b,a):XN(b,a,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Hha(a,b,c,d,e,f){if(d){const i=d.get("type");if(i==="point"||i==="band"){if(e[a].discreteBandSize!==void 0)return{value:e[a].discreteBandSize};if(i===eb.POINT){const j=d.get("range");return Jf(j)&&Fa(j.step)?{value:j.step-2}:{value:py-2}}else return{scale:c,band:f}}else return{value:e[a].continuousBandSize}}const g=Yp(e.view,b),h=db(e[a].discreteBandSize,g-2);return h!==void 0?{value:h}:void 0}function Iha(a,b,c,d){var e;const{markDef:f,encoding:g,config:h,stack:i}=d,j=f.orient,k=d.scaleName(c),l=d.getScaleComponent(c),m=ee(c),n=de(c),o=j==="horizontal"&&c==="y"||j==="vertical"&&c==="x",p=Aa(o?"size":m,f,h,{vgChannel:m});let q;(g.size||p!==void 0)&&(o?q=sb("size",d,{vgChannel:m,defaultValue:p}):L(wea(f.type)));const r=(e=ha(b)?fl({channel:c,fieldDef:b,markDef:f,stack:i,config:h}):void 0)!==null&&e!==void 0?e:1;q=q||{[m]:Hha(a,m,k,l,h,r)};const s=(l===null||l===void 0?void 0:l.get("type"))!=="band"||!("band"in q[m]),t=WN(c,f,h,s?"middle":"top"),w=ll(c,f),v=Qx({channel:c,channelDef:b,markDef:f,config:h,scaleName:k,scale:l,stack:i,offset:w,defaultRef:vy({model:d,defaultPos:"mid",channel:c,scaleName:k,scale:l}),band:s?.5:(1-r)/2});if(m)return Object.assign({[t]:v},q);{const x=Gf(n),u=q[m],z=w?Object.assign(Object.assign({},u),{offset:w}):u;return{[t]:v,[x]:J(v)?[v[0],Object.assign(Object.assign({},v[1]),{offset:z})]:Object.assign(Object.assign({},v),{offset:z})}}}function ml(a,b,c,d,e){if(LL(a))return 0;const f=a==="x"||a==="y2"?-b/2:b/2;if(ga(c)){const g=hl(e);return{signal:`${c.signal} ? ${d-f}${g?"-"+g:""} : ${d+f}${g?"+"+g:""}`}}else{if(ga(e)){const g=d+(c?-f:f);return{signal:`${g||""}${c?" - ":g?" + ":""}${e.signal}`}}return e=e||0,d+(c?-e-f:+e+f)}}function Jha({fieldDef:a,fieldDef2:b,channel:c,band:d,scaleName:e,markDef:f,spacing:g=0,axisTranslate:h,reverse:i,config:j}){const k=de(c),l=Gf(c),m=Gf(k),n=ll(c,f);if(Ia(a.bin)||a.timeUnit)return{[m]:YN({channel:c,fieldDef:a,scaleName:e,markDef:f,band:(1-d)/2,offset:ml(k,g,i,h,n),config:j}),[l]:YN({channel:c,fieldDef:a,scaleName:e,markDef:f,band:1-(1-d)/2,offset:ml(c,g,i,h,n),config:j})};if(dc(a.bin)){const o=_g(a,e,{},{offset:ml(k,g,i,h,n)});if(R(b))return{[m]:o,[l]:_g(b,e,{},{offset:ml(c,g,i,h,n)})};if(bl(a.bin)&&a.bin.step)return{[m]:o,[l]:{signal:`scale("${e}", ${Q(a,{expr:"datum"})} + ${a.bin.step})`,offset:ml(c,g,i,h,n)}}}L(iM(k));return}function YN({channel:a,fieldDef:b,scaleName:c,markDef:d,band:e,offset:f,config:g}){const h=Lp({scaleName:c,fieldOrDatumDef:b,band:e,offset:f});return CM({fieldDef:b,channel:a,markDef:d,ref:h,config:g})}const Kha=new Set(["aria"]);function ed(a,b){const{fill:c=void 0,stroke:d=void 0}=b.color==="include"?VN(a):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Lha(a.markDef,b)),ZN(a,"fill",c)),ZN(a,"stroke",d)),sb("opacity",a)),sb("fillOpacity",a)),sb("strokeOpacity",a)),sb("strokeWidth",a)),sb("strokeDash",a)),SN(a)),uy(a,"href")),zha(a))}function ZN(a,b,c){const{config:d,mark:e,markDef:f}=a,g=Aa("invalid",f,d);if(g==="hide"&&c&&!Ug(e)){const h=Mha(a,{invalid:!0,channels:Fp});if(h)return{[b]:[{test:h,value:null},...T(c)]}}return c?{[b]:c}:{}}function Lha(a,b){return gfa.reduce((c,d)=>(!Kha.has(d)&&a[d]!==void 0&&b[d]!=="ignore"&&(c[d]=ab(a[d])),c),{})}function Mha(a,{invalid:b=!1,channels:c}){const d=c.reduce((f,g)=>{const h=a.getScaleComponent(g);if(h){const i=h.get("type"),j=a.vgField(g,{expr:"datum"});j&&dd(i)&&(f[j]=!0)}return f},{}),e=O(d);if(e.length>0){const f=b?"||":"&&";return e.map(g=>Rx(g,b)).join(` ${f} `)}return}function wy(a){const{config:b,markDef:c}=a,d=Aa("invalid",c,b);if(d){const e=Nha(a,{channels:cd});if(e)return{defined:{signal:e}}}return{}}function Nha(a,{invalid:b=!1,channels:c}){const d=c.reduce((f,g)=>{const h=a.getScaleComponent(g);if(h){const i=h.get("type"),j=a.vgField(g,{expr:"datum"});j&&dd(i)&&(f[j]=!0)}return f},{}),e=O(d);if(e.length>0){const f=b?"||":"&&";return e.map(g=>Rx(g,b)).join(` ${f} `)}return}function _N(a,b){return b!==void 0?{[a]:ab(b)}:void 0}const xy="voronoi",$N={has:a=>a.type!=="interval"&&a.nearest,parse:(a,b)=>{if(b.events)for(const c of b.events)c.markname=a.getName(xy)},marks:(a,b,c)=>{const{x:d,y:e}=b.project.hasChannel,f=a.mark;if(Ug(f))return L(Wda(f)),c;const g={name:a.getName(xy),type:"path",interactive:!0,from:{data:a.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},SN(a,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:d||!e?"datum.datum.x || 0":"0"},y:{expr:e||!d?"datum.datum.y || 0":"0"},size:[a.getSizeSignalRef("width"),a.getSizeSignalRef("height")]}]};let h=0,i=!1;return c.forEach((j,k)=>{var l;const m=(l=j.name)!==null&&l!==void 0?l:"";m===a.component.mark[0].name?h=k:m.indexOf(xy)>=0&&(i=!0)}),i||c.splice(h+1,0,g),c}};class Ea{constructor(a,b){this.debugName=b,this._children=[],this._parent=null,a&&(this.parent=a)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(a){this._parent=a,a&&a.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(a,b){if(this._children.indexOf(a)>-1){console.warn("Attempt to add the same child twice.");return}b!==void 0?this._children.splice(b,0,a):this._children.push(a)}removeChild(a){const b=this._children.indexOf(a);return this._children.splice(b,1),b}remove(){let a=this._parent.removeChild(this);for(const b of this._children)b._parent=this._parent,this._parent.addChild(b,a++)}insertAsParentOf(a){const b=a.parent;b.removeChild(this),this.parent=b,a.parent=this}swapWithParent(){const a=this._parent,b=a.parent;for(const c of this._children)c.parent=a;this._children=[],a.removeChild(this),a.parent.removeChild(a),this.parent=b,a.parent=this}}class fc extends Ea{constructor(a,b,c,d){super(a,b);this.type=c,this.refCounts=d,this._source=this._name=b,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const a=new this.constructor();return a.debugName="clone_"+this.debugName,a._source=this._source,a._name="clone_"+this._name,a.type=this.type,a.refCounts=this.refCounts,a.refCounts[a._name]=0,a}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return this._hash===void 0&&(this._hash=`Output ${dda()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(a){this._source=a}}class Re extends Ea{constructor(a,b){super(a);this.formula=b}clone(){return new Re(null,oa(this.formula))}static makeFromEncoding(a,b){const c=b.reduceFieldDef((d,e,f)=>{const{field:g,timeUnit:h}=e,i=Xa(b)?b.encoding[de(f)]:void 0,j=Xa(b)&&Vx(f,e,i,b.stack,b.markDef,b.config);if(h){const k=Q(e,{forAs:!0});d[ua({as:k,field:g,timeUnit:h})]=Object.assign({as:k,field:g,timeUnit:h},j?{band:!0}:{})}return d},{});return Ha(c)?null:new Re(a,c)}static makeFromTransform(a,b){const c=Object.assign({},b),{timeUnit:d}=c,e=$(c,["timeUnit"]),f=ec(d),g=Object.assign(Object.assign({},e),{timeUnit:f});return new Re(a,{[ua(g)]:g})}merge(a){this.formula=Object.assign({},this.formula);for(const b in a.formula)(!this.formula[b]||a.formula[b].band)&&(this.formula[b]=a.formula[b]);for(const b of a.children)a.removeChild(b),b.parent=this;a.remove()}producedFields(){return new Set(zf(this.formula).map(a=>a.as))}dependentFields(){return new Set(zf(this.formula).map(a=>a.field))}hash(){return`TimeUnit ${ua(this.formula)}`}assemble(){const a=[];for(const b of zf(this.formula)){const{field:c,as:d,timeUnit:e}=b,f=ec(e),{unit:g,utc:h}=f,i=$(f,["unit","utc"]);a.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Af(c),type:"timeunit"},g?{units:Hx(g)}:{}),h?{timezone:"utc"}:{}),i),{as:[d,`${d}_end`]}))}return a}}const nl="_tuple_fields";class Oha{constructor(...a){this.items=a,this.hasChannel={},this.hasField={}}}const Pha={has:()=>!0,parse:(a,b,c)=>{var d,e,f;const g=b.name,h=(d=b.project)!==null&&d!==void 0?d:b.project=new Oha(),i={},j={},k=new Set(),l=(m,n)=>{const o=n==="visual"?m.channel:m.field;let p=Pa(`${g}_${o}`);for(let q=1;k.has(p);q++)p=Pa(`${g}_${o}_${q}`);return k.add(p),{[n]:p}};if(!c.fields&&!c.encodings){const m=a.config.selection[c.type];if(c.init)for(const n of T(c.init))for(const o of O(n))Jda(o)?(c.encodings||(c.encodings=[])).push(o):c.type==="interval"?(L('Interval selections should be initialized using "x" and/or "y" keys.'),c.encodings=m.encodings):(c.fields||(c.fields=[])).push(o);else c.encodings=m.encodings,c.fields=m.fields}for(const m of(e=c.fields)!==null&&e!==void 0?e:[]){const n={type:"E",field:m};n.signals=Object.assign({},l(n,"data")),h.items.push(n),h.hasField[m]=n}for(const m of(f=c.encodings)!==null&&f!==void 0?f:[]){const n=a.fieldDef(m);if(n){let o=n.field;if(n.aggregate){L(Vda(m,n.aggregate));continue}else if(!o){L(ZL(m));continue}if(n.timeUnit){o=a.vgField(m);const p={timeUnit:n.timeUnit,as:o,field:n.field};j[ua(p)]=p}if(!i[o]){let p="E";if(b.type==="interval"){const r=a.getScaleComponent(m).get("type");dd(r)&&(p="R")}else n.bin&&(p="R-RE");const q={field:o,channel:m,type:p};q.signals=Object.assign(Object.assign({},l(q,"data")),l(q,"visual")),h.items.push(i[o]=q),h.hasField[o]=h.hasChannel[m]=i[o]}}else L(ZL(m))}if(c.init){const m=n=>h.items.map(o=>n[o.channel]!==void 0?n[o.channel]:n[o.field]);if(c.type==="interval")b.init=m(c.init);else{const n=T(c.init);b.init=n.map(m)}}Ha(j)||(h.timeUnit=new Re(null,j))},signals:(a,b,c)=>{const d=b.name+nl,e=c.filter(f=>f.name===d);return e.length>0?c:c.concat({name:d,value:b.project.items.map(f=>{const g=$(f,["signals","hasLegend"]);return g.field=Af(g.field),g})})}},aO={has:a=>a.type==="single"&&a.resolve==="global"&&a.bind&&a.bind!=="scales"&&!ky(a.bind),parse:(a,b,c,d)=>{d.on||delete b.events,d.clear||delete b.clear},topLevelSignals:(a,b,c)=>{const d=b.name,e=b.project,f=b.bind,g=b.init&&b.init[0],h=$N.has(b)?"(item().isVoronoi ? datum.datum : datum)":"datum";return e.items.forEach((i,j)=>{var k,l;const m=Pa(`${d}_${i.field}`),n=c.filter(o=>o.name===m);n.length||c.unshift(Object.assign(Object.assign({name:m},g?{init:Hi(g[j])}:{value:null}),{on:b.events?[{events:b.events,update:`datum && item().mark.marktype !== 'group' ? ${h}[${P(i.field)}] : null`}]:[],bind:(l=(k=f[i.field])!==null&&k!==void 0?k:f[i.channel])!==null&&l!==void 0?l:f}))}),c},signals:(a,b,c)=>{const d=b.name,e=b.project,f=c.filter(j=>j.name===d+le)[0],g=d+nl,h=e.items.map(j=>Pa(`${d}_${j.field}`)),i=h.map(j=>`${j} !== null`).join(" && ");return h.length&&(f.update=`${i} ? {fields: ${g}, values: [${h.join(", ")}]} : null`),delete f.value,delete f.on,c}},eq="_toggle",bO={has:a=>a.type==="multi"&&!!a.toggle,signals:(a,b,c)=>c.concat({name:b.name+eq,value:!1,on:[{events:b.events,update:b.toggle}]}),modifyExpr:(a,b)=>{const c=b.name+le,d=b.name+eq;return`${d} ? null : ${c}, `+(b.resolve==="global"?`${d} ? null : true, `:`${d} ? null : {unit: ${Se(a)}}, `)+`${d} ? ${c} : null`}},Qha={has:a=>a.clear!==void 0&&a.clear!==!1,parse:(a,b,c)=>{c.clear&&(b.clear=V(c.clear)?Og(c.clear,"scope"):c.clear)},topLevelSignals:(a,b,c)=>{if(aO.has(b))for(const d of b.project.items){const e=c.findIndex(f=>f.name===Pa(`${b.name}_${d.field}`));e!==-1&&c[e].on.push({events:b.clear,update:"null"})}return c},signals:(a,b,c)=>{function d(e,f){e!==-1&&c[e].on&&c[e].on.push({events:b.clear,update:f})}if(b.type==="interval")for(const e of b.project.items){const f=c.findIndex(g=>g.name===e.signals.visual);d(f,"[0, 0]");if(f===-1){const g=c.findIndex(h=>h.name===e.signals.data);d(g,"null")}}else{let e=c.findIndex(f=>f.name===b.name+le);d(e,"null"),bO.has(b)&&(e=c.findIndex(f=>f.name===b.name+eq),d(e,"false"))}return c}},Rf={has:a=>a.type==="interval"&&a.resolve==="global"&&a.bind&&a.bind==="scales",parse:(a,b)=>{const c=b.scales=[];for(const d of b.project.items){const e=d.channel;if(!If(e))continue;const f=a.getScaleComponent(e),g=f?f.get("type"):void 0;if(!f||!dd(g)){L(Yda);continue}const h={selection:b.name,field:d.field};f.set("selectionExtent",h,!0),c.push(d)}},topLevelSignals:(a,b,c)=>{const d=b.scales.filter(g=>c.filter(h=>h.name===g.signals.data).length===0);if(!a.parent||zy(a)||d.length===0)return c;const e=c.filter(g=>g.name===b.name)[0];let f=e.update;if(f.indexOf(mO)>=0)e.update=`{${d.map(g=>`${P(g.field)}: ${g.signals.data}`).join(", ")}}`;else{for(const g of d){const h=`${P(g.field)}: ${g.signals.data}`;f.indexOf(h)<0&&(f=`${f.substring(0,f.length-1)}, ${h}}`)}e.update=f}return c.concat(d.map(g=>({name:g.signals.data})))},signals:(a,b,c)=>{if(a.parent&&!zy(a))for(const d of b.scales){const e=c.filter(f=>f.name===d.signals.data)[0];e.push="outer",delete e.value,delete e.update}return c}};function yy(a,b){const c=P(a.scaleName(b));return`domain(${c})`}function zy(a){var b;return a.parent&&Ni(a.parent)&&((b=!a.parent.parent)!==null&&b!==void 0?b:zy(a.parent.parent))}const cO={has:a=>{const b=a.resolve==="global"&&a.bind&&ky(a.bind),c=a.project.items.length===1&&a.project.items[0].field!==Gi;return b&&!c&&L(Zda),b&&c},parse:(a,b,c,d)=>{var e;d.on||delete b.events,d.clear||delete b.clear;if(d.on||d.clear){const h='event.item && indexof(event.item.mark.role, "legend") < 0';for(const i of b.events)i.filter=T((e=i.filter)!==null&&e!==void 0?e:[]),i.filter.indexOf(h)<0&&i.filter.push(h)}const f=ly(b.bind)?b.bind.legend:"click",g=V(f)?Og(f,"view"):T(f);b.bind={legend:{merge:g}}},topLevelSignals:(a,b,c)=>{const d=b.name,e=ly(b.bind)&&b.bind.legend,f=g=>h=>{const i=oa(h);return i.markname=g,i};for(const g of b.project.items){if(!g.hasLegend)continue;const h=`${Pa(g.field)}_legend`,i=`${d}_${h}`,j=c.filter(k=>k.name===i);if(j.length===0){const k=e.merge.map(f(`${h}_symbols`)).concat(e.merge.map(f(`${h}_labels`))).concat(e.merge.map(f(`${h}_entries`)));c.unshift(Object.assign(Object.assign({name:i},b.init?{}:{value:null}),{on:[{events:k,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:e.merge,update:`!event.item || !datum ? null : ${i}`,force:!0}]}))}}return c},signals:(a,b,c)=>{const d=b.name,e=b.project,f=c.find(m=>m.name===d+le),g=d+nl,h=e.items.filter(m=>m.hasLegend).map(m=>Pa(`${d}_${Pa(m.field)}_legend`)),i=h.map(m=>`${m} !== null`).join(" && "),j=`${i} ? {fields: ${g}, values: [${h.join(", ")}]} : null`;b.events&&h.length>0?f.on.push({events:h.map(m=>({signal:m})),update:j}):h.length>0&&(f.update=j,delete f.value,delete f.on);const k=c.find(m=>m.name===d+eq),l=ly(b.bind)&&b.bind.legend;return k&&(b.events?k.on.push(Object.assign(Object.assign({},k.on[0]),{events:l})):k.on[0].events=l),c}};function Rha(a,b,c){var d;const e=(d=a.fieldDef(b))===null||d===void 0?void 0:d.field;hh(a,f=>{var g,h;const i=(g=f.project.hasField[e])!==null&&g!==void 0?g:f.project.hasChannel[b];if(i&&cO.has(f)){const j=(h=c.get("selections"))!==null&&h!==void 0?h:[];j.push(f.name),c.set("selections",j,!1),i.hasLegend=!0}})}const dO="_translate_anchor",eO="_translate_delta",Sha={has:a=>a.type==="interval"&&a.translate,signals:(a,b,c)=>{const d=b.name,e=Rf.has(b),f=d+dO,{x:g,y:h}=b.project.hasChannel;let i=Og(b.translate,"scope");return e||(i=i.map(j=>(j.between[0].markname=d+ol,j))),c.push({name:f,value:{},on:[{events:i.map(j=>j.between[0]),update:"{x: x(unit), y: y(unit)"+(g!==void 0?", extent_x: "+(e?yy(a,Ta):`slice(${g.signals.visual})`):"")+(h!==void 0?", extent_y: "+(e?yy(a,jb):`slice(${h.signals.visual})`):"")+"}"}]},{name:d+eO,value:{},on:[{events:i,update:`{x: ${f}.x - x(unit), y: ${f}.y - y(unit)}`}]}),g!==void 0&&fO(a,b,g,"width",c),h!==void 0&&fO(a,b,h,"height",c),c}};function fO(a,b,c,d,e){var f;const g=b.name,h=g+dO,i=g+eO,j=c.channel,k=Rf.has(b),l=e.filter(w=>w.name===c.signals[k?"data":"visual"])[0],m=a.getSizeSignalRef(d).signal,n=a.getScaleComponent(j),o=n.get("type"),p=k&&j===Ta?"-":"",q=`${h}.extent_${j}`,r=`${p}${i}.${j} / `+(k?`${m}`:`span(${q})`),s=k?o==="log"?"panLog":o==="pow"?"panPow":"panLinear":"panLinear",t=`${s}(${q}, ${r}`+(k&&o==="pow"?`, ${(f=n.get("exponent"))!==null&&f!==void 0?f:1}`:"")+")";l.on.push({events:{signal:i},update:k?t:`clampRange(${t}, 0, ${m})`})}const gO="_zoom_anchor",hO="_zoom_delta",Tha={has:a=>a.type==="interval"&&a.zoom,signals:(a,b,c)=>{const d=b.name,e=Rf.has(b),f=d+hO,{x:g,y:h}=b.project.hasChannel,i=P(a.scaleName(Ta)),j=P(a.scaleName(jb));let k=Og(b.zoom,"scope");return e||(k=k.map(l=>(l.markname=d+ol,l))),c.push({name:d+gO,on:[{events:k,update:e?"{"+[i?`x: invert(${i}, x(unit))`:"",j?`y: invert(${j}, y(unit))`:""].filter(l=>!!l).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:f,on:[{events:k,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),g!==void 0&&iO(a,b,g,"width",c),h!==void 0&&iO(a,b,h,"height",c),c}};function iO(a,b,c,d,e){var f;const g=b.name,h=c.channel,i=Rf.has(b),j=e.filter(s=>s.name===c.signals[i?"data":"visual"])[0],k=a.getSizeSignalRef(d).signal,l=a.getScaleComponent(h),m=l.get("type"),n=i?yy(a,h):j.name,o=g+hO,p=`${g}${gO}.${h}`,q=i?m==="log"?"zoomLog":m==="pow"?"zoomPow":"zoomLinear":"zoomLinear",r=`${q}(${n}, ${p}, ${o}`+(i&&m==="pow"?`, ${(f=l.get("exponent"))!==null&&f!==void 0?f:1}`:"")+")";j.on.push({events:{signal:o},update:i?r:`clampRange(${r}, 0, ${k})`})}const Uha=[Pha,bO,Rf,cO,Sha,Tha,aO,$N,Qha];function fq(a,b){for(const c of Uha)c.has(a)&&b(c)}function Hi(a,b=!0,c=Ub){if(J(a)){const d=a.map(e=>Hi(e,b,c));return b?`[${d.join(", ")}]`:d}else if(Ci(a))return b?c(cl(a)):c(Yea(a));return b?c(JSON.stringify(a)):a}function Vha(a,b){return hh(a,(c,d)=>{const e=c.name;let f=d.modifyExpr(a,c);b.push(...d.signals(a,c)),fq(c,g=>{g.signals&&(b=g.signals(a,c,b)),g.modifyExpr&&(f=g.modifyExpr(a,c,f))}),b.push({name:e+dia,on:[{events:{signal:c.name+le},update:`modify(${P(c.name+gh)}, ${f})`}]})}),Ay(b)}function Wha(a,b){if(a.component.selection&&O(a.component.selection).length){const c=P(a.getName("cell"));b.unshift({name:"facet",value:{},on:[{events:Og("mousemove","scope"),update:`isTuple(facet) ? facet : group(${c}).datum`}]})}return Ay(b)}function Xha(a,b){let c=!1;hh(a,(d,e)=>{const f=d.name,g=P(f+gh),h=b.filter(i=>i.name===f);if(h.length===0){const i=d.resolve==="global"?"union":d.resolve,j=d.type==="multi"?", true)":")";b.push({name:d.name,update:`${mO}(${g}, ${P(i)}${j}`})}c=!0,e.topLevelSignals&&(b=e.topLevelSignals(a,d,b)),fq(d,i=>{i.topLevelSignals&&(b=i.topLevelSignals(a,d,b))})});if(c){const d=b.filter(e=>e.name==="unit");d.length===0&&b.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return Ay(b)}function Yha(a,b){const c=[...b];return hh(a,d=>{const e={name:d.name+gh};if(d.init){const g=d.project.items.map(i=>{const j=$(i,["signals"]);return j}),h=d.init.map(i=>Hi(i,!1));e.values=d.type==="interval"?[{unit:Se(a,{escape:!1}),fields:g,values:h}]:h.map(i=>({unit:Se(a,{escape:!1}),fields:g,values:i}))}const f=c.filter(g=>g.name===d.name+gh);f.length||c.push(e)}),c}function jO(a,b){return hh(a,(c,d)=>{b=d.marks?d.marks(a,c,b):b,fq(c,e=>{e.marks&&(b=e.marks(a,c,b))})}),b}function Zha(a,b){for(const c of a.children)Xa(c)&&(b=jO(c,b));return b}function _ha(a,b){const c=b.selection,d=a.getSelectionComponent(c,Pa(c));return{signal:qO(d,b)}}function Ay(a){return a.map(b=>(b.on&&!b.on.length&&delete b.on,b))}const ol="_brush",By="_scale_trigger",$ha={signals:(a,b)=>{const c=b.name,d=c+nl,e=Rf.has(b),f=[],g=[],h=[];if(b.translate&&!e){const k=`!event.item || event.item.mark.name !== ${P(c+ol)}`;kO(b,(l,m)=>{var n;const o=T((n=m.between[0].filter)!==null&&n!==void 0?n:m.between[0].filter=[]);return o.indexOf(k)<0&&o.push(k),l})}b.project.items.forEach((k,l)=>{const m=k.channel;if(m!==Ta&&m!==jb){L("Interval selections only support x and y encoding channels.");return}const n=b.init?b.init[l]:null,o=aia(a,b,k,n),p=k.signals.data,q=k.signals.visual,r=P(a.scaleName(m)),s=a.getScaleComponent(m).get("type"),t=dd(s)?"+":"";f.push(...o),g.push(p),h.push({scaleName:a.scaleName(m),expr:`(!isArray(${p}) || (${t}invert(${r}, ${q})[0] === ${t}${p}[0] && ${t}invert(${r}, ${q})[1] === ${t}${p}[1]))`})}),e||f.push({name:c+By,value:{},on:[{events:h.map(k=>({scale:k.scaleName})),update:h.map(k=>k.expr).join(" && ")+` ? ${c+By} : {}`}]});const i=b.init,j=`unit: ${Se(a)}, fields: ${d}, values`;return f.concat(Object.assign(Object.assign({name:c+le},i?{init:`{${j}: ${Hi(i)}}`}:{}),{on:[{events:[{signal:g.join(" || ")}],update:g.join(" && ")+` ? {${j}: [${g}]} : null`}]}))},modifyExpr:(a,b)=>{const c=b.name+le;return c+", "+(b.resolve==="global"?"true":`{unit: ${Se(a)}}`)},marks:(a,b,c)=>{const d=b.name,{x:e,y:f}=b.project.hasChannel,g=e&&e.signals.visual,h=f&&f.signals.visual,i=`data(${P(b.name+gh)})`;if(Rf.has(b))return c;const j={x:e!==void 0?{signal:`${g}[0]`}:{value:0},y:f!==void 0?{signal:`${h}[0]`}:{value:0},x2:e!==void 0?{signal:`${g}[1]`}:{field:{group:"width"}},y2:f!==void 0?{signal:`${h}[1]`}:{field:{group:"height"}}};if(b.resolve==="global")for(const q of O(j))j[q]=[Object.assign({test:`${i}.length && ${i}[0].unit === ${Se(a)}`},j[q]),{value:0}];const k=b.mark,{fill:l,fillOpacity:m,cursor:n}=k,o=$(k,["fill","fillOpacity","cursor"]),p=O(o).reduce((q,r)=>(q[r]=[{test:[e!==void 0&&`${g}[0] !== ${g}[1]`,f!==void 0&&`${h}[0] !== ${h}[1]`].filter(s=>s).join(" && "),value:o[r]},{value:null}],q),{});return[{name:d+ol+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:l},fillOpacity:{value:m}},update:j}},...c,{name:d+ol,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},n?{cursor:{value:n}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},j),p)}}]}};function aia(a,b,c,d){const e=c.channel,f=c.signals.visual,g=c.signals.data,h=Rf.has(b),i=P(a.scaleName(e)),j=a.getScaleComponent(e),k=j?j.get("type"):void 0,l=p=>`scale(${i}, ${p})`,m=a.getSizeSignalRef(e===Ta?"width":"height").signal,n=`${e}(unit)`,o=kO(b,(p,q)=>[...p,{events:q.between[0],update:`[${n}, ${n}]`},{events:q,update:`[${f}[0], clamp(${n}, 0, ${m})]`}]);return o.push({events:{signal:b.name+By},update:dd(k)?`[${l(`${g}[0]`)}, ${l(`${g}[1]`)}]`:"[0, 0]"}),h?[{name:g,on:[]}]:[Object.assign(Object.assign({name:f},d?{init:Hi(d,!0,l)}:{value:[]}),{on:o}),Object.assign(Object.assign({name:g},d?{init:Hi(d)}:{}),{on:[{events:{signal:f},update:`${f}[0] === ${f}[1] ? null : invert(${i}, ${f})`}]})]}function kO(a,b){return a.events.reduce((c,d)=>d.between?b(c,d):(L(`${d} is not an ordered event stream for interval selections.`),c),[])}function lO(a,b){const c=b.name,d=c+nl,e=b.project,f="(item().isVoronoi ? datum.datum : datum)",g=e.items.map(j=>{const k=a.fieldDef(j.channel);return k&&k.bin?`[${f}[${P(a.vgField(j.channel,{}))}], ${f}[${P(a.vgField(j.channel,{binSuffix:"end"}))}]]`:`${f}[${P(j.field)}]`}).join(", "),h=`unit: ${Se(a)}, fields: ${d}, values`,i=b.events;return[{name:c+le,on:i?[{events:i,update:`datum && item().mark.marktype !== 'group' ? {${h}: [${g}]} : null`,force:!0}]:[]}]}const bia={signals:lO,modifyExpr:(a,b)=>{const c=b.name+le;return c+", "+(b.resolve==="global"?"null":`{unit: ${Se(a)}}`)}},cia={signals:lO,modifyExpr:(a,b)=>{const c=b.name+le;return c+", "+(b.resolve==="global"?"true":`{unit: ${Se(a)}}`)}},gh="_store",le="_tuple",dia="_modify",mO="vlSelectionResolve",eia={single:cia,multi:bia,interval:$ha};function hh(a,b){const c=a.component.selection;if(c)for(const d of zf(c)){const e=b(d,eia[d.type]);if(e===!0)break}}function fia(a){let b=a.parent;for(;b;){if(Cd(b))break;b=b.parent}return b}function Se(a,{escape:b}={escape:!0}){let c=b?P(a.name):a.name;const d=fia(a);if(d){const{facet:e}=d;for(const f of bd)e[f]&&(c+=` + '__facet_${f}_' + (facet[${P(d.vgField(f))}])`)}return c}function Cy(a){let b=!1;return hh(a,c=>{b=b||c.project.items.some(d=>d.field===Gi)}),b}function Dy(a){const b=[];return a.type==="Identifier"?[a.name]:a.type==="Literal"?[a.value]:(a.type==="MemberExpression"&&(b.push(...Dy(a.object)),b.push(...Dy(a.property))),b)}function nO(a){return a.object.type==="MemberExpression"?nO(a.object):a.object.name==="datum"}function oO(a){const b=IJ(a),c=new Set();return b.visit(d=>{d.type==="MemberExpression"&&nO(d)&&c.add(Dy(d).slice(1).join("."))}),c}class pl extends Ea{constructor(a,b,c){super(a);this.model=b,this.filter=c,this.expr=gq(this.model,this.filter,this),this._dependentFields=oO(this.expr)}clone(){return new pl(null,this.model,oa(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set()}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function gia(a,b){var c;const d={},e=a.config.selection;for(const f of O(b!==null&&b!==void 0?b:{})){const g=oa(b[f]),h=e[g.type],i=$(h,["fields","encodings"]);for(const l in i){if(l==="encodings"&&g.fields||l==="fields"&&g.encodings)continue;l==="mark"&&(g[l]=Object.assign(Object.assign({},i[l]),g[l])),(g[l]===void 0||g[l]===!0)&&(g[l]=(c=i[l])!==null&&c!==void 0?c:g[l])}const j=Pa(f),k=d[j]=Object.assign(Object.assign({},g),{name:j,events:V(g.on)?Og(g.on,"scope"):oa(g.on)});fq(k,l=>{l.has(k)&&l.parse&&l.parse(a,k,g,b[f])})}return d}function pO(a,b,c,d="datum"){const e=[];function f(h){const i=Pa(h),j=a.getSelectionComponent(i,h),k=P(i+gh);if(j.project.timeUnit){const l=c!==null&&c!==void 0?c:a.component.data.raw,m=j.project.timeUnit.clone();l.parent?m.insertAsParentOf(l):l.parent=m}return j.empty!=="none"&&e.push(k),`vlSelectionTest(${k}, ${d}`+(j.resolve==="global"?")":`, ${P(j.resolve)})`)}const g=Yk(b,f);return(e.length?"!("+e.map(h=>`length(data(${h}))`).join(" || ")+") || ":"")+`(${g})`}function qO(a,b){const c=b.encoding;let d=b.field;if(!c&&!d)d=a.project.items[0].field,a.project.items.length>1&&L(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${P(d)}.`);else if(c&&!d){const e=a.project.items.filter(f=>f.channel===c);!e.length||e.length>1?(d=a.project.items[0].field,L((e.length?"Multiple ":"No ")+`matching ${P(c)} encoding found for selection ${P(b.selection)}. Using "field": ${P(d)}.`)):d=e[0].field}return`${a.name}[${P(d)}]`}function hia(a,b){hh(a,c=>{const d=c.name,e=a.getName(`lookup_${d}`);a.component.data.outputNodes[e]=c.materialized=new fc(new pl(b,a,{selection:d}),e,"lookup",a.component.data.outputNodeRefCounts)})}function gq(a,b,c){return Yk(b,d=>V(d)?d:ifa(d)?pO(a,d.selection,c):uM(d))}function iia(a,b){return a?J(a)&&!Nf(a)?a.map(c=>XM(c,b)).join(", "):a:void 0}function Ey(a,b,c,d){var e,f,g;a.encode=(e=a.encode)!==null&&e!==void 0?e:{},a.encode[b]=(f=a.encode[b])!==null&&f!==void 0?f:{},a.encode[b].update=(g=a.encode[b].update)!==null&&g!==void 0?g:{},a.encode[b].update[c]=d}function ql(a,b,c,d={header:!1}){var e,f;const g=a.combine(),{disable:h,orient:i,scale:j,labelExpr:k,title:l,zindex:m}=g,n=$(g,["disable","orient","scale","labelExpr","title","zindex"]);if(h)return;for(const o in n){const p=gda[o],q=n[o];if(p&&p!==b&&p!=="both")delete n[o];else if(sx(q)){const{condition:r}=q,s=$(q,["condition"]),t=T(r),w=yL[o];if(w){const{vgProp:v,part:x}=w,u=[...t.map(z=>{const{test:y}=z,B=$(z,["test"]);return Object.assign({test:gq(null,y)},B)}),s];Ey(n,x,v,u),delete n[o]}else if(w===null){const v={signal:t.map(x=>{const{test:u}=x,z=$(x,["test"]);return`${gq(null,u)} ? ${$M(z)} : `}).join("")+$M(s)};n[o]=v}}else if(ga(q)){const r=yL[o];if(r){const{vgProp:s,part:t}=r;Ey(n,t,s,q),delete n[o]}}}if(b==="grid"){if(!n.grid)return;if(n.encode){const{grid:o}=n.encode;n.encode=Object.assign({},o?{grid:o}:{}),Ha(n.encode)&&delete n.encode}return Object.assign(Object.assign({scale:j,orient:i},n),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:db(m,0)})}else{if(!d.header&&a.mainExtracted)return;if(k!==void 0){let p=k;((f=(e=n.encode)===null||e===void 0?void 0:e.labels)===null||f===void 0?void 0:f.update)&&ga(n.encode.labels.update.text)&&(p=zi(k,"datum.label",n.encode.labels.update.text.signal)),Ey(n,"labels","text",{signal:p})}n.labelAlign===null&&delete n.labelAlign;if(n.encode){for(const p of zL)a.hasAxisPart(p)||delete n.encode[p];Ha(n.encode)&&delete n.encode}const o=iia(l,c);return Object.assign(Object.assign(Object.assign(Object.assign({scale:j,orient:i,grid:!1},o?{title:o}:{}),n),c.aria===!1?{aria:!1}:{}),{zindex:db(m,0)})}}function rO(a){const{axes:b}=a.component,c=[];for(const d of cd)if(b[d]){for(const e of b[d])if(!e.get("disable")&&!e.get("gridScale")){const f=d==="x"?"height":"width",g=a.getSizeSignalRef(f).signal;f!==g&&c.push({name:f,update:g})}}return c}function jia(a,b){const{x:c=[],y:d=[]}=a;return[...c.map(e=>ql(e,"grid",b)),...d.map(e=>ql(e,"grid",b)),...c.map(e=>ql(e,"main",b)),...d.map(e=>ql(e,"main",b))].filter(e=>e)}const sO={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},tO={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},kia=O(sO),lia=O(tO);function uO(a,b,c,d){return Object.assign.apply(null,[{},...a.map(e=>{if(e==="axisOrient"){const f=c==="x"?"bottom":"left",g=b[c==="x"?"axisBottom":"axisLeft"]||{},h=b[c==="x"?"axisTop":"axisRight"]||{},i=new Set([...O(g),...O(h)]),j={};for(const k of i.values())j[k]={signal:`${d.signal} === "${f}" ? ${hl(g[k])} : ${hl(h[k])}`};return j}return b[e]})])}function mia(a,b,c,d){const e=b==="band"?["axisDiscrete","axisBand"]:b==="point"?["axisDiscrete","axisPoint"]:ufa(b)?["axisQuantitative"]:b==="time"||b==="utc"?["axisTemporal"]:[],f=a==="x"?"axisX":"axisY",g=ga(c)?"axisOrient":"axis"+rp(c),h=[...e,...e.map(j=>f+j.substr(4))],i=["axis",g,f];return{vlOnlyAxisConfig:uO(h,d,a,c),vgAxisConfig:uO(i,d,a,c),axisConfigStyle:nia([...i,...h],d)}}function nia(a,b){var c;const d=[{}];for(const e of a){let f=(c=b[e])===null||c===void 0?void 0:c.style;if(f){f=T(f);for(const g of f)d.push(b.style[g])}}return Object.assign.apply(null,d)}function Fy(a,b,c,d={}){var e;const f=bN(a,c,b.style);if(f!==void 0)return{configFrom:"style",configValue:f};for(const g of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((e=d[g])===null||e===void 0?void 0:e[a])!==void 0)return{configFrom:g,configValue:d[g][a]};return{}}const vO={scale:({model:a,channel:b})=>a.scaleName(b),format:({fieldOrDatumDef:a,config:b,axis:c})=>{const{format:d,formatType:e}=c;return GM(a,a.type,d,e,b,!0)},formatType:({axis:a,fieldOrDatumDef:b,scaleType:c})=>{const{formatType:d}=a;return HM(d,b,c)},grid:({fieldOrDatumDef:a,axis:b,scaleType:c})=>{var d;return R(a)&&dc(a.bin)?!1:(d=b.grid)!==null&&d!==void 0?d:oia(c,a)},gridScale:({model:a,channel:b})=>pia(a,b),labelAlign:({axis:a,labelAngle:b,orient:c,channel:d})=>a.labelAlign||xO(b,c,d),labelAngle:({labelAngle:a})=>a,labelBaseline:({axis:a,labelAngle:b,orient:c,channel:d})=>a.labelBaseline||wO(b,c,d),labelFlush:({axis:a,fieldOrDatumDef:b,channel:c})=>{var d;return(d=a.labelFlush)!==null&&d!==void 0?d:ria(b.type,c)},labelOverlap:({axis:a,fieldOrDatumDef:b,scaleType:c})=>{var d;return(d=a.labelOverlap)!==null&&d!==void 0?d:sia(b.type,c)},orient:({orient:a})=>a,tickCount:({channel:a,model:b,axis:c,fieldOrDatumDef:d,scaleType:e})=>{var f;const g=a==="x"?"width":a==="y"?"height":void 0,h=g?b.getSizeSignalRef(g):void 0;return(f=c.tickCount)!==null&&f!==void 0?f:uia({fieldOrDatumDef:d,scaleType:e,size:h,values:c.values})},title:({axis:a,model:b,channel:c})=>{if(a.title!==void 0)return a.title;const d=yO(b,c);if(d!==void 0)return d;const e=b.typedFieldDef(c),f=c==="x"?"x2":"y2",g=b.fieldDef(f);return dN(e?[OM(e)]:[],R(g)?[OM(g)]:[])},values:({axis:a,fieldOrDatumDef:b})=>via(a,b),zindex:({axis:a,fieldOrDatumDef:b,mark:c})=>{var d;return(d=a.zindex)!==null&&d!==void 0?d:wia(c,b)}};function oia(a,b){return!yc(a)&&R(b)&&!Ia(b===null||b===void 0?void 0:b.bin)}function pia(a,b){const c=b==="x"?"y":"x";return a.getScaleComponent(c)?a.scaleName(c):void 0}function qia(a,b,c,d,e){const f=b===null||b===void 0?void 0:b.labelAngle;if(f!==void 0)return ga(f)?f:sp(f);{const{configValue:g}=Fy("labelAngle",a.config,b===null||b===void 0?void 0:b.style,e);return g!==void 0?sp(g):c===Ta&&fa([Ox,Nx],d.type)?270:void 0}}function Gy(a){return`(((${a.signal} % 360) + 360) % 360)`}function wO(a,b,c,d){if(a!==void 0)if(c==="x"){if(ga(a)){const e=Gy(a),f=ga(b)?`(${b.signal} === "top")`:b==="top";return{signal:`(45 < ${e} && ${e} < 135) || (225 < ${e} && ${e} < 315) ? "middle" :(${e} <= 45 || 315 <= ${e}) === ${f} ? "bottom" : "top"`}}if(45<a&&a<135||225<a&&a<315)return"middle";if(ga(b)){const e=a<=45||315<=a?"===":"!==";return{signal:`${b.signal} ${e} "top" ? "bottom" : "top"`}}return(a<=45||315<=a)===(b==="top")?"bottom":"top"}else{if(ga(a)){const e=Gy(a),f=ga(b)?`(${b.signal} === "left")`:b==="left",g=d?'"middle"':"null";return{signal:`${e} <= 45 || 315 <= ${e} || (135 <= ${e} && ${e} <= 225) ? ${g} : (45 <= ${e} && ${e} <= 135) === ${f} ? "top" : "bottom"`}}if(a<=45||315<=a||135<=a&&a<=225)return d?"middle":null;if(ga(b)){const e=45<=a&&a<=135?"===":"!==";return{signal:`${b.signal} ${e} "left" ? "top" : "bottom"`}}return(45<=a&&a<=135)===(b==="left")?"top":"bottom"}return}function xO(a,b,c){if(a===void 0)return;const d=c==="x",e=d?0:90,f=d?"bottom":"left";if(ga(a)){const g=Gy(a),h=ga(b)?`(${b.signal} === "${f}")`:b===f;return{signal:`(${e?"("+g+" + 90)":g} % 180 === 0) ? ${d?null:'"center"'} :(${e} < ${g} && ${g} < ${180+e}) === ${h} ? "left" : "right"`}}if((a+e)%180===0)return d?null:"center";if(ga(b)){const g=e<a&&a<180+e?"===":"!==",h=`${b.signal} ${g} "${f}"`;return{signal:`${h} ? "left" : "right"`}}return(e<a&&a<180+e)===(b===f)?"left":"right"}function ria(a,b){return b==="x"&&fa(["quantitative","temporal"],a)?!0:void 0}function sia(a,b){return a!=="nominal"?b==="log"?"greedy":!0:void 0}function tia(a){return a==="x"?"bottom":"left"}function uia({fieldOrDatumDef:a,scaleType:b,size:c,values:d}){var e;if(!d&&!yc(b)&&b!=="log"){if(R(a)){if(Ia(a.bin))return{signal:`ceil(${c.signal}/10)`};if(a.timeUnit&&fa(["month","hours","day","quarter"],(e=ec(a.timeUnit))===null||e===void 0?void 0:e.unit))return}return{signal:`ceil(${c.signal}/40)`}}return}function yO(a,b){const c=b==="x"?"x2":"y2",d=a.fieldDef(b),e=a.fieldDef(c),f=d?d.title:void 0,g=e?e.title:void 0;if(f&&g)return eN(f,g);{if(f)return f;{if(g)return g;{if(f!==void 0)return f;if(g!==void 0)return g}}}return}function via(a,b){const c=a.values;return J(c)?ZM(b,c):ga(c)?c:void 0}function wia(a,b){return a==="rect"&&SM(b)?1:0}class rl extends Ea{constructor(a,b){super(a);this.transform=b,this._dependentFields=oO(this.transform.calculate)}clone(){return new rl(null,oa(this.transform))}static parseAllForSortIndex(a,b){return b.forEachFieldDef((c,d)=>{if(!Zx(c))return;if(NM(c.sort)){const{field:e,timeUnit:f}=c,g=c.sort,h=g.map((i,j)=>`${uM({field:e,timeUnit:f,equal:i})} ? ${j} : `).join("")+g.length;a=new rl(a,{calculate:h,as:Ii(c,d,{forAs:!0})})}}),a}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${ua(this.transform)}`}}function Ii(a,b,c){return Q(a,Object.assign({prefix:b,suffix:"sort_index"},c!==null&&c!==void 0?c:{}))}function hq(a,b){return fa(["top","bottom"],b)?"column":fa(["left","right"],b)?"row":a==="row"?"row":"column"}function Ji(a,b,c,d){const e=d==="row"?c.headerRow:d==="column"?c.headerColumn:c.headerFacet;return db(((b===null||b===void 0?void 0:b.header)||{})[a],e[a],c.header[a])}function iq(a,b,c,d){const e={};for(const f of a){const g=Ji(f,b,c,d);g!==void 0&&(e[f]=g)}return e}const Hy=["row","column"],Iy=["header","footer"];function xia(a,b){const c=a.component.layoutHeaders[b].title,d=a.config?a.config:void 0,e=a.component.layoutHeaders[b].facetFieldDef?a.component.layoutHeaders[b].facetFieldDef:void 0,{titleAnchor:f,titleAngle:g,titleOrient:h}=iq(["titleAnchor","titleAngle","titleOrient"],e,d,b),i=hq(b,h),j=sp(g);return{name:`${b}-title`,type:"group",role:`${i}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:c},b==="row"?{orient:"left"}:{}),{style:"guide-title"}),AO(j,i)),zO(i,j,f)),BO(d,e,b,kia,sO))}}function zO(a,b,c="middle"){switch(c){case"start":return{align:"left"};case"end":return{align:"right"}}const d=xO(b,a==="row"?"left":"top",a==="row"?"y":"x");return d?{align:d}:{}}function AO(a,b){const c=wO(a,b==="row"?"left":"top",b==="row"?"y":"x",!0);return c?{baseline:c}:{}}function yia(a,b){const c=a.component.layoutHeaders[b],d=[];for(const e of Iy)if(c[e])for(const f of c[e]){const g=Aia(a,b,e,c,f);g!=null&&d.push(g)}return d}function zia(a,b){var c;const{sort:d}=a;return he(d)?{field:Q(d,{expr:"datum"}),order:(c=d.order)!==null&&c!==void 0?c:"ascending"}:J(d)?{field:Ii(a,b,{expr:"datum"}),order:"ascending"}:{field:Q(a,{expr:"datum"}),order:d!==null&&d!==void 0?d:"ascending"}}function Jy(a,b,c){const{format:d,formatType:e,labelAngle:f,labelAnchor:g,labelOrient:h,labelExpr:i}=iq(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],a,c,b),j=Sx({fieldOrDatumDef:a,format:d,formatType:e,expr:"parent",config:c}).signal,k=hq(b,h);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:i?zi(zi(i,"datum.label",j),"datum.value",Q(a,{expr:"parent"})):j}},b==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),AO(f,k)),zO(k,f,g)),BO(c,a,b,lia,tO))}function Aia(a,b,c,d,e){if(e){let f=null;const{facetFieldDef:g}=d,h=a.config?a.config:void 0;if(g&&e.labels){const{labelOrient:l}=iq(["labelOrient"],g,h,b);(b==="row"&&!fa(["top","bottom"],l)||b==="column"&&!fa(["left","right"],l))&&(f=Jy(g,b,h))}const i=Cd(a)&&!el(a.facet),j=e.axes,k=(j===null||j===void 0?void 0:j.length)>0;if(f||k){const l=b==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a.getName(`${b}_${c}`),type:"group",role:`${b}-${c}`},d.facetFieldDef?{from:{data:a.getName(b+"_domain")},sort:zia(g,b)}:{}),k&&i?{from:{data:a.getName(`facet_domain_${b}`)}}:{}),f?{title:f}:{}),e.sizeSignal?{encode:{update:{[l]:e.sizeSignal}}}:{}),k?{axes:j}:{})}}return null}const Bia={column:{start:0,end:1},row:{start:1,end:0}};function Cia(a,b){return Bia[b][a]}function Dia(a,b){const c={};for(const d of bd){const e=a[d];if(e===null||e===void 0?void 0:e.facetFieldDef){const{titleAnchor:f,titleOrient:g}=iq(["titleAnchor","titleOrient"],e.facetFieldDef,b,d),h=hq(d,g),i=Cia(f,h);i!==void 0&&(c[h]=i)}}return Ha(c)?void 0:c}function BO(a,b,c,d,e){const f={};for(const g of d){if(!e[g])continue;const h=Ji(g,b,a,c);h!==void 0&&(f[e[g]]=h)}return f}function Ky(a){return[...jq(a,"width"),...jq(a,"height"),...jq(a,"childWidth"),...jq(a,"childHeight")]}function jq(a,b){const c=b==="width"?"x":"y",d=a.component.layoutSize.get(b);if(!d||d==="merged")return[];const e=a.getSizeSignalRef(b).signal;if(d==="step"){const f=a.getScaleComponent(c);if(f){const g=f.get("type"),h=f.get("range");if(yc(g)&&Jf(h)){const i=a.scaleName(c);if(Cd(a.parent)){const j=a.parent.component.resolve;if(j.scale[c]==="independent")return[CO(i,h)]}return[CO(i,h),{name:e,update:DO(i,f,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(d=="container"){const f=e.endsWith("width"),g=f?"containerSize()[0]":"containerSize()[1]",h=oy(a.config.view,f?"width":"height"),i=`isFinite(${g}) ? ${g} : ${h}`;return[{name:e,init:i,on:[{update:i,events:"window:resize"}]}]}else return[{name:e,value:d}]}function CO(a,b){return{name:a+"_step",value:b.step}}function DO(a,b,c){const d=b.get("type"),e=b.get("padding"),f=db(b.get("paddingOuter"),e);let g=b.get("paddingInner");return g=d==="band"?g!==void 0?g:e:1,`bandspace(${c}, ${g}, ${f}) * ${a}_step`}function EO(a){return a==="childWidth"?"width":a==="childHeight"?"height":a}function FO(a,b){return O(a).reduce((c,d)=>{const e=a[d];return Object.assign(Object.assign({},c),kl(b,e,d,f=>ga(f)?f:{value:f.value}))},{})}function Eia(a,b){if(Ni(b)||Cd(b))return"shared";if(Xy(b))return fe(a)?"independent":"shared";throw new Error("invalid model type for resolve")}function Ly(a,b){const c=a.scale[b],d=fe(b)?"axis":"legend";return c==="independent"?(a[d][b]==="shared"&&L(Bea(b)),"independent"):a[d][b]||"shared"}const Fia=Object.assign(Object.assign({},uga),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),GO=O(Fia);class Gia extends Of{}const HO={symbols:Hia,gradient:Iia,labels:Jia,entries:Kia};function Hia(a,{fieldOrDatumDef:b,model:c,channel:d,legendCmpt:e,legendType:f}){var g,h,i,j,k;if(f!=="symbol")return;const{markDef:l,encoding:m,config:n,mark:o}=c,p=l.filled&&o!=="trail";let q=Object.assign(Object.assign({},$fa({},c,nda)),VN(c,{filled:p}));const r=(g=IO(m.opacity))!==null&&g!==void 0?g:l.opacity;if(q.fill){if(d==="fill"||p&&d===wc)delete q.fill;else if(q.fill.field)e.get("symbolFillColor")?delete q.fill:(q.fill=ab((h=n.legend.symbolBaseFillColor)!==null&&h!==void 0?h:"black"),q.fillOpacity=ab(r!==null&&r!==void 0?r:1));else if(J(q.fill)){const s=(k=(j=My((i=m.fill)!==null&&i!==void 0?i:m.color))!==null&&j!==void 0?j:l.fill)!==null&&k!==void 0?k:p&&l.color;s&&(q.fill=ab(s))}}if(q.stroke){if(d==="stroke"||!p&&d===wc)delete q.stroke;else if(q.stroke.field)delete q.stroke;else if(J(q.stroke)){const s=db(My(m.stroke||m.color),l.stroke,p?l.color:void 0);s&&(q.stroke={value:s})}}if(d!==Oe){const s=R(b)&&KO(c,e,b);s?q.opacity=[Object.assign({test:s},ab(r!==null&&r!==void 0?r:1)),ab(n.legend.unselectedOpacity)]:r&&(q.opacity=ab(r))}return q=Object.assign(Object.assign({},q),a),Ha(q)?void 0:q}function Iia(a,{model:b,legendType:c}){if(c!=="gradient")return;let d={};const e=IO(b.encoding.opacity)||b.markDef.opacity;return e&&(d.opacity=ab(e)),d=Object.assign(Object.assign({},d),a),Ha(d)?void 0:d}function Jia(a,{fieldOrDatumDef:b,model:c,channel:d,legendCmpt:e}){const f=c.legend(d)||{},g=c.config,h=R(b)?KO(c,e,b):void 0,i=h?[{test:h,value:1},{value:g.legend.unselectedOpacity}]:void 0,{format:j,formatType:k}=f,l=$g(k)?Tx({fieldOrDatumDef:b,field:"datum.value",format:j,formatType:k,config:g}):void 0,m=Object.assign(Object.assign(Object.assign({},i?{opacity:i}:{}),l?{text:l}:{}),a);return Ha(m)?void 0:m}function Kia(a,{legendCmpt:b}){const c=b.get("selections");return(c===null||c===void 0?void 0:c.length)?Object.assign(Object.assign({},a),{fill:{value:"transparent"}}):a}function IO(a){return JO(a,(b,c)=>Math.max(b,c.value))}function My(a){return JO(a,(b,c)=>db(b,c.value))}function JO(a,b){return Rfa(a)?T(a.condition).reduce(b,a.value):Pe(a)?a.value:void 0}function KO(a,b,c){const d=b.get("selections");if(!(d===null||d===void 0?void 0:d.length))return;const e=P(c.field);return d.map(f=>{const g=P(Pa(f)+gh);return`(!length(data(${g})) || (${f}[${e}] && indexof(${f}[${e}], datum.value) >= 0))`}).join(" || ")}const LO={direction:({direction:a})=>a,format:({fieldOrDatumDef:a,legend:b,config:c})=>{const{format:d,formatType:e}=b;return GM(a,a.type,d,e,c,!1)},formatType:({legend:a,fieldOrDatumDef:b,scaleType:c})=>{const{formatType:d}=a;return HM(d,b,c)},gradientLength:a=>{var b,c;const{legend:d,legendConfig:e}=a;return(c=(b=d.gradientLength)!==null&&b!==void 0?b:e.gradientLength)!==null&&c!==void 0?c:Ria(a)},labelOverlap:({legend:a,legendConfig:b,scaleType:c})=>{var d,e;return(e=(d=a.labelOverlap)!==null&&d!==void 0?d:b.labelOverlap)!==null&&e!==void 0?e:Sia(c)},symbolType:({legend:a,markDef:b,channel:c,encoding:d})=>{var e;return(e=a.symbolType)!==null&&e!==void 0?e:Mia(b.type,c,d.shape,b.shape)},title:({fieldOrDatumDef:a,config:b})=>ah(a,b,{allowDisabling:!0}),type:({legendType:a,scaleType:b,channel:c})=>{if(Ai(c)&&Ad(b)){if(a==="gradient")return}else if(a==="symbol")return;return a},values:({fieldOrDatumDef:a,legend:b})=>Lia(b,a)};function Lia(a,b){const c=a.values;return J(c)?ZM(b,c):ga(c)?c:void 0}function Mia(a,b,c,d){var e;if(b!=="shape"){const f=(e=My(c))!==null&&e!==void 0?e:d;if(f)return f}switch(a){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Nia(a){const{legend:b}=a;return db(b.type,Oia(a))}function Oia({channel:a,timeUnit:b,scaleType:c}){if(Ai(a)){if(fa(["quarter","month","day"],b))return"symbol";if(Ad(c))return"gradient"}return"symbol"}function Pia({legendConfig:a,legendType:b,orient:c,legend:d}){var e,f;return(f=(e=d.direction)!==null&&e!==void 0?e:a[b?"gradientDirection":"symbolDirection"])!==null&&f!==void 0?f:Qia(c,b)}function Qia(a,b){switch(a){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return b==="gradient"?"horizontal":void 0}}function Ria({legendConfig:a,model:b,direction:c,orient:d,scaleType:e}){const{gradientHorizontalMaxLength:f,gradientHorizontalMinLength:g,gradientVerticalMaxLength:h,gradientVerticalMinLength:i}=a;return Ad(e)?c==="horizontal"?d==="top"||d==="bottom"?MO(b,"width",g,f):g:MO(b,"height",i,h):void 0}function MO(a,b,c,d){const e=a.getSizeSignalRef(b).signal;return{signal:`clamp(${e}, ${c}, ${d})`}}function Sia(a){return fa(["quantile","threshold","log"],a)?"greedy":void 0}function NO(a){const b=Xa(a)?Tia(a):Xia(a);return a.component.legends=b,b}function Tia(a){const{encoding:b}=a,c={};for(const d of[wc,...uN]){const e=kb(b[d]);if(!e||!a.getScaleComponent(d))continue;if(d===xc&&R(e)&&e.type===Fi)continue;c[d]=Wia(a,d)}return c}function Uia(a,b){const c=a.scaleName(b);if(a.mark==="trail"){if(b==="color")return{stroke:c};if(b==="size")return{strokeWidth:c}}return b==="color"?a.markDef.filled?{fill:c}:{stroke:c}:{[b]:c}}function Via(a,b,c,d){switch(b){case"disable":return c!==void 0;case"values":return!!(c===null||c===void 0?void 0:c.values);case"title":if(b==="title"&&a===(d===null||d===void 0?void 0:d.title))return!0}return a===(c||{})[b]}function Wia(a,b){var c,d,e;let f=a.legend(b);const{markDef:g,encoding:h,config:i}=a,j=i.legend,k=new Gia({},Uia(a,b));Rha(a,b,k);const l=f!==void 0?!f:j.disable;k.set("disable",l,f!==void 0);if(l)return k;f=f||{};const m=a.getScaleComponent(b).get("type"),n=kb(h[b]),o=R(n)?(c=ec(n.timeUnit))===null||c===void 0?void 0:c.unit:void 0,p=f.orient||i.legend.orient||"right",q=Nia({legend:f,channel:b,timeUnit:o,scaleType:m}),r=Pia({legend:f,legendType:q,orient:p,legendConfig:j}),s={legend:f,channel:b,model:a,markDef:g,encoding:h,fieldOrDatumDef:n,legendConfig:j,config:i,scaleType:m,orient:p,legendType:q,direction:r};for(const u of GO){const z=u in LO?LO[u](s):f[u];if(z!==void 0){const y=Via(z,u,f,a.fieldDef(b));(y||i.legend[u]===void 0)&&k.set(u,z,y)}}const t=(d=f===null||f===void 0?void 0:f.encoding)!==null&&d!==void 0?d:{},w=k.get("selections"),v={},x={fieldOrDatumDef:n,model:a,channel:b,legendCmpt:k,legendType:q};for(const u of["labels","legend","title","symbols","gradient","entries"]){const z=FO((e=t[u])!==null&&e!==void 0?e:{},a),y=u in HO?HO[u](z,x):z;y!==void 0&&!Ha(y)&&(v[u]=Object.assign(Object.assign(Object.assign({},(w===null||w===void 0?void 0:w.length)&&R(n)?{name:`${Pa(n.field)}_legend_${u}`}:{}),(w===null||w===void 0?void 0:w.length)?{interactive:!!w}:{}),{update:y}))}return Ha(v)||k.set("encode",v,!!(f===null||f===void 0?void 0:f.encoding)),k}function Xia(a){const{legends:b,resolve:c}=a.component;for(const d of a.children){NO(d);for(const e of O(d.component.legends))c.legend[e]=Ly(a.component.resolve,e),c.legend[e]==="shared"&&(b[e]=OO(b[e],d.component.legends[e]),b[e]||(c.legend[e]="independent",delete b[e]))}for(const d of O(b))for(const e of a.children){if(!e.component.legends[d])continue;c.legend[d]==="shared"&&delete e.component.legends[d]}return b}function OO(a,b){var c,d,e,f;if(!a)return b.clone();const g=a.getWithExplicit("orient"),h=b.getWithExplicit("orient");if(g.explicit&&h.explicit&&g.value!==h.value)return;let i=!1;for(const j of GO){const k=Pf(a.getWithExplicit(j),b.getWithExplicit(j),j,"legend",(l,m)=>{switch(j){case"symbolType":return Yia(l,m);case"title":return fN(l,m);case"type":return i=!0,Mc("symbol")}return _p(l,m,j,"legend")});a.setWithExplicit(j,k)}return i&&(((d=(c=a.implicit)===null||c===void 0?void 0:c.encode)===null||d===void 0?void 0:d.gradient)&&qx(a.implicit,["encode","gradient"]),((f=(e=a.explicit)===null||e===void 0?void 0:e.encode)===null||f===void 0?void 0:f.gradient)&&qx(a.explicit,["encode","gradient"])),a}function Yia(a,b){return b.value==="circle"?b:a}function PO(a,b,c,d){var e,f,g;a.encode=(e=a.encode)!==null&&e!==void 0?e:{},a.encode[b]=(f=a.encode[b])!==null&&f!==void 0?f:{},a.encode[b].update=(g=a.encode[b].update)!==null&&g!==void 0?g:{},a.encode[b].update[c]=d}function QO(a){const b=a.component.legends,c={};for(const e of O(b)){const f=a.getScaleComponent(e),g=Oa(f.get("domains"));if(c[g])for(const h of c[g]){const i=OO(h,b[e]);i||c[g].push(b[e])}else c[g]=[b[e].clone()]}const d=zf(c).flat().map(e=>Zia(e,a.config)).filter(e=>e!==void 0);return d}function Zia(a,b){var c,d,e;const f=a.combine(),{disable:g,labelExpr:h,selections:i}=f,j=$(f,["disable","labelExpr","selections"]);if(g)return;b.aria===!1&&j.aria==void 0&&(j.aria=!1);if((c=j.encode)===null||c===void 0?void 0:c.symbols){const k=j.encode.symbols.update;k.fill&&k.fill.value!=="transparent"&&!k.stroke&&!j.stroke&&(k.stroke={value:"transparent"});for(const l of uN)j[l]&&delete k[l]}j.title||delete j.title;if(h!==void 0){let k=h;((e=(d=j.encode)===null||d===void 0?void 0:d.labels)===null||e===void 0?void 0:e.update)&&ga(j.encode.labels.update.text)&&(k=zi(h,"datum.label",j.encode.labels.update.text.signal)),PO(j,"labels","text",{signal:k})}for(const k in j){const l=j[k];if(ga(l)){const m=sga[k];if(m){const{vgProp:n,part:o}=m;PO(j,o,n,l),delete j[k]}}}return j}function _ia(a){return Ni(a)||Xy(a)?$ia(a):RO(a)}function $ia(a){return a.children.reduce((b,c)=>b.concat(c.assembleProjections()),RO(a))}function RO(a){const b=a.component.projection;if(!b||b.merged)return[];const c=b.combine(),{name:d}=c;if(b.data){const e={signal:`[${b.size.map(g=>g.signal).join(", ")}]`},f=b.data.reduce((g,h)=>{const i=ga(h)?h.signal:`data('${a.lookupDataSource(h)}')`;return fa(g,i)||g.push(i),g},[]);if(f.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:d,size:e,fit:{signal:f.length>1?`[${f.join(", ")}]`:f[0]}},c)]}else return[Object.assign(Object.assign({name:d},{translate:{signal:"[width / 2, height / 2]"}}),c)]}const aja=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class SO extends Of{constructor(a,b,c,d){super(Object.assign({},b),{name:a});this.specifiedProjection=b,this.size=c,this.data=d,this.merged=!1}get isFit(){return!!this.data}}function TO(a){a.component.projection=Xa(a)?bja(a):eja(a)}function bja(a){var b;if(a.hasProjection){const c=a.specifiedProjection,d=!(c&&(c.scale!=null||c.translate!=null)),e=d?[a.getSizeSignalRef("width"),a.getSizeSignalRef("height")]:void 0,f=d?cja(a):void 0;return new SO(a.projectionName(!0),Object.assign(Object.assign({},(b=a.config.projection)!==null&&b!==void 0?b:{}),c!==null&&c!==void 0?c:{}),e,f)}return}function cja(a){const b=[],{encoding:c}=a;for(const d of[[ae,$d],[ad,zd]])(kb(c[d[0]])||kb(c[d[1]]))&&b.push({signal:a.getName(`geojson_${b.length}`)});return a.channelHasField(xc)&&a.typedFieldDef(xc).type===Fi&&b.push({signal:a.getName(`geojson_${b.length}`)}),b.length===0&&b.push(a.requestDataName(Pb)),b}function dja(a,b){const c=rL(aja,e=>!_(a.explicit,e)&&!_(b.explicit,e)?!0:_(a.explicit,e)&&_(b.explicit,e)&&Oa(a.get(e))===Oa(b.get(e))?!0:!1),d=Oa(a.size)===Oa(b.size);if(d){if(c)return a;{if(Oa(a.explicit)===Oa({}))return b;if(Oa(b.explicit)===Oa({}))return a}}return null}function eja(a){if(a.children.length===0)return;let b;for(const d of a.children)TO(d);const c=rL(a.children,d=>{const e=d.component.projection;if(e)if(b){const f=dja(b,e);return f&&(b=f),!!f}else return b=e,!0;else return!0});if(b&&c){const d=a.projectionName(!0),e=new SO(d,b.specifiedProjection,b.size,oa(b.data));for(const f of a.children){const g=f.component.projection;g&&(g.isFit&&e.data.push(...f.component.projection.data),f.renameProjection(g.get("name"),d),g.merged=!0)}return e}return}function fja(a,b,c,d){var e,f;if(gl(b,c)){const g=Xa(a)?(f=(e=a.axis(c))!==null&&e!==void 0?e:a.legend(c))!==null&&f!==void 0?f:{}:{},h=Q(b,{expr:"datum"}),i=Q(b,{expr:"datum",binSuffix:"end"});return{formulaAs:Q(b,{binSuffix:"range",forAs:!0}),formula:Mp(h,i,g.format,g.formatType,d)}}return{}}function UO(a,b){return`${UL(a)}_${b}`}function gja(a,b){return{signal:a.getName(`${b}_bins`),extentSignal:a.getName(`${b}_extent`)}}function Ny(a,b,c){var d;const e=(d=Sp(c,void 0))!==null&&d!==void 0?d:{},f=UO(e,b);return a.getName(`${f}_bins`)}function hja(a){return"as"in a}function VO(a,b,c){let d,e;hja(a)?d=V(a.as)?[a.as,`${a.as}_end`]:[a.as[0],a.as[1]]:d=[Q(a,{forAs:!0}),Q(a,{binSuffix:"end",forAs:!0})];const f=Object.assign({},Sp(b,void 0)),g=UO(f,a.field),{signal:h,extentSignal:i}=gja(c,g);if(Hp(f.extent)){const k=f.extent,l=k.selection;e=qO(c.getSelectionComponent(Pa(l),l),k),delete f.extent}const j=Object.assign(Object.assign(Object.assign({bin:f,field:a.field,as:[d]},h?{signal:h}:{}),i?{extentSignal:i}:{}),e?{span:e}:{});return{key:g,binComponent:j}}class Te extends Ea{constructor(a,b){super(a);this.bins=b}clone(){return new Te(null,oa(this.bins))}static makeFromEncoding(a,b){const c=b.reduceFieldDef((d,e,f)=>{if(Lc(e)&&Ia(e.bin)){const{key:g,binComponent:h}=VO(e,e.bin,b);d[g]=Object.assign(Object.assign(Object.assign({},h),d[g]),fja(b,e,f,b.config))}return d},{});return Ha(c)?null:new Te(a,c)}static makeFromTransform(a,b,c){const{key:d,binComponent:e}=VO(b,b.bin,c);return new Te(a,{[d]:e})}merge(a,b){for(const c of O(a.bins))c in this.bins?(b(a.bins[c].signal,this.bins[c].signal),this.bins[c].as=yf([...this.bins[c].as,...a.bins[c].as],ua)):this.bins[c]=a.bins[c];for(const c of a.children)a.removeChild(c),c.parent=this;a.remove()}producedFields(){return new Set(zf(this.bins).map(a=>a.as).flat(2))}dependentFields(){return new Set(zf(this.bins).map(a=>a.field))}hash(){return`Bin ${ua(this.bins)}`}assemble(){return zf(this.bins).flatMap(a=>{const b=[],[c,...d]=a.as,e=a.bin,{extent:f}=e,g=$(e,["extent"]),h=Object.assign(Object.assign(Object.assign({type:"bin",field:Af(a.field),as:c,signal:a.signal},Hp(f)?{extent:null}:{extent:f}),a.span?{span:{signal:`span(${a.span})`}}:{}),g);!f&&a.extentSignal&&(b.push({type:"extent",field:Af(a.field),signal:a.extentSignal}),h.extent={signal:a.extentSignal}),b.push(h);for(const i of d)for(let j=0;j<2;j++)b.push({type:"formula",expr:Q({field:c[j]},{expr:"datum"}),as:i[j]});return a.formula&&b.push({type:"formula",expr:a.formula,as:a.formulaAs}),b})}}class Ki extends Ea{constructor(a){super(null);a=a!==null&&a!==void 0?a:{name:"source"};let b;fh(a)||(b=a.format?Object.assign({},He(a.format,["parse"])):{});if($p(a))this._data={values:a.values};else if(jl(a)){this._data={url:a.url};if(!b.type){let c=/(?:\.([^.]+))?$/.exec(a.url)[1];fa(["json","csv","tsv","dsv","topojson"],c)||(c="json"),b.type=c}}else QN(a)?this._data={values:[{type:"Sphere"}]}:(ON(a)||fh(a))&&(this._data={});this._generator=fh(a),a.name&&(this._name=a.name),b&&!Ha(b)&&(this._data.format=b)}dependentFields(){return new Set()}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(a){this._name=a}set parent(a){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function Oy(a){for(const b of a){for(const c of b.children)if(c.parent!==b)return console.error("Dataflow graph is inconsistent.",b,c),!1;if(!Oy(b.children))return!1}return!0}class kq extends Ea{constructor(a,b){super(a);this.params=b}clone(){return new kq(null,this.params)}dependentFields(){return new Set()}producedFields(){return}hash(){return`Graticule ${ua(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class lq extends Ea{constructor(a,b){super(a);this.params=b}clone(){return new lq(null,this.params)}dependentFields(){return new Set()}producedFields(){var a;return new Set([(a=this.params.as)!==null&&a!==void 0?a:"data"])}hash(){return`Hash ${ua(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function mq(a){return a instanceof Ki||a instanceof kq||a instanceof lq}class WO{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Ue extends WO{constructor(){super();this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:a,mutatedFlag:b}){a&&this.setContinue(),b&&this.setMutated()}reset(){}optimizeNextFromLeaves(a){if(mq(a))return!1;const b=a.parent,{continueFlag:c}=this.run(a);return c&&this.optimizeNextFromLeaves(b),this.mutatedFlag}}class Py extends WO{}function ija(a,b,c,d){const e=Xa(d)?d.encoding[de(b)]:void 0;if(Lc(c)&&Xa(d)&&Vx(b,c,e,d.stack,d.markDef,d.config))a.add(Q(c,{})),a.add(Q(c,{suffix:"end"})),c.bin&&gl(c,b)&&a.add(Q(c,{binSuffix:"range"}));else if(Fda(b)){const f=Eda(b);a.add(d.getName(f))}else a.add(Q(c));return a}function jja(a,b){var c;for(const d of O(b)){const e=b[d];for(const f of O(e))d in a?a[d][f]=new Set([...(c=a[d][f])!==null&&c!==void 0?c:[],...e[f]]):a[d]={[f]:e[f]}}}class me extends Ea{constructor(a,b,c){super(a);this.dimensions=b,this.measures=c}clone(){return new me(null,new Set(this.dimensions),oa(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(a,b){let c=!1;b.forEachFieldDef(f=>{f.aggregate&&(c=!0)});const d={},e=new Set();return c?(b.forEachFieldDef((f,g)=>{var h,i,j,k;const{aggregate:l,field:m}=f;if(l)if(l==="count")d["*"]=(h=d["*"])!==null&&h!==void 0?h:{},d["*"].count=new Set([Q(f,{forAs:!0})]);else{if(Bf(l)||Vg(l)){const n=Bf(l)?"argmin":"argmax",o=l[n];d[o]=(i=d[o])!==null&&i!==void 0?i:{},d[o][n]=new Set([Q({op:n,field:o},{forAs:!0})])}else d[m]=(j=d[m])!==null&&j!==void 0?j:{},d[m][l]=new Set([Q(f,{forAs:!0})]);If(g)&&b.scaleDomain(g)==="unaggregated"&&(d[m]=(k=d[m])!==null&&k!==void 0?k:{},d[m].min=new Set([Q({field:m,aggregate:"min"},{forAs:!0})]),d[m].max=new Set([Q({field:m,aggregate:"max"},{forAs:!0})]))}else ija(e,g,f,b)}),e.size+O(d).length===0?null:new me(a,e,d)):null}static makeFromTransform(a,b){var c,d,e;const f=new Set(),g={};for(const h of b.aggregate){const{op:i,field:j,as:k}=h;i&&(i==="count"?(g["*"]=(c=g["*"])!==null&&c!==void 0?c:{},g["*"].count=new Set([k?k:Q(h,{forAs:!0})])):(g[j]=(d=g[j])!==null&&d!==void 0?d:{},g[j][i]=new Set([k?k:Q(h,{forAs:!0})])))}for(const h of(e=b.groupby)!==null&&e!==void 0?e:[])f.add(h);return f.size+O(g).length===0?null:new me(a,f,g)}merge(a){return $ca(this.dimensions,a.dimensions)?(jja(this.measures,a.measures),!0):(Rea("different dimensions, cannot merge"),!1)}addDimensions(a){a.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...O(this.measures)])}producedFields(){const a=new Set();for(const b of O(this.measures))for(const c of O(this.measures[b])){const d=this.measures[b][c];d.size===0?a.add(`${c}_${b}`):d.forEach(a.add,a)}return a}hash(){return`Aggregate ${ua({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const a=[],b=[],c=[];for(const e of O(this.measures))for(const f of O(this.measures[e]))for(const g of this.measures[e][f])c.push(g),a.push(f),b.push(e==="*"?null:Af(e));const d={type:"aggregate",groupby:[...this.dimensions].map(Af),ops:a,fields:b,as:c};return d}}class Li extends Ea{constructor(a,b,c,d){super(a);this.model=b,this.name=c,this.data=d;for(const e of bd){const f=b.facet[e];if(f){const{bin:g,sort:h}=f;this[e]=Object.assign({name:b.getName(`${e}_domain`),fields:[Q(f),...Ia(g)?[Q(f,{binSuffix:"end"})]:[]]},he(h)?{sortField:h}:J(h)?{sortIndexField:Ii(f,e)}:{})}}this.childModel=b.child}hash(){let a="Facet";for(const b of bd)this[b]&&(a+=` ${b.charAt(0)}:${ua(this[b])}`);return a}get fields(){var a;const b=[];for(const c of bd)((a=this[c])===null||a===void 0?void 0:a.fields)&&b.push(...this[c].fields);return b}dependentFields(){const a=new Set(this.fields);for(const b of bd)this[b]&&(this[b].sortField&&a.add(this[b].sortField.field),this[b].sortIndexField&&a.add(this[b].sortIndexField));return a}producedFields(){return new Set()}getSource(){return this.name}getChildIndependentFieldsWithStep(){const a={};for(const b of cd){const c=this.childModel.component.scales[b];if(c&&!c.merged){const d=c.get("type"),e=c.get("range");if(yc(d)&&Jf(e)){const f=oq(this.childModel,b),g=Vy(f);g?a[b]=g:L(`Unknown field for ${b}. Cannot calculate view size.`)}}}return a}assembleRowColumnHeaderData(a,b,c){const d={row:"y",column:"x"}[a],e=[],f=[],g=[];c&&c[d]&&(b?(e.push(`distinct_${c[d]}`),f.push("max")):(e.push(c[d]),f.push("distinct")),g.push(`distinct_${c[d]}`));const{sortField:h,sortIndexField:i}=this[a];if(h){const{op:j=Np,field:k}=h;e.push(k),f.push(j),g.push(Q(h,{forAs:!0}))}else i&&(e.push(i),f.push("max"),g.push(i));return{name:this[a].name,source:b!==null&&b!==void 0?b:this.data,transform:[Object.assign({type:"aggregate",groupby:this[a].fields},e.length?{fields:e,ops:f,as:g}:{})]}}assembleFacetHeaderData(a){var b,c;const{columns:d}=this.model.layout,{layoutHeaders:e}=this.model.component,f=[],g={};for(const j of Hy){for(const k of Iy){const l=(b=e[j]&&e[j][k])!==null&&b!==void 0?b:[];for(const m of l)if(((c=m.axes)===null||c===void 0?void 0:c.length)>0){g[j]=!0;break}}if(g[j]){const k=`length(data("${this.facet.name}"))`,l=j==="row"?d?{signal:`ceil(${k} / ${d})`}:1:d?{signal:`min(${k}, ${d})`}:{signal:k};f.push({name:`${this.facet.name}_${j}`,transform:[{type:"sequence",start:0,stop:l}]})}}const{row:h,column:i}=g;return(h||i)&&f.unshift(this.assembleRowColumnHeaderData("facet",null,a)),f}assemble(){var a,b;const c=[];let d=null;const e=this.getChildIndependentFieldsWithStep(),{column:f,row:g,facet:h}=this;if(f&&g&&(e.x||e.y)){d=`cross_${this.column.name}_${this.row.name}`;const i=[].concat((a=e.x)!==null&&a!==void 0?a:[],(b=e.y)!==null&&b!==void 0?b:[]),j=i.map(()=>"distinct");c.push({name:d,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:i,ops:j}]})}for(const i of[Ke,Je])this[i]&&c.push(this.assembleRowColumnHeaderData(i,d,e));if(h){const i=this.assembleFacetHeaderData(e);i&&c.push(...i)}return c}}function XO(a){return a[0]==="'"&&a[a.length-1]==="'"||a[0]==='"'&&a[a.length-1]==='"'?a.slice(1,-1):a}function kja(a,b){const c=wL(a);if(b==="number")return`toNumber(${c})`;{if(b==="boolean")return`toBoolean(${c})`;{if(b==="string")return`toString(${c})`;{if(b==="date")return`toDate(${c})`;{if(b==="flatten")return c;if(b.indexOf("date:")===0){const d=XO(b.slice(5,b.length));return`timeParse(${c},'${d}')`}else if(b.indexOf("utc:")===0){const d=XO(b.slice(4,b.length));return`utcParse(${c},'${d}')`}else return L(bea(b)),null}}}}}function lja(a){const b={};return op(a.filter,c=>{var d;if(tM(c)){let e=null;Jx(c)?e=c.equal:Kx(c)?e=c.range[0]:Lx(c)&&(e=((d=c.oneOf)!==null&&d!==void 0?d:c.in)[0]),e&&(Ci(e)?b[c.field]="date":Fa(e)?b[c.field]="number":V(e)&&(b[c.field]="string")),c.timeUnit&&(b[c.field]="date")}}),b}function mja(a){const b={};function c(d){Tp(d)?b[d.field]="date":d.type==="quantitative"&&zda(d.aggregate)?b[d.field]="number":Zk(d.field)>1?d.field in b||(b[d.field]="flatten"):Zx(d)&&he(d.sort)&&Zk(d.sort.field)>1&&(d.sort.field in b||(b[d.sort.field]="flatten"))}(Xa(a)||Cd(a))&&a.forEachFieldDef((d,e)=>{if(Lc(d))c(d);else{const f=Yg(e),g=a.fieldDef(f);c(Object.assign(Object.assign({},d),{type:g.type}))}});if(Xa(a)){const{mark:d,markDef:e,encoding:f}=a;if(Ug(d)&&!a.encoding.order){const g=e.orient==="horizontal"?"y":"x",h=f[g];R(h)&&h.type==="quantitative"&&!(h.field in b)&&(b[h.field]="number")}}return b}function nja(a){const b={};if(Xa(a)&&a.component.selection)for(const c of O(a.component.selection)){const d=a.component.selection[c];for(const e of d.project.items)!e.channel&&Zk(e.field)>1&&(b[e.field]="flatten")}return b}class gc extends Ea{constructor(a,b){super(a);this._parse=b}clone(){return new gc(null,oa(this._parse))}hash(){return`Parse ${ua(this._parse)}`}static makeExplicit(a,b,c){let d={};const e=b.data;return!fh(e)&&e&&e.format&&e.format.parse&&(d=e.format.parse),this.makeWithAncestors(a,d,{},c)}static makeWithAncestors(a,b,c,d){for(const g of O(c)){const h=d.getWithExplicit(g);h.value!==void 0&&(h.explicit||h.value===c[g]||h.value==="derived"||c[g]==="flatten"?delete c[g]:L(aM(g,c[g],h.value)))}for(const g of O(b)){const h=d.get(g);h!==void 0&&(h===b[g]?delete b[g]:L(aM(g,b[g],h)))}const e=new Of(b,c);d.copyAll(e);const f={};for(const g of O(e.combine())){const h=e.get(g);h!==null&&(f[g]=h)}return O(f).length===0||d.parseNothing?null:new gc(a,f)}get parse(){return this._parse}merge(a){this._parse=Object.assign(Object.assign({},this._parse),a.parse),a.remove()}assembleFormatParse(){const a={};for(const b of O(this._parse)){const c=this._parse[b];Zk(b)===1&&(a[b]=c)}return a}producedFields(){return new Set(O(this._parse))}dependentFields(){return new Set(O(this._parse))}assembleTransforms(a=!1){return O(this._parse).filter(b=>a?Zk(b)>1:!0).map(b=>{const c=kja(b,this._parse[b]);if(!c)return null;const d={type:"formula",expr:c,as:xL(b)};return d}).filter(b=>b!==null)}}class ih extends Ea{clone(){return new ih(null)}constructor(a){super(a)}dependentFields(){return new Set()}producedFields(){return new Set([Gi])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Gi}}}class Mi extends Ea{constructor(a,b){super(a);this.transform=b}clone(){return new Mi(null,oa(this.transform))}addDimensions(a){this.transform.groupby=yf(this.transform.groupby.concat(a),b=>b)}dependentFields(){const a=new Set();return this.transform.groupby&&this.transform.groupby.forEach(a.add,a),this.transform.joinaggregate.map(b=>b.field).filter(b=>b!==void 0).forEach(a.add,a),a}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(a){var b;return(b=a.as)!==null&&b!==void 0?b:Q(a)}hash(){return`JoinAggregateTransform ${ua(this.transform)}`}assemble(){const a=[],b=[],c=[];for(const e of this.transform.joinaggregate)b.push(e.op),c.push(this.getDefaultName(e)),a.push(e.field===void 0?null:e.field);const d=this.transform.groupby;return Object.assign({type:"joinaggregate",as:c,ops:b,fields:a},d!==void 0?{groupby:d}:{})}}function oja(a){return a.stack.stackBy.reduce((b,c)=>{const d=c.fieldDef,e=Q(d);return e&&b.push(e),b},[])}function pja(a){return J(a)&&a.every(b=>V(b))&&a.length>1}class Sf extends Ea{constructor(a,b){super(a);this._stack=b}clone(){return new Sf(null,oa(this._stack))}static makeFromTransform(a,b){const{stack:c,groupby:d,as:e,offset:f="zero"}=b,g=[],h=[];if(b.sort!==void 0)for(const k of b.sort)g.push(k.field),h.push(db(k.order,"ascending"));const i={field:g,order:h};let j;return pja(e)?j=e:V(e)?j=[e,e+"_end"]:j=[b.stack+"_start",b.stack+"_end"],new Sf(a,{stackField:c,groupby:d,offset:f,sort:i,facetby:[],as:j})}static makeFromEncoding(a,b){const c=b.stack,{encoding:d}=b;if(!c)return null;const{groupbyChannel:e,fieldChannel:f,offset:g,impute:h}=c;let i;if(e){const m=d[e];i=je(m)}const j=oja(b),k=b.encoding.order;let l;return J(k)||R(k)?l=cN(k):l=j.reduce((m,n)=>(m.field.push(n),m.order.push(f==="y"?"descending":"ascending"),m),{field:[],order:[]}),new Sf(a,{dimensionFieldDef:i,stackField:b.vgField(f),facetby:[],stackby:j,sort:l,offset:g,impute:h,as:[b.vgField(f,{suffix:"start",forAs:!0}),b.vgField(f,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(a){this._stack.facetby.push(...a)}dependentFields(){const a=new Set();return a.add(this._stack.stackField),this.getGroupbyFields().forEach(a.add,a),this._stack.facetby.forEach(a.add,a),this._stack.sort.field.forEach(a.add,a),a}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${ua(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:a,impute:b,groupby:c}=this._stack;return a?a.bin?b?[Q(a,{binSuffix:"mid"})]:[Q(a,{}),Q(a,{binSuffix:"end"})]:[Q(a)]:c!==null&&c!==void 0?c:[]}assemble(){const a=[],{facetby:b,dimensionFieldDef:c,stackField:d,stackby:e,sort:f,offset:g,impute:h,as:i}=this._stack;if(h&&c){const{band:j=.5,bin:k}=c;k&&a.push({type:"formula",expr:`${j}*`+Q(c,{expr:"datum"})+`+${1-j}*`+Q(c,{expr:"datum",binSuffix:"end"}),as:Q(c,{binSuffix:"mid",forAs:!0})}),a.push({type:"impute",field:d,groupby:[...e,...b],key:Q(c,{binSuffix:"mid"}),method:"value",value:0})}return a.push({type:"stack",groupby:[...this.getGroupbyFields(),...b],field:d,sort:f,as:i,offset:g}),a}}class sl extends Ea{constructor(a,b){super(a);this.transform=b}clone(){return new sl(null,oa(this.transform))}addDimensions(a){this.transform.groupby=yf(this.transform.groupby.concat(a),b=>b)}dependentFields(){var a,b;const c=new Set();return((a=this.transform.groupby)!==null&&a!==void 0?a:[]).forEach(c.add,c),((b=this.transform.sort)!==null&&b!==void 0?b:[]).forEach(d=>c.add(d.field)),this.transform.window.map(d=>d.field).filter(d=>d!==void 0).forEach(c.add,c),c}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(a){var b;return(b=a.as)!==null&&b!==void 0?b:Q(a)}hash(){return`WindowTransform ${ua(this.transform)}`}assemble(){var a;const b=[],c=[],d=[],e=[];for(const l of this.transform.window)c.push(l.op),d.push(this.getDefaultName(l)),e.push(l.param===void 0?null:l.param),b.push(l.field===void 0?null:l.field);const f=this.transform.frame,g=this.transform.groupby;if(f&&f[0]===null&&f[1]===null&&c.every(l=>wx(l)))return Object.assign({type:"joinaggregate",as:d,ops:c,fields:b},g!==void 0?{groupby:g}:{});const h=[],i=[];if(this.transform.sort!==void 0)for(const l of this.transform.sort)h.push(l.field),i.push((a=l.order)!==null&&a!==void 0?a:"ascending");const j={field:h,order:i},k=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:e,as:d,ops:c,fields:b,sort:j},k!==void 0?{ignorePeers:k}:{}),g!==void 0?{groupby:g}:{}),f!==void 0?{frame:f}:{})}}class qja extends Ue{run(a){const b=a.parent;if(a instanceof gc){if(mq(b))return this.flags;if(b.numChildren()>1)return this.setContinue(),this.flags;if(b instanceof gc)this.setMutated(),b.merge(a);else{if(uL(b.producedFields(),a.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),a.swapWithParent()}}return this.setContinue(),this.flags}}class rja extends Py{mergeNodes(a,b){const c=b.shift();for(const d of b)a.removeChild(d),d.parent=c,d.remove()}run(a){const b=a.children.map(d=>d.hash()),c={};for(let d=0;d<b.length;d++)c[b[d]]===void 0?c[b[d]]=[a.children[d]]:c[b[d]].push(a.children[d]);for(const d of O(c))c[d].length>1&&(this.setMutated(),this.mergeNodes(a,c[d]));for(const d of a.children)this.run(d);return this.mutatedFlag}}class sja extends Ue{run(a){return a instanceof fc||a.numChildren()>0||a instanceof Li?this.flags:(this.setMutated(),a.remove(),this.flags)}}class tja extends Ue{constructor(){super(...arguments);this.fields=new Set(),this.prev=null}run(a){this.setContinue();if(a instanceof Re){const b=a.producedFields();sL(b,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...b]),this.prev=a}return this.flags}reset(){this.fields.clear()}}class uja extends Ue{run(a){this.setContinue();const b=a.parent,c=b.children.filter(e=>e instanceof Re),d=c.pop();for(const e of c)this.setMutated(),d.merge(e);return this.flags}}function vja(a){function b(c){if(!(c instanceof Li)){const d=c.clone();if(d instanceof fc){const e=Ry+d.getSource();d.setSource(e),a.model.component.data.outputNodes[e]=d}else(d instanceof me||d instanceof Sf||d instanceof sl||d instanceof Mi)&&d.addDimensions(a.fields);for(const e of c.children.flatMap(b))e.parent=d;return[d]}return c.children.flatMap(b)}return b}function Qy(a){if(a instanceof Li)if(a.numChildren()===1&&!(a.children[0]instanceof fc)){const b=a.children[0];(b instanceof me||b instanceof Sf||b instanceof sl||b instanceof Mi)&&b.addDimensions(a.fields),b.swapWithParent(),Qy(a)}else{const b=a.model.component.data.main;YO(b);const c=vja(a),d=a.children.map(c).flat();for(const e of d)e.parent=b}else a.children.map(Qy)}function YO(a){if(a instanceof fc&&a.type===Pb){if(a.numChildren()===1){const b=a.children[0];b instanceof Li||(b.swapWithParent(),YO(a))}}}class wja extends Py{constructor(){super()}run(a){a instanceof fc&&!a.isRequired()&&(this.setMutated(),a.remove());for(const b of a.children)this.run(b);return this.mutatedFlag}}class xja extends Py{constructor(a){super();this.requiresSelectionId=a&&Cy(a)}run(a){a instanceof ih&&(this.requiresSelectionId&&(mq(a.parent)||a.parent instanceof me||a.parent instanceof gc)||(this.setMutated(),a.remove()));for(const b of a.children)this.run(b);return this.mutatedFlag}}class yja extends Ue{run(a){const b=a.parent,c=[...b.children],d=b.children.filter(e=>e instanceof gc);if(b.numChildren()>1&&d.length>=1){const e={},f=new Set();for(const g of d){const h=g.parse;for(const i of O(h))i in e?e[i]!==h[i]&&f.add(i):e[i]=h[i]}for(const g of f)delete e[g];if(!Ha(e)){this.setMutated();const g=new gc(b,e);for(const h of c){if(h instanceof gc)for(const i of O(e))delete h.parse[i];b.removeChild(h),h.parent=g,h instanceof gc&&O(h.parse).length===0&&h.remove()}}}return this.setContinue(),this.flags}}class zja extends Ue{run(a){const b=a.parent,c=b.children.filter(e=>e instanceof me),d={};for(const e of c){const f=ua(e.groupBy);f in d||(d[f]=[]),d[f].push(e)}for(const e of O(d)){const f=d[e];if(f.length>1){const g=f.pop();for(const h of f)g.merge(h)&&(b.removeChild(h),h.parent=g,h.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Aja extends Ue{constructor(a){super();this.model=a}run(a){const b=a.parent,c=!(mq(b)||b instanceof pl||b instanceof gc||b instanceof ih),d=[],e=[];for(const f of b.children)f instanceof Te&&(c&&!uL(b.producedFields(),f.dependentFields())?d.push(f):e.push(f));if(d.length>0){const f=d.pop();for(const g of d)f.merge(g,this.model.renameSignal.bind(this.model));this.setMutated(),b instanceof Te?b.merge(f,this.model.renameSignal.bind(this.model)):f.swapWithParent()}if(e.length>1){const f=e.pop();for(const g of e)f.merge(g,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class Bja extends Ue{run(a){const b=a.parent,c=[...b.children],d=Xk(c,g=>g instanceof fc);if(!d||b.numChildren()<=1)return this.setContinue(),this.flags;const e=[];let f;for(const g of c)if(g instanceof fc){let h=g;for(;h.numChildren()===1;){const i=h.children[0];if(i instanceof fc)h=i;else break}e.push(...h.children),f?(b.removeChild(g),g.parent=f.parent,f.parent.removeChild(f),f.parent=h,this.setMutated()):f=h}else e.push(g);if(e.length){this.setMutated();for(const g of e)g.parent.removeChild(g),g.parent=f}return this.setContinue(),this.flags}}const Ry="scale_",nq=5;function Tf(a){const b=[];function c(d){if(d.numChildren()===0)b.push(d);else for(const e of d.children)c(e)}for(const d of a)c(d);return b}function Cja(a){return a}function Bd(a,b){const c=b.map(d=>{if(a instanceof Ue){const e=a.optimizeNextFromLeaves(d);return a.reset(),e}else return a.run(d)});return c.some(Cja)}function ZO(a,b){let c=a.sources;const d=new Set();return d.add(Bd(new wja(),c)),d.add(Bd(new xja(b),c)),c=c.filter(e=>e.numChildren()>0),d.add(Bd(new sja(),Tf(c))),c=c.filter(e=>e.numChildren()>0),d.add(Bd(new qja(),Tf(c))),d.add(Bd(new Aja(b),Tf(c))),d.add(Bd(new tja(),Tf(c))),d.add(Bd(new yja(),Tf(c))),d.add(Bd(new zja(),Tf(c))),d.add(Bd(new uja(),Tf(c))),d.add(Bd(new rja(),c)),d.add(Bd(new Bja(),Tf(c))),a.sources=c,d.has(!0)}function Dja(a,b){Oy(a.sources);let c=0,d=0;for(let e=0;e<nq;e++){if(!ZO(a,b))break;c++}a.sources.map(Qy);for(let e=0;e<nq;e++){if(!ZO(a,b))break;d++}Oy(a.sources),Math.max(c,d)===nq&&L(`Maximum optimization runs(${nq}) reached.`)}class fd{constructor(a){Object.defineProperty(this,"signal",{enumerable:!0,get:a})}static fromName(a,b){return new fd(()=>a(b))}}function _O(a){Xa(a)?Eja(a):Fja(a)}function Eja(a){const b=a.component.scales;for(const c of O(b)){const d=Hja(a,c),e=b[c];e.setWithExplicit("domains",d),Jja(a,c);if(a.component.data.isFaceted){let f=a;for(;!Cd(f)&&f.parent;)f=f.parent;const g=f.component.resolve.scale[c];if(g==="shared")for(const h of d.value)Kf(h)&&(h.data=Ry+h.data.replace(Ry,""))}}}function Fja(a){for(const c of a.children)_O(c);const b=a.component.scales;for(const c of O(b)){let d,e=null;for(const f of a.children){const g=f.component.scales[c];if(g){d===void 0?d=g.getWithExplicit("domains"):d=Pf(d,g.getWithExplicit("domains"),"domains","scale",Uy);const h=g.get("selectionExtent");e&&h&&e.selection!==h.selection&&L("The same selection must be used to override scale domains in a layered view."),e=h}}b[c].setWithExplicit("domains",d),e&&b[c].set("selectionExtent",e,!0)}}function Gja(a,b,c,d){if(a==="unaggregated"){const{valid:e,reason:f}=$O(b,c);if(!e){L(f);return}}else if(a===void 0&&d.useUnaggregatedDomain){const{valid:e}=$O(b,c);if(e)return"unaggregated"}return a}function Hja(a,b){const c=a.getScaleComponent(b).get("type"),{encoding:d}=a,e=Gja(a.scaleDomain(b),a.typedFieldDef(b),c,a.config.scale);return e!==a.scaleDomain(b)&&(a.specifiedScales[b]=Object.assign(Object.assign({},a.specifiedScales[b]),{domain:e})),b==="x"&&kb(d.x2)?kb(d.x)?Pf(Uf(c,e,a,"x"),Uf(c,e,a,"x2"),"domain","scale",Uy):Uf(c,e,a,"x2"):b==="y"&&kb(d.y2)?kb(d.y)?Pf(Uf(c,e,a,"y"),Uf(c,e,a,"y2"),"domain","scale",Uy):Uf(c,e,a,"y2"):Uf(c,e,a,b)}function Ija(a,b,c){return a.map(d=>{const e=by(d,{timeUnit:c,type:b});return{signal:`{data: ${e}}`}})}function Sy(a,b,c){var d;const e=(d=ec(c))===null||d===void 0?void 0:d.unit;return b==="temporal"||e?Ija(a,b,e):[a]}function Uf(a,b,c,d){const{encoding:e}=c,f=kb(e[d]),{type:g}=f,h=f.timeUnit;if(Dfa(b)){const l=Uf(a,void 0,c,d),m=Sy(b.unionWith,g,h);return eh([...l.value,...m])}else{if(ga(b))return eh([b]);if(b&&b!=="unaggregated"&&!xM(b))return eh(Sy(b,g,h))}const i=c.stack;if(i&&d===i.fieldChannel){if(i.offset==="normalize")return Mc([[0,1]]);const l=c.requestDataName(Pb);return Mc([{data:l,field:c.vgField(d,{suffix:"start"})},{data:l,field:c.vgField(d,{suffix:"end"})}])}const j=If(d)&&R(f)?Kja(c,d,a):void 0;if(Mf(f)){const l=Sy([f.datum],g,h);return Mc(l)}const k=f;if(b==="unaggregated"){const l=c.requestDataName(Pb),{field:m}=f;return Mc([{data:l,field:Q({field:m,aggregate:"min"})},{data:l,field:Q({field:m,aggregate:"max"})}])}else if(Ia(k.bin)){if(yc(a))return a==="bin-ordinal"?Mc([]):Mc([{data:qp(j)?c.requestDataName(Pb):c.requestDataName(aq),field:c.vgField(d,gl(k,d)?{binSuffix:"range"}:{}),sort:j===!0||!Z(j)?{field:c.vgField(d,{}),op:"min"}:j}]);{const{bin:l}=k;if(Ia(l)){const m=Ny(c,k.field,l);return Mc([new fd(()=>{const n=c.getSignalName(m);return`[${n}.start, ${n}.stop]`})])}else return Mc([{data:c.requestDataName(Pb),field:c.vgField(d,{})}])}}else if(k.timeUnit&&fa(["time","utc"],a)&&Vx(d,k,Xa(c)?c.encoding[de(d)]:void 0,c.stack,c.markDef,c.config)){const l=c.requestDataName(Pb);return Mc([{data:l,field:c.vgField(d)},{data:l,field:c.vgField(d,{suffix:"end"})}])}else return j?Mc([{data:qp(j)?c.requestDataName(Pb):c.requestDataName(aq),field:c.vgField(d),sort:j}]):Mc([{data:c.requestDataName(Pb),field:c.vgField(d)}])}function Ty(a,b){const{op:c,field:d,order:e}=a;return Object.assign(Object.assign({op:c!==null&&c!==void 0?c:b?"sum":Np},d?{field:Af(d)}:{}),e?{order:e}:{})}function Jja(a,b){var c;const d=a.component.scales[b],e=a.specifiedScales[b].domain,f=(c=a.fieldDef(b))===null||c===void 0?void 0:c.bin,g=xM(e)&&e,h=bl(f)&&Hp(f.extent)&&f.extent;(g||h)&&d.set("selectionExtent",g!==null&&g!==void 0?g:h,!0)}function Kja(a,b,c){if(!yc(c))return;const d=a.fieldDef(b),e=d.sort;if(NM(e))return{op:"min",field:Ii(d,b),order:"ascending"};const{stack:f}=a,g=f?[...f.groupbyField?[f.groupbyField]:[],...f.stackBy.map(h=>h.fieldDef.field)]:void 0;if(he(e)){const h=f&&!fa(g,e.field);return Ty(e,h)}else if(MM(e)){const{encoding:h,order:i}=e,j=a.fieldDef(h),{aggregate:k,field:l}=j,m=f&&!fa(g,l);if(Bf(k)||Vg(k))return Ty({field:Q(j),order:i},m);if(wx(k)||!k)return Ty({op:k,field:l,order:i},m)}else{if(e==="descending")return{op:"min",field:a.vgField(b),order:"descending"};if(fa(["ascending",void 0],e))return!0}return}function $O(a,b){const{aggregate:c,type:d}=a;if(!c)return{valid:!1,reason:tea(a)};if(V(c)&&!Cda[c])return{valid:!1,reason:uea(c)};if(d==="quantitative"){if(b==="log")return{valid:!1,reason:vea(a)}}return{valid:!0}}function Uy(a,b,c,d){return a.explicit&&b.explicit&&L(Aea(c,d,a.value,b.value)),{explicit:a.explicit,value:[...a.value,...b.value]}}function Lja(a){const b=yf(a.map(g=>{if(Kf(g)){const h=$(g,["sort"]);return h}return g}),ua),c=yf(a.map(g=>{if(Kf(g)){const h=g.sort;return h!==void 0&&!qp(h)&&("op"in h&&h.op==="count"&&delete h.field,h.order==="ascending"&&delete h.order),h}return}).filter(g=>g!==void 0),ua);if(b.length===0)return;if(b.length===1){const g=a[0];if(Kf(g)&&c.length>0){let h=c[0];if(c.length>1)L(gM),h=!0;else if(Z(h)&&"field"in h){const i=h.field;g.field===i&&(h=h.order?{order:h.order}:!0)}return Object.assign(Object.assign({},g),{sort:h})}return g}const d=yf(c.map(g=>qp(g)||!("op"in g)||g.op in xda?g:(L(Cea(g)),!0)),ua);let e;d.length===1?e=d[0]:d.length>1&&(L(gM),e=!0);const f=yf(a.map(g=>Kf(g)?g.data:null),g=>g);if(f.length===1&&f[0]!==null){const g=Object.assign({data:f[0],fields:b.map(h=>h.field)},e?{sort:e}:{});return g}return Object.assign({fields:b},e?{sort:e}:{})}function Vy(a){if(Kf(a)&&V(a.field))return a.field;if(dfa(a)){let b;for(const c of a.fields)if(Kf(c)&&V(c.field)){if(!b)b=c.field;else if(b!==c.field)return L(Dea),b}return L(Eea),b}else if(efa(a)){L(Fea);const b=a.fields[0];return V(b)?b:void 0}return}function oq(a,b){const c=a.component.scales[b],d=c.get("domains").map(e=>(Kf(e)&&(e.data=a.lookupDataSource(e.data)),e));return Lja(d)}function aP(a){return Ni(a)||Xy(a)?a.children.reduce((b,c)=>b.concat(aP(c)),bP(a)):bP(a)}function bP(a){return O(a.component.scales).reduce((b,c)=>{const d=a.component.scales[c];if(d.merged)return b;const e=d.combine(),{name:f,type:g,selectionExtent:h,domains:i,range:j,reverse:k}=e,l=$(e,["name","type","selectionExtent","domains","range","reverse"]),m=Mja(e.range,f,c);let n;h&&(n=_ha(a,h));const o=oq(a,c);return b.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:f,type:g},o?{domain:o}:{}),n?{domainRaw:n}:{}),{range:m}),k!==void 0?{reverse:k}:{}),l)),b},[])}function Mja(a,b,c){if(fe(c)){if(Jf(a))return{step:{signal:b+"_step"}}}return a}class cP extends Of{constructor(a,b){super({},{name:a});this.merged=!1,this.setWithExplicit("type",b)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Xk(this.get("domains"),a=>J(a)&&a.length===2&&a[0]<=0&&a[1]>=0)}}const Nja=["range","scheme"];function dP(a){return a==="x"?"width":a==="y"?"height":void 0}function Oja(a){const b=a.component.scales;for(const c of Fp){const d=b[c];if(!d)continue;const e=Pja(c,a);d.setWithExplicit("range",e)}}function eP(a,b){const c=a.fieldDef(b);if(c&&c.bin&&Ia(c.bin)){const d=Ny(a,c.field,c.bin),e=dP(b),f=a.getName(e);return new fd(()=>{const g=a.getSignalName(d),h=`(${g}.stop - ${g}.start) / ${g}.step`;return`${a.getSignalName(f)} / (${h})`})}return}function Pja(a,b){const c=b.specifiedScales[a],{size:d}=b,e=b.getScaleComponent(a),f=e.get("type");for(const g of Nja)if(c[g]!==void 0){const h=yM(f,g),i=zM(a,g);if(!h)L(eM(f,g,a));else if(i)L(i);else switch(g){case"range":return J(c.range)&&fe(a)?eh(c.range.map(j=>{if(j==="width"||j==="height"){const k=b.getName(j),l=b.getSignalName.bind(b);return fd.fromName(l,k)}return j})):eh(c.range);case"scheme":return eh(Qja(c[g]))}}if(a===Ta||a===jb){const g=a===Ta?"width":"height",h=d[g];if(ke(h)){if(yc(f))return eh({step:h.step});L(fM(g))}}return Mc(Rja(a,b))}function Qja(a){return Cfa(a)?Object.assign({scheme:a.name},He(a,["name"])):{scheme:a}}function Rja(a,b){const{size:c,config:d,mark:e,encoding:f}=b,g=b.getSignalName.bind(b),{type:h}=kb(f[a]),i=b.getScaleComponent(a),j=i.get("type"),{domain:k,domainMid:l}=b.specifiedScales[a];switch(a){case Ta:case jb:{if(fa(["point","band"],j)){if(a===Ta&&!c.width){const o=il(d.view,"width");if(ke(o))return o}else if(a===jb&&!c.height){const o=il(d.view,"height");if(ke(o))return o}}const m=dP(a),n=b.getName(m);return a===jb&&dd(j)?[fd.fromName(g,n),0]:[0,fd.fromName(g,n)]}case Ne:{const m=b.component.scales[a].get("zero"),n=fP(e,m,d),o=Uja(e,c,b,d);return Kp(j)?Tja(n,o,Sja(j,d,k,a)):[n,o]}case yd:return[0,Math.PI*2];case Wg:return[0,360];case _d:return[0,new fd(()=>{const m=b.getSignalName("width"),n=b.getSignalName("height");return`min(${m},${n})/2`})];case Ef:return[d.scale.minStrokeWidth,d.scale.maxStrokeWidth];case Ff:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case xc:return"symbol";case wc:case be:case ce:return j==="ordinal"?h==="nominal"?"category":"ordinal":l!==void 0?"diverging":e==="rect"||e==="geoshape"?"heatmap":"ramp";case Oe:case Cf:case Df:return[d.scale.minOpacity,d.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${a}`)}function Sja(a,b,c,d){switch(a){case"quantile":return b.scale.quantileCount;case"quantize":return b.scale.quantizeCount;case"threshold":return c!==void 0&&J(c)?c.length+1:(L(Oea(d)),3)}}function Tja(a,b,c){const d=()=>{const e=hl(b),f=hl(a),g=`(${e} - ${f}) / (${c} - 1)`;return`sequence(${f}, ${e} + ${g}, ${g})`};return ga(b)?new fd(d):{signal:d()}}function fP(a,b,c){if(b)return ga(b)?{signal:`${b.signal} ? 0 : ${fP(a,!1,c)}`}:0;switch(a){case"bar":case"tick":return c.scale.minBandSize;case"line":case"trail":case"rule":return c.scale.minStrokeWidth;case"text":return c.scale.minFontSize;case"point":case"square":case"circle":return c.scale.minSize}throw new Error(Ip("size",a))}const gP=.95;function Uja(a,b,c,d){const e={x:eP(c,"x"),y:eP(c,"y")};switch(a){case"bar":case"tick":{if(d.scale.maxBandSize!==void 0)return d.scale.maxBandSize;const f=hP(b,e,d.view);return Fa(f)?f-1:new fd(()=>`${f.signal} - 1`)}case"line":case"trail":case"rule":return d.scale.maxStrokeWidth;case"text":return d.scale.maxFontSize;case"point":case"square":case"circle":{if(d.scale.maxSize)return d.scale.maxSize;const f=hP(b,e,d.view);return Fa(f)?Math.pow(gP*f,2):new fd(()=>`pow(${gP} * ${f.signal}, 2)`)}}throw new Error(Ip("size",a))}function hP(a,b,c){const d=ke(a.width)?a.width.step:Yp(c,"width"),e=ke(a.height)?a.height.step:Yp(c,"height");return b.x||b.y?new fd(()=>{const f=[b.x?b.x.signal:d,b.y?b.y.signal:e];return`min(${f.join(", ")})`}):Math.min(d,e)}function iP(a,b){Xa(a)?Vja(a,b):lP(a,b)}function Vja(a,b){const c=a.component.scales,{config:d,encoding:e,markDef:f,specifiedScales:g}=a;for(const h of O(c)){const i=g[h],j=c[h],k=a.getScaleComponent(h),l=kb(e[h]),m=i[b],n=k.get("type"),o=k.get("padding"),p=k.get("paddingInner"),q=yM(n,b),r=zM(h,b);m!==void 0&&(q?r&&L(r):L(eM(n,b,h)));if(q&&r===void 0)if(m!==void 0)j.copyKeyFromObject(b,i);else{const s=b in jP?jP[b]({model:a,channel:h,fieldOrDatumDef:l,scaleType:n,scalePadding:o,scalePaddingInner:p,domain:i.domain,markDef:f,config:d}):d.scale[b];s!==void 0&&j.set(b,s,!1)}}}const jP={bins:({model:a,fieldOrDatumDef:b})=>R(b)?Wja(a,b):void 0,interpolate:({channel:a,fieldOrDatumDef:b})=>Xja(a,b.type),nice:({scaleType:a,channel:b,fieldOrDatumDef:c})=>Yja(a,b,c),padding:({channel:a,scaleType:b,fieldOrDatumDef:c,markDef:d,config:e})=>Zja(a,b,e.scale,c,d,e.bar),paddingInner:({scalePadding:a,channel:b,markDef:c,config:d})=>_ja(a,b,c.type,d.scale),paddingOuter:({scalePadding:a,channel:b,scaleType:c,markDef:d,scalePaddingInner:e,config:f})=>$ja(a,b,c,d.type,e,f.scale),reverse:({fieldOrDatumDef:a,scaleType:b,channel:c,config:d})=>{const e=R(a)?a.sort:void 0;return aka(b,e,c,d.scale)},zero:({channel:a,fieldOrDatumDef:b,domain:c,markDef:d,scaleType:e})=>bka(a,b,c,d,e)};function kP(a){Xa(a)?Oja(a):lP(a,"range")}function lP(a,b){const c=a.component.scales;for(const d of a.children)b==="range"?kP(d):iP(d,b);for(const d of O(c)){let e;for(const f of a.children){const g=f.component.scales[d];if(g){const h=g.getWithExplicit(b);e=Pf(e,h,b,"scale",NN((i,j)=>{switch(b){case"range":return i.step&&j.step?i.step-j.step:0}return 0}))}}c[d].setWithExplicit(b,e)}}function Wja(a,b){const c=b.bin;if(Ia(c)){const d=Ny(a,b.field,c);return new fd(()=>a.getSignalName(d))}else if(dc(c)&&bl(c)&&c.step!==void 0)return{step:c.step};return}function Xja(a,b){return fa([wc,be,ce],a)&&b!=="nominal"?"hcl":void 0}function Yja(a,b,c){var d;return((d=je(c))===null||d===void 0?void 0:d.bin)||fa([eb.TIME,eb.UTC],a)?void 0:b in Hf?!0:void 0}function Zja(a,b,c,d,e,f){if(a in Hf){if(Ad(b)){if(c.continuousPadding!==void 0)return c.continuousPadding;const{type:g,orient:h}=e;if(g==="bar"&&!(R(d)&&(d.bin||d.timeUnit))){if(h==="vertical"&&a==="x"||h==="horizontal"&&a==="y")return f.continuousBandSize}}if(b===eb.POINT)return c.pointPadding}return}function _ja(a,b,c,d){if(a!==void 0)return;if(b in Hf){const{bandPaddingInner:e,barBandPaddingInner:f,rectBandPaddingInner:g}=d;return db(e,c==="bar"?f:g)}return}function $ja(a,b,c,d,e,f){if(a!==void 0)return;if(b in Hf){if(c===eb.BAND){const{bandPaddingOuter:g}=f;return db(g,ga(e)?{signal:`${e.signal}/2`}:e/2)}}return}function aka(a,b,c,d){return c==="x"&&d.xReverse!==void 0?dd(a)&&b==="descending"?ga(d.xReverse)?{signal:`!${d.xReverse.signal}`}:!d.xReverse:d.xReverse:dd(a)&&b==="descending"?!0:void 0}function bka(a,b,c,d,e){const f=!!c&&c!=="unaggregated";if(f){if(dd(e)){if(J(c)){const g=c[0],h=c[c.length-1];if(g<=0&&h>=0)return!0}return!1}}if(a==="size"&&b.type==="quantitative"&&!Kp(e))return!0;if(!(R(b)&&b.bin)&&fa([...cd,...Nda],a)){const{orient:g,type:h}=d;if(fa(["bar","area","line","trail"],h)){if(g==="horizontal"&&a==="y"||g==="vertical"&&a==="x")return!1}return!0}return!1}function cka(a,b,c,d){const e=dka(b,c,d),{type:f}=a;return If(b)?f!==void 0?BM(b,f)?R(c)&&!AM(f,c.type)?(L(yea(f,e)),e):f:(L(xea(b,f,e)),e):e:null}function dka(a,b,c){var d;switch(b.type){case"nominal":case"ordinal":if(Ai(a)||Gp(a)==="discrete")return a==="shape"&&b.type==="ordinal"&&L(Dx(a,"ordinal")),"ordinal";if(a in Hf){if(fa(["rect","bar","image","rule"],c))return"band"}else if(c==="arc"&&a in Ax)return"band";return b.band!==void 0||_x(b)&&((d=b.axis)===null||d===void 0?void 0:d.tickBand)?"band":"point";case"temporal":if(Ai(a))return"time";{if(Gp(a)==="discrete")return L(Dx(a,"temporal")),"ordinal";if(R(b)&&b.timeUnit&&ec(b.timeUnit).utc)return"utc"}return"time";case"quantitative":return Ai(a)?R(b)&&Ia(b.bin)?"bin-ordinal":"linear":Gp(a)==="discrete"?(L(Dx(a,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(cM(b.type))}function eka(a,{ignoreRange:b}={}){mP(a),_O(a);for(const c of Gfa)iP(a,c);b||kP(a)}function mP(a){Xa(a)?a.component.scales=fka(a):a.component.scales=hka(a)}function fka(a){const{encoding:b,mark:c}=a;return Fp.reduce((d,e)=>{const f=kb(b[e]);if(f&&c===EL&&e===xc&&f.type===Fi)return d;let g=f&&f.scale;if(f&&g!==null&&g!==!1){g=g!==null&&g!==void 0?g:{};const h=cka(g,e,f,c);d[e]=new cP(a.scaleName(e+"",!0),{value:h,explicit:g.type===h})}return d},{})}const gka=NN((a,b)=>vM(a)-vM(b));function hka(a){var b;const c=a.component.scales={},d={},e=a.component.resolve;for(const f of a.children){mP(f);for(const g of O(f.component.scales)){e.scale[g]=(b=e.scale[g])!==null&&b!==void 0?b:Eia(g,a);if(e.scale[g]==="shared"){const h=d[g],i=f.component.scales[g].getWithExplicit("type");h?pfa(h.value,i.value)?d[g]=Pf(h,i,"type","scale",gka):(e.scale[g]="independent",delete d[g]):d[g]=i}}}for(const f of O(d)){const g=a.scaleName(f,!0),h=d[f];c[f]=new cP(g,h);for(const i of a.children){const j=i.component.scales[f];j&&(i.renameScale(j.get("name"),g),j.merged=!0)}}return c}class Wy{constructor(){this.nameMap={}}rename(a,b){this.nameMap[a]=b}has(a){return this.nameMap[a]!==void 0}get(a){for(;this.nameMap[a]&&a!==this.nameMap[a];)a=this.nameMap[a];return a}}function Xa(a){return(a===null||a===void 0?void 0:a.type)==="unit"}function Cd(a){return(a===null||a===void 0?void 0:a.type)==="facet"}function Xy(a){return(a===null||a===void 0?void 0:a.type)==="concat"}function Ni(a){return(a===null||a===void 0?void 0:a.type)==="layer"}class Yy{constructor(a,b,c,d,e,f,g){var h,i;this.type=b,this.parent=c,this.config=e,this.view=g,this.children=[],this.correctDataNames=j=>(j.from&&j.from.data&&(j.from.data=this.lookupDataSource(j.from.data)),j.from&&j.from.facet&&j.from.facet.data&&(j.from.facet.data=this.lookupDataSource(j.from.facet.data)),j),this.parent=c,this.config=e,this.name=(h=a.name)!==null&&h!==void 0?h:d,this.title=Nf(a.title)?{text:a.title}:a.title,this.scaleNameMap=c?c.scaleNameMap:new Wy(),this.projectionNameMap=c?c.projectionNameMap:new Wy(),this.signalNameMap=c?c.signalNameMap:new Wy(),this.data=a.data,this.description=a.description,this.transforms=yha((i=a.transform)!==null&&i!==void 0?i:[]),this.layout=b==="layer"||b==="unit"?{}:zga(a,b,e),this.component={data:{sources:c?c.component.data.sources:[],outputNodes:c?c.component.data.outputNodes:{},outputNodeRefCounts:c?c.component.data.outputNodeRefCounts:{},isFaceted:Op(a)||c&&c.component.data.isFaceted&&a.data===void 0},layoutSize:new Of(),layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},f?oa(f):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){eka(this)}parseProjection(){TO(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){NO(this)}assembleGroupStyle(){var a,b;return this.type==="unit"||this.type==="layer"?(b=(a=this.view)===null||a===void 0?void 0:a.style)!==null&&b!==void 0?b:"cell":void 0}assembleEncodeFromView(a){const b=$(a,["style"]),c={};for(const d of O(b)){const e=b[d];e!==void 0&&(c[d]=ab(e))}return c}assembleGroupEncodeEntry(a){let b={};this.view&&(b=this.assembleEncodeFromView(this.view));if(!a){this.description&&(b.description=ab(this.description));if(this.type==="unit"||this.type==="layer")return Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},b!==null&&b!==void 0?b:{})}return Ha(b)?void 0:b}assembleLayout(){if(!this.layout)return;const a=this.layout,{spacing:b}=a,c=$(a,["spacing"]),{component:d,config:e}=this,f=Dia(d.layoutHeaders,e);return Object.assign(Object.assign(Object.assign({padding:b},this.assembleDefaultLayout()),c),f?{titleBand:f}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:a}=this.component;let b=[];for(const c of bd)a[c].title&&b.push(xia(this,c));for(const c of Hy)b=b.concat(yia(this,c));return b}assembleAxes(){return jia(this.component.axes,this.config)}assembleLegends(){return QO(this)}assembleProjections(){return _ia(this)}assembleTitle(){var a,b,c;const d=(a=this.title)!==null&&a!==void 0?a:{},{encoding:e}=d,f=$(d,["encoding"]),g=Object.assign(Object.assign(Object.assign({},_M(this.config.title).nonMark),f),e?{encode:{update:e}}:{});return g.text?(fa(["unit","layer"],this.type)?fa(["middle",void 0],g.anchor)&&(g.frame=(b=g.frame)!==null&&b!==void 0?b:"group"):g.anchor=(c=g.anchor)!==null&&c!==void 0?c:"start",Ha(g)?void 0:g):void 0}assembleGroup(a=[]){const b={};a=a.concat(this.assembleSignals()),a.length>0&&(b.signals=a);const c=this.assembleLayout();c&&(b.layout=c),b.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const d=!this.parent||Cd(this.parent)?aP(this):[];d.length>0&&(b.scales=d);const e=this.assembleAxes();e.length>0&&(b.axes=e);const f=this.assembleLegends();return f.length>0&&(b.legends=f),b}getName(a){return Pa((this.name?this.name+"_":"")+a)}requestDataName(a){var b;const c=this.getName(a),d=this.component.data.outputNodeRefCounts;return d[c]=((b=d[c])!==null&&b!==void 0?b:0)+1,c}getSizeSignalRef(a){if(Cd(this.parent)){const b=EO(a),c=Ep(b),d=this.component.scales[c];if(d&&!d.merged){const e=d.get("type"),f=d.get("range");if(yc(e)&&Jf(f)){const g=d.get("name"),h=oq(this,c),i=Vy(h);if(i){const j=Q({aggregate:"distinct",field:i},{expr:"datum"});return{signal:DO(g,d,j)}}else return L(`Unknown field for ${c}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(a))}}lookupDataSource(a){const b=this.component.data.outputNodes[a];return b?b.getSource():a}getSignalName(a){return this.signalNameMap.get(a)}renameSignal(a,b){this.signalNameMap.rename(a,b)}renameScale(a,b){this.scaleNameMap.rename(a,b)}renameProjection(a,b){this.projectionNameMap.rename(a,b)}scaleName(a,b){return b?this.getName(a):PL(a)&&If(a)&&this.component.scales[a]||this.scaleNameMap.has(this.getName(a))?this.scaleNameMap.get(this.getName(a)):void 0}projectionName(a){return a?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(a){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const b=this.component.scales[a];return b&&!b.merged?b:this.parent?this.parent.getScaleComponent(a):void 0}getSelectionComponent(a,b){let c=this.component.selection[a];!c&&this.parent&&(c=this.parent.getSelectionComponent(a,b));if(!c)throw new Error(Xda(b));return c}hasAxisOrientSignalRef(){var a,b;return((a=this.component.axes.x)===null||a===void 0?void 0:a.some(c=>c.hasOrientSignalRef()))||((b=this.component.axes.y)===null||b===void 0?void 0:b.some(c=>c.hasOrientSignalRef()))}}class nP extends Yy{vgField(a,b={}){const c=this.fieldDef(a);return c?Q(c,b):void 0}reduceFieldDef(a,b){return gN(this.getMapping(),(c,d,e)=>{const f=je(d);return f?a(c,f,e):c},b)}forEachFieldDef(a,b){ey(this.getMapping(),(c,d)=>{const e=je(c);e&&a(e,d)},b)}}class Zy extends Ea{constructor(a,b){var c,d,e;super(a);this.transform=b,this.transform=oa(b);const f=(c=this.transform.as)!==null&&c!==void 0?c:[void 0,void 0];this.transform.as=[(d=f[0])!==null&&d!==void 0?d:"value",(e=f[1])!==null&&e!==void 0?e:"density"]}clone(){return new Zy(null,oa(this.transform))}dependentFields(){var a;return new Set([this.transform.density,...(a=this.transform.groupby)!==null&&a!==void 0?a:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${ua(this.transform)}`}assemble(){const a=this.transform,{density:b}=a,c=$(a,["density"]),d=Object.assign({type:"kde",field:b},c);return d}}class pq extends Ea{constructor(a,b){super(a);this.filter=b}clone(){return new pq(null,Object.assign({},this.filter))}static make(a,b){const{config:c,mark:d,markDef:e}=b,f=Aa("invalid",e,c);if(f!=="filter")return null;const g=b.reduceFieldDef((h,i,j)=>{const k=If(j)&&b.getScaleComponent(j);if(k){const l=k.get("type");dd(l)&&i.aggregate!=="count"&&!Ug(d)&&(h[i.field]=i)}return h},{});return O(g).length?new pq(a,g):null}dependentFields(){return new Set(O(this.filter))}producedFields(){return new Set()}hash(){return`FilterInvalid ${ua(this.filter)}`}assemble(){const a=O(this.filter).reduce((b,c)=>{const d=this.filter[c],e=Q(d,{expr:"datum"});return d!==null&&(d.type==="temporal"?b.push(`(isDate(${e}) || (isValid(${e}) && isFinite(+${e})))`):d.type==="quantitative"&&(b.push(`isValid(${e})`),b.push(`isFinite(+${e})`))),b},[]);return a.length>0?{type:"filter",expr:a.join(" && ")}:null}}class _y extends Ea{constructor(a,b){super(a);this.transform=b,this.transform=oa(b);const{flatten:c,as:d=[]}=this.transform;this.transform.as=c.map((e,f)=>{var g;return(g=d[f])!==null&&g!==void 0?g:e})}clone(){return new _y(this.parent,oa(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${ua(this.transform)}`}assemble(){const{flatten:a,as:b}=this.transform,c={type:"flatten",fields:a,as:b};return c}}class $y extends Ea{constructor(a,b){var c,d,e;super(a);this.transform=b,this.transform=oa(b);const f=(c=this.transform.as)!==null&&c!==void 0?c:[void 0,void 0];this.transform.as=[(d=f[0])!==null&&d!==void 0?d:"key",(e=f[1])!==null&&e!==void 0?e:"value"]}clone(){return new $y(null,oa(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${ua(this.transform)}`}assemble(){const{fold:a,as:b}=this.transform,c={type:"fold",fields:a,as:b};return c}}class tl extends Ea{constructor(a,b,c,d){super(a);this.fields=b,this.geojson=c,this.signal=d}clone(){return new tl(null,oa(this.fields),this.geojson,this.signal)}static parseAll(a,b){if(b.component.projection&&!b.component.projection.isFit)return a;let c=0;for(const d of[[ae,$d],[ad,zd]]){const e=d.map(f=>{const g=kb(b.encoding[f]);return R(g)?g.field:Mf(g)?{expr:`${g.datum}`}:Pe(g)?{expr:`${g.value}`}:void 0});(e[0]||e[1])&&(a=new tl(a,e,null,b.getName(`geojson_${c++}`)))}if(b.channelHasField(xc)){const d=b.typedFieldDef(xc);d.type===Fi&&(a=new tl(a,null,d.field,b.getName(`geojson_${c++}`)))}return a}dependentFields(){var a;const b=((a=this.fields)!==null&&a!==void 0?a:[]).filter(V);return new Set([...this.geojson?[this.geojson]:[],...b])}producedFields(){return new Set()}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${ua(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class qq extends Ea{constructor(a,b,c,d){super(a);this.projection=b,this.fields=c,this.as=d}clone(){return new qq(null,this.projection,oa(this.fields),oa(this.as))}static parseAll(a,b){if(!b.projectionName())return a;for(const c of[[ae,$d],[ad,zd]]){const d=c.map(f=>{const g=kb(b.encoding[f]);return R(g)?g.field:Mf(g)?{expr:`${g.datum}`}:Pe(g)?{expr:`${g.value}`}:void 0}),e=c[0]===ad?"2":"";(d[0]||d[1])&&(a=new qq(a,b.projectionName(),d,[b.getName("x"+e),b.getName("y"+e)]))}return a}dependentFields(){return new Set(this.fields.filter(V))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${ua(this.fields)} ${ua(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Oi extends Ea{constructor(a,b){super(a);this.transform=b}clone(){return new Oi(null,oa(this.transform))}dependentFields(){var a;return new Set([this.transform.impute,this.transform.key,...(a=this.transform.groupby)!==null&&a!==void 0?a:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(a){const{start:b=0,stop:c,step:d}=a,e=[b,c,...d?[d]:[]].join(",");return{signal:`sequence(${e})`}}static makeFromTransform(a,b){return new Oi(a,b)}static makeFromEncoding(a,b){const c=b.encoding,d=c.x,e=c.y;if(R(d)&&R(e)){const f=d.impute?d:e.impute?e:void 0;if(f===void 0)return;const g=d.impute?e:e.impute?d:void 0,{method:h,value:i,frame:j,keyvals:k}=f.impute,l=hN(b.mark,c);return new Oi(a,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:f.field,key:g.field},h?{method:h}:{}),i!==void 0?{value:i}:{}),j?{frame:j}:{}),k!==void 0?{keyvals:k}:{}),l.length?{groupby:l}:{}))}return null}hash(){return`Impute ${ua(this.transform)}`}assemble(){const{impute:a,key:b,keyvals:c,method:d,groupby:e,value:f,frame:g=[null,null]}=this.transform,h=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:a,key:b},c?{keyvals:eha(c)?this.processSequence(c):c}:{}),{method:"value"}),e?{groupby:e}:{}),{value:!d||d==="value"?f:null});if(d&&d!=="value"){const i=Object.assign({type:"window",as:[`imputed_${a}_value`],ops:[d],fields:[a],frame:g,ignorePeers:!1},e?{groupby:e}:{}),j={type:"formula",expr:`datum.${a} === null ? datum.imputed_${a}_value : datum.${a}`,as:a};return[h,i,j]}else return[h]}}class az extends Ea{constructor(a,b){var c,d,e;super(a);this.transform=b,this.transform=oa(b);const f=(c=this.transform.as)!==null&&c!==void 0?c:[void 0,void 0];this.transform.as=[(d=f[0])!==null&&d!==void 0?d:b.on,(e=f[1])!==null&&e!==void 0?e:b.loess]}clone(){return new az(null,oa(this.transform))}dependentFields(){var a;return new Set([this.transform.loess,this.transform.on,...(a=this.transform.groupby)!==null&&a!==void 0?a:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${ua(this.transform)}`}assemble(){const a=this.transform,{loess:b,on:c}=a,d=$(a,["loess","on"]),e=Object.assign({type:"loess",x:c,y:b},d);return e}}class rq extends Ea{constructor(a,b,c){super(a);this.transform=b,this.secondary=c}clone(){return new rq(null,oa(this.transform),this.secondary)}static make(a,b,c,d){const e=b.component.data.sources,{from:f}=c;let g=null;if(gha(f)){let h=rP(f.data,e);h||(h=new Ki(f.data),e.push(h));const i=b.getName(`lookup_${d}`);g=new fc(h,i,"lookup",b.component.data.outputNodeRefCounts),b.component.data.outputNodes[i]=g}else if(hha(f)){const h=f.selection;c=Object.assign({as:h},c),g=b.getSelectionComponent(Pa(h),h).materialized;if(!g)throw new Error(_da(h))}return new rq(a,c,g.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?T(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${ua({transform:this.transform,secondary:this.secondary})}`}assemble(){let a;if(this.transform.from.fields)a=Object.assign({values:this.transform.from.fields},this.transform.as?{as:T(this.transform.as)}:{});else{let b=this.transform.as;V(b)||(L(dea),b="_lookup"),a={as:[b]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},a),this.transform.default?{default:this.transform.default}:{})}}class bz extends Ea{constructor(a,b){var c,d,e;super(a);this.transform=b,this.transform=oa(b);const f=(c=this.transform.as)!==null&&c!==void 0?c:[void 0,void 0];this.transform.as=[(d=f[0])!==null&&d!==void 0?d:"prob",(e=f[1])!==null&&e!==void 0?e:"value"]}clone(){return new bz(null,oa(this.transform))}dependentFields(){var a;return new Set([this.transform.quantile,...(a=this.transform.groupby)!==null&&a!==void 0?a:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${ua(this.transform)}`}assemble(){const a=this.transform,{quantile:b}=a,c=$(a,["quantile"]),d=Object.assign({type:"quantile",field:b},c);return d}}class cz extends Ea{constructor(a,b){var c,d,e;super(a);this.transform=b,this.transform=oa(b);const f=(c=this.transform.as)!==null&&c!==void 0?c:[void 0,void 0];this.transform.as=[(d=f[0])!==null&&d!==void 0?d:b.on,(e=f[1])!==null&&e!==void 0?e:b.regression]}clone(){return new cz(null,oa(this.transform))}dependentFields(){var a;return new Set([this.transform.regression,this.transform.on,...(a=this.transform.groupby)!==null&&a!==void 0?a:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${ua(this.transform)}`}assemble(){const a=this.transform,{regression:b,on:c}=a,d=$(a,["regression","on"]),e=Object.assign({type:"regression",x:c,y:b},d);return e}}class dz extends Ea{constructor(a,b){super(a);this.transform=b}clone(){return new dz(null,oa(this.transform))}addDimensions(a){var b;this.transform.groupby=yf(((b=this.transform.groupby)!==null&&b!==void 0?b:[]).concat(a),c=>c)}producedFields(){return}dependentFields(){var a;return new Set([this.transform.pivot,this.transform.value,...(a=this.transform.groupby)!==null&&a!==void 0?a:[]])}hash(){return`PivotTransform ${ua(this.transform)}`}assemble(){const{pivot:a,value:b,groupby:c,limit:d,op:e}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:a,value:b},d!==void 0?{limit:d}:{}),e!==void 0?{op:e}:{}),c!==void 0?{groupby:c}:{})}}class ez extends Ea{constructor(a,b){super(a);this.transform=b}clone(){return new ez(null,oa(this.transform))}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return`SampleTransform ${ua(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function oP(a){let b=0;function c(d,e){var f;if(d instanceof Ki){if(!d.isGenerator&&!jl(d.data)){a.push(e);const g={name:null,source:e.name,transform:[]};e=g}}d instanceof gc&&(d.parent instanceof Ki&&!e.source?(e.format=Object.assign(Object.assign({},(f=e.format)!==null&&f!==void 0?f:{}),{parse:d.assembleFormatParse()}),e.transform.push(...d.assembleTransforms(!0))):e.transform.push(...d.assembleTransforms()));if(d instanceof Li){e.name||(e.name=`data_${b++}`),!e.source||e.transform.length>0?(a.push(e),d.data=e.name):d.data=e.source;for(const g of d.assemble())a.push(g);return}(d instanceof kq||d instanceof lq||d instanceof pq||d instanceof pl||d instanceof rl||d instanceof qq||d instanceof tl||d instanceof me||d instanceof rq||d instanceof sl||d instanceof Mi||d instanceof $y||d instanceof _y||d instanceof Zy||d instanceof az||d instanceof bz||d instanceof cz||d instanceof ih||d instanceof ez||d instanceof dz)&&e.transform.push(d.assemble()),(d instanceof Te||d instanceof Re||d instanceof Oi||d instanceof Sf)&&e.transform.push(...d.assemble());if(d instanceof fc)if(e.source&&e.transform.length===0)d.setSource(e.source);else if(d.parent instanceof fc)d.setSource(e.name);else{e.name||(e.name=`data_${b++}`),d.setSource(e.name);if(d.numChildren()===1){a.push(e);const g={name:null,source:e.name,transform:[]};e=g}}switch(d.numChildren()){case 0:d instanceof fc&&(!e.source||e.transform.length>0)&&a.push(e);break;case 1:c(d.children[0],e);break;default:{e.name||(e.name=`data_${b++}`);let g=e.name;!e.source||e.transform.length>0?a.push(e):g=e.source;for(const h of d.children){const i={name:null,source:g,transform:[]};c(h,i)}break}}}return c}function ika(a){const b=[],c=oP(b);for(const d of a.children)c(d,{source:a.name,name:null,transform:[]});return b}function jka(a,b){var c,d;const e=[],f=oP(e);let g=0;for(const i of a.sources){i.hasName()||(i.dataName=`source_${g++}`);const j=i.assemble();f(i,j)}for(const i of e)i.transform.length===0&&delete i.transform;let h=0;for(const[i,j]of e.entries())((c=j.transform)!==null&&c!==void 0?c:[]).length===0&&!j.source&&e.splice(h++,0,e.splice(i,1)[0]);for(const i of e)for(const j of(d=i.transform)!==null&&d!==void 0?d:[])j.type==="lookup"&&(j.from=a.outputNodes[j.from].getSource());for(const i of e)i.name in b&&(i.values=b[i.name]);return e}function kka(a){return a==="top"||a==="left"||ga(a)?"header":"footer"}function lka(a){for(const b of bd)mka(a,b);qP(a,"x"),qP(a,"y")}function mka(a,b){var c;const{facet:d,config:e,child:f,component:g}=a;if(a.channelHasField(b)){const h=d[b],i=Ji("title",null,e,b);let j=ah(h,e,{allowDisabling:!0,includeDefault:i===void 0||!!i});f.component.layoutHeaders[b].title&&(j=J(j)?j.join(", "):j,j+=" / "+f.component.layoutHeaders[b].title,f.component.layoutHeaders[b].title=null);const k=Ji("labelOrient",h,e,b),l=(c=h.header)!==null&&c!==void 0?c:{},m=db(l.labels,e.header.labels,!0),n=fa(["bottom","right"],k)?"footer":"header";g.layoutHeaders[b]={title:j,facetFieldDef:h,[n]:b==="facet"?[]:[pP(a,b,m)]}}}function pP(a,b,c){const d=b==="row"?"height":"width";return{labels:c,sizeSignal:a.child.component.layoutSize.get(d)?a.child.getSizeSignalRef(d):void 0,axes:[]}}function qP(a,b){var c;const{child:d}=a;if(d.component.axes[b]){const{layoutHeaders:e,resolve:f}=a.component;f.axis[b]=Ly(f,b);if(f.axis[b]==="shared"){const g=b==="x"?"column":"row",h=e[g];for(const i of d.component.axes[b]){const j=kka(i.get("orient"));h[j]=(c=h[j])!==null&&c!==void 0?c:[pP(a,g,!1)];const k=ql(i,"main",a.config,{header:!0});k&&h[j][0].axes.push(k),i.mainExtracted=!0}}}}function nka(a){fz(a),sq(a,"width"),sq(a,"height")}function oka(a){fz(a);const b=a.layout.columns===1?"width":"childWidth",c=a.layout.columns===void 0?"height":"childHeight";sq(a,b),sq(a,c)}function fz(a){for(const b of a.children)b.parseLayoutSize()}function sq(a,b){const c=EO(b),d=Ep(c),e=a.component.resolve,f=a.component.layoutSize;let g;for(const h of a.children){const i=h.component.layoutSize.getWithExplicit(c),j=e.scale[d];if(j==="independent"&&i.value==="step"){g=void 0;break}if(g){if(j==="independent"&&g.value!==i.value){g=void 0;break}g=Pf(g,i,c,"")}else g=i}if(g){for(const h of a.children)a.renameSignal(h.getName(c),a.getName(b)),h.component.layoutSize.set(c,"merged",!1);f.setWithExplicit(b,g)}else f.setWithExplicit(b,{explicit:!1,value:void 0})}function pka(a){const{size:b,component:c}=a;for(const d of cd){const e=ee(d);if(b[e]){const f=b[e];c.layoutSize.set(e,ke(f)?"step":f,!0)}else{const f=qka(a,e);c.layoutSize.set(e,f,!1)}}}function qka(a,b){const c=b==="width"?"x":"y",d=a.config,e=a.getScaleComponent(c);if(e){const f=e.get("type"),g=e.get("range");if(yc(f)){const h=il(d.view,b);return Jf(g)||ke(h)?"step":h}else return oy(d.view,b)}else{if(a.hasProjection||a.mark==="arc")return oy(d.view,b);{const f=il(d.view,b);return ke(f)?f.step:f}}}function gz(a,b,c){return Q(b,Object.assign({suffix:`by_${Q(a)}`},c!==null&&c!==void 0?c:{}))}class tq extends nP{constructor(a,b,c,d){super(a,"facet",b,c,d,a.resolve);this.child=iz(a.spec,this,this.getName("child"),void 0,d),this.children=[this.child],this.facet=this.initFacet(a.facet,d)}initFacet(a,b){return el(a)?gN(a,(c,d,e)=>fa([Je,Ke],e)?d.field===void 0?(L(Cx(d,e)),c):(c[e]=ay(d,e,b),c):(L(Ip(e,"facet")),c),{}):{facet:ay(a,"facet",b)}}channelHasField(a){return!!this.facet[a]}fieldDef(a){return this.facet[a]}parseData(){this.component.data=uq(this),this.child.parseData()}parseLayoutSize(){fz(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),lka(this)}assembleSelectionTopLevelSignals(a){return this.child.assembleSelectionTopLevelSignals(a)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(a){return this.child.assembleSelectionData(a)}getHeaderLayoutMixins(){var a,b,c;const d={};for(const e of bd)for(const f of Iy){const g=this.component.layoutHeaders[e],h=g[f],{facetFieldDef:i}=g;if(i){const j=Ji("titleOrient",i,this.config,e);if(fa(["right","bottom"],j)){const k=hq(e,j);d.titleAnchor=(a=d.titleAnchor)!==null&&a!==void 0?a:{},d.titleAnchor[k]="end"}}if(h===null||h===void 0?void 0:h[0]){const j=e==="row"?"height":"width",k=f==="header"?"headerBand":"footerBand";e!=="facet"&&!this.child.component.layoutSize.get(j)&&(d[k]=(b=d[k])!==null&&b!==void 0?b:{},d[k][e]=.5),g.title&&(d.offset=(c=d.offset)!==null&&c!==void 0?c:{},d.offset[e==="row"?"rowTitle":"columnTitle"]=10)}}return d}assembleDefaultLayout(){const{column:a,row:b}=this.facet,c=a?this.columnDistinctSignal():b?1:void 0;let d="all";return!b&&this.component.resolve.scale.x==="independent"?d="none":!a&&this.component.resolve.scale.y==="independent"&&(d="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),c?{columns:c}:{}),{bounds:"full",align:d})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof tq)return;{const a=this.getName("column_domain");return{signal:`length(data('${a}'))`}}}assembleGroup(a){return this.parent&&this.parent instanceof tq?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:Q(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(a)):super.assembleGroup(a)}getCardinalityAggregateForChild(){const a=[],b=[],c=[];if(this.child instanceof tq){if(this.child.channelHasField("column")){const d=Q(this.child.facet.column);a.push(d),b.push("distinct"),c.push(`distinct_${d}`)}}else for(const d of cd){const e=this.child.component.scales[d];if(e&&!e.merged){const f=e.get("type"),g=e.get("range");if(yc(f)&&Jf(g)){const h=oq(this.child,d),i=Vy(h);i?(a.push(i),b.push("distinct"),c.push(`distinct_${i}`)):L(`Unknown field for ${d}. Cannot calculate view size.`)}}}return{fields:a,ops:b,as:c}}assembleFacet(){const{name:a,data:b}=this.component.data.facetRoot,{row:c,column:d}=this.facet,{fields:e,ops:f,as:g}=this.getCardinalityAggregateForChild(),h=[];for(const j of bd){const k=this.facet[j];if(k){h.push(Q(k));const{bin:l,sort:m}=k;Ia(l)&&h.push(Q(k,{binSuffix:"end"}));if(he(m)){const{field:n,op:o=Np}=m,p=gz(k,m);c&&d?(e.push(p),f.push("max"),g.push(p)):(e.push(n),f.push(o),g.push(p))}else if(J(m)){const n=Ii(k,j);e.push(n),f.push("max"),g.push(n)}}}const i=!!c&&!!d;return Object.assign({name:a,data:b,groupby:h},i||e.length>0?{aggregate:Object.assign(Object.assign({},i?{cross:i}:{}),e.length?{fields:e,ops:f,as:g}:{})}:{})}facetSortFields(a){const{facet:b}=this,c=b[a];return c?he(c.sort)?[gz(c,c.sort,{expr:"datum"})]:J(c.sort)?[Ii(c,a,{expr:"datum"})]:[Q(c,{expr:"datum"})]:[]}facetSortOrder(a){const{facet:b}=this,c=b[a];if(c){const{sort:d}=c,e=(he(d)?d.order:!J(d)&&d)||"ascending";return[e]}return[]}assembleLabelTitle(){const{facet:a,config:b}=this;if(a.facet)return Jy(a.facet,"facet",b);const c={row:["top","bottom"],column:["left","right"]};for(const d of Hy)if(a[d]){const e=Ji("labelOrient",a[d],b,d);if(fa(c[d],e))return Jy(a[d],d,b)}return}assembleMarks(){const{child:a}=this,b=this.component.data.facetRoot,c=ika(b),d=a.assembleGroupEncodeEntry(!1),e=this.assembleLabelTitle()||a.assembleTitle(),f=a.assembleGroupStyle(),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},e?{title:e}:{}),f?{style:f}:{}),{from:{facet:this.assembleFacet()},sort:{field:bd.map(h=>this.facetSortFields(h)).flat(),order:bd.map(h=>this.facetSortOrder(h)).flat()}}),c.length>0?{data:c}:{}),d?{encode:{update:d}}:{}),a.assembleGroup(Wha(this,[])));return[g]}getMapping(){return this.facet}}function rka(a,b){const{row:c,column:d}=b;if(c&&d){let e=null;for(const f of[c,d])if(he(f.sort)){const{field:g,op:h=Np}=f.sort;a=e=new Mi(a,{joinaggregate:[{op:h,field:g,as:gz(f,f.sort,{forAs:!0})}],groupby:[Q(f)]})}return e}return null}function rP(a,b){var c,d,e,f,g,h,i,j,k,l;for(const m of b){const n=m.data;if(a.name&&m.hasName()&&a.name!==m.dataName)continue;if(((c=a.format)===null||c===void 0?void 0:c.mesh)&&((d=n.format)===null||d===void 0?void 0:d.feature))continue;if((((e=a.format)===null||e===void 0?void 0:e.feature)||((f=n.format)===null||f===void 0?void 0:f.feature))&&((g=a.format)===null||g===void 0?void 0:g.feature)!==((h=n.format)===null||h===void 0?void 0:h.feature))continue;if((((i=a.format)===null||i===void 0?void 0:i.mesh)||((j=n.format)===null||j===void 0?void 0:j.mesh))&&((k=a.format)===null||k===void 0?void 0:k.mesh)!==((l=n.format)===null||l===void 0?void 0:l.mesh))continue;if($p(a)&&$p(n)){if(Vk(a.values,n.values))return m}else if(jl(a)&&jl(n)){if(a.url===n.url)return m}else if(ON(a)){if(a.name===m.dataName)return m}}return null}function ska(a,b){if(a.data||!a.parent){if(a.data===null){const d=new Ki({values:[]});return b.push(d),d}const c=rP(a.data,b);if(c)return fh(a.data)||(c.data.format=Zca({},a.data.format,c.data.format)),!c.hasName()&&a.data.name&&(c.dataName=a.data.name),c;{const d=new Ki(a.data);return b.push(d),d}}else return a.parent.component.data.facetRoot?a.parent.component.data.facetRoot:a.parent.component.data.main}function tka(a,b,c){var d,e;let f=0;for(const g of b.transforms){let h,i;if(rha(g))i=a=new rl(a,g),h="derived";else if(RN(g)){const j=lja(g);i=a=(d=gc.makeWithAncestors(a,{},j,c))!==null&&d!==void 0?d:a,a=new pl(a,b,g.filter)}else if(sha(g))i=a=Te.makeFromTransform(a,g,b),h="number";else if(uha(g)){h="date";const j=c.getWithExplicit(g.field);j.value===void 0&&(a=new gc(a,{[g.field]:h}),c.set(g.field,h,!1)),i=a=Re.makeFromTransform(a,g)}else if(vha(g))i=a=me.makeFromTransform(a,g),h="number",Cy(b)&&(a=new ih(a));else if(fha(g))i=a=rq.make(a,b,g,f++),h="derived";else if(oha(g))i=a=new sl(a,g),h="number";else if(pha(g))i=a=new Mi(a,g),h="number";else if(wha(g))i=a=Sf.makeFromTransform(a,g),h="derived";else if(xha(g))i=a=new $y(a,g),h="derived";else if(qha(g))i=a=new _y(a,g),h="derived";else if(iha(g))i=a=new dz(a,g),h="derived";else if(nha(g))a=new ez(a,g);else if(tha(g))i=a=Oi.makeFromTransform(a,g),h="derived";else if(jha(g))i=a=new Zy(a,g),h="derived";else if(kha(g))i=a=new bz(a,g),h="derived";else if(lha(g))i=a=new cz(a,g),h="derived";else if(mha(g))i=a=new az(a,g),h="derived";else{L(cea(g));continue}if(i&&h!==void 0)for(const j of(e=i.producedFields())!==null&&e!==void 0?e:[])c.set(j,h,!1)}return a}function uq(a){var b,c,d,e,f,g,h,i,j,k;let l=ska(a,a.component.data.sources);const{outputNodes:m,outputNodeRefCounts:n}=a.component.data,o=a.parent?a.parent.component.data.ancestorParse.clone():new dha(),p=a.data;fh(p)?(PN(p)?l=new lq(l,p.sequence):ty(p)&&(l=new kq(l,p.graticule)),o.parseNothing=!0):((b=p===null||p===void 0?void 0:p.format)===null||b===void 0?void 0:b.parse)===null&&(o.parseNothing=!0),l=(c=gc.makeExplicit(l,a,o))!==null&&c!==void 0?c:l,l=new ih(l);const q=a.parent&&Ni(a.parent);(Xa(a)||Cd(a))&&(q&&(l=(d=Te.makeFromEncoding(l,a))!==null&&d!==void 0?d:l)),a.transforms.length>0&&(l=tka(l,a,o));const r=nja(a),s=mja(a);l=(e=gc.makeWithAncestors(l,{},Object.assign(Object.assign({},r),s),o))!==null&&e!==void 0?e:l,Xa(a)&&(l=tl.parseAll(l,a),l=qq.parseAll(l,a)),(Xa(a)||Cd(a))&&(q||(l=(f=Te.makeFromEncoding(l,a))!==null&&f!==void 0?f:l),l=(g=Re.makeFromEncoding(l,a))!==null&&g!==void 0?g:l,l=rl.parseAllForSortIndex(l,a));const t=a.getName(aq),w=new fc(l,t,aq,n);m[t]=w,l=w;if(Xa(a)){const z=me.makeFromEncoding(l,a);z&&(l=z,Cy(a)&&(l=new ih(l))),l=(h=Oi.makeFromEncoding(l,a))!==null&&h!==void 0?h:l,l=(i=Sf.makeFromEncoding(l,a))!==null&&i!==void 0?i:l}Xa(a)&&(l=(j=pq.make(l,a))!==null&&j!==void 0?j:l);const v=a.getName(Pb),x=new fc(l,v,Pb,n);m[v]=x,l=x,Xa(a)&&hia(a,x);let u=null;if(Cd(a)){const z=a.getName("facet");l=(k=rka(l,a.facet))!==null&&k!==void 0?k:l,u=new Li(l,a,z,x.getSource()),m[z]=u}return Object.assign(Object.assign({},a.component.data),{outputNodes:m,outputNodeRefCounts:n,raw:w,main:x,facetRoot:u,ancestorParse:o})}class uka extends Yy{constructor(a,b,c,d){var e,f,g,h;super(a,"concat",b,c,d,a.resolve);(((f=(e=a.resolve)===null||e===void 0?void 0:e.axis)===null||f===void 0?void 0:f.x)==="shared"||((h=(g=a.resolve)===null||g===void 0?void 0:g.axis)===null||h===void 0?void 0:h.y)==="shared")&&L(aea),this.children=this.getChildren(a).map((i,j)=>iz(i,this,this.getName("concat_"+j),void 0,d))}parseData(){this.component.data=uq(this);for(const a of this.children)a.parseData()}parseSelections(){this.component.selection={};for(const a of this.children){a.parseSelections();for(const b of O(a.component.selection))this.component.selection[b]=a.component.selection[b]}}parseMarkGroup(){for(const a of this.children)a.parseMarkGroup()}parseAxesAndHeaders(){for(const a of this.children)a.parseAxesAndHeaders()}getChildren(a){return Xp(a)?a.vconcat:ny(a)?a.hconcat:a.concat}parseLayoutSize(){oka(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(a){return this.children.reduce((b,c)=>c.assembleSelectionTopLevelSignals(b),a)}assembleSignals(){return this.children.forEach(a=>a.assembleSignals()),[]}assembleLayoutSignals(){const a=Ky(this);for(const b of this.children)a.push(...b.assembleLayoutSignals());return a}assembleSelectionData(a){return this.children.reduce((b,c)=>c.assembleSelectionData(b),a)}assembleMarks(){return this.children.map(a=>{const b=a.assembleTitle(),c=a.assembleGroupStyle(),d=a.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:a.getName("group")},b?{title:b}:{}),c?{style:c}:{}),d?{encode:{update:d}}:{}),a.assembleGroup())})}assembleDefaultLayout(){const a=this.layout.columns;return Object.assign(Object.assign({},a!=null?{columns:a}:{}),{bounds:"full",align:"each"})}}function vka(a){return a===!1||a===null}const wka=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},AL),{labelExpr:1,encode:1}),sP=O(wka);class tP extends Of{constructor(a={},b={},c=!1){super();this.explicit=a,this.implicit=b,this.mainExtracted=c}clone(){return new tP(oa(this.explicit),oa(this.implicit),this.mainExtracted)}hasAxisPart(a){return a==="axis"?!0:a==="grid"||a==="title"?!!this.get(a):!vka(this.get(a))}hasOrientSignalRef(){return ga(this.explicit.orient)}}function xka(a,b,c){var d;const{encoding:e,config:f}=a,g=(d=kb(e[b]))!==null&&d!==void 0?d:kb(e[de(b)]),h=a.axis(b)||{},{format:i,formatType:j}=h;return $g(j)?Object.assign({text:Tx({fieldOrDatumDef:g,field:"datum.value",format:i,formatType:j,config:f})},c):c}function yka(a){return cd.reduce((b,c)=>(a.component.scales[c]&&(b[c]=[Fka(c,a)]),b),{})}const zka={bottom:"top",top:"bottom",left:"right",right:"left"};function Aka(a){var b;const{axes:c,resolve:d}=a.component,e={top:0,bottom:0,right:0,left:0};for(const f of a.children){f.parseAxesAndHeaders();for(const g of O(f.component.axes))d.axis[g]=Ly(a.component.resolve,g),d.axis[g]==="shared"&&(c[g]=Bka(c[g],f.component.axes[g]),c[g]||(d.axis[g]="independent",delete c[g]))}for(const f of cd){for(const g of a.children){if(!g.component.axes[f])continue;if(d.axis[f]==="independent"){c[f]=((b=c[f])!==null&&b!==void 0?b:[]).concat(g.component.axes[f]);for(const h of g.component.axes[f]){const{value:i,explicit:j}=h.getWithExplicit("orient");if(ga(i))continue;if(e[i]>0&&!j){const k=zka[i];e[i]>e[k]&&h.set("orient",k,!1)}e[i]++}}delete g.component.axes[f]}if(d.axis[f]==="independent"&&c[f]&&c[f].length>1)for(const g of c[f])!!g.get("grid")&&!g.explicit.grid&&(g.implicit.grid=!1)}}function Bka(a,b){if(a){if(a.length!==b.length)return;const c=a.length;for(let d=0;d<c;d++){const e=a[d],f=b[d];if(!!e!==!!f)return;if(e&&f){const g=e.getWithExplicit("orient"),h=f.getWithExplicit("orient");if(g.explicit&&h.explicit&&g.value!==h.value)return;a[d]=Cka(e,f)}}}else return b.map(c=>c.clone());return a}function Cka(a,b){for(const c of sP){const d=Pf(a.getWithExplicit(c),b.getWithExplicit(c),c,"axis",(e,f)=>{switch(c){case"title":return fN(e,f);case"gridScale":return{explicit:e.explicit,value:db(e.value,f.value)}}return _p(e,f,c,"axis")});a.setWithExplicit(c,d)}return a}function Dka(a,b,c,d,e){if(b==="disable")return c!==void 0;c=c||{};switch(b){case"titleAngle":case"labelAngle":return a===(ga(c.labelAngle)?c.labelAngle:sp(c.labelAngle));case"values":return!!c.values;case"encode":return!!c.encoding||!!c.labelAngle;case"title":if(a===yO(d,e))return!0}return a===c[b]}const Eka=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Fka(a,b){var c,d,e;let f=b.axis(a);const g=new tP(),h=kb(b.encoding[a]),{mark:i,config:j}=b,k=(f===null||f===void 0?void 0:f.orient)||((c=j[a==="x"?"axisX":"axisY"])===null||c===void 0?void 0:c.orient)||((d=j.axis)===null||d===void 0?void 0:d.orient)||tia(a),l=b.getScaleComponent(a).get("type"),m=mia(a,l,k,b.config),n=f!==void 0?!f:Fy("disable",j,f===null||f===void 0?void 0:f.style,m).configValue;g.set("disable",n,f!==void 0);if(n)return g;f=f||{};const o=qia(b,f,a,h,m),p={fieldOrDatumDef:h,axis:f,channel:a,model:b,scaleType:l,orient:k,labelAngle:o,mark:i,config:j};for(const s of sP){const t=s in vO?vO[s](p):BL(s)?f[s]:void 0,w=t!==void 0,v=Dka(t,s,f,b,a);if(w&&v)g.set(s,t,v);else{const{configValue:x=void 0,configFrom:u=void 0}=BL(s)&&s!=="values"?Fy(s,b.config,f.style,m):{},z=x!==void 0;w&&!z?g.set(s,t,v):(!(u==="vgAxisConfig")||Eka.has(s)&&z||sx(x)||ga(x))&&g.set(s,x,!1)}}const q=(e=f.encoding)!==null&&e!==void 0?e:{},r=zL.reduce((s,t)=>{var w;if(!g.hasAxisPart(t))return s;const v=FO((w=q[t])!==null&&w!==void 0?w:{},b),x=t==="labels"?xka(b,a,v):v;return x!==void 0&&!Ha(x)&&(s[t]={update:x}),s},{});return Ha(r)||g.set("encode",r,!!f.encoding||f.labelAngle!==void 0),g}function Gka({encoding:a,size:b}){for(const c of cd){const d=ee(c);ke(b[d])&&(ie(a[c])&&(delete b[d],L(fM(d))))}return b}function Hka(a,b,c,{graticule:d}){const e=Yd(a)?Object.assign({},a):{type:a},f=Aa("orient",e,c);e.orient=Lka(e.type,b,f),f!==void 0&&f!==e.orient&&L(qea(e.orient,f));if(e.type==="bar"&&e.orient){const j=Aa("cornerRadiusEnd",e,c);if(j!==void 0){const k=e.orient==="horizontal"&&b.x2||e.orient==="vertical"&&b.y2?["cornerRadius"]:rda[e.orient];for(const l of k)e[l]=j;e.cornerRadiusEnd!==void 0&&delete e.cornerRadiusEnd}}const g=Aa("opacity",e,c);g===void 0&&(e.opacity=Jka(e.type,b));const h=e.filled;h===void 0&&(e.filled=d?!1:Kka(e,c));const i=Aa("cursor",e,c);return i===void 0&&(e.cursor=Ika(e,b,c)),e}function Ika(a,b,c){return b.href||a.href||Aa("href",a,c)?"pointer":a.cursor}function Jka(a,b){if(fa([wp,tx,ux,vx],a)){if(!cy(b))return .7}return}function Kka(a,b){const c=ch("filled",a,b),d=a.type;return db(c,d!==wp&&d!==vp&&d!==xp)}function Lka(a,b,c){switch(a){case wp:case ux:case vx:case DL:case jda:case ida:return}const{x:d,y:e,x2:f,y2:g}=b;switch(a){case up:if(R(d)&&(dc(d.bin)||R(e)&&e.aggregate&&!d.aggregate))return"vertical";if(R(e)&&(dc(e.bin)||R(d)&&d.aggregate&&!e.aggregate))return"horizontal";if(g||f){if(c)return c;if(!f){if(R(d)&&d.type===Zg&&!Ia(d.bin)||Yx(d))return"horizontal"}if(!g){if(R(e)&&e.type===Zg&&!Ia(e.bin)||Yx(e))return"vertical"}}case xp:if(f&&!(R(d)&&dc(d.bin))&&g&&!(R(e)&&dc(e.bin)))return;case tp:if(g)return R(e)&&dc(e.bin)?"horizontal":"vertical";{if(f)return R(d)&&dc(d.bin)?"vertical":"horizontal";if(a===xp){if(d&&!e)return"vertical";if(e&&!d)return"horizontal"}}case vp:case tx:{const h=ie(d),i=ie(e);if(h&&!i)return a!=="tick"?"horizontal":"vertical";{if(!h&&i)return a!=="tick"?"vertical":"horizontal";if(h&&i){const j=d,k=e,l=j.type===Ei,m=k.type===Ei;return l&&!m?a!=="tick"?"vertical":"horizontal":!l&&m?a!=="tick"?"horizontal":"vertical":!j.aggregate&&k.aggregate?a!=="tick"?"vertical":"horizontal":j.aggregate&&!k.aggregate?a!=="tick"?"horizontal":"vertical":c?c:"vertical"}else return c?c:void 0}}}return"vertical"}const Mka={vgMark:"arc",encodeEntry:a=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Qb("x",a,{defaultPos:"mid"})),Qb("y",a,{defaultPos:"mid"})),Qf(a,"radius","arc")),Qf(a,"theta","arc"))},Nka={vgMark:"area",encodeEntry:a=>Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),cq("x",a,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:a.markDef.orient==="horizontal"})),cq("y",a,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:a.markDef.orient==="vertical"})),wy(a))},Oka={vgMark:"rect",encodeEntry:a=>Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Qf(a,"x","bar")),Qf(a,"y","bar"))},Pka={vgMark:"shape",encodeEntry:a=>Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:a=>{const{encoding:b}=a,c=b.shape,d=Object.assign({type:"geoshape",projection:a.projectionName()},c&&R(c)&&c.type===Fi?{field:Q(c,{expr:"datum"})}:{});return[d]}},Qka={vgMark:"image",encodeEntry:a=>Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Qf(a,"x","image")),Qf(a,"y","image")),uy(a,"url"))},Rka={vgMark:"line",encodeEntry:a=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Qb("x",a,{defaultPos:"mid"})),Qb("y",a,{defaultPos:"mid"})),sb("size",a,{vgChannel:"strokeWidth"})),wy(a))},Ska={vgMark:"trail",encodeEntry:a=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Qb("x",a,{defaultPos:"mid"})),Qb("y",a,{defaultPos:"mid"})),sb("size",a)),wy(a))};function hz(a,b){const{config:c}=a;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Qb("x",a,{defaultPos:"mid"})),Qb("y",a,{defaultPos:"mid"})),sb("size",a)),sb("angle",a)),Tka(a,c,b))}function Tka(a,b,c){return c?{shape:{value:c}}:sb("shape",a)}const Uka={vgMark:"symbol",encodeEntry:a=>hz(a)},Vka={vgMark:"symbol",encodeEntry:a=>hz(a,"circle")},Wka={vgMark:"symbol",encodeEntry:a=>hz(a,"square")},Xka={vgMark:"rect",encodeEntry:a=>Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Qf(a,"x","rect")),Qf(a,"y","rect"))},Yka={vgMark:"rule",encodeEntry:a=>{const{markDef:b}=a,c=b.orient;return!a.encoding.x&&!a.encoding.y&&!a.encoding.latitude&&!a.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),cq("x",a,{defaultPos:c==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:c!=="vertical"})),cq("y",a,{defaultPos:c==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:c!=="horizontal"})),sb("size",a,{vgChannel:"strokeWidth"}))}},Zka={vgMark:"text",encodeEntry:a=>{const{config:b,encoding:c}=a;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Qb("x",a,{defaultPos:"mid"})),Qb("y",a,{defaultPos:"mid"})),uy(a)),sb("size",a,{vgChannel:"fontSize"})),sb("angle",a)),_N("align",_ka(a.markDef,c,b))),_N("baseline",$ka(a.markDef,c,b))),Qb("radius",a,{defaultPos:null,isMidPoint:!0})),Qb("theta",a,{defaultPos:null,isMidPoint:!0}))}};function _ka(a,b,c){const d=Aa("align",a,c);return d===void 0?"center":void 0}function $ka(a,b,c){const d=Aa("baseline",a,c);return d===void 0?"middle":void 0}const ala={vgMark:"rect",encodeEntry:a=>{const{config:b,markDef:c}=a,d=c.orient,e=d==="horizontal"?"width":"height",f=d==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ed(a,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Qb("x",a,{defaultPos:"mid",vgChannel:"xc"})),Qb("y",a,{defaultPos:"mid",vgChannel:"yc"})),sb("size",a,{defaultValue:bla(a),vgChannel:e})),{[f]:ab(Aa("thickness",c,b))})}};function bla(a){var b;const{config:c,markDef:d}=a,{orient:e}=d,f=e==="horizontal"?"width":"height",g=a.getScaleComponent(e==="horizontal"?"x":"y"),h=(b=Aa("size",d,c,{vgChannel:f}))!==null&&b!==void 0?b:c.tick.bandSize;if(h!==void 0)return h;{const i=g?g.get("range"):void 0;if(i&&Jf(i)&&Fa(i.step))return i.step*3/4;const j=Yp(c.view,f);return j*3/4}}const vq={arc:Mka,area:Nka,bar:Oka,circle:Vka,geoshape:Pka,image:Qka,line:Rka,point:Uka,rect:Xka,rule:Yka,square:Wka,text:Zka,tick:ala,trail:Ska};function cla(a){return fa([vp,tp,kda],a.mark)?dla(a):fa([up],a.mark)?ela(a):wq(a)}const uP="faceted_path_";function dla(a){const b=hN(a.mark,a.encoding),c=wq(a,{fromPrefix:b.length>0?uP:""});return b.length>0?[{name:a.getName("pathgroup"),type:"group",from:{facet:{name:uP+a.requestDataName(Pb),data:a.requestDataName(Pb),groupby:b}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:c}]:c}const vP="stack_group_";function ela(a){const b=Ix.some(c=>Aa(c,a.markDef,a.config));if(a.stack&&!a.fieldDef("size")&&b){const[c]=wq(a,{fromPrefix:vP}),d=a.scaleName(a.stack.fieldChannel),e=(l={})=>a.vgField(a.stack.fieldChannel,l),f=(l,m)=>{const n=[e({prefix:"min",suffix:"start",expr:m}),e({prefix:"max",suffix:"start",expr:m}),e({prefix:"min",suffix:"end",expr:m}),e({prefix:"max",suffix:"end",expr:m})];return`${l}(${n.map(o=>`scale('${d}',${o})`).join(",")})`};let g,h;a.stack.fieldChannel==="x"?(g=Object.assign(Object.assign({},Wk(c.encode.update,["y","yc","y2","height",...Ix])),{x:{signal:f("min","datum")},x2:{signal:f("max","datum")},clip:{value:!0}}),h={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},c.encode.update=Object.assign(Object.assign({},He(c.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(g=Object.assign(Object.assign({},Wk(c.encode.update,["x","xc","x2","width"])),{y:{signal:f("min","datum")},y2:{signal:f("max","datum")},clip:{value:!0}}),h={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},c.encode.update=Object.assign(Object.assign({},He(c.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const l of Ix){const m=ch(l,a.markDef,a.config);c.encode.update[l]?(g[l]=c.encode.update[l],delete c.encode.update[l]):m&&(g[l]=ab(m)),m&&(c.encode.update[l]={value:0})}const i=a.fieldDef(a.stack.groupbyChannel),j=Q(i)?[Q(i)]:[];((i===null||i===void 0?void 0:i.bin)||(i===null||i===void 0?void 0:i.timeUnit))&&j.push(Q(i,{binSuffix:"end"}));const k=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return g=k.reduce((l,m)=>{if(c.encode.update[m])return Object.assign(Object.assign({},l),{[m]:c.encode.update[m]});{const n=ch(m,a.markDef,a.config);return n!==void 0?Object.assign(Object.assign({},l),{[m]:ab(n)}):l}},g),g.stroke&&(g.strokeForeground={value:!0},g.strokeOffset={value:0}),[{type:"group",from:{facet:{data:a.requestDataName(Pb),name:vP+a.requestDataName(Pb),groupby:j,aggregate:{fields:[e({suffix:"start"}),e({suffix:"start"}),e({suffix:"end"}),e({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:g},marks:[{type:"group",encode:{update:h},marks:[c]}]}]}else return wq(a)}function fla(a){const{encoding:b,stack:c,mark:d,markDef:e,config:f}=a,g=b.order;if(!J(g)&&Pe(g)&&qL(g.value)||!g&&qL(Aa("order",e,f)))return;{if((J(g)||R(g))&&!c)return cN(g,{expr:"datum"});if(Ug(d)){const h=e.orient==="horizontal"?"y":"x",i=b[h];if(R(i)){const j=i.sort;if(J(j))return{field:Q(i,{prefix:h,suffix:"sort_index",expr:"datum"})};{if(he(j))return{field:Q({aggregate:cy(a.encoding)?j.op:void 0,field:j.field},{expr:"datum"})};if(MM(j)){const k=a.fieldDef(j.encoding);return{field:Q(k,{expr:"datum"}),order:j.order}}else return j===null?void 0:{field:Q(i,{binSuffix:a.stack&&a.stack.impute?"mid":void 0,expr:"datum"})}}}return}}return}function wq(a,b={fromPrefix:""}){const{mark:c,markDef:d,config:e}=a,f=db(d.clip,gla(a),hla(a)),g=aN(d),h=a.encoding.key,i=fla(a),j=ila(a),k=Aa("aria",d,e),l=vq[c].postEncodingTransform?vq[c].postEncodingTransform(a):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a.getName("marks"),type:vq[c].vgMark},f?{clip:!0}:{}),g?{style:g}:{}),h?{key:h.field}:{}),i?{sort:i}:{}),j?j:{}),k===!1?{aria:k}:{}),{from:{data:b.fromPrefix+a.requestDataName(Pb)},encode:{update:vq[c].encodeEntry(a)}}),l?{transform:l}:{})]}function gla(a){const b=a.getScaleComponent("x"),c=a.getScaleComponent("y");return b&&b.get("selectionExtent")||c&&c.get("selectionExtent")?!0:void 0}function hla(a){const b=a.component.projection;return b&&!b.isFit?!0:void 0}function ila(a){if(!a.component.selection)return null;const b=O(a.component.selection).length;let c=b,d=a.parent;for(;d&&c===0;)c=O(d.component.selection).length,d=d.parent;return c?{interactive:b>0}:null}class wP extends nP{constructor(a,b,c,d={},e){var f,g;super(a,"unit",b,c,e,void 0,vN(a)?a.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const h=Yd(a.mark)?a.mark.type:a.mark;this.markDef=Hka(a.mark,(f=a.encoding)!==null&&f!==void 0?f:{},e,{graticule:a.data&&ty(a.data)});const i=this.encoding=bga((g=a.encoding)!==null&&g!==void 0?g:{},this.markDef,e);this.size=Gka({encoding:i,size:vN(a)?Object.assign(Object.assign(Object.assign({},d),a.width?{width:a.width}:{}),a.height?{height:a.height}:{}):d}),this.stack=CN(h,i),this.specifiedScales=this.initScales(h,i),this.specifiedAxes=this.initAxes(i),this.specifiedLegends=this.initLegend(i),this.specifiedProjection=a.projection,this.selection=a.selection}get hasProjection(){const{encoding:a}=this,b=this.mark===EL,c=a&&Gda.some(d=>ha(a[d]));return b||c}scaleDomain(a){const b=this.specifiedScales[a];return b?b.domain:void 0}axis(a){return this.specifiedAxes[a]}legend(a){return this.specifiedLegends[a]}initScales(a,b){return Fp.reduce((c,d)=>{var e;const f=kb(b[d]);return f&&(c[d]=(e=f.scale)!==null&&e!==void 0?e:{}),c},{})}initAxes(a){return cd.reduce((b,c)=>{const d=a[c];if(ha(d)||c===Ta&&ha(a.x2)||c===jb&&ha(a.y2)){const e=ha(d)?d.axis:void 0;b[c]=e?Object.assign({},e):e}return b},{})}initLegend(a){return Oda.reduce((b,c)=>{const d=kb(a[c]);if(d&&Qda(c)){const e=d.legend;b[c]=e?Object.assign({},e):e}return b},{})}parseData(){this.component.data=uq(this)}parseLayoutSize(){pka(this)}parseSelections(){this.component.selection=gia(this,this.selection)}parseMarkGroup(){this.component.mark=cla(this)}parseAxesAndHeaders(){this.component.axes=yka(this)}assembleSelectionTopLevelSignals(a){return Xha(this,a)}assembleSignals(){return[...rO(this),...Vha(this,[])]}assembleSelectionData(a){return Yha(this,a)}assembleLayout(){return null}assembleLayoutSignals(){return Ky(this)}assembleMarks(){var a;let b=(a=this.component.mark)!==null&&a!==void 0?a:[];return(!this.parent||!Ni(this.parent))&&(b=jO(this,b)),b.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(a){return dh(this.encoding,a)}fieldDef(a){const b=this.encoding[a];return je(b)}typedFieldDef(a){const b=this.fieldDef(a);return Lc(b)?b:null}}class xP extends Yy{constructor(a,b,c,d,e){super(a,"layer",b,c,e,a.resolve,a.view);const f=Object.assign(Object.assign(Object.assign({},d),a.width?{width:a.width}:{}),a.height?{height:a.height}:{});this.children=a.layer.map((g,h)=>{if(Zp(g))return new xP(g,this,this.getName("layer_"+h),f,e);if(Ie(g))return new wP(g,this,this.getName("layer_"+h),f,e);throw new Error(Bx(g))})}parseData(){this.component.data=uq(this);for(const a of this.children)a.parseData()}parseLayoutSize(){nka(this)}parseSelections(){this.component.selection={};for(const a of this.children){a.parseSelections();for(const b of O(a.component.selection))this.component.selection[b]=a.component.selection[b]}}parseMarkGroup(){for(const a of this.children)a.parseMarkGroup()}parseAxesAndHeaders(){Aka(this)}assembleSelectionTopLevelSignals(a){return this.children.reduce((b,c)=>c.assembleSelectionTopLevelSignals(b),a)}assembleSignals(){return this.children.reduce((a,b)=>a.concat(b.assembleSignals()),rO(this))}assembleLayoutSignals(){return this.children.reduce((a,b)=>a.concat(b.assembleLayoutSignals()),Ky(this))}assembleSelectionData(a){return this.children.reduce((b,c)=>c.assembleSelectionData(b),a)}assembleTitle(){let a=super.assembleTitle();if(a)return a;for(const b of this.children){a=b.assembleTitle();if(a)return a}return}assembleLayout(){return null}assembleMarks(){return Zha(this,this.children.flatMap(a=>a.assembleMarks()))}assembleLegends(){return this.children.reduce((a,b)=>a.concat(b.assembleLegends()),QO(this))}}function iz(a,b,c,d,e){if(Op(a))return new tq(a,b,c,e);{if(Zp(a))return new xP(a,b,c,d,e);{if(Ie(a))return new wP(a,b,c,d,e);if(wga(a))return new uka(a,b,c,e)}}throw new Error(Bx(a))}function jla(a,b={}){b.logger&&Pea(b.logger),b.fieldTitle&&WM(b.fieldTitle);try{const c=zN(Yi(b.config,a.config)),d=KN(a,c),e=iz(d,null,"",void 0,c);e.parse(),Dja(e.component.data,e);const f=lla(e,kla(a,d.autosize,c,e),a.datasets,a.usermeta);return{spec:f,normalized:d}}finally{b.logger&&Qea(),b.fieldTitle&&Wfa()}}function kla(a,b,c,d){const e=d.component.layoutSize.get("width"),f=d.component.layoutSize.get("height");b===void 0?(b={type:"pad"},d.hasAxisOrientSignalRef()&&(b.resize=!0)):V(b)&&(b={type:b});if(e&&f&&aha(b.type)){if(e==="step"&&f==="step")L(YL()),b.type="pad";else if(e==="step"||f==="step"){const g=e==="step"?"width":"height";L(YL(Ep(g)));const h=g==="width"?"height":"width";b.type=bha(h)}}return Object.assign(Object.assign(Object.assign({},O(b).length===1&&b.type?b.type==="pad"?{}:{autosize:b.type}:{autosize:b}),MN(c)),MN(a))}function lla(a,b,c={},d){const e=a.config?Iga(a.config):void 0,f=[].concat(a.assembleSelectionData([]),jka(a.component.data,c)),g=a.assembleProjections(),h=a.assembleTitle(),i=a.assembleGroupStyle(),j=a.assembleGroupEncodeEntry(!0);let k=a.assembleLayoutSignals();return k=k.filter(l=>(l.name==="width"||l.name==="height")&&l.value!==void 0?(b[l.name]=+l.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},a.description?{description:a.description}:{}),b),h?{title:h}:{}),i?{style:i}:{}),j?{encode:{update:j}}:{}),{data:f}),g.length>0?{projections:g}:{}),a.assembleGroup([...k,...a.assembleSelectionTopLevelSignals([])])),e?{config:e}:{}),d?{usermeta:d}:{})}class mla extends AN{mapUnit(a,{config:b}){if(a.encoding){const{encoding:c,transform:d}=a,{bins:e,timeUnits:f,aggregate:g,groupby:h,encoding:i}=dy(c,b),j=[...d?d:[],...e,...f,...g.length===0?[]:[{aggregate:g,groupby:h}]];return Object.assign(Object.assign(Object.assign({},a),j.length>0?{transform:j}:{}),{encoding:i})}else return a}}const nla=new mla();function ola(a,b){return nla.map(a,{config:b})}const pla=Wca.version;var qla=Object.freeze({__proto__:null,normalize:KN,version:pla,compile:jla,extractTransforms:ola}),yP=Cq(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});function c(d){var e=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g,f=e.exec(d).slice(1,3),g=f[0],h=f[1];return{library:g,version:h}}b.default=c});const rla="vega-themes",sla="2.8.3",tla="Themes for stylized Vega and Vega-Lite visualizations.",ula=["vega","vega-lite","themes","style"],vla="BSD-3-Clause",wla={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},xla=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],yla="build/vega-themes.js",zla="build/src/index.js",Ala="build/vega-themes.min.js",Bla="build/vega-themes.min.js",Cla="build/src/index.d.ts",Dla={type:"git",url:"https://github.com/vega/vega-themes.git"},Ela={prepare:"beemo create-config --silent",clean:"rm -rf build examples/build",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint 'src/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",prebuild:"mkdir -p build",build:"tsc && rollup -c",postbuild:"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'yarn serve' 'tsc -w' 'rollup -c -w'"},Fla={"@rollup/plugin-json":"^4.0.2","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",rollup:"^2.1.0",terser:"^4.6.7",typescript:"^3.8.3",vega:"^5.10.0","vega-lite":"^4.8.1","vega-lite-dev-config":"^0.5.0"},Gla={vega:"*","vega-lite":"*"},Hla={module:"vega-lite-dev-config",drivers:["prettier","eslint"]};var Ila={name:rla,version:sla,description:tla,keywords:ula,license:vla,author:wla,contributors:xla,main:yla,module:zla,unpkg:Ala,jsdelivr:Bla,typings:Cla,repository:Dla,scripts:Ela,devDependencies:Fla,peerDependencies:Gla,beemo:Hla};const ul="#fff",Jla="#888",Kla={background:"#333",title:{color:ul},style:{"guide-label":{fill:ul},"guide-title":{fill:ul}},axis:{domainColor:ul,gridColor:Jla,tickColor:ul}},jh="#4572a7",Lla={background:"#fff",arc:{fill:jh},area:{fill:jh},line:{stroke:jh,strokeWidth:2},path:{stroke:jh},rect:{fill:jh},shape:{stroke:jh},symbol:{fill:jh,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},kh="#30a2da",jz="#cbcbcb",Mla="#999",Nla="#333",zP="#f0f0f0",AP="#333",Ola={arc:{fill:kh},area:{fill:kh},axis:{domainColor:jz,grid:!0,gridColor:jz,gridWidth:1,labelColor:Mla,labelFontSize:10,titleColor:Nla,tickColor:jz,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:zP,group:{fill:zP},legend:{labelColor:AP,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:AP,titleFontSize:14,titlePadding:10},line:{stroke:kh,strokeWidth:2},path:{stroke:kh,strokeWidth:.5},rect:{fill:kh},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:kh},bar:{binSpacing:2,fill:kh,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},lh="#000",Pla={group:{fill:"#e5e5e5"},arc:{fill:lh},area:{fill:lh},line:{stroke:lh},path:{stroke:lh},rect:{fill:lh},shape:{stroke:lh},symbol:{fill:lh,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Qla=22,Rla="normal",BP="Benton Gothic, sans-serif",CP=11.5,Sla="normal",mh="#82c6df",kz="Benton Gothic Bold, sans-serif",DP="normal",EP=13,vl={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Tla={background:"#ffffff",title:{anchor:"start",color:"#000000",font:kz,fontSize:Qla,fontWeight:Rla},arc:{fill:mh},area:{fill:mh},line:{stroke:mh,strokeWidth:2},path:{stroke:mh},rect:{fill:mh},shape:{stroke:mh},symbol:{fill:mh,size:30},axis:{labelFont:BP,labelFontSize:CP,labelFontWeight:Sla,titleFont:kz,titleFontSize:EP,titleFontWeight:DP},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:BP,labelFontSize:CP,symbolType:"square",titleFont:kz,titleFontSize:EP,titleFontWeight:DP},range:{category:vl["category-6"],diverging:vl["fireandice-6"],heatmap:vl["fire-7"],ordinal:vl["fire-7"],ramp:vl["fire-7"]}},nh="#ab5787",xq="#979797",Ula={background:"#f9f9f9",arc:{fill:nh},area:{fill:nh},line:{stroke:nh},path:{stroke:nh},rect:{fill:nh},shape:{stroke:nh},symbol:{fill:nh,size:30},axis:{domainColor:xq,domainWidth:.5,gridWidth:.2,labelColor:xq,tickColor:xq,tickWidth:.2,titleColor:xq},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},oh="#3e5c69",Vla={background:"#fff",arc:{fill:oh},area:{fill:oh},line:{stroke:oh},path:{stroke:oh},rect:{fill:oh},shape:{stroke:oh},symbol:{fill:oh},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},gd="#1696d2",FP="#000000",Wla="#FFFFFF",yq="Lato",lz="Lato",Xla="Lato",Yla="#DEDDDD",Zla=18,wl={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},_la={background:Wla,title:{anchor:"start",fontSize:Zla,font:yq},axisX:{domain:!0,domainColor:FP,domainWidth:1,grid:!1,labelFontSize:12,labelFont:lz,labelAngle:0,tickColor:FP,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:yq},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Yla,gridWidth:1,labelFontSize:12,labelFont:lz,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:yq,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:lz,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:yq,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:wl["six-groups-cat-1"],diverging:wl["diverging-colors"],heatmap:wl["diverging-colors"],ordinal:wl["six-groups-seq"],ramp:wl["shades-blue"]},area:{fill:gd},rect:{fill:gd},line:{color:gd,stroke:gd,strokeWidth:5},trail:{color:gd,stroke:gd,strokeWidth:0,size:1},path:{stroke:gd,strokeWidth:.5},point:{filled:!0},text:{font:Xla,color:gd,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:gd,stroke:null}},arc:{fill:gd},shape:{stroke:gd},symbol:{fill:gd,size:30}},ph="#3366CC",GP="#ccc",zq="Arial, sans-serif",$la={arc:{fill:ph},area:{fill:ph},path:{stroke:ph},rect:{fill:ph},shape:{stroke:ph},symbol:{stroke:ph},circle:{fill:ph},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:zq,fontSize:12},"guide-title":{font:zq,fontSize:12},"group-title":{font:zq,fontSize:12}},title:{font:zq,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:GP,tickColor:GP,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},ama=Ila.version;var bma=Object.freeze({__proto__:null,version:ama,dark:Kla,excel:Lla,fivethirtyeight:Ola,ggplot2:Pla,latimes:Tla,quartz:Ula,vox:Vla,urbaninstitute:_la,googlecharts:$la}),cma=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const HP="vg-tooltip-element",dma={offsetX:10,offsetY:10,id:HP,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:ema,maxDepth:2};function ema(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function fma(a){if(!/^[A-Za-z]+[-:.\w]*$/.test(a))throw new Error("Invalid HTML ID");return cma.toString().replace(HP,a)}var gma=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};function hma(a,b,c){if(J(a))return`[${a.map(d=>b(V(d)?d:IP(d,c))).join(", ")}]`;if(Z(a)){let d="";const e=a,{title:f,image:g}=e,h=gma(e,["title","image"]);f&&(d+=`<h2>${b(f)}</h2>`),g&&(d+=`<img src="${b(g)}">`);const i=Object.keys(h);if(i.length>0){d+="<table>";for(const j of i){let k=h[j];if(k===void 0)continue;Z(k)&&(k=IP(k,c)),d+=`<tr><td class="key">${b(j)}:</td><td class="value">${b(k)}</td></tr>`}d+="</table>"}return d||"{}"}return b(a)}function ima(a){const b=[];return function(c,d){if(typeof d!=="object"||d===null)return d;const e=b.indexOf(this)+1;return b.length=e,b.length>a?"[Object]":b.indexOf(d)>=0?"[Circular]":(b.push(d),d)}}function IP(a,b){return JSON.stringify(a,ima(b))}function jma(a,b,c,d){let e=a.clientX+c;e+b.width>window.innerWidth&&(e=+a.clientX-c-b.width);let f=a.clientY+d;return f+b.height>window.innerHeight&&(f=+a.clientY-d-b.height),{x:e,y:f}}class kma{constructor(a){this.options=Object.assign(Object.assign({},dma),a);const b=this.options.id;this.call=this.tooltipHandler.bind(this);if(!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const c=document.createElement("style");c.setAttribute("id",this.options.styleId),c.innerHTML=fma(b);const d=document.head;d.childNodes.length>0?d.insertBefore(c,d.childNodes[0]):d.appendChild(c)}this.el=document.getElementById(b),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",b),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(a,b,c,d){if(d==null||d===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=hma(d,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:e,y:f}=jma(b,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${f}px; left: ${e}px`)}}function lma(a,b,c){const d=a.open(b),e=1e4,f=250,{origin:g}=new URL(b);let h=~~(e/f);function i(k){k.source===d&&(h=0,a.removeEventListener("message",i,!1))}a.addEventListener("message",i,!1);function j(){if(h<=0)return;d.postMessage(c,g),setTimeout(j,f),h-=1}setTimeout(j,f)}var mma=`.vega-embed {
  position: relative;
  display: inline-block; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: scroll;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return this.substr(!b||b<0?0:+b,a.length)===a});function JP(a,...b){for(const c of b)nma(a,c);return a}function nma(a,b){for(const c of Object.keys(b))Pl(a,c,b[c],!0)}var mz;const qh=Aca;let xl=qla;const Aq=typeof window!=="undefined"?window:void 0;xl===void 0&&((mz=Aq===null||Aq===void 0?void 0:Aq.vl)===null||mz===void 0?void 0:mz.compile)&&(xl=Aq.vl);const oma={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},pma={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},yl={vega:"Vega","vega-lite":"Vega-Lite"},Bq={vega:qh.version,"vega-lite":xl?xl.version:"not available"},qma={vega:a=>a,"vega-lite":(a,b)=>xl.compile(a,{config:b}).spec},rma=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`;function sma(a){return typeof a==="function"}function KP(a,b,c,d){const e=`<html><head>${b}</head><body><pre><code class="json">`,f=`</code></pre>${c}</body></html>`,g=window.open("");g.document.write(e+a+f),g.document.title=`${yl[d]} JSON Source`}function tma(a,b){var c;if(a.$schema){const d=yP(a.$schema);b&&b!==d.library&&console.warn(`The given visualization spec is written in ${yl[d.library]}, but mode argument sets ${(c=yl[b])!==null&&c!==void 0?c:b}.`);const e=d.library;return Fz.satisfies(Bq[e],`^${d.version.slice(1)}`)||console.warn(`The input spec uses ${yl[e]} ${d.version}, but the current version of ${yl[e]} is v${Bq[e]}.`),e}return"mark"in a||"encoding"in a||"layer"in a||"hconcat"in a||"vconcat"in a||"facet"in a||"repeat"in a?"vega-lite":"marks"in a||"signals"in a||"scales"in a||"axes"in a?"vega":b!==null&&b!==void 0?b:"vega"}function uma(a){return!!(a&&"load"in a)}function vma(a,b,c={}){var d,e,f;return zl(this,void 0,void 0,function*(){const g=uma(c.loader)?c.loader:qh.loader(c.loader),h=V(b)?JSON.parse(yield g.load(b)):b,i=yield LP((d=h.usermeta&&h.usermeta.embedOptions)!==null&&d!==void 0?d:{},g),j=yield LP(c,g),k=Object.assign(Object.assign({},JP(j,i)),{config:Yi((e=j.config)!==null&&e!==void 0?e:{},(f=i.config)!==null&&f!==void 0?f:{})});return yield wma(a,h,k,g)})}function LP(a,b){var c;return zl(this,void 0,void 0,function*(){const d=V(a.config)?JSON.parse(yield b.load(a.config)):(c=a.config)!==null&&c!==void 0?c:{},e=V(a.patch)?JSON.parse(yield b.load(a.patch)):a.patch;return Object.assign(Object.assign(Object.assign({},a),e?{patch:e}:{}),d?{config:d}:{})})}function wma(a,b,c={},d){var e,f,g,h,i,j;return zl(this,void 0,void 0,function*(){const k=c.theme?Yi(bma[c.theme],(e=c.config)!==null&&e!==void 0?e:{}):c.config,l=bg(c.actions)?c.actions:JP({},oma,(f=c.actions)!==null&&f!==void 0?f:{}),m=Object.assign(Object.assign({},pma),c.i18n),n=(g=c.renderer)!==null&&g!==void 0?g:"canvas",o=(h=c.logLevel)!==null&&h!==void 0?h:qh.Warn,p=(i=c.downloadFileName)!==null&&i!==void 0?i:"visualization";if(c.defaultStyle!==!1){const y="vega-embed-style";if(!document.getElementById(y)){const B=document.createElement("style");B.id=y,B.innerText=c.defaultStyle===void 0||c.defaultStyle===!0?mma.toString():c.defaultStyle,document.head.appendChild(B)}}const q=tma(b,c.mode);let r=qma[q](b,k);if(q==="vega-lite"){if(r.$schema){const y=yP(r.$schema);Fz.satisfies(Bq.vega,`^${y.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${y.version}, but current version is v${Bq.vega}.`)}}const s=typeof a==="string"?document.querySelector(a):a;if(!s)throw Error(`${a} does not exist`);s.classList.add("vega-embed"),l&&s.classList.add("has-actions"),s.innerHTML="";const t=c.patch;t&&(t instanceof Function?r=t(r):r=Bl(r,t,!0,!1).newDocument),c.formatLocale&&qh.formatLocale(c.formatLocale),c.timeFormatLocale&&qh.timeFormatLocale(c.timeFormatLocale);const w=qh.parse(r,q==="vega-lite"?{}:k),v=new qh.View(w,{loader:d,logLevel:o,renderer:n});if(c.tooltip!==!1){let y;sma(c.tooltip)?y=c.tooltip:y=new kma(c.tooltip===!0?{}:c.tooltip).call,v.tooltip(y)}let{hover:x}=c;x===void 0&&(x=q==="vega");if(x){const{hoverSet:y,updateSet:B}=typeof x==="boolean"?{}:x;v.hover(y,B)}c&&(c.width!=null&&v.width(c.width),c.height!=null&&v.height(c.height),c.padding!=null&&v.padding(c.padding)),yield v.initialize(a).runAsync();let u;if(l!==!1){let y=s;if(c.defaultStyle!==!1){const A=document.createElement("details");A.title=m.CLICK_TO_VIEW_ACTIONS,s.append(A),y=A;const C=document.createElement("summary");C.innerHTML=rma,A.append(C),u=F=>{A.contains(F.target)||A.removeAttribute("open")},document.addEventListener("click",u)}const B=document.createElement("div");y.append(B),B.classList.add("vega-actions");if(l===!0||l.export!==!1){for(const A of["svg","png"])if(l===!0||l.export===!0||l.export[A]){const C=m[`${A.toUpperCase()}_ACTION`],F=document.createElement("a");F.text=C,F.href="#",F.target="_blank",F.download=`${p}.${A}`,F.addEventListener("mousedown",function(K){return zl(this,void 0,void 0,function*(){K.preventDefault();const D=yield v.toImageURL(A,c.scaleFactor);this.href=D})}),B.append(F)}}if(l===!0||l.source!==!1){const A=document.createElement("a");A.text=m.SOURCE_ACTION,A.href="#",A.addEventListener("click",function(C){var F,K;KP(Kq(b),(F=c.sourceHeader)!==null&&F!==void 0?F:"",(K=c.sourceFooter)!==null&&K!==void 0?K:"",q),C.preventDefault()}),B.append(A)}if(q==="vega-lite"&&(l===!0||l.compiled!==!1)){const A=document.createElement("a");A.text=m.COMPILED_ACTION,A.href="#",A.addEventListener("click",function(C){var F,K;KP(Kq(r),(F=c.sourceHeader)!==null&&F!==void 0?F:"",(K=c.sourceFooter)!==null&&K!==void 0?K:"","vega"),C.preventDefault()}),B.append(A)}if(l===!0||l.editor!==!1){const A=(j=c.editorUrl)!==null&&j!==void 0?j:"https://vega.github.io/editor/",C=document.createElement("a");C.text=m.EDITOR_ACTION,C.href="#",C.addEventListener("click",function(F){lma(window,A,{config:k,mode:q,renderer:n,spec:Kq(b)}),F.preventDefault()}),B.append(C)}}function z(){u&&document.removeEventListener("click",u),v.finalize()}return{view:v,spec:b,vgSpec:r,finalize:z}})}export default vma;
