import{c as Om,g as L3}from"./common/_commonjsHelpers-be8ed69f.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Z(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Sf(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function s(c){try{u(i.next(c))}catch(f){o(f)}}function l(c){try{u(i.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):r(c.value).then(s,l)}u((i=i.apply(e,t||[])).next())})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var P3=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i())}}(),z3=Object.prototype.hasOwnProperty;function Tm(e,t){return z3.call(e,t)}function Cm(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var i in e)Tm(e,i)&&t.push(i);return t}function Cn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function $m(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Xa(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function hE(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Dm(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Dm(e[t]))return!0}else if(typeof e=="object"){for(var i=Cm(e),r=i.length,t=0;t<r;t++)if(Dm(e[i[t]]))return!0}}return!1}function pE(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var gE=function(e){P3(t,e);function t(n,i,r,a,o){var s=this.constructor,l=e.call(this,pE(n,{name:i,index:r,operation:a,tree:o}))||this;return l.name=i,l.index=r,l.operation=a,l.tree=o,Object.setPrototypeOf(l,s.prototype),l.message=pE(n,{name:i,index:r,operation:a,tree:o}),l}return t}(Error),Ke=gE,B3=Cn,bs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Of(n,this.path);i&&(i=Cn(i));var r=Ja(n,{op:"remove",path:this.from}).removed;return Ja(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Of(n,this.from);return Ja(n,{op:"add",path:this.path,value:Cn(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Bl(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},U3={add:function(e,t,n){return $m(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:bs.move,copy:bs.copy,test:bs.test,_get:bs._get};function Of(e,t){if(t=="")return e;var n={op:"_get",path:t};return Ja(e,n),n.value}function Ja(e,t,n,i,r,a){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),a===void 0&&(a=0),n&&(typeof n=="function"?n(t,0,e,t.path):Cf(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Of(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Bl(e,t.value),o.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Ke("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}}else{i||(e=Cn(e));var s=t.path||"",l=s.split("/"),u=e,c=1,f=l.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Cf;;){if(h=l[c],r&&h=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&(d===void 0&&(u[h]===void 0?d=l.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d))),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(n&&!$m(h))throw new Ke("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);$m(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>u.length)throw new Ke("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var o=U3[t.op].call(t,u,h,e);if(o.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&h.indexOf("~")!=-1&&(h=hE(h)),c>=f){var o=bs[t.op].call(t,u,h,e);if(o.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}u=u[h]}}}function Tf(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new Ke("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Cn(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=Ja(e,t[o],n,!0,r,o),e=a[o].newDocument;return a.newDocument=e,a}function q3(e,t,n){var i=Ja(e,t);if(i.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function Cf(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ke("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(bs[e.op]){if(typeof e.path!="string")throw new Ke("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ke('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ke("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ke("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Dm(e.value))throw new Ke("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,a=i.split("/").length;if(r!==a+1&&r!==a)throw new Ke("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new Ke("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},s=mE([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ke("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Ke("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function mE(e,t,n){try{if(!Array.isArray(e))throw new Ke("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Tf(Cn(t),Cn(e),n||!0);else{n=n||Cf;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof Ke)return r;throw r}}function Bl(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,a,o;if(n&&i){if(a=e.length,a!=t.length)return!1;for(r=a;r--!==0;)if(!Bl(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var s=Object.keys(e);if(a=s.length,a!==Object.keys(t).length)return!1;for(r=a;r--!==0;)if(!t.hasOwnProperty(s[r]))return!1;for(r=a;r--!==0;)if(o=s[r],!Bl(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var W3=Object.freeze({__proto__:null,JsonPatchError:Ke,deepClone:B3,getValueByPointer:Of,applyOperation:Ja,applyPatch:Tf,applyReducer:q3,validator:Cf,validate:mE,_areEquals:Bl});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Rm=new WeakMap(),G3=function(){function e(t){this.observers=new Map(),this.obj=t}return e}(),H3=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Y3(e){return Rm.get(e)}function V3(e,t){return e.observers.get(t)}function X3(e,t){e.observers.delete(t.callback)}function J3(e,t){t.unobserve()}function K3(e,t){var n=[],i,r=Y3(e);if(!r)r=new G3(e),Rm.set(e,r);else{var a=V3(r,t);i=a&&a.observer}if(i)return i;if(i={},r.value=Cn(e),t){i.callback=t,i.next=null;var o=function(){Fm(i)},s=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return i.patches=n,i.object=e,i.unobserve=function(){Fm(i),clearTimeout(i.next),X3(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new H3(t,i)),i}function Fm(e,t){t===void 0&&(t=!1);var n=Rm.get(e.object);Nm(n.value,e.object,e.patches,"",t),e.patches.length&&Tf(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Nm(e,t,n,i,r){if(t===e)return;typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=Cm(t),o=Cm(e),s=!1,l=o.length-1;l>=0;l--){var u=o[l],c=e[u];if(Tm(t,u)&&!(t[u]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[u];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null?Nm(c,f,n,i+"/"+Xa(u),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Xa(u),value:Cn(c)}),n.push({op:"replace",path:i+"/"+Xa(u),value:Cn(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Xa(u),value:Cn(c)}),n.push({op:"remove",path:i+"/"+Xa(u)}),s=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!s&&a.length==o.length)return;for(var l=0;l<a.length;l++){var u=a[l];!Tm(e,u)&&t[u]!==void 0&&n.push({op:"add",path:i+"/"+Xa(u),value:Cn(t[u])})}}function Q3(e,t,n){n===void 0&&(n=!1);var i=[];return Nm(e,t,i,"",n),i}var Z3=Object.freeze({__proto__:null,unobserve:J3,observe:K3,generate:Fm,compare:Q3});Object.assign({},W3,Z3,{JsonPatchError:gE,deepClone:Cn,escapePathComponent:Xa,unescapePathComponent:hE});var eL=/("(?:[^\\"]|\\.)*")|[:,]/g,Im=function(t,n){var i,r,a;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?Infinity:n.maxLength===void 0?80:n.maxLength,a=n.replacer,function o(s,l,u){var c,f,d,h,p,g,m,v,y,b,E,x;if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),E=JSON.stringify(s,a),E===void 0)return E;if(m=r-l.length-u,E.length<=m&&(y=E.replace(eL,function(k,w){return w||k+" "}),y.length<=m))return y;if(a!=null&&(s=JSON.parse(E),a=void 0),typeof s=="object"&&s!==null){if(v=l+i,d=[],f=0,Array.isArray(s))for(b="[",c="]",m=s.length;f<m;f++)d.push(o(s[f],v,f===m-1?0:1)||"null");else for(b="{",c="}",g=Object.keys(s),m=g.length;f<m;f++)h=g[f],p=JSON.stringify(h)+": ",x=o(s[h],v,p.length+(f===m-1?0:1)),x!==void 0&&d.push(p+x);if(d.length>0)return[b,i+d.join(`,
`+v),c].join(`
`+l)}return E}(t,"",0)};const tL="2.0.0",nL=256,iL=Number.MAX_SAFE_INTEGER||9007199254740991,rL=16;var $f={SEMVER_SPEC_VERSION:tL,MAX_LENGTH:nL,MAX_SAFE_INTEGER:iL,MAX_SAFE_COMPONENT_LENGTH:rL};const aL=()=>{};var Df=aL,Xr=Om(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=$f;t=e.exports={};const i=t.re=[],r=t.src=[],a=t.t={};let o=0;const s=(l,u,c)=>{const f=o++;a[l]=f,r[f]=u,i[f]=new RegExp(u,c?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${r[a.NUMERICIDENTIFIER]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${r[a.NUMERICIDENTIFIERLOOSE]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${r[a.PRERELEASEIDENTIFIER]}(?:\\.${r[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${r[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${r[a.BUILDIDENTIFIER]}(?:\\.${r[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${r[a.MAINVERSION]}${r[a.PRERELEASE]}?${r[a.BUILD]}?`),s("FULL",`^${r[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${r[a.MAINVERSIONLOOSE]}${r[a.PRERELEASELOOSE]}?${r[a.BUILD]}?`),s("LOOSE",`^${r[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${r[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${r[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:${r[a.PRERELEASE]})?${r[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:${r[a.PRERELEASELOOSE]})?${r[a.BUILD]}?)?)?`),s("XRANGE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",r[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${r[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${r[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${r[a.LONECARET]}${r[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${r[a.LONECARET]}${r[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${r[a.GTLT]}\\s*(${r[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]}|${r[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${r[a.XRANGEPLAIN]})\\s+-\\s+(${r[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${r[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${r[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});const vE=/^[0-9]+$/,yE=(e,t)=>{const n=vE.test(e),i=vE.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},oL=(e,t)=>yE(t,e);var Mm={compareIdentifiers:yE,rcompareIdentifiers:oL};const{MAX_LENGTH:bE,MAX_SAFE_INTEGER:Rf}=$f,{re:wE,t:xE}=Xr,{compareIdentifiers:Ul}=Mm;class Di{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Di){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>bE)throw new TypeError(`version is longer than ${bE} characters`);this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?wE[xE.LOOSE]:wE[xE.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Rf||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Rf||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Rf||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const r=+i;if(r>=0&&r<Rf)return r}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Df("SemVer.compare",this.version,this.options),!(e instanceof Di)){if(typeof e=="string"&&e===this.version)return 0;e=new Di(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Di||(e=new Di(e,this.options)),Ul(this.major,e.major)||Ul(this.minor,e.minor)||Ul(this.patch,e.patch)}comparePre(e){if(e instanceof Di||(e=new Di(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ul(n,i)}while(++t)}compareBuild(e){e instanceof Di||(e=new Di(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ul(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Qe=Di;const{MAX_LENGTH:sL}=$f,{re:EE,t:kE}=Xr,lL=(e,t)=>{if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Qe)return e;if(typeof e!="string")return null;if(e.length>sL)return null;const n=t.loose?EE[kE.LOOSE]:EE[kE.FULL];if(!n.test(e))return null;try{return new Qe(e,t)}catch(i){return null}};var Ka=lL;const uL=(e,t)=>{const n=Ka(e,t);return n?n.version:null};var cL=uL;const fL=(e,t)=>{const n=Ka(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var dL=fL;const hL=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new Qe(e,n).inc(t,i).version}catch(r){return null}};var pL=hL;const gL=(e,t,n)=>new Qe(e,n).compare(new Qe(t,n));var $n=gL;const mL=(e,t,n)=>$n(e,t,n)===0;var jm=mL;const vL=(e,t)=>{if(jm(e,t))return null;{const n=Ka(e),i=Ka(t),r=n.prerelease.length||i.prerelease.length,a=r?"pre":"",o=r?"prerelease":"";for(const s in n)if((s==="major"||s==="minor"||s==="patch")&&n[s]!==i[s])return a+s;return o}};var yL=vL;const bL=(e,t)=>new Qe(e,t).major;var wL=bL;const xL=(e,t)=>new Qe(e,t).minor;var EL=xL;const kL=(e,t)=>new Qe(e,t).patch;var _L=kL;const AL=(e,t)=>{const n=Ka(e,t);return n&&n.prerelease.length?n.prerelease:null};var SL=AL;const OL=(e,t,n)=>$n(t,e,n);var TL=OL;const CL=(e,t)=>$n(e,t,!0);var $L=CL;const DL=(e,t,n)=>{const i=new Qe(e,n),r=new Qe(t,n);return i.compare(r)||i.compareBuild(r)};var Lm=DL;const RL=(e,t)=>e.sort((n,i)=>Lm(n,i,t));var FL=RL;const NL=(e,t)=>e.sort((n,i)=>Lm(i,n,t));var IL=NL;const ML=(e,t,n)=>$n(e,t,n)>0;var ql=ML;const jL=(e,t,n)=>$n(e,t,n)<0;var Ff=jL;const LL=(e,t,n)=>$n(e,t,n)!==0;var _E=LL;const PL=(e,t,n)=>$n(e,t,n)>=0;var Pm=PL;const zL=(e,t,n)=>$n(e,t,n)<=0;var zm=zL;const BL=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return jm(e,n,i);case"!=":return _E(e,n,i);case">":return ql(e,n,i);case">=":return Pm(e,n,i);case"<":return Ff(e,n,i);case"<=":return zm(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var Nf=BL;const{re:If,t:Mf}=Xr,UL=(e,t)=>{if(e instanceof Qe)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(If[Mf.COERCE]);else{let i;for(;(i=If[Mf.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),If[Mf.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;If[Mf.COERCERTL].lastIndex=-1}return n===null?null:Ka(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var qL=UL;class jf{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof jf)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new jf(e.raw,t);if(e instanceof Qa)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=this.options.loose;e=e.trim();const n=t?Rt[xt.HYPHENRANGELOOSE]:Rt[xt.HYPHENRANGE];e=e.replace(n,nP(this.options.includePrerelease)),e=e.replace(Rt[xt.COMPARATORTRIM],WL),Df("comparator trim",e,Rt[xt.COMPARATORTRIM]),e=e.replace(Rt[xt.TILDETRIM],GL),e=e.replace(Rt[xt.CARETTRIM],HL),e=e.split(/\s+/).join(" ");const i=t?Rt[xt.COMPARATORLOOSE]:Rt[xt.COMPARATOR];return e.split(" ").map(r=>YL(r,this.options)).join(" ").split(/\s+/).map(r=>tP(r,this.options)).filter(this.options.loose?r=>!!r.match(i):()=>!0).map(r=>new Qa(r,this.options))}intersects(e,t){if(!(e instanceof jf))throw new TypeError("a Range is required");return this.set.some(n=>AE(n,t)&&e.set.some(i=>AE(i,t)&&n.every(r=>i.every(a=>r.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Qe(e,this.options)}catch(t){return!1}for(let t=0;t<this.set.length;t++)if(iP(this.set[t],e,this.options))return!0;return!1}}var un=jf;const{re:Rt,t:xt,comparatorTrimReplace:WL,tildeTrimReplace:GL,caretTrimReplace:HL}=Xr,AE=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every(a=>r.intersects(a,t)),r=i.pop();return n},YL=(e,t)=>(e=JL(e,t),e=VL(e,t),e=QL(e,t),e=eP(e),e),Wt=e=>!e||e.toLowerCase()==="x"||e==="*",VL=(e,t)=>e.trim().split(/\s+/).map(n=>XL(n,t)).join(" "),XL=(e,t)=>{const n=t.loose?Rt[xt.TILDELOOSE]:Rt[xt.TILDE];return e.replace(n,(i,r,a,o,s)=>{let l;return Wt(r)?l="":Wt(a)?l=`>=${r}.0.0 <${+r+1}.0.0-0`:Wt(o)?l=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:s?l=`>=${r}.${a}.${o}-${s} <${r}.${+a+1}.0-0`:l=`>=${r}.${a}.${o} <${r}.${+a+1}.0-0`,l})},JL=(e,t)=>e.trim().split(/\s+/).map(n=>KL(n,t)).join(" "),KL=(e,t)=>{const n=t.loose?Rt[xt.CARETLOOSE]:Rt[xt.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,(r,a,o,s,l)=>{let u;return Wt(a)?u="":Wt(o)?u=`>=${a}.0.0${i} <${+a+1}.0.0-0`:Wt(s)?a==="0"?u=`>=${a}.${o}.0${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.0${i} <${+a+1}.0.0-0`:l?a==="0"?o==="0"?u=`>=${a}.${o}.${s}-${l} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}-${l} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s}-${l} <${+a+1}.0.0-0`:a==="0"?o==="0"?u=`>=${a}.${o}.${s}${i} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s} <${+a+1}.0.0-0`,u})},QL=(e,t)=>e.split(/\s+/).map(n=>ZL(n,t)).join(" "),ZL=(e,t)=>{e=e.trim();const n=t.loose?Rt[xt.XRANGELOOSE]:Rt[xt.XRANGE];return e.replace(n,(i,r,a,o,s,l)=>{const u=Wt(a),c=u||Wt(o),f=c||Wt(s),d=f;return r==="="&&d&&(r=""),l=t.includePrerelease?"-0":"",u?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&d?(c&&(o=0),s=0,r===">"?(r=">=",c?(a=+a+1,o=0,s=0):(o=+o+1,s=0)):r==="<="&&(r="<",c?a=+a+1:o=+o+1),r==="<"&&(l="-0"),i=`${r+a}.${o}.${s}${l}`):c?i=`>=${a}.0.0${l} <${+a+1}.0.0-0`:f&&(i=`>=${a}.${o}.0${l} <${a}.${+o+1}.0-0`),i})},eP=(e,t)=>e.trim().replace(Rt[xt.STAR],""),tP=(e,t)=>e.trim().replace(Rt[t.includePrerelease?xt.GTE0PRE:xt.GTE0],""),nP=e=>(t,n,i,r,a,o,s,l,u,c,f,d,h)=>(Wt(i)?n="":Wt(r)?n=`>=${i}.0.0${e?"-0":""}`:Wt(a)?n=`>=${i}.${r}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,Wt(u)?l="":Wt(c)?l=`<${+u+1}.0.0-0`:Wt(f)?l=`<${u}.${+c+1}.0-0`:d?l=`<=${u}.${c}.${f}-${d}`:e?l=`<${u}.${c}.${+f+1}-0`:l=`<=${l}`,`${n} ${l}`.trim()),iP=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let i=0;i<e.length;i++){if(Df(e[i].semver),e[i].semver===Qa.ANY)continue;if(e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}}return!1}return!0},Wl=Symbol("SemVer ANY");class Bm{static get ANY(){return Wl}constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Bm){if(e.loose===!!t.loose)return e;e=e.value}this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Wl?this.value="":this.value=this.operator+this.semver.version}parse(e){const t=this.options.loose?SE[OE.COMPARATORLOOSE]:SE[OE.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Qe(n[2],this.options.loose):this.semver=Wl}toString(){return this.value}test(e){if(Df("Comparator.test",e,this.options.loose),this.semver===Wl||e===Wl)return!0;if(typeof e=="string")try{e=new Qe(e,this.options)}catch(t){return!1}return Nf(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Bm))throw new TypeError("a Comparator is required");if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new un(e.value,t).test(this.value);if(e.operator==="")return e.value===""?!0:new un(this.value,t).test(e.semver);const n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),r=this.semver.version===e.semver.version,a=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),o=Nf(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),s=Nf(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||i||r&&a||o||s}}var Qa=Bm;const{re:SE,t:OE}=Xr,rP=(e,t,n)=>{try{t=new un(t,n)}catch(i){return!1}return t.test(e)};var Jr=rP;const aP=(e,t)=>new un(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var oP=aP;const sP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new un(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===-1)&&(i=o,r=new Qe(i,n)))}),i};var lP=sP;const uP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new un(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===1)&&(i=o,r=new Qe(i,n)))}),i};var cP=uP;const fP=(e,t)=>{e=new un(e,t);let n=new Qe("0.0.0");if(e.test(n))return n;if(n=new Qe("0.0.0-0"),e.test(n))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];r.forEach(a=>{const o=new Qe(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!n||ql(n,o))&&(n=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}})}return n&&e.test(n)?n:null};var dP=fP;const hP=(e,t)=>{try{return new un(e,t).range||"*"}catch(n){return null}};var pP=hP;const{ANY:gP}=Qa,mP=(e,t,n,i)=>{e=new Qe(e,i),t=new un(t,i);let r,a,o,s,l;switch(n){case">":r=ql,a=zm,o=Ff,s=">",l=">=";break;case"<":r=Ff,a=Pm,o=ql,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Jr(e,t,i))return!1;for(let u=0;u<t.set.length;++u){const c=t.set[u];let f=null,d=null;if(c.forEach(h=>{h.semver===gP&&(h=new Qa(">=0.0.0")),f=f||h,d=d||h,r(h.semver,f.semver,i)?f=h:o(h.semver,d.semver,i)&&(d=h)}),f.operator===s||f.operator===l)return!1;if((!d.operator||d.operator===s)&&a(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};var Um=mP;const vP=(e,t,n)=>Um(e,t,">",n);var yP=vP;const bP=(e,t,n)=>Um(e,t,"<",n);var wP=bP;const xP=(e,t,n)=>(e=new un(e,n),t=new un(t,n),e.intersects(t));var EP=xP,kP=(e,t,n)=>{const i=[];let r=null,a=null;const o=e.sort((c,f)=>$n(c,f,n));for(const c of o){const f=Jr(c,t,n);f?(a=c,r||(r=c)):(a&&i.push([r,a]),a=null,r=null)}r&&i.push([r,null]);const s=[];for(const[c,f]of i)c===f?s.push(c):!f&&c===o[0]?s.push("*"):f?c===o[0]?s.push(`<=${f}`):s.push(`${c} - ${f}`):s.push(`>=${c}`);const l=s.join(" || "),u=typeof t.raw=="string"?t.raw:String(t);return l.length<u.length?l:t};const{ANY:TE}=Qa,_P=(e,t,n)=>{e=new un(e,n),t=new un(t,n);let i=!1;e:for(const r of e.set){for(const a of t.set){const o=AP(r,a,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},AP=(e,t,n)=>{if(e.length===1&&e[0].semver===TE)return t.length===1&&t[0].semver===TE;const i=new Set();let r,a;for(const f of e)f.operator===">"||f.operator===">="?r=CE(r,f,n):f.operator==="<"||f.operator==="<="?a=$E(a,f,n):i.add(f.semver);if(i.size>1)return null;let o;if(r&&a){if(o=$n(r.semver,a.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||a.operator!=="<="))return null}for(const f of i){if(r&&!Jr(f,String(r),n))return null;if(a&&!Jr(f,String(a),n))return null;for(const d of t)if(!Jr(f,String(d),n))return!1;return!0}let s,l,u,c;for(const f of t){if(c=c||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",r){if(f.operator===">"||f.operator===">="){if(s=CE(r,f,n),s===f)return!1}else if(r.operator===">="&&!Jr(r.semver,String(f),n))return!1}if(a){if(f.operator==="<"||f.operator==="<="){if(l=$E(a,f,n),l===f)return!1}else if(a.operator==="<="&&!Jr(a.semver,String(f),n))return!1}if(!f.operator&&(a||r)&&o!==0)return!1}return r&&u&&!a&&o!==0?!1:!(a&&c&&!r&&o!==0)},CE=(e,t,n)=>{if(!e)return t;const i=$n(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},$E=(e,t,n)=>{if(!e)return t;const i=$n(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var SP=_P,DE={re:Xr.re,src:Xr.src,tokens:Xr.t,SEMVER_SPEC_VERSION:$f.SEMVER_SPEC_VERSION,SemVer:Qe,compareIdentifiers:Mm.compareIdentifiers,rcompareIdentifiers:Mm.rcompareIdentifiers,parse:Ka,valid:cL,clean:dL,inc:pL,diff:yL,major:wL,minor:EL,patch:_L,prerelease:SL,compare:$n,rcompare:TL,compareLoose:$L,compareBuild:Lm,sort:FL,rsort:IL,gt:ql,lt:Ff,eq:jm,neq:_E,gte:Pm,lte:zm,cmp:Nf,coerce:qL,Comparator:Qa,Range:un,satisfies:Jr,toComparators:oP,maxSatisfying:lP,minSatisfying:cP,minVersion:dP,validRange:pP,outside:Um,gtr:yP,ltr:wP,intersects:EP,simplifyRange:kP,subset:SP};function pr(e,t,n){return e.fields=t||[],e.fname=n,e}function OP(e){return e==null?null:e.fname}function RE(e){return e==null?null:e.fields}function FE(e){return e.length===1?TP(e[0]):CP(e)}const TP=e=>function(t){return t[e]},CP=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function Lf(e){throw Error(e)}function qm(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||Lf("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&Lf("Access path missing closing bracket: "+e),n&&Lf("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Wm(e,t,n){const i=qm(e);return e=i.length===1?i[0]:e,pr((n&&n.get||FE)(i),[e],t||e)}var Gl=[],$P=Wm("id"),Gm=pr(function(e){return e},Gl,"identity"),DP=pr(function(){return 0},Gl,"zero"),RP=pr(function(){return 1},Gl,"one"),FP=pr(function(){return!0},Gl,"true"),NP=pr(function(){return!1},Gl,"false");function Pf(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var NE=0,IE=1,ME=2,jE=3,LE=4;function IP(e,t){var n=e||NE;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=IE&&Pf(t||"error","ERROR",arguments),this},warn:function(){return n>=ME&&Pf(t||"warn","WARN",arguments),this},info:function(){return n>=jE&&Pf(t||"log","INFO",arguments),this},debug:function(){return n>=LE&&Pf(t||"log","DEBUG",arguments),this}}}var zf=Array.isArray;function Bf(e){return e===Object(e)}const PE=e=>e!=="__proto__";function MP(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=jP(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;Uf(t,i,n[i],r)}return t},{})}function Uf(e,t,n,i){if(!PE(t))return;var r,a;if(Bf(n)&&!zf(n)){a=Bf(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?Uf(a,r,n[r]):PE(r)&&(a[r]=n[r])}else e[t]=n}function jP(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function ws(e){return e[e.length-1]}function Hm(e){return e==null||e===""?null:+e}function zE(e){return function(t){return e*Math.exp(t)}}function BE(e){return function(t){return Math.log(e*t)}}function UE(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function qE(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function qf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Wf(e,t,n,i){var r=n(e[0]),a=n(ws(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function LP(e,t){return Wf(e,t,Hm,Gm)}function PP(e,t){var n=Math.sign(e[0]);return Wf(e,t,BE(n),zE(n))}function zP(e,t,n){return Wf(e,t,qf(n),qf(1/n))}function BP(e,t,n){return Wf(e,t,UE(n),qE(n))}function Gf(e,t,n,i,r){var a=i(e[0]),o=i(ws(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function UP(e,t,n){return Gf(e,t,n,Hm,Gm)}function qP(e,t,n){var i=Math.sign(e[0]);return Gf(e,t,n,BE(i),zE(i))}function WP(e,t,n,i){return Gf(e,t,n,qf(i),qf(1/i))}function GP(e,t,n,i){return Gf(e,t,n,UE(i),qE(i))}function HP(e){return 1+~~(new Date(e).getMonth()/3)}function YP(e){return 1+~~(new Date(e).getUTCMonth()/3)}function Hl(e){return e!=null?zf(e)?e:[e]:[]}function VP(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function Ym(e){return typeof e=="function"}const XP="descending";function JP(e,t,n){n=n||{},t=Hl(t)||[];const i=[],r=[],a={},o=n.comparator||KP;return Hl(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===XP?-1:1),r.push(s=Ym(s)?s:Wm(s,null,n)),(RE(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:pr(o(r,i),Object.keys(a))}const WE=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,KP=(e,t)=>e.length===1?QP(e[0],t[0]):ZP(e,t,e.length),QP=(e,t)=>function(n,i){return WE(e(n),e(i))*t},ZP=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=WE(a(i),a(r));return o*t[s]});function ez(e){return Ym(e)?e:function(){return e}}function tz(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function GE(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function nz(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function iz(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const rz=Object.prototype.hasOwnProperty;function Za(e,t){return rz.call(e,t)}var Hf={};function az(e){var t={},n,i;function r(a){return Za(t,a)&&t[a]!==Hf}return n={size:0,empty:0,object:t,has:r,get(a){return r(a)?t[a]:void 0},set(a,o){return r(a)||(++n.size,t[a]===Hf&&--n.empty),t[a]=o,this},delete(a){return r(a)&&(--n.size,++n.empty,t[a]=Hf),this},clear(){n.size=n.empty=0,n.object=t={}},test(a){return arguments.length?(i=a,n):i},clean(){var a={},o=0,s,l;for(s in t)l=t[s],l!==Hf&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function oz(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=ws(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function sz(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function lz(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function uz(e){return typeof e=="boolean"}function HE(e){return Object.prototype.toString.call(e)==="[object Date]"}function YE(e){return typeof e=="number"}function cz(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function VE(e){return typeof e=="string"}function fz(e,t,n){e&&(e=t?Hl(e).map(s=>s.replace(/\\(.)/g,"$1")):Hl(e));const i=e&&e.length,r=n&&n.get||FE,a=s=>r(t?[s]:qm(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return pr(o,e,"key")}function dz(e,t){const n=e[0],i=ws(e),r=+t;return r?r===1?i:n+r*(i-n):n}const hz=1e4;function pz(e){e=+e||hz;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>Za(t,o)||Za(n,o),get:o=>Za(t,o)?t[o]:Za(n,o)?a(o,n[o]):void 0,set:(o,s)=>Za(t,o)?t[o]=s:a(o,s)}}function gz(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function Yl(e,t){for(var n="";--t>=0;)n+=e;return n}function mz(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?Yl(r,o)+a:i==="center"?Yl(r,~~(o/2))+a+Yl(r,Math.ceil(o/2)):a+Yl(r,o)}function vz(e){return e&&ws(e)-e[0]||0}function XE(e){return zf(e)?"["+e.map(XE)+"]":Bf(e)||VE(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function yz(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function bz(e){return YE(e)||HE(e)?e:Date.parse(e)}function wz(e,t){return t=t||bz,e==null||e===""?null:t(e)}function xz(e){return e==null||e===""?null:e+""}function Ez(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function kz(e,t,n,i){var r=i??"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function _z(e,t,n){if(e)if(t)for(var i=0,r=e.length,a;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}function Dn(e,t,n){return e.fields=t||[],e.fname=n,e}function Ze(e){return e==null?null:e.fname}function Gt(e){return e==null?null:e.fields}function JE(e){return e.length===1?Az(e[0]):Sz(e)}const Az=e=>function(t){return t[e]},Sz=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function F(e){throw Error(e)}function gr(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||F("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&F("Access path missing closing bracket: "+e),n&&F("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Ri(e,t,n){const i=gr(e);return e=i.length===1?i[0]:e,Dn((n&&n.get||JE)(i),[e],t||e)}var Vl=[],Yf=Ri("id"),Ht=Dn(function(e){return e},Vl,"identity"),eo=Dn(function(){return 0},Vl,"zero"),Xl=Dn(function(){return 1},Vl,"one"),Fi=Dn(function(){return!0},Vl,"true"),to=Dn(function(){return!1},Vl,"false");function Vf(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var Oz=0,KE=1,QE=2,Tz=3,Cz=4;function ZE(e,t){var n=e||Oz;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=KE&&Vf(t||"error","ERROR",arguments),this},warn:function(){return n>=QE&&Vf(t||"warn","WARN",arguments),this},info:function(){return n>=Tz&&Vf(t||"log","INFO",arguments),this},debug:function(){return n>=Cz&&Vf(t||"log","DEBUG",arguments),this}}}var I=Array.isArray;function K(e){return e===Object(e)}const ek=e=>e!=="__proto__";function Jl(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=$z(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;Vm(t,i,n[i],r)}return t},{})}function Vm(e,t,n,i){if(!ek(t))return;var r,a;if(K(n)&&!I(n)){a=K(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?Vm(a,r,n[r]):ek(r)&&(a[r]=n[r])}else e[t]=n}function $z(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function ve(e){return e[e.length-1]}function cn(e){return e==null||e===""?null:+e}function tk(e){return function(t){return e*Math.exp(t)}}function nk(e){return function(t){return Math.log(e*t)}}function ik(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function rk(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Xf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Jf(e,t,n,i){var r=n(e[0]),a=n(ve(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function Dz(e,t){return Jf(e,t,cn,Ht)}function Rz(e,t){var n=Math.sign(e[0]);return Jf(e,t,nk(n),tk(n))}function Fz(e,t,n){return Jf(e,t,Xf(n),Xf(1/n))}function Nz(e,t,n){return Jf(e,t,ik(n),rk(n))}function Kf(e,t,n,i,r){var a=i(e[0]),o=i(ve(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function ak(e,t,n){return Kf(e,t,n,cn,Ht)}function ok(e,t,n){var i=Math.sign(e[0]);return Kf(e,t,n,nk(i),tk(i))}function Xm(e,t,n,i){return Kf(e,t,n,Xf(i),Xf(1/i))}function sk(e,t,n,i){return Kf(e,t,n,ik(i),rk(i))}function Iz(e){return 1+~~(new Date(e).getMonth()/3)}function Mz(e){return 1+~~(new Date(e).getUTCMonth()/3)}function G(e){return e!=null?I(e)?e:[e]:[]}function jz(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function ge(e){return typeof e=="function"}const Lz="descending";function lk(e,t,n){n=n||{},t=G(t)||[];const i=[],r=[],a={},o=n.comparator||Pz;return G(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===Lz?-1:1),r.push(s=ge(s)?s:Ri(s,null,n)),(Gt(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:Dn(o(r,i),Object.keys(a))}const uk=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,Pz=(e,t)=>e.length===1?zz(e[0],t[0]):Bz(e,t,e.length),zz=(e,t)=>function(n,i){return uk(e(n),e(i))*t},Bz=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=uk(a(i),a(r));return o*t[s]});function Yt(e){return ge(e)?e:function(){return e}}function ck(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function fe(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function mr(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function Uz(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const qz=Object.prototype.hasOwnProperty;function Q(e,t){return qz.call(e,t)}var Qf={};function Kl(e){var t={},n,i;function r(a){return Q(t,a)&&t[a]!==Qf}return n={size:0,empty:0,object:t,has:r,get:function(a){return r(a)?t[a]:void 0},set:function(a,o){return r(a)||(++n.size,t[a]===Qf&&--n.empty),t[a]=o,this},delete:function(a){return r(a)&&(--n.size,++n.empty,t[a]=Qf),this},clear:function(){n.size=n.empty=0,n.object=t={}},test:function(a){return arguments.length?(i=a,n):i},clean:function(){var a={},o=0,s,l;for(s in t)l=t[s],l!==Qf&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function Wz(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=ve(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function P(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function Ql(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function no(e){return typeof e=="boolean"}function io(e){return Object.prototype.toString.call(e)==="[object Date]"}function De(e){return typeof e=="number"}function Gz(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function fk(e,t,n){e&&(e=t?G(e).map(s=>s.replace(/\\(.)/g,"$1")):G(e));const i=e&&e.length,r=n&&n.get||JE,a=s=>r(t?[s]:gr(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return Dn(o,e,"key")}function Hz(e,t){const n=e[0],i=ve(e),r=+t;return r?r===1?i:n+r*(i-n):n}const Yz=1e4;function Vz(e){e=+e||Yz;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>Q(t,o)||Q(n,o),get:o=>Q(t,o)?t[o]:Q(n,o)?a(o,n[o]):void 0,set:(o,s)=>Q(t,o)?t[o]=s:a(o,s)}}function Xz(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function Zf(e,t){for(var n="";--t>=0;)n+=e;return n}function Jz(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?Zf(r,o)+a:i==="center"?Zf(r,~~(o/2))+a+Zf(r,Math.ceil(o/2)):a+Zf(r,o)}function ed(e){return e&&ve(e)-e[0]||0}function B(e){return I(e)?"["+e.map(B)+"]":K(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function dk(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function Kz(e){return De(e)||io(e)?e:Date.parse(e)}function hk(e,t){return t=t||Kz,e==null||e===""?null:t(e)}function pk(e){return e==null||e===""?null:e+""}function Et(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function Qz(e,t,n,i){var r=i??"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function ro(e,t,n){if(e){var i=0,r=e.length,a;if(t)for(;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}}function td(e){var t=e||Ht,n=[],i={};return n.add=function(r){var a=t(r);return i[a]||(i[a]=1,n.push(r)),n},n.remove=function(r){var a=t(r),o;return i[a]&&(i[a]=0,(o=n.indexOf(r))>=0&&n.splice(o,1)),n},n}async function nd(e,t){try{await t(e)}catch(n){e.error(n)}}var gk=Symbol("vega_id"),Zz=1;function id(e){return!!(e&&ee(e))}function ee(e){return e[gk]}function mk(e,t){return e[gk]=t,e}function ke(e){var t=e===Object(e)?e:{data:e};return ee(t)?t:mk(t,Zz++)}function Jm(e){return Km(e,ke({}))}function Km(e,t){for(var n in e)t[n]=e[n];return t}function vk(e,t){return mk(t,ee(e))}function ao(e,t){return e?t?(n,i)=>e(n,i)||ee(t(n))-ee(t(i)):(n,i)=>e(n,i)||ee(n)-ee(i):null}function yk(e){return e&&e.constructor===oo}function oo(){var e=[],t=[],n=[],i=[],r=[],a=null,o=!1;return{constructor:oo,insert:function(s){for(var l=G(s),u=0,c=l.length;u<c;++u)e.push(l[u]);return this},remove:function(s){for(var l=ge(s)?i:t,u=G(s),c=0,f=u.length;c<f;++c)l.push(u[c]);return this},modify:function(s,l,u){var c={field:l,value:Yt(u)};return ge(s)?(c.filter=s,r.push(c)):(c.tuple=s,n.push(c)),this},encode:function(s,l){return ge(s)?r.push({filter:s,field:l}):n.push({tuple:s,field:l}),this},clean:function(s){return a=s,this},reflow:function(){return o=!0,this},pulse:function(s,l){var u={},c={},f,d,h,p,g,m;for(f=0,d=l.length;f<d;++f)u[ee(l[f])]=1;for(f=0,d=t.length;f<d;++f)g=t[f],u[ee(g)]=-1;for(f=0,d=i.length;f<d;++f)p=i[f],l.forEach(function(y){p(y)&&(u[ee(y)]=-1)});for(f=0,d=e.length;f<d;++f)g=e[f],m=ee(g),u[m]?u[m]=1:s.add.push(ke(e[f]));for(f=0,d=l.length;f<d;++f)g=l[f],u[ee(g)]<0&&s.rem.push(g);function v(y,b,E){E?y[b]=E(y):s.encode=b,o||(c[ee(y)]=y)}for(f=0,d=n.length;f<d;++f)h=n[f],g=h.tuple,p=h.field,m=u[ee(g)],m>0&&(v(g,p,h.value),s.modifies(p));for(f=0,d=r.length;f<d;++f)h=r[f],p=h.filter,l.forEach(function(y){p(y)&&u[ee(y)]>0&&v(y,h.field,h.value)}),s.modifies(h.field);if(o)s.mod=t.length||i.length?l.filter(function(y){return u[ee(y)]>0}):l.slice();else for(m in c)s.mod.push(c[m]);return(a||a==null&&(t.length||i.length))&&s.clean(!0),s}}}var rd="_:mod:_";function ad(){Object.defineProperty(this,rd,{writable:!0,value:{}})}var Qm=ad.prototype;Qm.set=function(e,t,n,i){var r=this,a=r[e],o=r[rd];return t!=null&&t>=0?(a[t]!==n||i)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||i)&&(r[e]=n,o[e]=I(n)?1+n.length:-1),r},Qm.modified=function(e,t){var n=this[rd],i;if(arguments.length){if(I(e)){for(i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},Qm.clear=function(){return this[rd]={},this};var e5=0,t5="pulse",n5=new ad(),i5=1,r5=2;function Re(e,t,n,i){this.id=++e5,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}var vr=Re.prototype;vr.targets=function(){return this._targets||(this._targets=td(Yf))},vr.set=function(e){return this.value!==e?(this.value=e,1):0};function bk(e){return function(t){var n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}vr.skip=bk(i5),vr.modified=bk(r5),vr.parameters=function(e,t,n){t=t!==!1;var i=this,r=i._argval=i._argval||new ad(),a=i._argops=i._argops||[],o=[],s,l,u,c;function f(d,h,p){p instanceof Re?(p!==i&&(t&&p.targets().add(i),o.push(p)),a.push({op:p,name:d,index:h})):r.set(d,h,p)}for(s in e)if(l=e[s],s===t5)G(l).forEach(function(d){d instanceof Re?d!==i&&(d.targets().add(i),o.push(d)):F("Pulse parameters must be operator instances.")}),i.source=l;else if(I(l))for(r.set(s,-1,Array(u=l.length)),c=0;c<u;++c)f(s,c,l[c]);else f(s,-1,l);return this.marshall().clear(),n&&(a.initonly=!0),o},vr.marshall=function(e){var t=this._argval||n5,n=this._argops,i,r,a,o,s;if(n){for(r=0,a=n.length;r<a;++r)i=n[r],o=i.op,s=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,s);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},vr.detach=function(){var e=this._argops,t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this)},vr.evaluate=function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},vr.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e};function a5(e,t,n,i){var r=1,a;return e instanceof Re?a=e:e&&e.prototype instanceof Re?a=new e():ge(e)?a=new Re(null,e):(r=0,a=new Re(e,t)),this.rank(a),r&&(i=n,n=t),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a}function o5(e,t){var n=e.rank,i,r;for(i=0,r=t.length;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}var s5=0;function od(e,t,n){this.id=++s5,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Kr(e,t,n){return new od(e,t,n)}var ui=od.prototype;ui._filter=Fi,ui._apply=Ht,ui.targets=function(){return this._targets||(this._targets=td(Yf))},ui.consume=function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},ui.receive=function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,i=n?n.length:0,r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},ui.filter=function(e){var t=Kr(e);return this.targets().add(t),t},ui.apply=function(e){var t=Kr(null,e);return this.targets().add(t),t},ui.merge=function(){var e=Kr();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},ui.throttle=function(e){var t=-1;return this.filter(function(){var n=Date.now();return n-t>e?(t=n,1):0})},ui.debounce=function(e){var t=Kr();return this.targets().add(Kr(null,null,ck(e,function(n){var i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},ui.between=function(e,t){var n=!1;return e.targets().add(Kr(null,null,function(){n=!0})),t.targets().add(Kr(null,null,function(){n=!1})),this.filter(function(){return n})};function l5(e,t,n,i){var r=this,a=Kr(n,i),o=function(c){c.dataflow=r;try{a.receive(c)}catch(f){r.error(f)}finally{r.run()}},s;typeof e=="string"&&typeof document!="undefined"?s=document.querySelectorAll(e):s=G(e);for(var l=0,u=s.length;l<u;++l)s[l].addEventListener(t,o);return a}const u5=/^([A-Za-z]+:)?\/\//,c5=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,f5=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,wk="file://";function d5(e,t){return function(n){return{options:n||{},sanitize:p5,load:h5,fileAccess:!!t,file:g5(t),http:v5(e)}}}async function h5(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function p5(e,t){t=fe({},this.options,t);const n=this.fileAccess,i={href:null};let r,a,o;const s=c5.test(e.replace(f5,""));(e==null||typeof e!="string"||!s)&&F("Sanitize failure, invalid URI: "+B(e));const l=u5.test(e);return(o=t.baseURL)&&!l&&(!e.startsWith("/")&&o[o.length-1]!=="/"&&(e="/"+e),e=o+e),a=(r=e.startsWith(wk))||t.mode==="file"||t.mode!=="http"&&!l&&n,r?e=e.slice(wk.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!a}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function g5(e){return e?function(t){return new Promise(function(n,i){e.readFile(t,function(r,a){r?i(r):n(a)})})}:m5}async function m5(){F("No file system access.")}function v5(e){return e?async function(t,n){const i=fe({},this.options.http,n),r=n&&n.response,a=await e(t,i);return a.ok?ge(a[r])?a[r]():a.text():F(a.status+""+a.statusText)}:y5}async function y5(){F("No HTTP fetch method available.")}var Zm={boolean:dk,integer:cn,number:cn,date:hk,string:pk,unknown:Ht},sd=[x5,k5,kk,E5],b5=["boolean","integer","number","date"];function xk(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=sd.length,r=sd.map((a,o)=>o+1);for(let a=0,o=0,s,l;a<n;++a)for(l=t?e[a][t]:e[a],s=0;s<i;++s)if(r[s]&&w5(l)&&!sd[s](l)&&(r[s]=0,++o,o===sd.length))return"string";return b5[r.reduce((a,o)=>a===0?o:a,0)-1]}function Ek(e,t){return t.reduce(function(n,i){return n[i]=xk(e,i),n},{})}function w5(e){return e!=null&&e===e}function x5(e){return e==="true"||e==="false"||e===!0||e===!1}function E5(e){return!Number.isNaN(Date.parse(e))}function kk(e){return!Number.isNaN(+e)&&!(e instanceof Date)}function k5(e){return kk(e)&&Number.isInteger(+e)}var _k={},e0={},t0=34,Zl=10,n0=13;function Ak(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function _5(e,t){var n=Ak(e);return function(i,r){return t(n(i),r,e)}}function Sk(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function fn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function A5(e){return e<0?"-"+fn(-e,6):e>9999?"+"+fn(e,6):fn(e,4)}function S5(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":A5(e.getUTCFullYear())+"-"+fn(e.getUTCMonth()+1,2)+"-"+fn(e.getUTCDate(),2)+(r?"T"+fn(t,2)+":"+fn(n,2)+":"+fn(i,2)+"."+fn(r,3)+"Z":i?"T"+fn(t,2)+":"+fn(n,2)+":"+fn(i,2)+"Z":n||t?"T"+fn(t,2)+":"+fn(n,2)+"Z":"")}function O5(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,p,g=r(f,function(m,v){if(h)return h(m,v-1);p=m,h=d?_5(m,d):Ak(m)});return g.columns=p||[],g}function r(f,d){var h=[],p=f.length,g=0,m=0,v,y=p<=0,b=!1;f.charCodeAt(p-1)===Zl&&--p,f.charCodeAt(p-1)===n0&&--p;function E(){if(y)return e0;if(b)return b=!1,_k;var k,w=g,A;if(f.charCodeAt(w)===t0){for(;g++<p&&f.charCodeAt(g)!==t0||f.charCodeAt(++g)===t0;);return(k=g)>=p?y=!0:(A=f.charCodeAt(g++))===Zl?b=!0:A===n0&&(b=!0,f.charCodeAt(g)===Zl&&++g),f.slice(w+1,k-1).replace(/""/g,'"')}for(;g<p;){if((A=f.charCodeAt(k=g++))===Zl)b=!0;else if(A===n0)b=!0,f.charCodeAt(g)===Zl&&++g;else if(A!==n)continue;return f.slice(w,k)}return y=!0,f.slice(w,p)}for(;(v=E())!==e0;){for(var x=[];v!==_k&&v!==e0;)x.push(v),v=E();if(d&&(x=d(x,m++))==null)continue;h.push(x)}return h}function a(f,d){return f.map(function(h){return d.map(function(p){return c(h[p])}).join(e)})}function o(f,d){return d==null&&(d=Sk(f)),[d.map(c).join(e)].concat(a(f,d)).join(`
`)}function s(f,d){return d==null&&(d=Sk(f)),a(f,d).join(`
`)}function l(f){return f.map(u).join(`
`)}function u(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?S5(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:o,formatBody:s,formatRows:l,formatRow:u,formatValue:c}}function Ok(e){const t=function(n,i){const r={delimiter:e};return i0(n,i?fe(i,r):r)};return t.responseType="text",t}function i0(e,t){return t.header&&(e=t.header.map(B).join(t.delimiter)+`
`+e),O5(t.delimiter).parse(e+"")}i0.responseType="text";function T5(e){return typeof Buffer=="function"&&ge(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function r0(e,t){const n=t&&t.property?Ri(t.property):Ht;return K(e)&&!T5(e)?C5(n(e)):n(JSON.parse(e))}r0.responseType="json";function C5(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}function $5(e){return e}function D5(e){if(e==null)return $5;var t,n,i=e.scale[0],r=e.scale[1],a=e.translate[0],o=e.translate[1];return function(s,l){l||(t=n=0);var u=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*i+a,f[1]=(n+=s[1])*r+o;u<c;)f[u]=s[u],++u;return f}}function R5(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function F5(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return Tk(e,n)})}:Tk(e,t)}function Tk(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,a=Ck(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:a}:i==null?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function Ck(e,t){var n=D5(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));c<0&&R5(f,p)}function a(c){return n(c)}function o(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(s)}function u(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":d=a(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(a);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:f,coordinates:d}}return u(t)}function N5(e,t){var n={},i={},r={},a=[],o=-1;t.forEach(function(u,c){var f=e.arcs[u<0?~u:u],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++o],t[o]=u,t[c]=d)}),t.forEach(function(u){var c=s(u),f=c[0],d=c[1],h,p;if(h=r[f])if(delete r[h.end],h.push(u),h.end=d,p=i[d]){delete i[p.start];var g=p===h?h:h.concat(p);i[g.start=h.start]=r[g.end=p.end]=g}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(u),h.start=f,p=r[f]){delete r[p.end];var m=p===h?h:p.concat(h);i[m.start=p.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[u],i[h.start=f]=r[h.end=d]=h});function s(u){var c=e.arcs[u<0?~u:u],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],u<0?[d,f]:[f,d]}function l(u,c){for(var f in u){var d=u[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),a.push(d)}}return l(r,i),l(i,r),t.forEach(function(u){n[u<0?~u:u]||a.push([u])}),a}function I5(e){return Ck(e,M5.apply(this,arguments))}function M5(e,t,n){var i,r,a;if(arguments.length>1)i=j5(e,t,n);else for(r=0,i=new Array(a=e.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:N5(e,i)}}function j5(e,t,n){var i=[],r=[],a;function o(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:a})}function s(f){f.forEach(o)}function l(f){f.forEach(s)}function u(f){f.forEach(l)}function c(f){switch(a=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":s(f.arcs);break;case"MultiLineString":case"Polygon":l(f.arcs);break;case"MultiPolygon":u(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}const L5={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function $k(e,t){let n,i,r,a;return e=r0(e,t),t&&t.feature?(n=F5,r=t.feature):t&&t.mesh?(n=I5,r=t.mesh,a=L5[t.filter]):F("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,a):F("Invalid TopoJSON object: "+r),i&&i.features||[i]}$k.responseType="json";const ld={dsv:i0,csv:Ok(","),tsv:Ok("	"),json:r0,topojson:$k};function a0(e,t){return arguments.length>1?(ld[e]=t,this):Q(ld,e)?ld[e]:null}function Dk(e){const t=a0(e);return t&&t.responseType||"text"}function eu(e){const t={};return n=>t[n]||(t[n]=e(n))}function xs(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ud(e){return e.length===1&&(e=P5(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function P5(e){return function(t,n){return xs(e(t),n)}}var Rk=ud(xs),Qr=Rk.right,z5=Rk.left;function B5(e,t){let n=0,i,r=0,a=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,a+=i*(o-r));else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,a+=i*(s-r))}if(n>1)return a/(n-1)}function U5(e,t){const n=B5(e,t);return n&&Math.sqrt(n)}function so(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}var o0=Math.sqrt(50),s0=Math.sqrt(10),l0=Math.sqrt(2);function u0(e,t,n){var i,r=-1,a,o,s;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(a=e,e=t,t=a),(s=cd(e,t,n))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++r<a;)o[r]=(e+r)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++r<a;)o[r]=(e-r)/s;return i&&o.reverse(),o}function cd(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=o0?10:a>=s0?5:a>=l0?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=o0?10:a>=s0?5:a>=l0?2:1)}function Zr(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=o0?r*=10:a>=s0?r*=5:a>=l0&&(r*=2),t<e?-r:r}function lo(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function c0(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function Fk(e,t,n=0,i=e.length-1,r=xs){for(;i>n;){if(i-n>600){const l=i-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),h=Math.max(n,Math.floor(t-u*f/l+d)),p=Math.min(i,Math.floor(t+(l-u)*f/l+d));Fk(e,t,h,p,r)}const a=e[t];let o=n,s=i;for(tu(e,n,t),r(e[i],a)>0&&tu(e,n,i);o<s;){for(tu(e,o,s),++o,--s;r(e[o],a)<0;)++o;for(;r(e[s],a)>0;)--s}r(e[n],a)===0?tu(e,n,s):(++s,tu(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}return e}function tu(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function q5(e){return e===null?NaN:+e}function*W5(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}function fd(e,t,n){if(e=Float64Array.from(W5(e,n)),!(i=e.length))return;if((t=+t)<=0||i<2)return c0(e);if(t>=1)return lo(e);var i,r=(i-1)*t,a=Math.floor(r),o=lo(Fk(e,a).subarray(0,a+1)),s=c0(e.subarray(a+1));return o+(s-o)*(r-a)}function G5(e,t,n=q5){if(!(i=e.length))return;if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,a=Math.floor(r),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(r-a)}function H5(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let a of e)(a=t(a,++r,e))!=null&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n}function Nk(e,t){return fd(e,.5,t)}function Y5(e,t){return Array.from(t,n=>e[n])}function Ik(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function dd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Es(e){return e=dd(Math.abs(e)),e?e[1]:NaN}function V5(e,t){return function(n,i){for(var r=n.length,a=[],o=0,s=e[0],l=0;r>0&&s>0&&!(l+s+1>i&&(s=Math.max(1,i-l)),a.push(n.substring(r-=s,r+s)),(l+=s+1)>i);)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function X5(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var J5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ks(e){if(!(t=J5.exec(e)))throw new Error("invalid format: "+e);var t;return new f0({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ks.prototype=f0.prototype;function f0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}f0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function K5(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Mk;function Q5(e,t){var n=dd(e,t);if(!n)return e+"";var i=n[0],r=n[1],a=r-(Mk=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+dd(e,Math.max(0,t+a-1))[0]}function jk(e,t){var n=dd(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var Lk={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return jk(e*100,t)},r:jk,s:Q5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Pk(e){return e}var zk=Array.prototype.map,Bk=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Uk(e){var t=e.grouping===void 0||e.thousands===void 0?Pk:V5(zk.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Pk:X5(zk.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=ks(f);var d=f.fill,h=f.align,p=f.sign,g=f.symbol,m=f.zero,v=f.width,y=f.comma,b=f.precision,E=f.trim,x=f.type;x==="n"?(y=!0,x="g"):Lk[x]||(b===void 0&&(b=12),E=!0,x="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var k=g==="$"?n:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=g==="$"?i:/[%p]/.test(x)?o:"",A=Lk[x],_=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function O(S){var T=k,D=w,M,C,N;if(x==="c")D=A(S)+D,S="";else{S=+S;var W=S<0||1/S<0;if(S=isNaN(S)?l:A(Math.abs(S),b),E&&(S=K5(S)),W&&+S===0&&p!=="+"&&(W=!1),T=(W?p==="("?p:s:p==="-"||p==="("?"":p)+T,D=(x==="s"?Bk[8+Mk/3]:"")+D+(W&&p==="("?")":""),_){for(M=-1,C=S.length;++M<C;)if(N=S.charCodeAt(M),48>N||N>57){D=(N===46?r+S.slice(M+1):S.slice(M))+D,S=S.slice(0,M);break}}}y&&!m&&(S=t(S,Infinity));var X=T.length+S.length+D.length,J=X<v?new Array(v-X+1).join(d):"";y&&m&&(S=t(J+S,J.length?v-D.length:Infinity),J="");switch(h){case"<":S=T+S+D+J;break;case"=":S=T+J+S+D;break;case"^":S=J.slice(0,X=J.length>>1)+T+S+D+J.slice(X);break;default:S=J+T+S+D;break}return a(S)}return O.toString=function(){return f+""},O}function c(f,d){var h=u((f=ks(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Es(d)/3)))*3,g=Math.pow(10,-p),m=Bk[8+p/3];return function(v){return h(g*v)+m}}return{format:u,formatPrefix:c}}var hd,pd,d0;Z5({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Z5(e){return hd=Uk(e),pd=hd.format,d0=hd.formatPrefix,hd}function qk(e){return Math.max(0,-Es(Math.abs(e)))}function Wk(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Es(t)/3)))*3-Es(Math.abs(e)))}function Gk(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Es(t)-Es(e))+1}function e6(e,t){return n=>{var i=e(n),r=i.indexOf(t),a,o;if(r<0)return i;for(a=t6(i,r),o=a<i.length?i.slice(a):"";--a>r;)if(i[a]!=="0"){++a;break}return i.slice(0,a)+o}}function t6(e,t){var n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function Hk(e){const t=eu(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){var r=ks(i||",");if(r.precision==null){r.precision=12;switch(r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return e6(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,a,o){o=ks(o??",f");const s=Zr(i,r,a),l=Math.max(Math.abs(i),Math.abs(r));let u;if(o.precision==null)switch(o.type){case"s":return isNaN(u=Wk(s,l))||(o.precision=u),n(o,l);case"":case"e":case"g":case"p":case"r":{isNaN(u=Gk(s,l))||(o.precision=u-(o.type==="e"));break}case"f":case"%":{isNaN(u=qk(s))||(o.precision=u-(o.type==="%")*2);break}}return t(o)}}}let h0;Yk();function Yk(){return h0=Hk({format:pd,formatPrefix:d0})}function Vk(e){return Hk(Uk(e))}function gd(e){return arguments.length?h0=Vk(e):h0}const kt="year",dn="quarter",Ft="month",at="week",hn="date",Nt="day",Ni="dayofyear",Rn="hours",Fn="minutes",Un="seconds",ci="milliseconds",p0=[kt,dn,Ft,at,hn,Nt,Ni,Rn,Fn,Un,ci],g0=p0.reduce((e,t,n)=>(e[t]=1+n,e),{});function m0(e){const t=G(e).slice(),n={};t.length||F("Missing time unit."),t.forEach(r=>{Q(g0,r)?n[r]=1:F(`Invalid time unit: ${r}.`)});const i=(n[at]||n[Nt]?1:0)+(n[dn]||n[Ft]||n[hn]?1:0)+(n[Ni]?1:0);return i>1&&F(`Incompatible time units: ${e}`),t.sort((r,a)=>g0[r]-g0[a]),t}const n6={[kt]:"%Y ",[dn]:"Q%q ",[Ft]:"%b ",[hn]:"%d ",[at]:"W%U ",[Nt]:"%a ",[Ni]:"%j ",[Rn]:"%H:00",[Fn]:"00:%M",[Un]:":%S",[ci]:".%L",[`${kt}-${Ft}`]:"%Y-%m ",[`${kt}-${Ft}-${hn}`]:"%Y-%m-%d ",[`${Rn}-${Fn}`]:"%H:%M"};function Xk(e,t){const n=fe({},n6,t),i=m0(e),r=i.length;let a="",o=0,s,l;for(o=0;o<r;)for(s=i.length;s>o;--s)if(l=i.slice(o,s).join("-"),n[l]!=null){a+=n[l],o=s;break}return a.trim()}var v0=new Date(),y0=new Date();function ht(e,t,n,i){function r(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return r.floor=function(a){return e(a=new Date(+a)),a},r.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},r.round=function(a){var o=r(a),s=r.ceil(a);return a-o<s-a?o:s},r.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},r.range=function(a,o,s){var l=[],u;if(a=r.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},r.filter=function(a){return ht(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(r.count=function(a,o){return v0.setTime(+a),y0.setTime(+o),e(v0),e(y0),Math.floor(n(v0,y0))},r.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?r.filter(i?function(o){return i(o)%a===0}:function(o){return r.count(0,o)%a===0}):r}),r}var _s=ht(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});_s.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ht(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):_s};var md=1e3,uo=6e4,vd=36e5,Jk=864e5,Kk=6048e5,yd=ht(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*md)},function(e,t){return(t-e)/md},function(e){return e.getUTCSeconds()}),Qk=ht(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*md)},function(e,t){e.setTime(+e+t*uo)},function(e,t){return(t-e)/uo},function(e){return e.getMinutes()}),Zk=ht(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*md-e.getMinutes()*uo)},function(e,t){e.setTime(+e+t*vd)},function(e,t){return(t-e)/vd},function(e){return e.getHours()}),co=ht(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*uo)/Jk},function(e){return e.getDate()-1});function fo(e){return ht(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*uo)/Kk})}var bd=fo(0),b0=fo(1),Sde=fo(2),Ode=fo(3),w0=fo(4),Tde=fo(5),Cde=fo(6),x0=ht(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),ea=ht(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});ea.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ht(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var e_=ht(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*uo)},function(e,t){return(t-e)/uo},function(e){return e.getUTCMinutes()}),t_=ht(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*vd)},function(e,t){return(t-e)/vd},function(e){return e.getUTCHours()}),ho=ht(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Jk},function(e){return e.getUTCDate()-1});function po(e){return ht(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/Kk})}var wd=po(0),E0=po(1),$de=po(2),Dde=po(3),k0=po(4),Rde=po(5),Fde=po(6),_0=ht(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),ta=ht(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});ta.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ht(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const go=new Date();function A0(e){return go.setFullYear(e),go.setMonth(0),go.setDate(1),go.setHours(0,0,0,0),go}function n_(e){return r_(new Date(e))}function i_(e){return S0(new Date(e))}function r_(e){return co.count(A0(e.getFullYear())-1,e)}function S0(e){return bd.count(A0(e.getFullYear())-1,e)}function O0(e){return A0(e).getDay()}function i6(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,i,r,a,o);return s.setFullYear(e),s}return new Date(e,t,n,i,r,a,o)}function a_(e){return s_(new Date(e))}function o_(e){return T0(new Date(e))}function s_(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return ho.count(t-1,e)}function T0(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return wd.count(t-1,e)}function C0(e){return go.setTime(Date.UTC(e,0,1)),go.getUTCDay()}function r6(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,i,r,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,i,r,a,o))}function l_(e,t,n,i,r){const a=t||1,o=ve(e),s=(v,y,b)=>(b=b||v,a6(n[b],i[b],v===o&&a,y)),l=new Date(),u=Et(e),c=u[kt]?s(kt):Yt(2012),f=u[Ft]?s(Ft):u[dn]?s(dn):eo,d=u[at]&&u[Nt]?s(Nt,1,at+Nt):u[at]?s(at,1):u[Nt]?s(Nt,1):u[hn]?s(hn,1):u[Ni]?s(Ni,1):Xl,h=u[Rn]?s(Rn):eo,p=u[Fn]?s(Fn):eo,g=u[Un]?s(Un):eo,m=u[ci]?s(ci):eo;return function(v){l.setTime(+v);const y=c(l);return r(y,f(l),d(l,y),h(l),p(l),g(l),m(l))}}function a6(e,t,n,i){const r=n<=1?e:i?(a,o)=>i+n*Math.floor((e(a,o)-i)/n):(a,o)=>n*Math.floor(e(a,o)/n);return t?(a,o)=>t(r(a,o),o):r}function As(e,t,n){return t+e*7-(n+6)%7}const o6={[kt]:e=>e.getFullYear(),[dn]:e=>Math.floor(e.getMonth()/3),[Ft]:e=>e.getMonth(),[hn]:e=>e.getDate(),[Rn]:e=>e.getHours(),[Fn]:e=>e.getMinutes(),[Un]:e=>e.getSeconds(),[ci]:e=>e.getMilliseconds(),[Ni]:e=>r_(e),[at]:e=>S0(e),[at+Nt]:(e,t)=>As(S0(e),e.getDay(),O0(t)),[Nt]:(e,t)=>As(1,e.getDay(),O0(t))},s6={[dn]:e=>3*e,[at]:(e,t)=>As(e,0,O0(t))};function u_(e,t){return l_(e,t||1,o6,s6,i6)}const l6={[kt]:e=>e.getUTCFullYear(),[dn]:e=>Math.floor(e.getUTCMonth()/3),[Ft]:e=>e.getUTCMonth(),[hn]:e=>e.getUTCDate(),[Rn]:e=>e.getUTCHours(),[Fn]:e=>e.getUTCMinutes(),[Un]:e=>e.getUTCSeconds(),[ci]:e=>e.getUTCMilliseconds(),[Ni]:e=>s_(e),[at]:e=>T0(e),[Nt]:(e,t)=>As(1,e.getUTCDay(),C0(t)),[at+Nt]:(e,t)=>As(T0(e),e.getUTCDay(),C0(t))},u6={[dn]:e=>3*e,[at]:(e,t)=>As(e,0,C0(t))};function c_(e,t){return l_(e,t||1,l6,u6,r6)}const c6={[kt]:ea,[dn]:x0.every(3),[Ft]:x0,[at]:bd,[hn]:co,[Nt]:co,[Ni]:co,[Rn]:Zk,[Fn]:Qk,[Un]:yd,[ci]:_s},f6={[kt]:ta,[dn]:_0.every(3),[Ft]:_0,[at]:wd,[hn]:ho,[Nt]:ho,[Ni]:ho,[Rn]:t_,[Fn]:e_,[Un]:yd,[ci]:_s};function Ss(e){return c6[e]}function Os(e){return f6[e]}function f_(e,t,n){return e?e.offset(t,n):void 0}function d_(e,t,n){return f_(Ss(e),t,n)}function h_(e,t,n){return f_(Os(e),t,n)}function p_(e,t,n,i){return e?e.range(t,n,i):void 0}function g_(e,t,n,i){return p_(Ss(e),t,n,i)}function m_(e,t,n,i){return p_(Os(e),t,n,i)}const nu=1e3,iu=nu*60,ru=iu*60,xd=ru*24,d6=xd*7,v_=xd*30,$0=xd*365,y_=[kt,Ft,hn,Rn,Fn,Un,ci],au=y_.slice(0,-1),ou=au.slice(0,-1),su=ou.slice(0,-1),h6=su.slice(0,-1),p6=[kt,at],b_=[kt,Ft],w_=[kt],lu=[[au,1,nu],[au,5,5*nu],[au,15,15*nu],[au,30,30*nu],[ou,1,iu],[ou,5,5*iu],[ou,15,15*iu],[ou,30,30*iu],[su,1,ru],[su,3,3*ru],[su,6,6*ru],[su,12,12*ru],[h6,1,xd],[p6,1,d6],[b_,1,v_],[b_,3,3*v_],[w_,1,$0]];function x_(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(ed(t))/n;let r=ud(s=>s[2]).right(lu,i),a,o;return r===lu.length?(a=w_,o=Zr(t[0]/$0,t[1]/$0,n)):r?(r=lu[i/lu[r-1][2]<lu[r][2]/i?r-1:r],a=r[0],o=r[1]):(a=y_,o=Math.max(Zr(t[0],t[1],n),1)),{units:a,step:o}}function D0(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function R0(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function uu(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function E_(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=cu(r),c=fu(r),f=cu(a),d=fu(a),h=cu(o),p=fu(o),g=cu(s),m=fu(s),v=cu(l),y=fu(l),b={a:W,A:X,b:J,B:xe,c:null,d:S_,e:S_,f:P6,H:M6,I:j6,j:L6,L:O_,m:z6,M:B6,p:Le,q:ft,Q:D_,s:R_,S:U6,u:q6,U:W6,V:G6,w:H6,W:Y6,x:null,X:null,y:V6,Y:X6,Z:J6,"%":$_},E={a:dt,A:Je,b:Dt,B:li,c:null,d:T_,e:T_,f:e4,H:K6,I:Q6,j:Z6,L:C_,m:t4,M:n4,p:Ya,q:Vr,Q:D_,s:R_,S:i4,u:r4,U:a4,V:o4,w:s4,W:l4,x:null,X:null,y:u4,Y:c4,Z:f4,"%":$_},x={a:O,A:S,b:T,B:D,c:M,d:__,e:__,f:R6,H:A_,I:A_,j:T6,L:D6,m:O6,M:C6,p:_,q:S6,Q:N6,s:I6,S:$6,u:b6,U:w6,V:x6,w:y6,W:E6,x:C,X:N,y:_6,Y:k6,Z:A6,"%":F6};b.x=k(n,b),b.X=k(i,b),b.c=k(t,b),E.x=k(n,E),E.X=k(i,E),E.c=k(t,E);function k(H,ue){return function(me){var L=[],ln=-1,Ne=0,On=H.length,Tn,Va,dE;for(me instanceof Date||(me=new Date(+me));++ln<On;)H.charCodeAt(ln)===37&&(L.push(H.slice(Ne,ln)),(Va=k_[Tn=H.charAt(++ln)])!=null?Tn=H.charAt(++ln):Va=Tn==="e"?" ":"0",(dE=ue[Tn])&&(Tn=dE(me,Va)),L.push(Tn),Ne=ln+1);return L.push(H.slice(Ne,ln)),L.join("")}}function w(H,ue){return function(me){var L=uu(1900,void 0,1),ln=A(L,H,me+="",0),Ne,On;if(ln!=me.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(ue&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(Ne=R0(uu(L.y,0,1)),On=Ne.getUTCDay(),Ne=On>4||On===0?E0.ceil(Ne):E0(Ne),Ne=ho.offset(Ne,(L.V-1)*7),L.y=Ne.getUTCFullYear(),L.m=Ne.getUTCMonth(),L.d=Ne.getUTCDate()+(L.w+6)%7):(Ne=D0(uu(L.y,0,1)),On=Ne.getDay(),Ne=On>4||On===0?b0.ceil(Ne):b0(Ne),Ne=co.offset(Ne,(L.V-1)*7),L.y=Ne.getFullYear(),L.m=Ne.getMonth(),L.d=Ne.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),On="Z"in L?R0(uu(L.y,0,1)).getUTCDay():D0(uu(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(On+5)%7:L.w+L.U*7-(On+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,R0(L)):D0(L)}}function A(H,ue,me,L){for(var ln=0,Ne=ue.length,On=me.length,Tn,Va;ln<Ne;){if(L>=On)return-1;if(Tn=ue.charCodeAt(ln++),Tn===37){if(Tn=ue.charAt(ln++),Va=x[Tn in k_?ue.charAt(ln++):Tn],!Va||(L=Va(H,me,L))<0)return-1}else if(Tn!=me.charCodeAt(L++))return-1}return L}function _(H,ue,me){var L=u.exec(ue.slice(me));return L?(H.p=c[L[0].toLowerCase()],me+L[0].length):-1}function O(H,ue,me){var L=h.exec(ue.slice(me));return L?(H.w=p[L[0].toLowerCase()],me+L[0].length):-1}function S(H,ue,me){var L=f.exec(ue.slice(me));return L?(H.w=d[L[0].toLowerCase()],me+L[0].length):-1}function T(H,ue,me){var L=v.exec(ue.slice(me));return L?(H.m=y[L[0].toLowerCase()],me+L[0].length):-1}function D(H,ue,me){var L=g.exec(ue.slice(me));return L?(H.m=m[L[0].toLowerCase()],me+L[0].length):-1}function M(H,ue,me){return A(H,t,ue,me)}function C(H,ue,me){return A(H,n,ue,me)}function N(H,ue,me){return A(H,i,ue,me)}function W(H){return o[H.getDay()]}function X(H){return a[H.getDay()]}function J(H){return l[H.getMonth()]}function xe(H){return s[H.getMonth()]}function Le(H){return r[+(H.getHours()>=12)]}function ft(H){return 1+~~(H.getMonth()/3)}function dt(H){return o[H.getUTCDay()]}function Je(H){return a[H.getUTCDay()]}function Dt(H){return l[H.getUTCMonth()]}function li(H){return s[H.getUTCMonth()]}function Ya(H){return r[+(H.getUTCHours()>=12)]}function Vr(H){return 1+~~(H.getUTCMonth()/3)}return{format:function(H){var ue=k(H+="",b);return ue.toString=function(){return H},ue},parse:function(H){var ue=w(H+="",!1);return ue.toString=function(){return H},ue},utcFormat:function(H){var ue=k(H+="",E);return ue.toString=function(){return H},ue},utcParse:function(H){var ue=w(H+="",!0);return ue.toString=function(){return H},ue}}}var k_={"-":"",_:" ","0":"0"},pt=/^\s*\d+/,g6=/^%/,m6=/[\\^$*+?|[\]().{}]/g;function Te(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function v6(e){return e.replace(m6,"\\$&")}function cu(e){return new RegExp("^(?:"+e.map(v6).join("|")+")","i")}function fu(e){for(var t={},n=-1,i=e.length;++n<i;)t[e[n].toLowerCase()]=n;return t}function y6(e,t,n){var i=pt.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function b6(e,t,n){var i=pt.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function w6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function x6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function E6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function k6(e,t,n){var i=pt.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function _6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function A6(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function S6(e,t,n){var i=pt.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function O6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function __(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function T6(e,t,n){var i=pt.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function A_(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function C6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function $6(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function D6(e,t,n){var i=pt.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function R6(e,t,n){var i=pt.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function F6(e,t,n){var i=g6.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function N6(e,t,n){var i=pt.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function I6(e,t,n){var i=pt.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function S_(e,t){return Te(e.getDate(),t,2)}function M6(e,t){return Te(e.getHours(),t,2)}function j6(e,t){return Te(e.getHours()%12||12,t,2)}function L6(e,t){return Te(1+co.count(ea(e),e),t,3)}function O_(e,t){return Te(e.getMilliseconds(),t,3)}function P6(e,t){return O_(e,t)+"000"}function z6(e,t){return Te(e.getMonth()+1,t,2)}function B6(e,t){return Te(e.getMinutes(),t,2)}function U6(e,t){return Te(e.getSeconds(),t,2)}function q6(e){var t=e.getDay();return t===0?7:t}function W6(e,t){return Te(bd.count(ea(e)-1,e),t,2)}function G6(e,t){var n=e.getDay();return e=n>=4||n===0?w0(e):w0.ceil(e),Te(w0.count(ea(e),e)+(ea(e).getDay()===4),t,2)}function H6(e){return e.getDay()}function Y6(e,t){return Te(b0.count(ea(e)-1,e),t,2)}function V6(e,t){return Te(e.getFullYear()%100,t,2)}function X6(e,t){return Te(e.getFullYear()%1e4,t,4)}function J6(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Te(t/60|0,"0",2)+Te(t%60,"0",2)}function T_(e,t){return Te(e.getUTCDate(),t,2)}function K6(e,t){return Te(e.getUTCHours(),t,2)}function Q6(e,t){return Te(e.getUTCHours()%12||12,t,2)}function Z6(e,t){return Te(1+ho.count(ta(e),e),t,3)}function C_(e,t){return Te(e.getUTCMilliseconds(),t,3)}function e4(e,t){return C_(e,t)+"000"}function t4(e,t){return Te(e.getUTCMonth()+1,t,2)}function n4(e,t){return Te(e.getUTCMinutes(),t,2)}function i4(e,t){return Te(e.getUTCSeconds(),t,2)}function r4(e){var t=e.getUTCDay();return t===0?7:t}function a4(e,t){return Te(wd.count(ta(e)-1,e),t,2)}function o4(e,t){var n=e.getUTCDay();return e=n>=4||n===0?k0(e):k0.ceil(e),Te(k0.count(ta(e),e)+(ta(e).getUTCDay()===4),t,2)}function s4(e){return e.getUTCDay()}function l4(e,t){return Te(E0.count(ta(e)-1,e),t,2)}function u4(e,t){return Te(e.getUTCFullYear()%100,t,2)}function c4(e,t){return Te(e.getUTCFullYear()%1e4,t,4)}function f4(){return"+0000"}function $_(){return"%"}function D_(e){return+e}function R_(e){return Math.floor(+e/1e3)}var Ts,F0,F_,N0,N_;d4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function d4(e){return Ts=E_(e),F0=Ts.format,F_=Ts.parse,N0=Ts.utcFormat,N_=Ts.utcParse,Ts}function I_(e,t,n){n=n||{},K(n)||F(`Invalid time multi-format specifier: ${n}`);const i=t(Un),r=t(Fn),a=t(Rn),o=t(hn),s=t(at),l=t(Ft),u=t(dn),c=t(kt),f=e(n[ci]||".%L"),d=e(n[Un]||":%S"),h=e(n[Fn]||"%I:%M"),p=e(n[Rn]||"%I %p"),g=e(n[hn]||n[Nt]||"%a %d"),m=e(n[at]||"%b %d"),v=e(n[Ft]||"%B"),y=e(n[dn]||"%B"),b=e(n[kt]||"%Y");return E=>(i(E)<E?f:r(E)<E?d:a(E)<E?h:o(E)<E?p:l(E)<E?s(E)<E?g:m:c(E)<E?u(E)<E?v:y:b)(E)}function M_(e){const t=eu(e.format),n=eu(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):I_(t,Ss,i),utcFormat:i=>Y(i)?n(i):I_(n,Os,i),timeParse:eu(e.parse),utcParse:eu(e.utcParse)}}let I0;j_();function j_(){return I0=M_({format:F0,parse:F_,utcFormat:N0,utcParse:N_})}function L_(e){return M_(E_(e))}function du(e){return arguments.length?I0=L_(e):I0}const M0=(e,t)=>fe({},e,t);function P_(e,t){const n=e?Vk(e):gd(),i=t?L_(t):du();return M0(n,i)}function j0(e,t){const n=arguments.length;return n&&n!==2&&F("defaultLocale expects either zero or two arguments."),n?M0(gd(e),du(t)):M0(gd(),du())}function h4(){return Yk(),j_(),j0()}function z_(e,t,n,i){t=t||{};const r=a0(t.type||"json");return r||F("Unknown data format type: "+t.type),e=r(e,t),t.parse&&p4(e,t.parse,n,i),Q(e,"columns")&&delete e.columns,e}function p4(e,t,n,i){if(!e.length)return;const r=du();n=n||r.timeParse,i=i||r.utcParse;var a=e.columns||Object.keys(e[0]),o,s,l,u,c,f,d;for(t==="auto"&&(t=Ek(e,a)),a=Object.keys(t),o=a.map(function(h){var p=t[h],g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:"))){g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1));const v=g[0]==="utc"?i:n;return v(m)}if(!Zm[p])throw Error("Illegal format pattern: "+h+":"+p);return Zm[p]}),u=0,f=e.length,d=a.length;u<f;++u)for(s=e[u],c=0;c<d;++c)l=a[c],s[l]=o[c](s[l])}var Ed=d5(typeof fetch!="undefined"&&fetch,null);function g4(e,t){const n=this.locale();return z_(e,t,n.timeParse,n.utcParse)}function m4(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function v4(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:Dk(t&&t.type)});try{r=n.parse(r,t)}catch(a){i=-2,n.warn("Data ingestion failed",e,a)}}catch(a){i=-1,n.warn("Loading failed",e,a)}return{data:r,status:i}}async function y4(e,t,n){const i=this,r=i._pending||b4(i);r.requests+=1;const a=await i.request(t,n);return i.pulse(e,i.changeset().remove(Fi).insert(a.data||[])),r.done(),a}function b4(e){var t=new Promise(function(i){n=i}),n;return t.requests=0,t.done=function(){--t.requests===0&&(e._pending=null,n(e))},e._pending=t}var w4={skip:!0};function x4(e,t,n,i,r){var a=e instanceof Re?k4:E4;return a(this,e,t,n,i,r),this}function E4(e,t,n,i,r,a){var o=fe({},a,w4),s,l;ge(n)||(n=Yt(n)),i===void 0?s=u=>e.touch(n(u)):ge(i)?(l=new Re(null,i,r,!1),s=u=>{l.evaluate(u);const c=n(u),f=l.value;yk(f)?e.pulse(c,f,a):e.update(c,f,o)}):s=u=>e.update(n(u),i,o),t.apply(s)}function k4(e,t,n,i,r,a){if(i===void 0)t.targets().add(n);else{const o=a||{},s=new Re(null,_4(n,i),r,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function _4(e,t){return t=ge(t)?t:Yt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function A4(e){e.rank=++this._rank}function S4(e){for(var t=[e],n,i,r;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&F("Cycle detected in dataflow graph.")}const kd={},Ii=1<<0,na=1<<1,yr=1<<2,O4=Ii|na,B_=Ii|yr,Cs=Ii|na|yr,U_=1<<3,hu=1<<4,q_=1<<5,W_=1<<6;function ia(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}const Pe=ia.prototype;Pe.StopPropagation=kd,Pe.ADD=Ii,Pe.REM=na,Pe.MOD=yr,Pe.ADD_REM=O4,Pe.ADD_MOD=B_,Pe.ALL=Cs,Pe.REFLOW=U_,Pe.SOURCE=hu,Pe.NO_SOURCE=q_,Pe.NO_FIELDS=W_,Pe.fork=function(e){return new ia(this.dataflow).init(this,e)},Pe.clone=function(){const e=this.fork(Cs);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Cs|hu)},Pe.addAll=function(){let e=this;return!e.source||e.source.length===e.add.length||(e=new ia(this.dataflow).init(this),e.add=e.source),e},Pe.init=function(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&W_)&&(n.fields=e.fields),t&Ii?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&na?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&yr?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&q_?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},Pe.runAfter=function(e){this.dataflow.runAfter(e)},Pe.changed=function(e){var t=e||Cs;return t&Ii&&this.add.length||t&na&&this.rem.length||t&yr&&this.mod.length},Pe.reflow=function(e){if(e)return this.fork(Cs).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(yr,G_(this,Ii))),this},Pe.clean=function(e){return arguments.length?(this.cleans=!!e,this):this.cleans},Pe.modifies=function(e){var t=this.fields||(this.fields={});return I(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},Pe.modified=function(e,t){var n=this.fields;return(t||this.mod.length)&&n?arguments.length?I(e)?e.some(i=>n[i]):n[e]:!!n:!1},Pe.filter=function(e,t){var n=this;return e&Ii&&(n.addF=_d(n.addF,t)),e&na&&(n.remF=_d(n.remF,t)),e&yr&&(n.modF=_d(n.modF,t)),e&hu&&(n.srcF=_d(n.srcF,t)),n};function _d(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}Pe.materialize=function(e){e=e||Cs;var t=this;return e&Ii&&t.addF&&(t.add=L0(t.add,t.addF),t.addF=null),e&na&&t.remF&&(t.rem=L0(t.rem,t.remF),t.remF=null),e&yr&&t.modF&&(t.mod=L0(t.mod,t.modF),t.modF=null),e&hu&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t};function L0(e,t){var n=[];return ro(e,t,i=>n.push(i)),n}function G_(e,t){var n={};return e.visit(t,function(i){n[ee(i)]=1}),i=>n[ee(i)]?null:i}Pe.visit=function(e,t){var n=this,i=t,r,a;return e&hu?(ro(n.source,n.srcF,i),n):(e&Ii&&ro(n.add,n.addF,i),e&na&&ro(n.rem,n.remF,i),e&yr&&ro(n.mod,n.modF,i),e&U_&&(r=n.source)&&(a=n.add.length+n.mod.length,a===r.length||(a?ro(r,G_(n,B_),i):ro(r,n.srcF,i))),n)};function P0(e,t,n,i){var r=this,a=0,o,s,l,u,c;for(this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n,l=0,u=n.length;l<u;++l){if(o=n[l],o.stamp!==t)continue;if(o.fields){s=r.fields||(r.fields={});for(c in o.fields)s[c]=1}o.changed(r.ADD)&&(a|=r.ADD),o.changed(r.REM)&&(a|=r.REM),o.changed(r.MOD)&&(a|=r.MOD)}this.changes=a}var $s=P(P0,ia);$s.fork=function(e){var t=new ia(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,function(n){return t.add.push(n)}),e&t.REM&&this.visit(t.REM,function(n){return t.rem.push(n)}),e&t.MOD&&this.visit(t.MOD,function(n){return t.mod.push(n)})),t},$s.changed=function(e){return this.changes&e},$s.modified=function(e){var t=this,n=t.fields;return n&&t.changes&t.MOD?I(e)?e.some(function(i){return n[i]}):n[e]:0},$s.filter=function(){F("MultiPulse does not support filtering.")},$s.materialize=function(){F("MultiPulse does not support materialization.")},$s.visit=function(e,t){var n=this,i=n.pulses,r=i.length,a=0;if(e&n.SOURCE)for(;a<r;++a)i[a].visit(e,t);else for(;a<r;++a)i[a].stamp===n.stamp&&i[a].visit(e,t);return n};async function T4(e,t,n){const i=this,r=[];if(i._pulse)return H_(i);if(i._pending&&await i._pending,t&&await nd(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const a=++i._clock;i._pulse=new ia(i,a,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=td(Yf);let o=0,s,l,u;try{for(;i._heap.size()>0;){if(s=i._heap.pop(),s.rank!==s.qrank){i._enqueue(s,!0);continue}l=s.run(i._getPulse(s,e)),l.then?l=await l:l.async&&(r.push(l.async),l=kd),l!==kd&&(s._targets&&s._targets.forEach(c=>i._enqueue(c))),++o}}catch(c){i._heap.clear(),u=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${a}: ${o} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await nd(i,c[f].callback)}return n&&await nd(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function C4(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function $4(e,t,n){return this._pulse?H_(this):(this.evaluate(e,t,n),this)}function D4(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function H_(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function R4(e,t){var n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function F4(e,t){var n=e.source,i=this._clock;return n&&I(n)?new P0(this,i,n.map(r=>r.pulse),t):this._input[e.id]||N4(this._pulse,n&&n.pulse)}function N4(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==kd&&(e.source=t.source),e)}var z0={skip:!1,force:!1};function I4(e,t){var n=t||z0;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function M4(e,t,n){var i=n||z0;return(e.set(t)||i.force)&&this.touch(e,i),this}function j4(e,t,n){this.touch(e,n||z0);var i=new ia(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function L4(e){var t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Y_(t,0,t.length-1,e)),pop:()=>{var n=t.pop(),i;return t.length?(i=t[0],t[0]=n,P4(t,0,e)):i=n,i}}}function Y_(e,t,n,i){var r,a,o;for(r=e[n];n>t;){if(o=n-1>>1,a=e[o],i(r,a)<0){e[n]=a,n=o;continue}break}return e[n]=r}function P4(e,t,n){for(var i=t,r=e.length,a=e[t],o=(t<<1)+1,s;o<r;)s=o+1,s<r&&n(e[o],e[s])>=0&&(o=s),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=a,Y_(e,i,t,n)}function Ds(){this.logger(ZE()),this.logLevel(KE),this._clock=0,this._rank=0,this._locale=j0();try{this._loader=Ed()}catch(e){}this._touched=td(Yf),this._input={},this._pulse=null,this._heap=L4((e,t)=>e.qrank-t.qrank),this._postrun=[]}var Ae=Ds.prototype;Ae.stamp=function(){return this._clock},Ae.loader=function(e){return arguments.length?(this._loader=e,this):this._loader},Ae.locale=function(e){return arguments.length?(this._locale=e,this):this._locale},Ae.cleanThreshold=1e4,Ae.add=a5,Ae.connect=o5,Ae.rank=A4,Ae.rerank=S4,Ae.pulse=j4,Ae.touch=I4,Ae.update=M4,Ae.changeset=oo,Ae.ingest=m4,Ae.parse=g4,Ae.preload=y4,Ae.request=v4,Ae.events=l5,Ae.on=x4,Ae.evaluate=T4,Ae.run=$4,Ae.runAsync=C4,Ae.runAfter=D4,Ae._enqueue=R4,Ae._getPulse=F4;function pu(e){return function(){return this._log[e].apply(this,arguments)}}Ae.logger=function(e){return arguments.length?(this._log=e,this):this._log},Ae.error=pu("error"),Ae.warn=pu("warn"),Ae.info=pu("info"),Ae.debug=pu("debug"),Ae.logLevel=pu("level");function $(e,t){Re.call(this,e,null,t)}var B0=P($,Re);B0.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},B0.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},B0.transform=function(){};var Rs={};function V_(e){var t=X_(e);return t&&t.Definition||null}function X_(e){return e=e&&e.toLowerCase(),Q(Rs,e)?Rs[e]:null}function z4(e){return function(t){for(var n=e.length,i=1,r=String(e[0](t));i<n;++i)r+="|"+e[i](t);return r}}function U0(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:z4(e)}function J_(e,t,n){return n||e+(t?"_"+t:"")}const q0=()=>{},B4={init:q0,add:q0,rem:q0,idx:0},gu={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},mu=Object.keys(gu);function U4(e,t){return n=>fe({name:e,out:n||e},B4,t)}mu.forEach(e=>{gu[e]=U4(e,gu[e])});function K_(e,t){return gu[e](t)}function Q_(e,t){return e.idx-t.idx}function q4(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{if(!i.req)return;i.req.forEach(r=>{t[r]||n(t[r]=gu[r]())})};return e.forEach(n),Object.values(t).sort(Q_)}function W4(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function G4(e,t){if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid,this._ops.forEach(n=>n.add(this,e,t))}function H4(e,t){if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid,this._ops.forEach(n=>n.rem(this,e,t))}function Y4(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function Z_(e,t){var n=t||Ht,i=q4(e),r=e.slice().sort(Q_);function a(o){this._ops=i,this._out=r,this.cell=o,this.init()}return a.prototype.init=W4,a.prototype.add=G4,a.prototype.rem=H4,a.prototype.set=Y4,a.prototype.get=n,a.fields=e.map(o=>o.out),a}function*eA(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function W0(e,t,n){var i=Float64Array.from(eA(e,n));return i.sort(xs),t.map(r=>G5(i,r))}function G0(e,t){return W0(e,[.25,.5,.75],t)}function H0(e,t){var n=e.length,i=U5(e,t),r=G0(e,t),a=(r[2]-r[0])/1.34;return i=Math.min(i,a)||i||Math.abs(r[0])||1,1.06*i*Math.pow(n,-.2)}function tA(e){var t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2],a=e.extent[0],o=e.extent[1],s=e.span||o-a||Math.abs(a)||1,l,u,c,f,d,h,p,g;if(e.step)l=e.step;else if(e.steps){for(d=s/t,h=0,p=e.steps.length;h<p&&e.steps[h]<d;++h);l=e.steps[Math.max(0,h-1)]}else{for(u=Math.ceil(Math.log(t)/i),c=e.minstep||0,l=Math.max(c,Math.pow(n,Math.round(Math.log(s)/i)-u));Math.ceil(s/l)>t;)l*=n;for(h=0,p=r.length;h<p;++h)d=l/r[h],d>=c&&s/d<=t&&(l=d)}return d=Math.log(l),f=d>=0?0:~~(-d/i)+1,g=Math.pow(n,-f-1),(e.nice||e.nice===void 0)&&(d=Math.floor(a/l+g)*l,a=a<d?d-l:d,o=Math.ceil(o/l)*l),{start:a,stop:o===a?a+l:o,step:l}}var qn=Math.random;function V4(e){qn=e}function nA(e,t,n,i){if(!e.length)return[void 0,void 0];var r=Float64Array.from(eA(e,i)),a=r.length,o=t,s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=r[~~(qn()*a)];c[u]=s/a}return c.sort(xs),[fd(c,n/2),fd(c,1-n/2)]}function iA(e,t,n,i){i=i||(d=>d);let r=0,a=1,o=e.length,s=new Float64Array(o),l=i(e[0]),u=l,c=l+t,f;for(;a<o;++a){if(f=i(e[a]),f>=c){for(u=(l+u)/2;r<a;++r)s[r]=u;c=f+t,l=f}u=f}for(u=(l+u)/2;r<a;++r)s[r]=u;return n?X4(s,t+t/4):s}function X4(e,t){let n=e.length,i=0,r=1,a,o;for(;e[i]===e[r];)++r;for(;r<n;){for(a=r+1;e[r]===e[a];)++a;if(e[r]-e[r-1]<t){for(o=r+(i+a-r-r>>1);o<r;)e[o++]=e[r];for(;o>r;)e[o--]=e[i]}i=r,r=a}return e}function J4(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function K4(e,t){t==null&&(t=e,e=0);var n={},i,r,a;return n.min=function(o){return arguments.length?(i=o||0,a=r-i,n):i},n.max=function(o){return arguments.length?(r=o||0,a=r-i,n):r},n.sample=function(){return i+Math.floor(a*qn())},n.pdf=function(o){return o===Math.floor(o)&&o>=i&&o<r?1/a:0},n.cdf=function(o){var s=Math.floor(o);return s<i?0:s>=r?1:(s-i+1)/a},n.icdf=function(o){return o>=0&&o<=1?i-1+Math.floor(o*a):NaN},n.min(e).max(t)}const rA=Math.sqrt(2*Math.PI),Q4=Math.SQRT2;let vu=NaN;function Ad(e,t){e=e||0,t=t??1;let n=0,i=0,r,a;if(vu===vu)n=vu,vu=NaN;else{do n=qn()*2-1,i=qn()*2-1,r=n*n+i*i;while(r===0||r>1);a=Math.sqrt(-2*Math.log(r)/r),n*=a,vu=i*a}return e+n*t}function Y0(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*rA)}function Sd(e,t,n){t=t||0,n=n??1;let i,r=(e-t)/n,a=Math.abs(r);if(a>37)i=0;else{let o,s=Math.exp(-a*a/2);a<7.07106781186547?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,i=s*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,i=i/o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,i=s/o/2.506628274631)}return r>0?1-i:i}function Od(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*Q4*Z4(2*e-1)}function Z4(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=Infinity,n*e}function V0(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>Ad(n,i),pdf:a=>Y0(a,n,i),cdf:a=>Sd(a,n,i),icdf:a=>Od(a,n,i)};return r.mean(e).stdev(t)}function X0(e,t){var n=V0(),i={},r=0;return i.data=function(a){return arguments.length?(e=a,r=a?a.length:0,i.bandwidth(t)):e},i.bandwidth=function(a){return arguments.length?(t=a,!t&&e&&(t=H0(e)),i):t},i.sample=function(){return e[~~(qn()*r)]+t*n.sample()},i.pdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.pdf((a-e[s])/t);return o/t/r},i.cdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.cdf((a-e[s])/t);return o/r},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)}function J0(e,t){return e=e||0,t=t??1,Math.exp(e+Ad()*t)}function K0(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*rA*e)}function Q0(e,t,n){return Sd(Math.log(e),t,n)}function Z0(e,t,n){return Math.exp(Od(e,t,n))}function aA(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>J0(n,i),pdf:a=>K0(a,n,i),cdf:a=>Q0(a,n,i),icdf:a=>Z0(a,n,i)};return r.mean(e).stdev(t)}function oA(e,t){var n={},i=0,r;function a(o){var s=[],l=0,u;for(u=0;u<i;++u)l+=s[u]=o[u]==null?1:+o[u];for(u=0;u<i;++u)s[u]/=l;return s}return n.weights=function(o){return arguments.length?(r=a(t=o||[]),n):t},n.distributions=function(o){return arguments.length?(o?(i=o.length,e=o):(i=0,e=[]),n.weights(t)):e},n.sample=function(){for(var o=qn(),s=e[i-1],l=r[0],u=0;u<i-1;l+=r[++u])if(o<l){s=e[u];break}return s.sample()},n.pdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].pdf(o);return s},n.cdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].cdf(o);return s},n.icdf=function(){throw Error("Mixture icdf not supported.")},n.distributions(e).weights(t)}function ev(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*qn()}function tv(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function nv(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function iv(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function sA(e,t){var n,i,r={min:function(a){return arguments.length?(n=a||0,r):n},max:function(a){return arguments.length?(i=a??1,r):i},sample:()=>ev(n,i),pdf:a=>tv(a,n,i),cdf:a=>nv(a,n,i),icdf:a=>iv(a,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function yu(e,t,n,i){const r=i-e*e,a=Math.abs(r)<1e-24?0:(n-e*t)/r,o=t-a*e;return[o,a]}function Td(e,t,n,i){e=e.filter(h=>{let p=t(h),g=n(h);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),i&&e.sort((h,p)=>t(h)-t(p));const r=e.length,a=new Float64Array(r),o=new Float64Array(r);let s=0,l=0,u=0,c,f,d;for(d of e)a[s]=c=+t(d),o[s]=f=+n(d),++s,l+=(c-l)/s,u+=(f-u)/s;for(s=0;s<r;++s)a[s]-=l,o[s]-=u;return[a,o,l,u]}function bu(e,t,n,i){let r=-1,a,o;for(let s of e)a=t(s),o=n(s),a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o&&i(a,o,++r)}function Fs(e,t,n,i,r){let a=0,o=0;return bu(e,t,n,(s,l)=>{const u=l-r(s),c=l-i;a+=u*u,o+=c*c}),1-a/o}function rv(e,t,n){let i=0,r=0,a=0,o=0,s=0;bu(e,t,n,(c,f)=>{++s,i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=yu(i,r,a,o),u=c=>l[0]+l[1]*c;return{coef:l,predict:u,rSquared:Fs(e,t,n,r,u)}}function lA(e,t,n){let i=0,r=0,a=0,o=0,s=0;bu(e,t,n,(c,f)=>{++s,c=Math.log(c),i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=yu(i,r,a,o),u=c=>l[0]+l[1]*Math.log(c);return{coef:l,predict:u,rSquared:Fs(e,t,n,r,u)}}function uA(e,t,n){const[i,r,a,o]=Td(e,t,n);let s=0,l=0,u=0,c=0,f=0,d,h,p;bu(e,t,n,(y,b)=>{d=i[f++],h=Math.log(b),p=d*b,s+=(b*h-s)/f,l+=(p-l)/f,u+=(p*h-u)/f,c+=(d*p-c)/f});const[g,m]=yu(l/o,s/o,u/o,c/o),v=y=>Math.exp(g+m*(y-a));return{coef:[Math.exp(g-m*a),m],predict:v,rSquared:Fs(e,t,n,o,v)}}function cA(e,t,n){let i=0,r=0,a=0,o=0,s=0,l=0;bu(e,t,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++l,i+=(h-i)/l,r+=(p-r)/l,a+=(h*p-a)/l,o+=(h*h-o)/l,s+=(d-s)/l});const u=yu(i,r,a,o),c=f=>u[0]*Math.pow(f,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:Fs(e,t,n,s,c)}}function av(e,t,n){const[i,r,a,o]=Td(e,t,n),s=i.length;let l=0,u=0,c=0,f=0,d=0,h,p,g,m;for(h=0;h<s;)p=i[h],g=r[h++],m=p*p,l+=(m-l)/h,u+=(m*p-u)/h,c+=(m*m-c)/h,f+=(p*g-f)/h,d+=(m*g-d)/h;const v=c-l*l,y=l*v-u*u,b=(d*l-f*u)/y,E=(f*v-d*u)/y,x=-b*l,k=w=>(w=w-a,b*w*w+E*w+x+o);return{coef:[x-E*a+b*a*a+o,E-2*b*a,b],predict:k,rSquared:Fs(e,t,n,o,k)}}function fA(e,t,n,i){if(i===1)return rv(e,t,n);if(i===2)return av(e,t,n);const[r,a,o,s]=Td(e,t,n),l=r.length,u=[],c=[],f=i+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d)*a[p];for(u.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d+h);m[h]=g}c.push(m)}c.push(u);const v=t8(c),y=b=>{b-=o;let E=s+v[0]+v[1]*b+v[2]*b*b;for(d=3;d<f;++d)E+=v[d]*Math.pow(b,d);return E};return{coef:e8(f,v,-o,s),predict:y,rSquared:Fs(e,t,n,s,y)}}function e8(e,t,n,i){const r=Array(e);let a,o,s,l;for(a=0;a<e;++a)r[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,r[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,r[a-o]+=s*Math.pow(n,o)*l;return r[0]+=i,r}function t8(e){const t=e.length-1,n=[];let i,r,a,o,s;for(i=0;i<t;++i){for(o=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][o])&&(o=r);for(a=i;a<t+1;++a)s=e[a][i],e[a][i]=e[a][o],e[a][o]=s;for(r=i+1;r<t;++r)for(a=t;a>=i;a--)e[a][r]-=e[a][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(s=0,a=r+1;a<t;++a)s+=e[a][r]*n[a];n[r]=(e[t][r]-s)/e[r][r]}return n}const dA=2,hA=1e-12;function pA(e,t,n,i){const[r,a,o,s]=Td(e,t,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let h=-1;++h<=dA;){const p=[0,u-1];for(let m=0;m<l;++m){const v=r[m],y=p[0],b=p[1],E=v-r[y]>r[b]-v?y:b;let x=0,k=0,w=0,A=0,_=0,O=1/Math.abs(r[E]-v||1);for(let D=y;D<=b;++D){const M=r[D],C=a[D],N=n8(Math.abs(v-M)*O)*d[D],W=M*N;x+=N,k+=W,w+=C*N,A+=C*W,_+=M*W}const[S,T]=yu(k/x,w/x,A/x,_/x);c[m]=S+T*v,f[m]=Math.abs(a[m]-c[m]),i8(r,m+1,p)}if(h===dA)break;const g=Nk(f);if(Math.abs(g)<hA)break;for(let m=0,v,y;m<l;++m)v=f[m]/(6*g),d[m]=v>=1?hA:(y=1-v*v)*y}return r8(r,c,o,s)}function n8(e){return(e=1-e*e*e)*e*e}function i8(e,t,n){let i=e[t],r=n[0],a=n[1]+1;if(a>=e.length)return;for(;t>r&&e[a]-i<=i-e[r];)n[0]=++r,n[1]=a,++a}function r8(e,t,n,i){const r=e.length,a=[];let o=0,s=0,l=[],u;for(;o<r;++o)u=e[o]+n,l[0]===u?l[1]+=(t[o]-l[1])/++s:(s=0,l[1]+=i,l=[u,t[o]],a.push(l));return l[1]+=i,a}const a8=.1*Math.PI/180;function Cd(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=h=>[h,e(h)],a=t[0],o=t[1],s=o-a,l=s/i,u=[r(a)],c=[];if(n===i){for(let h=1;h<i;++h)u.push(r(a+h/n*s));return u.push(r(o)),u}else{c.push(r(o));for(let h=n;--h>0;)c.push(r(a+h/n*s))}let f=u[0],d=c[c.length-1];for(;d;){const h=r((f[0]+d[0])/2);h[0]-f[0]>=l&&o8(f,h,d)>a8?c.push(h):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function o8(e,t,n){const i=Math.atan2(n[1]-e[1],n[0]-e[0]),r=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(i-r)}function ov(e){this._key=e?Ri(e):ee,this.reset()}var _t=ov.prototype;_t.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},_t.add=function(e){this._add.push(e)},_t.rem=function(e){this._rem.push(e)},_t.values=function(){if(this._get=null,this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,a=Array(i-r),o={},s,l,u;for(s=0;s<r;++s)o[n(t[s])]=1;for(s=0,l=0;s<i;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},_t.distinct=function(e){for(var t=this.values(),n=t.length,i={},r=0,a;--n>=0;)a=e(t[n])+"",Q(i,a)||(i[a]=1,++r);return r},_t.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=Uz(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},_t.argmin=function(e){return this.extent(e)[0]||{}},_t.argmax=function(e){return this.extent(e)[1]||{}},_t.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):void 0},_t.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):void 0},_t.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=G0(this.values(),e),this._get=e),this._q},_t.q1=function(e){return this.quartile(e)[0]},_t.q2=function(e){return this.quartile(e)[1]},_t.q3=function(e){return this.quartile(e)[2]},_t.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=nA(this.values(),1e3,.05,e),this._get=e),this._ci},_t.ci0=function(e){return this.ci(e)[0]},_t.ci1=function(e){return this.ci(e)[1]};function mo(e){$.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}mo.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:mu},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Wn=P(mo,$);Wn.transform=function(e,t){var n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(n.value=n.value||n.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},Wn.cross=function(){var e=this,t=e.value,n=e._dnames,i=n.map(function(){return{}}),r=n.length;function a(s){var l,u,c,f;for(l in s)for(c=s[l].tuple,u=0;u<r;++u)i[u][f=c[n[u]]]=f}a(e._prev),a(t);function o(s,l,u){var c=n[u],f=i[u++],d,h;for(d in f)l[c]=f[d],h=s?s+"|"+d:d,u<r?o(h,l,u):t[h]||e.cell(h,l)}o("",{},0)},Wn.init=function(e){var t=this._inputs=[],n=this._outputs=[],i={};function r(m){for(var v=G(Gt(m)),y=0,b=v.length,E;y<b;++y)i[E=v[y]]||(i[E]=1,t.push(E))}this._dims=G(e.groupby),this._dnames=this._dims.map(function(m){var v=Ze(m);return r(m),n.push(v),v}),this.cellkey=e.key?e.key:U0(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={},c,f,d,h,p,g;for(l!==o.length&&F("Unmatched number of fields and aggregate ops."),g=0;g<l;++g){if(c=a[g],f=o[g],c==null&&f!=="count"&&F("Null aggregate field specified."),h=Ze(c),p=J_(f,h,s[g]),n.push(p),f==="count"){this._counts.push(p);continue}d=u[h],d||(r(c),d=u[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(K_(f,p))}return this._measures=this._measures.map(function(m){return Z_(m,m.field)}),{}},Wn.cellkey=U0(),Wn.cell=function(e,t){var n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},Wn.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var i=this._measures,r=i.length,a;for(n.agg=Array(r),a=0;a<r;++a)n.agg[a]=new i[a](n)}return n.store&&(n.data=new ov()),n},Wn.newtuple=function(e,t){var n=this._dnames,i=this._dims,r={},a,o;for(a=0,o=i.length;a<o;++a)r[n[a]]=i[a](e);return t?vk(t.tuple,r):ke(r)},Wn.clean=function(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},Wn.add=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num+=1,this._countOnly)return;for(n.store&&n.data.add(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].add(i[r].get(e),e)},Wn.rem=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num-=1,this._countOnly)return;for(n.store&&n.data.rem(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].rem(i[r].get(e),e)},Wn.celltuple=function(e){var t=e.tuple,n=this._counts,i,r,a;for(e.store&&e.data.values(),r=0,a=n.length;r<a;++r)t[n[r]]=e.num;if(!this._countOnly)for(i=e.agg,r=0,a=i.length;r<a;++r)i[r].set(t);return t},Wn.changes=function(e){var t=this._adds,n=this._mods,i=this._prev,r=this._drop,a=e.add,o=e.rem,s=e.mod,l,u,c,f;if(i)for(u in i)l=i[u],(!r||l.num)&&o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(l.num===0&&r?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e};const s8=1e-14;function sv(e){$.call(this,null,e)}sv.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var gA=P(sv,$);gA.transform=function(e,t){var n=e.interval!==!1,i=this._bins(e),r=i.start,a=i.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1],u;return e.modified()?(t=t.reflow(!0),u=t.SOURCE):u=t.modified(Gt(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?function(c){var f=i(c);c[s]=f,c[l]=f==null?null:r+a*(1+(f-r)/a)}:function(c){c[s]=i(c)}),t.modifies(n?o:s)},gA._bins=function(e){if(this.value&&!e.modified())return this.value;var t=e.field,n=tA(e),i=n.step,r=n.start,a=r+Math.ceil((n.stop-r)/i)*i,o,s;(o=e.anchor)!=null&&(s=o-(r+i*Math.floor((o-r)/i)),r+=s,a+=s);var l=function(u){var c=cn(t(u));return c==null?null:c<r?-Infinity:c>a?Infinity:(c=Math.max(r,Math.min(c,a-i)),r+i*Math.floor(s8+(c-r)/i))};return l.start=r,l.stop=n.stop,l.step=i,this.value=Dn(l,Gt(t),e.name||"bin_"+Ze(t))};function mA(e,t,n){var i=e,r=t||[],a=n||[],o={},s=0;return{add:function(l){a.push(l)},remove:function(l){o[i(l)]=++s},size:function(){return r.length},data:function(l,u){return s&&(r=r.filter(function(c){return!o[i(c)]}),o={},s=0),u&&l&&r.sort(l),a.length&&(r=l?Xz(l,r,a.sort(l)):r.concat(a),a=[]),r}}}function lv(e){$.call(this,[],e)}lv.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};var l8=P(lv,$);l8.transform=function(e,t){var n=t.fork(t.ALL),i=mA(ee,this.value,n.materialize(n.ADD).add),r=e.sort,a=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(ao(r),a),t.source&&t.source.root&&(this.value.root=t.source.root),n};function vA(e){Re.call(this,null,u8,e)}P(vA,Re);function u8(e){return this.value&&!e.modified()?this.value:lk(e.fields,e.orders)}function uv(e){$.call(this,null,e)}uv.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function c8(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}var cv=P(uv,$);cv.transform=function(e,t){function n(f){return function(d){for(var h=c8(s(d),e.case,a)||[],p,g=0,m=h.length;g<m;++g)o.test(p=h[g])||f(p)}}var i=this._parameterCheck(e,t),r=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(function(f){r[f]=1+(r[f]||0)}),c=n(function(f){r[f]-=1});return i?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},cv._parameterCheck=function(e,t){var n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},cv._finish=function(e,t){var n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS),s,l,u;for(s in n)l=i[s],u=n[s]||0,!l&&u?(i[s]=l=ke({}),l[r]=s,l[a]=u,o.add.push(l)):u===0?(l&&o.rem.push(l),n[s]=null,i[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)};function fv(e){$.call(this,null,e)}fv.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};var f8=P(fv,$);f8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=this.value,r=e.as||["a","b"],a=r[0],o=r[1],s=!i||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");return s?(i&&(n.rem=i),i=t.materialize(t.SOURCE).source,n.add=this.value=d8(i,a,o,e.filter||Fi)):n.mod=i,n.source=this.value,n.modifies(r)};function d8(e,t,n,i){for(var r=[],a={},o=e.length,s=0,l,u;s<o;++s)for(a[t]=u=e[s],l=0;l<o;++l)a[n]=e[l],i(a)&&(r.push(ke(a)),a={},a[t]=u);return r}var yA={kde:X0,mixture:oA,normal:V0,lognormal:aA,uniform:sA},h8="distributions",bA="function",p8="field";function wA(e,t){var n=e[bA];Q(yA,n)||F("Unknown distribution function: "+n);var i=yA[n]();for(var r in e)r===p8?i.data((e.from||t()).map(e[r])):r===h8?i[r](e[r].map(function(a){return wA(a,t)})):typeof i[r]===bA&&i[r](e[r]);return i}function dv(e){$.call(this,null,e)}var xA=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],g8={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:xA},{name:"weights",type:"number",array:!0}]};dv.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:xA.concat(g8)},{name:"as",type:"string",array:!0,default:["value","density"]}]};var m8=P(dv,$);m8.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var i=wA(e.distribution,v8(t)),r=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200,o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&F("Invalid density method: "+o),!e.extent&&!i.data&&F("Missing density extent parameter."),o=i[o];var s=e.as||["value","density"],l=e.extent||mr(i.data()),u=Cd(o,l,r,a).map(c=>{var f={};return f[s[0]]=c[0],f[s[1]]=c[1],ke(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function v8(e){return function(){return e.materialize(e.SOURCE).source}}function EA(e,t){return e?e.map(function(n,i){return t[i]||Ze(n)}):null}function hv(e,t,n){var i=[],r=function(f){return f(l)},a,o,s,l,u,c;if(t==null)i.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(r),c=a[u],c||(a[u]=c=[],c.dims=u,i.push(c)),c.push(n(l));return i}const kA="bin";function pv(e){$.call(this,null,e)}pv.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:kA}]};const y8=P(pv,$);y8.transform=function(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=hv(t.source,e.groupby,Ht),r=e.smooth||!1,a=e.field,o=e.step||b8(n,a),s=ao((p,g)=>a(p)-a(g)),l=e.as||kA,u=i.length;let c=Infinity,f=-Infinity,d=0,h;for(;d<u;++d){const p=i[d].sort(s);h=-1;for(const g of iA(p,o,r,a))g<c&&(c=g),g>f&&(f=g),p[++h][l]=g}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(l)};function b8(e,t){return ed(mr(e,t))/30}function _A(e){Re.call(this,null,w8,e),this.modified(!0)}P(_A,Re);function w8(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:Dn(n=>t(n,e),Gt(t),Ze(t))}function gv(e){$.call(this,[void 0,void 0],e)}gv.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};var x8=P(gv,$);x8.transform=function(e,t){var n=this.value,i=e.field,r=n[0],a=n[1],o;if(o=t.changed()||t.modified(i.fields)||e.modified("field"),(o||r==null)&&(r=Infinity,a=-Infinity),t.visit(o?t.SOURCE:t.ADD,function(s){var l=cn(i(s));l!=null&&(l<r&&(r=l),l>a&&(a=l))}),!Number.isFinite(r)||!Number.isFinite(a)){let s=Ze(i);s&&(s=` for field "${s}"`),t.dataflow.warn(`Infinite extent${s}: [${r}, ${a}]`),r=a=void 0}this.value=[r,a]};function mv(e,t){Re.call(this,e),this.parent=t,this.count=0}var Ns=P(mv,Re);Ns.connect=function(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},Ns.add=function(e){this.count+=1,this.value.add.push(e)},Ns.rem=function(e){this.count-=1,this.value.rem.push(e)},Ns.mod=function(e){this.value.mod.push(e)},Ns.init=function(e){this.value.init(e,e.NO_SOURCE)},Ns.evaluate=function(){return this.value};function $d(e){$.call(this,{},e),this._keys=Kl();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}const wu=P($d,$);wu.activate=function(e){this._targets[this._targets.active++]=e},wu.subflow=function(e,t,n,i){let r=this.value,a=Q(r,e)&&r[e],o,s;return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=i||(s=this._group[e])&&s.tuple,o=n.dataflow,a=new mv(n.fork(n.NO_SOURCE),this),o.add(a).connect(t(o,e,s)),r[e]=a,this.activate(a)),a},wu.clean=function(){const e=this.value;for(const t in e)if(e[t].count===0){const n=e[t].detachSubflow;n&&n(),delete e[t]}},wu.initTargets=function(){const e=this._targets,t=e.length;for(let n=0;n<t&&e[n]!=null;++n)e[n]=null;e.active=0},wu.transform=function(e,t){const n=t.dataflow,i=e.key,r=e.subflow,a=this._keys,o=e.modified("key"),s=l=>this.subflow(l,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,l=>{const u=ee(l),c=a.get(u);c!==void 0&&(a.delete(u),s(c).rem(l))}),t.visit(t.ADD,l=>{const u=i(l);a.set(ee(l),u),s(u).add(l)}),o||t.modified(i.fields)?t.visit(t.MOD,l=>{const u=ee(l),c=a.get(u),f=i(l);c===f?s(f).mod(l):(a.set(u,f),s(c).rem(l),s(f).add(l))}):t.changed(t.MOD)&&t.visit(t.MOD,l=>{s(a.get(ee(l))).mod(l)}),o&&t.visit(t.REFLOW,l=>{const u=ee(l),c=a.get(u),f=i(l);c!==f&&(a.set(u,f),s(c).rem(l),s(f).add(l))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t};function AA(e){Re.call(this,null,E8,e)}P(AA,Re);function E8(e){return this.value&&!e.modified()?this.value:I(e.name)?G(e.name).map(function(t){return Ri(t)}):Ri(e.name,e.as)}function vv(e){$.call(this,Kl(),e)}vv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};var k8=P(vv,$);k8.transform=function(e,t){var n=t.dataflow,i=this.value,r=t.fork(),a=r.add,o=r.rem,s=r.mod,l=e.expr,u=!0;t.visit(t.REM,function(f){var d=ee(f);i.has(d)?i.delete(d):o.push(f)}),t.visit(t.ADD,function(f){l(f,e)?a.push(f):i.set(ee(f),1)});function c(f){var d=ee(f),h=l(f,e),p=i.get(d);h&&p?(i.delete(d),a.push(f)):!h&&!p?(i.set(d,1),o.push(f)):u&&h&&!p&&s.push(f)}return t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r};function yv(e){$.call(this,[],e)}yv.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};var _8=P(yv,$);_8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=EA(i,e.as||[]),a=e.index||null,o=r.length;return n.rem=this.value,t.visit(t.SOURCE,function(s){for(var l=i.map(p=>p(s)),u=l.reduce((p,g)=>Math.max(p,g.length),0),c=0,f,d,h;c<u;++c){for(d=Jm(s),f=0;f<o;++f)d[r[f]]=(h=l[f][c])==null?null:h;a&&(d[a]=c),n.add.push(d)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)};function bv(e){$.call(this,[],e)}bv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};var A8=P(bv,$);A8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(Ze),a=e.as||["key","value"],o=a[0],s=a[1],l=i.length;return n.rem=this.value,t.visit(t.SOURCE,function(u){for(var c=0,f;c<l;++c)f=Jm(u),f[o]=r[c],f[s]=i[c](u),n.add.push(f)}),this.value=n.source=n.add,n.modifies(a)};function wv(e){$.call(this,null,e)}wv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};var S8=P(wv,$);S8.transform=function(e,t){var n=e.expr,i=e.as,r=e.modified(),a=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(a,o=>o[i]=n(o,e))};function SA(e){$.call(this,[],e)}var O8=P(SA,$);O8.transform=function(e,t){var n=this.value,i=t.fork(t.ALL),r=e.size-n.length,a=e.generator,o,s,l;if(r>0){for(o=[];--r>=0;)o.push(l=ke(a(e))),n.push(l);i.add=i.add.length?i.materialize(i.ADD).add.concat(o):o}else s=n.slice(0,-r),i.rem=i.rem.length?i.materialize(i.REM).rem.concat(s):s,n=n.slice(-r);return i.source=this.value=n,i};var Dd={value:"value",median:Nk,mean:H5,min:c0,max:lo},T8=[];function xv(e){$.call(this,[],e)}xv.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var C8=P(xv,$);function $8(e){var t=e.method||Dd.value,n;if(Dd[t]==null)F("Unrecognized imputation method: "+t);else return t===Dd.value?(n=e.value!==void 0?e.value:0,function(){return n}):Dd[t]}function D8(e){var t=e.field;return function(n){return n?t(n):NaN}}C8.transform=function(e,t){var n=t.fork(t.ALL),i=$8(e),r=D8(e),a=Ze(e.field),o=Ze(e.key),s=(e.groupby||[]).map(Ze),l=R8(t.source,e.groupby,e.key,e.keyvals),u=[],c=this.value,f=l.domain.length,d,h,p,g,m,v,y,b,E,x;for(m=0,b=l.length;m<b;++m)for(d=l[m],p=d.values,h=NaN,y=0;y<f;++y){if(d[y]!=null)continue;for(g=l.domain[y],x={_impute:!0},v=0,E=p.length;v<E;++v)x[s[v]]=p[v];x[o]=g,x[a]=Number.isNaN(h)?h=i(d,r):h,u.push(ke(x))}return u.length&&(n.add=n.materialize(n.ADD).add.concat(u)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=u,n};function R8(e,t,n,i){var r=function(v){return v(m)},a=[],o=i?i.slice():[],s={},l={},u,c,f,d,h,p,g,m;for(o.forEach(function(v,y){s[v]=y+1}),d=0,g=e.length;d<g;++d)m=e[d],p=n(m),h=s[p]||(s[p]=o.push(p)),c=(u=t?t.map(r):T8)+"",(f=l[c])||(f=l[c]=[],a.push(f),f.values=u),f[h-1]=m;return a.domain=o,a}function Ev(e){mo.call(this,e)}Ev.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:mu},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var OA=P(Ev,mo);OA.transform=function(e,t){var n=this,i=e.modified(),r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,function(a){n.add(a)})):(r=n.value=n.value||this.init(e),t.visit(t.REM,function(a){n.rem(a)}),t.visit(t.ADD,function(a){n.add(a)})),n.changes(),t.visit(t.SOURCE,function(a){fe(a,r[n.cellkey(a)].tuple)}),t.reflow(i).modifies(this._outputs)},OA.changes=function(){var e=this._adds,t=this._mods,n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0};function kv(e){$.call(this,null,e)}kv.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};var F8=P(kv,$);F8.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=hv(i,e.groupby,e.field),a=(e.groupby||[]).map(Ze),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;s!=="pdf"&&s!=="cdf"&&F("Invalid density method: "+s),e.resolve==="shared"&&(c||(c=mr(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const p=X0(h,o)[s],g=e.counts?h.length:1,m=c||mr(h);Cd(p,m,f,d).forEach(v=>{const y={};for(let b=0;b<a.length;++b)y[a[b]]=h.dims[b];y[l[0]]=v[0],y[l[1]]=v[1]*g,u.push(ke(y))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function TA(e){Re.call(this,null,N8,e)}P(TA,Re);function N8(e){return this.value&&!e.modified()?this.value:fk(e.fields,e.flat)}function CA(e){$.call(this,[],e),this._pending=null}var I8=P(CA,$);I8.transform=function(e,t){const n=t.dataflow;if(this._pending)return _v(this,t,this._pending);if(M8(e))return t.StopPropagation;if(e.values)return _v(this,t,n.parse(e.values,e.format));if(e.async){const i=n.request(e.url,e.format).then(r=>(this._pending=G(r.data),a=>a.touch(this)));return{async:i}}else return n.request(e.url,e.format).then(i=>_v(this,t,G(i.data)))};function M8(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function _v(e,t,n){n.forEach(ke);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Av(e){$.call(this,{},e)}Av.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};var j8=P(Av,$);j8.transform=function(e,t){var n=t,i=e.as,r=e.fields,a=e.index,o=e.values,s=e.default==null?null:e.default,l=e.modified(),u=l?t.SOURCE:t.ADD,c=r.length,f,d,h;return o?(d=o.length,c>1&&!i&&F('Multi-field lookup requires explicit "as" parameter.'),i&&i.length!==c*d&&F('The "as" parameter has too few output field names.'),i=i||o.map(Ze),f=function(p){for(var g=0,m=0,v,y;g<c;++g)if(y=a.get(r[g](p)),y==null)for(v=0;v<d;++v,++m)p[i[m]]=s;else for(v=0;v<d;++v,++m)p[i[m]]=o[v](y)}):(i||F("Missing output field names."),f=function(p){for(var g=0,m;g<c;++g)m=a.get(r[g](p)),p[i[g]]=m??s}),l?n=t.reflow(!0):(h=r.some(function(p){return t.modified(p.fields)}),u|=h?t.MOD:0),t.visit(u,f),n.modifies(i)};function $A(e){Re.call(this,null,L8,e)}P($A,Re);function L8(e){if(this.value&&!e.modified())return this.value;var t=Infinity,n=-Infinity,i=e.extents,r,a,o;for(r=0,a=i.length;r<a;++r)o=i[r],o[0]<t&&(t=o[0]),o[1]>n&&(n=o[1]);return[t,n]}function DA(e){Re.call(this,null,P8,e)}P(DA,Re);function P8(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(t,n){return t.concat(n)},[])}function Sv(e){$.call(this,null,e)}P(Sv,$),Sv.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)};function Ov(e){mo.call(this,e)}Ov.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:mu,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var Tv=P(Ov,mo);Tv._transform=Tv.transform,Tv.transform=function(e,t){return this._transform(z8(e,t),t)};function z8(e,t){var n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",a=Gt(n).concat(Gt(i)),o=U8(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(function(){return r}),fields:o.map(function(s){return B8(s,n,i,a)}),as:o.map(function(s){return s+""}),modified:e.modified.bind(e)}}function B8(e,t,n,i){return Dn(function(r){return t(r)===e?n(r):NaN},i,e+"")}function U8(e,t,n){var i={},r=[];return n.visit(n.SOURCE,function(a){var o=e(a);i[o]||(i[o]=1,r.push(o))}),r.sort(function(a,o){return(a<o||a==null)&&o!=null?-1:(a>o||o==null)&&a!=null?1:(o=o instanceof Date?+o:o,a=a instanceof Date?+a:a)!==a&&o===o?-1:o!==o&&a===a?1:0}),t?r.slice(0,t):r}function RA(e){$d.call(this,e)}const q8=P(RA,$d);q8.transform=function(e,t){const n=e.subflow,i=e.field,r=a=>this.subflow(ee(a),n,t,a);return(e.modified("field")||i&&t.modified(Gt(i)))&&F("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,a=>{const o=r(a);i(a).forEach(s=>o.mod(s))}),t.visit(t.ADD,a=>{const o=r(a);i(a).forEach(s=>o.add(ke(s)))}),t.visit(t.REM,a=>{const o=r(a);i(a).forEach(s=>o.rem(s))})):(t.visit(t.MOD,a=>r(a).mod(a)),t.visit(t.ADD,a=>r(a).add(a)),t.visit(t.REM,a=>r(a).rem(a))),t.clean()&&t.runAfter(()=>this.clean()),t};function Cv(e){$.call(this,null,e)}Cv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};var W8=P(Cv,$);W8.transform=function(e,t){var n=e.fields,i=EA(e.fields,e.as||[]),r=n?function(s,l){return G8(s,l,n,i)}:Km,a,o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),a=t.fork(t.NO_SOURCE),t.visit(t.REM,function(s){var l=ee(s);a.rem.push(o[l]),o[l]=null}),t.visit(t.ADD,function(s){var l=r(s,ke({}));o[ee(s)]=l,a.add.push(l)}),t.visit(t.MOD,function(s){a.mod.push(r(s,o[ee(s)]))}),a};function G8(e,t,n,i){for(var r=0,a=n.length;r<a;++r)t[i[r]]=n[r](e);return t}function FA(e){$.call(this,null,e)}var H8=P(FA,$);H8.transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function $v(e){$.call(this,null,e)}$v.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var Y8=P($v,$),V8=1e-14;Y8.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,a=hv(r,e.groupby,e.field),o=(e.groupby||[]).map(Ze),s=[],l=e.step||.01,u=e.probs||so(l/2,1-V8,l),c=u.length;return a.forEach(f=>{const d=W0(f,u);for(let h=0;h<c;++h){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[i[0]]=u[h],p[i[1]]=d[h],s.push(ke(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n};function NA(e){$.call(this,null,e)}var X8=P(NA,$);X8.transform=function(e,t){var n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{var a=ee(r);n.rem.push(i[a]),i[a]=null}),t.visit(t.ADD,r=>{var a=Jm(r);i[ee(r)]=a,n.add.push(a)}),t.visit(t.MOD,r=>{var a=i[ee(r)],o;for(o in r)a[o]=r[o],n.modifies(o);n.mod.push(a)})),n};function Dv(e){$.call(this,[],e),this.count=0}Dv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var J8=P(Dv,$);J8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,a=this.value,o=this.count,s=0,l=a.reduce(function(d,h){return d[ee(h)]=1,d},{});function u(d){var h,p;a.length<r?a.push(d):(p=~~((o+1)*qn()),p<a.length&&p>=s&&(h=a[p],l[ee(h)]&&n.rem.push(h),a[p]=d)),++o}if(t.rem.length&&(t.visit(t.REM,function(d){var h=ee(d);l[h]&&(l[h]=-1,n.rem.push(d)),--o}),a=a.filter(function(d){return l[ee(d)]!==-1})),(t.rem.length||i)&&a.length<r&&t.source&&(s=o=a.length,t.visit(t.SOURCE,function(d){l[ee(d)]||u(d)}),s=-1),i&&a.length>r){for(var c=0,f=a.length-r;c<f;++c)l[ee(a[c])]=-1,n.rem.push(a[c]);a=a.slice(f)}return t.mod.length&&t.visit(t.MOD,function(d){l[ee(d)]&&n.mod.push(d)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||s<0)&&(n.add=a.filter(function(d){return!l[ee(d)]})),this.count=o,this.value=n.source=a,n};function Rv(e){$.call(this,null,e)}Rv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var K8=P(Rv,$);K8.transform=function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=so(e.start,e.stop,e.step||1).map(function(r){var a={};return a[i]=r,ke(a)}),n.add=t.add.concat(this.value),n};function IA(e){$.call(this,null,e),this.modified(!0)}var Q8=P(IA,$);Q8.transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Fv(e){$.call(this,null,e)}const MA=["unit0","unit1"];Fv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:p0,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:MA}]};var jA=P(Fv,$);jA.transform=function(e,t){var n=e.field,i=e.interval!==!1,r=e.timezone==="utc",a=this._floor(e,t),o=(r?Os:Ss)(a.unit).offset,s=e.as||MA,l=s[0],u=s[1],c=a.start||Infinity,f=a.stop||-Infinity,d=a.step,h=t.ADD;return(e.modified()||t.modified(Gt(n)))&&(t=t.reflow(!0),h=t.SOURCE,c=Infinity,f=-Infinity),t.visit(h,function(p){var g=n(p),m,v;g==null?(p[l]=null,i&&(p[u]=null)):(p[l]=m=v=a(g),i&&(p[u]=v=o(m,d)),m<c&&(c=m),v>f&&(f=v))}),a.start=c,a.stop=f,t.modifies(i?s:l)},jA._floor=function(e,t){const n=e.timezone==="utc";let{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:x_({extent:e.extent||mr(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins});i=m0(i);const a=this.value||{},o=(n?c_:u_)(i,r);return o.unit=ve(i),o.units=i,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o};function LA(e){$.call(this,Kl(),e)}var Z8=P(LA,$);Z8.transform=function(e,t){var n=t.dataflow,i=e.field,r=this.value,a=!0;function o(s){r.set(i(s),s)}return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,function(s){r.delete(i(s))}),t.visit(t.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()};function PA(e){$.call(this,null,e)}var e9=P(PA,$);e9.transform=function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);n&&(this.value=(e.sort?t.source.slice().sort(ao(e.sort)):t.source).map(e.field))};function t9(e,t,n,i){let r=xu[e](t,n);return{init:r.init||eo,update:function(a,o){o[i]=r.next(a)}}}const xu={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){let e=xu.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{let n=t.index,i=t.data,r=t.compare;if(e<n){for(;n+1<i.length&&!r(i[n],i[n+1]);)++n;e=n}return(1+e)/i.length}}},ntile:function(e,t){t=+t,t>0||F("ntile num must be greater than zero.");let n=xu.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{let i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{let i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||F("nth_value nth must be greater than zero."),{next:n=>{let i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{let i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{let r=i.data;return i.index<=n?t:(n=n9(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function n9(e,t,n){for(let i=t.length;n<i;++n){let r=e(t[n]);if(r!=null)return n}return-1}var i9=Object.keys(xu);function zA(e){let t=this,n=G(e.ops),i=G(e.fields),r=G(e.params),a=G(e.as),o=t.outputs=[],s=t.windows=[],l={},u={},c=!0,f=[],d=[];function h(p){G(Gt(p)).forEach(g=>l[g]=1)}h(e.sort),n.forEach(function(p,g){let m=i[g],v=Ze(m),y=J_(p,v,a[g]);if(h(m),o.push(y),Q(xu,p))s.push(t9(p,i[g],r[g],y));else{if(m==null&&p!=="count"&&F("Null aggregate field specified."),p==="count"){f.push(y);return}c=!1;let b=u[v];b||(b=u[v]=[],b.field=m,d.push(b)),b.push(K_(p,y))}}),(f.length||d.length)&&(t.cell=r9(d,f,c)),t.inputs=Object.keys(l)}const BA=zA.prototype;BA.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},BA.update=function(e,t){let n=this,i=n.cell,r=n.windows,a=e.data,o=r&&r.length,s;if(i){for(s=e.p0;s<e.i0;++s)i.rem(a[s]);for(s=e.p1;s<e.i1;++s)i.add(a[s]);i.set(t)}for(s=0;s<o;++s)r[s].update(e,t)};function r9(e,t,n){e=e.map(l=>Z_(l,l.field));let i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,a=i.agg=Array(r),o=0;o<r;++o)a[o]=new e[o](i);if(i.store)var s=i.data=new ov();return i.add=function(l){if(i.num+=1,n)return;s&&s.add(l);for(let u=0;u<r;++u)a[u].add(a[u].get(l),l)},i.rem=function(l){if(i.num-=1,n)return;s&&s.rem(l);for(let u=0;u<r;++u)a[u].rem(a[u].get(l),l)},i.set=function(l){let u,c;for(s&&s.values(),u=0,c=t.length;u<c;++u)l[t[u]]=i.num;if(!n)for(u=0,c=a.length;u<c;++u)a[u].set(l)},i.init=function(){i.num=0,s&&s.reset();for(let l=0;l<r;++l)a[l].init()},i}function Nv(e){$.call(this,{},e),this._mlen=0,this._mods=[]}Nv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:i9.concat(mu)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var UA=P(Nv,$);UA.transform=function(e,t){var n=this,i=n.state,r=e.modified(),a=ao(e.sort),o,s;this.stamp=t.stamp,(!i||r)&&(i=n.state=new zA(e));var l=U0(e.groupby);function u(c){return n.group(l(c))}for(r||t.modified(i.inputs)?(n.value={},t.visit(t.SOURCE,function(c){u(c).add(c)})):(t.visit(t.REM,function(c){u(c).remove(c)}),t.visit(t.ADD,function(c){u(c).add(c)})),o=0,s=n._mlen;o<s;++o)a9(n._mods[o],i,a,e);return n._mlen=0,n._mods=[],t.reflow(r).modifies(i.outputs)},UA.group=function(e){var t=this,n=t.value[e];return n||(n=t.value[e]=mA(ee),n.stamp=-1),n.stamp<t.stamp&&(n.stamp=t.stamp,t._mods[t._mlen++]=n),n};function a9(e,t,n,i){var r=i.sort,a=r&&!i.ignorePeers,o=i.frame||[null,0],s=e.data(n),l=s.length,u=0,c=a?ud(r):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Yt(-1)};for(t.init();u<l;++u)o9(f,o,u,l),a&&s9(f,c),t.update(f,s[u])}function o9(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function s9(e,t){var n=e.i0,i=e.i1-1,r=e.compare,a=e.data,o=a.length-1;n>0&&!r(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),i<o&&!r(a[i],a[i+1])&&(e.i1=t.right(a,a[i]))}var l9=Object.freeze({__proto__:null,aggregate:mo,bin:sv,collect:lv,compare:vA,countpattern:uv,cross:fv,density:dv,dotbin:pv,expression:_A,extent:gv,facet:$d,field:AA,filter:vv,flatten:yv,fold:bv,formula:wv,generate:SA,impute:xv,joinaggregate:Ev,kde:kv,key:TA,load:CA,lookup:Av,multiextent:$A,multivalues:DA,params:Sv,pivot:Ov,prefacet:RA,project:Cv,proxy:FA,quantile:$v,relay:NA,sample:Dv,sequence:Rv,sieve:IA,subflow:mv,timeunit:Fv,tupleindex:LA,values:PA,window:Nv});const Is="top",fi="left",di="right",ra="bottom",u9="top-left",c9="top-right",f9="bottom-left",d9="bottom-right",Iv="start",Mv="middle",Vt="end",h9="x",p9="y",Rd="group",jv="axis",Lv="title",g9="frame",m9="scope",Pv="legend",qA="row-header",WA="row-footer",GA="row-title",HA="column-header",YA="column-footer",VA="column-title",v9="padding",y9="symbol",XA="fit",b9="fit-x",w9="fit-y",x9="pad",zv="none",Fd="all",Bv="each",Uv="flush",aa="column",oa="row";var JA=0;function E9(){JA=0}const Nd="p_";function qv(e){return e&&e.gradient}function KA(e,t,n){let i=e.id,r=e.gradient,a=r==="radial"?Nd:"";return i||(i=e.id="gradient_"+JA++,r==="radial"?(e.x1=Mi(e.x1,.5),e.y1=Mi(e.y1,.5),e.r1=Mi(e.r1,0),e.x2=Mi(e.x2,.5),e.y2=Mi(e.y2,.5),e.r2=Mi(e.r2,.5),a=Nd):(e.x1=Mi(e.x1,0),e.y1=Mi(e.y1,0),e.x2=Mi(e.x2,1),e.y2=Mi(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function Mi(e,t){return e??t}function QA(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,a){return n.push({offset:r,color:a}),i}}}var Wv=Math.PI,Gv=2*Wv,vo=1e-6,k9=Gv-vo;function Hv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function yo(){return new Hv()}Hv.prototype=yo.prototype={constructor:Hv,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var a=this._x1,o=this._y1,s=n-e,l=i-t,u=a-e,c=o-t,f=u*u+c*c;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>vo)if(!(Math.abs(c*s-l*u)>vo)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-a,h=i-o,p=s*s+l*l,g=d*d+h*h,m=Math.sqrt(p),v=Math.sqrt(f),y=r*Math.tan((Wv-Math.acos((p+f-g)/(2*m*v)))/2),b=y/v,E=y/m;Math.abs(b-1)>vo&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+E*s)+","+(this._y1=t+E*l)}},arc:function(e,t,n,i,r,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(i),s=n*Math.sin(i),l=e+o,u=t+s,c=1^a,f=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null?this._+="M"+l+","+u:(Math.abs(this._x1-l)>vo||Math.abs(this._y1-u)>vo)&&(this._+="L"+l+","+u),!n)return;f<0&&(f=f%Gv+Gv),f>k9?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>vo&&(this._+="A"+n+","+n+",0,"+ +(f>=Wv)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r)))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function Me(e){return function(){return e}}var ZA=Math.abs,It=Math.atan2,bo=Math.cos,_9=Math.max,Yv=Math.min,ji=Math.sin,Ms=Math.sqrt,Mt=1e-12,js=Math.PI,Id=js/2,eS=2*js;function A9(e){return e>1?0:e<-1?js:Math.acos(e)}function tS(e){return e>=1?Id:e<=-1?-Id:Math.asin(e)}function S9(e){return e.innerRadius}function O9(e){return e.outerRadius}function T9(e){return e.startAngle}function C9(e){return e.endAngle}function $9(e){return e&&e.padAngle}function D9(e,t,n,i,r,a,o,s){var l=n-e,u=i-t,c=o-r,f=s-a,d=f*l-c*u;return d*d<Mt?void 0:(d=(c*(t-a)-f*(e-r))/d,[e+d*l,t+d*u])}function Md(e,t,n,i,r,a,o){var s=e-n,l=t-i,u=(o?a:-a)/Ms(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,g=i+f,m=(d+p)/2,v=(h+g)/2,y=p-d,b=g-h,E=y*y+b*b,x=r-a,k=d*g-p*h,w=(b<0?-1:1)*Ms(_9(0,x*x*E-k*k)),A=(k*b-y*w)/E,_=(-k*y-b*w)/E,O=(k*b+y*w)/E,S=(-k*y+b*w)/E,T=A-m,D=_-v,M=O-m,C=S-v;return T*T+D*D>M*M+C*C&&(A=O,_=S),{cx:A,cy:_,x01:-c,y01:-f,x11:A*(r/x-1),y11:_*(r/x-1)}}function R9(){var e=S9,t=O9,n=Me(0),i=null,r=T9,a=C9,o=$9,s=null;function l(){var u,c,f=+e.apply(this,arguments),d=+t.apply(this,arguments),h=r.apply(this,arguments)-Id,p=a.apply(this,arguments)-Id,g=ZA(p-h),m=p>h;if(s||(s=u=yo()),d<f&&(c=d,d=f,f=c),!(d>Mt))s.moveTo(0,0);else if(g>eS-Mt)s.moveTo(d*bo(h),d*ji(h)),s.arc(0,0,d,h,p,!m),f>Mt&&(s.moveTo(f*bo(p),f*ji(p)),s.arc(0,0,f,p,h,m));else{var v=h,y=p,b=h,E=p,x=g,k=g,w=o.apply(this,arguments)/2,A=w>Mt&&(i?+i.apply(this,arguments):Ms(f*f+d*d)),_=Yv(ZA(d-f)/2,+n.apply(this,arguments)),O=_,S=_,T,D;if(A>Mt){var M=tS(A/f*ji(w)),C=tS(A/d*ji(w));(x-=M*2)>Mt?(M*=m?1:-1,b+=M,E-=M):(x=0,b=E=(h+p)/2),(k-=C*2)>Mt?(C*=m?1:-1,v+=C,y-=C):(k=0,v=y=(h+p)/2)}var N=d*bo(v),W=d*ji(v),X=f*bo(E),J=f*ji(E);if(_>Mt){var xe=d*bo(y),Le=d*ji(y),ft=f*bo(b),dt=f*ji(b),Je;if(g<js&&(Je=D9(N,W,ft,dt,xe,Le,X,J))){var Dt=N-Je[0],li=W-Je[1],Ya=xe-Je[0],Vr=Le-Je[1],H=1/ji(A9((Dt*Ya+li*Vr)/(Ms(Dt*Dt+li*li)*Ms(Ya*Ya+Vr*Vr)))/2),ue=Ms(Je[0]*Je[0]+Je[1]*Je[1]);O=Yv(_,(f-ue)/(H-1)),S=Yv(_,(d-ue)/(H+1))}}k>Mt?S>Mt?(T=Md(ft,dt,N,W,d,S,m),D=Md(xe,Le,X,J,d,S,m),s.moveTo(T.cx+T.x01,T.cy+T.y01),S<_?s.arc(T.cx,T.cy,S,It(T.y01,T.x01),It(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,S,It(T.y01,T.x01),It(T.y11,T.x11),!m),s.arc(0,0,d,It(T.cy+T.y11,T.cx+T.x11),It(D.cy+D.y11,D.cx+D.x11),!m),s.arc(D.cx,D.cy,S,It(D.y11,D.x11),It(D.y01,D.x01),!m))):(s.moveTo(N,W),s.arc(0,0,d,v,y,!m)):s.moveTo(N,W),!(f>Mt)||!(x>Mt)?s.lineTo(X,J):O>Mt?(T=Md(X,J,xe,Le,f,-O,m),D=Md(N,W,ft,dt,f,-O,m),s.lineTo(T.cx+T.x01,T.cy+T.y01),O<_?s.arc(T.cx,T.cy,O,It(T.y01,T.x01),It(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,O,It(T.y01,T.x01),It(T.y11,T.x11),!m),s.arc(0,0,f,It(T.cy+T.y11,T.cx+T.x11),It(D.cy+D.y11,D.cx+D.x11),m),s.arc(D.cx,D.cy,O,It(D.y11,D.x11),It(D.y01,D.x01),!m))):s.arc(0,0,f,E,b,m)}if(s.closePath(),u)return s=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-js/2;return[bo(c)*u,ji(c)*u]},l.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:Me(+u),l):e},l.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:Me(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:Me(+u),l):n},l.padRadius=function(u){return arguments.length?(i=u==null?null:typeof u=="function"?u:Me(+u),l):i},l.startAngle=function(u){return arguments.length?(r=typeof u=="function"?u:Me(+u),l):r},l.endAngle=function(u){return arguments.length?(a=typeof u=="function"?u:Me(+u),l):a},l.padAngle=function(u){return arguments.length?(o=typeof u=="function"?u:Me(+u),l):o},l.context=function(u){return arguments.length?(s=u??null,l):s},l}function nS(e){this._context=e}nS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Vv(e){return new nS(e)}function iS(e){return e[0]}function rS(e){return e[1]}function aS(){var e=iS,t=rS,n=Me(!0),i=null,r=Vv,a=null;function o(s){var l,u=s.length,c,f=!1,d;for(i==null&&(a=r(d=yo())),l=0;l<=u;++l)!(l<u&&n(c=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(c,l,s),+t(c,l,s));if(d)return a=null,d+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:Me(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:Me(+s),o):t},o.defined=function(s){return arguments.length?(n=typeof s=="function"?s:Me(!!s),o):n},o.curve=function(s){return arguments.length?(r=s,i!=null&&(a=r(i)),o):r},o.context=function(s){return arguments.length?(s==null?i=a=null:a=r(i=s),o):i},o}function oS(){var e=iS,t=null,n=Me(0),i=rS,r=Me(!0),a=null,o=Vv,s=null;function l(c){var f,d,h,p=c.length,g,m=!1,v,y=new Array(p),b=new Array(p);for(a==null&&(s=o(v=yo())),f=0;f<=p;++f){if(!(f<p&&r(g=c[f],f,c))===m)if(m=!m)d=f,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=f-1;h>=d;--h)s.point(y[h],b[h]);s.lineEnd(),s.areaEnd()}m&&(y[f]=+e(g,f,c),b[f]=+n(g,f,c),s.point(t?+t(g,f,c):y[f],i?+i(g,f,c):b[f]))}if(v)return s=null,v+""||null}function u(){return aS().defined(r).curve(o).context(a)}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:Me(+c),t=null,l):e},l.x0=function(c){return arguments.length?(e=typeof c=="function"?c:Me(+c),l):e},l.x1=function(c){return arguments.length?(t=c==null?null:typeof c=="function"?c:Me(+c),l):t},l.y=function(c){return arguments.length?(n=typeof c=="function"?c:Me(+c),i=null,l):n},l.y0=function(c){return arguments.length?(n=typeof c=="function"?c:Me(+c),l):n},l.y1=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:Me(+c),l):i},l.lineX0=l.lineY0=function(){return u().x(e).y(n)},l.lineY1=function(){return u().x(e).y(i)},l.lineX1=function(){return u().x(t).y(n)},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:Me(!!c),l):r},l.curve=function(c){return arguments.length?(o=c,a!=null&&(s=o(a)),l):o},l.context=function(c){return arguments.length?(c==null?a=s=null:s=o(a=c),l):a},l}var F9={draw:function(e,t){var n=Math.sqrt(t/js);e.moveTo(n,0),e.arc(0,0,n,0,eS)}};function N9(){var e=Me(F9),t=Me(64),n=null;function i(){var r;if(n||(n=r=yo()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(e=typeof r=="function"?r:Me(r),i):e},i.size=function(r){return arguments.length?(t=typeof r=="function"?r:Me(+r),i):t},i.context=function(r){return arguments.length?(n=r??null,i):n},i}function sa(){}function jd(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Ld(e){this._context=e}Ld.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:jd(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:jd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function I9(e){return new Ld(e)}function sS(e){this._context=e}sS.prototype={areaStart:sa,areaEnd:sa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:jd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function M9(e){return new sS(e)}function lS(e){this._context=e}lS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:jd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function j9(e){return new lS(e)}function uS(e,t){this._basis=new Ld(e),this._beta=t}uS.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],a=e[n]-i,o=t[n]-r,s=-1,l;++s<=n;)l=s/n,this._basis.point(this._beta*e[s]+(1-this._beta)*(i+l*a),this._beta*t[s]+(1-this._beta)*(r+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var L9=function e(t){function n(i){return t===1?new Ld(i):new uS(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Pd(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Xv(e,t){this._context=e,this._k=(1-t)/6}Xv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Pd(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Pd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var P9=function e(t){function n(i){return new Xv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Jv(e,t){this._context=e,this._k=(1-t)/6}Jv.prototype={areaStart:sa,areaEnd:sa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Pd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var z9=function e(t){function n(i){return new Jv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Kv(e,t){this._context=e,this._k=(1-t)/6}Kv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Pd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var B9=function e(t){function n(i){return new Kv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Qv(e,t,n){var i=e._x1,r=e._y1,a=e._x2,o=e._y2;if(e._l01_a>Mt){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>Mt){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,a,o,e._x2,e._y2)}function cS(e,t){this._context=e,this._alpha=t}cS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Qv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var U9=function e(t){function n(i){return t?new cS(i,t):new Xv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function fS(e,t){this._context=e,this._alpha=t}fS.prototype={areaStart:sa,areaEnd:sa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Qv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var q9=function e(t){function n(i){return t?new fS(i,t):new Jv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function dS(e,t){this._context=e,this._alpha=t}dS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Qv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var W9=function e(t){function n(i){return t?new dS(i,t):new Kv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function hS(e){this._context=e}hS.prototype={areaStart:sa,areaEnd:sa,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function G9(e){return new hS(e)}function pS(e){return e<0?-1:1}function gS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,a=(e._y1-e._y0)/(i||r<0&&-0),o=(n-e._y1)/(r||i<0&&-0),s=(a*r+o*i)/(i+r);return(pS(a)+pS(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function mS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Zv(e,t,n){var i=e._x0,r=e._y0,a=e._x1,o=e._y1,s=(a-i)/3;e._context.bezierCurveTo(i+s,r+s*t,a-s,o-s*n,a,o)}function zd(e){this._context=e}zd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Zv(this,this._t0,mS(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Zv(this,mS(this,n=gS(this,e,t)),n);break;default:Zv(this,this._t0,n=gS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}};function vS(e){this._context=new yS(e)}(vS.prototype=Object.create(zd.prototype)).point=function(e,t){zd.prototype.point.call(this,t,e)};function yS(e){this._context=e}yS.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,a){this._context.bezierCurveTo(t,e,i,n,a,r)}};function H9(e){return new zd(e)}function Y9(e){return new vS(e)}function bS(e){this._context=e}bS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=wS(e),r=wS(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(i[0][a],r[0][a],i[1][a],r[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function wS(e){var t,n=e.length-1,i,r=new Array(n),a=new Array(n),o=new Array(n);for(r[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/a[t-1],a[t]-=i,o[t]-=i*o[t-1];for(r[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)r[t]=(o[t]-r[t+1])/a[t];for(a[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-r[t+1];return[r,a]}function V9(e){return new bS(e)}function Bd(e,t){this._context=e,this._t=t}Bd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function X9(e){return new Bd(e,.5)}function J9(e){return new Bd(e,0)}function K9(e){return new Bd(e,1)}var xS={basis:{curve:I9},"basis-closed":{curve:M9},"basis-open":{curve:j9},bundle:{curve:L9,tension:"beta",value:.85},cardinal:{curve:P9,tension:"tension",value:0},"cardinal-open":{curve:B9,tension:"tension",value:0},"cardinal-closed":{curve:z9,tension:"tension",value:0},"catmull-rom":{curve:U9,tension:"alpha",value:.5},"catmull-rom-closed":{curve:q9,tension:"alpha",value:.5},"catmull-rom-open":{curve:W9,tension:"alpha",value:.5},linear:{curve:Vv},"linear-closed":{curve:G9},monotone:{horizontal:Y9,vertical:H9},natural:{curve:V9},step:{curve:X9},"step-after":{curve:K9},"step-before":{curve:J9}};function ey(e,t,n){var i=Q(xS,e)&&xS[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}var Q9={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Ud=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function Ls(e){var t=[],n,i,r,a,o,s,l,u,c,f,d;for(n=e.slice().replace(Ud[0],"###$1").split(Ud[1]).slice(1),u=0,f=n.length;u<f;++u){for(i=n[u],r=i.slice(1).trim().replace(Ud[2],"$1###$2").split(Ud[3]),s=i.charAt(0),a=[s],c=0,d=r.length;c<d;++c)(o=+r[c])===o&&a.push(o);if(l=Q9[s.toLowerCase()],a.length-1>l)for(c=1,d=a.length;c<d;c+=l)t.push([s].concat(a.slice(c,c+l)));else t.push(a)}return t}const br=Math.PI/180,Z9=1e-14,wo=Math.PI/2,Li=Math.PI*2,Ps=Math.sqrt(3)/2;var ty={},ny={},ES=[].join;function e7(e,t,n,i,r,a,o,s,l){var u=ES.call(arguments);if(ty[u])return ty[u];var c=o*br,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);var h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5,g=h*h/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var m=d/n,v=f/n,y=-f/i,b=d/i,E=m*s+v*l,x=y*s+b*l,k=m*e+v*t,w=y*e+b*t,A=(k-E)*(k-E)+(w-x)*(w-x),_=1/A-.25;_<0&&(_=0);var O=Math.sqrt(_);a==r&&(O=-O);var S=.5*(E+k)-O*(w-x),T=.5*(x+w)+O*(k-E),D=Math.atan2(x-T,E-S),M=Math.atan2(w-T,k-S),C=M-D;C<0&&a===1?C+=Li:C>0&&a===0&&(C-=Li);for(var N=Math.ceil(Math.abs(C/(wo+.001))),W=[],X=0;X<N;++X){var J=D+X*C/N,xe=D+(X+1)*C/N;W[X]=[S,T,J,xe,n,i,f,d]}return ty[u]=W}function t7(e){var t=ES.call(e);if(ny[t])return ny[t];var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(r),g=Math.sin(r),m=Math.cos(a),v=Math.sin(a),y=.5*(a-r),b=Math.sin(y*.5),E=8/3*b*b/Math.sin(y),x=n+p-E*g,k=i+g+E*p,w=n+m,A=i+v,_=w+E*v,O=A-E*m;return ny[t]=[c*x+f*k,d*x+h*k,c*_+f*O,d*_+h*O,c*w+f*A,d*w+h*A]}var Gn=["l",0,0,0,0,0,0,0];function n7(e,t,n){var i=Gn[0]=e[0];if(i==="a"||i==="A")Gn[1]=t*e[1],Gn[2]=n*e[2],Gn[3]=e[3],Gn[4]=e[4],Gn[5]=e[5],Gn[6]=t*e[6],Gn[7]=n*e[7];else if(i==="h"||i==="H")Gn[1]=t*e[1];else if(i==="v"||i==="V")Gn[1]=n*e[1];else for(var r=1,a=e.length;r<a;++r)Gn[r]=(r%2==1?t:n)*e[r];return Gn}function Eu(e,t,n,i,r,a){var o,s=null,l=0,u=0,c=0,f=0,d,h,p,g;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),a==null&&(a=r),e.beginPath&&e.beginPath();for(var m=0,v=t.length;m<v;++m){o=t[m],(r!==1||a!==1)&&(o=n7(o,r,a));switch(o[0]){case"l":l+=o[1],u+=o[2],e.lineTo(l+n,u+i);break;case"L":l=o[1],u=o[2],e.lineTo(l+n,u+i);break;case"h":l+=o[1],e.lineTo(l+n,u+i);break;case"H":l=o[1],e.lineTo(l+n,u+i);break;case"v":u+=o[1],e.lineTo(l+n,u+i);break;case"V":u=o[1],e.lineTo(l+n,u+i);break;case"m":l+=o[1],u+=o[2],e.moveTo(l+n,u+i);break;case"M":l=o[1],u=o[2],e.moveTo(l+n,u+i);break;case"c":d=l+o[5],h=u+o[6],c=l+o[3],f=u+o[4],e.bezierCurveTo(l+o[1]+n,u+o[2]+i,c+n,f+i,d+n,h+i),l=d,u=h;break;case"C":l=o[5],u=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+i,c+n,f+i,l+n,u+i);break;case"s":d=l+o[3],h=u+o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,l+o[1]+n,u+o[2]+i,d+n,h+i),c=l+o[1],f=u+o[2],l=d,u=h;break;case"S":d=o[3],h=o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"q":d=l+o[3],h=u+o[4],c=l+o[1],f=u+o[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"Q":d=o[3],h=o[4],e.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"t":d=l+o[1],h=u+o[2],s[0].match(/[QqTt]/)===null?(c=l,f=u):s[0]==="t"?(c=2*l-p,f=2*u-g):s[0]==="q"&&(c=2*l-c,f=2*u-f),p=c,g=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h,c=l+o[1],f=u+o[2];break;case"T":d=o[1],h=o[2],c=2*l-c,f=2*u-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"a":kS(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+l+n,o[7]+u+i]),l+=o[6],u+=o[7];break;case"A":kS(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),l=o[6],u=o[7];break;case"z":case"Z":e.closePath();break}s=o}}function kS(e,t,n,i){for(var r=e7(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n),a=0;a<r.length;++a){var o=t7(r[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var _S=.5773502691896257,AS={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Li)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,a=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-a),e.lineTo(r,-a),e.lineTo(0,-n),e.lineTo(-r,-a),e.lineTo(-i,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ps*n,r=i-n*_S,a=n/4;e.moveTo(0,-i-r),e.lineTo(-a,i-r),e.lineTo(a,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ps*n,r=i-n*_S;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ps*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ps*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ps*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ps*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function SS(e){return Q(AS,e)?AS[e]:i7(e)}var iy={};function i7(e){if(!Q(iy,e)){var t=Ls(e);iy[e]={draw:function(n,i){Eu(n,t,0,0,Math.sqrt(i)/2)}}}return iy[e]}const la=.448084975506;function r7(e){return e.x}function a7(e){return e.y}function o7(e){return e.width}function s7(e){return e.height}function wr(e){return typeof e=="function"?e:()=>+e}function qd(e,t,n){return Math.max(t,Math.min(e,n))}function OS(){var e=r7,t=a7,n=o7,i=s7,r=wr(0),a=r,o=r,s=r,l=null;function u(c,f,d){var h,p=f??+e.call(this,c),g=d??+t.call(this,c),m=+n.call(this,c),v=+i.call(this,c),y=Math.min(m,v)/2,b=qd(+r.call(this,c),0,y),E=qd(+a.call(this,c),0,y),x=qd(+o.call(this,c),0,y),k=qd(+s.call(this,c),0,y);if(l||(l=h=yo()),b<=0&&E<=0&&x<=0&&k<=0)l.rect(p,g,m,v);else{var w=p+m,A=g+v;l.moveTo(p+b,g),l.lineTo(w-E,g),l.bezierCurveTo(w-la*E,g,w,g+la*E,w,g+E),l.lineTo(w,A-k),l.bezierCurveTo(w,A-la*k,w-la*k,A,w-k,A),l.lineTo(p+x,A),l.bezierCurveTo(p+la*x,A,p,A-la*x,p,A-x),l.lineTo(p,g+b),l.bezierCurveTo(p,g+la*b,p+la*b,g,p+b,g),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(c){return arguments.length?(e=wr(c),u):e},u.y=function(c){return arguments.length?(t=wr(c),u):t},u.width=function(c){return arguments.length?(n=wr(c),u):n},u.height=function(c){return arguments.length?(i=wr(c),u):i},u.cornerRadius=function(c,f,d,h){return arguments.length?(r=wr(c),a=f!=null?wr(f):r,s=d!=null?wr(d):r,o=h!=null?wr(h):a,u):r},u.context=function(c){return arguments.length?(l=c??null,u):l},u}function TS(){var e,t,n,i,r=null,a,o,s,l;function u(f,d,h){var p=h/2;if(a){var g=s-d,m=f-o;if(g||m){var v=Math.sqrt(g*g+m*m),y=(g/=v)*l,b=(m/=v)*l,E=Math.atan2(m,g);r.moveTo(o-y,s-b),r.lineTo(f-g*p,d-m*p),r.arc(f,d,p,E-Math.PI,E),r.lineTo(o+y,s+b),r.arc(o,s,l,E,E+Math.PI)}else r.arc(f,d,p,0,Li);r.closePath()}else a=1;o=f,s=d,l=p}function c(f){var d,h=f.length,p,g=!1,m;for(r==null&&(r=m=yo()),d=0;d<=h;++d)!(d<h&&i(p=f[d],d,f))===g&&((g=!g)&&(a=0)),g&&u(+e(p,d,f),+t(p,d,f),+n(p,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function ku(e,t){return e??t}const _u=e=>e.x||0,Au=e=>e.y||0,l7=e=>e.width||0,u7=e=>e.height||0,c7=e=>(e.x||0)+(e.width||0),f7=e=>(e.y||0)+(e.height||0),d7=e=>e.startAngle||0,h7=e=>e.endAngle||0,p7=e=>e.padAngle||0,g7=e=>e.innerRadius||0,m7=e=>e.outerRadius||0,v7=e=>e.cornerRadius||0,y7=e=>ku(e.cornerRadiusTopLeft,e.cornerRadius)||0,b7=e=>ku(e.cornerRadiusTopRight,e.cornerRadius)||0,w7=e=>ku(e.cornerRadiusBottomRight,e.cornerRadius)||0,x7=e=>ku(e.cornerRadiusBottomLeft,e.cornerRadius)||0,E7=e=>ku(e.size,64),k7=e=>e.size||1,Wd=e=>!(e.defined===!1),_7=e=>SS(e.shape||"circle"),A7=R9().startAngle(d7).endAngle(h7).padAngle(p7).innerRadius(g7).outerRadius(m7).cornerRadius(v7),S7=oS().x(_u).y1(Au).y0(f7).defined(Wd),O7=oS().y(Au).x1(_u).x0(c7).defined(Wd),T7=aS().x(_u).y(Au).defined(Wd),C7=OS().x(_u).y(Au).width(l7).height(u7).cornerRadius(y7,b7,w7,x7),$7=N9().type(_7).size(E7),D7=TS().x(_u).y(Au).defined(Wd).size(k7);function ry(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function R7(e,t){return A7.context(e)(t)}function F7(e,t){var n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?O7:S7).curve(ey(i,n.orient,n.tension)).context(e)(t)}function N7(e,t){var n=t[0],i=n.interpolate||"linear";return T7.curve(ey(i,n.orient,n.tension)).context(e)(t)}function zs(e,t,n,i){return C7.context(e)(t,n,i)}function I7(e,t){return(t.mark.shape||t.shape).context(e)(t)}function M7(e,t){return $7.context(e)(t)}function j7(e,t){return D7.context(e)(t)}var CS=1;function $S(){CS=1}function ay(e,t,n){var i=t.clip,r=e._defs,a=t.clip_id||(t.clip_id="clip"+CS++),o=r.clipping[a]||(r.clipping[a]={id:a});return ge(i)?o.path=i(null):ry(n)?o.path=zs(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function ot(e){this.clear(),e&&this.union(e)}var nt=ot.prototype;nt.clone=function(){return new ot(this)},nt.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},nt.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},nt.equals=function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},nt.set=function(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},nt.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},nt.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},nt.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},nt.scale=function(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},nt.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},nt.rotate=function(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},nt.rotatedPoints=function(e,t,n){var{x1:i,y1:r,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*i-l*r+u,l*i+s*r+c,s*i-l*o+u,l*i+s*o+c,s*a-l*r+u,l*a+s*r+c,s*a-l*o+u,l*a+s*o+c]},nt.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},nt.intersect=function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},nt.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1)&&this.y2>=e.y2},nt.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},nt.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},nt.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},nt.width=function(){return this.x2-this.x1},nt.height=function(){return this.y2-this.y1};function Gd(e){this.mark=e,this.bounds=this.bounds||new ot()}function Hd(e){Gd.call(this,e),this.items=this.items||[]}P(Hd,Gd);function Su(e,t){if(typeof document!="undefined"&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}function L7(){return typeof Image!="undefined"?Image:null}function oy(e){this._pending=0,this._loader=e||Ed()}var Yd=oy.prototype;Yd.pending=function(){return this._pending};function DS(e){e._pending+=1}function Ou(e){e._pending-=1}Yd.sanitizeURL=function(e){var t=this;return DS(t),t._loader.sanitize(e,{context:"href"}).then(function(n){return Ou(t),n}).catch(function(){return Ou(t),null})},Yd.loadImage=function(e){const t=this,n=L7();return DS(t),t._loader.sanitize(e,{context:"image"}).then(function(i){const r=i.href;if(!r||!n)throw{url:r};const a=new n(),o=Q(i,"crossOrigin")?i.crossOrigin:"anonymous";return o!=null&&(a.crossOrigin=o),a.onload=()=>Ou(t),a.onerror=()=>Ou(t),a.src=r,a}).catch(function(i){return Ou(t),{complete:!1,width:0,height:0,src:i&&i.url||""}})},Yd.ready=function(){var e=this;return new Promise(function(t){function n(i){e.pending()?setTimeout(function(){n(!0)},10):t(i)}n(!1)})};function xr(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?P7(t,i):0))}return e}function P7(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}var Vd,Xd,Jd,z7=Li-1e-8;function pn(e){return Vd=e,pn}function RS(){}function xo(e,t){Vd.add(e,t)}function Tu(e,t){xo(Xd=e,Jd=t)}function FS(e){xo(e,Vd.y1)}function NS(e){xo(Vd.x1,e)}pn.beginPath=RS,pn.closePath=RS,pn.moveTo=Tu,pn.lineTo=Tu,pn.rect=function(e,t,n,i){xo(e+n,t+i),Tu(e,t)},pn.quadraticCurveTo=function(e,t,n,i){IS(Xd,e,n,FS),IS(Jd,t,i,NS),Tu(n,i)};function IS(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}pn.bezierCurveTo=function(e,t,n,i,r,a){MS(Xd,e,n,r,FS),MS(Jd,t,i,a,NS),Tu(r,a)};function MS(e,t,n,i,r){const a=i-e+3*t-3*n,o=e+n-2*t,s=e-t;let l=0,u=0,c;Math.abs(a)>Z9?(c=o*o+s*a,c>=0&&(c=Math.sqrt(c),l=(-o+c)/a,u=(-o-c)/a)):l=.5*s/o,0<l&&l<1&&r(jS(l,e,t,n,i)),0<u&&u<1&&r(jS(u,e,t,n,i))}function jS(e,t,n,i,r){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*i+s*e*r}pn.arc=function(e,t,n,i,r,a){if(Xd=n*Math.cos(r)+e,Jd=n*Math.sin(r)+t,Math.abs(r-i)>z7)xo(e-n,t-n),xo(e+n,t+n);else{const o=u=>xo(n*Math.cos(u)+e,n*Math.sin(u)+t);let s,l;if(o(i),o(r),r!==i)if(i=i%Li,i<0&&(i+=Li),r=r%Li,r<0&&(r+=Li),r<i&&(a=!a,s=i,i=r,r=s),a)for(r-=Li,s=i-i%wo,l=0;l<4&&s>r;++l,s-=wo)o(s);else for(s=i-i%wo+wo,l=0;l<4&&s<r;++l,s=s+wo)o(s)}};var ua=(ua=Su(1,1))?ua.getContext("2d"):null;const sy=new ot();function ly(e){return function(t,n){if(!ua)return!0;e(ua,t),sy.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:a,y2:o}=sy;for(let s=r;s<=o;++s)for(let l=i;l<=a;++l)if(ua.isPointInPath(l,s))return!0;return!1}}function uy(e,t){return t.contains(e.x||0,e.y||0)}function LS(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,a=e.height||0;return t.intersects(sy.set(n,i,n+r,i+a))}function PS(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:i;return Bs(t,n,i,r,a)}function Bs(e,t,n,i,r){const{x1:a,y1:o,x2:s,y2:l}=e,u=i-t,c=r-n;let f=0,d=1,h,p,g,m;for(m=0;m<4;++m){if(m===0&&(h=-u,p=-(a-t)),m===1&&(h=u,p=s-t),m===2&&(h=-c,p=-(o-n)),m===3&&(h=c,p=l-n),Math.abs(h)<1e-10&&p<0)return!1;if(g=p/h,h<0){if(g>d)return!1;g>f&&(f=g)}else if(h>0){if(g<f)return!1;g<d&&(d=g)}}return!0}function Us(e,t){e.globalCompositeOperation=t.blend||"source-over"}function hi(e,t){return e??t}function zS(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function B7(e,t,n){const i=n.width(),r=n.height();let a;if(t.gradient==="radial")a=e.createRadialGradient(n.x1+hi(t.x1,.5)*i,n.y1+hi(t.y1,.5)*r,Math.max(i,r)*hi(t.r1,0),n.x1+hi(t.x2,.5)*i,n.y1+hi(t.y2,.5)*r,Math.max(i,r)*hi(t.r2,.5));else{const o=hi(t.x1,0),s=hi(t.y1,0),l=hi(t.x2,1),u=hi(t.y2,0);if(o===l||s===u||i===r)a=e.createLinearGradient(n.x1+o*i,n.y1+s*r,n.x1+l*i,n.y1+u*r);else{const c=Su(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=zS(f.createLinearGradient(o,s,l,u),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return zS(a,t.stops)}function BS(e,t,n){return qv(n)?B7(e,n,t.bounds):n}function Kd(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=BS(e,t,t.fill),!0):!1}var U7=[];function qs(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=BS(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||U7),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function q7(e,t){return e.zindex-t.zindex||e.index-t.index}function cy(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,a;for(r=0,a=t.length;r<a;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(q7)}function pi(e,t){var n=e.items,i,r;if(!n||!n.length)return;var a=cy(e);if(a&&a.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=a}for(i=0,r=n.length;i<r;++i)t(n[i])}function Qd(e,t){var n=e.items,i,r;if(!n||!n.length)return null;var a=cy(e);for(a&&a.length&&(n=a),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===a){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function fy(e){return function(t,n,i){pi(n,function(r){(!i||i.intersects(r.bounds))&&US(e,t,r,r)})}}function W7(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&US(e,t,n.items[0],n.items)}}function US(e,t,n,i){var r=n.opacity==null?1:n.opacity;if(r===0)return;if(e(t,i))return;Us(t,n),n.fill&&Kd(t,n,r)&&t.fill(),n.stroke&&qs(t,n,r)&&t.stroke()}function Zd(e){return e=e||Fi,function(t,n,i,r,a,o){return i*=t.pixelRatio,r*=t.pixelRatio,Qd(n,function(s){var l=s.bounds;if(l&&!l.contains(a,o)||!l)return;if(e(t,s,i,r,a,o))return s})}}function eh(e,t){return function(n,i,r,a){var o=Array.isArray(i)?i[0]:i,s=t??o.fill,l=o.stroke&&n.isPointInStroke,u,c;return l&&(u=o.strokeWidth,c=o.strokeCap,n.lineWidth=u??1,n.lineCap=c??"butt"),e(n,i)?!1:s&&n.isPointInPath(r,a)||l&&n.isPointInStroke(r,a)}}function dy(e){return Zd(eh(e))}function Ws(e,t){return"translate("+e+","+t+")"}function qS(e){return"rotate("+e+")"}function G7(e,t){return"scale("+e+","+t+")"}function WS(e){return Ws(e.x||0,e.y||0)}function GS(e){return Ws(e.x||0,e.y||0)+(e.angle?" "+qS(e.angle):"")+(e.scaleX||e.scaleY?" "+G7(e.scaleX||1,e.scaleY||1):"")}function hy(e,t,n){function i(o,s){o("transform",GS(s)),o("d",t(null,s))}function r(o,s){var l=s.x||0,u=s.y||0;return t(pn(o),s),xr(o,s).translate(l,u),s.angle&&o.rotate(s.angle*br,l,u),o}function a(o,s){var l=s.x||0,u=s.y||0,c=s.angle||0;o.translate(l,u),c&&o.rotate(c*=br),o.beginPath(),t(o,s),c&&o.rotate(-c),o.translate(-l,-u)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:fy(a),pick:dy(a),isect:n||ly(a)}}var H7=hy("arc",R7);function Y7(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,a=Infinity,o,s;--r>=0;){if(e[r].defined===!1)continue;s=Math.abs(e[r][i]-n),s<a&&(a=s,o=e[r])}return o}function V7(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,a,o;--i>=0;){if(e[i].defined===!1)continue;if(r=e[i].x-t[0],a=e[i].y-t[1],o=r*r+a*a,o<n)return e[i]}return null}function X7(e,t){for(var n=e.length,i,r,a;--n>=0;){if(e[n].defined===!1)continue;if(i=e[n].x-t[0],r=e[n].y-t[1],a=i*i+r*r,i=e[n].size||1,a<i*i)return e[n]}return null}function py(e,t,n){function i(l,u){var c=u.mark.items;c.length&&l("d",t(null,c))}function r(l,u){var c=u.items;return c.length===0?l:(t(pn(l),c),xr(l,c[0]))}function a(l,u){l.beginPath(),t(l,u)}var o=eh(a);function s(l,u,c,f,d,h){var p=u.items,g=u.bounds;return!p||!p.length||g&&!g.contains(d,h)?null:(c*=l.pixelRatio,f*=l.pixelRatio,o(l,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:W7(a),pick:s,isect:uy,tip:n}}var J7=py("area",F7,Y7);function K7(e,t){var n=t.clip;e.save(),ge(n)?(e.beginPath(),n(e),e.clip()):HS(e,t.group)}function HS(e,t){e.beginPath(),ry(t)?zs(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function YS(e){const t=hi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Q7(e,t){e("transform",WS(t))}function VS(e,t){const n=YS(t);e("d",zs(null,t,n,n))}function Z7(e,t){e("class","background"),e("aria-hidden",!0),VS(e,t)}function eB(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?VS(e,t):e("d","")}function tB(e,t,n){const i=t.clip?ay(n,t,t):null;e("clip-path",i)}function nB(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),xr(e,t),e.translate(t.x||0,t.y||0)}function th(e,t,n,i){const r=YS(t);e.beginPath(),zs(e,t,(n||0)+r,(i||0)+r)}const XS=eh(th),iB=eh(th,!1);function rB(e,t,n){pi(t,i=>{const r=i.x||0,a=i.y||0,o=i.strokeForeground,s=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&s&&(th(e,i,r,a),Us(e,i),i.fill&&Kd(e,i,s)&&e.fill(),i.stroke&&!o&&qs(e,i,s)&&e.stroke()),e.save(),e.translate(r,a),i.clip&&HS(e,i),n&&n.translate(-r,-a),pi(i,l=>{this.draw(e,l,n)}),n&&n.translate(r,a),e.restore(),o&&i.stroke&&s&&(th(e,i,r,a),Us(e,i),qs(e,i,s)&&e.stroke())})}function aB(e,t,n,i,r,a){if(t.bounds&&!t.bounds.contains(r,a)||!t.items)return null;const o=n*e.pixelRatio,s=i*e.pixelRatio;return Qd(t,l=>{let u,c,f,d,h,p,g,m,v;return m=l.bounds,m&&!m.contains(r,a)?void 0:(d=l.x||0,h=l.y||0,p=d+(l.width||0),g=h+(l.height||0),v=l.clip,v&&(r<d||r>p||a<h||a>g)?void 0:(e.save(),e.translate(d,h),d=r-d,h=a-h,v&&ry(l)&&!XS(e,l,o,s)?(e.restore(),null):(c=l.strokeForeground,f=t.interactive!==!1,f&&c&&l.stroke&&iB(e,l,o,s)?(e.restore(),l):(u=Qd(l,y=>oB(y,d,h)?this.pick(y,n,i,d,h):null),!u&&f&&(l.fill||!c&&l.stroke)&&XS(e,l,o,s)&&(u=l),e.restore(),u||null))))})}function oB(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var sB={type:"group",tag:"g",nested:!1,attr:Q7,bound:nB,draw:rB,pick:aB,isect:LS,content:tB,background:Z7,foreground:eB},Gs={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function gy(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function my(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function vy(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function nh(e,t){return e==="center"?t/2:e==="right"?t:0}function ih(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function lB(e,t,n){const i=gy(t,n),r=my(t,i),a=vy(t,i),o=(t.x||0)-nh(t.align,r),s=(t.y||0)-ih(t.baseline,a),l=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",l,Gs["xmlns:xlink"],"xlink:href"),e("transform",Ws(o,s)),e("width",r),e("height",a),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function uB(e,t){const n=t.image,i=my(t,n),r=vy(t,n),a=(t.x||0)-nh(t.align,i),o=(t.y||0)-ih(t.baseline,r);return e.set(a,o,a+i,o+r)}function cB(e,t,n){pi(t,i=>{if(n&&!n.intersects(i.bounds))return;let r=gy(i,this),a=my(i,r),o=vy(i,r),s=(i.x||0)-nh(i.align,a),l=(i.y||0)-ih(i.baseline,o),u,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=a/c,l+=(o-d)/2,o=d):(d=o*c,s+=(a-d)/2,a=d))),(r.complete||r.toDataURL)&&(Us(e,i),e.globalAlpha=(u=i.opacity)!=null?u:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,s,l,a,o))})}var fB={type:"image",tag:"image",nested:!1,attr:lB,bound:uB,draw:cB,pick:Zd(),isect:Fi,get:gy,xOffset:nh,yOffset:ih},dB=py("line",N7,V7);function hB(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",GS(t)),e("d",t.path)}function rh(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*br,l=t.pathCache;(!l||l.path!==n)&&((t.pathCache=l=Ls(n)).path=n),s&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(s),Eu(e,l,0,0,a,o),e.rotate(-s),e.translate(-i,-r)):Eu(e,l,i,r,a,o)}function pB(e,t){return rh(pn(e),t)?e.set(0,0,0,0):xr(e,t,!0),t.angle&&e.rotate(t.angle*br,t.x||0,t.y||0),e}var gB={type:"path",tag:"path",nested:!1,attr:hB,bound:pB,draw:fy(rh),pick:dy(rh),isect:ly(rh)};function mB(e,t){e("d",zs(null,t))}function vB(e,t){var n,i;return xr(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function JS(e,t){e.beginPath(),zs(e,t)}var yB={type:"rect",tag:"path",nested:!1,attr:mB,bound:vB,draw:fy(JS),pick:dy(JS),isect:LS};function bB(e,t){e("transform",WS(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function wB(e,t){var n,i;return xr(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function KS(e,t,n){var i,r,a,o;return t.stroke&&qs(e,t,n)?(i=t.x||0,r=t.y||0,a=t.x2!=null?t.x2:i,o=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(a,o),!0):!1}function xB(e,t,n){pi(t,function(i){if(n&&!n.intersects(i.bounds))return;var r=i.opacity==null?1:i.opacity;r&&KS(e,i,r)&&(Us(e,i),e.stroke())})}function EB(e,t,n,i){return e.isPointInStroke?KS(e,t,1)&&e.isPointInStroke(n,i):!1}var kB={type:"rule",tag:"line",nested:!1,attr:bB,bound:wB,draw:xB,pick:Zd(EB),isect:PS},_B=hy("shape",I7),AB=hy("symbol",M7,uy);const QS=Vz();var Hs={height:Pi,measureWidth:by,estimateWidth:yy,width:yy,canvas:ZS};ZS(!0);function ZS(e){Hs.width=e&&ua?by:yy}function yy(e,t){return eO(fa(e,t),Pi(e))}function eO(e,t){return~~(.8*e.length*t)}function by(e,t){return Pi(e)<=0||!(t=fa(e,t))?0:tO(t,ah(e))}function tO(e,t){const n=`(${t}) ${e}`;let i=QS.get(n);return i===void 0&&(ua.font=t,i=ua.measureText(e).width,QS.set(n,i)),i}function Pi(e){return e.fontSize!=null?+e.fontSize||0:11}function ca(e){return e.lineHeight!=null?e.lineHeight:Pi(e)+2}function SB(e){return I(e)?e.length>1?e:e[0]:e}function Cu(e){return SB(e.lineBreak&&e.text&&!I(e.text)?e.text.split(e.lineBreak):e.text)}function wy(e){const t=Cu(e);return(I(t)?t.length-1:0)*ca(e)}function fa(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?TB(e,n):n}function OB(e){if(Hs.width===by){const t=ah(e);return n=>tO(n,t)}else{const t=Pi(e);return n=>eO(n,t)}}function TB(e,t){var n=+e.limit,i=OB(e);if(i(t)<n)return t;var r=e.ellipsis||"…",a=e.dir==="rtl",o=0,s=t.length,l;if(n-=i(r),a){for(;o<s;)l=o+s>>>1,i(t.slice(l))>n?o=l+1:s=l;return r+t.slice(o)}else{for(;o<s;)l=1+(o+s>>>1),i(t.slice(0,l))<n?o=l:s=l-1;return t.slice(0,o)+r}}function $u(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function ah(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Pi(e)+"px "+$u(e,t)}function xy(e){var t=e.baseline,n=Pi(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*ca(e):t==="line-bottom"?.29*n-.5*ca(e):0)}var CB={left:"start",center:"middle",right:"end"},Du=new ot();function oh(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-wo,t+=i*Math.cos(r),n+=i*Math.sin(r)),Du.x1=t,Du.y1=n,Du}function $B(e,t){var n=t.dx||0,i=(t.dy||0)+xy(t),r=oh(t),a=r.x1,o=r.y1,s=t.angle||0,l;e("text-anchor",CB[t.align]||"start"),s?(l=Ws(a,o)+" "+qS(s),(n||i)&&(l+=" "+Ws(n,i))):l=Ws(a+n,o+i),e("transform",l)}function Ey(e,t,n){var i=Hs.height(t),r=t.align,a=oh(t),o=a.x1,s=a.y1,l=t.dx||0,u=(t.dy||0)+xy(t)-Math.round(.8*i),c=Cu(t),f;if(I(c)?(i+=ca(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,Hs.width(t,h)),0)):f=Hs.width(t,c),r==="center"?l-=f/2:r==="right"&&(l-=f),e.set(l+=o,u+=s,l+f,u+i),t.angle&&!n)e.rotate(t.angle*br,o,s);else if(n===2)return e.rotatedPoints(t.angle*br,o,s);return e}function DB(e,t,n){pi(t,function(i){var r=i.opacity==null?1:i.opacity,a,o,s,l,u,c,f;if(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)return;if(e.font=ah(i),e.textAlign=i.align||"left",a=oh(i),o=a.x1,s=a.y1,i.angle&&(e.save(),e.translate(o,s),e.rotate(i.angle*br),o=s=0),o+=i.dx||0,s+=(i.dy||0)+xy(i),c=Cu(i),Us(e,i),I(c))for(u=ca(i),l=0;l<c.length;++l)f=fa(i,c[l]),i.fill&&Kd(e,i,r)&&e.fillText(f,o,s),i.stroke&&qs(e,i,r)&&e.strokeText(f,o,s),s+=u;else f=fa(i,c),i.fill&&Kd(e,i,r)&&e.fillText(f,o,s),i.stroke&&qs(e,i,r)&&e.strokeText(f,o,s);i.angle&&e.restore()})}function RB(e,t,n,i,r,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=oh(t),s=o.x1,l=o.y1,u=Ey(Du,t,1),c=-t.angle*br,f=Math.cos(c),d=Math.sin(c),h=f*r-d*a+(s-f*s+d*l),p=d*r+f*a+(l-d*s-f*l);return u.contains(h,p)}function FB(e,t){var n=Ey(Du,e,2);return Bs(t,n[0],n[1],n[2],n[3])||Bs(t,n[0],n[1],n[4],n[5])||Bs(t,n[4],n[5],n[6],n[7])||Bs(t,n[2],n[3],n[6],n[7])}var NB={type:"text",tag:"text",nested:!1,attr:$B,bound:Ey,draw:DB,pick:Zd(RB),isect:FB},IB=py("trail",j7,X7),Hn={arc:H7,area:J7,group:sB,image:fB,line:dB,path:gB,rect:yB,rule:kB,shape:_B,symbol:AB,text:NB,trail:IB};function ky(e,t,n){var i=Hn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new ot()),e,n)}var nO={mark:null};function iO(e,t,n){var i=Hn[e.marktype],r=i.bound,a=e.items,o=a&&a.length,s,l,u,c;if(i.nested)return o?u=a[0]:(nO.mark=e,u=nO),c=ky(u,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new ot(),o)for(s=0,l=a.length;s<l;++s)t.union(ky(a[s],r,n));return e.bounds=t}var MB=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function rO(e,t){return JSON.stringify(e,MB,t)}function aO(e){var t=typeof e=="string"?JSON.parse(e):e;return oO(t)}function oO(e){var t=e.marktype,n=e.items,i,r,a;if(n)for(r=0,a=n.length;r<a;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&oO(n[r]);return t&&iO(e),e}function _y(e){arguments.length?this.root=aO(e):(this.root=lO({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Hd(this.root)])}var sO=_y.prototype;sO.toJSON=function(e){return rO(this.root,e||0)},sO.mark=function(e,t,n){t=t||this.root.items[0];var i=lO(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};function lO(e,t){const n={bounds:new ot(),clip:!!e.clip,group:t,interactive:!(e.interactive===!1),items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function da(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Ay(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function Nn(e,t,n,i){var r=e.childNodes[t],a;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(a=r||null,r=da(e.ownerDocument,n,i),e.insertBefore(r,a)),r}function gi(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function uO(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function sh(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function jB(e,t,n,i){var r=e&&e.mark,a,o;if(r&&(a=Hn[r.marktype]).tip){for(o=sh(t,n),o[0]-=i[0],o[1]-=i[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=a.tip(r.items,o)}return e}function ha(e,t){this._active=null,this._handlers={},this._loader=e||Ed(),this._tooltip=t||LB}function LB(e,t,n,i){e.element().setAttribute("title",i||"")}const In=ha.prototype;In.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},In.element=function(){return this._el},In.canvas=function(){return this._el&&this._el.firstChild},In.origin=function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},In.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},In.on=function(){},In.off=function(){},In._handlerIndex=function(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},In.handlers=function(e){const t=this._handlers,n=[];if(e)n.push.apply(n,t[this.eventName(e)]);else for(const i in t)n.push.apply(n,t[i]);return n},In.eventName=function(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},In.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),a=da(null,"a");for(const o in i)a.setAttribute(o,i[o]);a.dispatchEvent(r)}).catch(function(){})},In.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=jB(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},In.getItemBoundingClientRect=function(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,a=r.width(),o=r.height();let s=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}};function mi(e){this._el=null,this._bgcolor=null,this._loader=new oy(e)}var Yn=mi.prototype;Yn.initialize=function(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},Yn.element=function(){return this._el},Yn.canvas=function(){return this._el&&this._el.firstChild},Yn.background=function(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},Yn.resize=function(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},Yn.dirty=function(){},Yn.render=function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},Yn._render=function(){},Yn.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)},Yn._load=function(e,t){var n=this,i=n._loader[e](t);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then(function(a){a&&r(),n._ready=null})}return i},Yn.sanitizeURL=function(e){return this._load("sanitizeURL",e)},Yn.loadImage=function(e){return this._load("loadImage",e)};const PB="keydown",zB="keypress",BB="keyup",cO="dragenter",lh="dragleave",fO="dragover",Sy="mousedown",UB="mouseup",uh="mousemove",Ru="mouseout",dO="mouseover",ch="click",qB="dblclick",WB="wheel",hO="mousewheel",fh="touchstart",dh="touchmove",hh="touchend",GB=[PB,zB,BB,cO,lh,fO,Sy,UB,uh,Ru,dO,ch,qB,WB,hO,fh,dh,hh],Oy=uh,Fu=Ru,Ty=ch;function Nu(e,t){ha.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const st=P(Nu,ha);st.initialize=function(e,t,n){return this._canvas=e&&Ay(e,"canvas"),[ch,Sy,uh,Ru,lh].forEach(i=>pO(this,i)),ha.prototype.initialize.call(this,e,t,n)};const HB=e=>e===fh||e===dh||e===hh?[fh,dh,hh]:[e];function pO(e,t){HB(t).forEach(n=>YB(e,n))}function YB(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}st.canvas=function(){return this._canvas},st.context=function(){return this._canvas.getContext("2d")},st.events=GB;function gO(e,t,n){return function(i){const r=this._active,a=this.pickEvent(i);a===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=a,this.fire(t,i),this.fire(e,i))}}function mO(e){return function(t){this.fire(e,t),this._active=null}}st.DOMMouseScroll=function(e){this.fire(hO,e)},st.mousemove=gO(uh,dO,Ru),st.dragover=gO(fO,cO,lh),st.mouseout=mO(Ru),st.dragleave=mO(lh),st.mousedown=function(e){this._down=this._active,this.fire(Sy,e)},st.click=function(e){this._down===this._active&&(this.fire(ch,e),this._down=null)},st.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(fh,e,!0)},st.touchmove=function(e){this.fire(dh,e,!0)},st.touchend=function(e){this.fire(hh,e,!0),this._touch=null},st.fire=function(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===Ty&&i&&i.href?this.handleHref(t,i,i.href):(e===Oy||e===Fu)&&this.handleTooltip(t,i,e!==Fu),r)for(let a=0,o=r.length;a<o;++a)r[a].handler.call(this._obj,t,i)},st.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);return r<0&&(pO(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},st.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},st.pickEvent=function(e){const t=sh(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},st.pick=function(e,t,n,i,r){const a=this.context(),o=Hn[e.marktype];return o.pick.call(this,a,e,t,n,i,r)};function VB(){return typeof window!="undefined"&&window.devicePixelRatio||1}var XB=VB();function JB(e,t,n,i,r,a){const o=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),l=o?XB:r;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];return o&&l!==1&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*i[0],l*i[1]),e}function ph(e){mi.call(this,e),this._options={},this._redraw=!1,this._dirty=new ot(),this._tempb=new ot()}const pa=P(ph,mi),vO=mi.prototype;pa.initialize=function(e,t,n,i,r,a){return this._options=a||{},this._canvas=this._options.externalContext?null:Su(1,1,this._options.type),e&&this._canvas&&(gi(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),vO.initialize.call(this,e,t,n,i,r)},pa.resize=function(e,t,n,i){if(vO.resize.call(this,e,t,n,i),this._canvas)JB(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||F("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},pa.canvas=function(){return this._canvas},pa.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},pa.dirty=function(e){let t=this._tempb.clear().union(e.bounds),n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)};function KB(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}const QB=(e,t,n)=>new ot().set(0,0,t,n).translate(-e[0],-e[1]);pa._render=function(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,a=this._dirty,o=QB(n,i,r);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):KB(t,o.intersect(a),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,s),t.restore(),a.clear(),this},pa.draw=function(e,t,n){const i=Hn[t.marktype];t.clip&&K7(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},pa.clear=function(e,t,n,i){const r=this._options,a=this.context();r.type!=="pdf"&&!r.externalContext&&a.clearRect(e,t,n,i),this._bgcolor!=null&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,i))};function Cy(e,t){ha.call(this,e,t);const n=this;n._hrefHandler=$y(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=$y(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Fu)})}const gh=P(Cy,ha);gh.initialize=function(e,t,n){let i=this._svg;return i&&(i.removeEventListener(Ty,this._hrefHandler),i.removeEventListener(Oy,this._tooltipHandler),i.removeEventListener(Fu,this._tooltipHandler)),this._svg=i=e&&Ay(e,"svg"),i&&(i.addEventListener(Ty,this._hrefHandler),i.addEventListener(Oy,this._tooltipHandler),i.addEventListener(Fu,this._tooltipHandler)),ha.prototype.initialize.call(this,e,t,n)},gh.canvas=function(){return this._svg};const $y=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};gh.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);if(r<0){const a={type:e,handler:t,listener:$y(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},gh.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this};function Dy(e,t,n){var i=e-t+n*2;return e?i>0?i:1:0}const ZB="identity",Ys="linear",Er="log",Iu="pow",Mu="sqrt",mh="symlog",Eo="time",ko="utc",zi="sequential",Vs="diverging",Xs="quantile",vh="quantize",yh="threshold",Ry="ordinal",Fy="point",yO="band",Ny="bin-ordinal",lt="continuous",ju="discrete",Lu="discretizing",Vn="interpolating",Iy="temporal";function eU(e){return function(t){var n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function tU(e){return function(t){var n=e.range(),i=t[0],r=t[1],a=-1,o,s,l,u;for(r<i&&(s=i,i=r,r=s),l=0,u=n.length;l<u;++l)n[l]>=i&&n[l]<=r&&(a<0&&(a=l),o=l);return a<0?void 0:(i=e.invertExtent(n[a]),r=e.invertExtent(n[o]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]])}}function Bi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ga(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const My=Symbol("implicit");function jy(){var e=new Map(),t=[],n=[],i=My;function r(a){var o=a+"",s=e.get(o);if(!s){if(i!==My)return i;e.set(o,s=t.push(a))}return n[(s-1)%n.length]}return r.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new Map();for(const o of a){const s=o+"";if(e.has(s))continue;e.set(s,t.push(o))}return r},r.range=function(a){return arguments.length?(n=Array.from(a),r):n.slice()},r.unknown=function(a){return arguments.length?(i=a,r):i},r.copy=function(){return jy(t,n).unknown(i)},Bi.apply(r,arguments),r}function Js(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Pu(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function ma(){}var _o=.7,Ks=1/_o,Qs="\\s*([+-]?\\d+)\\s*",zu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ui="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nU=/^#([0-9a-f]{3,8})$/,iU=new RegExp("^rgb\\("+[Qs,Qs,Qs]+"\\)$"),rU=new RegExp("^rgb\\("+[Ui,Ui,Ui]+"\\)$"),aU=new RegExp("^rgba\\("+[Qs,Qs,Qs,zu]+"\\)$"),oU=new RegExp("^rgba\\("+[Ui,Ui,Ui,zu]+"\\)$"),sU=new RegExp("^hsl\\("+[zu,Ui,Ui]+"\\)$"),lU=new RegExp("^hsla\\("+[zu,Ui,Ui,zu]+"\\)$"),bO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Js(ma,Bu,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:wO,formatHex:wO,formatHsl:uU,formatRgb:xO,toString:xO});function wO(){return this.rgb().formatHex()}function uU(){return SO(this).formatHsl()}function xO(){return this.rgb().formatRgb()}function Bu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=nU.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?EO(t):n===3?new At(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?bh(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?bh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=iU.exec(e))?new At(t[1],t[2],t[3],1):(t=rU.exec(e))?new At(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=aU.exec(e))?bh(t[1],t[2],t[3],t[4]):(t=oU.exec(e))?bh(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=sU.exec(e))?AO(t[1],t[2]/100,t[3]/100,1):(t=lU.exec(e))?AO(t[1],t[2]/100,t[3]/100,t[4]):bO.hasOwnProperty(e)?EO(bO[e]):e==="transparent"?new At(NaN,NaN,NaN,0):null}function EO(e){return new At(e>>16&255,e>>8&255,e&255,1)}function bh(e,t,n,i){return i<=0&&(e=t=n=NaN),new At(e,t,n,i)}function Ly(e){return e instanceof ma||(e=Bu(e)),e?(e=e.rgb(),new At(e.r,e.g,e.b,e.opacity)):new At()}function va(e,t,n,i){return arguments.length===1?Ly(e):new At(e,t,n,i??1)}function At(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Js(At,va,Pu(ma,{brighter:function(e){return e=e==null?Ks:Math.pow(Ks,e),new At(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?_o:Math.pow(_o,e),new At(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:kO,formatHex:kO,formatRgb:_O,toString:_O}));function kO(){return"#"+Py(this.r)+Py(this.g)+Py(this.b)}function _O(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Py(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function AO(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new qi(e,t,n,i)}function SO(e){if(e instanceof qi)return new qi(e.h,e.s,e.l,e.opacity);if(e instanceof ma||(e=Bu(e)),!e)return new qi();if(e instanceof qi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(t===a?o=(n-i)/s+(n<i)*6:n===a?o=(i-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new qi(o,s,l,e.opacity)}function wh(e,t,n,i){return arguments.length===1?SO(e):new qi(e,t,n,i??1)}function qi(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Js(qi,wh,Pu(ma,{brighter:function(e){return e=e==null?Ks:Math.pow(Ks,e),new qi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?_o:Math.pow(_o,e),new qi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new At(zy(e>=240?e-240:e+120,r,i),zy(e,r,i),zy(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function zy(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var OO=Math.PI/180,TO=180/Math.PI,xh=18,CO=.96422,$O=1,DO=.82521,RO=4/29,Zs=6/29,FO=3*Zs*Zs,cU=Zs*Zs*Zs;function NO(e){if(e instanceof Wi)return new Wi(e.l,e.a,e.b,e.opacity);if(e instanceof kr)return IO(e);e instanceof At||(e=Ly(e));var t=Wy(e.r),n=Wy(e.g),i=Wy(e.b),r=By((.2225045*t+.7168786*n+.0606169*i)/$O),a,o;return t===n&&n===i?a=o=r:(a=By((.4360747*t+.3850649*n+.1430804*i)/CO),o=By((.0139322*t+.0971045*n+.7141733*i)/DO)),new Wi(116*r-16,500*(a-r),200*(r-o),e.opacity)}function Eh(e,t,n,i){return arguments.length===1?NO(e):new Wi(e,t,n,i??1)}function Wi(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}Js(Wi,Eh,Pu(ma,{brighter:function(e){return new Wi(this.l+xh*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Wi(this.l-xh*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=CO*Uy(t),e=$O*Uy(e),n=DO*Uy(n),new At(qy(3.1338561*t-1.6168667*e-.4906146*n),qy(-.9787684*t+1.9161415*e+.033454*n),qy(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function By(e){return e>cU?Math.pow(e,1/3):e/FO+RO}function Uy(e){return e>Zs?e*e*e:FO*(e-RO)}function qy(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Wy(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function fU(e){if(e instanceof kr)return new kr(e.h,e.c,e.l,e.opacity);if(e instanceof Wi||(e=NO(e)),e.a===0&&e.b===0)return new kr(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*TO;return new kr(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function kh(e,t,n,i){return arguments.length===1?fU(e):new kr(e,t,n,i??1)}function kr(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function IO(e){if(isNaN(e.h))return new Wi(e.l,0,0,e.opacity);var t=e.h*OO;return new Wi(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Js(kr,kh,Pu(ma,{brighter:function(e){return new kr(this.h,this.c,this.l+xh*(e??1),this.opacity)},darker:function(e){return new kr(this.h,this.c,this.l-xh*(e??1),this.opacity)},rgb:function(){return IO(this).rgb()}}));var MO=-.14861,Gy=1.78277,Hy=-.29227,_h=-.90649,Uu=1.97294,jO=Uu*_h,LO=Uu*Gy,PO=Gy*Hy-_h*MO;function dU(e){if(e instanceof Ao)return new Ao(e.h,e.s,e.l,e.opacity);e instanceof At||(e=Ly(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(PO*i+jO*t-LO*n)/(PO+jO-LO),a=i-r,o=(Uu*(n-r)-Hy*a)/_h,s=Math.sqrt(o*o+a*a)/(Uu*r*(1-r)),l=s?Math.atan2(o,a)*TO-120:NaN;return new Ao(l<0?l+360:l,s,r,e.opacity)}function Yy(e,t,n,i){return arguments.length===1?dU(e):new Ao(e,t,n,i??1)}function Ao(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Js(Ao,Yy,Pu(ma,{brighter:function(e){return e=e==null?Ks:Math.pow(Ks,e),new Ao(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?_o:Math.pow(_o,e),new Ao(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*OO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new At(255*(t+n*(MO*i+Gy*r)),255*(t+n*(Hy*i+_h*r)),255*(t+n*(Uu*i)),this.opacity)}}));function zO(e,t,n,i,r){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*i+o*r)/6}function BO(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1],o=i>0?e[i-1]:2*r-a,s=i<t-1?e[i+2]:2*a-r;return zO((n-i/t)*t,o,r,a,s)}}function UO(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],a=e[i%t],o=e[(i+1)%t],s=e[(i+2)%t];return zO((n-i/t)*t,r,a,o,s)}}function Ah(e){return function(){return e}}function qO(e,t){return function(n){return e+n*t}}function hU(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Sh(e,t){var n=t-e;return n?qO(e,n>180||n<-180?n-360*Math.round(n/360):n):Ah(isNaN(e)?t:e)}function pU(e){return(e=+e)===1?gt:function(t,n){return n-t?hU(t,n,e):Ah(isNaN(t)?n:t)}}function gt(e,t){var n=t-e;return n?qO(e,n):Ah(isNaN(e)?t:e)}var Vy=function e(t){var n=pU(t);function i(r,a){var o=n((r=va(r)).r,(a=va(a)).r),s=n(r.g,a.g),l=n(r.b,a.b),u=gt(r.opacity,a.opacity);return function(c){return r.r=o(c),r.g=s(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=e,i}(1);function WO(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o)s=va(t[o]),i[o]=s.r||0,r[o]=s.g||0,a[o]=s.b||0;return i=e(i),r=e(r),a=e(a),s.opacity=1,function(l){return s.r=i(l),s.g=r(l),s.b=a(l),s+""}}}var gU=WO(BO),mU=WO(UO);function Xy(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function GO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function vU(e,t){return(GO(t)?Xy:HO)(e,t)}function HO(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),a=new Array(n),o;for(o=0;o<i;++o)r[o]=So(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=r[o](s);return a}}function YO(e,t){var n=new Date();return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function vi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function VO(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=So(e[r],t[r]):i[r]=t[r];return function(a){for(r in n)i[r]=n[r](a);return i}}var Jy=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ky=new RegExp(Jy.source,"g");function yU(e){return function(){return e}}function bU(e){return function(t){return e(t)+""}}function XO(e,t){var n=Jy.lastIndex=Ky.lastIndex=0,i,r,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(i=Jy.exec(e))&&(r=Ky.exec(t));)(a=r.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:vi(i,r)})),n=Ky.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?bU(l[0].x):yU(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function So(e,t){var n=typeof t,i;return t==null||n==="boolean"?Ah(t):(n==="number"?vi:n==="string"?(i=Bu(t))?(t=i,Vy):XO:t instanceof Bu?Vy:t instanceof Date?YO:GO(t)?Xy:Array.isArray(t)?HO:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?VO:vi)(e,t)}function wU(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function xU(e,t){var n=Sh(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function qu(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var JO=180/Math.PI,Qy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function KO(e,t,n,i,r,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*JO,skewX:Math.atan(l)*JO,scaleX:o,scaleY:s}}var Wu,Zy,QO,Oh;function EU(e){return e==="none"?Qy:(Wu||(Wu=document.createElement("DIV"),Zy=document.documentElement,QO=document.defaultView),Wu.style.transform=e,e=QO.getComputedStyle(Zy.appendChild(Wu),null).getPropertyValue("transform"),Zy.removeChild(Wu),e=e.slice(7,-1).split(","),KO(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function kU(e){return e==null?Qy:(Oh||(Oh=document.createElementNS("http://www.w3.org/2000/svg","g")),Oh.setAttribute("transform",e),(e=Oh.transform.baseVal.consolidate())?(e=e.matrix,KO(e.a,e.b,e.c,e.d,e.e,e.f)):Qy)}function ZO(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function a(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push("translate(",null,t,null,n);p.push({i:g-4,x:vi(u,f)},{i:g-2,x:vi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function o(u,c,f,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:vi(u,c)})):c&&f.push(r(f)+"rotate("+c+i)}function s(u,c,f,d){u!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:vi(u,c)}):c&&f.push(r(f)+"skewX("+c+i)}function l(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push(r(h)+"scale(",null,",",null,")");p.push({i:g-4,x:vi(u,f)},{i:g-2,x:vi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(u,c){var f=[],d=[];return u=e(u),c=e(c),a(u.translateX,u.translateY,c.translateX,c.translateY,f,d),o(u.rotate,c.rotate,f,d),s(u.skewX,c.skewX,f,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,d),u=c=null,function(h){for(var p=-1,g=d.length,m;++p<g;)f[(m=d[p]).i]=m.x(h);return f.join("")}}}var _U=ZO(EU,"px, ","px)","deg)"),AU=ZO(kU,", ",")",")"),Gu=Math.SQRT2,eb=2,eT=4,SU=1e-12;function tT(e){return((e=Math.exp(e))+1/e)/2}function OU(e){return((e=Math.exp(e))-1/e)/2}function TU(e){return((e=Math.exp(2*e))-1)/(e+1)}function CU(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],o=t[1],s=t[2],l=a-n,u=o-i,c=l*l+u*u,f,d;if(c<SU)d=Math.log(s/r)/Gu,f=function(y){return[n+y*l,i+y*u,r*Math.exp(Gu*y*d)]};else{var h=Math.sqrt(c),p=(s*s-r*r+eT*c)/(2*r*eb*h),g=(s*s-r*r-eT*c)/(2*s*eb*h),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);d=(v-m)/Gu,f=function(y){var b=y*d,E=tT(m),x=r/(eb*h)*(E*TU(Gu*b+m)-OU(m));return[n+x*l,i+x*u,r*E/tT(Gu*b+m)]}}return f.duration=d*1e3,f}function nT(e){return function(t,n){var i=e((t=wh(t)).h,(n=wh(n)).h),r=gt(t.s,n.s),a=gt(t.l,n.l),o=gt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.s=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var $U=nT(Sh),DU=nT(gt);function RU(e,t){var n=gt((e=Eh(e)).l,(t=Eh(t)).l),i=gt(e.a,t.a),r=gt(e.b,t.b),a=gt(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=i(o),e.b=r(o),e.opacity=a(o),e+""}}function iT(e){return function(t,n){var i=e((t=kh(t)).h,(n=kh(n)).h),r=gt(t.c,n.c),a=gt(t.l,n.l),o=gt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.c=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var FU=iT(Sh),NU=iT(gt);function rT(e){return function t(n){n=+n;function i(r,a){var o=e((r=Yy(r)).h,(a=Yy(a)).h),s=gt(r.s,a.s),l=gt(r.l,a.l),u=gt(r.opacity,a.opacity);return function(c){return r.h=o(c),r.s=s(c),r.l=l(Math.pow(c,n)),r.opacity=u(c),r+""}}return i.gamma=t,i}(1)}var IU=rT(Sh),MU=rT(gt);function tb(e,t){for(var n=0,i=t.length-1,r=t[0],a=new Array(i<0?0:i);n<i;)a[n]=e(r,r=t[++n]);return function(o){var s=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return a[s](o-s)}}function jU(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}var LU=Object.freeze({__proto__:null,interpolate:So,interpolateArray:vU,interpolateBasis:BO,interpolateBasisClosed:UO,interpolateDate:YO,interpolateDiscrete:wU,interpolateHue:xU,interpolateNumber:vi,interpolateNumberArray:Xy,interpolateObject:VO,interpolateRound:qu,interpolateString:XO,interpolateTransformCss:_U,interpolateTransformSvg:AU,interpolateZoom:CU,interpolateRgb:Vy,interpolateRgbBasis:gU,interpolateRgbBasisClosed:mU,interpolateHsl:$U,interpolateHslLong:DU,interpolateLab:RU,interpolateHcl:FU,interpolateHclLong:NU,interpolateCubehelix:IU,interpolateCubehelixLong:MU,piecewise:tb,quantize:jU});function PU(e){return function(){return e}}function nb(e){return+e}var aT=[0,1];function gn(e){return e}function ib(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:PU(isNaN(t)?NaN:.5)}function zU(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function BU(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];return r<i?(i=ib(r,i),a=n(o,a)):(i=ib(i,r),a=n(a,o)),function(s){return a(i(s))}}function UU(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=ib(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(s){var l=Qr(e,s,1,i)-1;return a[l](r[l](s))}}function Hu(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Th(){var e=aT,t=aT,n=So,i,r,a,o=gn,s,l,u;function c(){var d=Math.min(e.length,t.length);return o!==gn&&(o=zU(e[0],e[d-1])),s=d>2?UU:BU,l=u=null,f}function f(d){return isNaN(d=+d)?a:(l||(l=s(e.map(i),t,n)))(i(o(d)))}return f.invert=function(d){return o(r((u||(u=s(t,e.map(i),vi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,nb),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=qu,c()},f.clamp=function(d){return arguments.length?(o=d?!0:gn,c()):o!==gn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(a=d,f):a},function(d,h){return i=d,r=h,c()}}function oT(){return Th()(gn,gn)}function sT(e,t,n,i){var r=Zr(e,t,n),a;i=ks(i??",f");switch(i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(a=Wk(r,o))&&(i.precision=a),d0(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=Gk(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=qk(r))&&(i.precision=a-(i.type==="%")*2);break}}return pd(i)}function Oo(e){var t=e.domain;return e.ticks=function(n){var i=t();return u0(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return sT(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,a=i.length-1,o=i[r],s=i[a],l;return s<o&&(l=o,o=s,s=l,l=r,r=a,a=l),l=cd(o,s,n),l>0?(o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l,l=cd(o,s,n)):l<0&&(o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l,l=cd(o,s,n)),l>0?(i[r]=Math.floor(o/l)*l,i[a]=Math.ceil(s/l)*l,t(i)):l<0&&(i[r]=Math.ceil(o*l)/l,i[a]=Math.floor(s*l)/l,t(i)),e},e}function lT(){var e=oT();return e.copy=function(){return Hu(e,lT())},Bi.apply(e,arguments),Oo(e)}function uT(e){var t;function n(i){return isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,nb),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return uT(e).unknown(t)},e=arguments.length?Array.from(e,nb):[0,1],Oo(n)}function cT(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],a=e[i],o;return a<r&&(o=n,n=i,i=o,o=r,r=a,a=o),e[n]=t.floor(r),e[i]=t.ceil(a),e}function fT(e){return Math.log(e)}function dT(e){return Math.exp(e)}function qU(e){return-Math.log(-e)}function WU(e){return-Math.exp(-e)}function GU(e){return isFinite(e)?+("1e"+e):e<0?0:e}function HU(e){return e===10?GU:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function YU(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function hT(e){return function(t){return-e(-t)}}function rb(e){var t=e(fT,dT),n=t.domain,i=10,r,a;function o(){return r=YU(i),a=HU(i),n()[0]<0?(r=hT(r),a=hT(a),e(qU,WU)):e(fT,dT),t}return t.base=function(s){return arguments.length?(i=+s,o()):i},t.domain=function(s){return arguments.length?(n(s),o()):n()},t.ticks=function(s){var l=n(),u=l[0],c=l[l.length-1],f;(f=c<u)&&(d=u,u=c,c=d);var d=r(u),h=r(c),p,g,m,v=s==null?10:+s,y=[];if(!(i%1)&&h-d<v){if(d=Math.floor(d),h=Math.ceil(h),u>0)for(;d<=h;++d)for(g=1,p=a(d);g<i;++g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}else for(;d<=h;++d)for(g=i-1,p=a(d);g>=1;--g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}y.length*2<v&&(y=u0(u,c,v))}else y=u0(d,h,Math.min(h-d,v)).map(a);return f?y.reverse():y},t.tickFormat=function(s,l){if(l==null&&(l=i===10?".0e":","),typeof l!="function"&&(l=pd(l)),s===Infinity)return l;s==null&&(s=10);var u=Math.max(1,i*s/t.ticks().length);return function(c){var f=c/a(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=u?l(c):""}},t.nice=function(){return n(cT(n(),{floor:function(s){return a(Math.floor(r(s)))},ceil:function(s){return a(Math.ceil(r(s)))}}))},t}function pT(){var e=rb(Th()).domain([1,10]);return e.copy=function(){return Hu(e,pT()).base(e.base())},Bi.apply(e,arguments),e}function gT(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function mT(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ab(e){var t=1,n=e(gT(t),mT(t));return n.constant=function(i){return arguments.length?e(gT(t=+i),mT(t)):t},Oo(n)}function vT(){var e=ab(Th());return e.copy=function(){return Hu(e,vT()).constant(e.constant())},Bi.apply(e,arguments)}function yT(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function VU(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function XU(e){return e<0?-e*e:e*e}function ob(e){var t=e(gn,gn),n=1;function i(){return n===1?e(gn,gn):n===.5?e(VU,XU):e(yT(n),yT(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},Oo(t)}function sb(){var e=ob(Th());return e.copy=function(){return Hu(e,sb()).exponent(e.exponent())},Bi.apply(e,arguments),e}function JU(){return sb.apply(null,arguments).exponent(.5)}function bT(){var e=[],t=[],n=[],i;function r(){var o=0,s=Math.max(1,t.length);for(n=new Array(s-1);++o<s;)n[o-1]=fd(e,o/s);return a}function a(o){return isNaN(o=+o)?i:t[Qr(n,o)]}return a.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(xs),r()},a.range=function(o){return arguments.length?(t=Array.from(o),r()):t.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.quantiles=function(){return n.slice()},a.copy=function(){return bT().domain(e).range(t).unknown(i)},Bi.apply(a,arguments)}function wT(){var e=0,t=1,n=1,i=[.5],r=[0,1],a;function o(l){return l<=l?r[Qr(i,l,0,n)]:a}function s(){var l=-1;for(i=new Array(n);++l<n;)i[l]=((l+1)*t-(l-n)*e)/(n+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(n=(r=Array.from(l)).length-1,s()):r.slice()},o.invertExtent=function(l){var u=r.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,i[0]]:u>=n?[i[n-1],t]:[i[u-1],i[u]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return i.slice()},o.copy=function(){return wT().domain([e,t]).range(r).unknown(a)},Bi.apply(Oo(o),arguments)}function xT(){var e=[.5],t=[0,1],n,i=1;function r(a){return a<=a?t[Qr(e,a,0,i)]:n}return r.domain=function(a){return arguments.length?(e=Array.from(a),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(a){return arguments.length?(t=Array.from(a),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},r.unknown=function(a){return arguments.length?(n=a,r):n},r.copy=function(){return xT().domain(e).range(t).unknown(n)},Bi.apply(r,arguments)}var Yu=1e3,Vu=Yu*60,Xu=Vu*60,Ju=Xu*24,KU=Ju*7,ET=Ju*30,lb=Ju*365;function QU(e){return new Date(e)}function ZU(e){return e instanceof Date?+e:+new Date(+e)}function ub(e,t,n,i,r,a,o,s,l){var u=oT(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),g=l("%I %p"),m=l("%a %d"),v=l("%b %d"),y=l("%B"),b=l("%Y"),E=[[o,1,Yu],[o,5,5*Yu],[o,15,15*Yu],[o,30,30*Yu],[a,1,Vu],[a,5,5*Vu],[a,15,15*Vu],[a,30,30*Vu],[r,1,Xu],[r,3,3*Xu],[r,6,6*Xu],[r,12,12*Xu],[i,1,Ju],[i,2,2*Ju],[n,1,KU],[t,1,ET],[t,3,3*ET],[e,1,lb]];function x(w){return(o(w)<w?d:a(w)<w?h:r(w)<w?p:i(w)<w?g:t(w)<w?n(w)<w?m:v:e(w)<w?y:b)(w)}function k(w,A,_){if(w==null&&(w=10),typeof w=="number"){var O=Math.abs(_-A)/w,S=ud(function(D){return D[2]}).right(E,O),T;return S===E.length?(T=Zr(A/lb,_/lb,w),w=e):S?(S=E[O/E[S-1][2]<E[S][2]/O?S-1:S],T=S[1],w=S[0]):(T=Math.max(Zr(A,_,w),1),w=s),w.every(T)}return w}return u.invert=function(w){return new Date(c(w))},u.domain=function(w){return arguments.length?f(Array.from(w,ZU)):f().map(QU)},u.ticks=function(w){var A=f(),_=A[0],O=A[A.length-1],S=O<_,T;return S&&(T=_,_=O,O=T),T=k(w,_,O),T=T?T.range(_,O+1):[],S?T.reverse():T},u.tickFormat=function(w,A){return A==null?x:l(A)},u.nice=function(w){var A=f();return(w=k(w,A[0],A[A.length-1]))?f(cT(A,w)):u},u.copy=function(){return Hu(u,ub(e,t,n,i,r,a,o,s,l))},u}function eq(){return Bi.apply(ub(ea,x0,bd,co,Zk,Qk,yd,_s,F0).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function tq(){return Bi.apply(ub(ta,_0,wd,ho,t_,e_,yd,_s,N0).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Ch(){var e=0,t=1,n,i,r,a,o=gn,s=!1,l;function u(f){return isNaN(f=+f)?l:o(r===0?.5:(f=(a(f)-n)*r,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,n=a(e=+e),i=a(t=+t),r=n===i?0:1/(i-n),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function c(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),u):[o(0),o(1)]}}return u.range=c(So),u.rangeRound=c(qu),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return a=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),u}}function ya(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function cb(){var e=Oo(Ch()(gn));return e.copy=function(){return ya(e,cb())},ga.apply(e,arguments)}function kT(){var e=rb(Ch()).domain([1,10]);return e.copy=function(){return ya(e,kT()).base(e.base())},ga.apply(e,arguments)}function _T(){var e=ab(Ch());return e.copy=function(){return ya(e,_T()).constant(e.constant())},ga.apply(e,arguments)}function fb(){var e=ob(Ch());return e.copy=function(){return ya(e,fb()).exponent(e.exponent())},ga.apply(e,arguments)}function nq(){return fb.apply(null,arguments).exponent(.5)}function $h(){var e=0,t=.5,n=1,i=1,r,a,o,s,l,u=gn,c,f=!1,d;function h(g){return isNaN(g=+g)?d:(g=.5+((g=+c(g))-a)*(i*g<i*a?s:l),u(f?Math.max(0,Math.min(1,g)):g))}h.domain=function(g){return arguments.length?([e,t,n]=g,r=c(e=+e),a=c(t=+t),o=c(n=+n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h):[e,t,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(u=g,h):u};function p(g){return function(m){var v,y,b;return arguments.length?([v,y,b]=m,u=tb(g,[v,y,b]),h):[u(0),u(.5),u(1)]}}return h.range=p(So),h.rangeRound=p(qu),h.unknown=function(g){return arguments.length?(d=g,h):d},function(g){return c=g,r=g(e),a=g(t),o=g(n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h}}function AT(){var e=Oo($h()(gn));return e.copy=function(){return ya(e,AT())},ga.apply(e,arguments)}function ST(){var e=rb($h()).domain([.1,1,10]);return e.copy=function(){return ya(e,ST()).base(e.base())},ga.apply(e,arguments)}function OT(){var e=ab($h());return e.copy=function(){return ya(e,OT()).constant(e.constant())},ga.apply(e,arguments)}function db(){var e=ob($h());return e.copy=function(){return ya(e,db()).exponent(e.exponent())},ga.apply(e,arguments)}function iq(){return db.apply(null,arguments).exponent(.5)}function hb(){var e=jy().unknown(void 0),t=e.domain,n=e.range,i=[0,1],r,a,o=!1,s=0,l=0,u=.5;delete e.unknown;function c(){var f=t().length,d=i[1]<i[0],h=i[d-0],p=i[1-d],g=Dy(f,s,l);r=(p-h)/(g||1),o&&(r=Math.floor(r)),h+=(p-h-r*(f-s))*u,a=r*(1-s),o&&(h=Math.round(h),a=Math.round(a));var m=so(f).map(function(v){return h+r*v});return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return r},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),s=l,c()):s},e.paddingInner=function(f){return arguments.length?(s=Math.max(0,Math.min(1,f)),c()):s},e.paddingOuter=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;var d=+f[0],h=+f[1],p=i[1]<i[0],g=p?n().reverse():n(),m=g.length-1,v,y,b;return d!==d||h!==h?void 0:(h<d&&(b=d,d=h,h=b),h<g[0]||d>i[1-p]?void 0:(v=Math.max(0,Qr(g,d)-1),y=d===h?v:Qr(g,h)-1,d-g[v]>a+1e-10&&++v,p&&(b=v,v=m-y,y=m-b),v>y?void 0:t().slice(v,y+1)))},e.invert=function(f){var d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return hb().domain(t()).range(i).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function TT(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return TT(t())},e}function rq(){return TT(hb().paddingInner(1))}var aq=Array.prototype.map;function oq(e){return aq.call(e,function(t){return+t})}var sq=Array.prototype.slice;function CT(){var e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(Qr(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=oq(i),n):e.slice()},n.range=function(i){return arguments.length?(t=sq.call(i),n):t.slice()},n.tickFormat=function(i,r){return sT(e[0],ve(e),i??10,r)},n.copy=function(){return CT().domain(n.domain()).range(n.range())},n}const Dh={};function lq(e,t,n){const i=function(){var a=t();return a.invertRange||(a.invertRange=a.invert?eU(a):a.invertExtent?tU(a):void 0),a.type=e,a};return i.metadata=Et(G(n)),i}function Ee(e,t,n){return arguments.length>1?(Dh[e]=lq(e,t,n),this):$T(e)?Dh[e]:void 0}Ee(ZB,uT),Ee(Ys,lT,lt),Ee(Er,pT,[lt,Er]),Ee(Iu,sb,lt),Ee(Mu,JU,lt),Ee(mh,vT,lt),Ee(Eo,eq,[lt,Iy]),Ee(ko,tq,[lt,Iy]),Ee(zi,cb,[lt,Vn]),Ee(`${zi}-${Ys}`,cb,[lt,Vn]),Ee(`${zi}-${Er}`,kT,[lt,Vn,Er]),Ee(`${zi}-${Iu}`,fb,[lt,Vn]),Ee(`${zi}-${Mu}`,nq,[lt,Vn]),Ee(`${zi}-${mh}`,_T,[lt,Vn]),Ee(`${Vs}-${Ys}`,AT,[lt,Vn]),Ee(`${Vs}-${Er}`,ST,[lt,Vn,Er]),Ee(`${Vs}-${Iu}`,db,[lt,Vn]),Ee(`${Vs}-${Mu}`,iq,[lt,Vn]),Ee(`${Vs}-${mh}`,OT,[lt,Vn]),Ee(Xs,bT,[Lu,Xs]),Ee(vh,wT,Lu),Ee(yh,xT,Lu),Ee(Ny,CT,[ju,Lu]),Ee(Ry,jy,ju),Ee(yO,hb,ju),Ee(Fy,rq,ju);function $T(e){return Q(Dh,e)}function To(e,t){const n=Dh[e];return n&&n.metadata[t]}function pb(e){return To(e,lt)}function el(e){return To(e,ju)}function gb(e){return To(e,Lu)}function DT(e){return To(e,Er)}function uq(e){return To(e,Iy)}function RT(e){return To(e,Vn)}function FT(e){return To(e,Xs)}const cq=["clamp","base","constant","exponent"];function NT(e,t){var n=t[0],i=ve(t)-n;return function(r){return e(n+r*i)}}function Rh(e,t,n){return tb(mb(t||"rgb",n),e)}function IT(e,t){for(var n=new Array(t),i=t+1,r=0;r<t;)n[r]=e(++r/i);return n}function MT(e,t,n){var i=n-t,r,a,o;return!i||!Number.isFinite(i)?Yt(.5):(r=(a=e.type).indexOf("-"),a=r<0?a:a.slice(r+1),o=Ee(a)().domain([t,n]).range([0,1]),cq.forEach(s=>e[s]?o[s](e[s]()):0),o)}function mb(e,t){var n=LU[fq(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function fq(e){return"interpolate"+e.toLowerCase().split("-").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("")}const dq={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},hq={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function jT(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function LT(e,t){for(let n in e)vb(n,t(e[n]))}const PT={};LT(hq,jT),LT(dq,e=>Rh(jT(e)));function vb(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(PT[e]=t,this):PT[e]}var Fh="symbol",pq="discrete",gq="gradient";const mq=e=>I(e)?e.map(t=>String(t)):String(e),vq=(e,t)=>e[1]-t[1],yq=(e,t)=>t[1]-e[1];function yb(e,t,n){var i;return De(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(ed(e.domain())/n||1)))),K(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===Eo?Ss(t):e.type==ko?Os(t):F("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function zT(e,t,n){let i=e.range(),r=i[0],a=ve(i),o=vq;if(r>a&&(i=a,a=r,r=i,o=yq),r=Math.floor(r),a=Math.ceil(a),t=t.map(s=>[s,e(s)]).filter(s=>r<=s[1]&&s[1]<=a).sort(o).map(s=>s[0]),n>0&&t.length>1){const s=[t[0],ve(t)];for(;t.length>n&&t.length>=3;)t=t.filter((l,u)=>!(u%2));t.length<3&&(t=s)}return t}function bb(e,t){return e.bins?zT(e,e.bins):e.ticks?e.ticks(t):e.domain()}function BT(e,t,n,i,r,a){var o=t.type;let s=mq;if(o===Eo||r===Eo)s=e.timeFormat(i);else if(o===ko||r===ko)s=e.utcFormat(i);else if(DT(o)){const l=e.formatFloat(i);if(a||t.bins)s=l;else{const u=UT(t,n,!1);s=c=>u(c)?l(c):""}}else if(t.tickFormat){const l=t.domain();s=e.formatSpan(l[0],l[l.length-1],n,i)}else i&&(s=e.format(i));return s}function UT(e,t,n){const i=bb(e,t),r=e.base(),a=Math.log(r),o=Math.max(1,r*t/i.length),s=l=>{let u=l/Math.pow(r,Math.round(Math.log(l)/a));return u*r<r-.5&&(u*=r),u<=o};return n?i.filter(s):s}const wb={[Xs]:"quantiles",[vh]:"thresholds",[yh]:"domain"},qT={[Xs]:"quantiles",[vh]:"domain"};function WT(e,t){return e.bins?xq(e.bins):e.type===Er?UT(e,t,!0):wb[e.type]?wq(e[wb[e.type]]()):bb(e,t)}function bq(e,t,n){var i=t[qT[t.type]](),r=i.length,a=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)a=Math.min(a,i[o]-i[o-1]);return e.formatSpan(0,a,3*10,n)}function wq(e){const t=[-Infinity].concat(e);return t.max=Infinity,t}function xq(e){const t=e.slice(0,-1);return t.max=ve(e),t}function Eq(e){return wb[e.type]||e.bins}function GT(e,t,n,i,r,a,o){const s=qT[t.type]&&a!==Eo&&a!==ko?bq(e,t,r):BT(e,t,n,r,a,o);return i===Fh&&Eq(t)?kq(s):i===pq?_q(s):Aq(s)}function kq(e){return(t,n,i)=>{var r=HT(i[n+1],HT(i.max,Infinity)),a=YT(t,e),o=YT(r,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a}}function HT(e,t){return e??t}function _q(e){return(t,n)=>n?e(t):null}function Aq(e){return t=>e(t)}function YT(e,t){return Number.isFinite(e)?t(e):null}function Sq(e){var t=e.domain(),n=t.length-1,i=+t[0],r=+ve(t),a=r-i;if(e.type===yh){const o=n?a/n:.1;i-=o,r+=o,a=r-i}return o=>(o-i)/a}function Oq(e,t,n,i){const r=i||t.type;return Y(n)&&uq(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===Eo?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===ko?e.utcFormat("%A, %d %B %Y, %X UTC"):GT(e,t,5,null,n,i,!0)}function VT(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=Oq(e,t,n.format,n.formatType);if(gb(t.type)){const a=WT(t).slice(1).map(r),o=a.length;return`${o} boundar${o===1?"y":"ies"}: ${a.join(", ")}`}else if(el(t.type)){const a=t.domain(),o=a.length,s=o>i?a.slice(0,i-2).map(r).join(", ")+", ending with "+a.slice(-1).map(r):a.map(r).join(", ");return`${o} value${o===1?"":"s"}: ${s}`}else{const a=t.domain();return`values from ${r(a[0])} to ${r(ve(a))}`}}const XT="aria-hidden",xb="aria-label",Eb="role",kb="aria-roledescription",JT="graphics-object",_b="graphics-symbol",KT=(e,t,n)=>({[Eb]:e,[kb]:t,[xb]:n||void 0}),Tq=Et(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),QT={axis:{desc:"axis",caption:Dq},legend:{desc:"legend",caption:Rq},"title-text":{desc:"title",caption:e=>`Title text '${nC(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${nC(e)}'`}},ZT={ariaRole:Eb,ariaRoleDescription:kb,description:xb};function eC(e,t){const n=t.aria===!1;if(e(XT,n||void 0),n||t.description==null)for(const i in ZT)e(ZT[i],void 0);else{const i=t.mark.marktype;e(xb,t.description),e(Eb,t.ariaRole||(i==="group"?JT:_b)),e(kb,t.ariaRoleDescription||`${i} mark`)}}function tC(e){return e.aria===!1?{[XT]:!0}:Tq[e.role]?null:QT[e.role]?$q(e,QT[e.role]):Cq(e)}function Cq(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return KT(n?JT:_b,`${t} mark container`,e.description)}function $q(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return KT(t.role||_b,t.desc,n.description||i(n))}catch(n){return null}}function nC(e){return G(e.text).join(" ")}function Dq(e){const t=e.datum,n=e.orient,i=t.title?iC(e):null,r=e.context,a=r.scales[t.scale].value,o=r.dataflow.locale(),s=a.type,l=n==="left"||n==="right"?"Y":"X";return`${l}-axis`+(i?` titled '${i}'`:"")+` for a ${el(s)?"discrete":s} scale with ${VT(o,a,e)}`}function Rq(e){const t=e.datum,n=t.title?iC(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,a=Object.keys(r),o=e.context,s=o.scales[r[a[0]]].value,l=o.dataflow.locale();return Nq(i)+(n?` titled '${n}'`:"")+` for ${Fq(a)} with ${VT(l,s,e)}`}function iC(e){try{return G(ve(e.items).items[0].text).join(" ")}catch(t){return null}}function Fq(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ve(e)}function Nq(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const Iq=e=>(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function qe(e,t,n){var i="<"+e,r,a;if(t)for(r in t)a=t[r],a!=null&&(i+=" "+r+'="'+Iq(a)+'"');return n&&(i+=" "+n),i+">"}function He(e){return"</"+e+">"}const Nh={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ab={fill:"none","stroke-miterlimit":10},Ih=0,St=Gs.xmlns;function Sb(e){mi.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var mn=P(Sb,mi),Ob=mi.prototype;mn.initialize=function(e,t,n,i){if(this._defs={gradient:{},clipping:{}},e){this._svg=Nn(e,0,"svg",St),this._svg.setAttribute("class","marks"),gi(e,1),this._root=Nn(this._svg,Ih,"g",St);for(const r in Ab)this._root.setAttribute(r,Ab[r]);gi(this._svg,Ih+1)}return this.background(this._bgcolor),Ob.initialize.call(this,e,t,n,i)},mn.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Ob.background.apply(this,arguments)},mn.resize=function(e,t,n,i){return Ob.resize.call(this,e,t,n,i),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},mn.canvas=function(){return this._svg},mn.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in Gs)e[t]=Gs[t];var n=this._bgcolor?qe("rect",{width:this._width,height:this._height,fill:this._bgcolor})+He("rect"):"";return qe("svg",e)+(this._defs.el?this._defs.el.outerHTML:"")+n+this._root.outerHTML+He("svg")},mn._render=function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e),gi(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},mn.updateDefs=function(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=Nn(e,Ih,"defs",St)),i=Mq(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=Nn(e,Ih,"defs",St)),i=jq(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):gi(n,i))};function Mq(e,t,n){var i,r,a;if(t.gradient==="radial"){var o=Nn(e,n++,"pattern",St);o.setAttribute("id",Nd+t.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),o=Nn(o,0,"rect",St),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+oC()+"#"+t.id+")"),e=Nn(e,n++,"radialGradient",St),e.setAttribute("id",t.id),e.setAttribute("fx",t.x1),e.setAttribute("fy",t.y1),e.setAttribute("fr",t.r1),e.setAttribute("cx",t.x2),e.setAttribute("cy",t.y2),e.setAttribute("r",t.r2)}else e=Nn(e,n++,"linearGradient",St),e.setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2);for(i=0,r=t.stops.length;i<r;++i)a=Nn(e,i,"stop",St),a.setAttribute("offset",t.stops[i].offset),a.setAttribute("stop-color",t.stops[i].color);return gi(e,i),n}function jq(e,t,n){var i;return e=Nn(e,n,"clipPath",St),e.setAttribute("id",t.id),t.path?(i=Nn(e,0,"path",St),i.setAttribute("d",t.path)):(i=Nn(e,0,"rect",St),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",t.width),i.setAttribute("height",t.height)),gi(e,1),n+1}mn._resetDefs=function(){var e=this._defs;e.gradient={},e.clipping={}},mn.dirty=function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},mn.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},mn._dirtyCheck=function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length||!this._dirtyID)return!0;var t=++this._dirtyID,n,i,r,a,o,s,l;for(o=0,s=e.length;o<s;++o){if(n=e[o],i=n.mark,i.marktype!==r&&(r=i.marktype,a=Hn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,rC(n,t),i.items.forEach(function(u){u.dirty=t})),i.zdirty)continue;if(n.exit){a.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null;continue}if(n=a.nested?i.items[0]:n,n._update===t)continue;!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,rC(n,t)):this._update(a,n._svg,n),n._update=t}return!this._dirtyAll};function rC(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}mn.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var i=this._svg,r=Hn[t.marktype],a=t.interactive===!1?"none":null,o=r.tag==="g",s=null,l=0,u;u=aC(t,e,n,"g",i),u.setAttribute("class",uO(t));const c=tC(t);for(const d in c)vn(u,d,c[d]);o||vn(u,"pointer-events",a),vn(u,"clip-path",t.clip?ay(this,t,t.group):null);const f=d=>{const h=this.isDirty(d),p=aC(d,u,s,r.tag,i);h&&(this._update(r,p,d),o&&Lq(this,p,d)),s=p,++l};return r.nested?t.items.length&&f(t.items[0]):pi(t,f),gi(u,l),u};function Lq(e,t,n){t=t.lastChild.previousSibling;let i,r=0;pi(n,a=>{i=e.draw(t,a,i),++r}),gi(t,1+r)}function aC(e,t,n,i,r){let a=e._svg,o;if(!a&&(o=t.ownerDocument,a=da(o,i,St),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},i==="g"))){const s=da(o,"path",St);a.appendChild(s),s.__data__=e;const l=da(o,"g",St);a.appendChild(l),l.__data__=e;const u=da(o,"path",St);a.appendChild(u),u.__data__=e,u.__values__={fill:"default"}}return(a.ownerSVGElement!==r||Pq(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}function Pq(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}var _r=null,jt=null,zq={group:function(e,t,n){const i=_r=t.childNodes[2];jt=i.__values__,e.foreground(Ku,n,this),jt=t.__values__,_r=t.childNodes[1],e.content(Ku,n,this);const r=_r=t.childNodes[0];e.background(Ku,n,this);const a=n.mark.interactive===!1?"none":null;if(a!==jt.events&&(vn(i,"pointer-events",a),vn(r,"pointer-events",a),jt.events=a),n.strokeForeground&&n.stroke){const o=n.fill;vn(i,"display",null),this.style(r,n),vn(r,"stroke",null),o&&(n.fill=null),jt=i.__values__,this.style(i,n),o&&(n.fill=o),_r=null}else vn(i,"display","none")},image:function(e,t,n){n.smooth===!1?(Tb(t,"image-rendering","optimizeSpeed"),Tb(t,"image-rendering","pixelated")):Tb(t,"image-rendering",null)},text:function(e,t,n){let i=Cu(n),r,a,o,s;I(i)?(a=i.map(l=>fa(n,l)),r=a.join(`
`),r!==jt.text&&(gi(t,0),o=t.ownerDocument,s=ca(n),a.forEach((l,u)=>{const c=da(o,"tspan",St);c.__data__=n,c.textContent=l,u&&(c.setAttribute("x",0),c.setAttribute("dy",s)),t.appendChild(c)}),jt.text=r)):(a=fa(n,i),a!==jt.text&&(t.textContent=a,jt.text=a)),vn(t,"font-family",$u(n)),vn(t,"font-size",Pi(n)+"px"),vn(t,"font-style",n.fontStyle),vn(t,"font-variant",n.fontVariant),vn(t,"font-weight",n.fontWeight)}};function Tb(e,t,n){n!==jt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),jt[t]=n)}mn._update=function(e,t,n){_r=t,jt=t.__values__,eC(Ku,n),e.attr(Ku,n,this);const i=zq[e.type];i&&i.call(this,e,t,n),_r&&this.style(_r,n)};function Ku(e,t,n){if(t===jt[e])return;n?Bq(_r,e,t,n):vn(_r,e,t),jt[e]=t}function vn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function Bq(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}mn.style=function(e,t){if(t==null)return;for(const n in Nh){let i=n==="font"?$u(t):t[n];if(i===jt[n])continue;const r=Nh[n];i==null?e.removeAttribute(r):(qv(i)&&(i=KA(i,this._defs.gradient,oC())),e.setAttribute(r,i+"")),jt[n]=i}};function oC(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Cb(e){mi.call(this,e),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}var Ar=P(Cb,mi),sC=mi.prototype;Ar.resize=function(e,t,n,i){sC.resize.call(this,e,t,n,i);var r=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var s in Gs)o[s]=Gs[s];a.head=qe("svg",o);var l=this._bgcolor;return(l==="transparent"||l==="none")&&(l=null),l?a.bg=qe("rect",{width:this._width,height:this._height,fill:l})+He("rect"):a.bg="",a.root=qe("g",fe({},Ab,{transform:"translate("+r+")"})),a.foot=He("g")+He("svg"),this},Ar.background=function(){var e=sC.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),e},Ar.svg=function(){var e=this._text;return e.head+e.defs+e.bg+e.root+e.body+e.foot},Ar._render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},Ar.buildDefs=function(){let e="",t;for(const n in this._defs.gradient){const i=this._defs.gradient[n],r=i.stops;i.gradient==="radial"?(e+=qe(t="pattern",{id:Nd+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e+=qe("rect",{width:"1",height:"1",fill:"url(#"+n+")"})+He("rect"),e+=He(t),e+=qe(t="radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e+=qe(t="linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let a=0;a<r.length;++a)e+=qe("stop",{offset:r[a].offset,"stop-color":r[a].color})+He("stop");e+=He(t)}for(const n in this._defs.clipping){const i=this._defs.clipping[n];e+=qe("clipPath",{id:n}),i.path?e+=qe("path",{d:i.path})+He("path"):e+=qe("rect",{x:0,y:0,width:i.width,height:i.height})+He("rect"),e+=He("clipPath")}return e?qe("defs")+e+He("defs"):""},Ar.attr=function(e,t,n,i){const r={},a=(o,s,l,u)=>{r[u||o]=s};return Array.isArray(n)?n.forEach(o=>o(a,t,this)):n(a,t,this),i&&Uq(r,t,e,i,this._defs),r},Ar.href=function(e){var t=this,n=e.href,i;if(n){if(i=t._hrefs&&t._hrefs[n])return i;t.sanitizeURL(n).then(r=>{r["xlink:href"]=r.href,r.href=null,(t._hrefs||(t._hrefs={}))[n]=r})}return null},Ar.mark=function(e){const t=Hn[e.marktype],n=t.tag,i=[eC,t.attr];let r="";r+=qe("g",fe({class:uO(e),"clip-path":e.clip?ay(this,e,e.group):null},tC(e),{"pointer-events":n!=="g"&&e.interactive===!1?"none":null}));const a=o=>{const s=this.href(o);if(s&&(r+=qe("a",s)),r+=qe(n,this.attr(e,o,i,n!=="g"?n:null)),n==="text"){const l=Cu(o);if(I(l)){const u={x:0,dy:ca(o)};for(let c=0;c<l.length;++c)r+=qe("tspan",c?u:null)+lC(fa(o,l[c]))+He("tspan")}else r+=lC(fa(o,l))}else if(n==="g"){const l=o.strokeForeground,u=o.fill,c=o.stroke;l&&c&&(o.stroke=null),r+=qe("path",this.attr(e,o,t.background,"bgrect"))+He("path"),r+=qe("g",this.attr(e,o,t.content))+this.markGroup(o)+He("g"),l&&c?(u&&(o.fill=null),o.stroke=c,r+=qe("path",this.attr(e,o,t.foreground,"bgrect"))+He("path"),u&&(o.fill=u)):r+=qe("path",this.attr(e,o,t.foreground,"bgfore"))+He("path")}r+=He(n),s&&(r+=He("a"))};return t.nested?e.items&&e.items.length&&a(e.items[0]):pi(e,a),r+He("g")},Ar.markGroup=function(e){let t="";return pi(e,n=>{t+=this.mark(n)}),t};function Uq(e,t,n,i,r){if(t==null)return e;if(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null))return e;i==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),i==="text"&&(e["font-family"]=$u(t),e["font-size"]=Pi(t)+"px",t.fontStyle&&(e["font-style"]=t.fontStyle),t.fontVariant&&(e["font-variant"]=t.fontVariant),t.fontWeight&&(e["font-weight"]=t.fontWeight));for(const a in Nh){let o=t[a];const s=Nh[a];o==="transparent"&&(s==="fill"||s==="stroke")||o!=null&&(qv(o)&&(o=KA(o,r.gradient,"")),e[s]=o)}return e}function lC(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var uC="canvas",cC="png",fC="svg",dC="none",ba={Canvas:uC,PNG:cC,SVG:fC,None:dC},tl={};tl[uC]=tl[cC]={renderer:ph,headless:ph,handler:Nu},tl[fC]={renderer:Sb,headless:Cb,handler:Cy},tl[dC]={};function Mh(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(tl[e]=t,this):tl[e]}function hC(e,t,n){const i=[],r=new ot().union(t),a=e.marktype;return a?pC(e,r,n,i):a==="group"?gC(e,r,n,i):F("Intersect scene must be mark node or group item.")}function pC(e,t,n,i){if(qq(e,t,n)){const r=e.items,a=e.marktype,o=r.length;let s=0;if(a==="group")for(;s<o;++s)gC(r[s],t,n,i);else for(const l=Hn[a].isect;s<o;++s){let u=r[s];mC(u,t,l)&&i.push(u)}}return i}function qq(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function gC(e,t,n,i){n&&n(e.mark)&&mC(e,t,Hn.group.isect)&&i.push(e);const r=e.items,a=r&&r.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let l=0;l<a;++l)pC(r[l],t,n,i);t.translate(o,s)}return i}function mC(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}var $b=new ot();function vC(e){var t=e.clip;if(ge(t))t(pn($b.clear()));else if(t)$b.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect($b)}var Wq=1e-9;function Db(e,t,n){return e===t?!0:n==="path"?yC(e,t):e instanceof Date&&t instanceof Date?+e===+t:De(e)&&De(t)?Math.abs(e-t)<=Wq:!e||!t||!K(e)&&!K(t)?e==t:e==null||t==null?!1:Gq(e,t)}function yC(e,t){return Db(Ls(e),Ls(t))}function Gq(e,t){var n=Object.keys(e),i=Object.keys(t),r,a;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),a=n.length-1;a>=0;a--)if(n[a]!=i[a])return!1;for(a=n.length-1;a>=0;a--)if(r=n[a],!Db(e[r],t[r],r))return!1;return typeof e===typeof t}function Hq(){$S(),E9()}function bC(e){$.call(this,null,e)}var Yq=P(bC,$);Yq.transform=function(e,t){var n=t.dataflow,i=e.mark,r=i.marktype,a=Hn[r],o=a.bound,s=i.bounds,l;if(a.nested)i.items.length&&n.dirty(i.items[0]),s=jh(i,o),i.items.forEach(function(u){u.bounds.clear().union(s)});else if(r===Rd||e.modified()){t.visit(t.MOD,u=>n.dirty(u)),s.clear(),i.items.forEach(u=>s.union(jh(u,o)));switch(i.role){case jv:case Pv:case Lv:t.reflow()}}else l=t.changed(t.REM),t.visit(t.ADD,u=>{s.union(jh(u,o))}),t.visit(t.MOD,u=>{l=l||s.alignsWith(u.bounds),n.dirty(u),s.union(jh(u,o))}),l&&(s.clear(),i.items.forEach(u=>s.union(u.bounds)));return vC(i),t.modifies("bounds")};function jh(e,t,n){return t(e.bounds.clear(),e,n)}var wC=":vega_identifier:";function Rb(e){$.call(this,0,e)}Rb.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};var Vq=P(Rb,$);Vq.transform=function(e,t){var n=Xq(t.dataflow),i=n.value,r=e.as;return t.visit(t.ADD,a=>{a[r]||(a[r]=++i)}),n.set(this.value=i),t};function Xq(e){var t=e._signals[wC];return t||(e._signals[wC]=t=e.add(0)),t}function xC(e){$.call(this,null,e)}var Jq=P(xC,$);Jq.transform=function(e,t){var n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,Kq(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);var i=n.marktype===Rd?Hd:Gd;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t};function Kq(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function EC(e){$.call(this,null,e)}var Qq=P(EC,$),kC={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{var n;return e.filter((i,r)=>!r||!_C(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}};function _C(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)}function AC(e,t){for(var n=1,i=e.length,r=e[0].bounds,a;n<i;r=a,++n)if(_C(r,a=e[n].bounds,t))return!0}function Zq(e){var t=e.bounds;return t.width()>1&&t.height()>1}function eW(e,t,n){var i=e.range(),r=new ot();return t===Is||t===ra?r.set(i[0],-Infinity,i[1],Infinity):r.set(-Infinity,i[0],Infinity,i[1]),r.expand(n||1),a=>r.encloses(a.bounds)}function SC(e){return e.forEach(t=>t.opacity=1),e}function OC(e,t){return e.reflow(t.modified()).modifies("opacity")}Qq.transform=function(e,t){var n=kC[e.method]||kC.parity,i=t.materialize(t.SOURCE).source,r=e.separation||0,a,o,s;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(SC(i),t=OC(t,e)),t;if(i=i.filter(Zq),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),a=SC(i),t=OC(t,e),a.length>=3&&AC(a,r)){do a=n(a,r);while(a.length>=3&&AC(a,r));a.length<3&&!ve(i).opacity&&(a.length>1&&(ve(a).opacity=0),ve(i).opacity=1)}return e.boundScale&&e.boundTolerance>=0&&(o=eW(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(l=>{o(l)||(l.opacity=0)})),s=a[0].mark.bounds.clear(),i.forEach(l=>{l.opacity&&s.union(l.bounds)}),t};function TC(e){$.call(this,null,e)}var tW=P(TC,$);tW.transform=function(e,t){var n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){var i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}};const Lt=new ot();function nl(e,t,n){return e[t]===n?0:(e[t]=n,1)}function nW(e){var t=e.items[0].orient;return t===fi||t===di}function iW(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function rW(e,t,n,i){var r=t.items[0],a=r.datum,o=r.translate!=null?r.translate:.5,s=r.orient,l=iW(a),u=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,p=a.title&&r.items[l[2]].items[0],g=r.titlePadding,m=r.bounds,v=p&&wy(p),y=0,b=0,E,x;Lt.clear().union(m),m.clear(),(E=l[0])>-1&&m.union(r.items[E].bounds),(E=l[1])>-1&&m.union(r.items[E].bounds);switch(s){case Is:y=f||0,b=-c,x=Math.max(d,Math.min(h,-m.y1)),m.add(0,-x).add(u,0),p&&Lh(e,p,x,g,v,0,-1,m);break;case fi:y=-c,b=f||0,x=Math.max(d,Math.min(h,-m.x1)),m.add(-x,0).add(0,u),p&&Lh(e,p,x,g,v,1,-1,m);break;case di:y=n+c,b=f||0,x=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(x,u),p&&Lh(e,p,x,g,v,1,1,m);break;case ra:y=f||0,b=i+c,x=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(u,x),p&&Lh(e,p,x,g,0,0,1,m);break;default:y=r.x,b=r.y}return xr(m.translate(y,b),r),nl(r,"x",y+o)|nl(r,"y",b+o)&&(r.bounds=Lt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Lh(e,t,n,i,r,a,o,s){const l=t.bounds;if(t.auto){const u=o*(n+r+i);let c=0,f=0;e.dirty(t),a?c=(t.x||0)-(t.x=u):f=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-c,-f)),e.dirty(t)}s.union(l)}const CC=(e,t)=>Math.floor(Math.min(e,t)),$C=(e,t)=>Math.ceil(Math.max(e,t));function aW(e){for(var t=e.items,n=t.length,i=0,r,a,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};i<n;++i)if(r=t[i],a=r.items,r.marktype===Rd)switch(r.role){case jv:case Pv:case Lv:break;case qA:o.rowheaders.push(...a);break;case WA:o.rowfooters.push(...a);break;case HA:o.colheaders.push(...a);break;case YA:o.colfooters.push(...a);break;case GA:o.rowtitle=a[0];break;case VA:o.coltitle=a[0];break;default:o.marks.push(...a)}return o}function oW(e){return new ot().set(0,0,e.width||0,e.height||0)}function sW(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function ze(e,t,n){var i=K(e)?e[t]:e;return i??(n!==void 0?n:0)}function DC(e){return e<0?Math.ceil(-e):0}function RC(e,t,n){var i=!n.nodirty,r=n.bounds===Uv?oW:sW,a=Lt.set(0,0,0,0),o=ze(n.align,aa),s=ze(n.align,oa),l=ze(n.padding,aa),u=ze(n.padding,oa),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),p=Array(c),g=0,m=Array(d),v=Array(f),y=0,b=Array(d),E=Array(d),x=Array(d),k,w,A,_,O,S,T,D,M,C,N;for(w=0;w<c;++w)p[w]=0;for(w=0;w<f;++w)v[w]=0;for(w=0;w<d;++w)S=t[w],O=x[w]=r(S),S.x=S.x||0,b[w]=0,S.y=S.y||0,E[w]=0,A=w%c,_=~~(w/c),g=Math.max(g,T=Math.ceil(O.x2)),y=Math.max(y,D=Math.ceil(O.y2)),p[A]=Math.max(p[A],T),v[_]=Math.max(v[_],D),h[w]=l+DC(O.x1),m[w]=u+DC(O.y1),i&&e.dirty(t[w]);for(w=0;w<d;++w)w%c===0&&(h[w]=0),w<c&&(m[w]=0);if(o===Bv)for(A=1;A<c;++A){for(N=0,w=A;w<d;w+=c)N<h[w]&&(N=h[w]);for(w=A;w<d;w+=c)h[w]=N+p[A-1]}else if(o===Fd){for(N=0,w=0;w<d;++w)w%c&&N<h[w]&&(N=h[w]);for(w=0;w<d;++w)w%c&&(h[w]=N+g)}else for(o=!1,A=1;A<c;++A)for(w=A;w<d;w+=c)h[w]+=p[A-1];if(s===Bv)for(_=1;_<f;++_){for(N=0,w=_*c,k=w+c;w<k;++w)N<m[w]&&(N=m[w]);for(w=_*c;w<k;++w)m[w]=N+v[_-1]}else if(s===Fd){for(N=0,w=c;w<d;++w)N<m[w]&&(N=m[w]);for(w=c;w<d;++w)m[w]=N+y}else for(s=!1,_=1;_<f;++_)for(w=_*c,k=w+c;w<k;++w)m[w]+=v[_-1];for(M=0,w=0;w<d;++w)M=h[w]+(w%c?M:0),b[w]+=M-t[w].x;for(A=0;A<c;++A)for(C=0,w=A;w<d;w+=c)C+=m[w],E[w]+=C-t[w].y;if(o&&ze(n.center,aa)&&f>1)for(w=0;w<d;++w)O=o===Fd?g:p[w%c],M=O-x[w].x2-t[w].x-b[w],M>0&&(b[w]+=M/2);if(s&&ze(n.center,oa)&&c!==1)for(w=0;w<d;++w)O=s===Fd?y:v[~~(w/c)],C=O-x[w].y2-t[w].y-E[w],C>0&&(E[w]+=C/2);for(w=0;w<d;++w)a.union(x[w].translate(b[w],E[w]));M=ze(n.anchor,h9),C=ze(n.anchor,p9);switch(ze(n.anchor,aa)){case Vt:M-=a.width();break;case Mv:M-=a.width()/2}switch(ze(n.anchor,oa)){case Vt:C-=a.height();break;case Mv:C-=a.height()/2}for(M=Math.round(M),C=Math.round(C),a.clear(),w=0;w<d;++w)t[w].mark.bounds.clear();for(w=0;w<d;++w)S=t[w],S.x+=b[w]+=M,S.y+=E[w]+=C,a.union(S.mark.bounds.union(S.bounds.translate(b[w],E[w]))),i&&e.dirty(S);return a}function lW(e,t,n){var i=aW(t),r=i.marks,a=n.bounds===Uv?uW:cW,o=n.offset,s=n.columns||r.length,l=s<=0?1:Math.ceil(r.length/s),u=l*s,c,f,d,h,p,g,m;const v=RC(e,r,n);v.empty()&&v.set(0,0,0,0),i.rowheaders&&(g=ze(n.headerBand,oa,null),c=Ph(e,i.rowheaders,r,s,l,-ze(o,"rowHeader"),CC,0,a,"x1",0,s,1,g)),i.colheaders&&(g=ze(n.headerBand,aa,null),f=Ph(e,i.colheaders,r,s,s,-ze(o,"columnHeader"),CC,1,a,"y1",0,1,s,g)),i.rowfooters&&(g=ze(n.footerBand,oa,null),d=Ph(e,i.rowfooters,r,s,l,ze(o,"rowFooter"),$C,0,a,"x2",s-1,s,1,g)),i.colfooters&&(g=ze(n.footerBand,aa,null),h=Ph(e,i.colfooters,r,s,s,ze(o,"columnFooter"),$C,1,a,"y2",u-s,1,s,g)),i.rowtitle&&(p=ze(n.titleAnchor,oa),m=ze(o,"rowTitle"),m=p===Vt?d+m:c-m,g=ze(n.titleBand,oa,.5),FC(e,i.rowtitle,m,0,v,g)),i.coltitle&&(p=ze(n.titleAnchor,aa),m=ze(o,"columnTitle"),m=p===Vt?h+m:f-m,g=ze(n.titleBand,aa,.5),FC(e,i.coltitle,m,1,v,g))}function uW(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function cW(e,t){return e.bounds[t]}function Ph(e,t,n,i,r,a,o,s,l,u,c,f,d,h){var p=n.length,g=0,m=0,v,y,b,E,x,k,w,A,_;if(!p)return g;for(v=c;v<p;v+=f)n[v]&&(g=o(g,l(n[v],u)));if(!t.length)return g;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),g+=a,y=0,E=t.length;y<E;++y)e.dirty(t[y]),t[y].mark.bounds.clear();for(v=c,y=0,E=t.length;y<E;++y,v+=f){for(k=t[y],x=k.mark.bounds,b=v;b>=0&&(w=n[b])==null;b-=d);s?(A=h==null?w.x:Math.round(w.bounds.x1+h*w.bounds.width()),_=g):(A=g,_=h==null?w.y:Math.round(w.bounds.y1+h*w.bounds.height())),x.union(k.bounds.translate(A-(k.x||0),_-(k.y||0))),k.x=A,k.y=_,e.dirty(k),m=o(m,x[u])}return m}function FC(e,t,n,i,r,a){if(!t)return;e.dirty(t);var o=n,s=n;i?o=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}function fW(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function dW(e,t){var n=-Infinity;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-Infinity?n:t}function hW(e,t,n,i,r,a,o){const s=fW(n,t),l=dW(e,s("offset",0)),u=s("anchor",Iv),c=u===Vt?1:u===Mv?.5:0,f={align:Bv,bounds:s("bounds",Uv),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case fi:f.anchor={x:Math.floor(i.x1)-l,column:Vt,y:c*(o||i.height()+2*i.y1),row:u};break;case di:f.anchor={x:Math.ceil(i.x2)+l,y:c*(o||i.height()+2*i.y1),row:u};break;case Is:f.anchor={y:Math.floor(r.y1)-l,row:Vt,x:c*(a||r.width()+2*r.x1),column:u};break;case ra:f.anchor={y:Math.ceil(r.y2)+l,x:c*(a||r.width()+2*r.x1),column:u};break;case u9:f.anchor={x:l,y:l};break;case c9:f.anchor={x:a-l,y:l,column:Vt};break;case f9:f.anchor={x:l,y:o-l,row:Vt};break;case d9:f.anchor={x:a-l,y:o-l,column:Vt,row:Vt};break}return f}function pW(e,t){var n=t.items[0],i=n.datum,r=n.orient,a=n.bounds,o=n.x,s=n.y,l,u;return n._bounds?n._bounds.clear().union(a):n._bounds=a.clone(),a.clear(),mW(e,n,n.items[0].items[0]),a=gW(n,a),l=2*n.padding,u=2*n.padding,a.empty()||(l=Math.ceil(a.width()+l),u=Math.ceil(a.height()+u)),i.type===y9&&vW(n.items[0].items[0].items[0].items),r!==zv&&(n.x=o=0,n.y=s=0),n.width=l,n.height=u,xr(a.set(o,s,o+l,s+u),n),n.mark.bounds.clear().union(a),n}function gW(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function mW(e,t,n){var i=t.padding,r=i-n.x,a=i-n.y;if(!t.datum.title)(r||a)&&Qu(e,n,r,a);else{var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=i-o.x,c=i-o.y;switch(o.orient){case fi:r+=Math.ceil(o.bounds.width())+l;break;case di:case ra:break;default:a+=o.bounds.height()+l}(r||a)&&Qu(e,n,r,a);switch(o.orient){case fi:c+=il(t,n,o,s,1,1);break;case di:u+=il(t,n,o,Vt,0,0)+l,c+=il(t,n,o,s,1,1);break;case ra:u+=il(t,n,o,s,0,0),c+=il(t,n,o,Vt,-1,0,1)+l;break;default:u+=il(t,n,o,s,0,0)}(u||c)&&Qu(e,o,u,c),(u=Math.round(o.bounds.x1-i))<0&&(Qu(e,n,-u,0),Qu(e,o,-u,0))}}function il(e,t,n,i,r,a,o){const s=e.datum.type!=="symbol",l=n.datum.vgrad,u=s&&(a||!l)&&!o?t.items[0]:t,c=u.bounds[r?"y2":"x2"]-e.padding,f=l&&a?c:0,d=l&&a?0:c,h=r<=0?0:wy(n);return Math.round(i===Iv?f:i===Vt?d-h:.5*(c-h))}function Qu(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function vW(e){var t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function yW(e,t,n,i,r){var a=t.items[0],o=a.frame,s=a.orient,l=a.anchor,u=a.offset,c=a.padding,f=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],h=s===fi||s===di?i:n,p=0,g=0,m=0,v=0,y=0,b;if(o!==Rd?s===fi?(p=r.y2,h=r.y1):s===di?(p=r.y1,h=r.y2):(p=r.x1,h=r.x2):s===fi&&(p=i,h=0),b=l===Iv?p:l===Vt?h:(p+h)/2,d&&d.text){switch(s){case Is:case ra:y=f.bounds.height()+c;break;case fi:v=f.bounds.width()+c;break;case di:v=-f.bounds.width()-c;break}Lt.clear().union(d.bounds),Lt.translate(v-(d.x||0),y-(d.y||0)),nl(d,"x",v)|nl(d,"y",y)&&(e.dirty(d),d.bounds.clear().union(Lt),d.mark.bounds.clear().union(Lt),e.dirty(d)),Lt.clear().union(d.bounds)}else Lt.clear();Lt.union(f.bounds);switch(s){case Is:g=b,m=r.y1-Lt.height()-u;break;case fi:g=r.x1-Lt.width()-u,m=b;break;case di:g=r.x2+Lt.width()+u,m=b;break;case ra:g=b,m=r.y2+u;break;default:g=a.x,m=a.y}return nl(a,"x",g)|nl(a,"y",m)&&(Lt.translate(g,m),e.dirty(a),a.bounds.clear().union(Lt),t.bounds.clear().union(Lt),e.dirty(a)),a.bounds}function NC(e){$.call(this,null,e)}var bW=P(NC,$);bW.transform=function(e,t){var n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&lW(n,i,e.layout),xW(n,i,e)}),wW(e.mark.group)?t.reflow():t};function wW(e){return e&&e.mark.role!=="legend-entry"}function xW(e,t,n){var i=t.items,r=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=new ot().set(0,0,r,a),s=o.clone(),l=o.clone(),u=[],c,f,d,h,p,g;for(p=0,g=i.length;p<g;++p){f=i[p];switch(f.role){case jv:h=nW(f)?s:l,h.union(rW(e,f,r,a));break;case Lv:c=f;break;case Pv:u.push(pW(e,f));break;case g9:case m9:case qA:case WA:case GA:case HA:case YA:case VA:s.union(f.bounds),l.union(f.bounds);break;default:o.union(f.bounds)}}if(u.length){const m={};u.forEach(v=>{d=v.orient||di,d!==zv&&(m[d]||(m[d]=[])).push(v)});for(let v in m){const y=m[v];RC(e,y,hW(y,v,n.legends,s,l,r,a))}u.forEach(v=>{const y=v.bounds;if(y.equals(v._bounds)||(v.bounds=v._bounds,e.dirty(v),v.bounds=y,e.dirty(v)),n.autosize&&n.autosize.type===XA)switch(v.orient){case fi:case di:o.add(y.x1,0).add(y.x2,0);break;case Is:case ra:o.add(0,y.y1).add(0,y.y2)}else o.union(y)})}o.union(s).union(l),c&&o.union(yW(e,c,r,a,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),EW(e,t,o,n)}function EW(e,t,n,i){const r=i.autosize||{},a=r.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-l)),f=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1)),h=Math.max(0,Math.ceil(n.y2-f));if(r.contains===v9){const p=e.padding();o-=p.left+p.right,s-=p.top+p.bottom}a===zv?(u=0,d=0,l=o,f=s):a===XA?(l=Math.max(0,o-u-c),f=Math.max(0,s-d-h)):a===b9?(l=Math.max(0,o-u-c),s=f+d+h):a===w9?(o=l+u+c,f=Math.max(0,s-d-h)):a===x9&&(o=l+u+c,s=f+d+h),e._resizeView(o,s,l,f,[u,d],r.resize)}var kW=Object.freeze({__proto__:null,bound:bC,identifier:Rb,mark:xC,overlap:EC,render:TC,viewlayout:NC});function IC(e){$.call(this,null,e)}var _W=P(IC,$);_W.transform=function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,s=yb(a,o,e.minstep),l=e.format||BT(n,a,s,e.formatSpecifier,e.formatType,!!e.values),u=e.values?zT(a,e.values,s):bb(a,s);return r&&(i.rem=r),r=u.map(function(c,f){return ke({index:f/(u.length-1||1),value:c,label:l(c)})}),e.extra&&r.length&&r.push(ke({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i};function MC(e){$.call(this,null,e)}var AW=P(MC,$);function SW(){return ke({})}function OW(e){const t=Kl().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}AW.transform=function(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||SW,a=e.key||ee,o=this.value;return I(i.encode)&&(i.encode=null),o&&(e.modified("key")||t.modified(a))&&F("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=OW(a)),t.visit(t.ADD,s=>{const l=a(s);let u=o.get(l);u?u.exit?(o.empty--,i.add.push(u)):i.mod.push(u):(u=r(s),o.set(l,u),i.add.push(u)),u.datum=s,u.exit=!1}),t.visit(t.MOD,s=>{const l=a(s),u=o.get(l);u&&(u.datum=s,i.mod.push(u))}),t.visit(t.REM,s=>{const l=a(s),u=o.get(l);s===u.datum&&!u.exit&&(i.rem.push(u),u.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i};function jC(e){$.call(this,null,e)}var TW=P(jC,$);TW.transform=function(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,a=t.encode;if(I(a))if(n.changed()||a.every(function(d){return r[d]}))a=a[0],n.encode=null;else return t.StopPropagation;var o=a==="enter",s=r.update||to,l=r.enter||to,u=r.exit||to,c=(a&&!o?r[a]:s)||to;if(t.changed(t.ADD)&&(t.visit(t.ADD,function(d){l(d,e),s(d,e)}),n.modifies(l.output),n.modifies(s.output),c!==to&&c!==s&&(t.visit(t.ADD,function(d){c(d,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==to&&(t.visit(t.REM,function(d){u(d,e)}),n.modifies(u.output)),o||c!==to){var f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,function(d){var h=l(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)):t.visit(f,function(d){(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation};function LC(e){$.call(this,[],e)}var CW=P(LC,$);CW.transform=function(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.type||Fh,o=e.scale,s=+e.limit,l=yb(o,e.count==null?5:e.count,e.minstep),u=!!e.values||a===Fh,c=e.format||GT(n,o,l,a,e.formatSpecifier,e.formatType,u),f=e.values||WT(o,l),d,h,p,g,m;return r&&(i.rem=r),a===Fh?(s&&f.length>s?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,s-1),m=!0):r=f,ge(p=e.size)?(!e.values&&o(r[0])===0&&(r=r.slice(1)),g=r.reduce(function(v,y){return Math.max(v,p(y,e))},0)):p=Yt(g=p||8),r=r.map(function(v,y){return ke({index:y,label:c(v,y,r),value:v,offset:g,size:p(v,e)})}),m&&(m=f[r.length],r.push(ke({index:r.length,label:`…${f.length-r.length} entries`,value:m,offset:g,size:p(m,e)})))):a===gq?(d=o.domain(),h=MT(o,d[0],ve(d)),f.length<3&&!e.values&&d[0]!==ve(d)&&(f=[d[0],ve(d)]),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:h(v)})})):(p=f.length-1,h=Sq(o),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:y?h(v):0,perc2:y===p?1:h(f[y+1])})})),i.source=r,i.add=r,this.value=r,i};var PC=Kl({line:zC,"line-radial":IW,arc:BC,"arc-radial":MW,curve:UC,"curve-radial":jW,"orthogonal-horizontal":LW,"orthogonal-vertical":PW,"orthogonal-radial":zW,"diagonal-horizontal":BW,"diagonal-vertical":UW,"diagonal-radial":qW});function $W(e){return e.source.x}function DW(e){return e.source.y}function RW(e){return e.target.x}function FW(e){return e.target.y}function Fb(e){$.call(this,{},e)}Fb.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var NW=P(Fb,$);NW.transform=function(e,t){var n=e.sourceX||$W,i=e.sourceY||DW,r=e.targetX||RW,a=e.targetY||FW,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=PC.get(l+"-"+s)||PC.get(l);return u||F("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,function(c){c[o]=u(n(c),i(c),r(c),a(c))}),t.reflow(e.modified()).modifies(o)};function zC(e,t,n,i){return"M"+e+","+t+"L"+n+","+i}function IW(e,t,n,i){return zC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function BC(e,t,n,i){var r=n-e,a=i-t,o=Math.sqrt(r*r+a*a)/2,s=180*Math.atan2(a,r)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1 "+n+","+i}function MW(e,t,n,i){return BC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function UC(e,t,n,i){var r=n-e,a=i-t,o=.2*(r+a),s=.2*(a-r);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(i-o)+" "+n+","+i}function jW(e,t,n,i){return UC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function LW(e,t,n,i){return"M"+e+","+t+"V"+i+"H"+n}function PW(e,t,n,i){return"M"+e+","+t+"H"+n+"V"+i}function zW(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*a+"A"+t+","+t+" 0 0,"+(l?1:0)+" "+t*o+","+t*s+"L"+i*o+","+i*s}function BW(e,t,n,i){var r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i}function UW(e,t,n,i){var r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i}function qW(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+i)/2;return"M"+t*r+","+t*a+"C"+l*r+","+l*a+" "+l*o+","+l*s+" "+i*o+","+i*s}function Nb(e){$.call(this,null,e)}Nb.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};var WW=P(Nb,$);WW.transform=function(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],a=e.field||Xl,o=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,l=t.source,u=l.map(a),c=u.length,f=o,d=(s-o)/Ik(u),h=so(c),p,g,m;for(e.sort&&h.sort(function(v,y){return u[v]-u[y]}),p=0;p<c;++p)m=u[h[p]],g=l[h[p]],g[i]=f,g[r]=f+=m*d;return this.value=u,t.reflow(e.modified()).modifies(n)};var GW=5;function HW(e){const t=e.type;return!e.bins&&(t===Ys||t===Iu||t===Mu)}function qC(e){return pb(e)&&e!==zi}var YW=Et(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function WC(e){$.call(this,null,e),this.modified(!0)}var VW=P(WC,$);VW.transform=function(e,t){var n=t.dataflow,i=this.value,r=XW(e);(!i||r!==i.type)&&(this.value=i=Ee(r)());for(r in e)if(!YW[r]){if(r==="padding"&&qC(i.type))continue;ge(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return tG(i,e,eG(i,e,KW(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function XW(e){var t=e.type,n="",i;return t===zi?zi+"-"+Ys:(JW(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?zi+"-":i===3?Vs+"-":""),(n+t||Ys).toLowerCase())}function JW(e){const t=e.type;return pb(t)&&t!==Eo&&t!==ko&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function KW(e,t,n){var i=QW(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,a=e.type,o=t.zero||t.zero===void 0&&HW(e),s,l;if(!r)return 0;if(qC(a)&&t.padding&&r[0]!==ve(r)&&(r=ZW(a,r,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(s=(r=r.slice()).length-1||1,o&&(r[0]>0&&(r[0]=0),r[s]<0&&(r[s]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[s]=t.domainMax),t.domainMid!=null)){l=t.domainMid;const u=l>r[s]?s+1:l<r[0]?0:s;u!==s&&n.warn("Scale domainMid exceeds domain min or max.",l),r.splice(u,0,l)}return e.domain(GC(a,r,n)),a===Ry&&e.unknown(t.domainImplicit?My:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&yb(e,t.nice)||null),r.length}function QW(e,t,n){return t?(e.domain(GC(e.type,t,n)),t.length):-1}function ZW(e,t,n,i,r,a){var o=Math.abs(ve(n)-n[0]),s=o/(o-2*i),l=e===Er?ok(t,null,s):e===Mu?Xm(t,null,s,.5):e===Iu?Xm(t,null,s,r||1):e===mh?sk(t,null,s,a||1):ak(t,null,s);return t=t.slice(),t[0]=l[0],t[t.length-1]=l[1],t}function GC(e,t,n){if(DT(e)){var i=Math.abs(t.reduce(function(r,a){return r+(a<0?-1:a>0?1:0)},0));i!==t.length&&n.warn("Log scale domain includes zero: "+B(t))}return t}function eG(e,t,n){let i=t.bins;if(i&&!I(i)){let r=e.domain(),a=r[0],o=ve(r),s=i.start==null?a:i.start,l=i.stop==null?o:i.stop,u=i.step;u||F("Scale bins parameter missing step property."),s<a&&(s=u*Math.ceil(a/u)),l>o&&(l=u*Math.floor(o/u)),i=so(s,l+u/2,u)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Ny&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function tG(e,t,n){var i=e.type,r=t.round||!1,a=t.range;if(t.rangeStep!=null)a=nG(i,t,n);else if(t.scheme&&(a=iG(i,t,n),ge(a))){if(e.interpolator)return e.interpolator(a);F(`Scale type ${i} does not support interpolating color schemes.`)}if(a&&RT(i))return e.interpolator(Rh(Ib(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(mb(t.interpolate,t.interpolateGamma)):ge(e.round)?e.round(r):ge(e.rangeRound)&&e.interpolate(r?qu:So),a&&e.range(Ib(a,t.reverse))}function nG(e,t,n){e!==yO&&e!==Fy&&F("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===Fy?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Dy(n,r,i)]}function iG(e,t,n){var i=t.schemeExtent,r,a;return I(t.scheme)?a=Rh(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),a=vb(r),a||F(`Unrecognized scheme name: ${t.scheme}`)),n=e===yh?n+1:e===Ny?n-1:e===Xs||e===vh?+t.schemeCount||GW:n,RT(e)?HC(a,i,t.reverse):ge(a)?IT(HC(a,i),n):e===Ry?a:a.slice(0,n)}function HC(e,t,n){return ge(e)&&(t||n)?NT(e,Ib(t||[0,1],n)):e}function Ib(e,t){return t?e.slice().reverse():e}function YC(e){$.call(this,null,e)}var rG=P(YC,$);rG.transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(ao(e.sort)),this.modified(n),t};var VC="zero",XC="center",JC="normalize",KC=["y0","y1"];function Mb(e){$.call(this,null,e)}Mb.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:VC,values:[VC,XC,JC]},{name:"as",type:"string",array:!0,length:2,default:KC}]};var aG=P(Mb,$);aG.transform=function(e,t){var n=e.as||KC,i=n[0],r=n[1],a=ao(e.sort),o=e.field||Xl,s=e.offset===XC?oG:e.offset===JC?sG:lG,l,u,c,f;for(l=uG(t.source,e.groupby,a,o),u=0,c=l.length,f=l.max;u<c;++u)s(l[u],f,o,i,r);return t.reflow(e.modified()).modifies(n)};function oG(e,t,n,i,r){for(var a=(t-e.sum)/2,o=e.length,s=0,l;s<o;++s)l=e[s],l[i]=a,l[r]=a+=Math.abs(n(l))}function sG(e,t,n,i,r){for(var a=1/e.sum,o=0,s=e.length,l=0,u=0,c;l<s;++l)c=e[l],c[i]=o,c[r]=o=a*(u+=Math.abs(n(c)))}function lG(e,t,n,i,r){for(var a=0,o=0,s=e.length,l=0,u,c;l<s;++l)c=e[l],u=+n(c),u<0?(c[i]=o,c[r]=o+=u):(c[i]=a,c[r]=a+=u)}function uG(e,t,n,i){var r=[],a=function(g){return g(c)},o,s,l,u,c,f,d,h,p;if(t==null)r.push(e.slice());else for(o={},s=0,l=e.length;s<l;++s)c=e[s],f=t.map(a),d=o[f],d||(o[f]=d=[],r.push(d)),d.push(c);for(f=0,p=0,u=r.length;f<u;++f){for(d=r[f],s=0,h=0,l=d.length;s<l;++s)h+=Math.abs(i(d[s]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return r.max=p,r}var cG=Object.freeze({__proto__:null,axisticks:IC,datajoin:MC,encode:jC,legendentries:LC,linkpath:Fb,pie:Nb,scale:WC,sortitems:YC,stack:Mb});function fG(){}const Sr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function QC(){var e=1,t=1,n=s;function i(l,u){return u.map(c=>r(l,c))}function r(l,u){var c=[],f=[];return a(l,u,function(d){n(d,l,u),dG(d)>0?c.push([d]):f.push(d)}),f.forEach(function(d){for(var h=0,p=c.length,g;h<p;++h)if(hG((g=c[h])[0],d)!==-1){g.push(d);return}}),{type:"MultiPolygon",value:u,coordinates:c}}function a(l,u,c){var f=new Array(),d=new Array(),h,p,g,m,v,y;for(h=p=-1,m=l[0]>=u,Sr[m<<1].forEach(b);++h<e-1;)g=m,m=l[h+1]>=u,Sr[g|m<<1].forEach(b);for(Sr[m<<0].forEach(b);++p<t-1;){for(h=-1,m=l[p*e+e]>=u,v=l[p*e]>=u,Sr[m<<1|v<<2].forEach(b);++h<e-1;)g=m,m=l[p*e+e+h+1]>=u,y=v,v=l[p*e+h+1]>=u,Sr[g|m<<1|v<<2|y<<3].forEach(b);Sr[m|v<<3].forEach(b)}for(h=-1,v=l[p*e]>=u,Sr[v<<2].forEach(b);++h<e-1;)y=v,v=l[p*e+h+1]>=u,Sr[v<<2|y<<3].forEach(b);Sr[v<<3].forEach(b);function b(E){var x=[E[0][0]+h,E[0][1]+p],k=[E[1][0]+h,E[1][1]+p],w=o(x),A=o(k),_,O;(_=d[w])?(O=f[A])?(delete d[_.end],delete f[O.start],_===O?(_.ring.push(k),c(_.ring)):f[_.start]=d[O.end]={start:_.start,end:O.end,ring:_.ring.concat(O.ring)}):(delete d[_.end],_.ring.push(k),d[_.end=A]=_):(_=f[A])?(O=d[w])?(delete f[_.start],delete d[O.end],_===O?(_.ring.push(k),c(_.ring)):f[O.start]=d[_.end]={start:O.start,end:_.end,ring:O.ring.concat(_.ring)}):(delete f[_.start],_.ring.unshift(x),f[_.start=w]=_):f[w]=d[A]={start:w,end:A,ring:[x,k]}}}function o(l){return l[0]*2+l[1]*(e+1)*4}function s(l,u,c){l.forEach(function(f){var d=f[0],h=f[1],p=d|0,g=h|0,m,v=u[g*e+p];d>0&&d<e&&p===d&&(m=u[g*e+p-1],f[0]=d+(c-m)/(v-m)-.5),h>0&&h<t&&g===h&&(m=u[(g-1)*e+p],f[1]=h+(c-m)/(v-m)-.5)})}return i.contour=r,i.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),c=Math.floor(l[1]);return u>=0&&c>=0||F("invalid size"),e=u,t=c,i},i.smooth=function(l){return arguments.length?(n=l?s:fG,i):n===s},i}function dG(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function hG(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=pG(e,t[n]))return r;return 0}function pG(e,t){for(var n=t[0],i=t[1],r=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(gG(l,f,t))return 0;c>i!==h>i&&n<(d-u)*(i-c)/(h-c)+u&&(r=-r)}return r}function gG(e,t,n){var i;return mG(e,t,n)&&vG(e[i=+(e[0]===t[0])],n[i],t[i])}function mG(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function vG(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function ZC(e,t,n){return function(i){var r=mr(i),a=n?Math.min(r[0],0):r[0],o=r[1],s=o-a,l=t?Zr(a,o,e):s/(e+1);return so(l,o,l)}}function jb(e){$.call(this,null,e)}jb.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};var yG=P(jb,$);yG.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||Ht,a=QC().smooth(e.smooth!==!1),o=e.thresholds||bG(i,r,e),s=e.as===null?null:e.as||"contour",l=[];return i.forEach(u=>{const c=r(u),f=a.size([c.width,c.height])(c.values,I(o)?o:o(c.values));wG(f,c,u,e),f.forEach(d=>{l.push(Km(u,ke(s!=null?{[s]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function bG(e,t,n){const i=ZC(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>lo(t(r).values)))}function wG(e,t,n,i){let r=i.scale||t.scale,a=i.translate||t.translate;if(ge(r)&&(r=r(n,i)),ge(a)&&(a=a(n,i)),(r===1||r==null)&&!a)return;const o=(De(r)?r:r[0])||1,s=(De(r)?r:r[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(e$(t,o,s,l,u))}function e$(e,t,n,i,r){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(f){f.forEach(u)}function u(f){s&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-a)*t+i,f[1]=(f[1]-o)*n+r}return function(f){return f.coordinates.forEach(l),f}}function t$(e,t,n){const i=e>=0?e:H0(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Lb(e){return ge(e)?e:Yt(+e)}function n$(){var e=l=>l[0],t=l=>l[1],n=Xl,i=[-1,-1],r=960,a=500,o=2;function s(l,u){const c=t$(i[0],l,e)>>o,f=t$(i[1],l,t)>>o,d=c?c+2:0,h=f?f+2:0,p=2*d+(r>>o),g=2*h+(a>>o),m=new Float32Array(p*g),v=new Float32Array(p*g);let y=m;l.forEach(E=>{const x=d+(+e(E)>>o),k=h+(+t(E)>>o);x>=0&&x<p&&k>=0&&k<g&&(m[x+k*p]+=+n(E))}),c>0&&f>0?(rl(p,g,m,v,c),al(p,g,v,m,f),rl(p,g,m,v,c),al(p,g,v,m,f),rl(p,g,m,v,c),al(p,g,v,m,f)):c>0?(rl(p,g,m,v,c),rl(p,g,v,m,c),rl(p,g,m,v,c),y=v):f>0&&(al(p,g,m,v,f),al(p,g,v,m,f),al(p,g,m,v,f),y=v);let b=u?Math.pow(2,-2*o):1/Ik(y);for(let E=0,x=p*g;E<x;++E)y[E]*=b;return{values:y,scale:1<<o,width:p,height:g,x1:d,y1:h,x2:d+(r>>o),y2:h+(a>>o)}}return s.x=function(l){return arguments.length?(e=Lb(l),s):e},s.y=function(l){return arguments.length?(t=Lb(l),s):t},s.weight=function(l){return arguments.length?(n=Lb(l),s):n},s.size=function(l){if(!arguments.length)return[r,a];var u=+l[0],c=+l[1];return u>=0&&c>=0||F("invalid size"),r=u,a=c,s},s.cellSize=function(l){return arguments.length?((l=+l)>=1||F("invalid cell size"),o=Math.floor(Math.log(l)/Math.LN2),s):1<<o},s.bandwidth=function(l){return arguments.length?(l=G(l),l.length===1&&(l=[+l[0],+l[0]]),l.length!==2&&F("invalid bandwidth"),i=l,s):i},s}function rl(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<t;++o)for(let s=0,l=0;s<e+r;++s)s<e&&(l+=n[s+o*e]),s>=r&&(s>=a&&(l-=n[s-a+o*e]),i[s-r+o*e]=l/Math.min(s+1,e-1+a-s,a))}function al(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<e;++o)for(let s=0,l=0;s<t+r;++s)s<t&&(l+=n[o+s*e]),s>=r&&(s>=a&&(l-=n[o+(s-a)*e]),i[o+(s-r)*e]=l/Math.min(s+1,t-1+a-s,a))}function Pb(e){$.call(this,null,e)}Pb.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var xG=P(Pb,$);const EG=["x","y","weight","size","cellSize","bandwidth"];function i$(e,t){return EG.forEach(n=>t[n]!=null?e[n](t[n]):0),e}xG.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=kG(i,e.groupby),a=(e.groupby||[]).map(Ze),o=i$(n$(),e),s=e.as||"grid",l=[];function u(c,f){for(let d=0;d<a.length;++d)c[a[d]]=f[d];return c}return l=r.map(c=>ke(u({[s]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function kG(e,t){var n=[],i=c=>c(s),r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function zb(e){$.call(this,null,e)}zb.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};var _G=P(zb,$);_G.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=QC().smooth(e.smooth!==!1),r=e.values,a=e.thresholds||ZC(e.count||10,e.nice,!!r),o=e.size,s,l;return r||(r=t.materialize(t.SOURCE).source,s=i$(n$(),e)(r,!0),l=e$(s,s.scale||1,s.scale||1,0,0),o=[s.width,s.height],r=s.values),a=I(a)?a:a(r),r=i.size(o)(r,a),l&&r.forEach(l),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(ke),n};var Bb="Feature",Ub="FeatureCollection",AG="MultiPoint";function qb(e){$.call(this,null,e)}qb.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};var SG=P(qb,$);SG.transform=function(e,t){var n=this._features,i=this._points,r=e.fields,a=r&&r[0],o=r&&r[1],s=e.geojson||!r&&Ht,l=t.ADD,u;u=e.modified()||t.changed(t.REM)||t.modified(Gt(s))||a&&t.modified(Gt(a))||o&&t.modified(Gt(o)),(!this.value||u)&&(l=t.SOURCE,this._features=n=[],this._points=i=[]),s&&t.visit(l,function(c){n.push(s(c))}),a&&o&&(t.visit(l,function(c){var f=a(c),d=o(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:Bb,geometry:{type:AG,coordinates:i}})),this.value={type:Ub,features:n}};function Co(){return new zh()}function zh(){this.reset()}zh.prototype={constructor:zh,reset:function(){this.s=this.t=0},add:function(e){r$(Bh,e,this.t),r$(this,Bh.s,this.s),this.s?this.t+=Bh.t:this.s=Bh.t},valueOf:function(){return this.s}};var Bh=new zh();function r$(e,t,n){var i=e.s=t+n,r=i-t,a=i-r;e.t=t-a+(n-r)}var ie=1e-6,Wb=1e-12,de=Math.PI,Ye=de/2,Uh=de/4,Xt=de*2,et=180/de,he=de/180,ye=Math.abs,ol=Math.atan,Xn=Math.atan2,re=Math.cos,qh=Math.ceil,a$=Math.exp,Wh=Math.log,Gb=Math.pow,te=Math.sin,Jn=Math.sign||function(e){return e>0?1:e<0?-1:0},Ot=Math.sqrt,Hb=Math.tan;function o$(e){return e>1?0:e<-1?de:Math.acos(e)}function yn(e){return e>1?Ye:e<-1?-Ye:Math.asin(e)}function Tt(){}function Gh(e,t){e&&l$.hasOwnProperty(e.type)&&l$[e.type](e,t)}var s$={Feature:function(e,t){Gh(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Gh(n[i].geometry,t)}},l$={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Yb(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Yb(n[i],t,0)},Polygon:function(e,t){u$(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)u$(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Gh(n[i],t)}};function Yb(e,t,n){var i=-1,r=e.length-n,a;for(t.lineStart();++i<r;)a=e[i],t.point(a[0],a[1],a[2]);t.lineEnd()}function u$(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Yb(e[n],t,1);t.polygonEnd()}function Or(e,t){e&&s$.hasOwnProperty(e.type)?s$[e.type](e,t):Gh(e,t)}var Hh=Co(),Yh=Co(),c$,f$,Vb,Xb,Jb,Gi={point:Tt,lineStart:Tt,lineEnd:Tt,polygonStart:function(){Hh.reset(),Gi.lineStart=OG,Gi.lineEnd=TG},polygonEnd:function(){var e=+Hh;Yh.add(e<0?Xt+e:e),this.lineStart=this.lineEnd=this.point=Tt},sphere:function(){Yh.add(Xt)}};function OG(){Gi.point=CG}function TG(){d$(c$,f$)}function CG(e,t){Gi.point=d$,c$=e,f$=t,e*=he,t*=he,Vb=e,Xb=re(t=t/2+Uh),Jb=te(t)}function d$(e,t){e*=he,t*=he,t=t/2+Uh;var n=e-Vb,i=n>=0?1:-1,r=i*n,a=re(t),o=te(t),s=Jb*o,l=Xb*a+s*re(r),u=s*i*te(r);Hh.add(Xn(u,l)),Vb=e,Xb=a,Jb=o}function $G(e){return Yh.reset(),Or(e,Gi),Yh*2}function Vh(e){return[Xn(e[1],e[0]),yn(e[2])]}function $o(e){var t=e[0],n=e[1],i=re(n);return[i*re(t),i*te(t),te(n)]}function Xh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function sl(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Kb(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Jh(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Kh(e){var t=Ot(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var We,bn,Ve,Mn,Do,h$,p$,ll,Zu=Co(),wa,Tr,Cr={point:Qb,lineStart:m$,lineEnd:v$,polygonStart:function(){Cr.point=y$,Cr.lineStart=DG,Cr.lineEnd=RG,Zu.reset(),Gi.polygonStart()},polygonEnd:function(){Gi.polygonEnd(),Cr.point=Qb,Cr.lineStart=m$,Cr.lineEnd=v$,Hh<0?(We=-(Ve=180),bn=-(Mn=90)):Zu>ie?Mn=90:Zu<-ie&&(bn=-90),Tr[0]=We,Tr[1]=Ve},sphere:function(){We=-(Ve=180),bn=-(Mn=90)}};function Qb(e,t){wa.push(Tr=[We=e,Ve=e]),t<bn&&(bn=t),t>Mn&&(Mn=t)}function g$(e,t){var n=$o([e*he,t*he]);if(ll){var i=sl(ll,n),r=[i[1],-i[0],0],a=sl(r,i);Kh(a),a=Vh(a);var o=e-Do,s=o>0?1:-1,l=a[0]*et*s,u,c=ye(o)>180;c^(s*Do<l&&l<s*e)?(u=a[1]*et,u>Mn&&(Mn=u)):(l=(l+360)%360-180,c^(s*Do<l&&l<s*e))?(u=-a[1]*et,u<bn&&(bn=u)):(t<bn&&(bn=t),t>Mn&&(Mn=t)),c?e<Do?jn(We,e)>jn(We,Ve)&&(Ve=e):jn(e,Ve)>jn(We,Ve)&&(We=e):Ve>=We?(e<We&&(We=e),e>Ve&&(Ve=e)):e>Do?jn(We,e)>jn(We,Ve)&&(Ve=e):jn(e,Ve)>jn(We,Ve)&&(We=e)}else wa.push(Tr=[We=e,Ve=e]);t<bn&&(bn=t),t>Mn&&(Mn=t),ll=n,Do=e}function m$(){Cr.point=g$}function v$(){Tr[0]=We,Tr[1]=Ve,Cr.point=Qb,ll=null}function y$(e,t){if(ll){var n=e-Do;Zu.add(ye(n)>180?n+(n>0?360:-360):n)}else h$=e,p$=t;Gi.point(e,t),g$(e,t)}function DG(){Gi.lineStart()}function RG(){y$(h$,p$),Gi.lineEnd(),ye(Zu)>ie&&(We=-(Ve=180)),Tr[0]=We,Tr[1]=Ve,ll=null}function jn(e,t){return(t-=e)<0?t+360:t}function FG(e,t){return e[0]-t[0]}function b$(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function NG(e){var t,n,i,r,a,o,s;if(Mn=Ve=-(We=bn=Infinity),wa=[],Or(e,Cr),n=wa.length){for(wa.sort(FG),t=1,i=wa[0],a=[i];t<n;++t)r=wa[t],b$(i,r[0])||b$(i,r[1])?(jn(i[0],r[1])>jn(i[0],i[1])&&(i[1]=r[1]),jn(r[0],i[1])>jn(i[0],i[1])&&(i[0]=r[0])):a.push(i=r);for(o=-Infinity,n=a.length-1,t=0,i=a[n];t<=n;i=r,++t)r=a[t],(s=jn(i[1],r[0]))>o&&(o=s,We=r[0],Ve=i[1])}return wa=Tr=null,We===Infinity||bn===Infinity?[[NaN,NaN],[NaN,NaN]]:[[We,bn],[Ve,Mn]]}var ec,Qh,Zh,ep,tp,np,ip,rp,Zb,e1,t1,w$,x$,Jt,Kt,Qt,yi={sphere:Tt,point:n1,lineStart:E$,lineEnd:k$,polygonStart:function(){yi.lineStart=jG,yi.lineEnd=LG},polygonEnd:function(){yi.lineStart=E$,yi.lineEnd=k$}};function n1(e,t){e*=he,t*=he;var n=re(t);tc(n*re(e),n*te(e),te(t))}function tc(e,t,n){++ec,Zh+=(e-Zh)/ec,ep+=(t-ep)/ec,tp+=(n-tp)/ec}function E$(){yi.point=IG}function IG(e,t){e*=he,t*=he;var n=re(t);Jt=n*re(e),Kt=n*te(e),Qt=te(t),yi.point=MG,tc(Jt,Kt,Qt)}function MG(e,t){e*=he,t*=he;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Xn(Ot((o=Kt*a-Qt*r)*o+(o=Qt*i-Jt*a)*o+(o=Jt*r-Kt*i)*o),Jt*i+Kt*r+Qt*a);Qh+=o,np+=o*(Jt+(Jt=i)),ip+=o*(Kt+(Kt=r)),rp+=o*(Qt+(Qt=a)),tc(Jt,Kt,Qt)}function k$(){yi.point=n1}function jG(){yi.point=PG}function LG(){_$(w$,x$),yi.point=n1}function PG(e,t){w$=e,x$=t,e*=he,t*=he,yi.point=_$;var n=re(t);Jt=n*re(e),Kt=n*te(e),Qt=te(t),tc(Jt,Kt,Qt)}function _$(e,t){e*=he,t*=he;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Kt*a-Qt*r,s=Qt*i-Jt*a,l=Jt*r-Kt*i,u=Ot(o*o+s*s+l*l),c=yn(u),f=u&&-c/u;Zb+=f*o,e1+=f*s,t1+=f*l,Qh+=c,np+=c*(Jt+(Jt=i)),ip+=c*(Kt+(Kt=r)),rp+=c*(Qt+(Qt=a)),tc(Jt,Kt,Qt)}function zG(e){ec=Qh=Zh=ep=tp=np=ip=rp=Zb=e1=t1=0,Or(e,yi);var t=Zb,n=e1,i=t1,r=t*t+n*n+i*i;return r<Wb&&(t=np,n=ip,i=rp,Qh<ie&&(t=Zh,n=ep,i=tp),r=t*t+n*n+i*i,r<Wb)?[NaN,NaN]:[Xn(n,t)*et,yn(i/Ot(r))*et]}function i1(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function r1(e,t){return[ye(e)>de?e+Math.round(-e/Xt)*Xt:e,t]}r1.invert=r1;function A$(e,t,n){return(e%=Xt)?t||n?i1(O$(e),T$(t,n)):O$(e):t||n?T$(t,n):r1}function S$(e){return function(t,n){return t+=e,[t>de?t-Xt:t<-de?t+Xt:t,n]}}function O$(e){var t=S$(e);return t.invert=S$(-e),t}function T$(e,t){var n=re(e),i=te(e),r=re(t),a=te(t);function o(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*n+c*i;return[Xn(f*r-h*a,c*n-d*i),yn(h*r+f*a)]}return o.invert=function(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*r-f*a;return[Xn(f*r+d*a,c*n+h*i),yn(h*n-c*i)]},o}function BG(e){e=A$(e[0]*he,e[1]*he,e.length>2?e[2]*he:0);function t(n){return n=e(n[0]*he,n[1]*he),n[0]*=et,n[1]*=et,n}return t.invert=function(n){return n=e.invert(n[0]*he,n[1]*he),n[0]*=et,n[1]*=et,n},t}function UG(e,t,n,i,r,a){if(!n)return;var o=re(t),s=te(t),l=i*n;r==null?(r=t+i*Xt,a=t-l/2):(r=C$(o,r),a=C$(o,a),(i>0?r<a:r>a)&&(r+=i*Xt));for(var u,c=r;i>0?c>a:c<a;c-=l)u=Vh([o,-s*re(c),-s*te(c)]),e.point(u[0],u[1])}function C$(e,t){t=$o(t),t[0]-=e,Kh(t);var n=o$(-t[1]);return((-t[2]<0?-n:n)+Xt-ie)%Xt}function $$(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Tt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function ap(e,t){return ye(e[0]-t[0])<ie&&ye(e[1]-t[1])<ie}function op(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function D$(e,t,n,i,r){var a=[],o=[],s,l;if(e.forEach(function(p){if((g=p.length-1)<=0)return;var g,m=p[0],v=p[g],y;if(ap(m,v)){if(!m[2]&&!v[2]){for(r.lineStart(),s=0;s<g;++s)r.point((m=p[s])[0],m[1]);r.lineEnd();return}v[0]+=2*ie}a.push(y=new op(m,p,null,!0)),o.push(y.o=new op(m,null,y,!1)),a.push(y=new op(v,p,null,!1)),o.push(y.o=new op(v,null,y,!0))}),!a.length)return;for(o.sort(t),R$(a),R$(o),s=0,l=o.length;s<l;++s)o[s].e=n=!n;for(var u=a[0],c,f;;){for(var d=u,h=!0;d.v;)if((d=d.n)===u)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,l=c.length;s<l;++s)r.point((f=c[s])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)r.point((f=c[s])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}function R$(e){if(!(t=e.length))return;for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}var a1=Co();function o1(e){return ye(e[0])<=de?e[0]:Jn(e[0])*((ye(e[0])+de)%Xt-de)}function qG(e,t){var n=o1(t),i=t[1],r=te(i),a=[te(n),-re(n),0],o=0,s=0;a1.reset(),r===1?i=Ye+ie:r===-1&&(i=-Ye-ie);for(var l=0,u=e.length;l<u;++l){if(!(f=(c=e[l]).length))continue;for(var c,f,d=c[f-1],h=o1(d),p=d[1]/2+Uh,g=te(p),m=re(p),v=0;v<f;++v,h=b,g=x,m=k,d=y){var y=c[v],b=o1(y),E=y[1]/2+Uh,x=te(E),k=re(E),w=b-h,A=w>=0?1:-1,_=A*w,O=_>de,S=g*x;if(a1.add(Xn(S*A*te(_),m*k+S*re(_))),o+=O?w+A*Xt:w,O^h>=n^b>=n){var T=sl($o(d),$o(y));Kh(T);var D=sl(a,T);Kh(D);var M=(O^w>=0?-1:1)*yn(D[2]);(i>M||i===M&&(T[0]||T[1]))&&(s+=O^w>=0?1:-1)}}}return(o<-ie||o<ie&&a1<-ie)^s&1}function F$(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function WG(e){return e.length===1&&(e=GG(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function GG(e){return function(t,n){return F$(e(t),n)}}var Nde=WG(F$);function ul(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}function N$(e){for(var t=e.length,n,i=-1,r=0,a,o;++i<t;)r+=e[i].length;for(a=new Array(r);--t>=0;)for(o=e[t],n=o.length;--n>=0;)a[--r]=o[n];return a}function I$(e,t,n,i){return function(r){var a=t(r),o=$$(),s=t(o),l=!1,u,c,f,d={point:h,lineStart:g,lineEnd:m,polygonStart:function(){d.point=v,d.lineStart=y,d.lineEnd=b,c=[],u=[]},polygonEnd:function(){d.point=h,d.lineStart=g,d.lineEnd=m,c=N$(c);var E=qG(u,i);c.length?(l||(r.polygonStart(),l=!0),D$(c,YG,E,n,r)):E&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),c=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(E,x){e(E,x)&&r.point(E,x)}function p(E,x){a.point(E,x)}function g(){d.point=p,a.lineStart()}function m(){d.point=h,a.lineEnd()}function v(E,x){f.push([E,x]),s.point(E,x)}function y(){s.lineStart(),f=[]}function b(){v(f[0][0],f[0][1]),s.lineEnd();var E=s.clean(),x=o.result(),k,w=x.length,A,_,O;if(f.pop(),u.push(f),f=null,!w)return;if(E&1){if(_=x[0],(A=_.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),k=0;k<A;++k)r.point((O=_[k])[0],O[1]);r.lineEnd()}return}w>1&&E&2&&x.push(x.pop().concat(x.shift())),c.push(x.filter(HG))}return d}}function HG(e){return e.length>1}function YG(e,t){return((e=e.x)[0]<0?e[1]-Ye-ie:Ye-e[1])-((t=t.x)[0]<0?t[1]-Ye-ie:Ye-t[1])}var M$=I$(function(){return!0},VG,JG,[-de,-Ye]);function VG(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(a,o){var s=a>0?de:-de,l=ye(a-t);ye(l-de)<ie?(e.point(t,n=(n+o)/2>0?Ye:-Ye),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),r=0):i!==s&&l>=de&&(ye(t-i)<ie&&(t-=i*ie),ye(a-s)<ie&&(a-=s*ie),n=XG(t,n,a,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),r=0),e.point(t=a,n=o),i=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function XG(e,t,n,i){var r,a,o=te(e-n);return ye(o)>ie?ol((te(t)*(a=re(i))*te(n)-te(i)*(r=re(t))*te(e))/(r*a*o)):(t+i)/2}function JG(e,t,n,i){var r;if(e==null)r=n*Ye,i.point(-de,r),i.point(0,r),i.point(de,r),i.point(de,0),i.point(de,-r),i.point(0,-r),i.point(-de,-r),i.point(-de,0),i.point(-de,r);else if(ye(e[0]-t[0])>ie){var a=e[0]<t[0]?de:-de;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function KG(e){var t=re(e),n=6*he,i=t>0,r=ye(t)>ie;function a(c,f,d,h){UG(h,e,n,d,c,f)}function o(c,f){return re(c)*re(f)>t}function s(c){var f,d,h,p,g;return{lineStart:function(){p=h=!1,g=1},point:function(m,v){var y=[m,v],b,E=o(m,v),x=i?E?0:u(m,v):E?u(m+(m<0?de:-de),v):0;if(!f&&(p=h=E)&&c.lineStart(),E!==h&&(b=l(f,y),(!b||ap(f,b)||ap(y,b))&&(y[2]=1)),E!==h)g=0,E?(c.lineStart(),b=l(y,f),c.point(b[0],b[1])):(b=l(f,y),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(r&&f&&i^E){var k;!(x&d)&&(k=l(y,f,!0))&&(g=0,i?(c.lineStart(),c.point(k[0][0],k[0][1]),c.point(k[1][0],k[1][1]),c.lineEnd()):(c.point(k[1][0],k[1][1]),c.lineEnd(),c.lineStart(),c.point(k[0][0],k[0][1],3)))}E&&(!f||!ap(f,y))&&c.point(y[0],y[1]),f=y,h=E,d=x},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return g|(p&&h)<<1}}}function l(c,f,d){var h=$o(c),p=$o(f),g=[1,0,0],m=sl(h,p),v=Xh(m,m),y=m[0],b=v-y*y;if(!b)return!d&&c;var E=t*v/b,x=-t*y/b,k=sl(g,m),w=Jh(g,E),A=Jh(m,x);Kb(w,A);var _=k,O=Xh(w,_),S=Xh(_,_),T=O*O-S*(Xh(w,w)-1);if(T<0)return;var D=Ot(T),M=Jh(_,(-O-D)/S);if(Kb(M,w),M=Vh(M),!d)return M;var C=c[0],N=f[0],W=c[1],X=f[1],J;N<C&&(J=C,C=N,N=J);var xe=N-C,Le=ye(xe-de)<ie,ft=Le||xe<ie;if(!Le&&X<W&&(J=W,W=X,X=J),ft?Le?W+X>0^M[1]<(ye(M[0]-C)<ie?W:X):W<=M[1]&&M[1]<=X:xe>de^(C<=M[0]&&M[0]<=N)){var dt=Jh(_,(-O+D)/S);return Kb(dt,w),[M,Vh(dt)]}}function u(c,f){var d=i?e:de-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return I$(o,s,a,i?[0,-e]:[-de,e-de])}function QG(e,t,n,i,r,a){var o=e[0],s=e[1],l=t[0],u=t[1],c=0,f=1,d=l-o,h=u-s,p;if(p=n-o,!d&&p>0)return;if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=r-o,!d&&p<0)return;if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}if(p=i-s,!h&&p>0)return;if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=a-s,!h&&p<0)return;if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*d,e[1]=s+c*h),f<1&&(t[0]=o+f*d,t[1]=s+f*h),!0}var nc=1e9,sp=-nc;function j$(e,t,n,i){function r(u,c){return e<=u&&u<=n&&t<=c&&c<=i}function a(u,c,f,d){var h=0,p=0;if(u==null||(h=o(u,f))!==(p=o(c,f))||l(u,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==p);else d.point(c[0],c[1])}function o(u,c){return ye(u[0]-e)<ie?c>0?0:3:ye(u[0]-n)<ie?c>0?2:1:ye(u[1]-t)<ie?c>0?1:0:c>0?3:2}function s(u,c){return l(u.x,c.x)}function l(u,c){var f=o(u,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-u[1]:f===1?u[0]-c[0]:f===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,f=$$(),d,h,p,g,m,v,y,b,E,x,k,w={point:A,lineStart:T,lineEnd:D,polygonStart:O,polygonEnd:S};function A(C,N){r(C,N)&&c.point(C,N)}function _(){for(var C=0,N=0,W=h.length;N<W;++N)for(var X=h[N],J=1,xe=X.length,Le=X[0],ft,dt,Je=Le[0],Dt=Le[1];J<xe;++J)ft=Je,dt=Dt,Le=X[J],Je=Le[0],Dt=Le[1],dt<=i?Dt>i&&(Je-ft)*(i-dt)>(Dt-dt)*(e-ft)&&++C:Dt<=i&&(Je-ft)*(i-dt)<(Dt-dt)*(e-ft)&&--C;return C}function O(){c=f,d=[],h=[],k=!0}function S(){var C=_(),N=k&&C,W=(d=N$(d)).length;(N||W)&&(u.polygonStart(),N&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),W&&D$(d,s,C,a,u),u.polygonEnd()),c=u,d=h=p=null}function T(){w.point=M,h&&h.push(p=[]),x=!0,E=!1,y=b=NaN}function D(){d&&(M(g,m),v&&E&&f.rejoin(),d.push(f.result())),w.point=A,E&&c.lineEnd()}function M(C,N){var W=r(C,N);if(h&&p.push([C,N]),x)g=C,m=N,v=W,x=!1,W&&(c.lineStart(),c.point(C,N));else if(W&&E)c.point(C,N);else{var X=[y=Math.max(sp,Math.min(nc,y)),b=Math.max(sp,Math.min(nc,b))],J=[C=Math.max(sp,Math.min(nc,C)),N=Math.max(sp,Math.min(nc,N))];QG(X,J,e,t,n,i)?(E||(c.lineStart(),c.point(X[0],X[1])),c.point(J[0],J[1]),W||c.lineEnd(),k=!1):W&&(c.lineStart(),c.point(C,N),k=!1)}y=C,b=N,E=W}return w}}function L$(e,t,n){var i=ul(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[r,a]})}}function P$(e,t,n){var i=ul(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[a,r]})}}function ZG(){var e,t,n,i,r,a,o,s,l=10,u=l,c=90,f=360,d,h,p,g,m=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return ul(qh(i/c)*c,n,c).map(p).concat(ul(qh(s/f)*f,o,f).map(g)).concat(ul(qh(t/l)*l,e,l).filter(function(b){return ye(b%c)>ie}).map(d)).concat(ul(qh(a/u)*u,r,u).filter(function(b){return ye(b%f)>ie}).map(h))}return v.lines=function(){return y().map(function(b){return{type:"LineString",coordinates:b}})},v.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(g(o).slice(1),p(n).reverse().slice(1),g(s).reverse().slice(1))]}},v.extent=function(b){return arguments.length?v.extentMajor(b).extentMinor(b):v.extentMinor()},v.extentMajor=function(b){return arguments.length?(i=+b[0][0],n=+b[1][0],s=+b[0][1],o=+b[1][1],i>n&&(b=i,i=n,n=b),s>o&&(b=s,s=o,o=b),v.precision(m)):[[i,s],[n,o]]},v.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],a=+b[0][1],r=+b[1][1],t>e&&(b=t,t=e,e=b),a>r&&(b=a,a=r,r=b),v.precision(m)):[[t,a],[e,r]]},v.step=function(b){return arguments.length?v.stepMajor(b).stepMinor(b):v.stepMinor()},v.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],v):[c,f]},v.stepMinor=function(b){return arguments.length?(l=+b[0],u=+b[1],v):[l,u]},v.precision=function(b){return arguments.length?(m=+b,d=L$(a,r,90),h=P$(t,e,m),p=L$(s,o,90),g=P$(i,n,m),v):m},v.extentMajor([[-180,-90+ie],[180,90-ie]]).extentMinor([[-180,-80-ie],[180,80+ie]])}function ic(e){return e}var s1=Co(),l1=Co(),z$,B$,u1,c1,$r={point:Tt,lineStart:Tt,lineEnd:Tt,polygonStart:function(){$r.lineStart=eH,$r.lineEnd=nH},polygonEnd:function(){$r.lineStart=$r.lineEnd=$r.point=Tt,s1.add(ye(l1)),l1.reset()},result:function(){var e=s1/2;return s1.reset(),e}};function eH(){$r.point=tH}function tH(e,t){$r.point=U$,z$=u1=e,B$=c1=t}function U$(e,t){l1.add(c1*e-u1*t),u1=e,c1=t}function nH(){U$(z$,B$)}var cl=Infinity,lp=cl,rc=-cl,up=rc,cp={point:iH,lineStart:Tt,lineEnd:Tt,polygonStart:Tt,polygonEnd:Tt,result:function(){var e=[[cl,lp],[rc,up]];return rc=up=-(lp=cl=Infinity),e}};function iH(e,t){e<cl&&(cl=e),e>rc&&(rc=e),t<lp&&(lp=t),t>up&&(up=t)}var f1=0,d1=0,ac=0,fp=0,dp=0,fl=0,h1=0,p1=0,oc=0,q$,W$,Hi,Yi,Kn={point:Ro,lineStart:G$,lineEnd:H$,polygonStart:function(){Kn.lineStart=oH,Kn.lineEnd=sH},polygonEnd:function(){Kn.point=Ro,Kn.lineStart=G$,Kn.lineEnd=H$},result:function(){var e=oc?[h1/oc,p1/oc]:fl?[fp/fl,dp/fl]:ac?[f1/ac,d1/ac]:[NaN,NaN];return f1=d1=ac=fp=dp=fl=h1=p1=oc=0,e}};function Ro(e,t){f1+=e,d1+=t,++ac}function G$(){Kn.point=rH}function rH(e,t){Kn.point=aH,Ro(Hi=e,Yi=t)}function aH(e,t){var n=e-Hi,i=t-Yi,r=Ot(n*n+i*i);fp+=r*(Hi+e)/2,dp+=r*(Yi+t)/2,fl+=r,Ro(Hi=e,Yi=t)}function H$(){Kn.point=Ro}function oH(){Kn.point=lH}function sH(){Y$(q$,W$)}function lH(e,t){Kn.point=Y$,Ro(q$=Hi=e,W$=Yi=t)}function Y$(e,t){var n=e-Hi,i=t-Yi,r=Ot(n*n+i*i);fp+=r*(Hi+e)/2,dp+=r*(Yi+t)/2,fl+=r,r=Yi*e-Hi*t,h1+=r*(Hi+e),p1+=r*(Yi+t),oc+=r*3,Ro(Hi=e,Yi=t)}function V$(e){this._context=e}V$.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Xt);break}}},result:Tt};var g1=Co(),m1,X$,J$,sc,lc,uc={point:Tt,lineStart:function(){uc.point=uH},lineEnd:function(){m1&&K$(X$,J$),uc.point=Tt},polygonStart:function(){m1=!0},polygonEnd:function(){m1=null},result:function(){var e=+g1;return g1.reset(),e}};function uH(e,t){uc.point=K$,X$=sc=e,J$=lc=t}function K$(e,t){sc-=e,lc-=t,g1.add(Ot(sc*sc+lc*lc)),sc=e,lc=t}function Q$(){this._string=[]}Q$.prototype={_radius:4.5,_circle:Z$(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=Z$(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function Z$(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function eD(e,t){var n=4.5,i,r;function a(o){return o&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Or(o,i(r))),r.result()}return a.area=function(o){return Or(o,i($r)),$r.result()},a.measure=function(o){return Or(o,i(uc)),uc.result()},a.bounds=function(o){return Or(o,i(cp)),cp.result()},a.centroid=function(o){return Or(o,i(Kn)),Kn.result()},a.projection=function(o){return arguments.length?(i=o==null?(e=null,ic):(e=o).stream,a):e},a.context=function(o){return arguments.length?(r=o==null?(t=null,new Q$()):new V$(t=o),typeof n!="function"&&r.pointRadius(n),a):t},a.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(r.pointRadius(+o),+o),a):n},a.projection(e).context(t)}function hp(e){return function(t){var n=new v1();for(var i in e)n[i]=e[i];return n.stream=t,n}}function v1(){}v1.prototype={constructor:v1,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function y1(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Or(n,e.stream(cp)),t(cp.result()),i!=null&&e.clipExtent(i),e}function pp(e,t,n){return y1(e,function(i){var r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),a/(i[1][1]-i[0][1])),s=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(a-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([s,l])},n)}function b1(e,t,n){return pp(e,[[0,0],t],n)}function w1(e,t,n){return y1(e,function(i){var r=+t,a=r/(i[1][0]-i[0][0]),o=(r-a*(i[1][0]+i[0][0]))/2,s=-a*i[0][1];e.scale(150*a).translate([o,s])},n)}function x1(e,t,n){return y1(e,function(i){var r=+t,a=r/(i[1][1]-i[0][1]),o=-a*i[0][0],s=(r-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var tD=16,cH=re(30*he);function nD(e,t){return+t?dH(e,t):fH(e)}function fH(e){return hp({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function dH(e,t){function n(i,r,a,o,s,l,u,c,f,d,h,p,g,m){var v=u-i,y=c-r,b=v*v+y*y;if(b>4*t&&g--){var E=o+d,x=s+h,k=l+p,w=Ot(E*E+x*x+k*k),A=yn(k/=w),_=ye(ye(k)-1)<ie||ye(a-f)<ie?(a+f)/2:Xn(x,E),O=e(_,A),S=O[0],T=O[1],D=S-i,M=T-r,C=y*D-v*M;(C*C/b>t||ye((v*D+y*M)/b-.5)>.3||o*d+s*h+l*p<cH)&&(n(i,r,a,o,s,l,S,T,_,E/=w,x/=w,k,g,m),m.point(S,T),n(S,T,_,E,x,k,u,c,f,d,h,p,g,m))}}return function(i){var r,a,o,s,l,u,c,f,d,h,p,g,m={point:v,lineStart:y,lineEnd:E,polygonStart:function(){i.polygonStart(),m.lineStart=x},polygonEnd:function(){i.polygonEnd(),m.lineStart=y}};function v(A,_){A=e(A,_),i.point(A[0],A[1])}function y(){f=NaN,m.point=b,i.lineStart()}function b(A,_){var O=$o([A,_]),S=e(A,_);n(f,d,c,h,p,g,f=S[0],d=S[1],c=A,h=O[0],p=O[1],g=O[2],tD,i),i.point(f,d)}function E(){m.point=v,i.lineEnd()}function x(){y(),m.point=k,m.lineEnd=w}function k(A,_){b(r=A,_),a=f,o=d,s=h,l=p,u=g,m.point=b}function w(){n(f,d,c,h,p,g,a,o,r,s,l,u,tD,i),m.lineEnd=E,E()}return m}}var hH=hp({point:function(e,t){this.stream.point(e*he,t*he)}});function pH(e){return hp({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function gH(e,t,n,i,r){function a(o,s){return o*=i,s*=r,[t+e*o,n-e*s]}return a.invert=function(o,s){return[(o-t)/e*i,(n-s)/e*r]},a}function iD(e,t,n,i,r,a){var o=re(a),s=te(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(g,m){return g*=i,m*=r,[l*g-u*m+t,n-u*g-l*m]}return p.invert=function(g,m){return[i*(c*g-f*m+d),r*(h-f*g-c*m)]},p}function Vi(e){return rD(function(){return e})()}function rD(e){var t,n=150,i=480,r=250,a=0,o=0,s=0,l=0,u=0,c,f=0,d=1,h=1,p=null,g=M$,m=null,v,y,b,E=ic,x=.5,k,w,A,_,O;function S(C){return A(C[0]*he,C[1]*he)}function T(C){return C=A.invert(C[0],C[1]),C&&[C[0]*et,C[1]*et]}S.stream=function(C){return _&&O===C?_:_=hH(pH(c)(g(k(E(O=C)))))},S.preclip=function(C){return arguments.length?(g=C,p=void 0,M()):g},S.postclip=function(C){return arguments.length?(E=C,m=v=y=b=null,M()):E},S.clipAngle=function(C){return arguments.length?(g=+C?KG(p=C*he):(p=null,M$),M()):p*et},S.clipExtent=function(C){return arguments.length?(E=C==null?(m=v=y=b=null,ic):j$(m=+C[0][0],v=+C[0][1],y=+C[1][0],b=+C[1][1]),M()):m==null?null:[[m,v],[y,b]]},S.scale=function(C){return arguments.length?(n=+C,D()):n},S.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],D()):[i,r]},S.center=function(C){return arguments.length?(a=C[0]%360*he,o=C[1]%360*he,D()):[a*et,o*et]},S.rotate=function(C){return arguments.length?(s=C[0]%360*he,l=C[1]%360*he,u=C.length>2?C[2]%360*he:0,D()):[s*et,l*et,u*et]},S.angle=function(C){return arguments.length?(f=C%360*he,D()):f*et},S.reflectX=function(C){return arguments.length?(d=C?-1:1,D()):d<0},S.reflectY=function(C){return arguments.length?(h=C?-1:1,D()):h<0},S.precision=function(C){return arguments.length?(k=nD(w,x=C*C),M()):Ot(x)},S.fitExtent=function(C,N){return pp(S,C,N)},S.fitSize=function(C,N){return b1(S,C,N)},S.fitWidth=function(C,N){return w1(S,C,N)},S.fitHeight=function(C,N){return x1(S,C,N)};function D(){var C=iD(n,0,0,d,h,f).apply(null,t(a,o)),N=(f?iD:gH)(n,i-C[0],r-C[1],d,h,f);return c=A$(s,l,u),w=i1(t,N),A=i1(c,w),k=nD(w,x),M()}function M(){return _=O=null,S}return function(){return t=e.apply(this,arguments),S.invert=t.invert&&T,D()}}function E1(e){var t=0,n=de/3,i=rD(e),r=i(t,n);return r.parallels=function(a){return arguments.length?i(t=a[0]*he,n=a[1]*he):[t*et,n*et]},r}function mH(e){var t=re(e);function n(i,r){return[i*t,te(r)/t]}return n.invert=function(i,r){return[i/t,yn(r*t)]},n}function vH(e,t){var n=te(e),i=(n+te(t))/2;if(ye(i)<ie)return mH(e);var r=1+n*(2*i-n),a=Ot(r)/i;function o(s,l){var u=Ot(r-2*i*te(l))/i;return[u*te(s*=i),a-u*re(s)]}return o.invert=function(s,l){var u=a-l,c=Xn(s,ye(u))*Jn(u);return u*i<0&&(c-=de*Jn(s)*Jn(u)),[c/i,yn((r-(s*s+u*u)*i*i)/(2*i))]},o}function gp(){return E1(vH).scale(155.424).center([0,33.6442])}function aD(){return gp().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function yH(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function bH(){var e,t,n=aD(),i,r=gp().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=gp().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,l,u={point:function(d,h){l=[d,h]}};function c(d){var h=d[0],p=d[1];return l=null,(i.point(h,p),l)||(a.point(h,p),l)||(s.point(h,p),l)}c.invert=function(d){var h=n.scale(),p=n.translate(),g=(d[0]-p[0])/h,m=(d[1]-p[1])/h;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=yH([n.stream(t=d),r.stream(d),o.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),o.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),o.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],g=+d[1];return i=n.translate(d).clipExtent([[p-.455*h,g-.238*h],[p+.455*h,g+.238*h]]).stream(u),a=r.translate([p-.307*h,g+.201*h]).clipExtent([[p-.425*h+ie,g+.12*h+ie],[p-.214*h-ie,g+.234*h-ie]]).stream(u),s=o.translate([p-.205*h,g+.212*h]).clipExtent([[p-.214*h+ie,g+.166*h+ie],[p-.115*h-ie,g+.234*h-ie]]).stream(u),f()},c.fitExtent=function(d,h){return pp(c,d,h)},c.fitSize=function(d,h){return b1(c,d,h)},c.fitWidth=function(d,h){return w1(c,d,h)},c.fitHeight=function(d,h){return x1(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function oD(e){return function(t,n){var i=re(t),r=re(n),a=e(i*r);return[a*r*te(t),a*te(n)]}}function cc(e){return function(t,n){var i=Ot(t*t+n*n),r=e(i),a=te(r),o=re(r);return[Xn(t*a,i*o),yn(i&&n*a/i)]}}var sD=oD(function(e){return Ot(2/(1+e))});sD.invert=cc(function(e){return 2*yn(e/2)});function wH(){return Vi(sD).scale(124.75).clipAngle(180-.001)}var lD=oD(function(e){return(e=o$(e))&&e/te(e)});lD.invert=cc(function(e){return e});function xH(){return Vi(lD).scale(79.4188).clipAngle(180-.001)}function mp(e,t){return[e,Wh(Hb((Ye+t)/2))]}mp.invert=function(e,t){return[e,2*ol(a$(t))-Ye]};function EH(){return uD(mp).scale(961/Xt)}function uD(e){var t=Vi(e),n=t.center,i=t.scale,r=t.translate,a=t.clipExtent,o=null,s,l,u;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=s=l=u=null:(o=+f[0][0],s=+f[0][1],l=+f[1][0],u=+f[1][1]),c()):o==null?null:[[o,s],[l,u]]};function c(){var f=de*i(),d=t(BG(t.rotate()).invert([0,0]));return a(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===mp?[[Math.max(d[0]-f,o),s],[Math.min(d[0]+f,l),u]]:[[o,Math.max(d[1]-f,s)],[l,Math.min(d[1]+f,u)]])}return c()}function vp(e){return Hb((Ye+e)/2)}function kH(e,t){var n=re(e),i=e===t?te(e):Wh(n/re(t))/Wh(vp(t)/vp(e)),r=n*Gb(vp(e),i)/i;if(!i)return mp;function a(o,s){r>0?s<-Ye+ie&&(s=-Ye+ie):s>Ye-ie&&(s=Ye-ie);var l=r/Gb(vp(s),i);return[l*te(i*o),r-l*re(i*o)]}return a.invert=function(o,s){var l=r-s,u=Jn(i)*Ot(o*o+l*l),c=Xn(o,ye(l))*Jn(l);return l*i<0&&(c-=de*Jn(o)*Jn(l)),[c/i,2*ol(Gb(r/u,1/i))-Ye]},a}function _H(){return E1(kH).scale(109.5).parallels([30,30])}function yp(e,t){return[e,t]}yp.invert=yp;function AH(){return Vi(yp).scale(152.63)}function SH(e,t){var n=re(e),i=e===t?te(e):(n-re(t))/(t-e),r=n/i+e;if(ye(i)<ie)return yp;function a(o,s){var l=r-s,u=i*o;return[l*te(u),r-l*re(u)]}return a.invert=function(o,s){var l=r-s,u=Xn(o,ye(l))*Jn(l);return l*i<0&&(u-=de*Jn(o)*Jn(l)),[u/i,r-Jn(i)*Ot(o*o+l*l)]},a}function OH(){return E1(SH).scale(131.154).center([0,13.9389])}var fc=1.340264,dc=-.081106,hc=893e-6,pc=.003796,bp=Ot(3)/2,TH=12;function cD(e,t){var n=yn(bp*te(t)),i=n*n,r=i*i*i;return[e*re(n)/(bp*(fc+3*dc*i+r*(7*hc+9*pc*i))),n*(fc+dc*i+r*(hc+pc*i))]}cD.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,a=0,o,s,l;a<TH&&!(s=n*(fc+dc*i+r*(hc+pc*i))-t,l=fc+3*dc*i+r*(7*hc+9*pc*i),n-=o=s/l,i=n*n,r=i*i*i,ye(o)<Wb);++a);return[bp*e*(fc+3*dc*i+r*(7*hc+9*pc*i))/re(n),yn(te(n)/bp)]};function CH(){return Vi(cD).scale(177.158)}function fD(e,t){var n=re(t),i=re(e)*n;return[n*te(e)/i,te(t)/i]}fD.invert=cc(ol);function $H(){return Vi(fD).scale(144.049).clipAngle(60)}function DH(){var e=1,t=0,n=0,i=1,r=1,a=0,o,s,l=null,u,c,f,d=1,h=1,p=hp({point:function(E,x){var k=b([E,x]);this.stream.point(k[0],k[1])}}),g=ic,m,v;function y(){return d=e*i,h=e*r,m=v=null,b}function b(E){var x=E[0]*d,k=E[1]*h;if(a){var w=k*o-x*s;x=x*o+k*s,k=w}return[x+t,k+n]}return b.invert=function(E){var x=E[0]-t,k=E[1]-n;if(a){var w=k*o+x*s;x=x*o-k*s,k=w}return[x/d,k/h]},b.stream=function(E){return m&&v===E?m:m=p(g(v=E))},b.postclip=function(E){return arguments.length?(g=E,l=u=c=f=null,y()):g},b.clipExtent=function(E){return arguments.length?(g=E==null?(l=u=c=f=null,ic):j$(l=+E[0][0],u=+E[0][1],c=+E[1][0],f=+E[1][1]),y()):l==null?null:[[l,u],[c,f]]},b.scale=function(E){return arguments.length?(e=+E,y()):e},b.translate=function(E){return arguments.length?(t=+E[0],n=+E[1],y()):[t,n]},b.angle=function(E){return arguments.length?(a=E%360*he,s=te(a),o=re(a),y()):a*et},b.reflectX=function(E){return arguments.length?(i=E?-1:1,y()):i<0},b.reflectY=function(E){return arguments.length?(r=E?-1:1,y()):r<0},b.fitExtent=function(E,x){return pp(b,E,x)},b.fitSize=function(E,x){return b1(b,E,x)},b.fitWidth=function(E,x){return w1(b,E,x)},b.fitHeight=function(E,x){return x1(b,E,x)},b}function dD(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}dD.invert=function(e,t){var n=t,i=25,r;do{var a=n*n,o=a*a;n-=r=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(ye(r)>ie&&--i>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function RH(){return Vi(dD).scale(175.295)}function hD(e,t){return[re(t)*te(e),te(t)]}hD.invert=cc(yn);function FH(){return Vi(hD).scale(249.5).clipAngle(90+ie)}function pD(e,t){var n=re(t),i=1+re(e)*n;return[n*te(e)/i,te(t)/i]}pD.invert=cc(function(e){return 2*ol(e)});function NH(){return Vi(pD).scale(250).clipAngle(142)}function gD(e,t){return[Wh(Hb((Ye+t)/2)),-e]}gD.invert=function(e,t){return[-t,2*ol(a$(e))-Ye]};function IH(){var e=uD(gD),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var MH=Math.abs,k1=Math.cos,wp=Math.sin,jH=1e-6,mD=Math.PI,_1=mD/2,vD=LH(2);function yD(e){return e>1?_1:e<-1?-_1:Math.asin(e)}function LH(e){return e>0?Math.sqrt(e):0}function PH(e,t){var n=e*wp(t),i=30,r;do t-=r=(t+wp(t)-n)/(1+k1(t));while(MH(r)>jH&&--i>0);return t/2}function zH(e,t,n){function i(r,a){return[e*r*k1(a=PH(n,a)),t*wp(a)]}return i.invert=function(r,a){return a=yD(a/t),[r/(e*k1(a)),yD((2*a+wp(2*a))/n)]},i}var BH=zH(vD/_1,vD,mD);function UH(){return Vi(BH).scale(169.529)}var qH=eD(),A1=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function WH(e,t){return function n(){var i=t();return i.type=e,i.path=eD().projection(i),i.copy=i.copy||function(){var r=n();return A1.forEach(function(a){i[a]&&r[a](i[a]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function S1(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(xp[e]=WH(e,t),this):xp[e]||null}function bD(e){return e&&e.path||qH}var xp={albers:aD,albersusa:bH,azimuthalequalarea:wH,azimuthalequidistant:xH,conicconformal:_H,conicequalarea:gp,conicequidistant:OH,equalEarth:CH,equirectangular:AH,gnomonic:$H,identity:DH,mercator:EH,mollweide:UH,naturalEarth1:RH,orthographic:FH,stereographic:NH,transversemercator:IH};for(var wD in xp)S1(wD,xp[wD]);function O1(e){$.call(this,null,e)}O1.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};var GH=P(O1,$);GH.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||Ht,a=e.as||"path",o=n.SOURCE;function s(u){u[a]=i(r(u))}!i||e.modified()?(this.value=i=bD(e.projection),n.materialize().reflow()):o=r===Ht||t.modified(r.fields)?n.ADD_MOD:n.ADD;var l=HH(i,e.pointRadius);return n.visit(o,s),i.pointRadius(l),n.modifies(a)};function HH(e,t){var n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function T1(e){$.call(this,null,e)}T1.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};var YH=P(T1,$);YH.transform=function(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],a=e.as||["x","y"],o=a[0],s=a[1],l;function u(c){var f=n([i(c),r(c)]);f?(c[o]=f[0],c[s]=f[1]):(c[o]=void 0,c[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(l=t.modified(i.fields)||t.modified(r.fields),t.visit(l?t.ADD_MOD:t.ADD,u)),t.modifies(a)};function C1(e){$.call(this,null,e)}C1.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};var VH=P(C1,$);VH.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",a=n.ADD;return(!i||e.modified())&&(this.value=i=XH(bD(e.projection),e.field||Ri("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,function(o){o[r]=i}),n.modifies(r)};function XH(e,t,n){var i=n==null?function(r){return e(t(r))}:function(r){var a=e.pointRadius(),o=e.pointRadius(n)(t(r));return e.pointRadius(a),o};return i.context=function(r){return e.context(r),i},i}function $1(e){$.call(this,[],e),this.generator=ZG()}$1.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var JH=P($1,$);JH.transform=function(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(var a in e)ge(i[a])&&i[a](e[a]);return r=i(),n.length?t.mod.push(vk(n[0],r)):t.add.push(ke(r)),n[0]=r,t};function D1(e){$.call(this,null,e)}D1.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};var KH=P(D1,$);KH.transform=function(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||Ht,a=ZH(e.opacity,e),o=QH(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:i?lo(n.map(u=>lo(r(u).values))):0};return n.forEach(u=>{const c=r(u),f=fe({},u,l);i||(f.$max=lo(c.values||[])),u[s]=eY(c,f,o.dep?o:Yt(o(f)),a.dep?a:Yt(a(f)))}),t.reflow(!0).modifies(s)};function QH(e,t){let n;return ge(e)?(n=i=>va(e(i,t)),n.dep=xD(e)):n=Yt(va(e||"#888")),n}function ZH(e,t){let n;return ge(e)?(n=i=>e(i,t),n.dep=xD(e)):e?n=Yt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function xD(e){if(!ge(e))return!1;const t=Et(Gt(e));return t.$x||t.$y||t.$value||t.$max}function eY(e,t,n,i){const r=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||r,u=e.y2||a,c=e.values,f=c?m=>c[m]:eo,d=Su(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),g=p.data;for(let m=s,v=0;m<u;++m){t.$y=m-s;for(let y=o,b=m*r;y<l;++y,v+=4){t.$x=y-o,t.$value=f(y+b);const E=n(t);g[v+0]=E.r,g[v+1]=E.g,g[v+2]=E.b,g[v+3]=~~(255*i(t))}}return h.putImageData(p,0,0),d}function ED(e){$.call(this,null,e),this.modified(!0)}var tY=P(ED,$);tY.transform=function(e,t){var n=this.value;return!n||e.modified("type")?(this.value=n=iY(e.type),A1.forEach(function(i){e[i]!=null&&kD(n,i,e[i])})):A1.forEach(function(i){e.modified(i)&&kD(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&nY(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function nY(e,t){var n=rY(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function iY(e){var t=S1((e||"mercator").toLowerCase());return t||F("Unrecognized projection type: "+e),t()}function kD(e,t,n){ge(e[t])&&e[t](n)}function rY(e){return e=G(e),e.length===1?e[0]:{type:Ub,features:e.reduce((t,n)=>t.concat(aY(n)),[])}}function aY(e){return e.type===Ub?e.features:G(e).filter(t=>t!=null).map(t=>t.type===Bb?t:{type:Bb,geometry:t})}var oY=Object.freeze({__proto__:null,contour:zb,geojson:qb,geopath:O1,geopoint:T1,geoshape:C1,graticule:$1,heatmap:D1,isocontour:jb,kde2d:Pb,projection:ED});function sY(e,t){var n;e==null&&(e=0),t==null&&(t=0);function i(){var r,a=n.length,o,s=0,l=0;for(r=0;r<a;++r)o=n[r],s+=o.x,l+=o.y;for(s=s/a-e,l=l/a-t,r=0;r<a;++r)o=n[r],o.x-=s,o.y-=l}return i.initialize=function(r){n=r},i.x=function(r){return arguments.length?(e=+r,i):e},i.y=function(r){return arguments.length?(t=+r,i):t},i}function lY(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return _D(this.cover(t,n),t,n,e)}function _D(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,a=e._root,o={data:i},s=e._x0,l=e._y0,u=e._x1,c=e._y1,f,d,h,p,g,m,v,y;if(!a)return e._root=o,e;for(;a.length;)if((g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d,r=a,!(a=a[v=m<<1|g]))return r[v]=o,e;if(h=+e._x.call(null,a.data),p=+e._y.call(null,a.data),t===h&&n===p)return o.next=a,r?r[v]=o:e._root=o,e;do r=r?r[v]=new Array(4):e._root=new Array(4),(g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d;while((v=m<<1|g)===(y=(p>=d)<<1|h>=f));return r[y]=a,r[v]=o,e}function uY(e){var t,n,i=e.length,r,a,o=new Array(i),s=new Array(i),l=Infinity,u=Infinity,c=-Infinity,f=-Infinity;for(n=0;n<i;++n){if(isNaN(r=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=r,s[n]=a,r<l&&(l=r),r>c&&(c=r),a<u&&(u=a),a>f&&(f=a)}if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<i;++n)_D(this,o[n],s[n],e[n]);return this}function cY(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,a=(i=Math.floor(t))+1;else{for(var o=r-n,s=this._root,l,u;n>e||e>=r||i>t||t>=a;){u=(t<i)<<1|e<n,l=new Array(4),l[u]=s,s=l,o*=2;switch(u){case 0:r=n+o,a=i+o;break;case 1:n=r-o,a=i+o;break;case 2:r=n+o,i=a-o;break;case 3:n=r-o,i=a-o;break}}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this}function fY(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function dY(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Zt(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function hY(e,t,n){var i,r=this._x0,a=this._y0,o,s,l,u,c=this._x1,f=this._y1,d=[],h=this._root,p,g;for(h&&d.push(new Zt(h,r,a,c,f)),n==null?n=Infinity:(r=e-n,a=t-n,c=e+n,f=t+n,n*=n);p=d.pop();){if(!(h=p.node)||(o=p.x0)>c||(s=p.y0)>f||(l=p.x1)<r||(u=p.y1)<a)continue;if(h.length){var m=(o+l)/2,v=(s+u)/2;d.push(new Zt(h[3],m,v,l,u),new Zt(h[2],o,v,m,u),new Zt(h[1],m,s,l,v),new Zt(h[0],o,s,m,v)),(g=(t>=v)<<1|e>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var y=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),E=y*y+b*b;if(E<n){var x=Math.sqrt(n=E);r=e-x,a=t-x,c=e+x,f=t+x,i=h.data}}}return i}function pY(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,a,o=this._x0,s=this._y0,l=this._x1,u=this._y1,c,f,d,h,p,g,m,v;if(!n)return this;if(n.length)for(;;){if((p=c>=(d=(o+l)/2))?o=d:l=d,(g=f>=(h=(s+u)/2))?s=h:u=h,!(t=n,n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,v=m)}for(;n.data!==e;)if(!(r=n,n=n.next))return this;return(a=n.next)&&delete n.next,r?(a?r.next=a:delete r.next,this):t?(a?t[m]=a:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[v]=n:this._root=n),this):(this._root=a,this)}function gY(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function mY(){return this._root}function vY(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function yY(e){var t=[],n,i=this._root,r,a,o,s,l;for(i&&t.push(new Zt(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,a=n.x0,o=n.y0,s=n.x1,l=n.y1)&&i.length){var u=(a+s)/2,c=(o+l)/2;(r=i[3])&&t.push(new Zt(r,u,c,s,l)),(r=i[2])&&t.push(new Zt(r,a,c,u,l)),(r=i[1])&&t.push(new Zt(r,u,o,s,c)),(r=i[0])&&t.push(new Zt(r,a,o,u,c))}return this}function bY(e){var t=[],n=[],i;for(this._root&&t.push(new Zt(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var a,o=i.x0,s=i.y0,l=i.x1,u=i.y1,c=(o+l)/2,f=(s+u)/2;(a=r[0])&&t.push(new Zt(a,o,s,c,f)),(a=r[1])&&t.push(new Zt(a,c,s,l,f)),(a=r[2])&&t.push(new Zt(a,o,f,c,u)),(a=r[3])&&t.push(new Zt(a,c,f,l,u))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function wY(e){return e[0]}function xY(e){return arguments.length?(this._x=e,this):this._x}function EY(e){return e[1]}function kY(e){return arguments.length?(this._y=e,this):this._y}function R1(e,t,n){var i=new F1(t??wY,n??EY,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function F1(e,t,n,i,r,a){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function AD(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var en=R1.prototype=F1.prototype;en.copy=function(){var e=new F1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=AD(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=AD(i));return e},en.add=lY,en.addAll=uY,en.cover=cY,en.data=fY,en.extent=dY,en.find=hY,en.remove=pY,en.removeAll=gY,en.root=mY,en.size=vY,en.visit=yY,en.visitAfter=bY,en.x=xY,en.y=kY;function tn(e){return function(){return e}}function xa(){return(Math.random()-.5)*1e-6}function _Y(e){return e.x+e.vx}function AY(e){return e.y+e.vy}function SY(e){var t,n,i=1,r=1;typeof e!="function"&&(e=tn(e==null?1:+e));function a(){for(var l,u=t.length,c,f,d,h,p,g,m=0;m<r;++m)for(c=R1(t,_Y,AY).visitAfter(o),l=0;l<u;++l)f=t[l],p=n[f.index],g=p*p,d=f.x+f.vx,h=f.y+f.vy,c.visit(v);function v(y,b,E,x,k){var w=y.data,A=y.r,_=p+A;if(w){if(w.index>f.index){var O=d-w.x-w.vx,S=h-w.y-w.vy,T=O*O+S*S;T<_*_&&(O===0&&(O=xa(),T+=O*O),S===0&&(S=xa(),T+=S*S),T=(_-(T=Math.sqrt(T)))/T*i,f.vx+=(O*=T)*(_=(A*=A)/(g+A)),f.vy+=(S*=T)*_,w.vx-=O*(_=1-_),w.vy-=S*_)}return}return b>d+_||x<d-_||E>h+_||k<h-_}}function o(l){if(l.data)return l.r=n[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function s(){if(!t)return;var l,u=t.length,c;for(n=new Array(u),l=0;l<u;++l)c=t[l],n[c.index]=+e(c,l,t)}return a.initialize=function(l){t=l,s()},a.iterations=function(l){return arguments.length?(r=+l,a):r},a.strength=function(l){return arguments.length?(i=+l,a):i},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:tn(+l),s(),a):e},a}function OY(e){return e.index}function SD(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function TY(e){var t=OY,n=c,i,r=tn(30),a,o,s,l,u=1;e==null&&(e=[]);function c(g){return 1/Math.min(s[g.source.index],s[g.target.index])}function f(g){for(var m=0,v=e.length;m<u;++m)for(var y=0,b,E,x,k,w,A,_;y<v;++y)b=e[y],E=b.source,x=b.target,k=x.x+x.vx-E.x-E.vx||xa(),w=x.y+x.vy-E.y-E.vy||xa(),A=Math.sqrt(k*k+w*w),A=(A-a[y])/A*g*i[y],k*=A,w*=A,x.vx-=k*(_=l[y]),x.vy-=w*_,E.vx+=k*(_=1-_),E.vy+=w*_}function d(){if(!o)return;var g,m=o.length,v=e.length,y=new Map(o.map((E,x)=>[t(E,x,o),E])),b;for(g=0,s=new Array(m);g<v;++g)b=e[g],b.index=g,typeof b.source!="object"&&(b.source=SD(y,b.source)),typeof b.target!="object"&&(b.target=SD(y,b.target)),s[b.source.index]=(s[b.source.index]||0)+1,s[b.target.index]=(s[b.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)b=e[g],l[g]=s[b.source.index]/(s[b.source.index]+s[b.target.index]);i=new Array(v),h(),a=new Array(v),p()}function h(){if(!o)return;for(var g=0,m=e.length;g<m;++g)i[g]=+n(e[g],g,e)}function p(){if(!o)return;for(var g=0,m=e.length;g<m;++g)a[g]=+r(e[g],g,e)}return f.initialize=function(g){o=g,d()},f.links=function(g){return arguments.length?(e=g,d(),f):e},f.id=function(g){return arguments.length?(t=g,f):t},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:tn(+g),h(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:tn(+g),p(),f):r},f}var CY={value:function(){}};function OD(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Ep(n)}function Ep(e){this._=e}function $Y(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Ep.prototype=OD.prototype={constructor:Ep,on:function(e,t){var n=this._,i=$Y(e+"",n),r,a=-1,o=i.length;if(arguments.length<2){for(;++a<o;)if((r=(e=i[a]).type)&&(r=DY(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(r=(e=i[a]).type)n[r]=TD(n[r],e.name,t);else if(t==null)for(r in n)n[r]=TD(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ep(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,a;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],i=0,r=a.length;i<r;++i)a[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};function DY(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function TD(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=CY,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var dl=0,gc=0,mc=0,CD=1e3,kp,vc,_p=0,Fo=0,Ap=0,yc=typeof performance=="object"&&performance.now?performance:Date,$D=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function N1(){return Fo||($D(RY),Fo=yc.now()+Ap)}function RY(){Fo=0}function Sp(){this._call=this._time=this._next=null}Sp.prototype=DD.prototype={constructor:Sp,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?N1():+n)+(t==null?0:+t),!this._next&&vc!==this&&(vc?vc._next=this:kp=this,vc=this),this._call=e,this._time=n,I1()},stop:function(){this._call&&(this._call=null,this._time=Infinity,I1())}};function DD(e,t,n){var i=new Sp();return i.restart(e,t,n),i}function FY(){N1(),++dl;for(var e=kp,t;e;)(t=Fo-e._time)>=0&&e._call.call(null,t),e=e._next;--dl}function RD(){Fo=(_p=yc.now())+Ap,dl=gc=0;try{FY()}finally{dl=0,IY(),Fo=0}}function NY(){var e=yc.now(),t=e-_p;t>CD&&(Ap-=t,_p=e)}function IY(){for(var e,t=kp,n,i=Infinity;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:kp=n);vc=e,I1(i)}function I1(e){if(dl)return;gc&&(gc=clearTimeout(gc));var t=e-Fo;t>24?(e<Infinity&&(gc=setTimeout(RD,e-yc.now()-Ap)),mc&&(mc=clearInterval(mc))):(mc||(_p=yc.now(),mc=setInterval(NY,CD)),dl=1,$D(RD))}function MY(e,t,n){var i=new Sp(),r=t;return t==null?(i.restart(e,t,n),i):(t=+t,n=n==null?N1():+n,i.restart(function a(o){o+=r,i.restart(a,r+=t,n),e(o)},t,n),i)}function jY(e){return e.x}function LY(e){return e.y}var PY=10,zY=Math.PI*(3-Math.sqrt(5));function BY(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,o=.6,s=new Map(),l=DD(c),u=OD("tick","end");e==null&&(e=[]);function c(){f(),u.call("tick",t),n<i&&(l.stop(),u.call("end",t))}function f(p){var g,m=e.length,v;p===void 0&&(p=1);for(var y=0;y<p;++y)for(n+=(a-n)*r,s.forEach(function(b){b(n)}),g=0;g<m;++g)v=e[g],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return t}function d(){for(var p=0,g=e.length,m;p<g;++p){if(m=e[p],m.index=p,m.fx!=null&&(m.x=m.fx),m.fy!=null&&(m.y=m.fy),isNaN(m.x)||isNaN(m.y)){var v=PY*Math.sqrt(p),y=p*zY;m.x=v*Math.cos(y),m.y=v*Math.sin(y)}(isNaN(m.vx)||isNaN(m.vy))&&(m.vx=m.vy=0)}}function h(p){return p.initialize&&p.initialize(e),p}return d(),t={tick:f,restart:function(){return l.restart(c),t},stop:function(){return l.stop(),t},nodes:function(p){return arguments.length?(e=p,d(),s.forEach(h),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(a=+p,t):a},velocityDecay:function(p){return arguments.length?(o=1-p,t):1-o},force:function(p,g){return arguments.length>1?(g==null?s.delete(p):s.set(p,h(g)),t):s.get(p)},find:function(p,g,m){var v=0,y=e.length,b,E,x,k,w;for(m==null?m=Infinity:m*=m,v=0;v<y;++v)k=e[v],b=p-k.x,E=g-k.y,x=b*b+E*E,x<m&&(w=k,m=x);return w},on:function(p,g){return arguments.length>1?(u.on(p,g),t):u.on(p)}}}function UY(){var e,t,n,i=tn(-30),r,a=1,o=Infinity,s=.81;function l(d){var h,p=e.length,g=R1(e,jY,LY).visitAfter(c);for(n=d,h=0;h<p;++h)t=e[h],g.visit(f)}function u(){if(!e)return;var d,h=e.length,p;for(r=new Array(h),d=0;d<h;++d)p=e[d],r[p.index]=+i(p,d,e)}function c(d){var h=0,p,g,m=0,v,y,b;if(d.length){for(v=y=b=0;b<4;++b)(p=d[b])&&(g=Math.abs(p.value))&&(h+=p.value,m+=g,v+=g*p.x,y+=g*p.y);d.x=v/m,d.y=y/m}else{p=d,p.x=p.data.x,p.y=p.data.y;do h+=r[p.data.index];while(p=p.next)}d.value=h}function f(d,h,p,g){if(!d.value)return!0;var m=d.x-t.x,v=d.y-t.y,y=g-h,b=m*m+v*v;if(y*y/s<b)return b<o&&(m===0&&(m=xa(),b+=m*m),v===0&&(v=xa(),b+=v*v),b<a&&(b=Math.sqrt(a*b)),t.vx+=m*d.value*n/b,t.vy+=v*d.value*n/b),!0;if(d.length||b>=o)return;(d.data!==t||d.next)&&(m===0&&(m=xa(),b+=m*m),v===0&&(v=xa(),b+=v*v),b<a&&(b=Math.sqrt(a*b)));do d.data!==t&&(y=r[d.data.index]*n/b,t.vx+=m*y,t.vy+=v*y);while(d=d.next)}return l.initialize=function(d){e=d,u()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:tn(+d),u(),l):i},l.distanceMin=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.distanceMax=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.theta=function(d){return arguments.length?(s=d*d,l):Math.sqrt(s)},l}function qY(e){var t=tn(.1),n,i,r;typeof e!="function"&&(e=tn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vx+=(r[l]-c.x)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:tn(+s),o(),a):t},a.x=function(s){return arguments.length?(e=typeof s=="function"?s:tn(+s),o(),a):e},a}function WY(e){var t=tn(.1),n,i,r;typeof e!="function"&&(e=tn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vy+=(r[l]-c.y)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:tn(+s),o(),a):t},a.y=function(s){return arguments.length?(e=typeof s=="function"?s:tn(+s),o(),a):e},a}var FD={center:sY,collide:SY,nbody:UY,link:TY,x:qY,y:WY},bc="forces",M1=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],GY=["static","iterations"],ND=["x","y","vx","vy"];function j1(e){$.call(this,null,e)}j1.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:ND}]};var ID=P(j1,$);ID.transform=function(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(M1),a=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&MD(n,e,0,t)):(this.value=n=YY(t.source,e),n.on("tick",HY(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(GY)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},ID.finish=function(e,t){for(var n=t.dataflow,i=this._argops,r=0,a=i.length,o;r<a;++r){if(o=i[r],o.name!==bc||o.op._argval.force!=="link")continue;for(var s=o.op._argops,l=0,u=s.length,c;l<u;++l)if(s[l].name==="links"&&(c=s[l].op.source)){n.pulse(c,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(ND)};function HY(e,t){return function(){e.touch(t).run()}}function YY(e,t){var n=BY(e),i=!1,r=n.stop,a=n.restart;return n.stopped=function(){return i},n.restart=function(){return i=!1,a()},n.stop=function(){return i=!0,r()},MD(n,t,!0).on("end",function(){i=!0})}function MD(e,t,n,i){var r=G(t.forces),a,o,s,l;for(a=0,o=M1.length;a<o;++a)s=M1[a],s!==bc&&t.modified(s)&&e[s](t[s]);for(a=0,o=r.length;a<o;++a)l=bc+a,s=n||t.modified(bc,a)?XY(r[a]):i&&VY(r[a],i)?e.force(l):null,s&&e.force(l,s);for(o=e.numForces||0;a<o;++a)e.force(bc+a,null);return e.numForces=r.length,e}function VY(e,t){var n,i;for(n in e)if(ge(i=e[n])&&t.modified(Gt(i)))return 1;return 0}function XY(e){var t,n;Q(FD,e.force)||F("Unrecognized force: "+e.force),t=FD[e.force]();for(n in e)ge(t[n])&&JY(t[n],e[n],e);return t}function JY(e,t,n){e(ge(t)?function(i){return t(i,n)}:t)}var KY=Object.freeze({__proto__:null,force:j1});function L1(e,t,n){var i={};return e.each(function(r){var a=r.data;n(a)&&(i[t(a)]=r)}),e.lookup=i,e}function QY(e,t){return e.parent===t.parent?1:2}function ZY(e){return e.reduce(eV,0)/e.length}function eV(e,t){return e+t.x}function tV(e){return 1+e.reduce(nV,0)}function nV(e,t){return Math.max(e,t.y)}function iV(e){for(var t;t=e.children;)e=t[0];return e}function rV(e){for(var t;t=e.children;)e=t[t.length-1];return e}function aV(){var e=QY,t=1,n=1,i=!1;function r(a){var o,s=0;a.eachAfter(function(d){var h=d.children;h?(d.x=ZY(h),d.y=tV(h)):(d.x=o?s+=e(d,o):0,d.y=0,o=d)});var l=iV(a),u=rV(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(i?function(d){d.x=(d.x-a.x)*t,d.y=(a.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(a.y?d.y/a.y:1))*n})}return r.separation=function(a){return arguments.length?(e=a,r):e},r.size=function(a){return arguments.length?(i=!1,t=+a[0],n=+a[1],r):i?null:[t,n]},r.nodeSize=function(a){return arguments.length?(i=!0,t=+a[0],n=+a[1],r):i?[t,n]:null},r}function oV(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function sV(){return this.eachAfter(oV)}function lV(e){var t=this,n,i=[t],r,a,o;do for(n=i.reverse(),i=[];t=n.pop();)if(e(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)i.push(r[a]);while(i.length);return this}function uV(e){for(var t=this,n=[t],i,r;t=n.pop();)if(e(t),i=t.children,i)for(r=i.length-1;r>=0;--r)n.push(i[r]);return this}function cV(e){for(var t=this,n=[t],i=[],r,a,o;t=n.pop();)if(i.push(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)n.push(r[a]);for(;t=i.pop();)e(t);return this}function fV(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function dV(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function hV(e){for(var t=this,n=pV(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function pV(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function gV(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function mV(){var e=[];return this.each(function(t){e.push(t)}),e}function vV(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function yV(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function P1(e,t){var n=new hl(e),i=+e.value&&(n.value=e.value),r,a=[n],o,s,l,u;for(t==null&&(t=wV);r=a.pop();)if(i&&(r.value=+r.data.value),(s=t(r.data))&&(u=s.length))for(r.children=new Array(u),l=u-1;l>=0;--l)a.push(o=r.children[l]=new hl(s[l])),o.parent=r,o.depth=r.depth+1;return n.eachBefore(jD)}function bV(){return P1(this).eachBefore(xV)}function wV(e){return e.children}function xV(e){e.data=e.data.data}function jD(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function hl(e){this.data=e,this.depth=this.height=0,this.parent=null}hl.prototype=P1.prototype={constructor:hl,count:sV,each:lV,eachAfter:cV,eachBefore:uV,sum:fV,sort:dV,path:hV,ancestors:gV,descendants:mV,leaves:vV,links:yV,copy:bV};var EV=Array.prototype.slice;function kV(e){for(var t=e.length,n,i;t;)i=Math.random()*t--|0,n=e[t],e[t]=e[i],e[i]=n;return e}function _V(e){for(var t=0,n=(e=kV(EV.call(e))).length,i=[],r,a;t<n;)r=e[t],a&&LD(a,r)?++t:(a=SV(i=AV(i,r)),t=0);return a}function AV(e,t){var n,i;if(z1(t,e))return[t];for(n=0;n<e.length;++n)if(Op(t,e[n])&&z1(wc(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(Op(wc(e[n],e[i]),t)&&Op(wc(e[n],t),e[i])&&Op(wc(e[i],t),e[n])&&z1(PD(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error()}function Op(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function LD(e,t){var n=e.r-t.r+1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function z1(e,t){for(var n=0;n<t.length;++n)if(!LD(e,t[n]))return!1;return!0}function SV(e){switch(e.length){case 1:return OV(e[0]);case 2:return wc(e[0],e[1]);case 3:return PD(e[0],e[1],e[2])}}function OV(e){return{x:e.x,y:e.y,r:e.r}}function wc(e,t){var n=e.x,i=e.y,r=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-i,c=s-r,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(i+o+u/f*c)/2,r:(f+r+s)/2}}function PD(e,t,n){var i=e.x,r=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=i-o,h=i-u,p=r-s,g=r-c,m=l-a,v=f-a,y=i*i+r*r-a*a,b=y-o*o-s*s+l*l,E=y-u*u-c*c+f*f,x=h*p-d*g,k=(p*E-g*b)/(x*2)-i,w=(g*m-p*v)/x,A=(h*b-d*E)/(x*2)-r,_=(d*v-h*m)/x,O=w*w+_*_-1,S=2*(a+k*w+A*_),T=k*k+A*A-a*a,D=-(O?(S+Math.sqrt(S*S-4*O*T))/(2*O):T/S);return{x:i+k+w*D,y:r+A+_*D,r:D}}function zD(e,t,n){var i=e.x-t.x,r,a,o=e.y-t.y,s,l,u=i*i+o*o;u?(a=t.r+n.r,a*=a,l=e.r+n.r,l*=l,a>l?(r=(u+l-a)/(2*u),s=Math.sqrt(Math.max(0,l/u-r*r)),n.x=e.x-r*i-s*o,n.y=e.y-r*o+s*i):(r=(u+a-l)/(2*u),s=Math.sqrt(Math.max(0,a/u-r*r)),n.x=t.x+r*i-s*o,n.y=t.y+r*o+s*i)):(n.x=t.x+n.r,n.y=t.y)}function BD(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function UD(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,a=(t.y*n.r+n.y*t.r)/i;return r*r+a*a}function Tp(e){this._=e,this.next=null,this.previous=null}function TV(e){if(!(r=e.length))return 0;var t,n,i,r,a,o,s,l,u,c,f;if(t=e[0],t.x=0,t.y=0,!(r>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;zD(n,t,i=e[2]),t=new Tp(t),n=new Tp(n),i=new Tp(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(s=3;s<r;++s){zD(t._,n._,i=e[s]),i=new Tp(i),l=n.next,u=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(BD(l._,i._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(BD(u._,i._)){t=u,t.next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}while(l!==u.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,a=UD(t);(i=i.next)!==n;)(o=UD(i))<a&&(t=i,a=o);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=_V(t),s=0;s<r;++s)t=e[s],t.x-=i.x,t.y-=i.y;return i.r}function CV(e){return e==null?null:Cp(e)}function Cp(e){if(typeof e!="function")throw new Error();return e}function No(){return 0}function pl(e){return function(){return e}}function $V(e){return Math.sqrt(e.value)}function DV(){var e=null,t=1,n=1,i=No;function r(a){return a.x=t/2,a.y=n/2,e?a.eachBefore(qD(e)).eachAfter(B1(i,.5)).eachBefore(WD(1)):a.eachBefore(qD($V)).eachAfter(B1(No,1)).eachAfter(B1(i,a.r/Math.min(t,n))).eachBefore(WD(Math.min(t,n)/(2*a.r))),a}return r.radius=function(a){return arguments.length?(e=CV(a),r):e},r.size=function(a){return arguments.length?(t=+a[0],n=+a[1],r):[t,n]},r.padding=function(a){return arguments.length?(i=typeof a=="function"?a:pl(+a),r):i},r}function qD(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function B1(e,t){return function(n){if(i=n.children){var i,r,a=i.length,o=e(n)*t||0,s;if(o)for(r=0;r<a;++r)i[r].r+=o;if(s=TV(i),o)for(r=0;r<a;++r)i[r].r-=o;n.r=s+o}}}function WD(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function GD(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function xc(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(i-t)/e.value;++s<l;)o=a[s],o.y0=n,o.y1=r,o.x0=t,o.x1=t+=o.value*u}function RV(){var e=1,t=1,n=0,i=!1;function r(o){var s=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/s,o.eachBefore(a(t,s)),i&&o.eachBefore(GD),o}function a(o,s){return function(l){l.children&&xc(l,l.x0,o*(l.depth+1)/s,l.x1,o*(l.depth+2)/s);var u=l.x0,c=l.y0,f=l.x1-n,d=l.y1-n;f<u&&(u=f=(u+f)/2),d<c&&(c=d=(c+d)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=d}}return r.round=function(o){return arguments.length?(i=!!o,r):i},r.size=function(o){return arguments.length?(e=+o[0],t=+o[1],r):[e,t]},r.padding=function(o){return arguments.length?(n=+o,r):n},r}var HD="$",FV={depth:-1},YD={};function NV(e){return e.id}function IV(e){return e.parentId}function VD(){var e=NV,t=IV;function n(i){var r,a,o=i.length,s,l,u,c=new Array(o),f,d,h={};for(a=0;a<o;++a)r=i[a],u=c[a]=new hl(r),(f=e(r,a,i))!=null&&(f+="")&&(d=HD+(u.id=f),h[d]=d in h?YD:u);for(a=0;a<o;++a)if(u=c[a],f=t(i[a],a,i),f==null||!(f+="")){if(s)throw new Error("multiple roots");s=u}else{if(l=h[HD+f],!l)throw new Error("missing: "+f);if(l===YD)throw new Error("ambiguous: "+f);l.children?l.children.push(u):l.children=[u],u.parent=l}if(!s)throw new Error("no root");if(s.parent=FV,s.eachBefore(function(p){p.depth=p.parent.depth+1,--o}).eachBefore(jD),s.parent=null,o>0)throw new Error("cycle");return s}return n.id=function(i){return arguments.length?(e=Cp(i),n):e},n.parentId=function(i){return arguments.length?(t=Cp(i),n):t},n}function MV(e,t){return e.parent===t.parent?1:2}function U1(e){var t=e.children;return t?t[0]:e.t}function q1(e){var t=e.children;return t?t[t.length-1]:e.t}function jV(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function LV(e){for(var t=0,n=0,i=e.children,r=i.length,a;--r>=0;)a=i[r],a.z+=t,a.m+=t,t+=a.s+(n+=a.c)}function PV(e,t,n){return e.a.parent===t.parent?e.a:n}function $p(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}$p.prototype=Object.create(hl.prototype);function zV(e){for(var t=new $p(e,0),n,i=[t],r,a,o,s;n=i.pop();)if(a=n._.children)for(n.children=new Array(s=a.length),o=s-1;o>=0;--o)i.push(r=n.children[o]=new $p(a[o],o)),r.parent=n;return(t.parent=new $p(null,0)).children=[t],t}function BV(){var e=MV,t=1,n=1,i=null;function r(u){var c=zV(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(o),i)u.eachBefore(l);else{var f=u,d=u,h=u;u.eachBefore(function(y){y.x<f.x&&(f=y),y.x>d.x&&(d=y),y.depth>h.depth&&(h=y)});var p=f===d?1:e(f,d)/2,g=p-f.x,m=t/(d.x+p+g),v=n/(h.depth||1);u.eachBefore(function(y){y.x=(y.x+g)*m,y.y=y.depth*v})}return u}function a(u){var c=u.children,f=u.parent.children,d=u.i?f[u.i-1]:null;if(c){LV(u);var h=(c[0].z+c[c.length-1].z)/2;d?(u.z=d.z+e(u._,d._),u.m=u.z-h):u.z=h}else d&&(u.z=d.z+e(u._,d._));u.parent.A=s(u,d,u.parent.A||f[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function s(u,c,f){if(c){for(var d=u,h=u,p=c,g=d.parent.children[0],m=d.m,v=h.m,y=p.m,b=g.m,E;p=q1(p),d=U1(d),p&&d;)g=U1(g),h=q1(h),h.a=u,E=p.z+y-d.z-m+e(p._,d._),E>0&&(jV(PV(p,u,f),u,E),m+=E,v+=E),y+=p.m,m+=d.m,b+=g.m,v+=h.m;p&&!q1(h)&&(h.t=p,h.m+=y-v),d&&!U1(g)&&(g.t=d,g.m+=m-b,f=u)}return f}function l(u){u.x*=t,u.y=u.depth*n}return r.separation=function(u){return arguments.length?(e=u,r):e},r.size=function(u){return arguments.length?(i=!1,t=+u[0],n=+u[1],r):i?null:[t,n]},r.nodeSize=function(u){return arguments.length?(i=!0,t=+u[0],n=+u[1],r):i?[t,n]:null},r}function Dp(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(r-n)/e.value;++s<l;)o=a[s],o.x0=t,o.x1=i,o.y0=n,o.y1=n+=o.value*u}var XD=(1+Math.sqrt(5))/2;function JD(e,t,n,i,r,a){for(var o=[],s=t.children,l,u,c=0,f=0,d=s.length,h,p,g=t.value,m,v,y,b,E,x,k;c<d;){h=r-n,p=a-i;do m=s[f++].value;while(!m&&f<d);for(v=y=m,x=Math.max(p/h,h/p)/(g*e),k=m*m*x,E=Math.max(y/k,k/v);f<d;++f){if(m+=u=s[f].value,u<v&&(v=u),u>y&&(y=u),k=m*m*x,b=Math.max(y/k,k/v),b>E){m-=u;break}E=b}o.push(l={value:m,dice:h<p,children:s.slice(c,f)}),l.dice?xc(l,n,i,r,g?i+=p*m/g:a):Dp(l,n,i,g?n+=h*m/g:r,a),g-=m,c=f}return o}var KD=function e(t){function n(i,r,a,o,s){JD(t,i,r,a,o,s)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(XD);function UV(){var e=KD,t=!1,n=1,i=1,r=[0],a=No,o=No,s=No,l=No,u=No;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(GD),d}function f(d){var h=r[d.depth],p=d.x0+h,g=d.y0+h,m=d.x1-h,v=d.y1-h;m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),d.x0=p,d.y0=g,d.x1=m,d.y1=v,d.children&&(h=r[d.depth+1]=a(d)/2,p+=u(d)-h,g+=o(d)-h,m-=s(d)-h,v-=l(d)-h,m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),e(d,p,g,m,v))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=Cp(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(a=typeof d=="function"?d:pl(+d),c):a},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:pl(+d),c):o},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:pl(+d),c):s},c.paddingBottom=function(d){return arguments.length?(l=typeof d=="function"?d:pl(+d),c):l},c.paddingLeft=function(d){return arguments.length?(u=typeof d=="function"?d:pl(+d),c):u},c}function qV(e,t,n,i,r){var a=e.children,o,s=a.length,l,u=new Array(s+1);for(u[0]=l=o=0;o<s;++o)u[o+1]=l+=a[o].value;c(0,s,e.value,t,n,i,r);function c(f,d,h,p,g,m,v){if(f>=d-1){var y=a[f];y.x0=p,y.y0=g,y.x1=m,y.y1=v;return}for(var b=u[f],E=h/2+b,x=f+1,k=d-1;x<k;){var w=x+k>>>1;u[w]<E?x=w+1:k=w}E-u[x-1]<u[x]-E&&f+1<x&&--x;var A=u[x]-b,_=h-A;if(m-p>v-g){var O=(p*_+m*A)/h;c(f,x,A,p,g,O,v),c(x,d,_,O,g,m,v)}else{var S=(g*_+v*A)/h;c(f,x,A,p,g,m,S),c(x,d,_,p,S,m,v)}}}function WV(e,t,n,i,r){(e.depth&1?Dp:xc)(e,t,n,i,r)}var GV=function e(t){function n(i,r,a,o,s){if((l=i._squarify)&&l.ratio===t)for(var l,u,c,f,d=-1,h,p=l.length,g=i.value;++d<p;){for(u=l[d],c=u.children,f=u.value=0,h=c.length;f<h;++f)u.value+=c[f].value;u.dice?xc(u,r,a,o,a+=(s-a)*u.value/g):Dp(u,r,a,r+=(o-r)*u.value/g,s),g-=u.value}else i._squarify=l=JD(t,i,r,a,o,s),l.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(XD);function W1(e){$.call(this,null,e)}W1.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var HV=P(W1,$);function YV(e){return e.values}HV.transform=function(e,t){t.source||F("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),a=this.value;return(!a||i||t.changed())&&(a&&a.each(o=>{o.children&&id(o.data)&&r.rem.push(o.data)}),this.value=a=P1({values:G(e.keys).reduce((o,s)=>(o.key(s),o),VV()).entries(r.source)},YV),n&&a.each(o=>{o.children&&(o=ke(o.data),r.add.push(o),r.source.push(o))}),L1(a,ee,ee)),r.source.root=a,r};function VV(){var e=[],t;function n(r,a){if(a>=e.length)return r;for(var o=-1,s=r.length,l=e[a++],u,c,f={},d,h={};++o<s;)u=l(c=r[o])+"",(d=f[u])?d.push(c):f[u]=[c];for(u in f)h[u]=n(f[u],a);return h}function i(r,a){if(++a>e.length)return r;var o=[],s;for(s in r)o.push({key:s,values:i(r[s],a)});return o}return t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)}}function Dr(e){$.call(this,null,e)}var XV=P(Dr,$);XV.transform=function(e,t){(!t.source||!t.source.root)&&F(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),i=this.fields,r=t.source.root,a=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(ao(e.sort,o=>o.data)),JV(n,this.params,e),n.separation&&n.separation(e.separation!==!1?QV:Xl);try{this.value=n(r)}catch(o){F(o)}return r.each(function(o){KV(o,i,a)}),t.reflow(e.modified()).modifies(a).modifies("leaf")};function JV(e,t,n){for(var i,r=0,a=t.length;r<a;++r)i=t[r],i in n&&e[i](n[i])}function KV(e,t,n){for(var i=e.data,r=0,a=t.length-1;r<a;++r)i[n[r]]=e[t[r]];i[n[a]]=e.children?e.children.length:0}function QV(e,t){return e.parent===t.parent?1:2}var G1=["x","y","r","depth","children"];function H1(e){Dr.call(this,e)}H1.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:G1.length,default:G1}]};var Y1=P(H1,Dr);Y1.layout=DV,Y1.params=["radius","size","padding"],Y1.fields=G1;var V1=["x0","y0","x1","y1","depth","children"];function X1(e){Dr.call(this,e)}X1.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:V1.length,default:V1}]};var J1=P(X1,Dr);J1.layout=RV,J1.params=["size","round","padding"],J1.fields=V1;function K1(e){$.call(this,null,e)}K1.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};var ZV=P(K1,$);ZV.transform=function(e,t){t.source||F("Stratify transform requires an upstream data source.");var n=this.value,i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),a=!this.value||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),a&&(r.source.length?n=L1(VD().id(e.key).parentId(e.parentKey)(r.source),e.key,Fi):n=L1(VD()([{}]),e.key,e.key)),r.source.root=this.value=n,r};var QD={tidy:BV,cluster:aV},Q1=["x","y","depth","children"];function Z1(e){Dr.call(this,e)}Z1.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:Q1.length,default:Q1}]};var ew=P(Z1,Dr);ew.layout=function(e){var t=e||"tidy";if(Q(QD,t))return QD[t]();F("Unrecognized Tree layout method: "+t)},ew.params=["size","nodeSize"],ew.fields=Q1;function tw(e){$.call(this,[],e)}tw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};var eX=P(tw,$);eX.transform=function(e,t){var n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),a={};return i||F("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,function(o){a[ee(o)]=1}),i.each(function(o){var s=o.data,l=o.parent&&o.parent.data;l&&a[ee(s)]&&a[ee(l)]&&r.add.push(ke({source:l,target:s}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,function(o){a[ee(o)]=1}),n.forEach(function(o){(a[ee(o.source)]||a[ee(o.target)])&&r.mod.push(o)})),r};var ZD={binary:qV,dice:xc,slice:Dp,slicedice:WV,squarify:KD,resquarify:GV},nw=["x0","y0","x1","y1","depth","children"];function iw(e){Dr.call(this,e)}iw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:nw.length,default:nw}]};var rw=P(iw,Dr);rw.layout=function(){var e=UV();return e.ratio=function(t){var n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=function(t){Q(ZD,t)?e.tile(ZD[t]):F("Unrecognized Treemap layout method: "+t)},e},rw.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],rw.fields=nw;var tX=Object.freeze({__proto__:null,nest:W1,pack:H1,partition:X1,stratify:K1,tree:Z1,treelinks:tw,treemap:iw});function eR(e,t){var n=[],i=function(c){return c(s)},r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function aw(e){$.call(this,null,e)}aw.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};var nX=P(aw,$);nX.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=eR(i,e.groupby),a=(e.groupby||[]).map(Ze),o=a.length,s=e.as||[Ze(e.x),Ze(e.y)],l=[];r.forEach(u=>{pA(u,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<o;++d)f[a[d]]=u.dims[d];f[s[0]]=c[0],f[s[1]]=c[1],l.push(ke(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};const ow={linear:rv,log:lA,exp:uA,pow:cA,quad:av,poly:fA};function iX(e,t){return e==="poly"?t:e==="quad"?2:1}function sw(e){$.call(this,null,e)}sw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(ow)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};var rX=P(sw,$);rX.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=eR(i,e.groupby),a=(e.groupby||[]).map(Ze),o=e.method||"linear",s=e.order||3,l=iX(o,s),u=e.as||[Ze(e.x),Ze(e.y)],c=ow[o],f=[];let d=e.extent;Q(ow,o)||F("Invalid regression method: "+o),d!=null&&(o==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null)),r.forEach(h=>{const p=h.length;if(p<=l){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(h,e.x,e.y,s);if(e.params){f.push(ke({keys:h.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=d||mr(h,e.x),v=y=>{const b={};for(let E=0;E<a.length;++E)b[a[E]]=h.dims[E];b[u[0]]=y[0],b[u[1]]=y[1],f.push(ke(b))};o==="linear"?m.forEach(y=>v([y,g.predict(y)])):Cd(g.predict,m,25,200).forEach(v)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n};var aX=Object.freeze({__proto__:null,loess:aw,regression:sw});const tR=Math.pow(2,-52),Rp=new Uint32Array(512);class lw{static from(e,t=cX,n=fX){const i=e.length,r=new Float64Array(i*2);for(let a=0;a<i;a++){const o=e[a];r[2*a]=t(o),r[2*a+1]=n(o)}return new lw(r)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,a=e.length>>1;let o=Infinity,s=Infinity,l=-Infinity,u=-Infinity;for(let _=0;_<a;_++){const O=e[2*_],S=e[2*_+1];O<o&&(o=O),S<s&&(s=S),O>l&&(l=O),S>u&&(u=S),this._ids[_]=_}const c=(o+l)/2,f=(s+u)/2;let d=Infinity,h,p,g;for(let _=0;_<a;_++){const O=uw(c,f,e[2*_],e[2*_+1]);O<d&&(h=_,d=O)}const m=e[2*h],v=e[2*h+1];d=Infinity;for(let _=0;_<a;_++){if(_===h)continue;const O=uw(m,v,e[2*_],e[2*_+1]);O<d&&O>0&&(p=_,d=O)}let y=e[2*p],b=e[2*p+1],E=Infinity;for(let _=0;_<a;_++){if(_===h||_===p)continue;const O=lX(m,v,y,b,e[2*_],e[2*_+1]);O<E&&(g=_,E=O)}let x=e[2*g],k=e[2*g+1];if(E===Infinity){for(let S=0;S<a;S++)this._dists[S]=e[2*S]-e[0]||e[2*S+1]-e[1];gl(this._ids,this._dists,0,a-1);const _=new Uint32Array(a);let O=0;for(let S=0,T=-Infinity;S<a;S++){const D=this._ids[S];this._dists[D]>T&&(_[O++]=D,T=this._dists[D])}this.hull=_.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Fp(m,v,y,b,x,k)){const _=p,O=y,S=b;p=g,y=x,b=k,g=_,x=O,k=S}const w=uX(m,v,y,b,x,k);this._cx=w.x,this._cy=w.y;for(let _=0;_<a;_++)this._dists[_]=uw(e[2*_],e[2*_+1],w.x,w.y);gl(this._ids,this._dists,0,a-1),this._hullStart=h;let A=3;n[h]=t[g]=p,n[p]=t[h]=g,n[g]=t[p]=h,i[h]=0,i[p]=1,i[g]=2,r.fill(-1),r[this._hashKey(m,v)]=h,r[this._hashKey(y,b)]=p,r[this._hashKey(x,k)]=g,this.trianglesLen=0,this._addTriangle(h,p,g,-1,-1,-1);for(let _=0,O,S;_<this._ids.length;_++){const T=this._ids[_],D=e[2*T],M=e[2*T+1];if(_>0&&Math.abs(D-O)<=tR&&Math.abs(M-S)<=tR)continue;if(O=D,S=M,T===h||T===p||T===g)continue;let C=0;for(let xe=0,Le=this._hashKey(D,M);xe<this._hashSize&&!(C=r[(Le+xe)%this._hashSize],C!==-1&&C!==n[C]);xe++);C=t[C];let N=C,W;for(;W=n[N],!Fp(D,M,e[2*N],e[2*N+1],e[2*W],e[2*W+1]);)if(N=W,N===C){N=-1;break}if(N===-1)continue;let X=this._addTriangle(N,T,n[N],-1,-1,i[N]);i[T]=this._legalize(X+2),i[N]=X,A++;let J=n[N];for(;W=n[J],Fp(D,M,e[2*J],e[2*J+1],e[2*W],e[2*W+1]);)X=this._addTriangle(J,T,W,i[T],-1,i[J]),i[T]=this._legalize(X+2),n[J]=J,A--,J=W;if(N===C)for(;W=t[N],Fp(D,M,e[2*W],e[2*W+1],e[2*N],e[2*N+1]);)X=this._addTriangle(W,T,N,-1,i[N],i[W]),this._legalize(X+2),i[W]=X,n[N]=N,A--,N=W;this._hullStart=t[T]=N,n[N]=t[J]=T,n[T]=J,r[this._hashKey(D,M)]=T,r[this._hashKey(e[2*N],e[2*N+1])]=N}this.hull=new Uint32Array(A);for(let _=0,O=this._hullStart;_<A;_++)this.hull[_]=O,O=n[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(oX(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,o===-1){if(r===0)break;e=Rp[--r];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c],g=sX(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1]);if(g){t[e]=p,t[o]=f;const m=n[c];if(m===-1){let y=this._hullStart;do{if(this._hullTri[y]===c){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,m),this._link(o,n[a]),this._link(a,c);const v=l+(o+1)%3;r<Rp.length&&(Rp[r++]=v)}else{if(r===0)break;e=Rp[--r]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,a),this.trianglesLen+=3,o}}function oX(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function uw(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}function cw(e,t,n,i,r,a){const o=(i-t)*(r-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function Fp(e,t,n,i,r,a){const o=cw(r,a,e,t,n,i)||cw(e,t,n,i,r,a)||cw(n,i,r,a,e,t);return o<0}function sX(e,t,n,i,r,a,o,s){const l=e-o,u=t-s,c=n-o,f=i-s,d=r-o,h=a-s,p=l*l+u*u,g=c*c+f*f,m=d*d+h*h;return l*(f*m-g*h)-u*(c*m-g*d)+p*(c*h-f*d)<0}function lX(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function uX(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=e+(u*c-s*f)*d,p=t+(o*f-l*c)*d;return{x:h,y:p}}function gl(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const a=e[r],o=t[a];let s=r-1;for(;s>=n&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=a}else{const r=n+i>>1;let a=n+1,o=i;Ec(e,r,a),t[e[n]]>t[e[i]]&&Ec(e,n,i),t[e[a]]>t[e[i]]&&Ec(e,a,i),t[e[n]]>t[e[a]]&&Ec(e,n,a);const s=e[a],l=t[s];for(;;){do a++;while(t[e[a]]<l);do o--;while(t[e[o]]>l);if(o<a)break;Ec(e,a,o)}e[n+1]=e[o],e[o]=s,i-a+1>=o-n?(gl(e,t,a,i),gl(e,t,n,o-1)):(gl(e,t,n,o-1),gl(e,t,a,i))}}function Ec(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function cX(e){return e[0]}function fX(e){return e[1]}const nR=1e-6;class Io{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const i=e+n,r=t;if(n<0)throw new Error("negative radius");if(this._x1===null?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>nR||Math.abs(this._y1-r)>nR)&&(this._+="L"+i+","+r),!n)return;this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class fw{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class dX{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d=0,h=0,p=n.length,g,m;d<p;d+=3,h+=2){const v=n[d]*2,y=n[d+1]*2,b=n[d+2]*2,E=e[v],x=e[v+1],k=e[y],w=e[y+1],A=e[b],_=e[b+1],O=k-E,S=w-x,T=A-E,D=_-x,M=O*O+S*S,C=T*T+D*D,N=(O*D-S*T)*2;if(!N)g=(E+A)/2-1e8*D,m=(x+_)/2+1e8*T;else if(Math.abs(N)<1e-8)g=(E+A)/2,m=(x+_)/2;else{const W=1/N;g=E+(D*M-S*C)*W,m=x+(O*C-T*M)*W}r[h]=g,r[h+1]=m}let a=t[t.length-1],o,s=a*4,l,u=e[2*a],c,f=e[2*a+1];i.fill(0);for(let d=0;d<t.length;++d)a=t[d],o=s,l=u,c=f,s=a*4,u=e[2*a],f=e[2*a+1],i[o+2]=i[s]=c-f,i[o+3]=i[s+1]=u-l}render(e){const t=e==null?e=new Io():void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:a,vectors:o}=this;if(r.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const f=n[u];if(f<u)continue;const d=Math.floor(u/3)*2,h=Math.floor(f/3)*2,p=a[d],g=a[d+1],m=a[h],v=a[h+1];this._renderSegment(p,g,m,v,e)}let s,l=r[r.length-1];for(let u=0;u<r.length;++u){s=l,l=r[u];const c=Math.floor(i[l]/3)*2,f=a[c],d=a[c+1],h=s*4,p=this._project(f,d,o[h+2],o[h+3]);p&&this._renderSegment(f,d,p[0],p[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new Io():void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=t==null?t=new Io():void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let a=2;a<r;a+=2)(i[a]!==i[a-2]||i[a+1]!==i[a-1])&&t.lineTo(i[a],i[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new fw();return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let a;const o=this._regioncode(e,t),s=this._regioncode(n,i);o===0&&s===0?(r.moveTo(e,t),r.lineTo(n,i)):(a=this._clipSegment(e,t,n,i,o,s))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t,t!==t)||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const i=this._clip(n);if(i)e:for(let r=0,a=t.length;r<a;r+=2)for(let o=0,s=i.length;o<s;o+=2)if(t[r]==i[o]&&t[r+1]==i[o+1]&&t[(r+2)%a]==i[(o+s-2)%s]&&t[(r+3)%a]==i[(o+s-1)%s]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,a=n[e];if(a===-1)return null;const o=[];let s=a;do{const l=Math.floor(s/3);if(o.push(t[l*2],t[l*2+1]),s=s%3===2?s-2:s+1,r[s]!==e)break;s=i[s]}while(s!==a&&s!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:n}=this,i=e*4;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let i=null,r,a,o=t[n-2],s=t[n-1],l,u=this._regioncode(o,s),c,f;for(let d=0;d<n;d+=2)if(r=o,a=s,o=t[d],s=t[d+1],l=u,u=this._regioncode(o,s),l===0&&u===0)c=f,f=0,i?i.push(o,s):i=[o,s];else{let h,p,g,m,v;if(l===0){if((h=this._clipSegment(r,a,o,s,l,u))===null)continue;[p,g,m,v]=h}else{if((h=this._clipSegment(o,s,r,a,u,l))===null)continue;[m,v,p,g]=h,c=f,f=this._edgecode(p,g),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(p,g):i=[p,g]}c=f,f=this._edgecode(m,v),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(m,v):i=[m,v]}if(i)c=f,f=this._edgecode(i[0],i[1]),c&&f&&this._edge(e,c,f,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,n,i,r,a){for(;;){if(r===0&&a===0)return[e,t,n,i];if(r&a)return null;let o,s,l=r||a;l&8?(o=e+(n-e)*(this.ymax-t)/(i-t),s=this.ymax):l&4?(o=e+(n-e)*(this.ymin-t)/(i-t),s=this.ymin):l&2?(s=t+(i-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(i-t)*(this.xmin-e)/(n-e),o=this.xmin),r?(e=o,t=s,r=this._regioncode(e,t)):(n=o,i=s,a=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,a){let o=Array.from(t),s;if((s=this._project(o[0],o[1],n,i))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],r,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let l=0,u=o.length,c,f=this._edgecode(o[u-2],o[u-1]);l<u;l+=2)c=f,f=this._edgecode(o[l],o[l+1]),c&&f&&(l=this._edge(e,c,f,o,l),u=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,i,r){for(;t!==n;){let a,o;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}(i[r]!==a||i[r+1]!==o)&&this.contains(e,a,o)&&(i.splice(r,0,a,o),r+=2)}if(i.length>4)for(let a=0;a<i.length;a+=2){const o=(a+2)%i.length,s=(a+4)%i.length;(i[a]===i[o]&&i[o]===i[s]||i[a+1]===i[o+1]&&i[o+1]===i[s+1])&&(i.splice(o,2),a-=2)}return r}_project(e,t,n,i){let r=Infinity,a,o,s;if(i<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/i)<r&&(s=this.ymin,o=e+(r=a)*n)}else if(i>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/i)<r&&(s=this.ymax,o=e+(r=a)*n)}if(n>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/n)<r&&(o=this.xmax,s=t+(r=a)*i)}else if(n<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/n)<r&&(o=this.xmin,s=t+(r=a)*i)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const hX=2*Math.PI,ml=Math.pow;function pX(e){return e[0]}function gX(e){return e[1]}function mX(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],a=2*t[i+1],o=2*t[i+2],s=(n[o]-n[r])*(n[a+1]-n[r+1])-(n[a]-n[r])*(n[o+1]-n[r+1]);if(s>1e-10)return!1}return!0}function vX(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class iR{static from(e,t=pX,n=gX,i){return new iR("length"in e?yX(e,t,n,i):Float64Array.from(bX(e,t,n,i)))}constructor(e){this._delaunator=new lw(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&mX(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const s=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[t[2*s],t[2*s+1],t[2*l],t[2*l+1]],c=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let f=0,d=t.length/2;f<d;++f){const h=vX(t[2*f],t[2*f+1],c);t[2*f]=h[0],t[2*f+1]=h[1]}this._delaunator=new lw(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const u=r[s%3===2?s-2:s+1];(n[s]===-1||a[u]===-1)&&(a[u]=s)}for(let s=0,l=i.length;s<l;++s)o[i[s]]=s;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],a[i[0]]=1,i.length===2&&(a[i[1]]=0))}voronoi(e){return new dX(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:a,collinear:o}=this;if(o){const c=o.indexOf(e);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const s=t[e];if(s===-1)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3===2?l-2:l+1,a[l]!==e)return;if(l=r[l],l===-1){const c=n[(i[e]+1)%n.length];c!==u&&(yield c);return}}while(l!==s)}find(e,t,n=0){if((e=+e,e!==e)||(t=+t,t!==t))return-1;const i=n;let r;for(;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}_step(e,t,n){const{inedges:i,hull:r,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);let u=e,c=ml(t-l[e*2],2)+ml(n-l[e*2+1],2);const f=i[e];let d=f;do{let h=s[d];const p=ml(t-l[h*2],2)+ml(n-l[h*2+1],2);if(p<c&&(c=p,u=h),d=d%3===2?d-2:d+1,s[d]!==e)break;if(d=o[d],d===-1){if(d=r[(a[e]+1)%r.length],d!==h&&ml(t-l[d*2],2)+ml(n-l[d*2+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=e==null?e=new Io():void 0,{points:n,halfedges:i,triangles:r}=this;for(let a=0,o=i.length;a<o;++a){const s=i[a];if(s<a)continue;const l=r[a]*2,u=r[s]*2;e.moveTo(n[l],n[l+1]),e.lineTo(n[u],n[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=e==null?e=new Io():void 0,{points:i}=this;for(let r=0,a=i.length;r<a;r+=2){const o=i[r],s=i[r+1];e.moveTo(o+t,s),e.arc(o,s,t,0,hX)}return n&&n.value()}renderHull(e){const t=e==null?e=new Io():void 0,{hull:n,points:i}=this,r=n[0]*2,a=n.length;e.moveTo(i[r],i[r+1]);for(let o=1;o<a;++o){const s=2*n[o];e.lineTo(i[s],i[s+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new fw();return this.renderHull(e),e.value()}renderTriangle(e,t){const n=t==null?t=new Io():void 0,{points:i,triangles:r}=this,a=r[e*=3]*2,o=r[e+1]*2,s=r[e+2]*2;return t.moveTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.lineTo(i[s],i[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new fw();return this.renderTriangle(e,t),t.value()}}function yX(e,t,n,i){const r=e.length,a=new Float64Array(r*2);for(let o=0;o<r;++o){const s=e[o];a[o*2]=t.call(i,s,o,e),a[o*2+1]=n.call(i,s,o,e)}return a}function*bX(e,t,n,i){let r=0;for(const a of e)yield t.call(i,a,r,e),yield n.call(i,a,r,e),++r}function dw(e){$.call(this,null,e)}dw.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const wX=P(dw,$),xX=[-1e5,-1e5,1e5,1e5];wX.transform=function(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:xX;const a=this.value=iR.from(i,e.x,e.y).voronoi(r);for(let o=0,s=i.length;o<s;++o){const l=a.cellPolygon(o);i[o][n]=l?EX(l):null}return t.reflow(e.modified()).modifies(n)};function EX(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}var kX=Object.freeze({__proto__:null,voronoi:dw}),hw=Math.PI/180,kc=1<<11>>5,Np=1<<11;function _X(){var e=[256,256],t,n,i,r,a,o,s,l=rR,u=[],c=Math.random,f={};f.layout=function(){for(var p=d(Su()),g=$X((e[0]>>5)*e[1]),m=null,v=u.length,y=-1,b=[],E=u.map(function(k){return{text:t(k),font:n(k),style:r(k),weight:a(k),rotate:o(k),size:~~(i(k)+1e-14),padding:s(k),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:k}}).sort(function(k,w){return w.size-k.size});++y<v;){var x=E[y];x.x=e[0]*(c()+.5)>>1,x.y=e[1]*(c()+.5)>>1,AX(p,x,E,y),x.hasText&&h(g,x,m)&&(b.push(x),m?OX(m,x):m=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return b};function d(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(kc<<5)/g,p.height=Np/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function h(p,g,m){for(var v=g.x,y=g.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),E=l(e),x=c()<.5?1:-1,k=-x,w,A,_;(w=E(k+=x))&&!(A=~~w[0],_=~~w[1],Math.min(Math.abs(A),Math.abs(_))>=b);){if(g.x=v+A,g.y=y+_,g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])continue;if((!m||!SX(g,p,e[0]))&&(!m||TX(g,m))){for(var O=g.sprite,S=g.width>>5,T=e[0]>>5,D=g.x-(S<<4),M=D&127,C=32-M,N=g.y1-g.y0,W=(g.y+g.y0)*T+(D>>5),X,J=0;J<N;J++){X=0;for(var xe=0;xe<=S;xe++)p[W+xe]|=X<<C|(xe<S?(X=O[J*S+xe])>>>M:0);W+=T}return g.sprite=null,!0}}return!1}return f.words=function(p){return arguments.length?(u=p,f):u},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=Mo(p),f):n},f.fontStyle=function(p){return arguments.length?(r=Mo(p),f):r},f.fontWeight=function(p){return arguments.length?(a=Mo(p),f):a},f.rotate=function(p){return arguments.length?(o=Mo(p),f):o},f.text=function(p){return arguments.length?(t=Mo(p),f):t},f.spiral=function(p){return arguments.length?(l=DX[p]||p,f):l},f.fontSize=function(p){return arguments.length?(i=Mo(p),f):i},f.padding=function(p){return arguments.length?(s=Mo(p),f):s},f.random=function(p){return arguments.length?(c=p,f):c},f}function AX(e,t,n,i){if(t.sprite)return;var r=e.context,a=e.ratio;r.clearRect(0,0,(kc<<5)/a,Np/a);var o=0,s=0,l=0,u=n.length,c,f,d,h,p;for(--i;++i<u;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,c=r.measureText(t.text+"m").width*a,d=t.size<<1,t.rotate){var g=Math.sin(t.rotate*hw),m=Math.cos(t.rotate*hw),v=c*m,y=c*g,b=d*m,E=d*g;c=Math.max(Math.abs(v+E),Math.abs(v-E))+31>>5<<5,d=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else c=c+31>>5<<5;if(d>l&&(l=d),o+c>=kc<<5&&(o=0,s+=l,l=0),s+d>=Np)break;r.translate((o+(c>>1))/a,(s+(d>>1))/a),t.rotate&&r.rotate(t.rotate*hw),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var x=r.getImageData(0,0,(kc<<5)/a,Np/a).data,k=[];--i>=0;){if(t=n[i],!t.hasText)continue;for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)k[h]=0;if(o=t.xoff,o==null)return;s=t.yoff;var w=0,A=-1;for(p=0;p<d;p++){for(h=0;h<c;h++){var _=f*p+(h>>5),O=x[(s+p)*(kc<<5)+(o+h)<<2]?1<<31-h%32:0;k[_]|=O,w|=O}w?A=p:(t.y0++,d--,p--,s++)}t.y1=t.y0+A,t.sprite=k.slice(0,(t.y1-t.y0)*f)}}function SX(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,a=e.x-(r<<4),o=a&127,s=32-o,l=e.y1-e.y0,u=(e.y+e.y0)*n+(a>>5),c,f=0;f<l;f++){c=0;for(var d=0;d<=r;d++)if((c<<s|(d<r?(c=i[f*r+d])>>>o:0))&t[u+d])return!0;u+=n}return!1}function OX(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function TX(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function rR(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function CX(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function $X(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function Mo(e){return typeof e=="function"?e:function(){return e}}var DX={archimedean:rR,rectangular:CX},aR=["x","y","font","fontSize","fontStyle","fontWeight","angle"],RX=["text","font","rotate","fontSize","fontStyle","fontWeight"];function pw(e){$.call(this,_X(),e)}pw.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:aR}]};var FX=P(pw,$);FX.transform=function(e,t){e.size&&!(e.size[0]&&e.size[1])&&F("Wordcloud size dimensions must be non-zero.");function n(b){var E=e[b];return ge(E)&&t.modified(E.fields)}var i=e.modified();if(!(i||t.changed(t.ADD_REM)||RX.some(n)))return;var r=t.materialize(t.SOURCE).source,a=this.value,o=e.as||aR,s=e.fontSize||14,l;if(ge(s)?l=e.fontSizeRange:s=Yt(s),l){var u=s,c=Ee("sqrt")().domain(mr(r,u)).range(l);s=function(b){return c(u(b))}}r.forEach(function(b){b[o[0]]=NaN,b[o[1]]=NaN,b[o[3]]=0});for(var f=a.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(qn).layout(),d=a.size(),h=d[0]>>1,p=d[1]>>1,g=0,m=f.length,v,y;g<m;++g)v=f[g],y=v.datum,y[o[0]]=v.x+h,y[o[1]]=v.y+p,y[o[2]]=v.font,y[o[3]]=v.size,y[o[4]]=v.style,y[o[5]]=v.weight,y[o[6]]=v.rotate;return t.reflow(i).modifies(o)};var NX=Object.freeze({__proto__:null,wordcloud:pw});function IX(e){return new Uint8Array(e)}function MX(e){return new Uint16Array(e)}function _c(e){return new Uint32Array(e)}function jX(){var e=8,t=[],n=_c(0),i=Ip(0,e),r=Ip(0,e);return{data:function(){return t},seen:function(){return n=LX(n,t.length)},add:function(a){for(var o=0,s=t.length,l=a.length,u;o<l;++o)u=a[o],u._index=s++,t.push(u)},remove:function(a,o){var s=t.length,l=Array(s-a),u=t,c,f,d;for(f=0;!o[f]&&f<s;++f)l[f]=t[f],u[f]=f;for(d=f;f<s;++f)c=t[f],o[f]?u[f]=-1:(u[f]=d,i[d]=i[f],r[d]=r[f],l[d]=c,c._index=d++),i[f]=0;return t=l,u},size:function(){return t.length},curr:function(){return i},prev:function(){return r},reset:function(a){r[a]=i[a]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(a,o){i[a]|=o},clear:function(a,o){i[a]&=~o},resize:function(a,o){var s=i.length;(a>s||o>e)&&(e=Math.max(o,e),i=Ip(a,e,i),r=Ip(a,e))}}}function LX(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function Ip(e,t,n){var i=(t<257?IX:t<65537?MX:_c)(e);return n&&i.set(n),i}function oR(e,t,n){var i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(r,a){var o=this,s=o.bisect(o.range,r.value),l=r.index,u=s[0],c=s[1],f=l.length,d;for(d=0;d<u;++d)a[l[d]]|=i;for(d=c;d<f;++d)a[l[d]]|=i;return o}}}function sR(){var e=_c(0),t=[],n=0;function i(s,l,u){if(!l.length)return[];var c=n,f=l.length,d=Array(f),h=_c(f),p,g,m;for(m=0;m<f;++m)d[m]=s(l[m]),h[m]=m;if(d=PX(d,h),c)p=t,g=e,t=Array(c+f),e=_c(c+f),zX(u,p,g,c,d,h,f,t,e);else{if(u>0)for(m=0;m<f;++m)h[m]+=u;t=d,e=h}return n=c+f,{index:h,value:d}}function r(s,l){var u=n,c,f,d;for(f=0;!l[e[f]]&&f<u;++f);for(d=f;f<u;++f)l[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=u-s}function a(s){for(var l=0,u=n;l<u;++l)e[l]=s[e[l]]}function o(s,l){var u;return l?u=l.length:(l=t,u=n),[z5(l,s[0],0,u),Qr(l,s[1],0,u)]}return{insert:i,remove:r,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function PX(e,t){return e.sort.call(t,function(n,i){var r=e[n],a=e[i];return r<a?-1:r>a?1:0}),Y5(e,t)}function zX(e,t,n,i,r,a,o,s,l){var u=0,c=0,f;for(f=0;u<i&&c<o;++f)t[u]<r[c]?(s[f]=t[u],l[f]=n[u++]):(s[f]=r[c],l[f]=a[c++]+e);for(;u<i;++u,++f)s[f]=t[u],l[f]=n[u];for(;c<o;++c,++f)s[f]=r[c],l[f]=a[c]+e}function gw(e){$.call(this,jX(),e),this._indices=null,this._dims=null}gw.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var bi=P(gw,$);bi.transform=function(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(function(i){return t.modified(i.fields)});return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},bi.init=function(e,t){for(var n=e.fields,i=e.query,r=this._indices={},a=this._dims=[],o=i.length,s=0,l,u;s<o;++s)l=n[s].fname,u=r[l]||(r[l]=sR()),a.push(oR(u,s,i[s]));return this.eval(e,t)},bi.reinit=function(e,t){var n=t.materialize().fork(),i=e.fields,r=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=r.length,p={},g,m,v,y,b,E,x,k,w;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(E={},y=t.mod,x=0,k=y.length;x<k;++x)E[y[x]._index]=1;for(x=0;x<h;++x)w=i[x],(!o[x]||e.modified("fields",x)||t.modified(w.fields))&&(v=w.fname,(g=p[v])||(a[v]=m=sR(),p[v]=g=m.insert(w,t.source,0)),o[x]=oR(m,x,r[x]).onAdd(g,l));for(x=0,k=s.data().length;x<k;++x){if(b[x])continue;u[x]!==l[x]?f.push(x):E[x]&&l[x]!==c&&d.push(x)}return s.mask=(1<<h)-1,n},bi.eval=function(e,t){var n=t.materialize().fork(),i=this._dims.length,r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},bi.insert=function(e,t,n){var i=t.add,r=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=r.size(),f=c+i.length,d=a.length,h,p,g;r.resize(f,d),r.add(i);var m=r.curr(),v=r.prev(),y=r.all();for(h=0;h<d;++h)p=s[h].fname,g=l[p]||(l[p]=o[p].insert(s[h],i,c)),a[h].onAdd(g,m);for(;c<f;++c)v[c]=y,m[c]!==y&&u.push(c)},bi.modify=function(e,t){var n=t.mod,i=this.value,r=i.curr(),a=i.all(),o=e.mod,s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,r[u]!==a&&n.push(u)},bi.remove=function(e,t,n){var i=this._indices,r=this.value,a=r.curr(),o=r.prev(),s=r.all(),l={},u=n.rem,c=t.rem,f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in i)i[h].remove(d,l);return this.reindex(t,d,l),l},bi.reindex=function(e,t,n){var i=this._indices,r=this.value;e.runAfter(function(){var a=r.remove(t,n);for(var o in i)i[o].reindex(a)})},bi.update=function(e,t,n){var i=this._dims,r=e.query,a=t.stamp,o=i.length,s=0,l,u;for(n.filters=0,u=0;u<o;++u)e.modified("query",u)&&(l=u,++s);if(s===1)s=i[l].one,this.incrementOne(i[l],r[l],n.add,n.rem);else for(u=0,s=0;u<o;++u){if(!e.modified("query",u))continue;s|=i[u].one,this.incrementAll(i[u],r[u],a,n.add),n.rem=n.add}return s},bi.incrementAll=function(e,t,n,i){var r=this.value,a=r.seen(),o=r.curr(),s=r.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],g=e.one,m,v,y;if(f<h)for(m=f,v=Math.min(h,d);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(f>h)for(m=h,v=Math.min(f,p);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;if(d>p)for(m=Math.max(f,p),v=d;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(d<p)for(m=Math.max(h,d),v=p;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;e.range=t.slice()},bi.incrementOne=function(e,t,n,i){var r=this.value,a=r.curr(),o=e.index(),s=e.bisect(e.range),l=e.bisect(t),u=l[0],c=l[1],f=s[0],d=s[1],h=e.one,p,g,m;if(u<f)for(p=u,g=Math.min(f,c);p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(u>f)for(p=f,g=Math.min(u,d);p<g;++p)m=o[p],a[m]^=h,i.push(m);if(c>d)for(p=Math.max(u,d),g=c;p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(c<d)for(p=Math.max(f,c),g=d;p<g;++p)m=o[p],a[m]^=h,i.push(m);e.range=t.slice()};function mw(e){$.call(this,null,e)}mw.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var BX=P(mw,$);BX.transform=function(e,t){var n=~(e.ignore||0),i=e.filter,r=i.mask;if((r&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=i.data(),s=i.curr(),l=i.prev(),u=function(c){return s[c]&n?null:o[c]};return a.filter(a.MOD,u),r&r-1?(a.filter(a.ADD,function(c){var f=s[c]&n,d=!f&&f^l[c]&n;return d?o[c]:null}),a.filter(a.REM,function(c){var f=s[c]&n,d=f&&!(f^(f^l[c]&n));return d?o[c]:null})):(a.filter(a.ADD,u),a.filter(a.REM,function(c){return(s[c]&n)===r?o[c]:null})),a.filter(a.SOURCE,function(c){return u(c._index)})};var UX=Object.freeze({__proto__:null,crossfilter:gw,resolvefilter:mw});const qX="5.13.0";function WX(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),lR(t,e.description()))}function lR(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function GX(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const vw="default";function HX(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:vw,item:null}));e.on(e.events("view","mousemove"),t,function(n,i){const r=t.value,a=r?Y(r)?r:r.user:vw,o=i.item&&i.item.cursor||null;return r&&a===r.user&&o==r.item?r:{user:a,item:o}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),yw(e,i&&i!==vw?i:r||i),r},{cursor:t})}function yw(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function Mp(e,t){var n=e._runtime.data;return Q(n,t)||F("Unrecognized data set: "+t),n[t]}function YX(e,t){return arguments.length<2?Mp(this,e).values.value:jp.call(this,e,oo().remove(Fi).insert(t))}function jp(e,t){yk(t)||F("Second argument to changes must be a changeset.");var n=Mp(this,e);return n.modified=!0,this.pulse(n.input,t)}function VX(e,t){return jp.call(this,e,oo().insert(t))}function XX(e,t){return jp.call(this,e,oo().remove(t))}function uR(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function cR(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Lp(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function JX(e){var t=Lp(e),n=uR(e),i=cR(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(function(r){try{r(n,i)}catch(a){e.error(a)}})}function KX(e,t,n){var i=e._renderer,r=i&&i.canvas(),a,o,s;return r&&(s=Lp(e),o=t.changedTouches?t.changedTouches[0]:t,a=sh(o,r),a[0]-=s[0],a[1]-=s[1]),t.dataflow=e,t.item=n,t.vega=QX(e,n,a),t}function QX(e,t,n){var i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(o){var s=i,l;if(o){for(l=t;l;l=l.mark.group)if(l.mark.name===o){s=l;break}}return s&&s.mark&&s.mark.interactive?s:{}}function a(o){if(!o)return n;Y(o)&&(o=r(o));for(var s=n.slice();o;)s[0]-=o.x||0,s[1]-=o.y||0,o=o.mark&&o.mark.group;return s}return{view:Yt(e),item:Yt(t||{}),group:r,xy:a,x:function(o){return a(o)[0]},y:function(o){return a(o)[1]}}}const fR="view",ZX="timer",eJ="window",tJ={trap:!1};function nJ(e){const t=fe({defaults:{}},e),n=(i,r)=>{r.forEach(a=>{I(i[a])&&(i[a]=Et(i[a]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function iJ(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function Pp(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||K(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function rJ(e,t,n){var i=this,r=new od(n),a=function(u,c){i.runAsync(null,()=>{e===fR&&iJ(i,t)&&u.preventDefault(),r.receive(KX(i,u,c))})},o;if(e===ZX)Pp(i,"timer",t)&&i.timer(a,t);else if(e===fR)Pp(i,"view",t)&&i.addEventListener(t,a,tJ);else if(e===eJ?Pp(i,"window",t)&&typeof window!="undefined"&&(o=[window]):typeof document!="undefined"&&(Pp(i,"selector",t)&&(o=document.querySelectorAll(e))),!o)i.warn("Can not resolve event source: "+e);else{for(var s=0,l=o.length;s<l;++s)o[s].addEventListener(t,a);i._eventListeners.push({type:t,sources:o,handler:a})}return r}function dR(e){return e.item}function hR(e){return e.item.mark.source}function pR(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function aJ(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",dR),hR,pR(e)),this.on(this.events("view","mouseout",dR),hR,pR(t)),this}function oJ(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,a;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(a=n[i],r=a.sources.length;--r>=0;)a.sources[r].removeEventListener(a.type,a.handler);return e&&e.call(this,this._handler,null,null,null),this}function Ln(e,t,n){var i=document.createElement(e);for(var r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const sJ="vega-bind",lJ="vega-bind-name",uJ="vega-bind-radio";function cJ(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:a=>{a!==e.signal(i.signal)&&e.runAsync(null,function(){r.source=!0,e.signal(i.signal,a)})}},i.debounce&&(r.update=ck(i.debounce,r.update))),fJ(r,t,i,e.signal(i.signal)),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function fJ(e,t,n,i){const r=Ln("div",{class:sJ}),a=n.input==="radio"?r:r.appendChild(Ln("label"));a.appendChild(Ln("span",{class:lJ},n.name||n.signal)),t.appendChild(r);let o=dJ;switch(n.input){case"checkbox":o=hJ;break;case"select":o=pJ;break;case"radio":o=gJ;break;case"range":o=mJ;break}o(e,a,n,i)}function dJ(e,t,n,i){const r=Ln("input");for(const a in n)a!=="signal"&&a!=="element"&&r.setAttribute(a==="input"?"type":a,n[a]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=a=>r.value=a}function hJ(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const a=Ln("input",r);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=o=>a.checked=!!o||null}function pJ(e,t,n,i){const r=Ln("select",{name:n.signal}),a=n.labels||[];n.options.forEach((o,s)=>{const l={value:o};zp(o,i)&&(l.selected=!0),r.appendChild(Ln("option",l,(a[s]||o)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=o=>{for(let s=0,l=n.options.length;s<l;++s)if(zp(n.options[s],o)){r.selectedIndex=s;return}}}function gJ(e,t,n,i){const r=Ln("span",{class:uJ}),a=n.labels||[];t.appendChild(r),e.elements=n.options.map((o,s)=>{const l={type:"radio",name:n.signal,value:o};zp(o,i)&&(l.checked=!0);const u=Ln("input",l);u.addEventListener("change",()=>e.update(o));const c=Ln("label",{},(a[s]||o)+"");return c.prepend(u),r.appendChild(c),u}),e.set=o=>{const s=e.elements,l=s.length;for(let u=0;u<l;++u)zp(s[u].value,o)&&(s[u].checked=!0)}}function mJ(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,o=n.step||Zr(a,r,100),s=Ln("input",{type:"range",name:n.signal,min:a,max:r,step:o});s.value=i;const l=Ln("span",{},+i);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=c=>{s.value=c,l.textContent=c}}function zp(e,t){return e===t||e+""===t+""}function gR(e,t,n,i,r,a){return t=t||new i(e.loader()),t.initialize(n,uR(e),cR(e),Lp(e),r,a).background(e.background())}function bw(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function vJ(e,t,n,i){var r=new i(e.loader(),bw(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Lp(e),e);return t&&t.handlers().forEach(function(a){r.on(a.type,a.handler)}),r}function yJ(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,a=Mh(i);e=n._el=e?ww(n,e):null,WX(n),a||n.error("Unrecognized renderer type: "+i);const o=a.handler||Nu,s=e?a.renderer:a.headless;return n._renderer=s?gR(n,n._renderer,e,s):null,n._handler=vJ(n,n._handler,e,o),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=ww(n,t):e.appendChild(Ln("form",{class:"vega-bindings"})),n._bind.forEach(function(l){l.param.element&&r!=="container"&&(l.element=ww(n,l.param.element))}),n._bind.forEach(function(l){cJ(n,l.element||t,l)})),n}function ww(e,t){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const Ac=e=>+e||0,bJ=e=>({top:e,bottom:e,left:e,right:e});function mR(e){return K(e)?{top:Ac(e.top),bottom:Ac(e.bottom),left:Ac(e.left),right:Ac(e.right)}:bJ(Ac(e))}async function xw(e,t,n,i){const r=Mh(t),a=r&&r.headless;return a||F("Unrecognized renderer type: "+t),await e.runAsync(),gR(e,null,null,a,n,i).renderAsync(e._scenegraph.root)}async function wJ(e,t){e!==ba.Canvas&&e!==ba.SVG&&e!==ba.PNG&&F("Unrecognized image type: "+e);const n=await xw(this,e,t);return e===ba.SVG?xJ(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function xJ(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function EJ(e,t){const n=await xw(this,ba.Canvas,e,t);return n.canvas()}async function kJ(e){const t=await xw(this,ba.SVG,e);return t.svg()}function vR(e){const t=this.context.data[e];return t?t.values.value:[]}function _J(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function AJ(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Fi).insert(t)),1}function SJ(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const Sc=e=>function(t,n){const i=this.context.dataflow.locale();return i[e](n)(t)},OJ=Sc("format"),yR=Sc("timeFormat"),TJ=Sc("utcFormat"),CJ=Sc("timeParse"),$J=Sc("utcParse");var Bp=new Date(2e3,0,1);function Up(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Bp.setYear(2e3),Bp.setMonth(e),Bp.setDate(t),yR.call(this,Bp,n))}function DJ(e){return Up.call(this,e,1,"%B")}function RJ(e){return Up.call(this,e,1,"%b")}function FJ(e){return Up.call(this,0,2+e,"%A")}function NJ(e){return Up.call(this,0,2+e,"%a")}const IJ=":",MJ="@",Ew="%",bR="$";var jJ="RawCode",jo="Literal",LJ="Property",PJ="Identifier",zJ="ArrayExpression",BJ="BinaryExpression",wR="CallExpression",UJ="ConditionalExpression",qJ="LogicalExpression",WJ="MemberExpression",GJ="ObjectExpression",HJ="UnaryExpression";function wi(e){this.type=e}wi.prototype.visit=function(e){var t=this,n,i,r;if(e(t))return 1;for(n=YJ(t),i=0,r=n.length;i<r;++i)if(n[i].visit(e))return 1};function YJ(e){switch(e.type){case zJ:return e.elements;case BJ:case qJ:return[e.left,e.right];case wR:var t=e.arguments.slice();return t.unshift(e.callee),t;case UJ:return[e.test,e.consequent,e.alternate];case WJ:return[e.object,e.property];case GJ:return e.properties;case LJ:return[e.key,e.value];case HJ:return[e.argument];case PJ:case jo:case jJ:default:return[]}}var Xi,V,R,Pt,Oe,qp=1,Oc=2,Lo=3,Ea=4,Wp=5,Po=6,wn=7,Tc=8,VJ=9;Xi={},Xi[qp]="Boolean",Xi[Oc]="<end>",Xi[Lo]="Identifier",Xi[Ea]="Keyword",Xi[Wp]="Null",Xi[Po]="Numeric",Xi[wn]="Punctuator",Xi[Tc]="String",Xi[VJ]="RegularExpression";var XJ="ArrayExpression",JJ="BinaryExpression",KJ="CallExpression",QJ="ConditionalExpression",xR="Identifier",ZJ="Literal",eK="LogicalExpression",tK="MemberExpression",nK="ObjectExpression",iK="Property",rK="UnaryExpression",Ct="Unexpected token %0",aK="Unexpected number",oK="Unexpected string",sK="Unexpected identifier",lK="Unexpected reserved word",uK="Unexpected end of input",kw="Invalid regular expression",_w="Invalid regular expression: missing /",ER="Octal literals are not allowed in strict mode.",cK="Duplicate data property in object literal not allowed in strict mode",zt="ILLEGAL",Cc="Disabled.",fK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),dK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Gp(e,t){if(!e)throw new Error("ASSERT: "+t)}function Rr(e){return e>=48&&e<=57}function Aw(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function $c(e){return"01234567".indexOf(e)>=0}function hK(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Dc(e){return e===10||e===13||e===8232||e===8233}function Rc(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&fK.test(String.fromCharCode(e))}function Hp(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&dK.test(String.fromCharCode(e))}var pK={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function kR(){for(var e;R<Pt&&(e=V.charCodeAt(R),hK(e)||Dc(e));)++R}function Sw(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)R<Pt&&Aw(V[R])?(i=V[R++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):_e({},Ct,zt);return String.fromCharCode(r)}function gK(){var e,t,n,i;for(e=V[R],t=0,e==="}"&&_e({},Ct,zt);R<Pt&&!(e=V[R++],!Aw(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&_e({},Ct,zt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function _R(){var e,t;for(e=V.charCodeAt(R++),t=String.fromCharCode(e),e===92&&(V.charCodeAt(R)!==117&&_e({},Ct,zt),++R,e=Sw("u"),(!e||e==="\\"||!Rc(e.charCodeAt(0)))&&_e({},Ct,zt),t=e);R<Pt&&!(e=V.charCodeAt(R),!Hp(e));)++R,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),V.charCodeAt(R)!==117&&_e({},Ct,zt),++R,e=Sw("u"),(!e||e==="\\"||!Hp(e.charCodeAt(0)))&&_e({},Ct,zt),t+=e);return t}function mK(){var e,t;for(e=R++;R<Pt;){if(t=V.charCodeAt(R),t===92)return R=e,_R();if(Hp(t))++R;else break}return V.slice(e,R)}function vK(){var e,t,n;return e=R,t=V.charCodeAt(R)===92?_R():mK(),t.length===1?n=Lo:pK.hasOwnProperty(t)?n=Ea:t==="null"?n=Wp:t==="true"||t==="false"?n=qp:n=Lo,{type:n,value:t,start:e,end:R}}function Ow(){var e=R,t=V.charCodeAt(R),n,i=V[R],r,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++R,{type:wn,value:String.fromCharCode(t),start:e,end:R};default:if(n=V.charCodeAt(R+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return R+=2,{type:wn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:R};case 33:case 61:return R+=2,V.charCodeAt(R)===61&&++R,{type:wn,value:V.slice(e,R),start:e,end:R}}}if(o=V.substr(R,4),o===">>>=")return R+=4,{type:wn,value:o,start:e,end:R};if(a=o.substr(0,3),a===">>>"||a==="<<="||a===">>=")return R+=3,{type:wn,value:a,start:e,end:R};if(r=a.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return R+=2,{type:wn,value:r,start:e,end:R};if("<>=!+-*%&|^/".indexOf(i)>=0)return++R,{type:wn,value:i,start:e,end:R};_e({},Ct,zt)}function yK(e){for(var t="";R<Pt&&Aw(V[R]);)t+=V[R++];return t.length===0&&_e({},Ct,zt),Rc(V.charCodeAt(R))&&_e({},Ct,zt),{type:Po,value:parseInt("0x"+t,16),start:e,end:R}}function bK(e){for(var t="0"+V[R++];R<Pt&&$c(V[R]);)t+=V[R++];return(Rc(V.charCodeAt(R))||Rr(V.charCodeAt(R)))&&_e({},Ct,zt),{type:Po,value:parseInt(t,8),octal:!0,start:e,end:R}}function AR(){var e,t,n;if(n=V[R],Gp(Rr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=R,e="",n!=="."){if(e=V[R++],n=V[R],e==="0"){if(n==="x"||n==="X")return++R,yK(t);if($c(n))return bK(t);n&&Rr(n.charCodeAt(0))&&_e({},Ct,zt)}for(;Rr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="."){for(e+=V[R++];Rr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="e"||n==="E")if(e+=V[R++],n=V[R],(n==="+"||n==="-")&&(e+=V[R++]),Rr(V.charCodeAt(R)))for(;Rr(V.charCodeAt(R));)e+=V[R++];else _e({},Ct,zt);return Rc(V.charCodeAt(R))&&_e({},Ct,zt),{type:Po,value:parseFloat(e),start:t,end:R}}function wK(){var e="",t,n,i,r,a=!1;for(t=V[R],Gp(t==="'"||t==='"',"String literal must starts with a quote"),n=R,++R;R<Pt;)if(i=V[R++],i===t){t="";break}else if(i==="\\")if(i=V[R++],!i||!Dc(i.charCodeAt(0)))switch(i){case"u":case"x":V[R]==="{"?(++R,e+=gK()):e+=Sw(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:$c(i)?(r="01234567".indexOf(i),r!==0&&(a=!0),R<Pt&&$c(V[R])&&(a=!0,r=r*8+"01234567".indexOf(V[R++]),"0123".indexOf(i)>=0&&R<Pt&&$c(V[R])&&(r=r*8+"01234567".indexOf(V[R++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&V[R]===`
`&&++R;else{if(Dc(i.charCodeAt(0)))break;e+=i}return t!==""&&_e({},Ct,zt),{type:Tc,value:e,octal:a,start:n,end:R}}function xK(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(i,r){if(parseInt(r,16)<=1114111)return"x";_e({},kw)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){_e({},kw)}try{return new RegExp(e,t)}catch(i){return null}}function EK(){var e,t,n,i,r;for(e=V[R],Gp(e==="/","Regular expression literal must start with a slash"),t=V[R++],n=!1,i=!1;R<Pt;)if(e=V[R++],t+=e,e==="\\")e=V[R++],Dc(e.charCodeAt(0))&&_e({},_w),t+=e;else if(Dc(e.charCodeAt(0)))_e({},_w);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||_e({},_w),r=t.substr(1,t.length-2),{value:r,literal:t}}function kK(){var e,t,n;for(t="",n="";R<Pt&&!(e=V[R],!Hp(e.charCodeAt(0)));)++R,e==="\\"&&R<Pt?_e({},Ct,zt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_e({},kw,n),{value:n,literal:t}}function _K(){var e,t,n,i;return Oe=null,kR(),e=R,t=EK(),n=kK(),i=xK(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:R}}function AK(e){return e.type===Lo||e.type===Ea||e.type===qp||e.type===Wp}function SR(){var e;return kR(),R>=Pt?{type:Oc,start:R,end:R}:(e=V.charCodeAt(R),Rc(e)?vK():e===40||e===41||e===59?Ow():e===39||e===34?wK():e===46?Rr(V.charCodeAt(R+1))?AR():Ow():Rr(e)?AR():Ow())}function xn(){var e;return e=Oe,R=e.end,Oe=SR(),R=e.end,e}function OR(){var e;e=R,Oe=SR(),R=e}function SK(e){var t=new wi(XJ);return t.elements=e,t}function TR(e,t,n){var i=new wi(e==="||"||e==="&&"?eK:JJ);return i.operator=e,i.left=t,i.right=n,i}function OK(e,t){var n=new wi(KJ);return n.callee=e,n.arguments=t,n}function TK(e,t,n){var i=new wi(QJ);return i.test=e,i.consequent=t,i.alternate=n,i}function Tw(e){var t=new wi(xR);return t.name=e,t}function Fc(e){var t=new wi(ZJ);return t.value=e.value,t.raw=V.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function CR(e,t,n){var i=new wi(tK);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function CK(e){var t=new wi(nK);return t.properties=e,t}function $R(e,t,n){var i=new wi(iK);return i.key=t,i.value=n,i.kind=e,i}function $K(e,t){var n=new wi(rK);return n.operator=e,n.argument=t,n.prefix=!0,n}function _e(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,function(a,o){return Gp(o<i.length,"Message reference must be in range"),i[o]});throw n=new Error(r),n.index=R,n.description=r,n}function Yp(e){e.type===Oc&&_e(e,uK),e.type===Po&&_e(e,aK),e.type===Tc&&_e(e,oK),e.type===Lo&&_e(e,sK),e.type===Ea&&_e(e,lK),_e(e,Ct,e.value)}function Bt(e){var t=xn();(t.type!==wn||t.value!==e)&&Yp(t)}function je(e){return Oe.type===wn&&Oe.value===e}function Cw(e){return Oe.type===Ea&&Oe.value===e}function DK(){var e=[];for(R=Oe.start,Bt("[");!je("]");)je(",")?(xn(),e.push(null)):(e.push(zo()),je("]")||Bt(","));return xn(),SK(e)}function DR(){var e;return R=Oe.start,e=xn(),e.type===Tc||e.type===Po?(e.octal&&_e(e,ER),Fc(e)):Tw(e.value)}function RK(){var e,t,n,i;if(R=Oe.start,e=Oe,e.type===Lo)return n=DR(),Bt(":"),i=zo(),$R("init",n,i);if(e.type===Oc||e.type===wn)Yp(e);else return t=DR(),Bt(":"),i=zo(),$R("init",t,i)}function FK(){var e=[],t,n,i,r={},a=String;for(R=Oe.start,Bt("{");!je("}");)t=RK(),t.key.type===xR?n=t.key.name:n=a(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?_e({},cK):r[i]=!0,e.push(t),je("}")||Bt(",");return Bt("}"),CK(e)}function NK(){var e;return Bt("("),e=$w(),Bt(")"),e}var IK={if:1};function MK(){var e,t,n;if(je("("))return NK();if(je("["))return DK();if(je("{"))return FK();if(e=Oe.type,R=Oe.start,e===Lo||IK[Oe.value])n=Tw(xn().value);else if(e===Tc||e===Po)Oe.octal&&_e(Oe,ER),n=Fc(xn());else{if(e===Ea)throw new Error(Cc);e===qp?(t=xn(),t.value=t.value==="true",n=Fc(t)):e===Wp?(t=xn(),t.value=null,n=Fc(t)):je("/")||je("/=")?(n=Fc(_K()),OR()):Yp(xn())}return n}function jK(){var e=[];if(Bt("("),!je(")"))for(;R<Pt&&!(e.push(zo()),je(")"));)Bt(",");return Bt(")"),e}function LK(){var e;return R=Oe.start,e=xn(),AK(e)||Yp(e),Tw(e.value)}function PK(){return Bt("."),LK()}function zK(){var e;return Bt("["),e=$w(),Bt("]"),e}function BK(){var e,t,n;for(e=MK();;)if(je("."))n=PK(),e=CR(".",e,n);else if(je("("))t=jK(),e=OK(e,t);else if(je("["))n=zK(),e=CR("[",e,n);else break;return e}function RR(){var e=BK();if(Oe.type===wn&&(je("++")||je("--")))throw new Error(Cc);return e}function Vp(){var e,t;if(Oe.type!==wn&&Oe.type!==Ea)t=RR();else{if(je("++")||je("--"))throw new Error(Cc);if(je("+")||je("-")||je("~")||je("!"))e=xn(),t=Vp(),t=$K(e.value,t);else{if(Cw("delete")||Cw("void")||Cw("typeof"))throw new Error(Cc);t=RR()}}return t}function FR(e){var t=0;if(e.type!==wn&&e.type!==Ea)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function UK(){var e,t,n,i,r,a,o,s,l,u;if(e=Oe,l=Vp(),i=Oe,r=FR(i),r===0)return l;for(i.prec=r,xn(),t=[e,Oe],o=Vp(),a=[l,i,o];(r=FR(Oe))>0;){for(;a.length>2&&r<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=TR(s,l,o),a.push(n);i=xn(),i.prec=r,a.push(i),t.push(Oe),n=Vp(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)t.pop(),n=TR(a[u-1].value,a[u-2],n),u-=2;return n}function zo(){var e,t,n;return e=UK(),je("?")&&(xn(),t=zo(),Bt(":"),n=zo(),e=TK(e,t,n)),e}function $w(){var e=zo();if(je(","))throw new Error(Cc);return e}function NR(e){V=e,R=0,Pt=V.length,Oe=null,OR();var t=$w();if(Oe.type!==Oc)throw new Error("Unexpect token after expression.");return t}var IR={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function MR(e){function t(o,s,l,u){var c=e(s[0]);return l&&(c=l+"("+c+")",l.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(u<0?"":u===0?"()":"("+s.slice(1).map(e).join(",")+")")}function n(o,s,l){return function(u){return t(o,u,s,l)}}var i="new Date",r="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&F("Missing arguments to clamp function."),o.length>3&&F("Too many arguments to clamp function.");var s=o.map(e);return"Math.max("+s[1]+", Math.min("+s[2]+","+s[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),join:n("join",null),indexof:n("indexOf",null),lastindexof:n("lastIndexOf",null),slice:n("slice",null),reverse:function(o){return"("+e(o[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),replace:n("replace",r),trim:n("trim",r,0),regexp:a,test:n("test",a),if:function(o){o.length<3&&F("Missing arguments to if function."),o.length>3&&F("Too many arguments to if function.");var s=o.map(e);return"("+s[0]+"?"+s[1]+":"+s[2]+")"}}}function qK(e){var t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function WK(e){e=e||{};var t=e.whitelist?Et(e.whitelist):{},n=e.blacklist?Et(e.blacklist):{},i=e.constants||IR,r=(e.functions||MR)(f),a=e.globalvar,o=e.fieldvar,s={},l={},u=0,c=ge(a)?a:function(p){return a+'["'+p+'"]'};function f(p){if(Y(p))return p;var g=d[p.type];return g==null&&F("Unsupported type: "+p.type),g(p)}var d={Literal:function(p){return p.raw},Identifier:function(p){var g=p.name;return u>0?g:Q(n,g)?F("Illegal identifier: "+g):Q(i,g)?i[g]:Q(t,g)?g:(s[g]=1,c(g))},MemberExpression:function(p){var g=!p.computed,m=f(p.object);g&&(u+=1);var v=f(p.property);return m===o&&(l[qK(v)]=1),g&&(u-=1),m+(g?"."+v:"["+v+"]")},CallExpression:function(p){p.callee.type!=="Identifier"&&F("Illegal callee type: "+p.callee.type);var g=p.callee.name,m=p.arguments,v=Q(r,g)&&r[g];return v||F("Unrecognized function: "+g),ge(v)?v(m):v+"("+m.map(f).join(",")+")"},ArrayExpression:function(p){return"["+p.elements.map(f).join(",")+"]"},BinaryExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},UnaryExpression:function(p){return"("+p.operator+f(p.argument)+")"},ConditionalExpression:function(p){return"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")"},LogicalExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},ObjectExpression:function(p){return"{"+p.properties.map(f).join(",")+"}"},Property:function(p){u+=1;var g=f(p.key);return u-=1,g+":"+f(p.value)}};function h(p){var g={code:f(p),globals:Object.keys(s),fields:Object.keys(l)};return s={},l={},g}return h.functions=r,h.constants=i,h}function Dw(e,t,n,i){t[0].type!==jo&&F("First argument to data functions must be a string literal.");const r=t[0].value,a=IJ+r;if(!Q(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(o){}}function GK(e,t,n,i){t[0].type!==jo&&F("First argument to indata must be a string literal."),t[1].type!==jo&&F("Second argument to indata must be a string literal.");const r=t[0].value,a=t[1].value,o=MJ+a;Q(o,i)||(i[o]=n.getData(r).indataRef(n,a))}function En(e,t,n,i){if(t[0].type===jo)jR(n,i,t[0].value);else for(e in n.scales)jR(n,i,e)}function jR(e,t,n){const i=Ew+n;if(!Q(t,i))try{t[i]=e.scaleRef(n)}catch(r){}}function Fr(e,t){let n;return ge(e)?e:Y(e)?(n=t.scales[e])&&n.value:void 0}function HK(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=En,n._range=En,n._scale=En;const i=r=>"_["+(r.type===jo?B(Ew+r.value):B(Ew)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function Rw(e,t){return function(n,i,r){if(n){const a=Fr(n,(r||this).context);return a&&a.path[e](i)}else return t(i)}}const YK=Rw("area",$G),VK=Rw("bounds",NG),XK=Rw("centroid",zG);function JK(e){let t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function Fw(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function KK(){return Fw(this.context.dataflow,"warn",arguments)}function QK(){return Fw(this.context.dataflow,"info",arguments)}function ZK(){return Fw(this.context.dataflow,"debug",arguments)}function Nw(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Iw(e){const t=va(e),n=Nw(t.r),i=Nw(t.g),r=Nw(t.b);return .2126*n+.7152*i+.0722*r}function eQ(e,t){const n=Iw(e),i=Iw(t),r=Math.max(n,i),a=Math.min(n,i);return(r+.05)/(a+.05)}function tQ(){var e=[].slice.call(arguments);return e.unshift({}),fe.apply(null,e)}function LR(e,t){return e===t||e!==e&&t!==t?!0:I(e)?I(t)&&e.length===t.length?nQ(e,t):!1:K(e)&&K(t)?PR(e,t):!1}function nQ(e,t){for(let n=0,i=e.length;n<i;++n)if(!LR(e[n],t[n]))return!1;return!0}function PR(e,t){for(let n in e)if(!LR(e[n],t[n]))return!1;return!0}function zR(e){return t=>PR(e,t)}function iQ(e,t,n,i,r,a){let o=this.context.dataflow,s=this.context.data[e],l=s.input,u=s.changes,c=o.stamp(),f,d;if(o._trigger===!1||!(l.value.length||t||i))return 0;if((!u||u.stamp<c)&&(s.changes=u=o.changeset(),u.stamp=c,o.runAfter(function(){s.modified=!0,o.pulse(l,u).run()},!0,1)),n&&(f=n===!0?Fi:I(n)||id(n)?n:zR(n),u.remove(f)),t&&u.insert(t),i&&(f=zR(i),l.value.some(f)?u.remove(f):u.insert(i)),r)for(d in a)u.modify(r,d,a[d]);return 1}function rQ(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function aQ(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}function oQ(e,t,n){return Dy(e||0,t||0,n||0)}function sQ(e,t){const n=Fr(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function lQ(e,t){const n=Fr(e,(t||this).context);return n?n.copy():void 0}function uQ(e,t){const n=Fr(e,(t||this).context);return n?n.domain():[]}function cQ(e,t,n){const i=Fr(e,(n||this).context);return i?I(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function fQ(e,t){const n=Fr(e,(t||this).context);return n&&n.range?n.range():[]}function dQ(e,t,n){const i=Fr(e,(n||this).context);return i?i(t):void 0}function hQ(e,t,n,i,r){e=Fr(e,(r||this).context);const a=QA(t,n);let o=e.domain(),s=o[0],l=ve(o),u=Ht;return l-s?u=MT(e,s,l):e=(e.interpolator?Ee("sequential")().interpolator(e.interpolator()):Ee("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+i||15),s!==o[0]&&o.unshift(s),l!==ve(o)&&o.push(l)),o.forEach(c=>a.stop(u(c),e(c))),a}function pQ(e,t,n){const i=Fr(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function gQ(e){let t=null;return function(n){return n?Eu(n,t=t||Ls(e)):e}}const BR=e=>e.data;function UR(e,t){const n=vR.call(t,e);return n.root&&n.root.lookup||{}}function mQ(e,t,n){const i=UR(e,this),r=i[t],a=i[n];return r&&a?r.path(a).map(BR):void 0}function vQ(e,t){const n=UR(e,this)[t];return n?n.ancestors().map(BR):void 0}const qR=()=>typeof window!="undefined"&&window||null;function yQ(){const e=qR();return e?e.screen:{}}function bQ(){const e=qR();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function wQ(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}const WR="intersect",GR="union",xQ="vlMulti",HR="or",EQ="and";var kQ="E",_Q="R",AQ="R-E",SQ="R-LE",OQ="R-RE",YR="index:unit";function VR(e,t){for(var n=t.fields,i=t.values,r=n.length,a=0,o,s;a<r;++a)if(s=n[a],s.getter=Ri.getter||Ri(s.field),o=s.getter(e),io(o)&&(o=cn(o)),io(i[a])&&(i[a]=cn(i[a])),io(i[a][0])&&(i[a]=i[a].map(cn)),s.type===kQ){if(I(i[a])?i[a].indexOf(o)<0:o!==i[a])return!1}else if(s.type===_Q){if(!Ql(o,i[a]))return!1}else if(s.type===OQ){if(!Ql(o,i[a],!0,!1))return!1}else if(s.type===AQ){if(!Ql(o,i[a],!1,!1))return!1}else if(s.type===SQ&&!Ql(o,i[a],!1,!0))return!1;return!0}function TQ(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a=i?i[YR]&&i[YR].value:void 0,o=n===WR,s=r.length,l=0,u,c,f,d,h;l<s;++l)if(u=r[l],a&&o){if(c=c||{},f=c[d=u.unit]||0,f===-1)continue;if(h=VR(t,u),c[d]=h?-1:++f,h&&a.size===1)return!0;if(!h&&f===a.get(d).count)return!1}else if(h=VR(t,u),o^h)return h;return s&&o}function CQ(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a={},o={},s={},l,u,c,f,d,h,p,g,m,v=r.length,y=0,b,E;y<v;++y){for(l=r[y],f=l.unit,u=l.fields,c=l.values,b=0,E=u.length;b<E;++b)d=u[b],h=a[d.field]||(a[d.field]={}),p=h[f]||(h[f]=[]),s[d.field]=g=d.type.charAt(0),m=XR[g+"_union"],h[f]=m(p,G(c[b]));n&&(p=o[f]||(o[f]=[]),p.push(G(c).reduce((x,k,w)=>(x[u[w].field]=k,x),{})))}return t=t||GR,Object.keys(a).forEach(function(x){a[x]=Object.keys(a[x]).map(k=>a[x][k]).reduce((k,w)=>k===void 0?w:XR[s[x]+"_"+t](k,w))}),r=Object.keys(o),n&&r.length&&(a[xQ]=t===GR?{[HR]:r.reduce((x,k)=>(x.push.apply(x,o[k]),x),[])}:{[EQ]:r.map(x=>({[HR]:o[x]}))}),a}var XR={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(function(n){return t.indexOf(n)>=0}):t},R_union:function(e,t){var n=cn(t[0]),i=cn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=cn(t[0]),i=cn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const $Q=":",DQ="@";function JR(e,t,n,i){t[0].type!==jo&&F("First argument to selection functions must be a string literal.");const r=t[0].value,a=t.length>=2&&ve(t).value,o="unit",s=DQ+o,l=$Q+r;a===WR&&!Q(i,s)&&(i[s]=n.getData(r).indataRef(n,o)),Q(i,l)||(i[l]=n.getData(r).tuplesRef())}function RQ(e,t,n){if(!e)return[];const[i,r]=e,a=new ot().set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return hC(o,a,FQ(t))}function FQ(e){let t=null;if(e){const n=G(e.marktype),i=G(e.markname);t=r=>(!n.length||n.some(a=>r.marktype===a))&&(!i.length||i.some(a=>r.name===a))}return t}const Nc={random:function(){return qn()},cumulativeNormal:Sd,cumulativeLogNormal:Q0,cumulativeUniform:nv,densityNormal:Y0,densityLogNormal:K0,densityUniform:tv,quantileNormal:Od,quantileLogNormal:Z0,quantileUniform:iv,sampleNormal:Ad,sampleLogNormal:J0,sampleUniform:ev,isArray:I,isBoolean:no,isDate:io,isDefined:function(e){return e!==void 0},isNumber:De,isObject:K,isRegExp:Gz,isString:Y,isTuple:id,isValid:function(e){return e!=null&&e===e},toBoolean:dk,toDate:hk,toNumber:cn,toString:pk,flush:Wz,lerp:Hz,merge:tQ,pad:Jz,peek:ve,span:ed,inrange:Ql,truncate:Qz,rgb:va,lab:Eh,hcl:kh,hsl:wh,luminance:Iw,contrast:eQ,sequence:so,format:OJ,utcFormat:TJ,utcParse:$J,utcOffset:h_,utcSequence:m_,timeFormat:yR,timeParse:CJ,timeOffset:d_,timeSequence:g_,timeUnitSpecifier:Xk,monthFormat:DJ,monthAbbrevFormat:RJ,dayFormat:FJ,dayAbbrevFormat:NJ,quarter:Iz,utcquarter:Mz,week:i_,utcweek:o_,dayofyear:n_,utcdayofyear:a_,warn:KK,info:QK,debug:ZK,extent:mr,inScope:JK,intersect:RQ,clampRange:jz,pinchDistance:rQ,pinchAngle:aQ,screen:yQ,containerSize:wQ,windowSize:bQ,bandspace:oQ,setdata:AJ,pathShape:gQ,panLinear:Dz,panLog:Rz,panPow:Fz,panSymlog:Nz,zoomLinear:ak,zoomLog:ok,zoomPow:Xm,zoomSymlog:sk,encode:SJ,modify:iQ},NQ=["view","item","group","xy","x","y"],IQ="event.vega.",KR="this.",Mw={};function MQ(e){const t=MR(e);NQ.forEach(n=>t[n]=IQ+n);for(let n in Nc)t[n]=KR+n;return fe(t,HK(e,Nc,Mw)),t}function mt(e,t,n){return arguments.length===1?Nc[e]:(Nc[e]=t,n&&(Mw[e]=n),jw&&(jw.functions[e]=KR+e),this)}mt("bandwidth",sQ,En),mt("copy",lQ,En),mt("domain",uQ,En),mt("range",fQ,En),mt("invert",cQ,En),mt("scale",dQ,En),mt("gradient",hQ,En),mt("geoArea",YK,En),mt("geoBounds",VK,En),mt("geoCentroid",XK,En),mt("geoShape",pQ,En),mt("indata",_J,GK),mt("data",vR,Dw),mt("treePath",mQ,Dw),mt("treeAncestors",vQ,Dw),mt("vlSelectionTest",TQ,JR),mt("vlSelectionResolve",CQ,JR);const QR={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_["+B(bR+e)+"]",functions:MQ,constants:IR,visitors:Mw};var jw=WK(QR);function Ji(e,t){var n={},i,r;try{e=Y(e)?e:B(e)+"",i=NR(e)}catch(a){F("Expression parse error: "+e)}return i.visit(a=>{if(a.type!==wR)return;var o=a.callee.name,s=QR.visitors[o];s&&s(o,a.arguments,t,n)}),r=jw(i),r.globals.forEach(a=>{var o=bR+a;!Q(n,o)&&t.getSignal(a)&&(n[o]=t.signalRef(a))}),{$expr:fe({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function jQ(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const LQ=Et(["rule"]),ZR=Et(["group","image","rect"]);function PQ(e,t){let n="";return LQ[t]||(e.x2&&(e.x?(ZR[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(ZR[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function Lw(e){return(e+"").toLowerCase()}function zQ(e){return Lw(e)==="operator"}function BQ(e){return Lw(e)==="collect"}function Ic(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");var i=Function.apply(null,t.concat(n));return e&&e.functions?i.bind(e.functions):i}function UQ(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var qQ={operator:(e,t)=>Ic(e,["_"],t.code),parameter:(e,t)=>Ic(e,["datum","_"],t.code),event:(e,t)=>Ic(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return Ic(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const a in i){const o="o["+B(a)+"]";r+=`$=${i[a].code};if(${o}!==$)${o}=$,m=1;`}return r+=PQ(i,n),r+="return m;",Ic(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(B).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(a,o)=>{const s=t[o];let l,u;return a.path?(l=`a${a.path}`,u=`b${a.path}`):((n=n||{})["f"+o]=a,l=`this.f${o}(a)`,u=`this.f${o}(b)`),UQ(l,u,-s,s)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function WQ(e){const t=this;zQ(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function GQ(e){const t=this;if(e.params){const n=t.get(e.id);n||F("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function HQ(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=I(r)?r.map(a=>eF(a,n,t)):eF(r,n,t)}return t}function eF(e,t,n){if(!e||!K(e))return e;for(let i=0,r=tF.length,a;i<r;++i)if(a=tF[i],Q(e,a.key))return a.parse(e,t,n);return e}var tF=[{key:"$ref",parse:YQ},{key:"$key",parse:XQ},{key:"$expr",parse:VQ},{key:"$field",parse:JQ},{key:"$encode",parse:QQ},{key:"$compare",parse:KQ},{key:"$context",parse:ZQ},{key:"$subflow",parse:eZ},{key:"$tupleid",parse:tZ}];function YQ(e,t){return t.get(e.$ref)||F("Operator not defined: "+e.$ref)}function VQ(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Dn(t.parameterExpression(e.$expr),e.$fields,e.$name))}function XQ(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=fk(e.$key,e.$flat,t.expr.codegen))}function JQ(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Ri(e.$field,e.$name,t.expr.codegen))}function KQ(e,t){const n="c:"+e.$compare+"_"+e.$order,i=G(e.$compare).map(r=>r&&r.$tupleid?ee:r);return t.fn[n]||(t.fn[n]=lk(i,e.$order,t.expr.codegen))}function QQ(e,t){const n=e.$encode,i={};for(const r in n){const a=n[r];i[r]=Dn(t.encodeExpression(a.$expr),a.$fields),i[r].output=a.$output}return i}function ZQ(e,t){return t}function eZ(e,t){const n=e.$subflow;return function(i,r,a){const o=t.fork().parse(n),s=o.get(n.operators[0].id),l=o.signals.parent;return l&&l.set(a),s.detachSubflow=()=>t.detach(o),s}}function tZ(){return ee}function nZ(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(a=>t.get(a)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(a=>t.get(a)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&F("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function iZ(e){var t=this,n=K(n=e.source)?n.$ref:n,i=t.get(n),r=null,a=e.update,o=void 0;i||F("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),a&&a.$expr&&(a.$params&&(o=t.parseParameters(a.$params)),a=t.handlerExpression(a.$expr)),t.update(e,i,r,a,o)}var rZ={skip:!0};function aZ(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(a=>{var o=t.signals[a];e.signals(a,o)&&(i[a]=o.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(a=>{var o=t.data[a];e.data(a,o)&&(r[a]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(a=>a.getState(e))),n}function oZ(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(a=>{n.update(t.signals[a],r[a],rZ)}),Object.keys(i||{}).forEach(a=>{n.pulse(t.data[a].input,n.changeset().remove(Fi).insert(i[a]))}),(e.subcontext||[]).forEach((a,o)=>{var s=t.subcontext[o];s&&s.setState(a)})}function nF(e,t,n,i){return new iF(e,t,n,i)}function iF(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||qQ,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function rF(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}iF.prototype=rF.prototype={fork(){const e=new rF(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),BQ(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){var a=n.get(e.parent.$ref);a?(i.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(e.parent.$ref),i.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const s=n.data[o]||(n.data[o]={});e.data[o].forEach(l=>s[l]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Lw(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:jQ,parseOperator:WQ,parseOperatorParameters:GQ,parseParameters:HQ,parseStream:nZ,parseUpdate:iZ,getState:aZ,setState:oZ};function sZ(e,t,n){return nF(e,Rs,Nc,n).parse(t)}function lZ(e){var t=this._runtime.scales;return Q(t,e)||F("Unrecognized scale or projection: "+e),t[e].value}var aF="width",oF="height",Pw="padding",sF={skip:!0};function lF(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===Pw?i.left+i.right:0)}function uF(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===Pw?i.top+i.bottom:0)}function uZ(e){var t=e._signals,n=t[aF],i=t[oF],r=t[Pw];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,function(s){e._width=s.size,e._viewWidth=lF(e,s.size),a()},{size:n}),e._resizeHeight=e.add(null,function(s){e._height=s.size,e._viewHeight=uF(e,s.size),a()},{size:i});var o=e.add(null,a,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function cZ(e,t,n,i,r,a){this.runAfter(function(o){var s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(aF,n,sF),o._resizeWidth.skip(!0)),o.height()!==i&&(s=1,o.signal(oF,i,sF),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),s&&o.run("enter"),a&&o.runAfter(l=>l.resize())},!1,1)}function fZ(e){return this._runtime.getState(e||{data:dZ,signals:hZ,recurse:!0})}function dZ(e,t){return t.modified&&I(t.input.value)&&e.indexOf("_:vega:_")}function hZ(e,t){return!(e==="parent"||t instanceof Rs.proxy)}function pZ(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function gZ(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(MY(n,t))}function mZ(e,t,n,i){var r=e.element();r&&r.setAttribute("title",vZ(i))}function vZ(e){return e==null?"":I(e)?cF(e):K(e)&&!io(e)?yZ(e):e+""}function yZ(e){return Object.keys(e).map(function(t){var n=e[t];return t+": "+(I(n)?cF(n):fF(n))}).join(`
`)}function cF(e){return"["+e.map(fF).join(", ")+"]"}function fF(e){return I(e)?"[…]":K(e)&&!io(e)?"{…}":e}function dF(e,t){const n=this;if(t=t||{},Ds.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const a=fe({},e.locale,t.locale);n.locale(P_(a.number,a.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||ba.Canvas,n._scenegraph=new _y();const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||mZ,n._redraw=!0,n._handler=new Nu().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=nJ(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=sZ(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(a=>({state:null,param:fe({},a)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=lF(n,n._width),n._viewHeight=uF(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,uZ(n),GX(n),HX(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}var le=P(dF,Ds);le.evaluate=async function(e,t,n){if(await Ds.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,JX(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&nd(this,n),this},le.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},le.description=function(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&lR(this._el,this._desc=t),this}return this._desc},le.container=function(){return this._el},le.scenegraph=function(){return this._scenegraph},le.origin=function(){return this._origin.slice()};function Xp(e,t){return Q(e._signals,t)?e._signals[t]:F("Unrecognized signal name: "+B(t))}le.signal=function(e,t,n){var i=Xp(this,e);return arguments.length===1?i.value:this.update(i,t,n)},le.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},le.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},le.padding=function(e){return arguments.length?this.signal("padding",mR(e)):mR(this.signal("padding"))},le.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},le.background=function(e){return arguments.length?this.signal("background",e):this.signal("background")},le.renderer=function(e){return arguments.length?(Mh(e)||F("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},le.tooltip=function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},le.loader=function(e){return arguments.length?(e!==this._loader&&(Ds.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},le.resize=function(){return this._autosize=1,this.touch(Xp(this,"autosize"))},le._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},le._resizeView=cZ,le.addEventListener=function(e,t,n){var i=t;return n&&n.trap===!1||(i=bw(this,t),i.raw=t),this._handler.on(e,i),this},le.removeEventListener=function(e,t){for(var n=this._handler.handlers(e),i=n.length,r,a;--i>=0;)if(a=n[i].type,r=n[i].handler,e===a&&(t===r||t===r.raw)){this._handler.off(a,r);break}return this},le.addResizeListener=function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},le.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this};function hF(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function pF(e,t,n,i){var r=hF(n,i);return r||(r=bw(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function gF(e,t,n){var i=hF(t,n);return i&&t._targets.remove(i),e}le.addSignalListener=function(e,t){return pF(this,e,Xp(this,e),t)},le.removeSignalListener=function(e,t){return gF(this,Xp(this,e),t)},le.addDataListener=function(e,t){return pF(this,e,Mp(this,e).values,t)},le.removeDataListener=function(e,t){return gF(this,Mp(this,e).values,t)},le.globalCursor=function(e){if(arguments.length){if(this._globalCursor!==!!e){const t=yw(this,null);this._globalCursor=!!e,t&&yw(this,t)}return this}else return this._globalCursor},le.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},le.timer=gZ,le.events=rJ,le.finalize=oJ,le.hover=aJ,le.data=YX,le.change=jp,le.insert=VX,le.remove=XX,le.scale=lZ,le.initialize=yJ,le.toImageURL=wJ,le.toCanvas=EJ,le.toSVG=kJ,le.getState=fZ,le.setState=pZ;function bZ(e){return K(e)?e:{type:e||"pad"}}const Mc=e=>+e||0,wZ=e=>({top:e,bottom:e,left:e,right:e});function xZ(e){return K(e)?e.signal?e:{top:Mc(e.top),bottom:Mc(e.bottom),left:Mc(e.left),right:Mc(e.right)}:wZ(Mc(e))}const vt=e=>K(e)&&!I(e)?fe({},e):{value:e};function mF(e,t,n,i){return n!=null?(K(n)&&!I(n)?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function $t(e,t,n){for(const i in t)mF(e,i,t[i]);for(const i in n)mF(e,i,n[i],"update")}function vl(e,t,n){for(const i in t){if(n&&Q(n,i))continue;e[i]=fe(e[i]||{},t[i])}return e}function yl(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var zw="mark",Bw="frame",Uw="scope",EZ="axis",kZ="axis-domain",_Z="axis-grid",AZ="axis-label",SZ="axis-tick",OZ="axis-title",TZ="legend",CZ="legend-band",$Z="legend-entry",DZ="legend-gradient",vF="legend-label",RZ="legend-symbol",FZ="legend-title",NZ="title",IZ="title-text",MZ="title-subtitle";function jZ(e,t,n,i,r){const a={},o={};let s,l,u,c;l="lineBreak",t==="text"&&r[l]!=null&&!yl(l,e)&&qw(a,l,r[l]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===Bw?r.group:n===zw?fe({},r.mark,r[t]):null;for(l in c)u=yl(l,e)||(l==="fill"||l==="stroke")&&(yl("fill",e)||yl("stroke",e)),u||qw(a,l,c[l]);G(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)yl(h,e)||qw(a,h,d[h])}),e=fe({},e);for(l in a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=fe(o,e.enter),s&&(e.update=fe(s,e.update)),e}function qw(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const yF=e=>Y(e)?B(e):e.signal?`(${e.signal})`:bF(e);function Jp(e){if(e.gradient!=null)return PZ(e);let t=e.signal?`(${e.signal})`:e.color?LZ(e.color):e.field!=null?bF(e.field):e.value!==void 0?B(e.value):void 0;return e.scale!=null&&(t=zZ(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Qp(e.exponent)})`),e.mult!=null&&(t+=`*${Qp(e.mult)}`),e.offset!=null&&(t+=`+${Qp(e.offset)}`),e.round&&(t=`round(${t})`),t}const Kp=(e,t,n,i)=>`(${e}(${[t,n,i].map(Jp).join(",")})+'')`;function LZ(e){return e.c?Kp("hcl",e.h,e.c,e.l):e.h||e.s?Kp("hsl",e.h,e.s,e.l):e.l||e.a?Kp("lab",e.l,e.a,e.b):e.r||e.g||e.b?Kp("rgb",e.r,e.g,e.b):null}function PZ(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:B(n));for(;t.length&&ve(t)==null;)t.pop();return t.unshift(yF(e.gradient)),`gradient(${t.join(",")})`}function Qp(e){return K(e)?"("+Jp(e)+")":e}function bF(e){return wF(K(e)?e:{datum:e})}function wF(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):F("Invalid field reference: "+B(e));return e.signal||(i=Y(i)?gr(i).map(B).join("]["):wF(i)),t+"["+i+"]"}function zZ(e,t){const n=yF(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band===1?"":"*"+Qp(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function BZ(e){let t="";return e.forEach(n=>{const i=Jp(n);t+=n.test?`(${n.test})?${i}:`:i}),ve(t)===":"&&(t+="null"),t}function xF(e,t,n,i,r,a){const o={};a=a||{},a.encoders={$encode:o},e=jZ(e,t,n,i,r.config);for(const s in e)o[s]=UZ(e[s],t,a,r);return a}function UZ(e,t,n,i){const r={},a={};for(const o in e)e[o]!=null&&(r[o]=WZ(qZ(e[o]),i,n,a));return{$expr:{marktype:t,channels:r},$fields:Object.keys(a),$output:Object.keys(e)}}function qZ(e){return I(e)?BZ(e):Jp(e)}function WZ(e,t,n,i){const r=Ji(e,t);return r.$fields.forEach(a=>i[a]=1),fe(n,r.$params),r.$expr}var GZ="outer",HZ=["value","update","init","react","bind"];function EF(e,t){F(e+' for "outer" push: '+B(t))}function kF(e,t){var n=e.name;if(e.push===GZ)t.signals[n]||EF("No prior signal definition",n),HZ.forEach(function(r){e[r]!==void 0&&EF("Invalid property ",r)});else{var i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Ww(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function Zp(e,t,n,i){return new Ww(e,t,n,i)}function eg(e,t){return Zp("operator",e,t)}function ne(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function jc(e,t){return t?{$field:e,$name:t}:{$field:e}}var Gw=jc("key");function _F(e,t){return{$compare:e,$order:t}}function YZ(e,t){var n={$key:e};return t&&(n.$flat=!0),n}var VZ="ascending",XZ="descending";function JZ(e){return K(e)?(e.order===XZ?"-":"+")+tg(e.op,e.field):""}function tg(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var Hw="scope",Yw="view";function yt(e){return e&&e.signal}function KZ(e){return e&&e.expr}function Lc(e){if(yt(e))return!0;if(K(e)){for(var t in e)if(Lc(e[t]))return!0}return!1}function xi(e,t){return e??t}function Bo(e){return e&&e.signal||e}var AF="timer";function Pc(e,t){var n=e.merge?ZZ:e.stream?eee:e.type?tee:F("Invalid stream specification: "+B(e));return n(e,t)}function QZ(e){return e===Hw?Yw:e||Yw}function ZZ(e,t){var n=e.merge.map(r=>Pc(r,t)),i=Vw({merge:n},e,t);return t.addStream(i).id}function eee(e,t){var n=Pc(e.stream,t),i=Vw({stream:n},e,t);return t.addStream(i).id}function tee(e,t){var n,i;return e.type===AF?(n=t.event(AF,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(QZ(e.source),e.type),i=Vw({stream:n},e,t),Object.keys(i).length===1?n:t.addStream(i).id}function Vw(e,t,n){var i=t.between;return i&&(i.length!==2&&F('Stream "between" parameter must have 2 entries: '+B(t)),e.between=[Pc(i[0],n),Pc(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(nee(t.marktype,t.markname,t.markrole)),t.source===Hw&&i.push("inScope(event.item)"),i.length&&(e.filter=Ji("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function nee(e,t,n){var i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}function Uo(e,t,n){return CF=t||iee,$F=n||lee,DF(e.trim()).map(Xw)}var iee="view",ng="[",ig="]",SF="{",OF="}",ree=":",TF=",",aee="@",oee=">",see=/[[\]{}]/,CF,$F,lee={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function uee(e){return $F[e]}function zc(e,t,n,i,r){for(var a=0,o=e.length,s;t<o;++t){if(s=e[t],!a&&s===n)return t;r&&r.indexOf(s)>=0?--a:i&&i.indexOf(s)>=0&&++a}return t}function DF(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=zc(e,r,TF,ng+SF,ig+OF),t.push(e.substring(n,r).trim()),n=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function Xw(e){return e[0]==="["?cee(e):fee(e)}function cee(e){var t=e.length,n=1,i,r;if(n=zc(e,n,ig,ng,ig),n===t)throw"Empty between selector: "+e;if(i=DF(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==oee)throw"Expected '>' after between selector: "+e;return i=i.map(Xw),r=Xw(e.slice(1).trim()),r.between?{between:i,stream:r}:(r.between=i,r)}function fee(e){var t={source:CF},n=[],i=[0,0],r=0,a=0,o=e.length,s=0,l,u;if(e[o-1]===OF){if(s=e.lastIndexOf(SF),s>=0){try{i=dee(e.substring(s+1,o-1))}catch(c){throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),o=e.length}else throw"Unmatched right brace: "+e;s=0}if(!o)throw e;if(e[0]===aee&&(r=++s),l=zc(e,s,ree),l<o&&(n.push(e.substring(a,l).trim()),a=s=++l),s=zc(e,s,ng),s===o)n.push(e.substring(a,o).trim());else if(n.push(e.substring(a,s).trim()),u=[],a=++s,a===o)throw"Unmatched left bracket: "+e;for(;s<o;){if(s=zc(e,s,ig),s===o)throw"Unmatched left bracket: "+e;if(u.push(e.substring(a,s).trim()),s<o-1&&e[++s]!==ng)throw"Expected left bracket: "+e;a=++s}if(!(o=n.length)||see.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],r?t.markname=n[0].slice(1):uee(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),u!=null&&(t.filter=u),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function dee(e){var t=e.split(TF);if(!e.length||t.length>2)throw e;return t.map(function(n){var i=+n;if(i!==i)throw e;return i})}const hee={code:"_.$value",ast:{type:"Identifier",value:"value"}};function pee(e,t,n){var i=e.events,r=e.update,a=e.encode,o=[],s={target:n};i||F("Signal update missing events specification."),Y(i)&&(i=Uo(i,t.isSubscope()?Hw:Yw)),i=G(i).filter(l=>l.signal||l.scale?(o.push(l),0):1),o.length>1&&(o=[mee(o)]),i.length&&o.push(i.length>1?{merge:i}:i[0]),a!=null&&(r&&F("Signal encode and update are mutually exclusive."),r="encode(item(),"+B(a)+")"),s.update=Y(r)?Ji(r,t):r.expr!=null?Ji(r.expr,t):r.value!=null?r.value:r.signal!=null?{$expr:hee,$params:{$value:t.signalRef(r.signal)}}:F("Invalid signal update specification."),e.force&&(s.options={force:!0}),o.forEach(function(l){t.addUpdate(fe(gee(l,t),s))})}function gee(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Pc(e,t)}}function mee(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function vee(e,t){var n=t.getSignal(e.name),i=e.update;e.init&&(i?F("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=Ji(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(function(r){pee(r,t,n.id)})}const Ce=e=>(t,n,i)=>Zp(e,n,t||void 0,i);var RF=Ce("aggregate"),yee=Ce("axisticks"),FF=Ce("bound"),Ei=Ce("collect"),NF=Ce("compare"),bee=Ce("datajoin"),IF=Ce("encode"),wee=Ce("expression"),xee=Ce("facet"),Eee=Ce("field"),kee=Ce("key"),_ee=Ce("legendentries"),Aee=Ce("load"),See=Ce("mark"),Oee=Ce("multiextent"),Tee=Ce("multivalues"),Cee=Ce("overlap"),$ee=Ce("params"),MF=Ce("prefacet"),Dee=Ce("projection"),Ree=Ce("proxy"),Fee=Ce("relay"),jF=Ce("render"),Nee=Ce("scale"),qo=Ce("sieve"),Iee=Ce("sortitems"),LF=Ce("viewlayout"),Mee=Ce("values"),jee=0,PF={min:"min",max:"max",count:"sum"};function Lee(e,t){var n=e.type||"linear";$T(n)||F("Unrecognized scale type: "+B(n)),t.addScale(e.name,{type:n,domain:void 0})}function Pee(e,t){var n=t.getScale(e.name).params,i;n.domain=zF(e.domain,e,t),e.range!=null&&(n.range=UF(e,t,n)),e.interpolate!=null&&Xee(e.interpolate,n),e.nice!=null&&(n.nice=Vee(e.nice)),e.bins!=null&&(n.bins=Yee(e.bins,t));for(i in e){if(Q(n,i)||i==="name")continue;n[i]=Qn(e[i],t)}}function Qn(e,t){return K(e)?e.signal?t.signalRef(e.signal):F("Unsupported object: "+B(e)):e}function rg(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Qn(n,t))}function ag(e){F("Can not find data set: "+B(e))}function zF(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&F("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(I(e)?zee:e.fields?Uee:Bee)(e,t,n)}function zee(e,t,n){return e.map(function(i){return Qn(i,n)})}function Bee(e,t,n){var i=n.getData(e.data);return i||ag(e.data),el(t.type)?i.valuesRef(n,e.field,BF(e.sort,!1)):FT(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function Uee(e,t,n){var i=e.data,r=e.fields.reduce(function(a,o){return o=Y(o)?{data:i,field:o}:I(o)||o.signal?qee(o,n):o,a.push(o),a},[]);return(el(t.type)?Wee:FT(t.type)?Gee:Hee)(e,n,r)}function qee(e,t){var n="_:vega:_"+jee++,i=Ei({});if(I(e))i.value={$ingest:e};else if(e.signal){var r="setdata("+B(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,qo({})]),{data:n,field:"data"}}function Wee(e,t,n){var i=BF(e.sort,!0),r,a,o,s,l;return r=n.map(function(u){var c=t.getData(u.data);return c||ag(u.data),c.countsRef(t,u.field,i)}),a={groupby:Gw,pulse:r},i&&(o=i.op||"count",l=i.field?tg(o,i.field):"count",a.ops=[PF[o]],a.fields=[t.fieldRef(l)],a.as=[l]),o=t.add(RF(a)),s=t.add(Ei({pulse:ne(o)})),l=t.add(Mee({field:Gw,sort:t.sortRef(i),pulse:ne(s)})),ne(l)}function BF(e,t){return e&&(!e.field&&!e.op?K(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?F("No field provided for sort aggregate op: "+e.op):t&&e.field&&(e.op&&!PF[e.op]&&F("Multiple domain scales can not be sorted using "+e.op))),e}function Gee(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||ag(r.data),a.domainRef(t,r.field)});return ne(t.add(Tee({values:i})))}function Hee(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||ag(r.data),a.extentRef(t,r.field)});return ne(t.add(Oee({extents:i})))}function Yee(e,t){return e.signal||I(e)?rg(e,t):t.objectProperty(e)}function Vee(e){return K(e)?{interval:Qn(e.interval),step:Qn(e.step)}:Qn(e)}function Xee(e,t){t.interpolate=Qn(e.type||e),e.gamma!=null&&(t.interpolateGamma=Qn(e.gamma))}function UF(e,t,n){var i=e.range,r=t.config.range;if(i.signal)return t.signalRef(i.signal);if(Y(i)){if(r&&Q(r,i))return e=fe({},e,{range:r[i]}),UF(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=el(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:F("Unrecognized scale range value: "+B(i))}else if(i.scheme){n.scheme=I(i.scheme)?rg(i.scheme,t):Qn(i.scheme,t),i.extent&&(n.schemeExtent=rg(i.extent,t)),i.count&&(n.schemeCount=Qn(i.count,t));return}else if(i.step){n.rangeStep=Qn(i.step,t);return}else{if(el(e.type)&&!I(i))return zF(i,e,t);I(i)||F("Unsupported range type: "+B(i))}return i.map(a=>(I(a)?rg:Qn)(a,t))}function Jee(e,t){var n=t.config.projection||{},i={};for(var r in e){if(r==="name")continue;i[r]=Jw(e[r],r,t)}for(r in n)i[r]==null&&(i[r]=Jw(n[r],r,t));t.addProjection(e.name,i)}function Jw(e,t,n){return I(e)?e.map(function(i){return Jw(i,t,n)}):K(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:F("Unsupported parameter object: "+B(e)):e}const ki="top",bl="left",wl="right",ka="bottom",qF="center",Kee="vertical",Qee="start",Zee="middle",ete="end",Kw="index",Qw="label",tte="offset",xl="perc",nte="perc2",Zn="value",Bc="guide-label",Zw="guide-title",ite="group-title",rte="group-subtitle",WF="symbol",og="gradient",ex="discrete",tx="size",ate="shape",ote="fill",ste="stroke",lte="strokeWidth",ute="strokeDash",cte="opacity",nx=[tx,ate,ote,ste,lte,ute,cte],Uc={name:1,style:1,interactive:1},be={value:0},ei={value:1};var sg="group",GF="rect",ix="rule",fte="symbol",Wo="text";function qc(e){return e.type=sg,e.interactive=e.interactive||!1,e}function kn(e,t){const n=(i,r)=>xi(e[i],xi(t[i],r));return n.isVertical=i=>Kee===xi(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>xi(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>xi(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>xi(e.columns,xi(t.columns,+n.isVertical(!0))),n}function HF(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function dte(e,t,n){var i=t.config.style[n];return i&&i[e]}function lg(e,t,n){return`item.anchor === '${Qee}' ? ${e} : item.anchor === '${ete}' ? ${t} : ${n}`}const rx=lg(B(bl),B(wl),B(qF));function hte(e){let t=e("tickBand"),n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},K(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function YF(e,t){return t?e?K(e)?Object.assign({},e,{offset:YF(e.offset,t)}):{value:e,offset:t}:t:e}function Pn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=vl(e.encode,t,Uc)):e.interactive=!1,e}function pte(e,t,n,i){var r=kn(e,n),a=r.isVertical(),o=r.gradientThickness(),s=r.gradientLength(),l,u,c,f,d,h;return a?(c=[0,1],f=[0,0],d=o,h=s):(c=[0,0],f=[1,0],d=s,h=o),l={enter:u={opacity:be,x:be,y:be,width:vt(d),height:vt(h)},update:fe({},u,{opacity:ei,fill:{gradient:t,start:c,stop:f}}),exit:{opacity:be}},$t(l,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),Pn({type:GF,role:DZ,encode:l},i)}function gte(e,t,n,i,r){var a=kn(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength(),u,c,f,d,h,p,g="";return o?(f="y",h="y2",d="x",p="width",g="1-"):(f="x",h="x2",d="y",p="height"),c={opacity:be,fill:{scale:t,field:Zn}},c[f]={signal:g+"datum."+xl,mult:l},c[d]=be,c[h]={signal:g+"datum."+nte,mult:l},c[p]=vt(s),u={enter:c,update:fe({},c,{opacity:ei}),exit:{opacity:be}},$t(u,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),Pn({type:GF,role:CZ,key:Zn,from:r,encode:u},i)}const mte=`datum.${xl}<=0?"${bl}":datum.${xl}>=1?"${wl}":"${qF}"`,vte=`datum.${xl}<=0?"${ka}":datum.${xl}>=1?"${ki}":"${Zee}"`;function VF(e,t,n,i){var r=kn(e,t),a=r.isVertical(),o=vt(r.gradientThickness()),s=r.gradientLength(),l=r("labelOverlap"),u,c,f,d,h,p="";return u={enter:c={opacity:be},update:f={opacity:ei,text:{field:Qw}},exit:{opacity:be}},$t(u,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:xi(e.labelLimit,t.gradientLabelLimit)}),a?(c.align={value:"left"},c.baseline=f.baseline={signal:vte},d="y",h="x",p="1-"):(c.align=f.align={signal:mte},c.baseline={value:"top"},d="x",h="y"),c[d]=f[d]={signal:p+"datum."+xl,mult:s},c[h]=f[h]=o,o.offset=xi(e.labelOffset,t.gradientLabelOffset)||0,l=l?{separation:r("labelSeparation"),method:l,order:"datum."+Kw}:void 0,Pn({type:Wo,role:vF,style:Bc,key:Zn,from:i,encode:u,overlap:l},n)}function yte(e,t,n,i,r){var a=kn(e,t),o=n.entries,s=!!(o&&o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d={},h=`(${r}) ? datum.${tte} : datum.${tx}`,p=u?vt(u):{field:tx},g=`datum.${Kw}`,m=`max(1, ${r})`,v,y,b,E,x,k,w;p.mult=.5,d={enter:v={opacity:be,x:{signal:h,mult:.5,offset:c},y:p},update:y={opacity:ei,x:v.x,y:v.y},exit:{opacity:be}};var A=null,_=null;return e.fill||(A=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),$t(d,{fill:a("symbolFillColor",A),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),nx.forEach(function(O){e[O]&&(y[O]=v[O]={scale:e[O],field:Zn})}),E=Pn({type:fte,role:RZ,key:Zn,from:f,clip:u?!0:void 0,encode:d},n.symbols),b=vt(c),b.offset=a("labelOffset"),d={enter:v={opacity:be,x:{signal:h,offset:b},y:p},update:y={opacity:ei,text:{field:Qw},x:v.x,y:v.y},exit:{opacity:be}},$t(d,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")}),x=Pn({type:Wo,role:vF,style:Bc,key:Zn,from:f,encode:d},n.labels),d={enter:{noBound:{value:!u},width:be,height:u?vt(u):be,opacity:be},exit:{opacity:be},update:y={opacity:ei,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(k=`ceil(item.mark.items.length / ${m})`,y.row.signal=`${g}%${k}`,y.column.signal=`floor(${g} / ${k})`,w={field:["row",g]}):(y.row.signal=`floor(${g} / ${m})`,y.column.signal=`${g} % ${m}`,w={field:g}),y.column.signal=`(${r})?${y.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:Kw}},qc({role:Uw,from:i,encode:vl(d,o,Uc),marks:[E,x],name:l,interactive:s,sort:w})}function bte(e,t){const n=kn(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const ax='item.orient === "left"',ox='item.orient === "right"',ug=`(${ax} || ${ox})`,wte=`datum.vgrad && ${ug}`,xte=lg('"top"','"bottom"','"middle"'),Ete=lg('"right"','"left"','"center"'),kte=`datum.vgrad && ${ox} ? (${Ete}) : (${ug} && !(datum.vgrad && ${ax})) ? "left" : ${rx}`,_te=`item._anchor || (${ug} ? "middle" : "start")`,Ate=`${wte} ? (${ax} ? -90 : 90) : 0`,Ste=`${ug} ? (datum.vgrad ? (${ox} ? "bottom" : "top") : ${xte}) : "top"`;function Ote(e,t,n,i){var r=kn(e,t),a;return a={enter:{opacity:be},update:{opacity:ei,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:be}},$t(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:_te},angle:{signal:Ate},align:{signal:kte},baseline:{signal:Ste},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Pn({type:Wo,role:FZ,style:Zw,from:i,encode:a},n)}function Tte(e,t){var n;return K(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+XF(e.path)+")":e.sphere&&(n="geoShape("+XF(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function XF(e){return K(e)&&e.signal?e.signal:B(e)}function JF(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===sg?Uw:t||zw}function Cte(e){return{marktype:e.type,name:e.name||void 0,role:e.role||JF(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function $te(e,t){return e&&e.signal?t.signalRef(e.signal):!(e===!1)}function sx(e,t){var n=V_(e.type);n||F("Unrecognized transform type: "+B(e.type));var i=Zp(n.type.toLowerCase(),null,KF(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function KF(e,t,n){var i={},r,a,o;for(a=0,o=e.params.length;a<o;++a)r=e.params[a],i[r.name]=Dte(r,t,n);return i}function Dte(e,t,n){var i=e.type,r=t[e.name];if(i==="index")return Rte(e,t,n);if(r===void 0){e.required&&F("Missing required "+B(t.type)+" parameter: "+B(e.name));return}else{if(i==="param")return Fte(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!yt(r)?r.map(function(a){return QF(e,a,n)}):QF(e,r,n)}function QF(e,t,n){var i=e.type;if(yt(t))return eN(i)?F("Expression references can not be signals."):lx(i)?n.fieldRef(t):tN(i)?n.compareRef(t):n.signalRef(t.signal);var r=e.expr||lx(i);return r&&Nte(t)?n.exprRef(t.expr,t.as):r&&Ite(t)?jc(t.field,t.as):eN(i)?Ji(t,n):Mte(i)?ne(n.getData(t).values):lx(i)?jc(t):tN(i)?n.compareRef(t):t}function Rte(e,t,n){return Y(t.from)||F('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function Fte(e,t,n){var i=t[e.name];return e.array?(I(i)||F("Expected an array of sub-parameters. Instead: "+B(i)),i.map(function(r){return ZF(e,r,n)})):ZF(e,i,n)}function ZF(e,t,n){var i,r,a,o,s;for(o=0,s=e.params.length;o<s;++o){r=e.params[o];for(a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}return r||F("Unsupported parameter: "+B(t)),i=fe(KF(r,t,n),r.key),ne(n.add($ee(i)))}function Nte(e){return e&&e.expr}function Ite(e){return e&&e.field}function Mte(e){return e==="data"}function eN(e){return e==="expr"}function lx(e){return e==="field"}function tN(e){return e==="compare"}function jte(e,t,n){var i,r,a,o,s;return e?(i=e.facet)&&(t||F("Only group marks can be faceted."),i.field!=null?o=s=cg(i,n):(e.data?s=ne(n.getData(e.data).aggregate):(a=sx(fe({type:"aggregate",groupby:G(i.groupby)},i.aggregate),n),a.params.key=n.keyRef(i.groupby),a.params.pulse=cg(i,n),o=s=ne(n.add(a))),r=n.keyRef(i.groupby,!0))):o=ne(n.add(Ei(null,[{}]))),o||(o=cg(e,n)),{key:r,pulse:o,parent:s}}function cg(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ne(t.getData(e.data).output)}function Go(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Go.fromEntries=function(e,t){var n=t.length,i=1,r=t[0],a=t[n-1],o=t[n-2],s=null;for(r&&r.type==="load"&&(r=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=ne(t[i-1]),e.add(t[i]),t[i].type==="aggregate"&&(s=t[i]);return new Go(e,r,o,a,s)};var Ho=Go.prototype;Ho.countsRef=function(e,t,n){var i=this,r=i.counts||(i.counts={}),a=nN(t),o,s,l;return a!=null&&(e=i.scope,o=r[a]),o?n&&n.field&&iN(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:ne(i.output)},n&&n.field&&iN(e,l,n),s=e.add(RF(l)),o=e.add(Ei({pulse:ne(s)})),o={agg:s,ref:ne(o)},a!=null&&(r[a]=o)),o.ref};function nN(e){return Y(e)?e:null}function iN(e,t,n){var i=tg(n.op,n.field),r;if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Wc(e,t,n,i,r,a,o){var s=t[n]||(t[n]={}),l=JZ(a),u=nN(r),c,f;if(u!=null&&(e=t.scope,u=u+(l?"|"+l:""),c=s[u]),!c){var d=a?{field:Gw,pulse:t.countsRef(e,r,a)}:{field:e.fieldRef(r),pulse:ne(t.output)};l&&(d.sort=e.sortRef(a)),f=e.add(Zp(i,void 0,d)),o&&(t.index[r]=f),c=ne(f),u!=null&&(s[u]=c)}return c}Ho.tuplesRef=function(){return ne(this.values)},Ho.extentRef=function(e,t){return Wc(e,this,"extent","extent",t,!1)},Ho.domainRef=function(e,t){return Wc(e,this,"domain","values",t,!1)},Ho.valuesRef=function(e,t,n){return Wc(e,this,"vals","values",t,n||!0)},Ho.lookupRef=function(e,t){return Wc(e,this,"lookup","tupleindex",t,!1)},Ho.indataRef=function(e,t){return Wc(e,this,"indata","tupleindex",t,!0,!0)};function Lte(e,t,n){var i=e.from.facet,r=i.name,a=cg(i,t),o,s,l,u;i.name||F("Facet must have a name: "+B(i)),i.data||F("Facet must reference a data set: "+B(i)),i.field?u=t.add(MF({field:t.fieldRef(i.field),pulse:a})):i.groupby?u=t.add(xee({key:t.keyRef(i.groupby),group:ne(t.proxy(n.parent)),pulse:a})):F("Facet must specify groupby or field: "+B(i)),o=t.fork(),s=o.add(Ei()),l=o.add(qo({pulse:ne(s)})),o.addData(r,new Go(o,s,s,l)),o.addSignal("parent",null),u.params.subflow={$subflow:o.parse(e).toRuntime()}}function Pte(e,t,n){var i=t.add(MF({pulse:n.pulse})),r=t.fork();r.add(qo()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function rN(e,t,n){var i=e.remove,r=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(eg()),u,c;u="if("+e.trigger+',modify("'+n+'",'+[r,i,a,o,s].map(function(f){return f??"null"}).join(",")+"),0)",c=Ji(u,t),l.update=c.$expr,l.params=c.$params}function fg(e,t){var n=JF(e),i=e.type===sg,r=e.from&&e.from.facet,a=e.layout||n===Uw||n===Bw,o=n===zw||a||r,s=e.overlap,l,u,c,f,d,h,p,g,m,v,y,b,E,x;c=jte(e.from,i,t),u=t.add(bee({key:c.key||(e.key?jc(e.key):void 0),pulse:c.pulse,clean:!i})),v=ne(u),u=f=t.add(Ei({pulse:v})),u=t.add(See({markdef:Cte(e),interactive:$te(e.interactive,t),clip:Tte(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ne(u)})),y=ne(u),u=d=t.add(IF(xF(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(function(k){const w=sx(k,t),A=w.metadata;(A.generates||A.changes)&&F("Mark transforms should not generate new data."),A.nomod||(d.params.mod=!0),w.params.pulse=ne(u),t.add(u=w)}),e.sort&&(u=t.add(Iee({sort:t.compareRef(e.sort),pulse:ne(u)}))),b=ne(u),(r||a)&&(a=t.add(LF({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),E=ne(a)),h=t.add(FF({mark:y,pulse:E||b})),x=ne(h),i&&(o&&(l=t.operators,l.pop(),a&&l.pop()),t.pushState(b,E||x,v),r?Lte(e,t,c):o?Pte(e,t,c):t.parse(e),t.popState(),o&&(a&&l.push(a),l.push(h))),s&&(x=zte(s,x,t)),p=t.add(jF({pulse:x})),g=t.add(qo({pulse:ne(p)},void 0,t.parent())),e.name!=null&&(m=e.name,t.addData(m,new Go(t,f,p,g)),e.on&&e.on.forEach(function(k){(k.insert||k.remove||k.toggle)&&F("Marks only support modify triggers."),rN(k,t,m)}))}function zte(e,t,n){var i=e.method,r=e.bound,a=e.separation,o,s={separation:yt(a)?n.signalRef(a.signal):a,method:yt(i)?n.signalRef(i.signal):i,pulse:t};return e.order&&(s.sort=n.compareRef({field:e.order})),r&&(o=r.tolerance,s.boundTolerance=yt(o)?n.signalRef(o.signal):+o,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient),ne(n.add(Cee(s)))}function Bte(e,t){var n=t.config.legend,i=e.encode||{},r=i.legend||{},a=r.name||void 0,o=r.interactive,s=r.style,l=kn(e,n),u={},c=0,f,d,h,p,g,m,v,y;return nx.forEach(b=>e[b]?(u[b]=e[b],c=c||e[b]):0),c||F("Missing valid scale for legend."),g=Ute(e,t.scaleType(c)),m={title:e.title!=null,scales:u,type:g,vgrad:g!=="symbol"&&l.isVertical()},v=ne(t.add(Ei(null,[m]))),r=vl(Wte(l,e,n),r,Uc),f={enter:{x:{value:0},y:{value:0}}},y=ne(t.add(_ee(h={type:g,scale:t.scaleRef(c),count:t.objectProperty(l("tickCount")),limit:t.property(l("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),g===og?(p=[pte(e,c,n,i.gradient),VF(e,n,i.labels,y)],h.count=h.count||t.signalRef(`max(2,2*floor((${Bo(l.gradientLength())})/100))`)):g===ex?p=[gte(e,c,n,i.gradient,y),VF(e,n,i.labels,y)]:(d=bte(e,n),p=[yte(e,n,i,y,Bo(d.columns))],h.size=Gte(e,t,p[0].marks)),p=[qc({role:$Z,from:v,encode:f,marks:p,layout:d,interactive:o})],m.title&&p.push(Ote(e,n,i.title,v)),fg(qc({role:TZ,from:v,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function Ute(e,t){var n=e.type||WF;return!e.type&&qte(e)===1&&(e.fill||e.stroke)&&(n=pb(t)?og:gb(t)?ex:WF),n!==og?n:gb(t)?ex:og}function qte(e){return nx.reduce(function(t,n){return t+(e[n]?1:0)},0)}function Wte(e,t,n){var i={enter:{},update:{}};return $t(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Gte(e,t,n){var i=Bo(aN("size",e,n)),r=Bo(aN("strokeWidth",e,n)),a=Bo(Hte(n[1].encode,t,Bc));return Ji(`max(ceil(sqrt(${i})+${r}),${a})`,t)}function aN(e,t,n){return t[e]?`scale("${t[e]}",datum)`:HF(e,n[0].encode)}function Hte(e,t,n){return HF("fontSize",e)||dte("fontSize",t,n)}const Yte=`item.orient==="${bl}"?-90:item.orient==="${wl}"?90:0`;function Vte(e,t){e=Y(e)?{text:e}:e;var n=kn(e,t.config.title),i=e.encode||{},r=i.group||{},a=r.name||void 0,o=r.interactive,s=r.style,l=[],u,c;return u={},c=ne(t.add(Ei(null,[u]))),l.push(Kte(e,n,Xte(e),c)),e.subtitle&&l.push(Qte(e,n,i.subtitle,c)),fg(qc({role:NZ,from:c,encode:Jte(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function Xte(e){const t=e.encode;return t&&t.title||fe({name:e.name,interactive:e.interactive,style:e.style},t)}function Jte(e,t){var n={enter:{},update:{}};return $t(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:rx},angle:{signal:Yte},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),vl(n,t,Uc)}function Kte(e,t,n,i){var r={value:0},a=e.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return $t(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Pn({type:Wo,role:IZ,style:ite,from:i,encode:o},n)}function Qte(e,t,n,i){var r={value:0},a=e.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return $t(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Pn({type:Wo,role:MZ,style:rte,from:i,encode:o},n)}function Zte(e,t){var n=[];e.transform&&e.transform.forEach(function(i){n.push(sx(i,t))}),e.on&&e.on.forEach(function(i){rN(i,t,e.name)}),t.addDataPipeline(e.name,ene(e,t,n))}function ene(e,t,n){var i=[],r=null,a=!1,o=!1,s,l,u,c,f;for(e.values?Lc(e.values)||Lc(e.format)?(i.push(oN(t,e)),i.push(r=Yo())):i.push(r=Yo({$ingest:e.values,$format:e.format})):e.url?Lc(e.url)||Lc(e.format)?(i.push(oN(t,e)),i.push(r=Yo())):i.push(r=Yo({$request:e.url,$format:e.format})):e.source&&(r=s=G(e.source).map(function(d){return ne(t.getData(d).output)}),i.push(null)),l=0,u=n.length;l<u;++l)c=n[l],f=c.metadata,!r&&!f.source&&i.push(r=Yo()),i.push(c),f.generates&&(o=!0),f.modifies&&!o&&(a=!0),f.source?r=c:f.changes&&(r=null);return s&&(u=s.length-1,i[0]=Fee({derive:a,pulse:u?s:s[0]}),(a||u)&&i.splice(1,0,Yo())),r||i.push(Yo()),i.push(qo({})),i}function Yo(e){var t=Ei({},e);return t.metadata={source:!0},t}function oN(e,t){return Aee({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const sN=e=>e===ka||e===ki,dg=(e,t,n)=>yt(e)?rne(e.signal,t,n):e===bl||e===ki?t:n,bt=(e,t,n)=>yt(e)?nne(e.signal,t,n):sN(e)?t:n,_i=(e,t,n)=>yt(e)?ine(e.signal,t,n):sN(e)?n:t,lN=(e,t,n)=>yt(e)?ane(e.signal,t,n):e===ki?{value:t}:{value:n},tne=(e,t,n)=>yt(e)?one(e.signal,t,n):e===wl?{value:t}:{value:n},nne=(e,t,n)=>uN(`${e} === '${ki}' || ${e} === '${ka}'`,t,n),ine=(e,t,n)=>uN(`${e} !== '${ki}' && ${e} !== '${ka}'`,t,n),rne=(e,t,n)=>ux(`${e} === '${bl}' || ${e} === '${ki}'`,t,n),ane=(e,t,n)=>ux(`${e} === '${ki}'`,t,n),one=(e,t,n)=>ux(`${e} === '${wl}'`,t,n),uN=(e,t,n)=>(t=t!=null?vt(t):t,n=n!=null?vt(n):n,cN(t)&&cN(n)?(t=t?t.signal||B(t.value):null,n=n?n.signal||B(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[fe({test:e},t)].concat(n||[])),cN=e=>e==null||Object.keys(e).length===1,ux=(e,t,n)=>({signal:`${e} ? (${El(t)}) : (${El(n)})`}),sne=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${bl}' ? (${El(i)}) : `:"")+(n!=null?`${e} === '${ka}' ? (${El(n)}) : `:"")+(r!=null?`${e} === '${wl}' ? (${El(r)}) : `:"")+(t!=null?`${e} === '${ki}' ? (${El(t)}) : `:"")+"(null)"}),El=e=>yt(e)?e.signal:e==null?null:B(e),lne=(e,t)=>t===0?0:yt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},kl=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function _l(e,t,n,i){let r;if(t&&Q(t,e))return t[e];if(Q(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[Zw][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Bc][r]}return null}function fN(e){const t={};for(const n of e){if(!n)continue;for(const i in n)t[i]=1}return Object.keys(t)}function une(e,t){var n=t.config,i=n.style,r=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,s,l,u;if(yt(o)){const f=fN([n.axisX,n.axisY]),d=fN([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(u of f)s[u]=bt(o,_l(u,n.axisX,r,i),_l(u,n.axisY,r,i));l={};for(u of d)l[u]=sne(o.signal,_l(u,n.axisTop,r,i),_l(u,n.axisBottom,r,i),_l(u,n.axisLeft,r,i),_l(u,n.axisRight,r,i))}else s=o===ki||o===ka?n.axisX:n.axisY,l=n["axis"+o[0].toUpperCase()+o.slice(1)];var c=s||l||a?fe({},r,s,l,a):r;return c}function cne(e,t,n,i){var r=kn(e,t),a=e.orient,o,s,l;o={enter:s={opacity:be},update:l={opacity:ei},exit:{opacity:be}},$t(o,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const u=dN(e,0),c=dN(e,1);return s.x=l.x=bt(a,u,be),s.x2=l.x2=bt(a,c),s.y=l.y=_i(a,u,be),s.y2=l.y2=_i(a,c),Pn({type:ix,role:kZ,from:i,encode:o},n)}function dN(e,t){return{scale:e.scale,range:t}}function fne(e,t,n,i,r){var a=kn(e,t),o=e.orient,s=e.gridScale,l=dg(o,1,-1),u=dne(e.offset,l),c,f,d,h,p,g,m,v;return c={enter:f={opacity:be},update:h={opacity:ei},exit:d={opacity:be}},$t(c,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")}),p={scale:e.scale,field:Zn,band:r.band,extra:r.extra,offset:r.offset,round:a("tickRound")},v=bt(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},m=s?{scale:s,range:1,mult:l,offset:u}:fe(v,{mult:l,offset:u}),f.x=h.x=bt(o,p,g),f.y=h.y=_i(o,p,g),f.x2=h.x2=_i(o,m),f.y2=h.y2=bt(o,m),d.x=bt(o,p),d.y=_i(o,p),Pn({type:ix,role:_Z,key:Zn,from:i,encode:c},n)}function dne(e,t){if(!(t===1))if(!K(e))e=yt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=fe({},e);for(;n.mult!=null;)if(K(n.mult))n=n.mult=fe({},n.mult);else return n.mult=yt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function hne(e,t,n,i,r,a){var o=kn(e,t),s=e.orient,l=dg(s,-1,1),u,c,f,d,h,p;return u={enter:c={opacity:be},update:d={opacity:ei},exit:f={opacity:be}},$t(u,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")}),h=vt(r),h.mult=l,p={scale:e.scale,field:Zn,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")},d.y=c.y=bt(s,be,p),d.y2=c.y2=bt(s,h),f.x=bt(s,p),d.x=c.x=_i(s,be,p),d.x2=c.x2=_i(s,h),f.y=_i(s,p),Pn({type:ix,role:SZ,key:Zn,from:i,encode:u},n)}function cx(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function pne(e,t,n,i,r,a){var o=kn(e,t),s=e.orient,l=e.scale,u=dg(s,-1,1),c=Bo(o("labelFlush")),f=Bo(o("labelFlushOffset")),d=c===0||!!c,h=o("labelAlign"),p=o("labelBaseline"),g,m,v,y,b,E,x,k,w,A;return y=vt(r),y.mult=u,y.offset=vt(o("labelPadding")||0),y.offset.mult=u,b={scale:l,field:Zn,band:.5,offset:YF(a.offset,o("labelOffset"))},E=bt(s,d?cx(l,c,'"left"','"right"','"center"'):{value:"center"},tne(s,"left","right")),x=bt(s,lN(s,"bottom","top"),d?cx(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),A=cx(l,c,`-(${f})`,f,0),d=d&&f,m={opacity:be,x:bt(s,b,y),y:_i(s,b,y)},g={enter:m,update:v={opacity:ei,text:{field:Qw},x:m.x,y:m.y,align:E,baseline:x},exit:{opacity:be,x:m.x,y:m.y}},$t(g,{dx:!h&&d?bt(s,A):null,dy:!p&&d?_i(s,A):null}),$t(g,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:p}),k=o("labelBound"),w=o("labelOverlap"),w=w||k?{separation:o("labelSeparation"),method:w,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,v.align!==E&&(v.align=kl(v.align,E)),v.baseline!==x&&(v.baseline=kl(v.baseline,x)),Pn({type:Wo,role:AZ,style:Bc,key:Zn,from:i,encode:g,overlap:w},n)}function gne(e,t,n,i){var r=kn(e,t),a=e.orient,o=dg(a,-1,1),s,l,u,c;return s={enter:l={opacity:be,anchor:vt(r("titleAnchor",null)),align:{signal:rx}},update:u=fe({},l,{opacity:ei,text:vt(e.title)}),exit:{opacity:be}},c={signal:`lerp(range("${e.scale}"), ${lg(0,1,.5)})`},u.x=bt(a,c),u.y=_i(a,c),l.angle=bt(a,be,lne(o,90)),l.baseline=bt(a,lN(a,ka,ki),{value:ka}),u.angle=l.angle,u.baseline=l.baseline,$t(s,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),mne(r,a,s,n),s.update.align=kl(s.update.align,l.align),s.update.angle=kl(s.update.angle,l.angle),s.update.baseline=kl(s.update.baseline,l.baseline),Pn({type:Wo,role:OZ,style:Zw,from:i,encode:s},n)}function mne(e,t,n,i){const r=(s,l)=>s!=null?(n.update[l]=kl(vt(s),n.update[l]),!1):!yl(l,i),a=r(e("titleX"),"x"),o=r(e("titleY"),"y");n.enter.auto=o===a?vt(o):bt(t,vt(o),vt(a))}function vne(e,t){var n=une(e,t),i=e.encode||{},r=i.axis||{},a=r.name||void 0,o=r.interactive,s=r.style,l=kn(e,n),u=hte(l),c,f,d,h,p;return c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:e.title!=null},f=ne(t.add(Ei({},[c]))),r=vl(yne(l,e),r,Uc),d=ne(t.add(yee({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),p=[],c.grid&&p.push(fne(e,n,i.grid,d,u)),c.ticks&&(h=l("tickSize"),p.push(hne(e,n,i.ticks,d,h,u))),c.labels&&(h=c.ticks?h:0,p.push(pne(e,n,i.labels,d,h,u))),c.domain&&p.push(cne(e,n,i.domain,f)),c.title&&p.push(gne(e,n,i.title,f)),fg(qc({role:EZ,from:f,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function yne(e,t){var n={enter:{},update:{}};return $t(n,{orient:e("orient"),offset:e("offset")||0,position:xi(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function hN(e,t,n){var i=G(e.signals),r=G(e.scales);return n||i.forEach(a=>kF(a,t)),G(e.projections).forEach(a=>Jee(a,t)),r.forEach(a=>Lee(a,t)),G(e.data).forEach(a=>Zte(a,t)),r.forEach(a=>Pee(a,t)),(n||i).forEach(a=>vee(a,t)),G(e.axes).forEach(a=>vne(a,t)),G(e.marks).forEach(a=>fg(a,t)),G(e.legends).forEach(a=>Bte(a,t)),e.title&&Vte(e.title,t),t.parseLambdas(),t}const bne=e=>vl({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function wne(e,t){const n=t.config,i=ne(t.root=t.add(eg())),r=xne(e,n);r.forEach(u=>kF(u,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(Ei()),o=t.add(IF(xF(bne(e.encode),sg,Bw,e.style,t,{pulse:ne(a)}))),s=t.add(LF({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:ne(o)}));t.operators.pop(),t.pushState(ne(o),ne(s),null),hN(e,t,r),t.operators.push(s);let l=t.add(FF({mark:i,pulse:ne(s)}));return l=t.add(jF({pulse:ne(l)})),l=t.add(qo({pulse:ne(l)})),t.addData("root",new Go(t,a,a,l)),t}function Gc(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function xne(e,t){const n=o=>xi(e[o],t[o]),i=[Gc("background",n("background")),Gc("autosize",bZ(n("autosize"))),Gc("padding",xZ(n("padding"))),Gc("width",n("width")||0),Gc("height",n("height")||0)],r=i.reduce((o,s)=>(o[s.name]=s,o),{}),a={};return G(e.signals).forEach(o=>{Q(r,o.name)?o=fe(r[o.name],o):i.push(o),a[o.name]=o}),G(t.signals).forEach(o=>{!Q(a,o.name)&&!Q(r,o.name)&&i.push(o)}),i}function pN(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function gN(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var ce=pN.prototype=gN.prototype;ce.parse=function(e){return hN(e,this)},ce.fork=function(){return new gN(this)},ce.isSubscope=function(){return this._subid>0},ce.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},ce.id=function(){return(this._subid?this._subid+":":0)+this._id++},ce.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},ce.proxy=function(e){var t=e instanceof Ww?ne(e):e;return this.add(Ree({value:t}))},ce.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},ce.addUpdate=function(e){return this.updates.push(e),e},ce.finish=function(){var e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,a,o){var s,l;r&&(s=r.data||(r.data={}),l=s[a]||(s[a]=[]),l.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(var i in t.index)n(t.index[i],e,"index:"+i)}return this},ce.pushState=function(e,t,n){this._encode.push(ne(this.add(qo({pulse:e})))),this._parent.push(t),this._lookup.push(n?ne(this.proxy(n)):null),this._markpath.push(-1)},ce.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},ce.parent=function(){return ve(this._parent)},ce.encode=function(){return ve(this._encode)},ce.lookup=function(){return ve(this._lookup)},ce.markpath=function(){var e=this._markpath;return++e[e.length-1]},ce.fieldRef=function(e,t){if(Y(e))return jc(e,t);e.signal||F("Unsupported field reference: "+B(e));var n=e.signal,i=this.field[n],r;return i||(r={name:this.signalRef(n)},t&&(r.as=t),this.field[n]=i=ne(this.add(Eee(r)))),i},ce.compareRef=function(e){function t(o){return yt(o)?(i=!0,n.signalRef(o.signal)):KZ(o)?(i=!0,n.exprRef(o.expr)):o}var n=this,i=!1,r=G(e.field).map(t),a=G(e.order).map(t);return i?ne(this.add(NF({fields:r,orders:a}))):_F(r,a)},ce.keyRef=function(e,t){function n(a){return yt(a)?(r=!0,ne(i[a.signal])):a}var i=this.signals,r=!1;return e=G(e).map(n),r?ne(this.add(kee({fields:e,flat:t}))):YZ(e,t)},ce.sortRef=function(e){if(!e)return e;var t=tg(e.op,e.field),n=e.order||VZ;return n.signal?ne(this.add(NF({fields:t,orders:this.signalRef(n.signal)}))):_F(t,n)},ce.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},ce.hasOwnSignal=function(e){return Q(this.signals,e)},ce.addSignal=function(e,t){this.hasOwnSignal(e)&&F("Duplicate signal name: "+B(e));var n=t instanceof Ww?t:this.add(eg(t));return this.signals[e]=n},ce.getSignal=function(e){return this.signals[e]||F("Unrecognized signal name: "+B(e)),this.signals[e]},ce.signalRef=function(e){return this.signals[e]?ne(this.signals[e]):(Q(this.lambdas,e)||(this.lambdas[e]=this.add(eg(null))),ne(this.lambdas[e]))},ce.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],r=Ji(i,this),a=this.lambdas[i];a.params=r.$params,a.update=r.$expr}},ce.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},ce.objectProperty=function(e){return!e||!K(e)?e:this.signalRef(e.signal||fx(e))};function fx(e){return(I(e)?Ene:kne)(e)}function Ene(e){for(var t="[",n=0,i=e.length,r;n<i;++n)r=e[n],t+=(n>0?",":"")+(K(r)?r.signal||fx(r):B(r));return t+"]"}function kne(e){var t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+B(i)+":"+(K(r)?r.signal||fx(r):B(r));return t+"}"}ce.exprRef=function(e,t){var n={expr:Ji(e,this)};return t&&(n.expr.$name=t),ne(this.add(wee(n)))},ce.addBinding=function(e,t){this.bindings||F("Nested signals do not support binding: "+B(e)),this.bindings.push(fe({signal:e},t))},ce.addScaleProj=function(e,t){Q(this.scales,e)&&F("Duplicate scale or projection name: "+B(e)),this.scales[e]=this.add(t)},ce.addScale=function(e,t){this.addScaleProj(e,Nee(t))},ce.addProjection=function(e,t){this.addScaleProj(e,Dee(t))},ce.getScale=function(e){return this.scales[e]||F("Unrecognized scale name: "+B(e)),this.scales[e]},ce.projectionRef=ce.scaleRef=function(e){return ne(this.getScale(e))},ce.projectionType=ce.scaleType=function(e){return this.getScale(e).params.type},ce.addData=function(e,t){return Q(this.data,e)&&F("Duplicate data set name: "+B(e)),this.data[e]=t},ce.getData=function(e){return this.data[e]||F("Undefined data set name: "+B(e)),this.data[e]},ce.addDataPipeline=function(e,t){return Q(this.data,e)&&F("Duplicate data set name: "+B(e)),this.addData(e,Go.fromEntries(this,t))};function _ne(){const e="sans-serif",t=30,n=2,i="#4c78a8",r="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:n},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:n},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:a,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:a,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Ane(e,t,n){return K(e)||F("Input Vega specification must be an object."),t=Jl(_ne(),t,e.config),wne(e,new pN(t,n)).toRuntime()}GE(Rs,l9,kW,cG,oY,KY,tX,aX,kX,NX,UX);var Sne=Object.freeze({__proto__:null,version:qX,Dataflow:Ds,EventStream:od,Parameters:ad,Pulse:ia,MultiPulse:P0,Operator:Re,Transform:$,changeset:oo,ingest:ke,isTuple:id,definition:V_,transform:X_,transforms:Rs,tupleid:ee,scale:Ee,scheme:vb,interpolate:mb,interpolateColors:Rh,interpolateRange:NT,quantizeInterpolator:IT,projection:S1,View:dF,formatLocale:gd,timeFormatLocale:du,locale:P_,defaultLocale:j0,resetDefaultLocale:h4,expressionFunction:mt,parse:Ane,runtimeContext:nF,bandwidthNRD:H0,bin:tA,bootstrapCI:nA,dotbin:iA,quantiles:W0,quartiles:G0,get random(){return qn},setRandom:V4,randomLCG:J4,randomInteger:K4,randomKDE:X0,randomLogNormal:aA,sampleLogNormal:J0,densityLogNormal:K0,cumulativeLogNormal:Q0,quantileLogNormal:Z0,randomMixture:oA,randomNormal:V0,sampleNormal:Ad,densityNormal:Y0,cumulativeNormal:Sd,quantileNormal:Od,randomUniform:sA,sampleUniform:ev,densityUniform:tv,cumulativeUniform:nv,quantileUniform:iv,regressionLinear:rv,regressionLog:lA,regressionExp:uA,regressionPow:cA,regressionQuad:av,regressionPoly:fA,regressionLoess:pA,sampleCurve:Cd,TIME_UNITS:p0,YEAR:kt,QUARTER:dn,MONTH:Ft,WEEK:at,DATE:hn,DAY:Nt,DAYOFYEAR:Ni,HOURS:Rn,MINUTES:Fn,SECONDS:Un,MILLISECONDS:ci,timeUnitSpecifier:Xk,timeUnits:m0,dayofyear:n_,week:i_,utcdayofyear:a_,utcweek:o_,timeFloor:u_,utcFloor:c_,timeInterval:Ss,timeOffset:d_,timeSequence:g_,utcInterval:Os,utcOffset:h_,utcSequence:m_,timeBin:x_,accessor:pr,accessorName:OP,accessorFields:RE,id:$P,identity:Gm,zero:DP,one:RP,truthy:FP,falsy:NP,logger:IP,None:NE,Error:IE,Warn:ME,Info:jE,Debug:LE,mergeConfig:MP,writeConfig:Uf,panLinear:LP,panLog:PP,panPow:zP,panSymlog:BP,zoomLinear:UP,zoomLog:qP,zoomPow:WP,zoomSymlog:GP,quarter:HP,utcquarter:YP,array:Hl,clampRange:VP,compare:JP,constant:ez,debounce:tz,error:Lf,extend:GE,extent:nz,extentIndex:iz,fastmap:az,field:Wm,flush:oz,hasOwnProperty:Za,inherits:sz,inrange:lz,isArray:zf,isBoolean:uz,isDate:HE,isFunction:Ym,isNumber:YE,isObject:Bf,isRegExp:cz,isString:VE,key:fz,lerp:dz,lruCache:pz,merge:gz,pad:mz,peek:ws,repeat:Yl,span:vz,splitAccessPath:qm,stringValue:XE,toBoolean:yz,toDate:wz,toNumber:Hm,toString:xz,toSet:Ez,truncate:kz,visitArray:_z,read:z_,inferType:xk,inferTypes:Ek,typeParsers:Zm,format:ld,formats:a0,responseType:Dk,loader:Ed,Bounds:ot,Gradient:QA,GroupItem:Hd,ResourceLoader:oy,Item:Gd,Scenegraph:_y,Handler:ha,Renderer:mi,CanvasHandler:Nu,CanvasRenderer:ph,SVGHandler:Cy,SVGRenderer:Sb,SVGStringRenderer:Cb,RenderType:ba,renderModule:Mh,intersect:hC,Marks:Hn,boundClip:vC,boundContext:pn,boundStroke:xr,boundItem:ky,boundMark:iO,pathCurves:ey,pathSymbols:SS,pathRectangle:OS,pathTrail:TS,pathParse:Ls,pathRender:Eu,point:sh,domCreate:da,domFind:Ay,domChild:Nn,domClear:gi,openTag:qe,closeTag:He,font:ah,fontFamily:$u,fontSize:Pi,lineHeight:ca,multiLineOffset:wy,textMetrics:Hs,sceneEqual:Db,pathEqual:yC,sceneToJSON:rO,sceneFromJSON:aO,intersectPath:ly,intersectPoint:uy,intersectRule:PS,intersectBoxLine:Bs,sceneZOrder:cy,sceneVisit:pi,scenePickVisit:Qd,resetSVGClipId:$S,resetSVGDefIds:Hq});const One="vega-lite",Tne='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Cne="4.13.1",$ne=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Dne="https://vega.github.io/vega-lite/",Rne="Vega-Lite is a concise high-level language for interactive visualization.",Fne="build/vega-lite.js",Nne="build/vega-lite.min.js",Ine="build/vega-lite.min.js",Mne="build/src/index",jne="build/src/index.d.ts",Lne={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Pne={test:"test"},zne={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},Bne={type:"git",url:"https://github.com/vega/vega-lite.git"},Une="BSD-3-Clause",qne={url:"https://github.com/vega/vega-lite/issues"},Wne={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},Gne={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},Hne={vega:"^5.12.1"},Yne={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1};var Vne={name:One,author:Tne,version:Cne,collaborators:$ne,homepage:Dne,description:Rne,main:Fne,unpkg:Nne,jsdelivr:Ine,module:Mne,types:jne,bin:Lne,directories:Pne,scripts:zne,repository:Bne,license:Une,bugs:qne,devDependencies:Wne,dependencies:Gne,peerDependencies:Hne,jest:Yne};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Xne=Om(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch(d){i=function(){}}var r;try{r=Set}catch(d){r=function(){}}var a;try{a=Promise}catch(d){a=function(){}}function o(d,h,p,g,m){typeof h=="object"&&(p=h.depth,g=h.prototype,m=h.includeNonEnumerable,h=h.circular);var v=[],y=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof p=="undefined"&&(p=Infinity);function E(x,k){if(x===null)return null;if(k===0)return x;var w,A;if(typeof x!="object")return x;if(n(x,i))w=new i();else if(n(x,r))w=new r();else if(n(x,a))w=new a(function(W,X){x.then(function(J){W(E(J,k-1))},function(J){X(E(J,k-1))})});else if(o.__isArray(x))w=[];else if(o.__isRegExp(x))w=new RegExp(x.source,f(x)),x.lastIndex&&(w.lastIndex=x.lastIndex);else if(o.__isDate(x))w=new Date(x.getTime());else{if(b&&Buffer.isBuffer(x))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(x.length):w=new Buffer(x.length),x.copy(w),w;n(x,Error)?w=Object.create(x):typeof g=="undefined"?(A=Object.getPrototypeOf(x),w=Object.create(A)):(w=Object.create(g),A=g)}if(h){var _=v.indexOf(x);if(_!=-1)return y[_];v.push(x),y.push(w)}n(x,i)&&x.forEach(function(W,X){var J=E(X,k-1),xe=E(W,k-1);w.set(J,xe)}),n(x,r)&&x.forEach(function(W){var X=E(W,k-1);w.add(X)});for(var O in x){var S;if(A&&(S=Object.getOwnPropertyDescriptor(A,O)),S&&S.set==null)continue;w[O]=E(x[O],k-1)}if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(x),O=0;O<T.length;O++){var D=T[O],M=Object.getOwnPropertyDescriptor(x,D);if(M&&!M.enumerable&&!m)continue;w[D]=E(x[D],k-1),M.enumerable||Object.defineProperty(w,D,{enumerable:!1})}if(m)for(var C=Object.getOwnPropertyNames(x),O=0;O<C.length;O++){var N=C[O],M=Object.getOwnPropertyDescriptor(x,N);if(M&&M.enumerable)continue;w[N]=E(x[N],k-1),Object.defineProperty(w,N,{enumerable:!1})}return w}return E(d,p)}o.clonePrototype=function(h){if(h===null)return null;var p=function(){};return p.prototype=h,new p()};function s(d){return Object.prototype.toString.call(d)}o.__objToStr=s;function l(d){return typeof d=="object"&&s(d)==="[object Date]"}o.__isDate=l;function u(d){return typeof d=="object"&&s(d)==="[object Array]"}o.__isArray=u;function c(d){return typeof d=="object"&&s(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)}),Jne=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,a;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),i=a.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;r--!==0;){var o=a[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},Hc=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(a){return function(o){return function(s,l){var u={key:s,value:o[s]},c={key:l,value:o[l]};return a(u,c)}}}(t.cmp),r=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var s,l;if(Array.isArray(o)){for(l="[",s=0;s<o.length;s++)s&&(l+=","),l+=a(o[s])||"null";return l+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=r.push(o)-1,c=Object.keys(o).sort(i&&i(o));for(l="",s=0;s<c.length;s++){var f=c[s],d=a(o[f]);if(!d)continue;l&&(l+=","),l+=JSON.stringify(f)+":"+d}return r.splice(u,1),"{"+l+"}"}(e)};function dx(e){return!!e.or}function hx(e){return!!e.and}function px(e){return!!e.not}function hg(e,t){if(px(e))hg(e.not,t);else if(hx(e))for(const n of e.and)hg(n,t);else if(dx(e))for(const n of e.or)hg(n,t);else t(e)}function pg(e,t){return px(e)?{not:pg(e.not,t)}:hx(e)?{and:e.and.map(n=>pg(n,t))}:dx(e)?{or:e.or.map(n=>pg(n,t))}:t(e)}const Yc=Jne,pe=Xne;function Vc(e,t){const n={};for(const i of t)Q(e,i)&&(n[i]=e[i]);return n}function Nr(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Hc(e)).join(",")})`};const Be=Hc;function we(e){if(De(e))return e;const t=Y(e)?e:Hc(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function mN(e){return e===!1||e===null}function ae(e,t){return e.indexOf(t)>-1}function Xc(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function vN(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function Kne(e,...t){for(const n of t)Qne(e,n??{});return e}function Qne(e,t){for(const n of z(t))Vm(e,n,t[n],!0)}function _a(e,t){const n=[],i={};let r;for(const a of e){if(r=t(a),r in i)continue;i[r]=1,n.push(a)}return n}function Zne(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function yN(e,t){for(const n of e)if(t.has(n))return!0;return!1}function bN(e){const t=new Set();for(const n of e){const i=gr(n),r=i.map((o,s)=>s===0?o:`[${o}]`),a=r.map((o,s)=>r.slice(0,s+1).join(""));for(const o of a)t.add(o)}return t}function wN(e,t){return e===void 0||t===void 0?!0:yN(bN(e),bN(t))}function Fe(e){return z(e).length===0}const z=Object.keys,Aa=Object.values;function xN(e){const t=[];for(const n in e)Q(e,n)&&t.push({key:n,value:e[n]});return t}function gg(e){return e===!0||e===!1}function Ue(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Jc(e,t){return px(e)?"!("+Jc(e.not,t)+")":hx(e)?"("+e.and.map(n=>Jc(n,t)).join(") && (")+")":dx(e)?"("+e.or.map(n=>Jc(n,t)).join(") || (")+")":t(e)}function gx(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&gx(e[n],t)&&delete e[n],Fe(e)}function mg(e){return e.charAt(0).toUpperCase()+e.substr(1)}function EN(e,t="datum"){const n=gr(e),i=[];for(let r=1;r<=n.length;r++){const a=`[${n.slice(0,r).map(B).join("][")}]`;i.push(`${t}${a}`)}return i.join(" && ")}function eie(e,t="datum"){return`${t}[${B(gr(e).join("."))}]`}function tie(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Sa(e){return`${gr(e).map(tie).join("\\.")}`}function Al(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function kN(e){return`${gr(e).join(".")}`}function Kc(e){return e?gr(e).length:0}function it(...e){for(const t of e)if(t!==void 0)return t;return}let nie=42;function iie(e){const t=++nie;return e?String(e)+t:t}function rie(e){return aie(e)?e:`__${e}`}function aie(e){return e.indexOf("__")===0}function vg(e){return e===void 0?void 0:(e%360+360)%360}function mx(e){return De(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const _N={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function vx(e){return e&&e.condition}const AN=["domain","grid","labels","ticks","title"],oie={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},SN={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},sie=Object.assign(Object.assign({},SN),{style:1,labelExpr:1,encoding:1});function ON(e){return!!sie[e]}const nn={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},TN=nn.arc,yg=nn.area,bg=nn.bar,lie=nn.image,wg=nn.line,xg=nn.point,uie=nn.rect,Eg=nn.rule,CN=nn.text,yx=nn.tick,cie=nn.trail,bx=nn.circle,wx=nn.square,$N=nn.geoshape;function Vo(e){return ae(["line","area","trail"],e)}function DN(e){return ae(["rect","bar","image","arc"],e)}const RN=z(nn);function Ki(e){return e.type}const Ide=Et(RN),fie=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],die=["fill","fillOpacity"],hie=[...fie,...die],pie={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},FN=z(pie),gie={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},mie={color:"#4c78a8",invalid:"filter",timeUnitBand:1},vie={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},NN=5,yie={binSpacing:1,continuousBandSize:NN,timeUnitBandPosition:.5},bie={binSpacing:0,continuousBandSize:NN,timeUnitBandPosition:.5},wie={thickness:1};function xie(e){return Ki(e)?e.type:e}function Ir(e){return"mark"in e}class kg{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return Ir(e)?xie(e.mark)===this.name:!1}}const Eie={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},kie={count:1,min:1,max:1};function Oa(e){return!!e&&!!e.argmin}function Xo(e){return!!e&&!!e.argmax}function xx(e){return Y(e)&&!!Eie[e]}const _ie=["count","valid","missing","distinct"];function IN(e){return Y(e)&&ae(_ie,e)}function Aie(e){return Y(e)&&ae(["min","max"],e)}const Sie=["count","sum","distinct","valid","missing"],Oie=["mean","average","median","q1","q3","min","max"],Tie=Et(Oie),Mr="row",jr="column",_g="facet",Ge="x",ut="y",Ai="x2",Qi="y2",Zi="radius",Lr="radius2",Si="theta",Pr="theta2",er="latitude",tr="longitude",Oi="latitude2",ti="longitude2",_n="color",nr="fill",ir="stroke",An="shape",zr="size",Jo="angle",Br="opacity",Ta="fillOpacity",Ca="strokeOpacity",$a="strokeWidth",Da="strokeDash",Qc="text",Zc="order",ef="detail",Ag="key",Ko="tooltip",Sg="href",Og="url",Tg="description",Cie={x:1,y:1,x2:1,y2:1},MN={theta:1,theta2:1,radius:1,radius2:1};function jN(e){return e in MN}const Ex={longitude:1,longitude2:1,latitude:1,latitude2:1};function $ie(e){switch(e){case er:return"y";case Oi:return"y2";case tr:return"x";case ti:return"x2"}}function Die(e){return e in Ex}const Rie=z(Ex),LN=Object.assign(Object.assign(Object.assign(Object.assign({},Cie),MN),Ex),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Sl(e){return e===_n||e===nr||e===ir}const PN={row:1,column:1,facet:1},ni=z(PN),kx=Object.assign(Object.assign({},LN),PN),zN=z(kx),Fie=Z(kx,["order","detail","tooltip"]),Nie=Z(Fie,["row","column","facet"]);function Iie(e){return!!Nie[e]}function BN(e){return!!kx[e]}const Mie=[Ai,Qi,Oi,ti,Pr,Lr];function UN(e){const t=Qo(e);return t!==e}function Qo(e){switch(e){case Ai:return Ge;case Qi:return ut;case Oi:return er;case ti:return tr;case Pr:return Si;case Lr:return Zi}return e}function Ra(e){if(jN(e))switch(e){case Si:return"startAngle";case Pr:return"endAngle";case Zi:return"outerRadius";case Lr:return"innerRadius"}return e}function rr(e){switch(e){case Ge:return Ai;case ut:return Qi;case er:return Oi;case tr:return ti;case Si:return Pr;case Zi:return Lr}return}function ar(e){switch(e){case Ge:case Ai:return"width";case ut:case Qi:return"height"}return}function jie(e){switch(e){case Ge:return"xOffset";case ut:return"yOffset";case Ai:return"x2Offset";case Qi:return"y2Offset";case Si:return"thetaOffset";case Zi:return"radiusOffset";case Pr:return"theta2Offset";case Lr:return"radius2Offset"}return}const _x=Z(LN,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Lie=z(_x),Fa={x:1,y:1},ii=z(Fa);function or(e){return e in Fa}const Ax={theta:1,radius:1},Pie=z(Ax);function Cg(e){return e==="width"?Ge:ut}const qN=Z(_x,["text","tooltip","href","url","description","detail","key","order"]),zie=z(qN);function Bie(e){return!!_x[e]}function Uie(e){switch(e){case _n:case nr:case ir:case zr:case An:case Br:case $a:case Da:return!0;case Ta:case Ca:case Jo:return!1}}const WN=Object.assign(Object.assign(Object.assign({},Fa),Ax),qN),$g=z(WN);function Na(e){return!!WN[e]}function qie(e,t){return Gie(e)[t]}const GN={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Wie=Z(GN,["geoshape"]);function Gie(e){switch(e){case _n:case nr:case ir:case Tg:case ef:case Ag:case Ko:case Sg:case Zc:case Br:case Ta:case Ca:case $a:case _g:case Mr:case jr:return GN;case Ge:case ut:case er:case tr:return Wie;case Ai:case Qi:case Oi:case ti:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case zr:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Da:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case An:return{point:"always",geoshape:"always"};case Qc:return{text:"always"};case Jo:return{point:"always",square:"always",text:"always"};case Og:return{image:"always"};case Si:return{text:"always",arc:"always"};case Zi:return{text:"always",arc:"always"};case Pr:case Lr:return{arc:"always"}}}function Dg(e){switch(e){case Ge:case ut:case Si:case Zi:case zr:case Jo:case $a:case Br:case Ta:case Ca:case Ai:case Qi:case Pr:case Lr:return;case _g:case Mr:case jr:case An:case Da:case Qc:case Ko:case Sg:case Og:case Tg:return"discrete";case _n:case nr:case ir:return"flexible";case er:case tr:case Oi:case ti:case ef:case Ag:case Zc:return}}function HN(e){return no(e)&&(e=qg(e,void 0)),"bin"+z(e).map(t=>Rg(e[t])?Ue(`_${t}_${Object.entries(e[t])}`):Ue(`_${t}_${e[t]}`)).join("")}function Ie(e){return e===!0||tf(e)&&!e.binned}function rn(e){return e==="binned"||tf(e)&&e.binned===!0}function tf(e){return K(e)}function Rg(e){return e==null?void 0:e.selection}function YN(e){switch(e){case Mr:case jr:case zr:case _n:case nr:case ir:case $a:case Br:case Ta:case Ca:case An:return 6;case Da:return 4;default:return 10}}function Sx(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Hie='Autosize "fit" only works for single views and layered views.';function VN(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function XN(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function JN(e){return e?`Dropping "fit-${e}" because spec has discrete ${ar(e)}.`:'Dropping "fit" because spec has discrete size.'}function KN(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Yie(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Vie(e){return`The "nearest" transform is not supported for ${e} marks.`}function QN(e){return`Selection not supported for ${e} yet.`}function Xie(e){return`Cannot find a selection named "${e}".`}const Jie="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Kie="Legend bindings are only supported for selections over an individual field or encoding channel.";function Qie(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function Zie(e){return`Unknown repeated value "${e}".`}function ZN(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const ere="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function tre(e){return`Unrecognized parse "${e}".`}function eI(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function nre(e){return`Ignoring an invalid transform: ${Be(e)}.`}const ire='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function tI(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function rre(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function are(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Be(t)} is overridden by a child projection ${Be(n)}.`}const ore="Arc marks uses theta channel rather than angle, replacing angle with theta.";function sre(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Be(n)}}.`}function nI(e){return`Invalid field type "${e}".`}function lre(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function ure(e){return`Invalid aggregation operator "${e}".`}function cre(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function iI(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Ox(e,t){return`Dropping ${Be(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const fre="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Fg(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function dre(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function hre(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function pre(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Tx(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function gre(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function mre(e,t){return`Specified orient "${e}" overridden with "${t}".`}const vre=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function yre(e){return`Cannot use the scale property "${e}" with non-color channel.`}function bre(e){return`Using unaggregated domain with raw field has no effect (${Be(e)}).`}function wre(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function xre(e){return`Unaggregated domain is currently unsupported for log scale (${Be(e)}).`}function Ere(e){return`Cannot apply size to non-oriented mark "${e}".`}function kre(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function _re(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function rI(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function aI(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Are(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Be(n)} and ${Be(i)}). Using ${Be(n)}.`}function Sre(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Be(n)} and ${Be(i)}). Using the union of the two domains.`}function Ore(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Tre(e){return`Dropping sort property ${Be(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const oI="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Cre="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",$re="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Dre="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Rre(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Fre(e){return`Cannot stack non-linear scale (${e}).`}function Nre(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Ng(e,t){return`Invalid ${e}: ${Be(t)}.`}function Ire(e){return`Dropping day from datetime ${Be(e)} as day cannot be combined with other units.`}function Mre(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function jre(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Lre(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Pre(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function sI(e){return`1D error band does not support ${e}.`}function lI(e){return`Channel ${e} is required for "binned" bin.`}function zre(e){return`Domain for ${e} is required for threshold scale.`}const uI=ZE(QE);let Ol=uI;function Bre(e){return Ol=e,Ol}function Ure(){return Ol=uI,Ol}function j(...e){Ol.warn(...e)}function qre(...e){Ol.debug(...e)}function Tl(e){if(e&&K(e)){for(const t of $x)if(t in e)return!0}return!1}const cI=["january","february","march","april","may","june","july","august","september","october","november","december"],Wre=cI.map(e=>e.substr(0,3)),fI=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Gre=fI.map(e=>e.substr(0,3));function Hre(e){if(mx(e)&&(e=+e),De(e))return e>4&&j(Ng("quarter",e)),e-1;throw new Error(Ng("quarter",e))}function Yre(e){if(mx(e)&&(e=+e),De(e))return e-1;{const t=e.toLowerCase(),n=cI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Wre.indexOf(i);if(r!==-1)return r;throw new Error(Ng("month",e))}}function Vre(e){if(mx(e)&&(e=+e),De(e))return e%7;{const t=e.toLowerCase(),n=fI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Gre.indexOf(i);if(r!==-1)return r;throw new Error(Ng("day",e))}}function Cx(e,t){const n=[];if(t&&e.day!==void 0&&(z(e).length>1&&(j(Ire(e)),e=pe(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Yre(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Hre(e.quarter):e.quarter;n.push(De(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Vre(e.day):e.day;n.push(De(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function nf(e){const t=Cx(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Xre(e){const t=Cx(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Jre(e){const t=Cx(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const dI={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},$x=z(dI);function Kre(e){return!!dI[e]}function Dx(e){return e.startsWith("utc")}function Qre(e){return e.substr(3)}const Zre={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Rx(e){const t=[];for(const n of $x)hI(e,n)&&t.push(n);return t}function hI(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function eae(e,t,{end:n}={end:!1}){const i=EN(t),r=Dx(e)?"utc":"";function a(l){return l==="quarter"?`(${r}quarter(${i})-1)`:`${r}${l}(${i})`}let o;const s={};for(const l of $x)hI(e,l)&&(s[l]=a(l),o=l);return n&&(s[o]+="+1"),Xre(s)}function pI(e){if(!e)return;const t=Rx(e);return`timeUnitSpecifier(${Hc(t)}, ${Hc(Zre)})`}function tae(e,t,n){if(!e)return;const i=pI(e),r=n||Dx(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function an(e){if(!e)return;let t;return Y(e)?t={unit:e}:K(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Dx(t.unit)&&(t.utc=!0,t.unit=Qre(t.unit)),t}function nae(e){const t=an(e),{utc:n}=t,i=Z(t,["utc"]);return i.unit?(n?"utc":"")+z(i).map(r=>Ue(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+z(i).map(r=>Ue(`_${r}_${i[r]}`)).join("")}function oe(e){return e&&!!e.signal}function Ia(e){return!!e.step}function iae(e){return I(e)?!1:"fields"in e&&!("data"in e)}function rae(e){return I(e)?!1:"fields"in e&&"data"in e}function Ma(e){return I(e)?!1:"field"in e&&"data"in e}const aae={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},oae=z(aae),sae={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Fx=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function lae(e){return e==null?void 0:e.selection}function Nx(e){return e&&!!e.field&&e.equal!==void 0}function gI(e){return e&&!!e.field&&e.lt!==void 0}function mI(e){return e&&!!e.field&&e.lte!==void 0}function vI(e){return e&&!!e.field&&e.gt!==void 0}function yI(e){return e&&!!e.field&&e.gte!==void 0}function Ix(e){if(e&&e.field){if(I(e.range)&&e.range.length===2)return!0;if(oe(e.range))return!0}return!1}function Mx(e){return e&&!!e.field&&(I(e.oneOf)||I(e.in))}function uae(e){return e&&!!e.field&&e.valid!==void 0}function bI(e){return Mx(e)||Nx(e)||Ix(e)||gI(e)||vI(e)||mI(e)||yI(e)}function sr(e,t){return e2(e,{timeUnit:t,wrapTime:!0})}function cae(e,t){return e.map(n=>sr(n,t))}function wI(e,t=!0){var n;const{field:i}=e,r=(n=an(e.timeUnit))===null||n===void 0?void 0:n.unit,a=r?"time("+eae(r,i)+")":U(e,{expr:"datum"});if(Nx(e))return a+"==="+sr(e.equal,r);if(gI(e)){const o=e.lt;return`${a}<${sr(o,r)}`}else if(vI(e)){const o=e.gt;return`${a}>${sr(o,r)}`}else if(mI(e)){const o=e.lte;return`${a}<=${sr(o,r)}`}else if(yI(e)){const o=e.gte;return`${a}>=${sr(o,r)}`}else{if(Mx(e))return`indexof([${cae(e.oneOf,r).join(",")}], ${a}) !== -1`;if(uae(e))return jx(a,e.valid);if(Ix(e)){const{range:o}=e,s=oe(o)?{signal:`${o.signal}[0]`}:o[0],l=oe(o)?{signal:`${o.signal}[1]`}:o[1];if(s!==null&&l!==null&&t)return"inrange("+a+", ["+sr(s,r)+", "+sr(l,r)+"])";const u=[];return s!==null&&u.push(`${a} >= ${sr(s,r)}`),l!==null&&u.push(`${a} <= ${sr(l,r)}`),u.length>0?u.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function jx(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function fae(e){var t;return bI(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=an(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Cl={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Zo=Cl.quantitative,Lx=Cl.ordinal,$l=Cl.temporal,Px=Cl.nominal,Dl=Cl.geojson,dae=z(Cl);function hae(e){if(e){e=e.toLowerCase();switch(e){case"q":case Zo:return"quantitative";case"t":case $l:return"temporal";case"o":case Lx:return"ordinal";case"n":case Px:return"nominal";case Dl:return"geojson"}}return}const rt={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},zx={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},pae=z(zx);function gae(e,t){const n=zx[e],i=zx[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const mae={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function xI(e){return mae[e]}const EI=["linear","log","pow","sqrt","symlog","time","utc"],vae=Et(EI),yae=["linear","log","pow","sqrt","symlog"],bae=Et(yae);function wae(e){return e in bae}const xae=["quantile","quantize","threshold"],Eae=Et(xae),kae=EI.concat(["quantile","quantize","threshold","sequential","identity"]),_ae=Et(kae),Aae=["ordinal","bin-ordinal","point","band"],Sae=Et(Aae);function Sn(e){return e in Sae}function ri(e){return e in _ae}function Ti(e){return e in vae}function Ig(e){return e in Eae}const Oae={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Tae(e){return!Y(e)&&!!e.name}function kI(e){return e==null?void 0:e.selection}function Cae(e){return e&&e.unionWith}const $ae={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Dae=Z($ae,["type","domain","range","scheme"]),Rae=z(Dae),Mde=Fae();function _I(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!ae(["point","band","identity"],e);case"bins":return!ae(["point","band","identity","ordinal"],e);case"round":return Ti(e)||e==="band"||e==="point";case"padding":return Ti(e)||ae(["point","band"],e);case"paddingOuter":case"align":return ae(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return Ti(e);case"nice":return Ti(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ri(e)&&!ae(["log","time","utc","threshold","quantile"],e)}}function AI(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Sl(e)?void 0:yre(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function SI(e,t){return ae([Lx,Px],t)?e===void 0||Sn(e):t===$l?ae([rt.TIME,rt.UTC,void 0],e):t===Zo?ae([rt.LOG,rt.POW,rt.SQRT,rt.SYMLOG,rt.QUANTILE,rt.QUANTIZE,rt.THRESHOLD,rt.LINEAR,void 0],e):!0}function OI(e,t){if(!Na(e))return!1;switch(e){case Ge:case ut:case Si:case Zi:return Ti(t)||ae(["band","point"],t);case zr:case $a:case Br:case Ta:case Ca:case Jo:return Ti(t)||Ig(t)||ae(["band","point","ordinal"],t);case _n:case nr:case ir:return t!=="band";case Da:return t==="ordinal"||Ig(t);case An:return t==="ordinal"}}function Fae(){var e;const t={};for(const n of zN)for(const i of dae)for(const r of pae){const a=Nae(n,i);OI(n,r)&&SI(r,i)&&(t[a]=(e=t[a])!==null&&e!==void 0?e:[],t[a].push(r))}return t}function Nae(e,t){return e+"_"+t}function Bx(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:a}=e,o=CI(e);return q(n)&&!IN(n.aggregate)&&r&&Ti(r.get("type"))&&r.get("zero")===!1?TI({fieldDef:n,channel:t,markDef:i,ref:o,config:a}):o}function TI({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(Vo(n.type))return i;const a=Se("invalid",n,r);return a===null?i:[Iae(e,t),i]}function Iae(e,t){const n=Ux(e,!0),i=Qo(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Ux(e,t=!0){return jx(Y(e)?e:U(e,{expr:"datum"}),!t)}function Mae(e){const{datum:t}=e;return Tl(t)?nf(t):`${JSON.stringify(t)}`}function es(e,t,n,i){const r={};if(t&&(r.scale=t),La(e)){const{datum:a}=e;Tl(a)?r.signal=nf(a):oe(a)?r.signal=a.signal:r.value=a}else r.field=U(e,n);if(i){const{offset:a,band:o}=i;a&&(r.offset=a),o&&(r.band=o)}return r}function Mg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=U(t,{expr:o,suffix:r}),l=n!==void 0?U(n,{expr:o}):U(t,{suffix:"end",expr:o}),u={};if(a===0||a===1){u.scale=e;const c=a===0?s:l;u.field=c}else{const c=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${c})`}return i&&(u.offset=i),u}function CI({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(se(t)){if(zn(t)){c=c??of({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:s,config:r,isMidPoint:!0});const{bin:h,timeUnit:p,type:g}=t;if(Ie(h)||c&&p&&g===$l)return s&&s.impute?es(t,a,{binSuffix:"mid"},{offset:l}):c?Mg({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):es(t,a,sf(t,e)?{binSuffix:"range"}:{},{offset:l});if(rn(h)){if(q(n))return Mg({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});{const m=e===Ge?Ai:Qi;j(lI(m))}}}const d=o==null?void 0:o.get("type");return es(t,a,Sn(d)?{binSuffix:"range"}:{},{offset:l,band:d==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(Ur(t)){const d=t.value,h=l?{offset:l}:{};return Object.assign(Object.assign({},rf(e,d)),h)}}return ge(u)&&(u=u()),u&&Object.assign(Object.assign({},u),l?{offset:l}:{})}function rf(e,t){return ae(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:ae(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:tt(t)}function ts(e){return e&&e!=="number"&&e!=="time"}function $I(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const jae=" – ";function qx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a}){var o,s;if(ts(n))return Wx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:a});const l=DI(e,i,r);if(Wg(e)){const u=Pae(l,q(e)?(o=an(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,a.timeFormat,Jx(e)&&((s=e.scale)===null||s===void 0?void 0:s.type)===rt.UTC);return u?{signal:u}:void 0}if(t=NI(ja(e),t,a),q(e)&&Ie(e.bin)){const u=U(e,{expr:i,binSuffix:"end"});return{signal:jg(l,u,t,n,a)}}else return t||ja(e)==="quantitative"?{signal:`${II(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function DI(e,t,n){return q(e)?n?`${U(e,{expr:t,suffix:"end"})}-${U(e,{expr:t,suffix:"start"})}`:U(e,{expr:t}):Mae(e)}function Wx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a,field:o}){if(o=o??DI(e,i,r),q(e)&&Ie(e.bin)){const s=U(e,{expr:i,binSuffix:"end"});return{signal:jg(o,s,t,n,a)}}return{signal:$I(n,o,t)}}function RI(e,t,n,i,r,a){var o;if(ts(i))return;if(Wg(e)){const s=q(e)?(o=an(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Lae(n,s,r,a)}return NI(t,n,r)}function FI(e,t,n){return e&&(oe(e)||e==="number"||e==="time")?e:Wg(t)&&n!=="time"&&n!=="utc"?"time":void 0}function NI(e,t,n){return Y(t)?t:e===Zo?n.numberFormat:void 0}function Lae(e,t,n,i){return e||(t?{signal:pI(t)}:i?void 0:n.timeFormat)}function II(e,t){return`format(${e}, "${t||""}")`}function MI(e,t,n,i){var r;return ts(n)?$I(n,e,t):II(e,(r=Y(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function jg(e,t,n,i,r){const a=MI(e,n,i,r),o=MI(t,n,i,r);return`${jx(e,!1)} ? "null" : ${a} + "${jae}" + ${o}`}function Pae(e,t,n,i,r){return!t||n?(n=Y(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):tae(t,e,r)}const Lg="min",zae={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function jI(e){return e in zae}function LI(e){return!!e&&!!e.encoding}function lr(e){return!!e&&(e.op==="count"||!!e.field)}function PI(e){return!!e&&I(e)}function af(e){return"row"in e||"column"in e}function Gx(e){return!!e&&"header"in e}function Pg(e){return"facet"in e}function Bae(e){return e.selection}function Uae(e){return e&&!Y(e)&&"repeat"in e}function zI(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function BI(e){return zn(e)&&"sort"in e}function of({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:a,isMidPoint:o}){if(se(t)&&t.band!==void 0)return t.band;if(q(t)){const{timeUnit:s,bin:l}=t;if(s&&!n)return o?rs("timeUnitBandPosition",i,a):DN(i.type)?rs("timeUnitBand",i,a):0;if(Ie(l))return DN(i.type)&&!o?1:.5}return(r==null?void 0:r.fieldChannel)===e&&o?.5:void 0}function Hx(e,t,n,i,r,a){return Ie(t.bin)||t.timeUnit&&zn(t)&&t.type==="temporal"?!!of({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:a}):!1}function Yx(e){return!!e&&"condition"in e}function zg(e){const t=e&&e.condition;return!!t&&!I(t)&&q(t)}function Vx(e){const t=e&&e.condition;return!!t&&!I(t)&&se(t)}function qae(e){const t=e&&e.condition;return!!t&&(I(t)||Ur(t))}function q(e){return!!e&&(!!e.field||e.aggregate==="count")}function ja(e){return e&&e.type}function La(e){return!!e&&"datum"in e}function ur(e){return zn(e)&&GI(e)||Xx(e)}function Xx(e){return La(e)&&De(e.datum)}function se(e){return q(e)||La(e)}function zn(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function Ur(e){return e&&"value"in e&&"value"in e}function Jx(e){return!!e&&("scale"in e||"sort"in e)}function Kx(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function UI(e){return!!e&&"legend"in e}function qI(e){return!!e&&("format"in e||"formatType"in e)}function Wae(e){return"op"in e}function U(e,t={}){var n,i,r;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(Gae(e))a=rie("count");else{let u;if(!t.nofn)if(Wae(e))u=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;Ie(c)?(u=HN(c),s=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?Xo(f)?(l=`["${a}"]`,a=`argmax_${f.argmax}`):Oa(f)?(l=`["${a}"]`,a=`argmin_${f.argmin}`):u=String(f):d&&(u=nae(d),s=(!ae(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}u&&(a=a?`${u}_${a}`:u)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?kN(a):t.expr?eie(a,t.expr)+l:Sa(a)+l}function WI(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return q(e)&&!!e.bin;case"temporal":return!1}throw new Error(nI(e.type))}function GI(e){return!WI(e)}function Gae(e){return e.aggregate==="count"}function Hae(e,t){var n;const{field:i,bin:r,timeUnit:a,aggregate:o}=e;if(o==="count")return t.countTitle;if(Ie(r))return`${i} (binned)`;if(a){const s=(n=an(a))===null||n===void 0?void 0:n.unit;if(s)return`${i} (${Rx(s).join("-")})`}else if(o)return Xo(o)?`${i} for max ${o.argmax}`:Oa(o)?`${i} for min ${o.argmin}`:`${mg(o)} of ${i}`;return i}function Yae(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(Xo(t))return`${r} for argmax(${t.argmax})`;if(Oa(t))return`${r} for argmin(${t.argmin})`;const a=an(i),o=t||(a==null?void 0:a.unit)||(a==null?void 0:a.maxbins)&&"timeunit"||Ie(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const HI=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Yae(e);default:return Hae(e,t)}};let YI=HI;function VI(e){YI=e}function Vae(){VI(HI)}function ns(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,a;const o=(r=Qx(e))!==null&&r!==void 0?r:{},s=o.title;if(!q(e))return s;const l=e,u=i?XI(l,t):void 0;return n?it(s,l.title,u):(a=s??l.title)!==null&&a!==void 0?a:u}function Qx(e){return Kx(e)&&e.axis?e.axis:UI(e)&&e.legend?e.legend:Gx(e)&&e.header?e.header:void 0}function XI(e,t){return YI(e,t)}function Bg(e){var t;if(qI(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=Qx(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function Xae(e,t){if(e.timeUnit)return"temporal";if(Ie(e.bin))return"quantitative";switch(Dg(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function cr(e){return q(e)?e:zg(e)?e.condition:void 0}function ct(e){return se(e)?e:Vx(e)?e.condition:void 0}function Zx(e,t,n){if(Y(e)||De(e)||no(e)){const i=Y(e)?"string":De(e)?"number":"boolean";return j(sre(t,i,e)),{value:e}}return se(e)?Ug(e,t,n):Vx(e)?Object.assign(Object.assign({},e),{condition:Ug(e.condition,t,n)}):e}function Ug(e,t,n){if(qI(e)){const{format:i,formatType:r}=e,a=Z(e,["format","formatType"]);if(ts(r)&&!n.customFormatTypes)return j(tI(t)),Ug(a,t,n)}else{const i=Kx(e)?"axis":UI(e)?"legend":Gx(e)?"header":null;if(i&&e[i]){const r=e[i],{format:a,formatType:o}=r,s=Z(r,["format","formatType"]);if(ts(o)&&!n.customFormatTypes)return j(tI(t)),Ug(Object.assign(Object.assign({},e),{[i]:s}),t,n)}}return q(e)?JI(e,t):Jae(e)}function Jae(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=De(n)?"quantitative":Y(n)?"nominal":Tl(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function JI(e,t){const{aggregate:n,timeUnit:i,bin:r,field:a}=e,o=Object.assign({},e);if(n&&!xx(n)&&!Xo(n)&&!Oa(n)&&(j(ure(n)),delete o.aggregate),i&&(o.timeUnit=an(i)),a&&(o.field=`${a}`),Ie(r)&&(o.bin=qg(r,t)),rn(r)&&!or(t)&&j(`Channel ${t} should not be used with "binned" bin.`),zn(o)){const{type:s}=o,l=hae(s);s!==l&&(o.type=l),s!=="quantitative"&&(IN(n)&&(j(lre(s,n)),o.type="quantitative"))}else if(!UN(t)){const s=Xae(o,t);j(cre(t,s)),o.type=s}if(zn(o)){const{compatible:s,warning:l}=Kae(o,t);s||j(l)}if(BI(o)&&Y(o.sort)){const{sort:s}=o;if(jI(s))return Object.assign(Object.assign({},o),{sort:{encoding:s}});const l=s.substr(1);if(s.charAt(0)==="-"&&jI(l))return Object.assign(Object.assign({},o),{sort:{encoding:l,order:"descending"}})}if(Gx(o)){const{header:s}=o,{orient:l}=s,u=Z(s,["orient"]);if(l)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},u),{labelOrient:s.labelOrient||l,titleOrient:s.titleOrient||l})})}return o}function qg(e,t){return no(e)?{maxbins:YN(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:YN(t)}):e}const is={compatible:!0};function Kae(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Mr:case jr:case _g:return GI(e)?{compatible:!1,warning:hre(t)}:is;case Ge:case ut:case _n:case nr:case ir:case Qc:case ef:case Ag:case Ko:case Sg:case Og:case Jo:case Si:case Zi:case Tg:return is;case tr:case ti:case er:case Oi:return n!==Zo?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:is;case Br:case Ta:case Ca:case $a:case zr:case Pr:case Lr:case Ai:case Qi:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:is;case Da:return ae(["ordinal","nominal"],e.type)?is:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case An:return ae(["ordinal","nominal","geojson"],e.type)?is:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case Zc:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:is}}function Wg(e){const{formatType:t}=Bg(e);return t==="time"||!t&&Qae(e)}function Qae(e){return e&&(e.type==="temporal"||q(e)&&!!e.timeUnit)}function e2(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var a;const o=t&&((a=an(t))===null||a===void 0?void 0:a.unit);let s=o||n==="temporal",l;return oe(e)?l=e.signal:Tl(e)?(s=!0,l=nf(e)):(Y(e)||De(e))&&(s&&(l=`datetime(${JSON.stringify(e)})`,Kre(o)&&((De(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(l=nf({[o]:e}))))),l?i&&s?`time(${l})`:l:r?void 0:JSON.stringify(e)}function KI(e,t){const{type:n}=e;return t.map(i=>{const r=e2(i,{timeUnit:q(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function sf(e,t){return Ie(e.bin)?Na(t)&&ae(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function QI(e){const{anchor:t,frame:n,offset:i,orient:r,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=Z(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),v=Vc(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:v,nonMark:g,subtitle:m}}function Pa(e){return Y(e)||I(e)&&Y(e[0])}function tt(e){return oe(e)?e:e!==void 0?{value:e}:void 0}function ZI(e){return oe(e)?e.signal:B(e.value)}function lf(e){return oe(e)?e.signal:e==null?null:B(e)}function Zae(e,t,n){for(const i of n){const r=rs(i,t.markDef,t.config);r!==void 0&&(e[i]=tt(r))}return e}function eM(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Se(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:a}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:a&&(!r||r===e)?void 0:rs(e,t,n,i)}function rs(e,t,n,{vgChannel:i}={}){return it(i?Gg(e,t,n.style):void 0,Gg(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Gg(e,t,n){return tM(e,eM(t),n)}function tM(e,t,n){t=G(t);let i;for(const r of t){const a=n[r];a&&a[e]!==void 0&&(i=a[e])}return i}function nM(e,t){return G(e).reduce((n,i)=>{var r;return n.field.push(U(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function iM(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Yc(r,i))return;n.push(i)}),n}function rM(e,t){return Yc(e,t)||!t?e:e?[...G(e),...G(t)].join(", "):t}function aM(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((Pa(n)||oe(n))&&(Pa(i)||oe(i)))return{explicit:e.explicit,value:rM(n,i)};if(Pa(n)||oe(n))return{explicit:e.explicit,value:n};if(Pa(i)||oe(i))return{explicit:e.explicit,value:i};if(!Pa(n)&&!oe(n)&&!Pa(i)&&!oe(i))return{explicit:e.explicit,value:iM(n,i)};throw new Error("It should never reach here")}function as(e,t){const n=e&&e[t];return n?I(n)?Xc(n,i=>!!i.field):q(n)||zg(n):!1}function t2(e){return Xc(zN,t=>{if(as(e,t)){const n=e[t];if(I(n))return Xc(n,i=>!!i.aggregate);{const i=cr(n);return i&&!!i.aggregate}}return!1})}function n2(e,t){const n=[],i=[],r=[],a=[],o={};return i2(e,(s,l)=>{if(q(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=Z(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const p=Qx(s),g=p&&p.title;let m=U(s,{forAs:!0});const v=Object.assign(Object.assign(Object.assign({},g?[]:{title:ns(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let y;if(Xo(c)?(y="argmax",m=U({op:"argmax",field:c.argmax},{forAs:!0}),v.field=`${m}.${u}`):Oa(c)?(y="argmin",m=U({op:"argmin",field:c.argmin},{forAs:!0}),v.field=`${m}.${u}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(y=c),y){const b={op:y,as:m};u&&(b.field=u),a.push(b)}}else if(n.push(m),zn(s)&&Ie(f)){if(i.push({bin:f,field:u,as:m}),n.push(U(s,{binSuffix:"end"})),sf(s,l)&&n.push(U(s,{binSuffix:"range"})),or(l)){const y={field:m+"_end"};o[l+"2"]=y}v.bin="binned",UN(l)||(v.type=Zo)}else if(d){r.push({timeUnit:d,field:u,as:m});const y=zn(s)&&s.type!==$l&&"time";y&&(l===Qc||l===Ko?v.formatType=y:Bie(l)?v.legend=Object.assign({formatType:y},v.legend):or(l)&&(v.axis=Object.assign({formatType:y},v.axis)))}o[l]=v}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:i,timeUnits:r,aggregate:a,groupby:n,encoding:o}}function eoe(e,t,n){const i=qie(t,n);if(i){if(i==="binned"){const r=e[t===Ai?Ge:ut];return!!(q(r)&&q(e[t])&&rn(r.bin))}}else return!1;return!0}function toe(e,t,n){const i=t.type;return z(e).reduce((r,a)=>{if(!BN(a))return j(dre(a)),r;const o=e[a];if(a==="angle"&&i==="arc"&&!e.theta&&(j(ore),a=Si),!eoe(e,a,i))return j(Fg(a,i)),r;if(a===zr&&i==="line"){const s=cr(e[a]);if(s==null?void 0:s.aggregate)return j(fre),r}if(a===_n&&(t.filled?"fill"in e:"stroke"in e))return j(iI("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(a===ef||a===Zc&&!I(o)&&!Ur(o)||a===Ko&&I(o))o&&(r[a]=G(o).reduce((s,l)=>(q(l)?s.push(JI(l,a)):j(Ox(l,a)),s),[]));else{if(a===Ko&&o===null)r[a]=null;else if(!q(o)&&!La(o)&&!Ur(o)&&!Yx(o)&&!oe(o))return j(Ox(o,a)),r;r[a]=Zx(o,a,n)}return r},{})}function noe(e){const t=[];for(const n of z(e))if(as(e,n)){const i=e[n],r=G(i);for(const a of r)q(a)?t.push(a):zg(a)&&t.push(a.condition)}return t}function i2(e,t,n){if(!e)return;for(const i of z(e)){const r=e[i];if(I(r))for(const a of r)t.call(n,a,i);else t.call(n,r,i)}}function oM(e,t,n,i){return e?z(e).reduce((r,a)=>{const o=e[a];return I(o)?o.reduce((s,l)=>t.call(i,s,l,a),r):t.call(i,r,o,a)},n):n}function sM(e,t){return z(t).reduce((n,i)=>{switch(i){case Ge:case ut:case Sg:case Tg:case Og:case Ai:case Qi:case Si:case Pr:case Zi:case Lr:case er:case tr:case Oi:case ti:case Qc:case An:case Jo:case Ko:return n;case Zc:if(e==="line"||e==="trail")return n;case ef:case Ag:{const r=t[i];if(I(r)||q(r))for(const a of G(r))a.aggregate||n.push(U(a,{}));return n}case zr:if(e==="trail")return n;case _n:case nr:case ir:case Br:case Ta:case Ca:case Da:case $a:{const r=cr(t[i]);return r&&!r.aggregate&&n.push(U(r,{})),n}}},[])}function ioe(e){const{tooltip:t}=e,n=Z(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;if(I(t)){for(const a of t)a.aggregate?(i||(i=[]),i.push(a)):(r||(r=[]),r.push(a));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return I(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function r2(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:a,titlePrefix:o})=>{const s=i?` of ${t.field}`:"";return{field:a+t.field,type:t.type,title:oe(o)?{signal:o+`"${escape(s)}"`}:o+s}});return{tooltip:[...r,...noe(n)]}}function lM(e){const{axis:t,title:n,field:i}=e;return t&&t.title!==void 0?void 0:it(n,i)}function a2(e,t,n,i,r){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c=void 0,aria:f,extraEncoding:d={}})=>{const h=lM(n);return uM(e,s,r,f,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},h!==void 0?{title:h}:{}),a!==void 0?{scale:a}:{}),o!==void 0?{axis:o}:{})},Y(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),d)})}}function uM(e,t,n,i,r){const{clip:a,color:o,opacity:s}=e,l=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),o?{color:o}:{}),s?{opacity:s}:{}),Ki(r.mark)?r.mark:{type:r.mark}),{style:`${l}-${t}`}),no(e[t])?{}:e[t]),i===!1?{aria:i}:{})})]:[]}function cM(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",a=i[r],o=i[r+"2"],s=i[r+"Error"],l=i[r+"Error2"];return{continuousAxisChannelDef:Hg(a,n),continuousAxisChannelDef2:Hg(o,n),continuousAxisChannelDefError:Hg(s,n),continuousAxisChannelDefError2:Hg(l,n),continuousAxis:r}}function Hg(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Z(e,["aggregate"]);return n!==t&&j(Lre(n,t)),i}else return e}function fM(e,t){const{mark:n,encoding:i}=e,{x:r,y:a}=i;if(ur(r)){if(ur(a)){const o=q(r)&&r.aggregate,s=q(a)&&a.aggregate;if(!o&&s===t)return"vertical";if(!s&&o===t)return"horizontal";if(o===t&&s===t)throw new Error("Both x and y cannot have aggregate");return Ki(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(ur(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const Yg="boxplot",roe=["box","median","outliers","rule","ticks"],aoe=new kg(Yg,hM);function dM(e){return De(e)?"tukey":e}function hM(e,{config:t}){var n,i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=Ki(r)?r:{type:r};o&&j(QN("boxplot"));const c=(n=u.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Se("size",u,t),d=dM(c),{transform:h,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:v,encodingWithoutContinuousAxis:y,ticksOrient:b,boxOrient:E,customTooltipWithoutAggregatedField:x}=ooe(e,c,t),{color:k,size:w}=y,A=Z(y,["color","size"]),_=J=>a2(u,g,p,J,t.boxplot),O=_(A),S=_(y),T=_(Object.assign(Object.assign({},A),w?{size:w}:{})),D=r2([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,y),M={type:"tick",color:"black",opacity:1,orient:b,invalid:null},C=d==="min-max"?D:r2([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,y),N=[...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:C}),...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:M,positionPrefix:"lower_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:M,positionPrefix:"upper_whisker",aria:!1,extraEncoding:C})],W=[...d!=="tukey"?N:[],...S({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:E,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:D}),...T({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},K(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:D})];let X;if(d!=="min-max"){const J=`datum["lower_box_${p.field}"]`,xe=`datum["upper_box_${p.field}"]`,Le=`(${xe} - ${J})`,ft=`${J} - ${c} * ${Le}`,dt=`${xe} + ${c} * ${Le}`,Je=`datum["${p.field}"]`,Dt={joinaggregate:pM(p.field),groupby:m};let li;d==="tukey"&&(li={transform:[{filter:`(${ft} <= ${Je}) && (${Je} <= ${dt})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:m}],layer:N});const Ya=Z(A,["tooltip"]),{scale:Vr,axis:H}=p,ue=lM(p),me=uM(u,"outliers",t.boxplot,!0,{transform:[{filter:`(${Je} < ${ft}) || (${Je} > ${dt})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},ue!==void 0?{title:ue}:{}),Vr!==void 0?{scale:Vr}:{}),H!==void 0?{axis:H}:{})},Ya),x?{tooltip:x}:{})})[0];me&&li?X={transform:[Dt],layer:[me,li]}:me?(X=me,X.transform.unshift(Dt)):li&&(X=li,X.transform.unshift(Dt))}return X?Object.assign(Object.assign({},l),{layer:[X,{transform:h,layer:W}]}):Object.assign(Object.assign({},l),{transform:((i=l.transform)!==null&&i!==void 0?i:[]).concat(h),layer:W})}function pM(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function ooe(e,t,n){const i=fM(e,Yg),{continuousAxisChannelDef:r,continuousAxis:a}=cM(e,i,Yg),o=r.field,s=dM(t),l=[...pM(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(s==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(s==="min-max"?"upper_whisker_":"max_")+o}],u=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=c[f],h=Z(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:g}=ioe(h),{bins:m,timeUnits:v,aggregate:y,groupby:b,encoding:E}=n2(g,n),x=i==="vertical"?"horizontal":"vertical",k=i,w=[...m,...v,{aggregate:[...y,...l],groupby:b},...u];return{transform:w,groupby:b,aggregate:y,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:E,ticksOrient:x,boxOrient:k,customTooltipWithoutAggregatedField:p}}const o2="errorbar",soe=["ticks","rule"],loe=new kg(o2,gM);function gM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=mM(e,o2,t),c=a2(s,r,i,a,t.errorbar),f={type:"tick",orient:o},d=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:u}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function uoe(e,t){const{encoding:n}=e;if(coe(n))return{orient:fM(e,t),inputType:"raw"};const i=foe(n),r=doe(n),a=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const s=n.x2,l=n.y2;if(se(s)&&se(l))throw new Error(`${t} cannot have both x2 and y2`);if(se(s)){if(ur(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(l)){if(ur(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const s=n.xError,l=n.xError2,u=n.yError,c=n.yError2;if(se(l)&&!se(s))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(u))throw new Error(`${t} cannot have yError2 without yError`);if(se(s)&&se(u))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(s)){if(ur(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(u)){if(ur(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function coe(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function foe(e){return se(e.x2)||se(e.y2)}function doe(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function mM(e,t,n){var i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=Ki(r)?r:{type:r};o&&j(QN(t));const{orient:c,inputType:f}=uoe(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=cM(e,c,t),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:E}=hoe(u,d,h,p,g,f,t,n),x=a,k=m,w=x[k],A=m==="x"?"x2":"y2",_=x[A],O=m==="x"?"xError":"yError",S=x[O],T=m==="x"?"xError2":"yError2",D=x[T],M=Z(x,[typeof k=="symbol"?k:k+"",typeof A=="symbol"?A:A+"",typeof O=="symbol"?O:O+"",typeof T=="symbol"?T:T+""]),{bins:C,timeUnits:N,aggregate:W,groupby:X,encoding:J}=n2(M,n),xe=[...W,...v],Le=f!=="raw"?[]:X,ft=r2(b,d,J,E);return{transform:[...(i=l.transform)!==null&&i!==void 0?i:[],...C,...N,...xe.length===0?[]:[{aggregate:xe,groupby:Le}],...y],groupby:Le,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:J,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:ft}}function hoe(e,t,n,i,r,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if(a==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center,p=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!==(p==="iqr")&&j(jre(h,p,o)),p==="stderr"||p==="stdev")l=[{op:p,field:c,as:"extent_"+c},{op:h,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:mg(h)},{fieldPrefix:"upper_",titlePrefix:vM(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:vM(h,p,"-")}],d=!0;else{e.center&&e.extent&&j(Pre(e.extent,o));let g,m,v;p==="ci"?(g="mean",m="ci0",v="ci1"):(g="median",m="q1",v="q3"),l=[{op:m,field:c,as:"lower_"+c},{op:v,field:c,as:"upper_"+c},{op:g,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:ns({field:c,aggregate:v,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:ns({field:c,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:ns({field:c,aggregate:g,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&j(Mre(e.center,e.extent)),a==="aggregated-upper-lower"?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):a==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?u.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const h of u)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Al(Al(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}function vM(e,t,n){return mg(e)+" "+n+" "+t}const s2="errorband",poe=["band","borders"],goe=new kg(s2,yM);function yM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=mM(e,s2,t),u=o,c=a2(u,r,i,a,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign({},h),p)):u.interpolate?j(sI("interpolate")):u.tension&&j(sI("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:l})]})}const bM={};function l2(e,t,n){const i=new kg(e,t);bM[e]={normalizer:i,parts:n}}function moe(){return z(bM)}l2(Yg,hM,roe),l2(o2,gM,soe),l2(s2,yM,poe);const voe=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],wM=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],yoe={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},boe={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},woe={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Rl="_vgsid_",xoe={single:{on:"click",fields:[Rl],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Rl],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function u2(e){return!!e&&(e==="legend"||!!e.legend)}function c2(e){return u2(e)&&K(e)}function Eoe(e){return Vg(e)||d2(e)||f2(e)}function f2(e){return"concat"in e}function Vg(e){return"vconcat"in e}function d2(e){return"hconcat"in e}function fr(e){return K(e)&&e.step!==void 0}function xM(e){return e.view||e.width||e.height}const EM=20,koe={align:1,bounds:1,center:1,columns:1,spacing:1},_oe=z(koe);function Aoe(e,t,n){var i,r;const a=n[t],o={},{spacing:s,columns:l}=a;s!==void 0&&(o.spacing=s),l!==void 0&&((Pg(e)&&!af(e.facet)||f2(e))&&(o.columns=l)),Vg(e)&&(o.columns=1);for(const u of _oe)if(e[u]!==void 0)if(u==="spacing"){const c=e[u];o[u]=De(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:s,column:(r=c.column)!==null&&r!==void 0?r:s}}else o[u]=e[u];return o}function h2(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function Xg(e,t){const n=uf(e,t);return fr(n)?n.step:p2}function uf(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return it(i,{step:e.step})}const p2=20,Soe={continuousWidth:200,continuousHeight:200,step:p2},Ooe={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Soe,mark:mie,arc:{},area:{},bar:yie,circle:{},geoshape:{},image:{},line:{},point:{},rect:bie,rule:{color:"black"},square:{},text:{color:"black"},tick:wie,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Oae,projection:{},legend:boe,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:xoe,style:{},title:{},facet:{spacing:EM},concat:{spacing:EM}},qr=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],kM={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},_M={blue:qr[0],orange:qr[1],red:qr[2],teal:qr[3],green:qr[4],yellow:qr[5],purple:qr[6],pink:qr[7],brown:qr[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Toe(e={}){return{signals:[{name:"color",value:K(e)?Object.assign(Object.assign({},_M),e):_M}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Coe(e){return{signals:[{name:"fontSize",value:K(e)?Object.assign(Object.assign({},kM),e):kM}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function $oe(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function AM(e={}){const{color:t,font:n,fontSize:i}=e,r=Z(e,["color","font","fontSize"]);return Jl({},Ooe,n?$oe(n):{},t?Toe(t):{},i?Coe(i):{},r||{})}const Doe=["view",...RN],Roe=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Foe=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},gie);function Noe(e){e=pe(e);for(const t of Roe)delete e[t];if(e.axis)for(const t in e.axis)vx(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of voe)delete e.legend[t];if(e.mark){for(const t of FN)delete e.mark[t];e.mark.tooltip&&K(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of Doe){for(const i of FN)delete e[t][i];const n=Foe[t];if(n)for(const i of n)delete e[t][i];Moe(e,t)}for(const t of moe())delete e[t];Ioe(e);for(const t in e)K(e[t])&&Fe(e[t])&&delete e[t];return Fe(e)?void 0:e}function Ioe(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=QI(e.title);Fe(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Fe(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Fe(i)?delete e.title:e.title=i}function Moe(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const a=Object.assign(Object.assign({},r),e.style[n??t]);Fe(a)||(e.style[n??t]=a),i||delete e[t]}function Jg(e){return"layer"in e}function joe(e){return"repeat"in e}function Loe(e){return!I(e.repeat)&&e.repeat.layer}class SM{map(e,t){return Pg(e)?this.mapFacet(e,t):joe(e)?this.mapRepeat(e,t):d2(e)?this.mapHConcat(e,t):Vg(e)?this.mapVConcat(e,t):f2(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(Jg(e))return this.mapLayer(e,t);if(Ir(e))return this.mapUnit(e,t);throw new Error(Sx(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(n=>this.mapLayerOrUnit(n,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(n=>this.map(n,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(n=>this.map(n,t))})}mapConcat(e,t){const{concat:n}=e,i=Z(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(r=>this.map(r,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const Poe={zero:1,center:1,normalize:1};function zoe(e){return e in Poe}const Boe=new Set([TN,bg,yg,Eg,xg,bx,wx,wg,CN,yx]),Uoe=new Set([bg,yg,TN]);function OM(e,t){var n,i;const r=t==="x"?"y":"radius",a=e[t],o=e[r];if(q(a)&&q(o))if(ja(a)==="quantitative"&&ja(o)==="quantitative"){if(a.stack)return t;if(o.stack)return r;const s=q(a)&&!!a.aggregate,l=q(o)&&!!o.aggregate;if(s!==l)return s?t:r;{const u=(n=a.scale)===null||n===void 0?void 0:n.type,c=(i=o.scale)===null||i===void 0?void 0:i.type;if(u&&u!=="linear")return r;if(c&&c!=="linear")return t}}else{if(ja(a)==="quantitative")return t;if(ja(o)==="quantitative")return r}else{if(ja(a)==="quantitative")return t;if(ja(o)==="quantitative")return r}return}function qoe(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function TM(e,t,n={}){const i=Ki(e)?e.type:e;if(!Boe.has(i))return null;const r=OM(t,"x")||OM(t,"theta");if(!r)return null;const a=t[r],o=q(a)?U(a,{}):void 0;let s=qoe(r),l=t[s],u=q(l)?U(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=Lie.reduce((d,h)=>{if(h!=="tooltip"&&as(t,h)){const p=t[h];for(const g of G(p)){const m=cr(g);if(m.aggregate)continue;const v=U(m,{});(!v||v!==u)&&d.push({channel:h,fieldDef:m})}}return d},[]);let f;if(a.stack!==void 0?no(a.stack)?f=a.stack?"zero":null:f=a.stack:c.length>0&&Uoe.has(i)&&(f="zero"),!f||!zoe(f))return null;if(t2(t)&&c.length===0)return null;if(a.scale&&a.scale.type&&a.scale.type!==rt.LINEAR){if(n.disallowNonLinearStack)return null;j(Fre(a.scale.type))}return se(t[rr(r)])?(a.stack!==void 0&&j(Rre(r)),null):(q(a)&&a.aggregate&&!ae(Sie,a.aggregate)&&j(Nre(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:r,impute:a.impute===null?!1:Vo(i),stackBy:c,offset:f})}function Woe(e){const t=Z(e,["point","line"]);return z(t).length>1?t:t.type}function Goe(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Nr(e[t],["point","line"])}));return e}function g2(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?K(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?K(t.point)?t.point:{}:void 0}function CM(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Hoe{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(Ir(e)){const{mark:n,encoding:i}=e,r=Ki(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!g2(r,t[r.type],i);case"area":return!!g2(r,t[r.type],i)||!!CM(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:a,encoding:o,mark:s}=e,l=Z(e,["selection","projection","encoding","mark"]),u=Ki(s)?s:{type:s},c=g2(u,i[u.type],o),f=u.type==="area"&&CM(u,i[u.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:Woe(Object.assign(Object.assign({},u.type==="area"&&u.opacity===void 0&&u.fillOpacity===void 0?{opacity:.7}:{}),u)),encoding:Nr(o,["shape"])})],h=TM(u,o);let p=o;if(h){const{fieldChannel:g,offset:m}=h;p=Object.assign(Object.assign({},o),{[g]:Object.assign(Object.assign({},o[g]),m?{stack:m}:{})})}return f&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},Vc(u,["clip","interpolate","tension","tooltip"])),f),encoding:p})),c&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Vc(u,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},t),{config:Goe(i)}))}}class Yoe{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(Ir(e)&&e.encoding)for(const n of ii){const i=e.encoding[n];if(i&&se(i)&&((t=i==null?void 0:i.scale)===null||t===void 0?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const r of ii){const a=ar(r),o=i[r];if(o&&se(o)&&((t=o==null?void 0:o.scale)===null||t===void 0?void 0:t.rangeStep)){const{scale:s}=o,l=Z(o,["scale"]),u=s,c=Z(u,["rangeStep"]);n[a]={step:s.rangeStep},j(vre),i=Object.assign(Object.assign({},i),{[r]:Object.assign(Object.assign({},l),Fe(c)?{}:{scale:c})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function Voe(e,t){return t?af(e)?FM(e,t):$M(e,t):e}function m2(e,t){return t?FM(e,t):e}function v2(e,t,n){const i=t[e];if(Uae(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});j(Zie(i.repeat));return}return t}function $M(e,t){if(e=v2("field",e,t),e===void 0)return;if(e===null)return null;if(BI(e)&&lr(e.sort)){const n=v2("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function DM(e,t){if(q(e))return $M(e,t);{const n=v2("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function RM(e,t){if(se(e)){const n=DM(e,t);if(n)return n;if(Yx(e))return{condition:e.condition}}else{if(Vx(e)){const n=DM(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=Z(e,["condition"]);return i}}return e}return}function FM(e,t){const n={};for(const i in e)if(Q(e,i)){const r=e[i];if(I(r))n[i]=r.map(a=>RM(a,t)).filter(a=>a);else{const a=RM(r,t);a!==void 0&&(n[i]=a)}}return n}class Xoe{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Ir(e)){const{encoding:t,mark:n}=e;if(n==="line")for(const i of Mie){const r=Qo(i),a=t[r];if(t[i]&&(q(a)&&!rn(a.bin)||La(a)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;return j(gre(!!i.x2,!!i.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}class Joe extends SM{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[aoe,loe,goe,new Hoe(),new Xoe(),new Yoe()]}map(e,t){if(Ir(e)){const n=as(e.encoding,Mr),i=as(e.encoding,jr),r=as(e.encoding,_g);if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Object.assign(Object.assign({},e),{encoding:m2(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const a=this.mapLayerOrUnit.bind(this);for(const o of this.nonFacetUnitNormalizers)if(o.hasMatchingType(r,t.config))return o.run(r,t,a);return r}mapRepeat(e,t){return Loe(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=Z(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:i}}),t):Object.assign(Object.assign({},r),{layer:s.map(c=>{const f=Object.assign(Object.assign({},l),{layer:c}),d=(i.name||"")+u+`child__layer_${Ue(c)}`,h=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:f,repeaterPrefix:d}));return h.name=d,h})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:a}=e,o=Z(e,["repeat","spec","data"]);!I(i)&&e.columns&&(e=Nr(e,["columns"]),j(ZN("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!I(i)&&i.row||[l?l.row:null],f=!I(i)&&i.column||[l?l.column:null],d=I(i)&&i||[l?l.repeat:null];for(const p of d)for(const g of c)for(const m of f){const v={repeat:p,row:g,column:m,layer:l.layer},y=(r.name||"")+u+"child__"+(I(i)?`${Ue(p)}`:(i.row?`row_${Ue(g)}`:"")+(i.column?`column_${Ue(m)}`:"")),b=this.map(r,Object.assign(Object.assign({},t),{repeater:v,repeaterPrefix:y}));b.name=y,s.push(Nr(b,["data"]))}const h=I(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(n=r.data)!==null&&n!==void 0?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return af(n)&&e.columns&&(e=Nr(e,["columns"]),j(ZN("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:a,config:o}=t,s=IM({parentProjection:a,projection:i}),l=NM({parentEncoding:r,encoding:m2(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:a}=n,o=Z(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=Z(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:a},t),v=m2(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:v}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:a}=e;if(i||r){a&&j(pre([...i?[Mr]:[],...r?[jr]:[]]));const o={},s={};for(const l of[Mr,jr]){const u=e[l];if(u){const c=Z(u,["align","center","spacing","columns"]);o[l]=c;for(const f of["align","center","spacing"])u[f]!==void 0&&(s[f]=(n=s[f])!==null&&n!==void 0?n:{},s[f][l]=u[f])}}return{facetMapping:o,layout:s}}else{const{align:o,center:s,spacing:l,columns:u}=a,c=Z(a,["align","center","spacing","columns"]);return{facetMapping:Voe(c,t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},o?{align:o}:{}),s?{center:s}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=Z(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=Z(e,["encoding","projection"]),l=Object.assign(Object.assign({},r),{parentEncoding:NM({parentEncoding:n,encoding:a}),parentProjection:IM({parentProjection:i,projection:o})});return super.mapLayer(s,l)}}function NM(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const r=z(t).reduce((a,o)=>(n[o]&&a.push(o),a),[]);r.length>0&&j(rre(r))}const i=Object.assign(Object.assign({},t??{}),n??{});return Fe(i)?void 0:i}function IM(e){const{parentProjection:t,projection:n}=e;return t&&n&&j(are({parentProjection:t,projection:n})),n??t}function MM(e,t){t===void 0&&(t=AM(e.config));const n=Qoe(e,t),{width:i,height:r}=e,a=Zoe(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const Koe=new Joe();function Qoe(e,t={}){return Koe.map(e,{config:t})}function jM(e){return Y(e)?{type:e}:e??{}}function Zoe(e,t,n){let{width:i,height:r}=t;const a=Ir(e)||Jg(e),o={};a?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(j(VN("width")),i=void 0),r=="container"&&(j(VN("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?jM(n.autosize):{}),jM(e.autosize));return s.type==="fit"&&!a&&(j(Hie),s.type="pad"),i=="container"&&!(s.type=="fit"||s.type=="fit-x")&&j(XN("width")),r=="container"&&!(s.type=="fit"||s.type=="fit-y")&&j(XN("height")),Yc(s,{type:"pad"})?void 0:s}function ese(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function tse(e){return e?`fit-${Cg(e)}`:"fit"}const nse=["background","padding"];function LM(e){return nse.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class za{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new za(pe(this.explicit),pe(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return it(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){t.value!==void 0&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){t.explicit[e]!==void 0?this.set(e,t.explicit[e],!0):t.implicit[e]!==void 0&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){t[e]!==void 0&&this.set(e,t[e],!0)}copyAll(e){for(const t of z(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function os(e){return{explicit:!0,value:e}}function Bn(e){return{explicit:!1,value:e}}function PM(e){return(t,n,i,r)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:Kg(t,n,i,r)}}function Kg(e,t,n,i){return e.explicit&&t.explicit&&j(Are(n,i,e.value,t.value)),e}function Ba(e,t,n,i,r=Kg){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Yc(e.value,t.value)?e:r(e,t,n,i)}class ise extends za{constructor(e={},t={},n=!1){super(e,t);this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function cf(e){return"url"in e}function Qg(e){return"values"in e}function zM(e){return"name"in e&&!cf(e)&&!Qg(e)&&!ss(e)}function ss(e){return e&&(BM(e)||UM(e)||y2(e))}function BM(e){return"sequence"in e}function UM(e){return"sphere"in e}function y2(e){return"graticule"in e}const Ut="main",Zg="raw";function qM(e){return"filter"in e}function rse(e){return(e==null?void 0:e.stop)!==void 0}function ase(e){return"lookup"in e}function ose(e){return"data"in e}function sse(e){return"selection"in e}function lse(e){return"pivot"in e}function use(e){return"density"in e}function cse(e){return"quantile"in e}function fse(e){return"regression"in e}function dse(e){return"loess"in e}function hse(e){return"sample"in e}function pse(e){return"window"in e}function gse(e){return"joinaggregate"in e}function mse(e){return"flatten"in e}function vse(e){return"calculate"in e}function yse(e){return"bin"in e}function bse(e){return"impute"in e}function wse(e){return"timeUnit"in e}function xse(e){return"aggregate"in e}function Ese(e){return"stack"in e}function kse(e){return"fold"in e}function _se(e){return e.map(t=>qM(t)?{filter:pg(t.filter,fae)}:t)}function ff(e,t,n,i){const r=Yx(t)&&t.condition,a=i(t);if(r){const o=G(r),s=o.map(l=>{const u=i(l),c=Bae(l)?gj(e,l.selection):am(e,l.test);return Object.assign({test:c},u)});return{[n]:[...s,...a!==void 0?[a]:[]]}}else return a!==void 0?{[n]:a}:{}}function b2(e,t="text"){const n=e.encoding[t];return ff(e,n,t,i=>em(i,e.config))}function em(e,t,n="datum"){if(e){if(Ur(e))return tt(e.value);if(se(e)){const{format:i,formatType:r}=Bg(e);return qx({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function WM(e,t={}){const{encoding:n,markDef:i,config:r,stack:a}=e,o=n.tooltip;if(I(o))return{tooltip:HM({tooltip:o},a,r,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return ff(e,o,"tooltip",l=>{const u=em(l,r,s);if(u)return u;if(l===null)return;let c=Se("tooltip",i,r);return c===!0&&(c={content:"encoding"}),Y(c)?{value:c}:K(c)?c.content==="encoding"?HM(n,a,r,t):{signal:s}:void 0})}}function GM(e,t,n,{reactiveGeom:i}={}){const r={},a=i?"datum.datum":"datum",o=[];function s(u,c){const f=Qo(c),d=zn(u)?u:Object.assign(Object.assign({},u),{type:e[f].type}),h=G(ns(d,n,{allowDisabling:!1})).join(", ");let p;if(or(c)){const g=c==="x"?"x2":"y2",m=cr(e[g]);if(rn(d.bin)&&m){const v=U(d,{expr:a}),y=U(m,{expr:a}),{format:b,formatType:E}=Bg(d);p=jg(v,y,b,E,n),r[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:y}=Bg(d);p=qx({fieldOrDatumDef:d,format:v,formatType:y,expr:a,config:n,normalizeStack:!0}).signal}}p=p??em(d,n,a).signal,o.push({channel:c,key:h,value:p})}i2(e,(u,c)=>{q(u)?s(u,c):zg(u)&&s(u.condition,c)});const l={};for(const{channel:u,key:c,value:f}of o)!r[u]&&!l[c]&&(l[B(c)]=f);return l}function HM(e,t,n,{reactiveGeom:i}={}){const r=GM(e,t,n,{reactiveGeom:i}),a=xN(r).map(({key:o,value:s})=>`${o}: ${s}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function Ase(e){const{markDef:t,config:n}=e,i=Se("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Sse(e)),Ose(e))}function Sse(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Se("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in sae?{}:{ariaRoleDescription:{value:t}}}function Ose(e){const{encoding:t,markDef:n,config:i,stack:r}=e,a=t.description;if(a)return ff(e,a,"description",l=>em(l,e.config));const o=Se("description",n,i);if(o!=null)return{description:tt(o)};if(i.aria===!1)return{};const s=GM(t,r,i);return Fe(s)?void 0:{description:{signal:xN(s).map(({key:l,value:u})=>`${l} + ": " + (${u})`).join(' + "; " + ')}}}function wt(e,t,n={}){const{markDef:i,encoding:r,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;s===void 0&&(l=l??Se(e,i,a,{vgChannel:o,ignoreVgConfig:!0}),l!==void 0&&(s=tt(l)));const u=r[e];return ff(t,u,o??e,c=>CI({channel:e,channelDef:c,markDef:i,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function YM(e,t={filled:void 0}){var n,i,r,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=(n=t.filled)!==null&&n!==void 0?n:Se("filled",o,l),f=ae(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=(r=(i=Se(c===!0?"color":void 0,o,l,{vgChannel:"fill"}))!==null&&i!==void 0?i:l.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,h=(a=Se(c===!1?"color":void 0,o,l,{vgChannel:"stroke"}))!==null&&a!==void 0?a:l.mark[c===!1&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},d?{fill:tt(d)}:{}),h?{stroke:tt(h)}:{});return o.color&&(c?o.fill:o.stroke)&&j(iI("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),wt("color",e,{vgChannel:p,defaultValue:c?d:h})),wt("fill",e,{defaultValue:s.fill?d:void 0})),wt("stroke",e,{defaultValue:s.stroke?h:void 0}))}function df(e,t){const n=jie(e),i=t[n];return i||void 0}function qt(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[rr(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=df(e,o),p=w2({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),g=!u&&or(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:Tse({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:r,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return g?{[i||e]:g}:void 0}function Tse(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:a,offset:o,markDef:s,config:l}=e;if(se(n)&&a&&t===a.fieldChannel){if(q(n)){const u=of({channel:t,fieldDef:n,isMidPoint:i,markDef:s,stack:a,config:l});if(u!==void 0)return Mg({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:u,offset:o})}return es(n,r,{suffix:"end"},{offset:o})}return Bx(e)}function w2({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:a,config:o}=e;return()=>{const s=Qo(n),l=Ra(n),u=Se(n,a,o,{vgChannel:l});if(u!==void 0)return rf(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!ae([rt.LOG,rt.TIME,rt.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return s==="y"?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[ar(n)];return Object.assign(Object.assign({},c),{mult:.5})}}return}}const Cse={left:"x",center:"xc",right:"x2"},$se={top:"y",middle:"yc",bottom:"y2"};function VM(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Ra(e);const r=e==="x"?"align":"baseline",a=Se(r,t,n);return e==="x"?Cse[a||(i==="top"?"left":"center")]:$se[a||i]}function tm(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?XM(e,t,{defaultPos:n,defaultPos2:i}):qt(e,t,{defaultPos:n})}function XM(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:a}=t,o=rr(e),s=ar(e),l=Dse(t,i,o),u=l[s]?VM(e,r,a):Ra(e);return Object.assign(Object.assign({},qt(e,t,{defaultPos:n,vgChannel:u})),l)}function Dse(e,t,n){const{encoding:i,mark:r,markDef:a,stack:o,config:s}=e,l=Qo(n),u=ar(n),c=Ra(n),f=i[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=n in i||n in a?df(n,e.markDef):df(l,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const g=Rse({channel:n,channelDef:f,channel2Def:i[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:nm(n,a)||nm(n,{[n]:Gg(n,a,s.style),[u]:Gg(u,a,s.style)})||nm(n,s[r])||nm(n,s.mark)||{[c]:w2({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function Rse({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return se(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?es(t,a,{suffix:"start"},{offset:l}):Bx({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:i,config:r,offset:l,defaultRef:u})}function nm(e,t){const n=ar(e),i=Ra(e);return t[i]!==void 0?{[i]:rf(e,t[i])}:t[e]!==void 0?{[i]:rf(e,t[e])}:t[n]?{[n]:rf(e,t[n])}:void 0}function Ua(e,t,n){var i,r,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=rr(t),d=ar(t),h=l[t],p=l[f],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,v=e.scaleName(t),y=u.orient,b=(r=(i=l[d])!==null&&i!==void 0?i:l.size)!==null&&r!==void 0?r:Se("size",u,s,{vgChannel:d}),E=n==="bar"&&(t==="x"?y==="vertical":y==="horizontal");if(q(h)&&(Ie(h.bin)||rn(h.bin)||h.timeUnit&&!p)&&!b&&!Sn(m)){const x=of({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),k=(a=e.component.axes[t])===null||a===void 0?void 0:a[0],w=(o=k==null?void 0:k.get("translate"))!==null&&o!==void 0?o:.5;return Ise({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:v,band:x,axisTranslate:w,spacing:or(t)?Se("binSpacing",u,s):void 0,reverse:g.get("reverse"),config:s})}else return(se(h)&&Sn(m)||E)&&!p?Nse(n,h,t,e):XM(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Fse(e,t,n,i,r,a){if(i){const l=i.get("type");if(l==="point"||l==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(l===rt.POINT){const u=i.get("range");return Ia(u)&&De(u.step)?{value:u.step-2}:{value:p2-2}}else return{scale:n,band:a}}else return{value:r[e].continuousBandSize}}const o=Xg(r.view,t),s=it(r[e].discreteBandSize,o-2);return s!==void 0?{value:s}:void 0}function Nse(e,t,n,i){var r;const{markDef:a,encoding:o,config:s,stack:l}=i,u=a.orient,c=i.scaleName(n),f=i.getScaleComponent(n),d=ar(n),h=rr(n),p=u==="horizontal"&&n==="y"||u==="vertical"&&n==="x",g=Se(p?"size":d,a,s,{vgChannel:d});let m;(o.size||g!==void 0)&&(p?m=wt("size",i,{vgChannel:d,defaultValue:g}):j(Ere(a.type)));const v=(r=se(t)?of({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)!==null&&r!==void 0?r:1;m=m||{[d]:Fse(e,d,c,f,s,v)};const y=(f==null?void 0:f.get("type"))!=="band"||!("band"in m[d]),b=VM(n,a,s,y?"middle":"top"),E=df(n,a),x=Bx({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:E,defaultRef:w2({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:y?.5:(1-v)/2});if(d)return Object.assign({[b]:x},m);{const k=Ra(h),w=m[d],A=E?Object.assign(Object.assign({},w),{offset:E}):w;return{[b]:x,[k]:I(x)?[x[0],Object.assign(Object.assign({},x[1]),{offset:A})]:Object.assign(Object.assign({},x),{offset:A})}}}function hf(e,t,n,i,r){if(jN(e))return 0;const a=e==="x"||e==="y2"?-t/2:t/2;if(oe(n)){const o=lf(r);return{signal:`${n.signal} ? ${i-a}${o?"-"+o:""} : ${i+a}${o?"+"+o:""}`}}else{if(oe(r)){const o=i+(n?-a:a);return{signal:`${o||""}${n?" - ":o?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-a:+r+a)}}function Ise({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=rr(n),f=Ra(n),d=Ra(c),h=df(n,a);if(Ie(e.bin)||e.timeUnit)return{[d]:JM({channel:n,fieldDef:e,scaleName:r,markDef:a,band:(1-i)/2,offset:hf(c,o,l,s,h),config:u}),[f]:JM({channel:n,fieldDef:e,scaleName:r,markDef:a,band:1-(1-i)/2,offset:hf(n,o,l,s,h),config:u})};if(rn(e.bin)){const p=es(e,r,{},{offset:hf(c,o,l,s,h)});if(q(t))return{[d]:p,[f]:es(t,r,{},{offset:hf(n,o,l,s,h)})};if(tf(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${U(e,{expr:"datum"})} + ${e.bin.step})`,offset:hf(n,o,l,s,h)}}}j(lI(c));return}function JM({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:a,config:o}){const s=Mg({scaleName:n,fieldOrDatumDef:t,band:r,offset:a});return TI({fieldDef:t,channel:e,markDef:i,ref:s,config:o})}const Mse=new Set(["aria"]);function ai(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?YM(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},jse(e.markDef,t)),KM(e,"fill",n)),KM(e,"stroke",i)),wt("opacity",e)),wt("fillOpacity",e)),wt("strokeOpacity",e)),wt("strokeWidth",e)),wt("strokeDash",e)),WM(e)),b2(e,"href")),Ase(e))}function KM(e,t,n){const{config:i,mark:r,markDef:a}=e,o=Se("invalid",a,i);if(o==="hide"&&n&&!Vo(r)){const s=Lse(e,{invalid:!0,channels:$g});if(s)return{[t]:[{test:s,value:null},...G(n)]}}return n?{[t]:n}:{}}function jse(e,t){return oae.reduce((n,i)=>(!Mse.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=tt(e[i])),n),{})}function Lse(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ri(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>Ux(o,t)).join(` ${a} `)}return}function x2(e){const{config:t,markDef:n}=e,i=Se("invalid",n,t);if(i){const r=Pse(e,{channels:ii});if(r)return{defined:{signal:r}}}return{}}function Pse(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ri(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>Ux(o,t)).join(` ${a} `)}return}function QM(e,t){return t!==void 0?{[e]:tt(t)}:void 0}const E2="voronoi",ZM={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(E2)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,a=e.mark;if(Vo(a))return j(Vie(a)),n;const o={name:e.getName(E2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},WM(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((u,c)=>{var f;const d=(f=u.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?s=c:d.indexOf(E2)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}};class $e{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){if(this._children.indexOf(e)>-1){console.warn("Attempt to add the same child twice.");return}t!==void 0?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class on extends $e{constructor(e,t,n,i){super(e,t);this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor();return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return this._hash===void 0&&(this._hash=`Output ${iie()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class Wr extends $e{constructor(e,t){super(e);this.formula=t}clone(){return new Wr(null,pe(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{const{field:o,timeUnit:s}=r,l=Xe(t)?t.encoding[rr(a)]:void 0,u=Xe(t)&&Hx(a,r,l,t.stack,t.markDef,t.config);if(s){const c=U(r,{forAs:!0});i[we({as:c,field:o,timeUnit:s})]=Object.assign({as:c,field:o,timeUnit:s},u?{band:!0}:{})}return i},{});return Fe(n)?null:new Wr(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=Z(n,["timeUnit"]),a=an(i),o=Object.assign(Object.assign({},r),{timeUnit:a});return new Wr(e,{[we(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)(!this.formula[t]||e.formula[t].band)&&(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Aa(this.formula).map(e=>e.as))}dependentFields(){return new Set(Aa(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${we(this.formula)}`}assemble(){const e=[];for(const t of Aa(this.formula)){const{field:n,as:i,timeUnit:r}=t,a=an(r),{unit:o,utc:s}=a,l=Z(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Sa(n),type:"timeunit"},o?{units:Rx(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return e}}const pf="_tuple_fields";class zse{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const Bse={has:()=>!0,parse:(e,t,n)=>{var i,r,a;const o=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new zse(),l={},u={},c=new Set(),f=(d,h)=>{const p=h==="visual"?d.channel:d.field;let g=Ue(`${o}_${p}`);for(let m=1;c.has(g);m++)g=Ue(`${o}_${p}_${m}`);return c.add(g),{[h]:g}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const h of G(n.init))for(const p of z(h))Iie(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(j('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const h={type:"E",field:d};h.signals=Object.assign({},f(h,"data")),s.items.push(h),s.hasField[d]=h}for(const d of(a=n.encodings)!==null&&a!==void 0?a:[]){const h=e.fieldDef(d);if(h){let p=h.field;if(h.aggregate){j(Yie(d,h.aggregate));continue}else if(!p){j(KN(d));continue}if(h.timeUnit){p=e.vgField(d);const g={timeUnit:h.timeUnit,as:p,field:h.field};u[we(g)]=g}if(!l[p]){let g="E";if(t.type==="interval"){const v=e.getScaleComponent(d).get("type");ri(v)&&(g="R")}else h.bin&&(g="R-RE");const m={field:p,channel:d,type:g};m.signals=Object.assign(Object.assign({},f(m,"data")),f(m,"visual")),s.items.push(l[p]=m),s.hasField[p]=s.hasChannel[d]=l[p]}}else j(KN(d))}if(n.init){const d=h=>s.items.map(p=>h[p.channel]!==void 0?h[p.channel]:h[p.field]);if(n.type==="interval")t.init=d(n.init);else{const h=G(n.init);t.init=h.map(d)}}Fe(u)||(s.timeUnit=new Wr(null,u))},signals:(e,t,n)=>{const i=t.name+pf,r=n.filter(a=>a.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(a=>{const o=Z(a,["signals","hasLegend"]);return o.field=Sa(o.field),o})})}},ej={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!u2(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,a=t.bind,o=t.init&&t.init[0],s=ZM.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((l,u)=>{var c,f;const d=Ue(`${i}_${l.field}`),h=n.filter(p=>p.name===d);h.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Fl(o[u])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${B(l.field)}] : null`}]:[],bind:(f=(c=a[l.field])!==null&&c!==void 0?c:a[l.channel])!==null&&f!==void 0?f:a}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.filter(u=>u.name===i+dr)[0],o=i+pf,s=r.items.map(u=>Ue(`${i}_${u.field}`)),l=s.map(u=>`${u} !== null`).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},im="_toggle",tj={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+im,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+dr,i=t.name+im;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Gr(e)}}, `)+`${i} ? ${n} : null`}},Use={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=Y(n.clear)?Uo(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(ej.has(t))for(const i of t.project.items){const r=n.findIndex(a=>a.name===Ue(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,a){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:a})}if(t.type==="interval")for(const r of t.project.items){const a=n.findIndex(o=>o.name===r.signals.visual);if(i(a,"[0, 0]"),a===-1){const o=n.findIndex(s=>s.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(a=>a.name===t.name+dr);i(r,"null"),tj.has(t)&&(r=n.findIndex(a=>a.name===t.name+im),i(r,"false"))}return n}},qa={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Na(r))continue;const a=e.getScaleComponent(r),o=a?a.get("type"):void 0;if(!a||!ri(o)){j(Jie);continue}const s={selection:t.name,field:i.field};a.set("selectionExtent",s,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(s=>s.name===o.signals.data).length===0);if(!e.parent||_2(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let a=r.update;if(a.indexOf(dj)>=0)r.update=`{${i.map(o=>`${B(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const s=`${B(o.field)}: ${o.signals.data}`;a.indexOf(s)<0&&(a=`${a.substring(0,a.length-1)}, ${s}}`)}r.update=a}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!_2(e))for(const i of t.scales){const r=n.filter(a=>a.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function k2(e,t){const n=B(e.scaleName(t));return`domain(${n})`}function _2(e){var t;return e.parent&&Pl(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:_2(e.parent.parent))}const nj={has:e=>{const t=e.resolve==="global"&&e.bind&&u2(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Rl;return t&&!n&&j(Kie),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const l of t.events)l.filter=G((r=l.filter)!==null&&r!==void 0?r:[]),l.filter.indexOf(s)<0&&l.filter.push(s)}const a=c2(t.bind)?t.bind.legend:"click",o=Y(a)?Uo(a,"view"):G(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=c2(t.bind)&&t.bind.legend,a=o=>s=>{const l=pe(s);return l.markname=o,l};for(const o of t.project.items){if(!o.hasLegend)continue;const s=`${Ue(o.field)}_legend`,l=`${i}_${s}`,u=n.filter(c=>c.name===l);if(u.length===0){const c=r.merge.map(a(`${s}_symbols`)).concat(r.merge.map(a(`${s}_labels`))).concat(r.merge.map(a(`${s}_entries`)));n.unshift(Object.assign(Object.assign({name:l},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${l}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.find(d=>d.name===i+dr),o=i+pf,s=r.items.filter(d=>d.hasLegend).map(d=>Ue(`${i}_${Ue(d.field)}_legend`)),l=s.map(d=>`${d} !== null`).join(" && "),u=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(d=>({signal:d})),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);const c=n.find(d=>d.name===i+im),f=c2(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function qse(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;us(e,a=>{var o,s;const l=(o=a.project.hasField[r])!==null&&o!==void 0?o:a.project.hasChannel[t];if(l&&nj.has(a)){const u=(s=n.get("selections"))!==null&&s!==void 0?s:[];u.push(a.name),n.set("selections",u,!1),l.hasLegend=!0}})}const ij="_translate_anchor",rj="_translate_delta",Wse={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=qa.has(t),a=i+ij,{x:o,y:s}=t.project.hasChannel;let l=Uo(t.translate,"scope");return r||(l=l.map(u=>(u.between[0].markname=i+gf,u))),n.push({name:a,value:{},on:[{events:l.map(u=>u.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?k2(e,Ge):`slice(${o.signals.visual})`):"")+(s!==void 0?", extent_y: "+(r?k2(e,ut):`slice(${s.signals.visual})`):"")+"}"}]},{name:i+rj,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),o!==void 0&&aj(e,t,o,"width",n),s!==void 0&&aj(e,t,s,"height",n),n}};function aj(e,t,n,i,r){var a;const o=t.name,s=o+ij,l=o+rj,u=n.channel,c=qa.has(t),f=r.filter(E=>E.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(u),p=h.get("type"),g=c&&u===Ge?"-":"",m=`${s}.extent_${u}`,v=`${g}${l}.${u} / `+(c?`${d}`:`span(${m})`),y=c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear",b=`${y}(${m}, ${v}`+(c&&p==="pow"?`, ${(a=h.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?b:`clampRange(${b}, 0, ${d})`})}const oj="_zoom_anchor",sj="_zoom_delta",Gse={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=qa.has(t),a=i+sj,{x:o,y:s}=t.project.hasChannel,l=B(e.scaleName(Ge)),u=B(e.scaleName(ut));let c=Uo(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+gf,f))),n.push({name:i+oj,on:[{events:c,update:r?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&lj(e,t,o,"width",n),s!==void 0&&lj(e,t,s,"height",n),n}};function lj(e,t,n,i,r){var a;const o=t.name,s=n.channel,l=qa.has(t),u=r.filter(y=>y.name===n.signals[l?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?k2(e,s):u.name,p=o+sj,g=`${o}${oj}.${s}`,m=l?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=`${m}(${h}, ${g}, ${p}`+(l&&d==="pow"?`, ${(a=f.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?v:`clampRange(${v}, 0, ${c})`})}const Hse=[Bse,tj,qa,nj,Wse,Gse,ej,ZM,Use];function rm(e,t){for(const n of Hse)n.has(e)&&t(n)}function Fl(e,t=!0,n=Ht){if(I(e)){const i=e.map(r=>Fl(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Tl(e))return n(t?nf(e):Jre(e));return t?n(JSON.stringify(e)):e}function Yse(e,t){return us(e,(n,i)=>{const r=n.name;let a=i.modifyExpr(e,n);t.push(...i.signals(e,n)),rm(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(a=o.modifyExpr(e,n,a))}),t.push({name:r+ile,on:[{events:{signal:n.name+dr},update:`modify(${B(n.name+ls)}, ${a})`}]})}),A2(t)}function Vse(e,t){if(e.component.selection&&z(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Uo("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return A2(t)}function Xse(e,t){let n=!1;if(us(e,(i,r)=>{const a=i.name,o=B(a+ls),s=t.filter(l=>l.name===a);if(s.length===0){const l=i.resolve==="global"?"union":i.resolve,u=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${dj}(${o}, ${B(l)}${u}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),rm(i,l=>{l.topLevelSignals&&(t=l.topLevelSignals(e,i,t))})}),n){const i=t.filter(r=>r.name==="unit");i.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return A2(t)}function Jse(e,t){const n=[...t];return us(e,i=>{const r={name:i.name+ls};if(i.init){const o=i.project.items.map(l=>{const u=Z(l,["signals"]);return u}),s=i.init.map(l=>Fl(l,!1));r.values=i.type==="interval"?[{unit:Gr(e,{escape:!1}),fields:o,values:s}]:s.map(l=>({unit:Gr(e,{escape:!1}),fields:o,values:l}))}const a=n.filter(o=>o.name===i.name+ls);a.length||n.push(r)}),n}function uj(e,t){return us(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,rm(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function Kse(e,t){for(const n of e.children)Xe(n)&&(t=uj(n,t));return t}function Qse(e,t){const n=t.selection,i=e.getSelectionComponent(n,Ue(n));return{signal:mj(i,t)}}function A2(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const gf="_brush",S2="_scale_trigger",Zse={signals:(e,t)=>{const n=t.name,i=n+pf,r=qa.has(t),a=[],o=[],s=[];if(t.translate&&!r){const c=`!event.item || event.item.mark.name !== ${B(n+gf)}`;cj(t,(f,d)=>{var h;const p=G((h=d.between[0].filter)!==null&&h!==void 0?h:d.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==Ge&&d!==ut){j("Interval selections only support x and y encoding channels.");return}const h=t.init?t.init[f]:null,p=ele(e,t,c,h),g=c.signals.data,m=c.signals.visual,v=B(e.scaleName(d)),y=e.getScaleComponent(d).get("type"),b=ri(y)?"+":"";a.push(...p),o.push(g),s.push({scaleName:e.scaleName(d),expr:`(!isArray(${g}) || (${b}invert(${v}, ${m})[0] === ${b}${g}[0] && ${b}invert(${v}, ${m})[1] === ${b}${g}[1]))`})}),r||a.push({name:n+S2,value:{},on:[{events:s.map(c=>({scale:c.scaleName})),update:s.map(c=>c.expr).join(" && ")+` ? ${n+S2} : {}`}]});const l=t.init,u=`unit: ${Gr(e)}, fields: ${i}, values`;return a.concat(Object.assign(Object.assign({name:n+dr},l?{init:`{${u}: ${Fl(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>{const n=t.name+dr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Gr(e)}}`)},marks:(e,t,n)=>{const i=t.name,{x:r,y:a}=t.project.hasChannel,o=r&&r.signals.visual,s=a&&a.signals.visual,l=`data(${B(t.name+ls)})`;if(qa.has(t))return n;const u={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:a!==void 0?{signal:`${s}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:a!==void 0?{signal:`${s}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of z(u))u[m]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${Gr(e)}`},u[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=Z(c,["fill","fillOpacity","cursor"]),g=z(p).reduce((m,v)=>(m[v]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,a!==void 0&&`${s}[0] !== ${s}[1]`].filter(y=>y).join(" && "),value:p[v]},{value:null}],m),{});return[{name:i+gf+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:i+gf,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),g)}}]}};function ele(e,t,n,i){const r=n.channel,a=n.signals.visual,o=n.signals.data,s=qa.has(t),l=B(e.scaleName(r)),u=e.getScaleComponent(r),c=u?u.get("type"):void 0,f=g=>`scale(${l}, ${g})`,d=e.getSizeSignalRef(r===Ge?"width":"height").signal,h=`${r}(unit)`,p=cj(t,(g,m)=>[...g,{events:m.between[0],update:`[${h}, ${h}]`},{events:m,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]);return p.push({events:{signal:t.name+S2},update:ri(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},i?{init:Fl(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:Fl(i)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}function cj(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(j(`${i} is not an ordered event stream for interval selections.`),n),[])}function fj(e,t){const n=t.name,i=n+pf,r=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(u=>{const c=e.fieldDef(u.channel);return c&&c.bin?`[${a}[${B(e.vgField(u.channel,{}))}], ${a}[${B(e.vgField(u.channel,{binSuffix:"end"}))}]]`:`${a}[${B(u.field)}]`}).join(", "),s=`unit: ${Gr(e)}, fields: ${i}, values`,l=t.events;return[{name:n+dr,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const tle={signals:fj,modifyExpr:(e,t)=>{const n=t.name+dr;return n+", "+(t.resolve==="global"?"null":`{unit: ${Gr(e)}}`)}},nle={signals:fj,modifyExpr:(e,t)=>{const n=t.name+dr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Gr(e)}}`)}},ls="_store",dr="_tuple",ile="_modify",dj="vlSelectionResolve",rle={single:nle,multi:tle,interval:Zse};function us(e,t){const n=e.component.selection;if(n)for(const i of Aa(n)){const r=t(i,rle[i.type]);if(r===!0)break}}function ale(e){let t=e.parent;for(;t&&!$i(t);)t=t.parent;return t}function Gr(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=ale(e);if(i){const{facet:r}=i;for(const a of ni)r[a]&&(n+=` + '__facet_${a}_' + (facet[${B(i.vgField(a))}])`)}return n}function O2(e){let t=!1;return us(e,n=>{t=t||n.project.items.some(i=>i.field===Rl)}),t}function T2(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...T2(e.object)),t.push(...T2(e.property))),t)}function hj(e){return e.object.type==="MemberExpression"?hj(e.object):e.object.name==="datum"}function pj(e){const t=NR(e),n=new Set();return t.visit(i=>{i.type==="MemberExpression"&&hj(i)&&n.add(T2(i).slice(1).join("."))}),n}class mf extends $e{constructor(e,t,n){super(e);this.model=t,this.filter=n,this.expr=am(this.model,this.filter,this),this._dependentFields=pj(this.expr)}clone(){return new mf(null,this.model,pe(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set()}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function ole(e,t){var n;const i={},r=e.config.selection;for(const a of z(t??{})){const o=pe(t[a]),s=r[o.type],l=Z(s,["fields","encodings"]);for(const f in l){if(f==="encodings"&&o.fields||f==="fields"&&o.encodings)continue;f==="mark"&&(o[f]=Object.assign(Object.assign({},l[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=l[f])!==null&&n!==void 0?n:o[f])}const u=Ue(a),c=i[u]=Object.assign(Object.assign({},o),{name:u,events:Y(o.on)?Uo(o.on,"scope"):pe(o.on)});rm(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[a])})}return i}function gj(e,t,n,i="datum"){const r=[];function a(s){const l=Ue(s),u=e.getSelectionComponent(l,s),c=B(l+ls);if(u.project.timeUnit){const f=n??e.component.data.raw,d=u.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return u.empty!=="none"&&r.push(c),`vlSelectionTest(${c}, ${i}`+(u.resolve==="global"?")":`, ${B(u.resolve)})`)}const o=Jc(t,a);return(r.length?"!("+r.map(s=>`length(data(${s}))`).join(" || ")+") || ":"")+`(${o})`}function mj(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&j(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${B(i)}.`);else if(n&&!i){const r=e.project.items.filter(a=>a.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,j((r.length?"Multiple ":"No ")+`matching ${B(n)} encoding found for selection ${B(t.selection)}. Using "field": ${B(i)}.`)):i=r[0].field}return`${e.name}[${B(i)}]`}function sle(e,t){us(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new on(new mf(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)})}function am(e,t,n){return Jc(t,i=>Y(i)?i:lae(i)?gj(e,i.selection,n):wI(i))}function lle(e,t){return e?I(e)&&!Pa(e)?e.map(n=>XI(n,t)).join(", "):e:void 0}function C2(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function vf(e,t,n,i={header:!1}){var r,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=Z(o,["disable","orient","scale","labelExpr","title","zindex"]);if(s)return;for(const p in h){const g=oie[p],m=h[p];if(g&&g!==t&&g!=="both")delete h[p];else if(vx(m)){const{condition:v}=m,y=Z(m,["condition"]),b=G(v),E=_N[p];if(E){const{vgProp:x,part:k}=E,w=[...b.map(A=>{const{test:_}=A,O=Z(A,["test"]);return Object.assign({test:am(null,_)},O)}),y];C2(h,k,x,w),delete h[p]}else if(E===null){const x={signal:b.map(k=>{const{test:w}=k,A=Z(k,["test"]);return`${am(null,w)} ? ${ZI(A)} : `}).join("")+ZI(y)};h[p]=x}}else if(oe(m)){const v=_N[p];if(v){const{vgProp:y,part:b}=v;C2(h,b,y,m),delete h[p]}}}if(t==="grid"){if(!h.grid)return;if(h.encode){const{grid:p}=h.encode;h.encode=Object.assign({},p?{grid:p}:{}),Fe(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:it(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let g=c;((a=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||a===void 0?void 0:a.update)&&oe(h.encode.labels.update.text)&&(g=Al(c,"datum.label",h.encode.labels.update.text.signal)),C2(h,"labels","text",{signal:g})}if(h.labelAlign===null&&delete h.labelAlign,h.encode){for(const g of AN)e.hasAxisPart(g)||delete h.encode[g];Fe(h.encode)&&delete h.encode}const p=lle(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},p?{title:p}:{}),h),n.aria===!1?{aria:!1}:{}),{zindex:it(d,0)})}}function vj(e){const{axes:t}=e.component,n=[];for(const i of ii)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const a=i==="x"?"height":"width",o=e.getSizeSignalRef(a).signal;a!==o&&n.push({name:a,update:o})}}return n}function ule(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>vf(r,"grid",t)),...i.map(r=>vf(r,"grid",t)),...n.map(r=>vf(r,"main",t)),...i.map(r=>vf(r,"main",t))].filter(r=>r)}const yj={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},bj={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},cle=z(yj),fle=z(bj);function wj(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const a=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},s=t[n==="x"?"axisTop":"axisRight"]||{},l=new Set([...z(o),...z(s)]),u={};for(const c of l.values())u[c]={signal:`${i.signal} === "${a}" ? ${lf(o[c])} : ${lf(s[c])}`};return u}return t[r]})])}function dle(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:wae(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],a=e==="x"?"axisX":"axisY",o=oe(n)?"axisOrient":"axis"+mg(n),s=[...r,...r.map(u=>a+u.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:wj(s,i,e,n),vgAxisConfig:wj(l,i,e,n),axisConfigStyle:hle([...l,...s],i)}}function hle(e,t){var n;const i=[{}];for(const r of e){let a=(n=t[r])===null||n===void 0?void 0:n.style;if(a){a=G(a);for(const o of a)i.push(t.style[o])}}return Object.assign.apply(null,i)}function $2(e,t,n,i={}){var r;const a=tM(e,n,t.style);if(a!==void 0)return{configFrom:"style",configValue:a};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const xj={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return RI(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return FI(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return q(e)&&rn(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:ple(n,e)},gridScale:({model:e,channel:t})=>gle(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||kj(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||Ej(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:vle(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:yle(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var a;const o=e==="x"?"width":e==="y"?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return(a=n.tickCount)!==null&&a!==void 0?a:wle({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=_j(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),a=n==="x"?"x2":"y2",o=t.fieldDef(a);return iM(r?[zI(r)]:[],q(o)?[zI(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>xle(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Ele(n,t)}};function ple(e,t){return!Sn(e)&&q(t)&&!Ie(t==null?void 0:t.bin)}function gle(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function mle(e,t,n,i,r){const a=t==null?void 0:t.labelAngle;if(a!==void 0)return oe(a)?a:vg(a);{const{configValue:o}=$2("labelAngle",e.config,t==null?void 0:t.style,r);return o!==void 0?vg(o):n===Ge&&ae([Px,Lx],i.type)?270:void 0}}function D2(e){return`(((${e.signal} % 360) + 360) % 360)`}function Ej(e,t,n,i){if(e!==void 0)if(n==="x"){if(oe(e)){const r=D2(e),a=oe(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${a} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(oe(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(oe(e)){const r=D2(e),a=oe(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${a} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(oe(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function kj(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,a=i?"bottom":"left";if(oe(e)){const o=D2(e),s=oe(t)?`(${t.signal} === "${a}")`:t===a;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${s} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(oe(t)){const o=r<e&&e<180+r?"===":"!==",s=`${t.signal} ${o} "${a}"`;return{signal:`${s} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===a)?"left":"right"}function vle(e,t){return t==="x"&&ae(["quantitative","temporal"],e)?!0:void 0}function yle(e,t){return e!=="nominal"?t==="log"?"greedy":!0:void 0}function ble(e){return e==="x"?"bottom":"left"}function wle({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!Sn(t)&&t!=="log"){if(q(e)){if(Ie(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&ae(["month","hours","day","quarter"],(r=an(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function _j(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),a=i?i.title:void 0,o=r?r.title:void 0;return a&&o?rM(a,o):a||(o||(a!==void 0?a:o!==void 0?o:void 0))}function xle(e,t){const n=e.values;return I(n)?KI(t,n):oe(n)?n:void 0}function Ele(e,t){return e==="rect"&&WI(t)?1:0}class yf extends $e{constructor(e,t){super(e);this.transform=t,this._dependentFields=pj(this.transform.calculate)}clone(){return new yf(null,pe(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((n,i)=>{if(!Jx(n))return;if(PI(n.sort)){const{field:r,timeUnit:a}=n,o=n.sort,s=o.map((l,u)=>`${wI({field:r,timeUnit:a,equal:l})} ? ${u} : `).join("")+o.length;e=new yf(e,{calculate:s,as:Nl(n,i,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${we(this.transform)}`}}function Nl(e,t,n){return U(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function om(e,t){return ae(["top","bottom"],t)?"column":ae(["left","right"],t)||e==="row"?"row":"column"}function Il(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return it(((t==null?void 0:t.header)||{})[e],r[e],n.header[e])}function sm(e,t,n,i){const r={};for(const a of e){const o=Il(a,t,n,i);o!==void 0&&(r[a]=o)}return r}const R2=["row","column"],F2=["header","footer"];function kle(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=sm(["titleAnchor","titleAngle","titleOrient"],r,i,t),l=om(t,s),u=vg(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Sj(u,l)),Aj(l,u,a)),Oj(i,r,t,cle,yj))}}function Aj(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=kj(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function Sj(e,t){const n=Ej(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function _le(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of F2)if(n[r])for(const a of n[r]){const o=Sle(e,t,r,n,a);o!=null&&i.push(o)}return i}function Ale(e,t){var n;const{sort:i}=e;return lr(i)?{field:U(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:I(i)?{field:Nl(e,t,{expr:"datum"}),order:"ascending"}:{field:U(e,{expr:"datum"}),order:i??"ascending"}}function N2(e,t,n){const{format:i,formatType:r,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=sm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),u=qx({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=om(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?Al(Al(l,"datum.label",u),"datum.value",U(e,{expr:"parent"})):u}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Sj(a,c)),Aj(c,a,o)),Oj(n,e,t,fle,bj))}function Sle(e,t,n,i,r){if(r){let a=null;const{facetFieldDef:o}=i,s=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=sm(["labelOrient"],o,s,t);(t==="row"&&!ae(["top","bottom"],f)||t==="column"&&!ae(["left","right"],f))&&(a=N2(o,t,s))}const l=$i(e)&&!af(e.facet),u=r.axes,c=(u==null?void 0:u.length)>0;if(a||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Ale(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const Ole={column:{start:0,end:1},row:{start:1,end:0}};function Tle(e,t){return Ole[t][e]}function Cle(e,t){const n={};for(const i of ni){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:a,titleOrient:o}=sm(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),s=om(i,o),l=Tle(a,s);l!==void 0&&(n[s]=l)}}return Fe(n)?void 0:n}function Oj(e,t,n,i,r){const a={};for(const o of i){if(!r[o])continue;const s=Il(o,t,e,n);s!==void 0&&(a[r[o]]=s)}return a}function I2(e){return[...lm(e,"width"),...lm(e,"height"),...lm(e,"childWidth"),...lm(e,"childHeight")]}function lm(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const a=e.getScaleComponent(n);if(a){const o=a.get("type"),s=a.get("range");if(Sn(o)&&Ia(s)){const l=e.scaleName(n);if($i(e.parent)){const u=e.parent.component.resolve;if(u.scale[n]==="independent")return[Tj(l,s)]}return[Tj(l,s),{name:r,update:Cj(l,a,`domain('${l}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const a=r.endsWith("width"),o=a?"containerSize()[0]":"containerSize()[1]",s=h2(e.config.view,a?"width":"height"),l=`isFinite(${o}) ? ${o} : ${s}`;return[{name:r,init:l,on:[{update:l,events:"window:resize"}]}]}else return[{name:r,value:i}]}function Tj(e,t){return{name:e+"_step",value:t.step}}function Cj(e,t,n){const i=t.get("type"),r=t.get("padding"),a=it(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${o}, ${a}) * ${e}_step`}function $j(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Dj(e,t){return z(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),ff(t,r,i,a=>oe(a)?a:{value:a.value}))},{})}function $le(e,t){if(Pl(t)||$i(t))return"shared";if(V2(t))return or(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function M2(e,t){const n=e.scale[t],i=or(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&j(Ore(t)),"independent"):e[i][t]||"shared"}const Dle=Object.assign(Object.assign({},woe),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Rj=z(Dle);class Rle extends za{}const Fj={symbols:Fle,gradient:Nle,labels:Ile,entries:Mle};function Fle(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:a}){var o,s,l,u,c;if(a!=="symbol")return;const{markDef:f,encoding:d,config:h,mark:p}=n,g=f.filled&&p!=="trail";let m=Object.assign(Object.assign({},Zae({},n,hie)),YM(n,{filled:g}));const v=(o=Nj(d.opacity))!==null&&o!==void 0?o:f.opacity;if(m.fill){if(i==="fill"||g&&i===_n)delete m.fill;else if(m.fill.field)r.get("symbolFillColor")?delete m.fill:(m.fill=tt((s=h.legend.symbolBaseFillColor)!==null&&s!==void 0?s:"black"),m.fillOpacity=tt(v??1));else if(I(m.fill)){const y=(c=(u=j2((l=d.fill)!==null&&l!==void 0?l:d.color))!==null&&u!==void 0?u:f.fill)!==null&&c!==void 0?c:g&&f.color;y&&(m.fill=tt(y))}}if(m.stroke){if(i==="stroke"||!g&&i===_n)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(I(m.stroke)){const y=it(j2(d.stroke||d.color),f.stroke,g?f.color:void 0);y&&(m.stroke={value:y})}}if(i!==Br){const y=q(t)&&Mj(n,r,t);y?m.opacity=[Object.assign({test:y},tt(v??1)),tt(h.legend.unselectedOpacity)]:v&&(m.opacity=tt(v))}return m=Object.assign(Object.assign({},m),e),Fe(m)?void 0:m}function Nle(e,{model:t,legendType:n}){if(n!=="gradient")return;let i={};const r=Nj(t.encoding.opacity)||t.markDef.opacity;return r&&(i.opacity=tt(r)),i=Object.assign(Object.assign({},i),e),Fe(i)?void 0:i}function Ile(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const a=n.legend(i)||{},o=n.config,s=q(t)?Mj(n,r,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=ts(c)?Wx({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return Fe(d)?void 0:d}function Mle(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Nj(e){return Ij(e,(t,n)=>Math.max(t,n.value))}function j2(e){return Ij(e,(t,n)=>it(t,n.value))}function Ij(e,t){return qae(e)?G(e.condition).reduce(t,e.value):Ur(e)?e.value:void 0}function Mj(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=B(n.field);return i.map(a=>{const o=B(Ue(a)+ls);return`(!length(data(${o})) || (${a}[${r}] && indexof(${a}[${r}], datum.value) >= 0))`}).join(" || ")}const jj={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return RI(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return FI(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:qle(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:Wle(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:Lle(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>ns(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Sl(n)&&Ti(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>jle(t,e)};function jle(e,t){const n=e.values;return I(n)?KI(t,n):oe(n)?n:void 0}function Lle(e,t,n,i){var r;if(t!=="shape"){const a=(r=j2(n))!==null&&r!==void 0?r:i;if(a)return a}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Ple(e){const{legend:t}=e;return it(t.type,zle(e))}function zle({channel:e,timeUnit:t,scaleType:n}){if(Sl(e)){if(ae(["quarter","month","day"],t))return"symbol";if(Ti(n))return"gradient"}return"symbol"}function Ble({legendConfig:e,legendType:t,orient:n,legend:i}){var r,a;return(a=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&a!==void 0?a:Ule(n,t)}function Ule(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function qle({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;return Ti(r)?n==="horizontal"?i==="top"||i==="bottom"?Lj(t,"width",o,a):o:Lj(t,"height",l,s):void 0}function Lj(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function Wle(e){return ae(["quantile","threshold","log"],e)?"greedy":void 0}function Pj(e){const t=Xe(e)?Gle(e):Xle(e);return e.component.legends=t,t}function Gle(e){const{encoding:t}=e,n={};for(const i of[_n,...wM]){const r=ct(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===An&&q(r)&&r.type===Dl)continue;n[i]=Vle(e,i)}return n}function Hle(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Yle(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Vle(e,t){var n,i,r;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new Rle({},Hle(e,t));qse(e,t,c);const f=a!==void 0?!a:u.disable;if(c.set("disable",f,a!==void 0),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=ct(s[t]),p=q(h)?(n=an(h.timeUnit))===null||n===void 0?void 0:n.unit:void 0,g=a.orient||l.legend.orient||"right",m=Ple({legend:a,channel:t,timeUnit:p,scaleType:d}),v=Ble({legend:a,legendType:m,orient:g,legendConfig:u}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:g,legendType:m,direction:v};for(const w of Rj){const A=w in jj?jj[w](y):a[w];if(A!==void 0){const _=Yle(A,w,a,e.fieldDef(t));(_||l.legend[w]===void 0)&&c.set(w,A,_)}}const b=(i=a==null?void 0:a.encoding)!==null&&i!==void 0?i:{},E=c.get("selections"),x={},k={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:m};for(const w of["labels","legend","title","symbols","gradient","entries"]){const A=Dj((r=b[w])!==null&&r!==void 0?r:{},e),_=w in Fj?Fj[w](A,k):A;_!==void 0&&!Fe(_)&&(x[w]=Object.assign(Object.assign(Object.assign({},(E==null?void 0:E.length)&&q(h)?{name:`${Ue(h.field)}_legend_${w}`}:{}),(E==null?void 0:E.length)?{interactive:!!E}:{}),{update:_}))}return Fe(x)||c.set("encode",x,!!(a==null?void 0:a.encoding)),c}function Xle(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Pj(i);for(const r of z(i.component.legends))n.legend[r]=M2(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=zj(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of z(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function zj(e,t){var n,i,r,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const u of Rj){const c=Ba(e.getWithExplicit(u),t.getWithExplicit(u),u,"legend",(f,d)=>{switch(u){case"symbolType":return Jle(f,d);case"title":return aM(f,d);case"type":return l=!0,Bn("symbol")}return Kg(f,d,u,"legend")});e.setWithExplicit(u,c)}return l&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&gx(e.implicit,["encode","gradient"]),((a=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||a===void 0?void 0:a.gradient)&&gx(e.explicit,["encode","gradient"])),e}function Jle(e,t){return t.value==="circle"?t:e}function Bj(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function Uj(e){const t=e.component.legends,n={};for(const r of z(t)){const a=e.getScaleComponent(r),o=Be(a.get("domains"));if(n[o])for(const s of n[o]){const l=zj(s,t[r]);l||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=Aa(n).flat().map(r=>Kle(r,e.config)).filter(r=>r!==void 0);return i}function Kle(e,t){var n,i,r;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=Z(a,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&u.aria==null&&(u.aria=!1),(n=u.encode)===null||n===void 0?void 0:n.symbols){const c=u.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!u.stroke&&(c.stroke={value:"transparent"});for(const f of wM)u[f]&&delete c[f]}if(u.title||delete u.title,s!==void 0){let c=s;((r=(i=u.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&oe(u.encode.labels.update.text)&&(c=Al(s,"datum.label",u.encode.labels.update.text.signal)),Bj(u,"labels","text",{signal:c})}for(const c in u){const f=u[c];if(oe(f)){const d=yoe[c];if(d){const{vgProp:h,part:p}=d;Bj(u,p,h,f),delete u[c]}}}return u}function Qle(e){return Pl(e)||V2(e)?Zle(e):qj(e)}function Zle(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),qj(e))}function qj(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},a=t.data.reduce((o,s)=>{const l=oe(s)?s.signal:`data('${e.lookupDataSource(s)}')`;return ae(o,l)||o.push(l),o},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const eue=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Wj extends za{constructor(e,t,n,i){super(Object.assign({},t),{name:e});this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function Gj(e){e.component.projection=Xe(e)?tue(e):rue(e)}function tue(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=i?nue(e):void 0;return new Wj(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),r,a)}return}function nue(e){const t=[],{encoding:n}=e;for(const i of[[tr,er],[ti,Oi]])(ct(n[i[0]])||ct(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(An)&&e.typedFieldDef(An).type===Dl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(Ut)),t}function iue(e,t){const n=vN(eue,r=>!Q(e.explicit,r)&&!Q(t.explicit,r)?!0:!!(Q(e.explicit,r)&&Q(t.explicit,r)&&Be(e.get(r))===Be(t.get(r)))),i=Be(e.size)===Be(t.size);if(i){if(n)return e;if(Be(e.explicit)===Be({}))return t;if(Be(t.explicit)===Be({}))return e}return null}function rue(e){if(e.children.length===0)return;let t;for(const i of e.children)Gj(i);const n=vN(e.children,i=>{const r=i.component.projection;if(r)if(t){const a=iue(t,r);return a&&(t=a),!!a}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Wj(i,t.specifiedProjection,t.size,pe(t.data));for(const a of e.children){const o=a.component.projection;o&&(o.isFit&&r.data.push(...a.component.projection.data),a.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}function aue(e,t,n,i){var r,a;if(sf(t,n)){const o=Xe(e)?(a=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&a!==void 0?a:{}:{},s=U(t,{expr:"datum"}),l=U(t,{expr:"datum",binSuffix:"end"});return{formulaAs:U(t,{binSuffix:"range",forAs:!0}),formula:jg(s,l,o.format,o.formatType,i)}}return{}}function Hj(e,t){return`${HN(e)}_${t}`}function oue(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function L2(e,t,n){var i;const r=(i=qg(n,void 0))!==null&&i!==void 0?i:{},a=Hj(r,t);return e.getName(`${a}_bins`)}function sue(e){return"as"in e}function Yj(e,t,n){let i,r;sue(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[U(e,{forAs:!0}),U(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},qg(t,void 0)),o=Hj(a,e.field),{signal:s,extentSignal:l}=oue(n,o);if(Rg(a.extent)){const c=a.extent,f=c.selection;r=mj(n.getSelectionComponent(Ue(f),f),c),delete a.extent}const u=Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[i]},s?{signal:s}:{}),l?{extentSignal:l}:{}),r?{span:r}:{});return{key:o,binComponent:u}}class Hr extends $e{constructor(e,t){super(e);this.bins=t}clone(){return new Hr(null,pe(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{if(zn(r)&&Ie(r.bin)){const{key:o,binComponent:s}=Yj(r,r.bin,t);i[o]=Object.assign(Object.assign(Object.assign({},s),i[o]),aue(t,r,a,t.config))}return i},{});return Fe(n)?null:new Hr(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=Yj(t,t.bin,n);return new Hr(e,{[i]:r})}merge(e,t){for(const n of z(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=_a([...this.bins[n].as,...e.bins[n].as],we)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(Aa(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(Aa(this.bins).map(e=>e.field))}hash(){return`Bin ${we(this.bins)}`}assemble(){return Aa(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:a}=r,o=Z(r,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:Sa(e.field),as:n,signal:e.signal},Rg(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:Sa(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const l of i)for(let u=0;u<2;u++)t.push({type:"formula",expr:U({field:n[u]},{expr:"datum"}),as:l[u]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class Ml extends $e{constructor(e){super(null);e=e??{name:"source"};let t;if(ss(e)||(t=e.format?Object.assign({},Nr(e.format,["parse"])):{}),Qg(e))this._data={values:e.values};else if(cf(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];ae(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else UM(e)?this._data={values:[{type:"Sphere"}]}:(zM(e)||ss(e))&&(this._data={});this._generator=ss(e),e.name&&(this._name=e.name),t&&!Fe(t)&&(this._data.format=t)}dependentFields(){return new Set()}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function P2(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!P2(t.children))return!1}return!0}class um extends $e{constructor(e,t){super(e);this.params=t}clone(){return new um(null,this.params)}dependentFields(){return new Set()}producedFields(){return}hash(){return`Graticule ${we(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class cm extends $e{constructor(e,t){super(e);this.params=t}clone(){return new cm(null,this.params)}dependentFields(){return new Set()}producedFields(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])}hash(){return`Hash ${we(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function fm(e){return e instanceof Ml||e instanceof um||e instanceof cm}class Vj{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Yr extends Vj{constructor(){super();this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(fm(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class z2 extends Vj{}function lue(e,t,n,i){const r=Xe(i)?i.encoding[rr(t)]:void 0;if(zn(n)&&Xe(i)&&Hx(t,n,r,i.stack,i.markDef,i.config))e.add(U(n,{})),e.add(U(n,{suffix:"end"})),n.bin&&sf(n,t)&&e.add(U(n,{binSuffix:"range"}));else if(Die(t)){const a=$ie(t);e.add(i.getName(a))}else e.add(U(n));return e}function uue(e,t){var n;for(const i of z(t)){const r=t[i];for(const a of z(r))i in e?e[i][a]=new Set([...(n=e[i][a])!==null&&n!==void 0?n:[],...r[a]]):e[i]={[a]:r[a]}}}class hr extends $e{constructor(e,t,n){super(e);this.dimensions=t,this.measures=n}clone(){return new hr(null,new Set(this.dimensions),pe(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(a=>{a.aggregate&&(n=!0)});const i={},r=new Set();return n?(t.forEachFieldDef((a,o)=>{var s,l,u,c;const{aggregate:f,field:d}=a;if(f)if(f==="count")i["*"]=(s=i["*"])!==null&&s!==void 0?s:{},i["*"].count=new Set([U(a,{forAs:!0})]);else{if(Oa(f)||Xo(f)){const h=Oa(f)?"argmin":"argmax",p=f[h];i[p]=(l=i[p])!==null&&l!==void 0?l:{},i[p][h]=new Set([U({op:h,field:p},{forAs:!0})])}else i[d]=(u=i[d])!==null&&u!==void 0?u:{},i[d][f]=new Set([U(a,{forAs:!0})]);Na(o)&&t.scaleDomain(o)==="unaggregated"&&(i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d].min=new Set([U({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([U({field:d,aggregate:"max"},{forAs:!0})]))}else lue(r,o,a,t)}),r.size+z(i).length===0?null:new hr(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const a=new Set(),o={};for(const s of t.aggregate){const{op:l,field:u,as:c}=s;l&&(l==="count"?(o["*"]=(n=o["*"])!==null&&n!==void 0?n:{},o["*"].count=new Set([c||U(s,{forAs:!0})])):(o[u]=(i=o[u])!==null&&i!==void 0?i:{},o[u][l]=new Set([c||U(s,{forAs:!0})])))}for(const s of(r=t.groupby)!==null&&r!==void 0?r:[])a.add(s);return a.size+z(o).length===0?null:new hr(e,a,o)}merge(e){return Zne(this.dimensions,e.dimensions)?(uue(this.measures,e.measures),!0):(qre("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...z(this.measures)])}producedFields(){const e=new Set();for(const t of z(this.measures))for(const n of z(this.measures[t])){const i=this.measures[t][n];i.size===0?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${we({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of z(this.measures))for(const a of z(this.measures[r]))for(const o of this.measures[r][a])n.push(o),e.push(a),t.push(r==="*"?null:Sa(r));const i={type:"aggregate",groupby:[...this.dimensions].map(Sa),ops:e,fields:t,as:n};return i}}class jl extends $e{constructor(e,t,n,i){super(e);this.model=t,this.name=n,this.data=i;for(const r of ni){const a=t.facet[r];if(a){const{bin:o,sort:s}=a;this[r]=Object.assign({name:t.getName(`${r}_domain`),fields:[U(a),...Ie(o)?[U(a,{binSuffix:"end"})]:[]]},lr(s)?{sortField:s}:I(s)?{sortIndexField:Nl(a,r)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of ni)this[t]&&(e+=` ${t.charAt(0)}:${we(this[t])}`);return e}get fields(){var e;const t=[];for(const n of ni)((e=this[n])===null||e===void 0?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of ni)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set()}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of ii){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(Sn(i)&&Ia(r)){const a=hm(this.childModel,t),o=H2(a);o?e[t]=o:j(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],a=[],o=[];n&&n[i]&&(t?(r.push(`distinct_${n[i]}`),a.push("max")):(r.push(n[i]),a.push("distinct")),o.push(`distinct_${n[i]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:u=Lg,field:c}=s;r.push(c),a.push(u),o.push(U(s,{forAs:!0}))}else l&&(r.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:t??this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,a=[],o={};for(const u of R2){for(const c of F2){const f=(t=r[u]&&r[u][c])!==null&&t!==void 0?t:[];for(const d of f)if(((n=d.axes)===null||n===void 0?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const c=`length(data("${this.facet.name}"))`,f=u==="row"?i?{signal:`ceil(${c} / ${i})`}:1:i?{signal:`min(${c}, ${i})`}:{signal:c};a.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((e=r.x)!==null&&e!==void 0?e:[],(t=r.y)!==null&&t!==void 0?t:[]),u=l.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[jr,Mr])this[l]&&n.push(this.assembleRowColumnHeaderData(l,i,r));if(s){const l=this.assembleFacetHeaderData(r);l&&n.push(...l)}return n}}function Xj(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function cue(e,t){const n=EN(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=Xj(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=Xj(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return j(tre(t)),null}function fue(e){const t={};return hg(e.filter,n=>{var i;if(bI(n)){let r=null;Nx(n)?r=n.equal:Ix(n)?r=n.range[0]:Mx(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Tl(r)?t[n.field]="date":De(r)?t[n.field]="number":Y(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function due(e){const t={};function n(i){Wg(i)?t[i.field]="date":i.type==="quantitative"&&Aie(i.aggregate)?t[i.field]="number":Kc(i.field)>1?i.field in t||(t[i.field]="flatten"):Jx(i)&&lr(i.sort)&&Kc(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Xe(e)||$i(e))&&e.forEachFieldDef((i,r)=>{if(zn(i))n(i);else{const a=Qo(r),o=e.fieldDef(a);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Xe(e)){const{mark:i,markDef:r,encoding:a}=e;if(Vo(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",s=a[o];q(s)&&s.type==="quantitative"&&!(s.field in t)&&(t[s.field]="number")}}return t}function hue(e){const t={};if(Xe(e)&&e.component.selection)for(const n of z(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&Kc(r.field)>1&&(t[r.field]="flatten")}return t}class sn extends $e{constructor(e,t){super(e);this._parse=t}clone(){return new sn(null,pe(this._parse))}hash(){return`Parse ${we(this._parse)}`}static makeExplicit(e,t,n){let i={};const r=t.data;return!ss(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const o of z(n)){const s=i.getWithExplicit(o);s.value!==void 0&&(s.explicit||s.value===n[o]||s.value==="derived"||n[o]==="flatten"?delete n[o]:j(eI(o,n[o],s.value)))}for(const o of z(t)){const s=i.get(o);s!==void 0&&(s===t[o]?delete t[o]:j(eI(o,t[o],s)))}const r=new za(t,n);i.copyAll(r);const a={};for(const o of z(r.combine())){const s=r.get(o);s!==null&&(a[o]=s)}return z(a).length===0||i.parseNothing?null:new sn(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of z(this._parse)){const n=this._parse[t];Kc(t)===1&&(e[t]=n)}return e}producedFields(){return new Set(z(this._parse))}dependentFields(){return new Set(z(this._parse))}assembleTransforms(e=!1){return z(this._parse).filter(t=>e?Kc(t)>1:!0).map(t=>{const n=cue(t,this._parse[t]);if(!n)return null;const i={type:"formula",expr:n,as:kN(t)};return i}).filter(t=>t!==null)}}class cs extends $e{clone(){return new cs(null)}constructor(e){super(e)}dependentFields(){return new Set()}producedFields(){return new Set([Rl])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Rl}}}class Ll extends $e{constructor(e,t){super(e);this.transform=t}clone(){return new Ll(null,pe(this.transform))}addDimensions(e){this.transform.groupby=_a(this.transform.groupby.concat(e),t=>t)}dependentFields(){const e=new Set();return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(t=>t.field).filter(t=>t!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`JoinAggregateTransform ${we(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(r.field===void 0?null:r.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},i!==void 0?{groupby:i}:{})}}function pue(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=U(i);return r&&t.push(r),t},[])}function gue(e){return I(e)&&e.every(t=>Y(t))&&e.length>1}class Wa extends $e{constructor(e,t){super(e);this._stack=t}clone(){return new Wa(null,pe(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:a="zero"}=t,o=[],s=[];if(t.sort!==void 0)for(const c of t.sort)o.push(c.field),s.push(it(c.order,"ascending"));const l={field:o,order:s};let u;return gue(r)?u=r:Y(r)?u=[r,r+"_end"]:u=[t.stack+"_start",t.stack+"_end"],new Wa(e,{stackField:n,groupby:i,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:a,offset:o,impute:s}=n;let l;if(r){const d=i[r];l=cr(d)}const u=pue(t),c=t.encoding.order;let f;return I(c)||q(c)?f=nM(c):f=u.reduce((d,h)=>(d.field.push(h),d.order.push(a==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Wa(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set();return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${we(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[U(e,{binSuffix:"mid"})]:[U(e,{}),U(e,{binSuffix:"end"})]:[U(e)]:n??[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:u=.5,bin:c}=n;c&&e.push({type:"formula",expr:`${u}*`+U(n,{expr:"datum"})+`+${1-u}*`+U(n,{expr:"datum",binSuffix:"end"}),as:U(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:U(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:a,as:l,offset:o}),e}}class bf extends $e{constructor(e,t){super(e);this.transform=t}clone(){return new bf(null,pe(this.transform))}addDimensions(e){this.transform.groupby=_a(this.transform.groupby.concat(e),t=>t)}dependentFields(){var e,t;const n=new Set();return((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(n.add,n),((t=this.transform.sort)!==null&&t!==void 0?t:[]).forEach(i=>n.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`WindowTransform ${we(this.transform)}`}assemble(){var e;const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&a[0]===null&&a[1]===null&&n.every(f=>xx(f)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},o!==void 0?{groupby:o}:{});const s=[],l=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)s.push(f.field),l.push((e=f.order)!==null&&e!==void 0?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:u},c!==void 0?{ignorePeers:c}:{}),o!==void 0?{groupby:o}:{}),a!==void 0?{frame:a}:{})}}class mue extends Yr{run(e){const t=e.parent;if(e instanceof sn){if(fm(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof sn)this.setMutated(),t.merge(e);else{if(wN(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class vue extends z2{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(i=>i.hash()),n={};for(let i=0;i<t.length;i++)n[t[i]]===void 0?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const i of z(n))n[i].length>1&&(this.setMutated(),this.mergeNodes(e,n[i]));for(const i of e.children)this.run(i);return this.mutatedFlag}}class yue extends Yr{run(e){return e instanceof on||e.numChildren()>0||e instanceof jl?this.flags:(this.setMutated(),e.remove(),this.flags)}}class bue extends Yr{constructor(){super(...arguments);this.fields=new Set(),this.prev=null}run(e){if(this.setContinue(),e instanceof Wr){const t=e.producedFields();yN(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class wue extends Yr{run(e){this.setContinue();const t=e.parent,n=t.children.filter(r=>r instanceof Wr),i=n.pop();for(const r of n)this.setMutated(),i.merge(r);return this.flags}}function xue(e){function t(n){if(!(n instanceof jl)){const i=n.clone();if(i instanceof on){const r=U2+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof hr||i instanceof Wa||i instanceof bf||i instanceof Ll)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function B2(e){if(e instanceof jl)if(e.numChildren()===1&&!(e.children[0]instanceof on)){const t=e.children[0];(t instanceof hr||t instanceof Wa||t instanceof bf||t instanceof Ll)&&t.addDimensions(e.fields),t.swapWithParent(),B2(e)}else{const t=e.model.component.data.main;Jj(t);const n=xue(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(B2)}function Jj(e){if(e instanceof on&&e.type===Ut&&e.numChildren()===1){const t=e.children[0];t instanceof jl||(t.swapWithParent(),Jj(e))}}class Eue extends z2{constructor(){super()}run(e){e instanceof on&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class kue extends z2{constructor(e){super();this.requiresSelectionId=e&&O2(e)}run(e){e instanceof cs&&(this.requiresSelectionId&&(fm(e.parent)||e.parent instanceof hr||e.parent instanceof sn)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class _ue extends Yr{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(r=>r instanceof sn);if(t.numChildren()>1&&i.length>=1){const r={},a=new Set();for(const o of i){const s=o.parse;for(const l of z(s))l in r?r[l]!==s[l]&&a.add(l):r[l]=s[l]}for(const o of a)delete r[o];if(!Fe(r)){this.setMutated();const o=new sn(t,r);for(const s of n){if(s instanceof sn)for(const l of z(r))delete s.parse[l];t.removeChild(s),s.parent=o,s instanceof sn&&z(s.parse).length===0&&s.remove()}}}return this.setContinue(),this.flags}}class Aue extends Yr{run(e){const t=e.parent,n=t.children.filter(r=>r instanceof hr),i={};for(const r of n){const a=we(r.groupBy);a in i||(i[a]=[]),i[a].push(r)}for(const r of z(i)){const a=i[r];if(a.length>1){const o=a.pop();for(const s of a)o.merge(s)&&(t.removeChild(s),s.parent=o,s.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Sue extends Yr{constructor(e){super();this.model=e}run(e){const t=e.parent,n=!(fm(t)||t instanceof mf||t instanceof sn||t instanceof cs),i=[],r=[];for(const a of t.children)a instanceof Hr&&(n&&!wN(t.producedFields(),a.dependentFields())?i.push(a):r.push(a));if(i.length>0){const a=i.pop();for(const o of i)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof Hr?t.merge(a,this.model.renameSignal.bind(this.model)):a.swapWithParent()}if(r.length>1){const a=r.pop();for(const o of r)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class Oue extends Yr{run(e){const t=e.parent,n=[...t.children],i=Xc(n,o=>o instanceof on);if(!i||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let a;for(const o of n)if(o instanceof on){let s=o;for(;s.numChildren()===1;){const l=s.children[0];if(l instanceof on)s=l;else break}r.push(...s.children),a?(t.removeChild(o),o.parent=a.parent,a.parent.removeChild(a),a.parent=s,this.setMutated()):a=s}else r.push(o);if(r.length){this.setMutated();for(const o of r)o.parent.removeChild(o),o.parent=a}return this.setContinue(),this.flags}}const U2="scale_",dm=5;function Ga(e){const t=[];function n(i){if(i.numChildren()===0)t.push(i);else for(const r of i.children)n(r)}for(const i of e)n(i);return t}function Tue(e){return e}function Ci(e,t){const n=t.map(i=>{if(e instanceof Yr){const r=e.optimizeNextFromLeaves(i);return e.reset(),r}else return e.run(i)});return n.some(Tue)}function Kj(e,t){let n=e.sources;const i=new Set();return i.add(Ci(new Eue(),n)),i.add(Ci(new kue(t),n)),n=n.filter(r=>r.numChildren()>0),i.add(Ci(new yue(),Ga(n))),n=n.filter(r=>r.numChildren()>0),i.add(Ci(new mue(),Ga(n))),i.add(Ci(new Sue(t),Ga(n))),i.add(Ci(new bue(),Ga(n))),i.add(Ci(new _ue(),Ga(n))),i.add(Ci(new Aue(),Ga(n))),i.add(Ci(new wue(),Ga(n))),i.add(Ci(new vue(),n)),i.add(Ci(new Oue(),Ga(n))),e.sources=n,i.has(!0)}function Cue(e,t){P2(e.sources);let n=0,i=0;for(let r=0;r<dm&&Kj(e,t);r++)n++;e.sources.map(B2);for(let r=0;r<dm&&Kj(e,t);r++)i++;P2(e.sources),Math.max(n,i)===dm&&j(`Maximum optimization runs(${dm}) reached.`)}class oi{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new oi(()=>e(t))}}function Qj(e){Xe(e)?$ue(e):Due(e)}function $ue(e){const t=e.component.scales;for(const n of z(t)){const i=Fue(e,n),r=t[n];if(r.setWithExplicit("domains",i),Iue(e,n),e.component.data.isFaceted){let a=e;for(;!$i(a)&&a.parent;)a=a.parent;const o=a.component.resolve.scale[n];if(o==="shared")for(const s of i.value)Ma(s)&&(s.data=U2+s.data.replace(U2,""))}}}function Due(e){for(const n of e.children)Qj(n);const t=e.component.scales;for(const n of z(t)){let i,r=null;for(const a of e.children){const o=a.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Ba(i,o.getWithExplicit("domains"),"domains","scale",G2);const s=o.get("selectionExtent");r&&s&&r.selection!==s.selection&&j("The same selection must be used to override scale domains in a layered view."),r=s}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function Rue(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:a}=Zj(t,n);if(!r){j(a);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Zj(t,n);if(r)return"unaggregated"}return e}function Fue(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=Rue(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&ct(i.x2)?ct(i.x)?Ba(Ha(n,r,e,"x"),Ha(n,r,e,"x2"),"domain","scale",G2):Ha(n,r,e,"x2"):t==="y"&&ct(i.y2)?ct(i.y)?Ba(Ha(n,r,e,"y"),Ha(n,r,e,"y2"),"domain","scale",G2):Ha(n,r,e,"y2"):Ha(n,r,e,t)}function Nue(e,t,n){return e.map(i=>{const r=e2(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function q2(e,t,n){var i;const r=(i=an(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?Nue(e,t,r):[e]}function Ha(e,t,n,i){const{encoding:r}=n,a=ct(r[i]),{type:o}=a,s=a.timeUnit;if(Cae(t)){const f=Ha(e,void 0,n,i),d=q2(t.unionWith,o,s);return os([...f.value,...d])}else{if(oe(t))return os([t]);if(t&&t!=="unaggregated"&&!kI(t))return os(q2(t,o,s))}const l=n.stack;if(l&&i===l.fieldChannel){if(l.offset==="normalize")return Bn([[0,1]]);const f=n.requestDataName(Ut);return Bn([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const u=Na(i)&&q(a)?Mue(n,i,e):void 0;if(La(a)){const f=q2([a.datum],o,s);return Bn(f)}const c=a;if(t==="unaggregated"){const f=n.requestDataName(Ut),{field:d}=a;return Bn([{data:f,field:U({field:d,aggregate:"min"})},{data:f,field:U({field:d,aggregate:"max"})}])}else if(Ie(c.bin)){if(Sn(e))return e==="bin-ordinal"?Bn([]):Bn([{data:gg(u)?n.requestDataName(Ut):n.requestDataName(Zg),field:n.vgField(i,sf(c,i)?{binSuffix:"range"}:{}),sort:u===!0||!K(u)?{field:n.vgField(i,{}),op:"min"}:u}]);{const{bin:f}=c;if(Ie(f)){const d=L2(n,c.field,f);return Bn([new oi(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return Bn([{data:n.requestDataName(Ut),field:n.vgField(i,{})}])}}else if(c.timeUnit&&ae(["time","utc"],e)&&Hx(i,c,Xe(n)?n.encoding[rr(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(Ut);return Bn([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Bn(u?[{data:gg(u)?n.requestDataName(Ut):n.requestDataName(Zg),field:n.vgField(i),sort:u}]:[{data:n.requestDataName(Ut),field:n.vgField(i)}])}function W2(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Lg)},i?{field:Sa(i)}:{}),r?{order:r}:{})}function Iue(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,a=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=kI(r)&&r,s=tf(a)&&Rg(a.extent)&&a.extent;(o||s)&&i.set("selectionExtent",o??s,!0)}function Mue(e,t,n){if(!Sn(n))return;const i=e.fieldDef(t),r=i.sort;if(PI(r))return{op:"min",field:Nl(i,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(s=>s.fieldDef.field)]:void 0;if(lr(r)){const s=a&&!ae(o,r.field);return W2(r,s)}else if(LI(r)){const{encoding:s,order:l}=r,u=e.fieldDef(s),{aggregate:c,field:f}=u,d=a&&!ae(o,f);if(Oa(c)||Xo(c))return W2({field:U(u),order:l},d);if(xx(c)||!c)return W2({op:c,field:f,order:l},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(ae(["ascending",void 0],r))return!0}return}function Zj(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!Tie[n]?{valid:!1,reason:wre(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:xre(e)}:{valid:!0}:{valid:!1,reason:bre(e)}}function G2(e,t,n,i){return e.explicit&&t.explicit&&j(Sre(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function jue(e){const t=_a(e.map(o=>{if(Ma(o)){const s=Z(o,["sort"]);return s}return o}),we),n=_a(e.map(o=>{if(Ma(o)){const s=o.sort;return s!==void 0&&!gg(s)&&("op"in s&&s.op==="count"&&delete s.field,s.order==="ascending"&&delete s.order),s}return}).filter(o=>o!==void 0),we);if(t.length===0)return;if(t.length===1){const o=e[0];if(Ma(o)&&n.length>0){let s=n[0];if(n.length>1)j(oI),s=!0;else if(K(s)&&"field"in s){const l=s.field;o.field===l&&(s=s.order?{order:s.order}:!0)}return Object.assign(Object.assign({},o),{sort:s})}return o}const i=_a(n.map(o=>gg(o)||!("op"in o)||o.op in kie?o:(j(Tre(o)),!0)),we);let r;i.length===1?r=i[0]:i.length>1&&(j(oI),r=!0);const a=_a(e.map(o=>Ma(o)?o.data:null),o=>o);if(a.length===1&&a[0]!==null){const o=Object.assign({data:a[0],fields:t.map(s=>s.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function H2(e){if(Ma(e)&&Y(e.field))return e.field;if(iae(e)){let t;for(const n of e.fields)if(Ma(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return j(Cre),t}return j($re),t}else if(rae(e)){j(Dre);const t=e.fields[0];return Y(t)?t:void 0}return}function hm(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(Ma(r)&&(r.data=e.lookupDataSource(r.data)),r));return jue(i)}function e3(e){return Pl(e)||V2(e)?e.children.reduce((t,n)=>t.concat(e3(n)),t3(e)):t3(e)}function t3(e){return z(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=r,f=Z(r,["name","type","selectionExtent","domains","range","reverse"]),d=Lue(r.range,a,n);let h;s&&(h=Qse(e,s));const p=hm(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function Lue(e,t,n){return or(n)&&Ia(e)?{step:{signal:t+"_step"}}:e}class n3 extends za{constructor(e,t){super({},{name:e});this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Xc(this.get("domains"),e=>I(e)&&e.length===2&&e[0]<=0&&e[1]>=0)}}const Pue=["range","scheme"];function i3(e){return e==="x"?"width":e==="y"?"height":void 0}function zue(e){const t=e.component.scales;for(const n of $g){const i=t[n];if(!i)continue;const r=Bue(n,e);i.setWithExplicit("range",r)}}function r3(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Ie(n.bin)){const i=L2(e,n.field,n.bin),r=i3(t),a=e.getName(r);return new oi(()=>{const o=e.getSignalName(i),s=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(a)} / (${s})`})}return}function Bue(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),a=r.get("type");for(const o of Pue)if(n[o]!==void 0){const s=_I(a,o),l=AI(e,o);if(!s)j(rI(a,o,e));else if(l)j(l);else switch(o){case"range":return I(n.range)&&or(e)?os(n.range.map(u=>{if(u==="width"||u==="height"){const c=t.getName(u),f=t.getSignalName.bind(t);return oi.fromName(f,c)}return u})):os(n.range);case"scheme":return os(Uue(n[o]))}}if(e===Ge||e===ut){const o=e===Ge?"width":"height",s=i[o];if(fr(s)){if(Sn(a))return os({step:s.step});j(aI(o))}}return Bn(que(e,t))}function Uue(e){return Tae(e)?Object.assign({scheme:e.name},Nr(e,["name"])):{scheme:e}}function que(e,t){const{size:n,config:i,mark:r,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=ct(a[e]),l=t.getScaleComponent(e),u=l.get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case Ge:case ut:{if(ae(["point","band"],u)){if(e===Ge&&!n.width){const p=uf(i.view,"width");if(fr(p))return p}else if(e===ut&&!n.height){const p=uf(i.view,"height");if(fr(p))return p}}const d=i3(e),h=t.getName(d);return e===ut&&ri(u)?[oi.fromName(o,h),0]:[0,oi.fromName(o,h)]}case zr:{const d=t.component.scales[e].get("zero"),h=a3(r,d,i),p=Hue(r,n,t,i);return Ig(u)?Gue(h,p,Wue(u,i,c,e)):[h,p]}case Si:return[0,Math.PI*2];case Jo:return[0,360];case Zi:return[0,new oi(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case $a:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Da:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case An:return"symbol";case _n:case nr:case ir:return u==="ordinal"?s==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Br:case Ta:case Ca:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function Wue(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&I(n)?n.length+1:(j(zre(i)),3)}}function Gue(e,t,n){const i=()=>{const r=lf(t),a=lf(e),o=`(${r} - ${a}) / (${n} - 1)`;return`sequence(${a}, ${r} + ${o}, ${o})`};return oe(t)?new oi(i):{signal:i()}}function a3(e,t,n){if(t)return oe(t)?{signal:`${t.signal} ? 0 : ${a3(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Fg("size",e))}const o3=.95;function Hue(e,t,n,i){const r={x:r3(n,"x"),y:r3(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const a=s3(t,r,i.view);return De(a)?a-1:new oi(()=>`${a.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const a=s3(t,r,i.view);return De(a)?Math.pow(o3*a,2):new oi(()=>`pow(${o3} * ${a.signal}, 2)`)}}throw new Error(Fg("size",e))}function s3(e,t,n){const i=fr(e.width)?e.width.step:Xg(n,"width"),r=fr(e.height)?e.height.step:Xg(n,"height");return t.x||t.y?new oi(()=>{const a=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${a.join(", ")})`}):Math.min(i,r)}function l3(e,t){Xe(e)?Yue(e,t):f3(e,t)}function Yue(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:a,specifiedScales:o}=e;for(const s of z(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=ct(r[s]),d=l[t],h=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=_I(h,t),v=AI(s,t);if(d!==void 0&&(m?v&&j(v):j(rI(h,t,s))),m&&v===void 0)if(d!==void 0)u.copyKeyFromObject(t,l);else{const y=t in u3?u3[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:g,domain:l.domain,markDef:a,config:i}):i.scale[t];y!==void 0&&u.set(t,y,!1)}}}const u3={bins:({model:e,fieldOrDatumDef:t})=>q(t)?Vue(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Xue(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>Jue(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>Kue(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>Que(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:a})=>Zue(e,t,n,i.type,r,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=q(e)?e.sort:void 0;return ece(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>tce(e,t,n,i,r)};function c3(e){Xe(e)?zue(e):f3(e,"range")}function f3(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?c3(i):l3(i,t);for(const i of z(n)){let r;for(const a of e.children){const o=a.component.scales[i];if(o){const s=o.getWithExplicit(t);r=Ba(r,s,t,"scale",PM((l,u)=>{switch(t){case"range":return l.step&&u.step?l.step-u.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Vue(e,t){const n=t.bin;if(Ie(n)){const i=L2(e,t.field,n);return new oi(()=>e.getSignalName(i))}else if(rn(n)&&tf(n)&&n.step!==void 0)return{step:n.step};return}function Xue(e,t){return ae([_n,nr,ir],e)&&t!=="nominal"?"hcl":void 0}function Jue(e,t,n){var i;return((i=cr(n))===null||i===void 0?void 0:i.bin)||ae([rt.TIME,rt.UTC],e)?void 0:t in Fa?!0:void 0}function Kue(e,t,n,i,r,a){if(e in Fa){if(Ti(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:s}=r;if(o==="bar"&&!(q(i)&&(i.bin||i.timeUnit))&&(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"))return a.continuousBandSize}if(t===rt.POINT)return n.pointPadding}return}function Que(e,t,n,i){if(e!==void 0)return;if(t in Fa){const{bandPaddingInner:r,barBandPaddingInner:a,rectBandPaddingInner:o}=i;return it(r,n==="bar"?a:o)}return}function Zue(e,t,n,i,r,a){if(e!==void 0)return;if(t in Fa&&n===rt.BAND){const{bandPaddingOuter:o}=a;return it(o,oe(r)?{signal:`${r.signal}/2`}:r/2)}return}function ece(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ri(e)&&t==="descending"?oe(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ri(e)&&t==="descending"?!0:void 0}function tce(e,t,n,i,r){const a=!!n&&n!=="unaggregated";if(a&&ri(r)){if(I(n)){const o=n[0],s=n[n.length-1];if(o<=0&&s>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Ig(r))return!0;if(!(q(t)&&t.bin)&&ae([...ii,...Pie],e)){const{orient:o,type:s}=i;return!(ae(["bar","area","line","trail"],s)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function nce(e,t,n,i){const r=ice(t,n,i),{type:a}=e;return Na(t)?a!==void 0?OI(t,a)?q(n)&&!SI(a,n.type)?(j(_re(a,r)),r):a:(j(kre(t,a,r)),r):r:null}function ice(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(Sl(e)||Dg(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&j(Tx(e,"ordinal")),"ordinal";if(e in Fa){if(ae(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Ax)return"band";return t.band!==void 0||Kx(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point";case"temporal":return Sl(e)?"time":Dg(e)==="discrete"?(j(Tx(e,"temporal")),"ordinal"):q(t)&&t.timeUnit&&an(t.timeUnit).utc?"utc":"time";case"quantitative":return Sl(e)?q(t)&&Ie(t.bin)?"bin-ordinal":"linear":Dg(e)==="discrete"?(j(Tx(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(nI(t.type))}function rce(e,{ignoreRange:t}={}){d3(e),Qj(e);for(const n of Rae)l3(e,n);t||c3(e)}function d3(e){Xe(e)?e.component.scales=ace(e):e.component.scales=sce(e)}function ace(e){const{encoding:t,mark:n}=e;return $g.reduce((i,r)=>{const a=ct(t[r]);if(a&&n===$N&&r===An&&a.type===Dl)return i;let o=a&&a.scale;if(a&&o!==null&&o!==!1){o=o??{};const s=nce(o,r,a,n);i[r]=new n3(e.scaleName(r+"",!0),{value:s,explicit:o.type===s})}return i},{})}const oce=PM((e,t)=>xI(e)-xI(t));function sce(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const a of e.children){d3(a);for(const o of z(a.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:$le(o,e),r.scale[o]==="shared"){const s=i[o],l=a.component.scales[o].getWithExplicit("type");s?gae(s.value,l.value)?i[o]=Ba(s,l,"type","scale",oce):(r.scale[o]="independent",delete i[o]):i[o]=l}}for(const a of z(i)){const o=e.scaleName(a,!0),s=i[a];n[a]=new n3(o,s);for(const l of e.children){const u=l.component.scales[a];u&&(l.renameScale(u.get("name"),o),u.merged=!0)}}return n}class Y2{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Xe(e){return(e==null?void 0:e.type)==="unit"}function $i(e){return(e==null?void 0:e.type)==="facet"}function V2(e){return(e==null?void 0:e.type)==="concat"}function Pl(e){return(e==null?void 0:e.type)==="layer"}class X2{constructor(e,t,n,i,r,a,o){var s,l;this.type=t,this.parent=n,this.config=r,this.view=o,this.children=[],this.correctDataNames=u=>(u.from&&u.from.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from&&u.from.facet&&u.from.facet.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=n,this.config=r,this.name=(s=e.name)!==null&&s!==void 0?s:i,this.title=Pa(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new Y2(),this.projectionNameMap=n?n.projectionNameMap:new Y2(),this.signalNameMap=n?n.signalNameMap:new Y2(),this.data=e.data,this.description=e.description,this.transforms=_se((l=e.transform)!==null&&l!==void 0?l:[]),this.layout=t==="layer"||t==="unit"?{}:Aoe(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Pg(e)||n&&n.component.data.isFaceted&&e.data===void 0},layoutSize:new za(),layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?pe(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){rce(this)}parseProjection(){Gj(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Pj(this)}assembleGroupStyle(){var e,t;return this.type==="unit"||this.type==="layer"?(t=(e=this.view)===null||e===void 0?void 0:e.style)!==null&&t!==void 0?t:"cell":void 0}assembleEncodeFromView(e){const t=Z(e,["style"]),n={};for(const i of z(t)){const r=t[i];r!==void 0&&(n[i]=tt(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(t.description=tt(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},t??{}):Fe(t)?void 0:t}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=Z(e,["spacing"]),{component:i,config:r}=this,a=Cle(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of ni)e[n].title&&t.push(kle(this,n));for(const n of R2)t=t.concat(_le(this,n));return t}assembleAxes(){return ule(this.component.axes,this.config)}assembleLegends(){return Uj(this)}assembleProjections(){return Qle(this)}assembleTitle(){var e,t,n;const i=(e=this.title)!==null&&e!==void 0?e:{},{encoding:r}=i,a=Z(i,["encoding"]),o=Object.assign(Object.assign(Object.assign({},QI(this.config.title).nonMark),a),r?{encode:{update:r}}:{});return o.text?(ae(["unit","layer"],this.type)?ae(["middle",void 0],o.anchor)&&(o.frame=(t=o.frame)!==null&&t!==void 0?t:"group"):o.anchor=(n=o.anchor)!==null&&n!==void 0?n:"start",Fe(o)?void 0:o):void 0}assembleGroup(e=[]){const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||$i(this.parent)?e3(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return Ue((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=((t=i[n])!==null&&t!==void 0?t:0)+1,n}getSizeSignalRef(e){if($i(this.parent)){const t=$j(e),n=Cg(t),i=this.component.scales[n];if(i&&!i.merged){const r=i.get("type"),a=i.get("range");if(Sn(r)&&Ia(a)){const o=i.get("name"),s=hm(this,n),l=H2(s);if(l){const u=U({aggregate:"distinct",field:l},{expr:"datum"});return{signal:Cj(o,i,u)}}else return j(`Unknown field for ${n}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):BN(e)&&Na(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(Xie(t));return n}hasAxisOrientSignalRef(){var e,t;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some(n=>n.hasOrientSignalRef()))||((t=this.component.axes.y)===null||t===void 0?void 0:t.some(n=>n.hasOrientSignalRef()))}}class h3 extends X2{vgField(e,t={}){const n=this.fieldDef(e);return n?U(n,t):void 0}reduceFieldDef(e,t){return oM(this.getMapping(),(n,i,r)=>{const a=cr(i);return a?e(n,a,r):n},t)}forEachFieldDef(e,t){i2(this.getMapping(),(n,i)=>{const r=cr(n);r&&e(r,i)},t)}}class J2 extends $e{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"value",(r=a[1])!==null&&r!==void 0?r:"density"]}clone(){return new J2(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${we(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=Z(e,["density"]),i=Object.assign({type:"kde",field:t},n);return i}}class pm extends $e{constructor(e,t){super(e);this.filter=t}clone(){return new pm(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t,a=Se("invalid",r,n);if(a!=="filter")return null;const o=t.reduceFieldDef((s,l,u)=>{const c=Na(u)&&t.getScaleComponent(u);if(c){const f=c.get("type");ri(f)&&l.aggregate!=="count"&&!Vo(i)&&(s[l.field]=l)}return s},{});return z(o).length?new pm(e,o):null}dependentFields(){return new Set(z(this.filter))}producedFields(){return new Set()}hash(){return`FilterInvalid ${we(this.filter)}`}assemble(){const e=z(this.filter).reduce((t,n)=>{const i=this.filter[n],r=U(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?t.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):i.type==="quantitative"&&(t.push(`isValid(${r})`),t.push(`isFinite(+${r})`))),t},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class K2 extends $e{constructor(e,t){super(e);this.transform=t,this.transform=pe(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((r,a)=>{var o;return(o=i[a])!==null&&o!==void 0?o:r})}clone(){return new K2(this.parent,pe(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${we(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform,n={type:"flatten",fields:e,as:t};return n}}class Q2 extends $e{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"key",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new Q2(null,pe(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${we(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform,n={type:"fold",fields:e,as:t};return n}}class wf extends $e{constructor(e,t,n,i){super(e);this.fields=t,this.geojson=n,this.signal=i}clone(){return new wf(null,pe(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[tr,er],[ti,Oi]]){const r=i.map(a=>{const o=ct(t.encoding[a]);return q(o)?o.field:La(o)?{expr:`${o.datum}`}:Ur(o)?{expr:`${o.value}`}:void 0});(r[0]||r[1])&&(e=new wf(e,r,null,t.getName(`geojson_${n++}`)))}if(t.channelHasField(An)){const i=t.typedFieldDef(An);i.type===Dl&&(e=new wf(e,null,i.field,t.getName(`geojson_${n++}`)))}return e}dependentFields(){var e;const t=((e=this.fields)!==null&&e!==void 0?e:[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set()}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${we(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class gm extends $e{constructor(e,t,n,i){super(e);this.projection=t,this.fields=n,this.as=i}clone(){return new gm(null,this.projection,pe(this.fields),pe(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[tr,er],[ti,Oi]]){const i=n.map(a=>{const o=ct(t.encoding[a]);return q(o)?o.field:La(o)?{expr:`${o.datum}`}:Ur(o)?{expr:`${o.value}`}:void 0}),r=n[0]===ti?"2":"";(i[0]||i[1])&&(e=new gm(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${we(this.fields)} ${we(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class zl extends $e{constructor(e,t){super(e);this.transform=t}clone(){return new zl(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e,r=[t,n,...i?[i]:[]].join(",");return{signal:`sequence(${r})`}}static makeFromTransform(e,t){return new zl(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(q(i)&&q(r)){const a=i.impute?i:r.impute?r:void 0;if(a===void 0)return;const o=i.impute?r:r.impute?i:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=sM(t.mark,n);return new zl(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),c!==void 0?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${we(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:rse(n)?this.processSequence(n):n}:{}),{method:"value"}),r?{groupby:r}:{}),{value:!i||i==="value"?a:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:o,ignorePeers:!1},r?{groupby:r}:{}),u={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[s,l,u]}else return[s]}}class Z2 extends $e{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.loess]}clone(){return new Z2(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${we(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,i=Z(e,["loess","on"]),r=Object.assign({type:"loess",x:n,y:t},i);return r}}class mm extends $e{constructor(e,t,n){super(e);this.transform=t,this.secondary=n}clone(){return new mm(null,pe(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:a}=n;let o=null;if(ose(a)){let s=v3(a.data,r);s||(s=new Ml(a.data),r.push(s));const l=t.getName(`lookup_${i}`);o=new on(s,l,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[l]=o}else if(sse(a)){const s=a.selection;if(n=Object.assign({as:s},n),o=t.getSelectionComponent(Ue(s),s).materialized,!o)throw new Error(Qie(s))}return new mm(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?G(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${we({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:G(this.transform.as)}:{});else{let t=this.transform.as;Y(t)||(j(ire),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class eE extends $e{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"prob",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new eE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${we(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=Z(e,["quantile"]),i=Object.assign({type:"quantile",field:t},n);return i}}class tE extends $e{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.regression]}clone(){return new tE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${we(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,i=Z(e,["regression","on"]),r=Object.assign({type:"regression",x:n,y:t},i);return r}}class nE extends $e{constructor(e,t){super(e);this.transform=t}clone(){return new nE(null,pe(this.transform))}addDimensions(e){var t;this.transform.groupby=_a(((t=this.transform.groupby)!==null&&t!==void 0?t:[]).concat(e),n=>n)}producedFields(){return}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}hash(){return`PivotTransform ${we(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},i!==void 0?{limit:i}:{}),r!==void 0?{op:r}:{}),n!==void 0?{groupby:n}:{})}}class iE extends $e{constructor(e,t){super(e);this.transform=t}clone(){return new iE(null,pe(this.transform))}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return`SampleTransform ${we(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function p3(e){let t=0;function n(i,r){var a;if(i instanceof Ml&&(!i.isGenerator&&!cf(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof sn&&(i.parent instanceof Ml&&!r.source?(r.format=Object.assign(Object.assign({},(a=r.format)!==null&&a!==void 0?a:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof jl){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}if((i instanceof um||i instanceof cm||i instanceof pm||i instanceof mf||i instanceof yf||i instanceof gm||i instanceof wf||i instanceof hr||i instanceof mm||i instanceof bf||i instanceof Ll||i instanceof Q2||i instanceof K2||i instanceof J2||i instanceof Z2||i instanceof eE||i instanceof tE||i instanceof cs||i instanceof iE||i instanceof nE)&&r.transform.push(i.assemble()),(i instanceof Hr||i instanceof Wr||i instanceof zl||i instanceof Wa)&&r.transform.push(...i.assemble()),i instanceof on){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof on)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof on&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const s of i.children){const l={name:null,source:o,transform:[]};n(s,l)}break}}}return n}function lce(e){const t=[],n=p3(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function uce(e,t){var n,i;const r=[],a=p3(r);let o=0;for(const l of e.sources){l.hasName()||(l.dataName=`source_${o++}`);const u=l.assemble();a(l,u)}for(const l of r)l.transform.length===0&&delete l.transform;let s=0;for(const[l,u]of r.entries())((n=u.transform)!==null&&n!==void 0?n:[]).length===0&&!u.source&&r.splice(s++,0,r.splice(l,1)[0]);for(const l of r)for(const u of(i=l.transform)!==null&&i!==void 0?i:[])u.type==="lookup"&&(u.from=e.outputNodes[u.from].getSource());for(const l of r)l.name in t&&(l.values=t[l.name]);return r}function cce(e){return e==="top"||e==="left"||oe(e)?"header":"footer"}function fce(e){for(const t of ni)dce(e,t);m3(e,"x"),m3(e,"y")}function dce(e,t){var n;const{facet:i,config:r,child:a,component:o}=e;if(e.channelHasField(t)){const s=i[t],l=Il("title",null,r,t);let u=ns(s,r,{allowDisabling:!0,includeDefault:l===void 0||!!l});a.component.layoutHeaders[t].title&&(u=I(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=Il("labelOrient",s,r,t),f=(n=s.header)!==null&&n!==void 0?n:{},d=it(f.labels,r.header.labels,!0),h=ae(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[h]:t==="facet"?[]:[g3(e,t,d)]}}}function g3(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function m3(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:a}=e.component;if(a.axis[t]=M2(a,t),a.axis[t]==="shared"){const o=t==="x"?"column":"row",s=r[o];for(const l of i.component.axes[t]){const u=cce(l.get("orient"));s[u]=(n=s[u])!==null&&n!==void 0?n:[g3(e,o,!1)];const c=vf(l,"main",e.config,{header:!0});c&&s[u][0].axes.push(c),l.mainExtracted=!0}}}}function hce(e){rE(e),vm(e,"width"),vm(e,"height")}function pce(e){rE(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";vm(e,t),vm(e,n)}function rE(e){for(const t of e.children)t.parseLayoutSize()}function vm(e,t){const n=$j(t),i=Cg(n),r=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const l=s.component.layoutSize.getWithExplicit(n),u=r.scale[i];if(u==="independent"&&l.value==="step"){o=void 0;break}if(o){if(u==="independent"&&o.value!==l.value){o=void 0;break}o=Ba(o,l,n,"")}else o=l}if(o){for(const s of e.children)e.renameSignal(s.getName(n),e.getName(t)),s.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function gce(e){const{size:t,component:n}=e;for(const i of ii){const r=ar(i);if(t[r]){const a=t[r];n.layoutSize.set(r,fr(a)?"step":a,!0)}else{const a=mce(e,r);n.layoutSize.set(r,a,!1)}}}function mce(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const a=r.get("type"),o=r.get("range");if(Sn(a)){const s=uf(i.view,t);return Ia(o)||fr(s)?"step":s}else return h2(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return h2(i.view,t);{const a=uf(i.view,t);return fr(a)?a.step:a}}}function aE(e,t,n){return U(t,Object.assign({suffix:`by_${U(e)}`},n??{}))}class ym extends h3{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve);this.child=sE(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return af(e)?oM(e,(n,i,r)=>ae([Mr,jr],r)?i.field===void 0?(j(Ox(i,r)),n):(n[r]=Zx(i,r,t),n):(j(Fg(r,"facet")),n),{}):{facet:Zx(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=bm(this),this.child.parseData()}parseLayoutSize(){rE(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),fce(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of ni)for(const a of F2){const o=this.component.layoutHeaders[r],s=o[a],{facetFieldDef:l}=o;if(l){const u=Il("titleOrient",l,this.config,r);if(ae(["right","bottom"],u)){const c=om(r,u);i.titleAnchor=(e=i.titleAnchor)!==null&&e!==void 0?e:{},i.titleAnchor[c]="end"}}if(s==null?void 0:s[0]){const u=r==="row"?"height":"width",c=a==="header"?"headerBand":"footerBand";r!=="facet"&&!this.child.component.layoutSize.get(u)&&(i[c]=(t=i[c])!==null&&t!==void 0?t:{},i[c][r]=.5),o.title&&(i.offset=(n=i.offset)!==null&&n!==void 0?n:{},i.offset[r==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(!t&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof ym)return;{const e=this.getName("column_domain");return{signal:`length(data('${e}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof ym?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:U(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof ym){if(this.child.channelHasField("column")){const i=U(this.child.facet.column);e.push(i),t.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of ii){const r=this.child.component.scales[i];if(r&&!r.merged){const a=r.get("type"),o=r.get("range");if(Sn(a)&&Ia(o)){const s=hm(this.child,i),l=H2(s);l?(e.push(l),t.push("distinct"),n.push(`distinct_${l}`)):j(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of ni){const c=this.facet[u];if(c){s.push(U(c));const{bin:f,sort:d}=c;if(Ie(f)&&s.push(U(c,{binSuffix:"end"})),lr(d)){const{field:h,op:p=Lg}=d,g=aE(c,d);n&&i?(r.push(g),a.push("max"),o.push(g)):(r.push(h),a.push(p),o.push(g))}else if(I(d)){const h=Nl(c,u);r.push(h),a.push("max"),o.push(h)}}}const l=!!n&&!!i;return Object.assign({name:e,data:t,groupby:s},l||r.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),r.length?{fields:r,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?lr(n.sort)?[aE(n,n.sort,{expr:"datum"})]:I(n.sort)?[Nl(n,e,{expr:"datum"})]:[U(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:i}=n,r=(lr(i)?i.order:!I(i)&&i)||"ascending";return[r]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return N2(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of R2)if(e[i]){const r=Il("labelOrient",e[i],t,i);if(ae(n[i],r))return N2(e[i],i,t)}return}assembleMarks(){const{child:e}=this,t=this.component.data.facetRoot,n=lce(t),i=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),a=e.assembleGroupStyle(),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:ni.map(s=>this.facetSortFields(s)).flat(),order:ni.map(s=>this.facetSortOrder(s)).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup(Vse(this,[])));return[o]}getMapping(){return this.facet}}function vce(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const a of[n,i])if(lr(a.sort)){const{field:o,op:s=Lg}=a.sort;e=r=new Ll(e,{joinaggregate:[{op:s,field:o,as:aE(a,a.sort,{forAs:!0})}],groupby:[U(a)]})}return r}return null}function v3(e,t){var n,i,r,a,o,s,l,u,c,f;for(const d of t){const h=d.data;if(e.name&&d.hasName()&&e.name!==d.dataName)continue;if(((n=e.format)===null||n===void 0?void 0:n.mesh)&&((i=h.format)===null||i===void 0?void 0:i.feature))continue;if((((r=e.format)===null||r===void 0?void 0:r.feature)||((a=h.format)===null||a===void 0?void 0:a.feature))&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((s=h.format)===null||s===void 0?void 0:s.feature))continue;if((((l=e.format)===null||l===void 0?void 0:l.mesh)||((u=h.format)===null||u===void 0?void 0:u.mesh))&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=h.format)===null||f===void 0?void 0:f.mesh))continue;if(Qg(e)&&Qg(h)){if(Yc(e.values,h.values))return d}else if(cf(e)&&cf(h)){if(e.url===h.url)return d}else if(zM(e)&&e.name===d.dataName)return d}return null}function yce(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Ml({values:[]});return t.push(i),i}const n=v3(e.data,t);if(n)return ss(e.data)||(n.data.format=Kne({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Ml(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function bce(e,t,n){var i,r;let a=0;for(const o of t.transforms){let s,l;if(vse(o))l=e=new yf(e,o),s="derived";else if(qM(o)){const u=fue(o);l=e=(i=sn.makeWithAncestors(e,{},u,n))!==null&&i!==void 0?i:e,e=new mf(e,t,o.filter)}else if(yse(o))l=e=Hr.makeFromTransform(e,o,t),s="number";else if(wse(o)){s="date";const u=n.getWithExplicit(o.field);u.value===void 0&&(e=new sn(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=Wr.makeFromTransform(e,o)}else if(xse(o))l=e=hr.makeFromTransform(e,o),s="number",O2(t)&&(e=new cs(e));else if(ase(o))l=e=mm.make(e,t,o,a++),s="derived";else if(pse(o))l=e=new bf(e,o),s="number";else if(gse(o))l=e=new Ll(e,o),s="number";else if(Ese(o))l=e=Wa.makeFromTransform(e,o),s="derived";else if(kse(o))l=e=new Q2(e,o),s="derived";else if(mse(o))l=e=new K2(e,o),s="derived";else if(lse(o))l=e=new nE(e,o),s="derived";else if(hse(o))e=new iE(e,o);else if(bse(o))l=e=zl.makeFromTransform(e,o),s="derived";else if(use(o))l=e=new J2(e,o),s="derived";else if(cse(o))l=e=new eE(e,o),s="derived";else if(fse(o))l=e=new tE(e,o),s="derived";else if(dse(o))l=e=new Z2(e,o),s="derived";else{j(nre(o));continue}if(l&&s!==void 0)for(const u of(r=l.producedFields())!==null&&r!==void 0?r:[])n.set(u,s,!1)}return e}function bm(e){var t,n,i,r,a,o,s,l,u,c;let f=yce(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new ise(),g=e.data;ss(g)?(BM(g)?f=new cm(f,g.sequence):y2(g)&&(f=new um(f,g.graticule)),p.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=sn.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new cs(f);const m=e.parent&&Pl(e.parent);(Xe(e)||$i(e))&&(m&&(f=(i=Hr.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=bce(f,e,p));const v=hue(e),y=due(e);f=(r=sn.makeWithAncestors(f,{},Object.assign(Object.assign({},v),y),p))!==null&&r!==void 0?r:f,Xe(e)&&(f=wf.parseAll(f,e),f=gm.parseAll(f,e)),(Xe(e)||$i(e))&&(m||(f=(a=Hr.makeFromEncoding(f,e))!==null&&a!==void 0?a:f),f=(o=Wr.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=yf.parseAllForSortIndex(f,e));const b=e.getName(Zg),E=new on(f,b,Zg,h);if(d[b]=E,f=E,Xe(e)){const A=hr.makeFromEncoding(f,e);A&&(f=A,O2(e)&&(f=new cs(f))),f=(s=zl.makeFromEncoding(f,e))!==null&&s!==void 0?s:f,f=(l=Wa.makeFromEncoding(f,e))!==null&&l!==void 0?l:f}Xe(e)&&(f=(u=pm.make(f,e))!==null&&u!==void 0?u:f);const x=e.getName(Ut),k=new on(f,x,Ut,h);d[x]=k,f=k,Xe(e)&&sle(e,k);let w=null;if($i(e)){const A=e.getName("facet");f=(c=vce(f,e.facet))!==null&&c!==void 0?c:f,w=new jl(f,e,A,k.getSource()),d[A]=w}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:E,main:k,facetRoot:w,ancestorParse:p})}class wce extends X2{constructor(e,t,n,i){var r,a,o,s;super(e,"concat",t,n,i,e.resolve);(((a=(r=e.resolve)===null||r===void 0?void 0:r.axis)===null||a===void 0?void 0:a.x)==="shared"||((s=(o=e.resolve)===null||o===void 0?void 0:o.axis)===null||s===void 0?void 0:s.y)==="shared")&&j(ere),this.children=this.getChildren(e).map((l,u)=>sE(l,this,this.getName("concat_"+u),void 0,i))}parseData(){this.component.data=bm(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return Vg(e)?e.vconcat:d2(e)?e.hconcat:e.concat}parseLayoutSize(){pce(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=I2(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})}}function xce(e){return e===!1||e===null}const Ece=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},SN),{labelExpr:1,encode:1}),y3=z(Ece);class b3 extends za{constructor(e={},t={},n=!1){super();this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new b3(pe(this.explicit),pe(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!xce(this.get(e))}hasOrientSignalRef(){return oe(this.explicit.orient)}}function kce(e,t,n){var i;const{encoding:r,config:a}=e,o=(i=ct(r[t]))!==null&&i!==void 0?i:ct(r[rr(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return ts(u)?Object.assign({text:Wx({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}function _ce(e){return ii.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Dce(n,e)]),t),{})}const Ace={bottom:"top",top:"bottom",left:"right",right:"left"};function Sce(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const o of z(a.component.axes))i.axis[o]=M2(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=Oce(n[o],a.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const a of ii){for(const o of e.children){if(!o.component.axes[a])continue;if(i.axis[a]==="independent"){n[a]=((t=n[a])!==null&&t!==void 0?t:[]).concat(o.component.axes[a]);for(const s of o.component.axes[a]){const{value:l,explicit:u}=s.getWithExplicit("orient");if(oe(l))continue;if(r[l]>0&&!u){const c=Ace[l];r[l]>r[c]&&s.set("orient",c,!1)}r[l]++}}delete o.component.axes[a]}if(i.axis[a]==="independent"&&n[a]&&n[a].length>1)for(const o of n[a])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function Oce(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],a=t[i];if(!!r!==!!a)return;if(r&&a){const o=r.getWithExplicit("orient"),s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;e[i]=Tce(r,a)}}}else return t.map(n=>n.clone());return e}function Tce(e,t){for(const n of y3){const i=Ba(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,a)=>{switch(n){case"title":return aM(r,a);case"gridScale":return{explicit:r.explicit,value:it(r.value,a.value)}}return Kg(r,a,n,"axis")});e.setWithExplicit(n,i)}return e}function Cce(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(oe(n.labelAngle)?n.labelAngle:vg(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===_j(i,r))return!0}return e===n[t]}const $ce=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Dce(e,t){var n,i,r;let a=t.axis(e);const o=new b3(),s=ct(t.encoding[e]),{mark:l,config:u}=t,c=(a==null?void 0:a.orient)||((n=u[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=u.axis)===null||i===void 0?void 0:i.orient)||ble(e),f=t.getScaleComponent(e).get("type"),d=dle(e,f,c,t.config),h=a!==void 0?!a:$2("disable",u,a==null?void 0:a.style,d).configValue;if(o.set("disable",h,a!==void 0),h)return o;a=a||{};const p=mle(t,a,e,s,d),g={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const y of y3){const b=y in xj?xj[y](g):ON(y)?a[y]:void 0,E=b!==void 0,x=Cce(b,y,a,t,e);if(E&&x)o.set(y,b,x);else{const{configValue:k=void 0,configFrom:w=void 0}=ON(y)&&y!=="values"?$2(y,t.config,a.style,d):{},A=k!==void 0;E&&!A?o.set(y,b,x):(!(w==="vgAxisConfig")||$ce.has(y)&&A||vx(k)||oe(k))&&o.set(y,k,!1)}}const m=(r=a.encoding)!==null&&r!==void 0?r:{},v=AN.reduce((y,b)=>{var E;if(!o.hasAxisPart(b))return y;const x=Dj((E=m[b])!==null&&E!==void 0?E:{},t),k=b==="labels"?kce(t,e,x):x;return k!==void 0&&!Fe(k)&&(y[b]={update:k}),y},{});return Fe(v)||o.set("encode",v,!!a.encoding||a.labelAngle!==void 0),o}function Rce({encoding:e,size:t}){for(const n of ii){const i=ar(n);fr(t[i])&&(ur(e[n])&&(delete t[i],j(aI(i))))}return t}function Fce(e,t,n,{graticule:i}){const r=Ki(e)?Object.assign({},e):{type:e},a=Se("orient",r,n);if(r.orient=jce(r.type,t,a),a!==void 0&&a!==r.orient&&j(mre(r.orient,a)),r.type==="bar"&&r.orient){const u=Se("cornerRadiusEnd",r,n);if(u!==void 0){const c=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:vie[r.orient];for(const f of c)r[f]=u;r.cornerRadiusEnd!==void 0&&delete r.cornerRadiusEnd}}const o=Se("opacity",r,n);o===void 0&&(r.opacity=Ice(r.type,t));const s=r.filled;s===void 0&&(r.filled=i?!1:Mce(r,n));const l=Se("cursor",r,n);return l===void 0&&(r.cursor=Nce(r,t,n)),r}function Nce(e,t,n){return t.href||e.href||Se("href",e,n)?"pointer":e.cursor}function Ice(e,t){return ae([xg,yx,bx,wx],e)&&!t2(t)?.7:void 0}function Mce(e,t){const n=rs("filled",e,t),i=e.type;return it(n,i!==xg&&i!==wg&&i!==Eg)}function jce(e,t,n){switch(e){case xg:case bx:case wx:case CN:case uie:case lie:return}const{x:i,y:r,x2:a,y2:o}=t;switch(e){case bg:if(q(i)&&(rn(i.bin)||q(r)&&r.aggregate&&!i.aggregate))return"vertical";if(q(r)&&(rn(r.bin)||q(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(q(i)&&i.type===Zo&&!Ie(i.bin)||Xx(i)))return"horizontal";if(!o&&(q(r)&&r.type===Zo&&!Ie(r.bin)||Xx(r)))return"vertical"}case Eg:if(a&&!(q(i)&&rn(i.bin))&&o&&!(q(r)&&rn(r.bin)))return;case yg:if(o)return q(r)&&rn(r.bin)?"horizontal":"vertical";if(a)return q(i)&&rn(i.bin)?"vertical":"horizontal";if(e===Eg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case wg:case yx:{const s=ur(i),l=ur(r);if(s&&!l)return e!=="tick"?"horizontal":"vertical";if(!s&&l)return e!=="tick"?"vertical":"horizontal";if(s&&l){const u=i,c=r,f=u.type===$l,d=c.type===$l;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!u.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":u.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const Lce={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),qt("x",e,{defaultPos:"mid"})),qt("y",e,{defaultPos:"mid"})),Ua(e,"radius","arc")),Ua(e,"theta","arc"))},Pce={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),tm("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),tm("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),x2(e))},zce={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ua(e,"x","bar")),Ua(e,"y","bar"))},Bce={vgMark:"shape",encodeEntry:e=>Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&q(n)&&n.type===Dl?{field:U(n,{expr:"datum"})}:{});return[i]}},Uce={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Ua(e,"x","image")),Ua(e,"y","image")),b2(e,"url"))},qce={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),qt("x",e,{defaultPos:"mid"})),qt("y",e,{defaultPos:"mid"})),wt("size",e,{vgChannel:"strokeWidth"})),x2(e))},Wce={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),qt("x",e,{defaultPos:"mid"})),qt("y",e,{defaultPos:"mid"})),wt("size",e)),x2(e))};function oE(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),qt("x",e,{defaultPos:"mid"})),qt("y",e,{defaultPos:"mid"})),wt("size",e)),wt("angle",e)),Gce(e,n,t))}function Gce(e,t,n){return n?{shape:{value:n}}:wt("shape",e)}const Hce={vgMark:"symbol",encodeEntry:e=>oE(e)},Yce={vgMark:"symbol",encodeEntry:e=>oE(e,"circle")},Vce={vgMark:"symbol",encodeEntry:e=>oE(e,"square")},Xce={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ua(e,"x","rect")),Ua(e,"y","rect"))},Jce={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),tm("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),tm("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),wt("size",e,{vgChannel:"strokeWidth"}))}},Kce={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),qt("x",e,{defaultPos:"mid"})),qt("y",e,{defaultPos:"mid"})),b2(e)),wt("size",e,{vgChannel:"fontSize"})),wt("angle",e)),QM("align",Qce(e.markDef,n,t))),QM("baseline",Zce(e.markDef,n,t))),qt("radius",e,{defaultPos:null,isMidPoint:!0})),qt("theta",e,{defaultPos:null,isMidPoint:!0}))}};function Qce(e,t,n){const i=Se("align",e,n);return i===void 0?"center":void 0}function Zce(e,t,n){const i=Se("baseline",e,n);return i===void 0?"middle":void 0}const efe={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",a=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ai(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),qt("x",e,{defaultPos:"mid",vgChannel:"xc"})),qt("y",e,{defaultPos:"mid",vgChannel:"yc"})),wt("size",e,{defaultValue:tfe(e),vgChannel:r})),{[a]:tt(Se("thickness",n,t))})}};function tfe(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,a=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),s=(t=Se("size",i,n,{vgChannel:a}))!==null&&t!==void 0?t:n.tick.bandSize;if(s!==void 0)return s;{const l=o?o.get("range"):void 0;if(l&&Ia(l)&&De(l.step))return l.step*3/4;const u=Xg(n.view,a);return u*3/4}}const wm={arc:Lce,area:Pce,bar:zce,circle:Yce,geoshape:Bce,image:Uce,line:qce,point:Hce,rect:Xce,rule:Jce,square:Vce,text:Kce,tick:efe,trail:Wce};function nfe(e){return ae([wg,yg,cie],e.mark)?ife(e):ae([bg],e.mark)?rfe(e):xm(e)}const w3="faceted_path_";function ife(e){const t=sM(e.mark,e.encoding),n=xm(e,{fromPrefix:t.length>0?w3:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:w3+e.requestDataName(Ut),data:e.requestDataName(Ut),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const x3="stack_group_";function rfe(e){const t=Fx.some(n=>Se(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=xm(e,{fromPrefix:x3}),i=e.scaleName(e.stack.fieldChannel),r=(f={})=>e.vgField(e.stack.fieldChannel,f),a=(f,d)=>{const h=[r({prefix:"min",suffix:"start",expr:d}),r({prefix:"max",suffix:"start",expr:d}),r({prefix:"min",suffix:"end",expr:d}),r({prefix:"max",suffix:"end",expr:d})];return`${f}(${h.map(p=>`scale('${i}',${p})`).join(",")})`};let o,s;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},Vc(n.encode.update,["y","yc","y2","height",...Fx])),{x:{signal:a("min","datum")},x2:{signal:a("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},Nr(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},Vc(n.encode.update,["x","xc","x2","width"])),{y:{signal:a("min","datum")},y2:{signal:a("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},Nr(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of Fx){const d=rs(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):d&&(o[f]=tt(d)),d&&(n.encode.update[f]={value:0})}const l=e.fieldDef(e.stack.groupbyChannel),u=U(l)?[U(l)]:[];((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&u.push(U(l,{binSuffix:"end"}));const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=c.reduce((f,d)=>{if(n.encode.update[d])return Object.assign(Object.assign({},f),{[d]:n.encode.update[d]});{const h=rs(d,e.markDef,e.config);return h!==void 0?Object.assign(Object.assign({},f),{[d]:tt(h)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(Ut),name:x3+e.requestDataName(Ut),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}else return xm(e)}function afe(e){const{encoding:t,stack:n,mark:i,markDef:r,config:a}=e,o=t.order;if(!I(o)&&Ur(o)&&mN(o.value)||!o&&mN(Se("order",r,a)))return;if((I(o)||q(o))&&!n)return nM(o,{expr:"datum"});if(Vo(i)){const s=r.orient==="horizontal"?"y":"x",l=t[s];if(q(l)){const u=l.sort;if(I(u))return{field:U(l,{prefix:s,suffix:"sort_index",expr:"datum"})};if(lr(u))return{field:U({aggregate:t2(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(LI(u)){const c=e.fieldDef(u.encoding);return{field:U(c,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:U(l,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function xm(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:r}=e,a=it(i.clip,ofe(e),sfe(e)),o=eM(i),s=e.encoding.key,l=afe(e),u=lfe(e),c=Se("aria",i,r),f=wm[n].postEncodingTransform?wm[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:wm[n].vgMark},a?{clip:!0}:{}),o?{style:o}:{}),s?{key:s.field}:{}),l?{sort:l}:{}),u||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(Ut)},encode:{update:wm[n].encodeEntry(e)}}),f?{transform:f}:{})]}function ofe(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function sfe(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function lfe(e){if(!e.component.selection)return null;const t=z(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=z(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}class E3 extends h3{constructor(e,t,n,i={},r){var a,o;super(e,"unit",t,n,r,void 0,xM(e)?e.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=Ki(e.mark)?e.mark.type:e.mark;this.markDef=Fce(e.mark,(a=e.encoding)!==null&&a!==void 0?a:{},r,{graticule:e.data&&y2(e.data)});const l=this.encoding=toe((o=e.encoding)!==null&&o!==void 0?o:{},this.markDef,r);this.size=Rce({encoding:l,size:xM(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=TM(s,l),this.specifiedScales=this.initScales(s,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===$N,n=e&&Rie.some(i=>se(e[i]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return $g.reduce((n,i)=>{var r;const a=ct(t[i]);return a&&(n[i]=(r=a.scale)!==null&&r!==void 0?r:{}),n},{})}initAxes(e){return ii.reduce((t,n)=>{const i=e[n];if(se(i)||n===Ge&&se(e.x2)||n===ut&&se(e.y2)){const r=se(i)?i.axis:void 0;t[n]=r&&Object.assign({},r)}return t},{})}initLegend(e){return zie.reduce((t,n)=>{const i=ct(e[n]);if(i&&Uie(n)){const r=i.legend;t[n]=r&&Object.assign({},r)}return t},{})}parseData(){this.component.data=bm(this)}parseLayoutSize(){gce(this)}parseSelections(){this.component.selection=ole(this,this.selection)}parseMarkGroup(){this.component.mark=nfe(this)}parseAxesAndHeaders(){this.component.axes=_ce(this)}assembleSelectionTopLevelSignals(e){return Xse(this,e)}assembleSignals(){return[...vj(this),...Yse(this,[])]}assembleSelectionData(e){return Jse(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return I2(this)}assembleMarks(){var e;let t=(e=this.component.mark)!==null&&e!==void 0?e:[];return(!this.parent||!Pl(this.parent))&&(t=uj(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return as(this.encoding,e)}fieldDef(e){const t=this.encoding[e];return cr(t)}typedFieldDef(e){const t=this.fieldDef(e);return zn(t)?t:null}}class k3 extends X2{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((o,s)=>{if(Jg(o))return new k3(o,this,this.getName("layer_"+s),a,r);if(Ir(o))return new E3(o,this,this.getName("layer_"+s),a,r);throw new Error(Sx(o))})}parseData(){this.component.data=bm(this);for(const e of this.children)e.parseData()}parseLayoutSize(){hce(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){Sce(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),vj(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),I2(this))}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e;return}assembleLayout(){return null}assembleMarks(){return Kse(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),Uj(this))}}function sE(e,t,n,i,r){if(Pg(e))return new ym(e,t,n,r);if(Jg(e))return new k3(e,t,n,i,r);if(Ir(e))return new E3(e,t,n,i,r);if(Eoe(e))return new wce(e,t,n,r);throw new Error(Sx(e))}function ufe(e,t={}){t.logger&&Bre(t.logger),t.fieldTitle&&VI(t.fieldTitle);try{const n=AM(Jl(t.config,e.config)),i=MM(e,n),r=sE(i,null,"",void 0,n);r.parse(),Cue(r.component.data,r);const a=ffe(r,cfe(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:a,normalized:i}}finally{t.logger&&Ure(),t.fieldTitle&&Vae()}}function cfe(e,t,n,i){const r=i.component.layoutSize.get("width"),a=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&a&&ese(t.type)){if(r==="step"&&a==="step")j(JN()),t.type="pad";else if(r==="step"||a==="step"){const o=r==="step"?"width":"height";j(JN(Cg(o)));const s=o==="width"?"height":"width";t.type=tse(s)}}return Object.assign(Object.assign(Object.assign({},z(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),LM(n)),LM(e))}function ffe(e,t,n={},i){const r=e.config?Noe(e.config):void 0,a=[].concat(e.assembleSelectionData([]),uce(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}class dfe extends SM{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:a,aggregate:o,groupby:s,encoding:l}=n2(n,t),u=[...i||[],...r,...a,...o.length===0?[]:[{aggregate:o,groupby:s}]];return Object.assign(Object.assign(Object.assign({},e),u.length>0?{transform:u}:{}),{encoding:l})}else return e}}const hfe=new dfe();function pfe(e,t){return hfe.map(e,{config:t})}const gfe=Vne.version;var mfe=Object.freeze({__proto__:null,normalize:MM,version:gfe,compile:ufe,extractTransforms:pfe}),vfe=Om(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function n(i){var r=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g,a=r.exec(i).slice(1,3),o=a[0],s=a[1];return{library:o,version:s}}t.default=n}),_3=L3(vfe);const yfe="vega-themes",bfe="2.8.3",wfe="Themes for stylized Vega and Vega-Lite visualizations.",xfe=["vega","vega-lite","themes","style"],Efe="BSD-3-Clause",kfe={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},_fe=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],Afe="build/vega-themes.js",Sfe="build/src/index.js",Ofe="build/vega-themes.min.js",Tfe="build/vega-themes.min.js",Cfe="build/src/index.d.ts",$fe={type:"git",url:"https://github.com/vega/vega-themes.git"},Dfe={prepare:"beemo create-config --silent",clean:"rm -rf build examples/build",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint 'src/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",prebuild:"mkdir -p build",build:"tsc && rollup -c",postbuild:"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'yarn serve' 'tsc -w' 'rollup -c -w'"},Rfe={"@rollup/plugin-json":"^4.0.2","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",rollup:"^2.1.0",terser:"^4.6.7",typescript:"^3.8.3",vega:"^5.10.0","vega-lite":"^4.8.1","vega-lite-dev-config":"^0.5.0"},Ffe={vega:"*","vega-lite":"*"},Nfe={module:"vega-lite-dev-config",drivers:["prettier","eslint"]};var Ife={name:yfe,version:bfe,description:wfe,keywords:xfe,license:Efe,author:kfe,contributors:_fe,main:Afe,module:Sfe,unpkg:Ofe,jsdelivr:Tfe,typings:Cfe,repository:$fe,scripts:Dfe,devDependencies:Rfe,peerDependencies:Ffe,beemo:Nfe};const xf="#fff",Mfe="#888",jfe={background:"#333",title:{color:xf},style:{"guide-label":{fill:xf},"guide-title":{fill:xf}},axis:{domainColor:xf,gridColor:Mfe,tickColor:xf}},fs="#4572a7",Lfe={background:"#fff",arc:{fill:fs},area:{fill:fs},line:{stroke:fs,strokeWidth:2},path:{stroke:fs},rect:{fill:fs},shape:{stroke:fs},symbol:{fill:fs,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},ds="#30a2da",lE="#cbcbcb",Pfe="#999",zfe="#333",A3="#f0f0f0",S3="#333",Bfe={arc:{fill:ds},area:{fill:ds},axis:{domainColor:lE,grid:!0,gridColor:lE,gridWidth:1,labelColor:Pfe,labelFontSize:10,titleColor:zfe,tickColor:lE,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:A3,group:{fill:A3},legend:{labelColor:S3,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:S3,titleFontSize:14,titlePadding:10},line:{stroke:ds,strokeWidth:2},path:{stroke:ds,strokeWidth:.5},rect:{fill:ds},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:ds},bar:{binSpacing:2,fill:ds,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},hs="#000",Ufe={group:{fill:"#e5e5e5"},arc:{fill:hs},area:{fill:hs},line:{stroke:hs},path:{stroke:hs},rect:{fill:hs},shape:{stroke:hs},symbol:{fill:hs,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},qfe=22,Wfe="normal",O3="Benton Gothic, sans-serif",T3=11.5,Gfe="normal",ps="#82c6df",uE="Benton Gothic Bold, sans-serif",C3="normal",$3=13,Ef={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Hfe={background:"#ffffff",title:{anchor:"start",color:"#000000",font:uE,fontSize:qfe,fontWeight:Wfe},arc:{fill:ps},area:{fill:ps},line:{stroke:ps,strokeWidth:2},path:{stroke:ps},rect:{fill:ps},shape:{stroke:ps},symbol:{fill:ps,size:30},axis:{labelFont:O3,labelFontSize:T3,labelFontWeight:Gfe,titleFont:uE,titleFontSize:$3,titleFontWeight:C3},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:O3,labelFontSize:T3,symbolType:"square",titleFont:uE,titleFontSize:$3,titleFontWeight:C3},range:{category:Ef["category-6"],diverging:Ef["fireandice-6"],heatmap:Ef["fire-7"],ordinal:Ef["fire-7"],ramp:Ef["fire-7"]}},gs="#ab5787",Em="#979797",Yfe={background:"#f9f9f9",arc:{fill:gs},area:{fill:gs},line:{stroke:gs},path:{stroke:gs},rect:{fill:gs},shape:{stroke:gs},symbol:{fill:gs,size:30},axis:{domainColor:Em,domainWidth:.5,gridWidth:.2,labelColor:Em,tickColor:Em,tickWidth:.2,titleColor:Em},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},ms="#3e5c69",Vfe={background:"#fff",arc:{fill:ms},area:{fill:ms},line:{stroke:ms},path:{stroke:ms},rect:{fill:ms},shape:{stroke:ms},symbol:{fill:ms},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},si="#1696d2",D3="#000000",Xfe="#FFFFFF",km="Lato",cE="Lato",Jfe="Lato",Kfe="#DEDDDD",Qfe=18,kf={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Zfe={background:Xfe,title:{anchor:"start",fontSize:Qfe,font:km},axisX:{domain:!0,domainColor:D3,domainWidth:1,grid:!1,labelFontSize:12,labelFont:cE,labelAngle:0,tickColor:D3,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:km},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Kfe,gridWidth:1,labelFontSize:12,labelFont:cE,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:km,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:cE,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:km,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:kf["six-groups-cat-1"],diverging:kf["diverging-colors"],heatmap:kf["diverging-colors"],ordinal:kf["six-groups-seq"],ramp:kf["shades-blue"]},area:{fill:si},rect:{fill:si},line:{color:si,stroke:si,strokeWidth:5},trail:{color:si,stroke:si,strokeWidth:0,size:1},path:{stroke:si,strokeWidth:.5},point:{filled:!0},text:{font:Jfe,color:si,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:si,stroke:null}},arc:{fill:si},shape:{stroke:si},symbol:{fill:si,size:30}},vs="#3366CC",R3="#ccc",_m="Arial, sans-serif",ede={arc:{fill:vs},area:{fill:vs},path:{stroke:vs},rect:{fill:vs},shape:{stroke:vs},symbol:{stroke:vs},circle:{fill:vs},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:_m,fontSize:12},"guide-title":{font:_m,fontSize:12},"group-title":{font:_m,fontSize:12}},title:{font:_m,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:R3,tickColor:R3,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},tde=Ife.version;var nde=Object.freeze({__proto__:null,version:tde,dark:jfe,excel:Lfe,fivethirtyeight:Bfe,ggplot2:Ufe,latimes:Hfe,quartz:Yfe,vox:Vfe,urbaninstitute:Zfe,googlecharts:ede}),ide=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const F3="vg-tooltip-element",rde={offsetX:10,offsetY:10,id:F3,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:ade,maxDepth:2};function ade(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function ode(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return ide.toString().replace(F3,e)}var sde=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function lde(e,t,n){if(I(e))return`[${e.map(i=>t(Y(i)?i:N3(i,n))).join(", ")}]`;if(K(e)){let i="";const r=e,{title:a,image:o}=r,s=sde(r,["title","image"]);a&&(i+=`<h2>${t(a)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){i+="<table>";for(const u of l){let c=s[u];if(c===void 0)continue;K(c)&&(c=N3(c,n)),i+=`<tr><td class="key">${t(u)}:</td><td class="value">${t(c)}</td></tr>`}i+="</table>"}return i||"{}"}return t(e)}function ude(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function N3(e,t){return JSON.stringify(e,ude(t))}function cde(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let a=e.clientY+i;return a+t.height>window.innerHeight&&(a=+e.clientY-i-t.height),{x:r,y:a}}class fde{constructor(e){this.options=Object.assign(Object.assign({},rde),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=ode(t);const i=document.head;i.childNodes.length>0?i.insertBefore(n,i.childNodes[0]):i.appendChild(n)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,i){if(i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=lde(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:a}=cde(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${r}px`)}}function dde(e,t,n){const i=e.open(t),r=1e4,a=250,{origin:o}=new URL(t);let s=~~(r/a);function l(c){c.source===i&&(s=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function u(){if(s<=0)return;i.postMessage(n,o),setTimeout(u,a),s-=1}setTimeout(u,a)}var hde=`.vega-embed {
  position: relative;
  display: inline-block; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: scroll;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function I3(e,...t){for(const n of t)pde(e,n);return e}function pde(e,t){for(const n of Object.keys(t))Uf(e,n,t[n],!0)}var fE;const ys=Sne;let _f=mfe;const Am=typeof window!="undefined"?window:void 0;_f===void 0&&((fE=Am==null?void 0:Am.vl)===null||fE===void 0?void 0:fE.compile)&&(_f=Am.vl);const gde={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},mde={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Af={vega:"Vega","vega-lite":"Vega-Lite"},Sm={vega:ys.version,"vega-lite":_f?_f.version:"not available"},vde={vega:e=>e,"vega-lite":(e,t)=>_f.compile(e,{config:t}).spec},yde=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`;function bde(e){return typeof e=="function"}function M3(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+e+a),o.document.title=`${Af[i]} JSON Source`}function wde(e,t){var n;if(e.$schema){const i=_3(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${Af[i.library]}, but mode argument sets ${(n=Af[t])!==null&&n!==void 0?n:t}.`);const r=i.library;return DE.satisfies(Sm[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${Af[r]} ${i.version}, but the current version of ${Af[r]} is v${Sm[r]}.`),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function xde(e){return!!(e&&"load"in e)}function Ede(e,t,n={}){var i,r,a;return Sf(this,void 0,void 0,function*(){const o=xde(n.loader)?n.loader:ys.loader(n.loader),s=Y(t)?JSON.parse(yield o.load(t)):t,l=yield j3((i=s.usermeta&&s.usermeta.embedOptions)!==null&&i!==void 0?i:{},o),u=yield j3(n,o),c=Object.assign(Object.assign({},I3(u,l)),{config:Jl((r=u.config)!==null&&r!==void 0?r:{},(a=l.config)!==null&&a!==void 0?a:{})});return yield kde(e,s,c,o)})}function j3(e,t){var n;return Sf(this,void 0,void 0,function*(){const i=Y(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},r=Y(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),r?{patch:r}:{}),i?{config:i}:{})})}function kde(e,t,n={},i){var r,a,o,s,l,u;return Sf(this,void 0,void 0,function*(){const c=n.theme?Jl(nde[n.theme],(r=n.config)!==null&&r!==void 0?r:{}):n.config,f=no(n.actions)?n.actions:I3({},gde,(a=n.actions)!==null&&a!==void 0?a:{}),d=Object.assign(Object.assign({},mde),n.i18n),h=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(s=n.logLevel)!==null&&s!==void 0?s:ys.Warn,g=(l=n.downloadFileName)!==null&&l!==void 0?l:"visualization";if(n.defaultStyle!==!1){const _="vega-embed-style";if(!document.getElementById(_)){const O=document.createElement("style");O.id=_,O.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?hde.toString():n.defaultStyle,document.head.appendChild(O)}}const m=wde(t,n.mode);let v=vde[m](t,c);if(m==="vega-lite"&&v.$schema){const _=_3(v.$schema);DE.satisfies(Sm.vega,`^${_.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${_.version}, but current version is v${Sm.vega}.`)}const y=typeof e=="string"?document.querySelector(e):e;if(!y)throw Error(`${e} does not exist`);y.classList.add("vega-embed"),f&&y.classList.add("has-actions"),y.innerHTML="";const b=n.patch;b&&(b instanceof Function?v=b(v):v=Tf(v,b,!0,!1).newDocument),n.formatLocale&&ys.formatLocale(n.formatLocale),n.timeFormatLocale&&ys.timeFormatLocale(n.timeFormatLocale);const E=ys.parse(v,m==="vega-lite"?{}:c),x=new ys.View(E,{loader:i,logLevel:p,renderer:h});if(n.tooltip!==!1){let _;bde(n.tooltip)?_=n.tooltip:_=new fde(n.tooltip===!0?{}:n.tooltip).call,x.tooltip(_)}let{hover:k}=n;if(k===void 0&&(k=m==="vega"),k){const{hoverSet:_,updateSet:O}=typeof k=="boolean"?{}:k;x.hover(_,O)}n&&(n.width!=null&&x.width(n.width),n.height!=null&&x.height(n.height),n.padding!=null&&x.padding(n.padding)),yield x.initialize(e).runAsync();let w;if(f!==!1){let _=y;if(n.defaultStyle!==!1){const S=document.createElement("details");S.title=d.CLICK_TO_VIEW_ACTIONS,y.append(S),_=S;const T=document.createElement("summary");T.innerHTML=yde,S.append(T),w=D=>{S.contains(D.target)||S.removeAttribute("open")},document.addEventListener("click",w)}const O=document.createElement("div");if(_.append(O),O.classList.add("vega-actions"),f===!0||f.export!==!1){for(const S of["svg","png"])if(f===!0||f.export===!0||f.export[S]){const T=d[`${S.toUpperCase()}_ACTION`],D=document.createElement("a");D.text=T,D.href="#",D.target="_blank",D.download=`${g}.${S}`,D.addEventListener("mousedown",function(M){return Sf(this,void 0,void 0,function*(){M.preventDefault();const C=yield x.toImageURL(S,n.scaleFactor);this.href=C})}),O.append(D)}}if(f===!0||f.source!==!1){const S=document.createElement("a");S.text=d.SOURCE_ACTION,S.href="#",S.addEventListener("click",function(T){var D,M;M3(Im(t),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(M=n.sourceFooter)!==null&&M!==void 0?M:"",m),T.preventDefault()}),O.append(S)}if(m==="vega-lite"&&(f===!0||f.compiled!==!1)){const S=document.createElement("a");S.text=d.COMPILED_ACTION,S.href="#",S.addEventListener("click",function(T){var D,M;M3(Im(v),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(M=n.sourceFooter)!==null&&M!==void 0?M:"","vega"),T.preventDefault()}),O.append(S)}if(f===!0||f.editor!==!1){const S=(u=n.editorUrl)!==null&&u!==void 0?u:"https://vega.github.io/editor/",T=document.createElement("a");T.text=d.EDITOR_ACTION,T.href="#",T.addEventListener("click",function(D){dde(window,S,{config:c,mode:m,renderer:h,spec:Im(t)}),D.preventDefault()}),O.append(T)}}function A(){w&&document.removeEventListener("click",w),x.finalize()}return{view:x,spec:t,vgSpec:v,finalize:A}})}export default Ede;
