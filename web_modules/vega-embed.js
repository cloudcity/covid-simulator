import{c as Tm,g as P3}from"./common/_commonjsHelpers-be8ed69f.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Z(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Of(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function s(c){try{u(i.next(c))}catch(f){o(f)}}function l(c){try{u(i.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):r(c.value).then(s,l)}u((i=i.apply(e,t||[])).next())})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var z3=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i())}}(),B3=Object.prototype.hasOwnProperty;function Cm(e,t){return B3.call(e,t)}function $m(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var i in e)Cm(e,i)&&t.push(i);return t}function $n(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Dm(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Ja(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function pE(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Rm(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Rm(e[t]))return!0}else if(typeof e=="object"){for(var i=$m(e),r=i.length,t=0;t<r;t++)if(Rm(e[i[t]]))return!0}}return!1}function gE(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var mE=function(e){z3(t,e);function t(n,i,r,a,o){var s=this.constructor,l=e.call(this,gE(n,{name:i,index:r,operation:a,tree:o}))||this;return l.name=i,l.index=r,l.operation=a,l.tree=o,Object.setPrototypeOf(l,s.prototype),l.message=gE(n,{name:i,index:r,operation:a,tree:o}),l}return t}(Error),Qe=mE,U3=$n,ws={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Tf(n,this.path);i&&(i=$n(i));var r=Ka(n,{op:"remove",path:this.from}).removed;return Ka(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Tf(n,this.from);return Ka(n,{op:"add",path:this.path,value:$n(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ul(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},q3={add:function(e,t,n){return Dm(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:ws.move,copy:ws.copy,test:ws.test,_get:ws._get};function Tf(e,t){if(t=="")return e;var n={op:"_get",path:t};return Ka(e,n),n.value}function Ka(e,t,n,i,r,a){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),a===void 0&&(a=0),n&&(typeof n=="function"?n(t,0,e,t.path):$f(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Tf(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Ul(e,t.value),o.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}}else{i||(e=$n(e));var s=t.path||"",l=s.split("/"),u=e,c=1,f=l.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=$f;;){if(h=l[c],r&&h=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&(d===void 0&&(u[h]===void 0?d=l.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d))),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(n&&!Dm(h))throw new Qe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Dm(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>u.length)throw new Qe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var o=q3[t.op].call(t,u,h,e);if(o.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&h.indexOf("~")!=-1&&(h=pE(h)),c>=f){var o=ws[t.op].call(t,u,h,e);if(o.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}u=u[h]}}}function Cf(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new Qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=$n(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=Ka(e,t[o],n,!0,r,o),e=a[o].newDocument;return a.newDocument=e,a}function W3(e,t,n){var i=Ka(e,t);if(i.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function $f(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new Qe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ws[e.op]){if(typeof e.path!="string")throw new Qe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Qe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Qe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Rm(e.value))throw new Qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,a=i.split("/").length;if(r!==a+1&&r!==a)throw new Qe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new Qe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},s=vE([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new Qe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function vE(e,t,n){try{if(!Array.isArray(e))throw new Qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Cf($n(t),$n(e),n||!0);else{n=n||$f;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof Qe)return r;throw r}}function Ul(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,a,o;if(n&&i){if(a=e.length,a!=t.length)return!1;for(r=a;r--!==0;)if(!Ul(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var s=Object.keys(e);if(a=s.length,a!==Object.keys(t).length)return!1;for(r=a;r--!==0;)if(!t.hasOwnProperty(s[r]))return!1;for(r=a;r--!==0;)if(o=s[r],!Ul(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var G3=Object.freeze({__proto__:null,JsonPatchError:Qe,deepClone:U3,getValueByPointer:Tf,applyOperation:Ka,applyPatch:Cf,applyReducer:W3,validator:$f,validate:vE,_areEquals:Ul});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Fm=new WeakMap(),H3=function(){function e(t){this.observers=new Map(),this.obj=t}return e}(),Y3=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function V3(e){return Fm.get(e)}function X3(e,t){return e.observers.get(t)}function J3(e,t){e.observers.delete(t.callback)}function K3(e,t){t.unobserve()}function Q3(e,t){var n=[],i,r=V3(e);if(!r)r=new H3(e),Fm.set(e,r);else{var a=X3(r,t);i=a&&a.observer}if(i)return i;if(i={},r.value=$n(e),t){i.callback=t,i.next=null;var o=function(){Nm(i)},s=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return i.patches=n,i.object=e,i.unobserve=function(){Nm(i),clearTimeout(i.next),J3(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new Y3(t,i)),i}function Nm(e,t){t===void 0&&(t=!1);var n=Fm.get(e.object);Im(n.value,e.object,e.patches,"",t),e.patches.length&&Cf(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Im(e,t,n,i,r){if(t===e)return;typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=$m(t),o=$m(e),s=!1,l=o.length-1;l>=0;l--){var u=o[l],c=e[u];if(Cm(t,u)&&!(t[u]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[u];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null?Im(c,f,n,i+"/"+Ja(u),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Ja(u),value:$n(c)}),n.push({op:"replace",path:i+"/"+Ja(u),value:$n(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Ja(u),value:$n(c)}),n.push({op:"remove",path:i+"/"+Ja(u)}),s=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!s&&a.length==o.length)return;for(var l=0;l<a.length;l++){var u=a[l];!Cm(e,u)&&t[u]!==void 0&&n.push({op:"add",path:i+"/"+Ja(u),value:$n(t[u])})}}function Z3(e,t,n){n===void 0&&(n=!1);var i=[];return Im(e,t,i,"",n),i}var eL=Object.freeze({__proto__:null,unobserve:K3,observe:Q3,generate:Nm,compare:Z3});Object.assign({},G3,eL,{JsonPatchError:mE,deepClone:$n,escapePathComponent:Ja,unescapePathComponent:pE});var tL=/("(?:[^\\"]|\\.)*")|[:,]/g,Mm=function(t,n){var i,r,a;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?Infinity:n.maxLength===void 0?80:n.maxLength,a=n.replacer,function o(s,l,u){var c,f,d,h,p,g,m,v,y,b,E,x;if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),E=JSON.stringify(s,a),E===void 0)return E;if(m=r-l.length-u,E.length<=m&&(y=E.replace(tL,function(k,w){return w||k+" "}),y.length<=m))return y;if(a!=null&&(s=JSON.parse(E),a=void 0),typeof s=="object"&&s!==null){if(v=l+i,d=[],f=0,Array.isArray(s))for(b="[",c="]",m=s.length;f<m;f++)d.push(o(s[f],v,f===m-1?0:1)||"null");else for(b="{",c="}",g=Object.keys(s),m=g.length;f<m;f++)h=g[f],p=JSON.stringify(h)+": ",x=o(s[h],v,p.length+(f===m-1?0:1)),x!==void 0&&d.push(p+x);if(d.length>0)return[b,i+d.join(`,
`+v),c].join(`
`+l)}return E}(t,"",0)};const nL="2.0.0",iL=256,rL=Number.MAX_SAFE_INTEGER||9007199254740991,aL=16;var Df={SEMVER_SPEC_VERSION:nL,MAX_LENGTH:iL,MAX_SAFE_INTEGER:rL,MAX_SAFE_COMPONENT_LENGTH:aL},Rf={title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},platform:"browser",release:{},config:{}};const oL=typeof Rf=="object"&&Rf.env&&Rf.env.NODE_DEBUG&&/\bsemver\b/i.test(Rf.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Oe=oL,Jr=Tm(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Df;t=e.exports={};const i=t.re=[],r=t.src=[],a=t.t={};let o=0;const s=(l,u,c)=>{const f=o++;Oe(f,u),a[l]=f,r[f]=u,i[f]=new RegExp(u,c?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${r[a.NUMERICIDENTIFIER]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${r[a.NUMERICIDENTIFIERLOOSE]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${r[a.PRERELEASEIDENTIFIER]}(?:\\.${r[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${r[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${r[a.BUILDIDENTIFIER]}(?:\\.${r[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${r[a.MAINVERSION]}${r[a.PRERELEASE]}?${r[a.BUILD]}?`),s("FULL",`^${r[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${r[a.MAINVERSIONLOOSE]}${r[a.PRERELEASELOOSE]}?${r[a.BUILD]}?`),s("LOOSE",`^${r[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${r[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${r[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:${r[a.PRERELEASE]})?${r[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:${r[a.PRERELEASELOOSE]})?${r[a.BUILD]}?)?)?`),s("XRANGE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",r[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${r[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${r[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${r[a.LONECARET]}${r[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${r[a.LONECARET]}${r[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${r[a.GTLT]}\\s*(${r[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]}|${r[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${r[a.XRANGEPLAIN]})\\s+-\\s+(${r[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${r[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${r[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});const yE=/^[0-9]+$/,bE=(e,t)=>{const n=yE.test(e),i=yE.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},sL=(e,t)=>bE(t,e);var jm={compareIdentifiers:bE,rcompareIdentifiers:sL};const{MAX_LENGTH:wE,MAX_SAFE_INTEGER:Ff}=Df,{re:xE,t:EE}=Jr,{compareIdentifiers:ql}=jm;class Ri{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ri){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>wE)throw new TypeError(`version is longer than ${wE} characters`);Oe("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?xE[EE.LOOSE]:xE[EE.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ff||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ff||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ff||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const r=+i;if(r>=0&&r<Ff)return r}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Oe("SemVer.compare",this.version,this.options,e),!(e instanceof Ri)){if(typeof e=="string"&&e===this.version)return 0;e=new Ri(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ri||(e=new Ri(e,this.options)),ql(this.major,e.major)||ql(this.minor,e.minor)||ql(this.patch,e.patch)}comparePre(e){if(e instanceof Ri||(e=new Ri(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(Oe("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return ql(n,i)}while(++t)}compareBuild(e){e instanceof Ri||(e=new Ri(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(Oe("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return ql(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Ze=Ri;const{MAX_LENGTH:lL}=Df,{re:kE,t:_E}=Jr,uL=(e,t)=>{if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ze)return e;if(typeof e!="string")return null;if(e.length>lL)return null;const n=t.loose?kE[_E.LOOSE]:kE[_E.FULL];if(!n.test(e))return null;try{return new Ze(e,t)}catch(i){return null}};var Qa=uL;const cL=(e,t)=>{const n=Qa(e,t);return n?n.version:null};var fL=cL;const dL=(e,t)=>{const n=Qa(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var hL=dL;const pL=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new Ze(e,n).inc(t,i).version}catch(r){return null}};var gL=pL;const mL=(e,t,n)=>new Ze(e,n).compare(new Ze(t,n));var Dn=mL;const vL=(e,t,n)=>Dn(e,t,n)===0;var Lm=vL;const yL=(e,t)=>{if(Lm(e,t))return null;{const n=Qa(e),i=Qa(t),r=n.prerelease.length||i.prerelease.length,a=r?"pre":"",o=r?"prerelease":"";for(const s in n)if((s==="major"||s==="minor"||s==="patch")&&n[s]!==i[s])return a+s;return o}};var bL=yL;const wL=(e,t)=>new Ze(e,t).major;var xL=wL;const EL=(e,t)=>new Ze(e,t).minor;var kL=EL;const _L=(e,t)=>new Ze(e,t).patch;var AL=_L;const SL=(e,t)=>{const n=Qa(e,t);return n&&n.prerelease.length?n.prerelease:null};var OL=SL;const TL=(e,t,n)=>Dn(t,e,n);var CL=TL;const $L=(e,t)=>Dn(e,t,!0);var DL=$L;const RL=(e,t,n)=>{const i=new Ze(e,n),r=new Ze(t,n);return i.compare(r)||i.compareBuild(r)};var Pm=RL;const FL=(e,t)=>e.sort((n,i)=>Pm(n,i,t));var NL=FL;const IL=(e,t)=>e.sort((n,i)=>Pm(i,n,t));var ML=IL;const jL=(e,t,n)=>Dn(e,t,n)>0;var Wl=jL;const LL=(e,t,n)=>Dn(e,t,n)<0;var Nf=LL;const PL=(e,t,n)=>Dn(e,t,n)!==0;var AE=PL;const zL=(e,t,n)=>Dn(e,t,n)>=0;var zm=zL;const BL=(e,t,n)=>Dn(e,t,n)<=0;var Bm=BL;const UL=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return Lm(e,n,i);case"!=":return AE(e,n,i);case">":return Wl(e,n,i);case">=":return zm(e,n,i);case"<":return Nf(e,n,i);case"<=":return Bm(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var If=UL;const{re:Mf,t:jf}=Jr,qL=(e,t)=>{if(e instanceof Ze)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(Mf[jf.COERCE]);else{let i;for(;(i=Mf[jf.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),Mf[jf.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;Mf[jf.COERCERTL].lastIndex=-1}return n===null?null:Qa(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var WL=qL;class Lf{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Lf)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Lf(e.raw,t);if(e instanceof Za)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=this.options.loose;e=e.trim();const n=t?Ft[Et.HYPHENRANGELOOSE]:Ft[Et.HYPHENRANGE];e=e.replace(n,iP(this.options.includePrerelease)),Oe("hyphen replace",e),e=e.replace(Ft[Et.COMPARATORTRIM],GL),Oe("comparator trim",e,Ft[Et.COMPARATORTRIM]),e=e.replace(Ft[Et.TILDETRIM],HL),e=e.replace(Ft[Et.CARETTRIM],YL),e=e.split(/\s+/).join(" ");const i=t?Ft[Et.COMPARATORLOOSE]:Ft[Et.COMPARATOR];return e.split(" ").map(r=>VL(r,this.options)).join(" ").split(/\s+/).map(r=>nP(r,this.options)).filter(this.options.loose?r=>!!r.match(i):()=>!0).map(r=>new Za(r,this.options))}intersects(e,t){if(!(e instanceof Lf))throw new TypeError("a Range is required");return this.set.some(n=>SE(n,t)&&e.set.some(i=>SE(i,t)&&n.every(r=>i.every(a=>r.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Ze(e,this.options)}catch(t){return!1}for(let t=0;t<this.set.length;t++)if(rP(this.set[t],e,this.options))return!0;return!1}}var cn=Lf;const{re:Ft,t:Et,comparatorTrimReplace:GL,tildeTrimReplace:HL,caretTrimReplace:YL}=Jr,SE=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every(a=>r.intersects(a,t)),r=i.pop();return n},VL=(e,t)=>(Oe("comp",e,t),e=KL(e,t),Oe("caret",e),e=XL(e,t),Oe("tildes",e),e=ZL(e,t),Oe("xrange",e),e=tP(e,t),Oe("stars",e),e),Gt=e=>!e||e.toLowerCase()==="x"||e==="*",XL=(e,t)=>e.trim().split(/\s+/).map(n=>JL(n,t)).join(" "),JL=(e,t)=>{const n=t.loose?Ft[Et.TILDELOOSE]:Ft[Et.TILDE];return e.replace(n,(i,r,a,o,s)=>{Oe("tilde",e,i,r,a,o,s);let l;return Gt(r)?l="":Gt(a)?l=`>=${r}.0.0 <${+r+1}.0.0-0`:Gt(o)?l=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:s?(Oe("replaceTilde pr",s),l=`>=${r}.${a}.${o}-${s} <${r}.${+a+1}.0-0`):l=`>=${r}.${a}.${o} <${r}.${+a+1}.0-0`,Oe("tilde return",l),l})},KL=(e,t)=>e.trim().split(/\s+/).map(n=>QL(n,t)).join(" "),QL=(e,t)=>{Oe("caret",e,t);const n=t.loose?Ft[Et.CARETLOOSE]:Ft[Et.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,(r,a,o,s,l)=>{Oe("caret",e,r,a,o,s,l);let u;return Gt(a)?u="":Gt(o)?u=`>=${a}.0.0${i} <${+a+1}.0.0-0`:Gt(s)?a==="0"?u=`>=${a}.${o}.0${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.0${i} <${+a+1}.0.0-0`:l?(Oe("replaceCaret pr",l),a==="0"?o==="0"?u=`>=${a}.${o}.${s}-${l} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}-${l} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s}-${l} <${+a+1}.0.0-0`):(Oe("no pr"),a==="0"?o==="0"?u=`>=${a}.${o}.${s}${i} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s} <${+a+1}.0.0-0`),Oe("caret return",u),u})},ZL=(e,t)=>(Oe("replaceXRanges",e,t),e.split(/\s+/).map(n=>eP(n,t)).join(" ")),eP=(e,t)=>{e=e.trim();const n=t.loose?Ft[Et.XRANGELOOSE]:Ft[Et.XRANGE];return e.replace(n,(i,r,a,o,s,l)=>{Oe("xRange",e,i,r,a,o,s,l);const u=Gt(a),c=u||Gt(o),f=c||Gt(s),d=f;return r==="="&&d&&(r=""),l=t.includePrerelease?"-0":"",u?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&d?(c&&(o=0),s=0,r===">"?(r=">=",c?(a=+a+1,o=0,s=0):(o=+o+1,s=0)):r==="<="&&(r="<",c?a=+a+1:o=+o+1),r==="<"&&(l="-0"),i=`${r+a}.${o}.${s}${l}`):c?i=`>=${a}.0.0${l} <${+a+1}.0.0-0`:f&&(i=`>=${a}.${o}.0${l} <${a}.${+o+1}.0-0`),Oe("xRange return",i),i})},tP=(e,t)=>(Oe("replaceStars",e,t),e.trim().replace(Ft[Et.STAR],"")),nP=(e,t)=>(Oe("replaceGTE0",e,t),e.trim().replace(Ft[t.includePrerelease?Et.GTE0PRE:Et.GTE0],"")),iP=e=>(t,n,i,r,a,o,s,l,u,c,f,d,h)=>(Gt(i)?n="":Gt(r)?n=`>=${i}.0.0${e?"-0":""}`:Gt(a)?n=`>=${i}.${r}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,Gt(u)?l="":Gt(c)?l=`<${+u+1}.0.0-0`:Gt(f)?l=`<${u}.${+c+1}.0-0`:d?l=`<=${u}.${c}.${f}-${d}`:e?l=`<${u}.${c}.${+f+1}-0`:l=`<=${l}`,`${n} ${l}`.trim()),rP=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let i=0;i<e.length;i++){if(Oe(e[i].semver),e[i].semver===Za.ANY)continue;if(e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}}return!1}return!0},Gl=Symbol("SemVer ANY");class Um{static get ANY(){return Gl}constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Um){if(e.loose===!!t.loose)return e;e=e.value}Oe("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Gl?this.value="":this.value=this.operator+this.semver.version,Oe("comp",this)}parse(e){const t=this.options.loose?OE[TE.COMPARATORLOOSE]:OE[TE.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ze(n[2],this.options.loose):this.semver=Gl}toString(){return this.value}test(e){if(Oe("Comparator.test",e,this.options.loose),this.semver===Gl||e===Gl)return!0;if(typeof e=="string")try{e=new Ze(e,this.options)}catch(t){return!1}return If(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Um))throw new TypeError("a Comparator is required");if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new cn(e.value,t).test(this.value);if(e.operator==="")return e.value===""?!0:new cn(this.value,t).test(e.semver);const n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),r=this.semver.version===e.semver.version,a=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),o=If(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),s=If(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||i||r&&a||o||s}}var Za=Um;const{re:OE,t:TE}=Jr,aP=(e,t,n)=>{try{t=new cn(t,n)}catch(i){return!1}return t.test(e)};var Kr=aP;const oP=(e,t)=>new cn(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var sP=oP;const lP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new cn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===-1)&&(i=o,r=new Ze(i,n)))}),i};var uP=lP;const cP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new cn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===1)&&(i=o,r=new Ze(i,n)))}),i};var fP=cP;const dP=(e,t)=>{e=new cn(e,t);let n=new Ze("0.0.0");if(e.test(n))return n;if(n=new Ze("0.0.0-0"),e.test(n))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];r.forEach(a=>{const o=new Ze(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!n||Wl(n,o))&&(n=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}})}return n&&e.test(n)?n:null};var hP=dP;const pP=(e,t)=>{try{return new cn(e,t).range||"*"}catch(n){return null}};var gP=pP;const{ANY:mP}=Za,vP=(e,t,n,i)=>{e=new Ze(e,i),t=new cn(t,i);let r,a,o,s,l;switch(n){case">":r=Wl,a=Bm,o=Nf,s=">",l=">=";break;case"<":r=Nf,a=zm,o=Wl,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Kr(e,t,i))return!1;for(let u=0;u<t.set.length;++u){const c=t.set[u];let f=null,d=null;if(c.forEach(h=>{h.semver===mP&&(h=new Za(">=0.0.0")),f=f||h,d=d||h,r(h.semver,f.semver,i)?f=h:o(h.semver,d.semver,i)&&(d=h)}),f.operator===s||f.operator===l)return!1;if((!d.operator||d.operator===s)&&a(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};var qm=vP;const yP=(e,t,n)=>qm(e,t,">",n);var bP=yP;const wP=(e,t,n)=>qm(e,t,"<",n);var xP=wP;const EP=(e,t,n)=>(e=new cn(e,n),t=new cn(t,n),e.intersects(t));var kP=EP,_P=(e,t,n)=>{const i=[];let r=null,a=null;const o=e.sort((c,f)=>Dn(c,f,n));for(const c of o){const f=Kr(c,t,n);f?(a=c,r||(r=c)):(a&&i.push([r,a]),a=null,r=null)}r&&i.push([r,null]);const s=[];for(const[c,f]of i)c===f?s.push(c):!f&&c===o[0]?s.push("*"):f?c===o[0]?s.push(`<=${f}`):s.push(`${c} - ${f}`):s.push(`>=${c}`);const l=s.join(" || "),u=typeof t.raw=="string"?t.raw:String(t);return l.length<u.length?l:t};const{ANY:CE}=Za,AP=(e,t,n)=>{e=new cn(e,n),t=new cn(t,n);let i=!1;e:for(const r of e.set){for(const a of t.set){const o=SP(r,a,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},SP=(e,t,n)=>{if(e.length===1&&e[0].semver===CE)return t.length===1&&t[0].semver===CE;const i=new Set();let r,a;for(const f of e)f.operator===">"||f.operator===">="?r=$E(r,f,n):f.operator==="<"||f.operator==="<="?a=DE(a,f,n):i.add(f.semver);if(i.size>1)return null;let o;if(r&&a){if(o=Dn(r.semver,a.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||a.operator!=="<="))return null}for(const f of i){if(r&&!Kr(f,String(r),n))return null;if(a&&!Kr(f,String(a),n))return null;for(const d of t)if(!Kr(f,String(d),n))return!1;return!0}let s,l,u,c;for(const f of t){if(c=c||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",r){if(f.operator===">"||f.operator===">="){if(s=$E(r,f,n),s===f)return!1}else if(r.operator===">="&&!Kr(r.semver,String(f),n))return!1}if(a){if(f.operator==="<"||f.operator==="<="){if(l=DE(a,f,n),l===f)return!1}else if(a.operator==="<="&&!Kr(a.semver,String(f),n))return!1}if(!f.operator&&(a||r)&&o!==0)return!1}return r&&u&&!a&&o!==0?!1:!(a&&c&&!r&&o!==0)},$E=(e,t,n)=>{if(!e)return t;const i=Dn(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},DE=(e,t,n)=>{if(!e)return t;const i=Dn(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var OP=AP,RE={re:Jr.re,src:Jr.src,tokens:Jr.t,SEMVER_SPEC_VERSION:Df.SEMVER_SPEC_VERSION,SemVer:Ze,compareIdentifiers:jm.compareIdentifiers,rcompareIdentifiers:jm.rcompareIdentifiers,parse:Qa,valid:fL,clean:hL,inc:gL,diff:bL,major:xL,minor:kL,patch:AL,prerelease:OL,compare:Dn,rcompare:CL,compareLoose:DL,compareBuild:Pm,sort:NL,rsort:ML,gt:Wl,lt:Nf,eq:Lm,neq:AE,gte:zm,lte:Bm,cmp:If,coerce:WL,Comparator:Za,Range:cn,satisfies:Kr,toComparators:sP,maxSatisfying:uP,minSatisfying:fP,minVersion:hP,validRange:gP,outside:qm,gtr:bP,ltr:xP,intersects:kP,simplifyRange:_P,subset:OP};function gr(e,t,n){return e.fields=t||[],e.fname=n,e}function TP(e){return e==null?null:e.fname}function FE(e){return e==null?null:e.fields}function NE(e){return e.length===1?CP(e[0]):$P(e)}const CP=e=>function(t){return t[e]},$P=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function Pf(e){throw Error(e)}function Wm(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||Pf("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&Pf("Access path missing closing bracket: "+e),n&&Pf("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Gm(e,t,n){const i=Wm(e);return e=i.length===1?i[0]:e,gr((n&&n.get||NE)(i),[e],t||e)}var Hl=[],DP=Gm("id"),Hm=gr(function(e){return e},Hl,"identity"),RP=gr(function(){return 0},Hl,"zero"),FP=gr(function(){return 1},Hl,"one"),NP=gr(function(){return!0},Hl,"true"),IP=gr(function(){return!1},Hl,"false");function zf(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var IE=0,ME=1,jE=2,LE=3,PE=4;function MP(e,t){var n=e||IE;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=ME&&zf(t||"error","ERROR",arguments),this},warn:function(){return n>=jE&&zf(t||"warn","WARN",arguments),this},info:function(){return n>=LE&&zf(t||"log","INFO",arguments),this},debug:function(){return n>=PE&&zf(t||"log","DEBUG",arguments),this}}}var Bf=Array.isArray;function Uf(e){return e===Object(e)}const zE=e=>e!=="__proto__";function jP(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=LP(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;qf(t,i,n[i],r)}return t},{})}function qf(e,t,n,i){if(!zE(t))return;var r,a;if(Uf(n)&&!Bf(n)){a=Uf(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?qf(a,r,n[r]):zE(r)&&(a[r]=n[r])}else e[t]=n}function LP(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function xs(e){return e[e.length-1]}function Ym(e){return e==null||e===""?null:+e}function BE(e){return function(t){return e*Math.exp(t)}}function UE(e){return function(t){return Math.log(e*t)}}function qE(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function WE(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Wf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Gf(e,t,n,i){var r=n(e[0]),a=n(xs(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function PP(e,t){return Gf(e,t,Ym,Hm)}function zP(e,t){var n=Math.sign(e[0]);return Gf(e,t,UE(n),BE(n))}function BP(e,t,n){return Gf(e,t,Wf(n),Wf(1/n))}function UP(e,t,n){return Gf(e,t,qE(n),WE(n))}function Hf(e,t,n,i,r){var a=i(e[0]),o=i(xs(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function qP(e,t,n){return Hf(e,t,n,Ym,Hm)}function WP(e,t,n){var i=Math.sign(e[0]);return Hf(e,t,n,UE(i),BE(i))}function GP(e,t,n,i){return Hf(e,t,n,Wf(i),Wf(1/i))}function HP(e,t,n,i){return Hf(e,t,n,qE(i),WE(i))}function YP(e){return 1+~~(new Date(e).getMonth()/3)}function VP(e){return 1+~~(new Date(e).getUTCMonth()/3)}function Yl(e){return e!=null?Bf(e)?e:[e]:[]}function XP(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function Vm(e){return typeof e=="function"}const JP="descending";function KP(e,t,n){n=n||{},t=Yl(t)||[];const i=[],r=[],a={},o=n.comparator||QP;return Yl(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===JP?-1:1),r.push(s=Vm(s)?s:Gm(s,null,n)),(FE(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:gr(o(r,i),Object.keys(a))}const GE=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,QP=(e,t)=>e.length===1?ZP(e[0],t[0]):ez(e,t,e.length),ZP=(e,t)=>function(n,i){return GE(e(n),e(i))*t},ez=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=GE(a(i),a(r));return o*t[s]});function tz(e){return Vm(e)?e:function(){return e}}function nz(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function HE(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function iz(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function rz(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const az=Object.prototype.hasOwnProperty;function eo(e,t){return az.call(e,t)}var Yf={};function oz(e){var t={},n,i;function r(a){return eo(t,a)&&t[a]!==Yf}return n={size:0,empty:0,object:t,has:r,get(a){return r(a)?t[a]:void 0},set(a,o){return r(a)||(++n.size,t[a]===Yf&&--n.empty),t[a]=o,this},delete(a){return r(a)&&(--n.size,++n.empty,t[a]=Yf),this},clear(){n.size=n.empty=0,n.object=t={}},test(a){return arguments.length?(i=a,n):i},clean(){var a={},o=0,s,l;for(s in t)l=t[s],l!==Yf&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function sz(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=xs(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function lz(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function uz(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function cz(e){return typeof e=="boolean"}function YE(e){return Object.prototype.toString.call(e)==="[object Date]"}function VE(e){return typeof e=="number"}function fz(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function XE(e){return typeof e=="string"}function dz(e,t,n){e&&(e=t?Yl(e).map(s=>s.replace(/\\(.)/g,"$1")):Yl(e));const i=e&&e.length,r=n&&n.get||NE,a=s=>r(t?[s]:Wm(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return gr(o,e,"key")}function hz(e,t){const n=e[0],i=xs(e),r=+t;return r?r===1?i:n+r*(i-n):n}const pz=1e4;function gz(e){e=+e||pz;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>eo(t,o)||eo(n,o),get:o=>eo(t,o)?t[o]:eo(n,o)?a(o,n[o]):void 0,set:(o,s)=>eo(t,o)?t[o]=s:a(o,s)}}function mz(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function Vl(e,t){for(var n="";--t>=0;)n+=e;return n}function vz(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?Vl(r,o)+a:i==="center"?Vl(r,~~(o/2))+a+Vl(r,Math.ceil(o/2)):a+Vl(r,o)}function yz(e){return e&&xs(e)-e[0]||0}function JE(e){return Bf(e)?"["+e.map(JE)+"]":Uf(e)||XE(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function bz(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function wz(e){return VE(e)||YE(e)?e:Date.parse(e)}function xz(e,t){return t=t||wz,e==null||e===""?null:t(e)}function Ez(e){return e==null||e===""?null:e+""}function kz(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function _z(e,t,n,i){var r=i??"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function Az(e,t,n){if(e)if(t)for(var i=0,r=e.length,a;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}function Rn(e,t,n){return e.fields=t||[],e.fname=n,e}function et(e){return e==null?null:e.fname}function Ht(e){return e==null?null:e.fields}function KE(e){return e.length===1?Sz(e[0]):Oz(e)}const Sz=e=>function(t){return t[e]},Oz=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function F(e){throw Error(e)}function mr(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||F("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&F("Access path missing closing bracket: "+e),n&&F("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Fi(e,t,n){const i=mr(e);return e=i.length===1?i[0]:e,Rn((n&&n.get||KE)(i),[e],t||e)}var Xl=[],Vf=Fi("id"),Yt=Rn(function(e){return e},Xl,"identity"),to=Rn(function(){return 0},Xl,"zero"),Jl=Rn(function(){return 1},Xl,"one"),Ni=Rn(function(){return!0},Xl,"true"),no=Rn(function(){return!1},Xl,"false");function Xf(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var Tz=0,QE=1,ZE=2,Cz=3,$z=4;function ek(e,t){var n=e||Tz;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=QE&&Xf(t||"error","ERROR",arguments),this},warn:function(){return n>=ZE&&Xf(t||"warn","WARN",arguments),this},info:function(){return n>=Cz&&Xf(t||"log","INFO",arguments),this},debug:function(){return n>=$z&&Xf(t||"log","DEBUG",arguments),this}}}var I=Array.isArray;function K(e){return e===Object(e)}const tk=e=>e!=="__proto__";function Kl(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=Dz(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;Xm(t,i,n[i],r)}return t},{})}function Xm(e,t,n,i){if(!tk(t))return;var r,a;if(K(n)&&!I(n)){a=K(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?Xm(a,r,n[r]):tk(r)&&(a[r]=n[r])}else e[t]=n}function Dz(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function ve(e){return e[e.length-1]}function fn(e){return e==null||e===""?null:+e}function nk(e){return function(t){return e*Math.exp(t)}}function ik(e){return function(t){return Math.log(e*t)}}function rk(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function ak(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Jf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Kf(e,t,n,i){var r=n(e[0]),a=n(ve(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function Rz(e,t){return Kf(e,t,fn,Yt)}function Fz(e,t){var n=Math.sign(e[0]);return Kf(e,t,ik(n),nk(n))}function Nz(e,t,n){return Kf(e,t,Jf(n),Jf(1/n))}function Iz(e,t,n){return Kf(e,t,rk(n),ak(n))}function Qf(e,t,n,i,r){var a=i(e[0]),o=i(ve(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function ok(e,t,n){return Qf(e,t,n,fn,Yt)}function sk(e,t,n){var i=Math.sign(e[0]);return Qf(e,t,n,ik(i),nk(i))}function Jm(e,t,n,i){return Qf(e,t,n,Jf(i),Jf(1/i))}function lk(e,t,n,i){return Qf(e,t,n,rk(i),ak(i))}function Mz(e){return 1+~~(new Date(e).getMonth()/3)}function jz(e){return 1+~~(new Date(e).getUTCMonth()/3)}function G(e){return e!=null?I(e)?e:[e]:[]}function Lz(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function ge(e){return typeof e=="function"}const Pz="descending";function uk(e,t,n){n=n||{},t=G(t)||[];const i=[],r=[],a={},o=n.comparator||zz;return G(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===Pz?-1:1),r.push(s=ge(s)?s:Fi(s,null,n)),(Ht(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:Rn(o(r,i),Object.keys(a))}const ck=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,zz=(e,t)=>e.length===1?Bz(e[0],t[0]):Uz(e,t,e.length),Bz=(e,t)=>function(n,i){return ck(e(n),e(i))*t},Uz=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=ck(a(i),a(r));return o*t[s]});function Vt(e){return ge(e)?e:function(){return e}}function fk(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function fe(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function vr(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function qz(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const Wz=Object.prototype.hasOwnProperty;function Q(e,t){return Wz.call(e,t)}var Zf={};function Ql(e){var t={},n,i;function r(a){return Q(t,a)&&t[a]!==Zf}return n={size:0,empty:0,object:t,has:r,get:function(a){return r(a)?t[a]:void 0},set:function(a,o){return r(a)||(++n.size,t[a]===Zf&&--n.empty),t[a]=o,this},delete:function(a){return r(a)&&(--n.size,++n.empty,t[a]=Zf),this},clear:function(){n.size=n.empty=0,n.object=t={}},test:function(a){return arguments.length?(i=a,n):i},clean:function(){var a={},o=0,s,l;for(s in t)l=t[s],l!==Zf&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function Gz(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=ve(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function P(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function Zl(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function io(e){return typeof e=="boolean"}function ro(e){return Object.prototype.toString.call(e)==="[object Date]"}function Re(e){return typeof e=="number"}function Hz(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function dk(e,t,n){e&&(e=t?G(e).map(s=>s.replace(/\\(.)/g,"$1")):G(e));const i=e&&e.length,r=n&&n.get||KE,a=s=>r(t?[s]:mr(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return Rn(o,e,"key")}function Yz(e,t){const n=e[0],i=ve(e),r=+t;return r?r===1?i:n+r*(i-n):n}const Vz=1e4;function Xz(e){e=+e||Vz;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>Q(t,o)||Q(n,o),get:o=>Q(t,o)?t[o]:Q(n,o)?a(o,n[o]):void 0,set:(o,s)=>Q(t,o)?t[o]=s:a(o,s)}}function Jz(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function ed(e,t){for(var n="";--t>=0;)n+=e;return n}function Kz(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?ed(r,o)+a:i==="center"?ed(r,~~(o/2))+a+ed(r,Math.ceil(o/2)):a+ed(r,o)}function td(e){return e&&ve(e)-e[0]||0}function B(e){return I(e)?"["+e.map(B)+"]":K(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function hk(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function Qz(e){return Re(e)||ro(e)?e:Date.parse(e)}function pk(e,t){return t=t||Qz,e==null||e===""?null:t(e)}function gk(e){return e==null||e===""?null:e+""}function kt(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function Zz(e,t,n,i){var r=i??"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function ao(e,t,n){if(e){var i=0,r=e.length,a;if(t)for(;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}}function nd(e){var t=e||Yt,n=[],i={};return n.add=function(r){var a=t(r);return i[a]||(i[a]=1,n.push(r)),n},n.remove=function(r){var a=t(r),o;return i[a]&&(i[a]=0,(o=n.indexOf(r))>=0&&n.splice(o,1)),n},n}async function id(e,t){try{await t(e)}catch(n){e.error(n)}}var mk=Symbol("vega_id"),e5=1;function rd(e){return!!(e&&ee(e))}function ee(e){return e[mk]}function vk(e,t){return e[mk]=t,e}function ke(e){var t=e===Object(e)?e:{data:e};return ee(t)?t:vk(t,e5++)}function Km(e){return Qm(e,ke({}))}function Qm(e,t){for(var n in e)t[n]=e[n];return t}function yk(e,t){return vk(t,ee(e))}function oo(e,t){return e?t?(n,i)=>e(n,i)||ee(t(n))-ee(t(i)):(n,i)=>e(n,i)||ee(n)-ee(i):null}function bk(e){return e&&e.constructor===so}function so(){var e=[],t=[],n=[],i=[],r=[],a=null,o=!1;return{constructor:so,insert:function(s){for(var l=G(s),u=0,c=l.length;u<c;++u)e.push(l[u]);return this},remove:function(s){for(var l=ge(s)?i:t,u=G(s),c=0,f=u.length;c<f;++c)l.push(u[c]);return this},modify:function(s,l,u){var c={field:l,value:Vt(u)};return ge(s)?(c.filter=s,r.push(c)):(c.tuple=s,n.push(c)),this},encode:function(s,l){return ge(s)?r.push({filter:s,field:l}):n.push({tuple:s,field:l}),this},clean:function(s){return a=s,this},reflow:function(){return o=!0,this},pulse:function(s,l){var u={},c={},f,d,h,p,g,m;for(f=0,d=l.length;f<d;++f)u[ee(l[f])]=1;for(f=0,d=t.length;f<d;++f)g=t[f],u[ee(g)]=-1;for(f=0,d=i.length;f<d;++f)p=i[f],l.forEach(function(y){p(y)&&(u[ee(y)]=-1)});for(f=0,d=e.length;f<d;++f)g=e[f],m=ee(g),u[m]?u[m]=1:s.add.push(ke(e[f]));for(f=0,d=l.length;f<d;++f)g=l[f],u[ee(g)]<0&&s.rem.push(g);function v(y,b,E){E?y[b]=E(y):s.encode=b,o||(c[ee(y)]=y)}for(f=0,d=n.length;f<d;++f)h=n[f],g=h.tuple,p=h.field,m=u[ee(g)],m>0&&(v(g,p,h.value),s.modifies(p));for(f=0,d=r.length;f<d;++f)h=r[f],p=h.filter,l.forEach(function(y){p(y)&&u[ee(y)]>0&&v(y,h.field,h.value)}),s.modifies(h.field);if(o)s.mod=t.length||i.length?l.filter(function(y){return u[ee(y)]>0}):l.slice();else for(m in c)s.mod.push(c[m]);return(a||a==null&&(t.length||i.length))&&s.clean(!0),s}}}var ad="_:mod:_";function od(){Object.defineProperty(this,ad,{writable:!0,value:{}})}var Zm=od.prototype;Zm.set=function(e,t,n,i){var r=this,a=r[e],o=r[ad];return t!=null&&t>=0?(a[t]!==n||i)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||i)&&(r[e]=n,o[e]=I(n)?1+n.length:-1),r},Zm.modified=function(e,t){var n=this[ad],i;if(arguments.length){if(I(e)){for(i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},Zm.clear=function(){return this[ad]={},this};var t5=0,n5="pulse",i5=new od(),r5=1,a5=2;function Fe(e,t,n,i){this.id=++t5,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}var yr=Fe.prototype;yr.targets=function(){return this._targets||(this._targets=nd(Vf))},yr.set=function(e){return this.value!==e?(this.value=e,1):0};function wk(e){return function(t){var n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}yr.skip=wk(r5),yr.modified=wk(a5),yr.parameters=function(e,t,n){t=t!==!1;var i=this,r=i._argval=i._argval||new od(),a=i._argops=i._argops||[],o=[],s,l,u,c;function f(d,h,p){p instanceof Fe?(p!==i&&(t&&p.targets().add(i),o.push(p)),a.push({op:p,name:d,index:h})):r.set(d,h,p)}for(s in e)if(l=e[s],s===n5)G(l).forEach(function(d){d instanceof Fe?d!==i&&(d.targets().add(i),o.push(d)):F("Pulse parameters must be operator instances.")}),i.source=l;else if(I(l))for(r.set(s,-1,Array(u=l.length)),c=0;c<u;++c)f(s,c,l[c]);else f(s,-1,l);return this.marshall().clear(),n&&(a.initonly=!0),o},yr.marshall=function(e){var t=this._argval||i5,n=this._argops,i,r,a,o,s;if(n){for(r=0,a=n.length;r<a;++r)i=n[r],o=i.op,s=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,s);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},yr.detach=function(){var e=this._argops,t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this)},yr.evaluate=function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},yr.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e};function o5(e,t,n,i){var r=1,a;return e instanceof Fe?a=e:e&&e.prototype instanceof Fe?a=new e():ge(e)?a=new Fe(null,e):(r=0,a=new Fe(e,t)),this.rank(a),r&&(i=n,n=t),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a}function s5(e,t){var n=e.rank,i,r;for(i=0,r=t.length;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}var l5=0;function sd(e,t,n){this.id=++l5,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Qr(e,t,n){return new sd(e,t,n)}var ci=sd.prototype;ci._filter=Ni,ci._apply=Yt,ci.targets=function(){return this._targets||(this._targets=nd(Vf))},ci.consume=function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},ci.receive=function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,i=n?n.length:0,r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},ci.filter=function(e){var t=Qr(e);return this.targets().add(t),t},ci.apply=function(e){var t=Qr(null,e);return this.targets().add(t),t},ci.merge=function(){var e=Qr();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},ci.throttle=function(e){var t=-1;return this.filter(function(){var n=Date.now();return n-t>e?(t=n,1):0})},ci.debounce=function(e){var t=Qr();return this.targets().add(Qr(null,null,fk(e,function(n){var i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},ci.between=function(e,t){var n=!1;return e.targets().add(Qr(null,null,function(){n=!0})),t.targets().add(Qr(null,null,function(){n=!1})),this.filter(function(){return n})};function u5(e,t,n,i){var r=this,a=Qr(n,i),o=function(c){c.dataflow=r;try{a.receive(c)}catch(f){r.error(f)}finally{r.run()}},s;typeof e=="string"&&typeof document!="undefined"?s=document.querySelectorAll(e):s=G(e);for(var l=0,u=s.length;l<u;++l)s[l].addEventListener(t,o);return a}const c5=/^([A-Za-z]+:)?\/\//,f5=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,d5=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,xk="file://";function h5(e,t){return function(n){return{options:n||{},sanitize:g5,load:p5,fileAccess:!!t,file:m5(t),http:y5(e)}}}async function p5(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function g5(e,t){t=fe({},this.options,t);const n=this.fileAccess,i={href:null};let r,a,o;const s=f5.test(e.replace(d5,""));(e==null||typeof e!="string"||!s)&&F("Sanitize failure, invalid URI: "+B(e));const l=c5.test(e);return(o=t.baseURL)&&!l&&(!e.startsWith("/")&&o[o.length-1]!=="/"&&(e="/"+e),e=o+e),a=(r=e.startsWith(xk))||t.mode==="file"||t.mode!=="http"&&!l&&n,r?e=e.slice(xk.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!a}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function m5(e){return e?function(t){return new Promise(function(n,i){e.readFile(t,function(r,a){r?i(r):n(a)})})}:v5}async function v5(){F("No file system access.")}function y5(e){return e?async function(t,n){const i=fe({},this.options.http,n),r=n&&n.response,a=await e(t,i);return a.ok?ge(a[r])?a[r]():a.text():F(a.status+""+a.statusText)}:b5}async function b5(){F("No HTTP fetch method available.")}var e0={boolean:hk,integer:fn,number:fn,date:pk,string:gk,unknown:Yt},ld=[E5,_5,_k,k5],w5=["boolean","integer","number","date"];function Ek(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=ld.length,r=ld.map((a,o)=>o+1);for(let a=0,o=0,s,l;a<n;++a)for(l=t?e[a][t]:e[a],s=0;s<i;++s)if(r[s]&&x5(l)&&!ld[s](l)&&(r[s]=0,++o,o===ld.length))return"string";return w5[r.reduce((a,o)=>a===0?o:a,0)-1]}function kk(e,t){return t.reduce(function(n,i){return n[i]=Ek(e,i),n},{})}function x5(e){return e!=null&&e===e}function E5(e){return e==="true"||e==="false"||e===!0||e===!1}function k5(e){return!Number.isNaN(Date.parse(e))}function _k(e){return!Number.isNaN(+e)&&!(e instanceof Date)}function _5(e){return _k(e)&&Number.isInteger(+e)}var Ak={},t0={},n0=34,eu=10,i0=13;function Sk(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function A5(e,t){var n=Sk(e);return function(i,r){return t(n(i),r,e)}}function Ok(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function dn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function S5(e){return e<0?"-"+dn(-e,6):e>9999?"+"+dn(e,6):dn(e,4)}function O5(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":S5(e.getUTCFullYear())+"-"+dn(e.getUTCMonth()+1,2)+"-"+dn(e.getUTCDate(),2)+(r?"T"+dn(t,2)+":"+dn(n,2)+":"+dn(i,2)+"."+dn(r,3)+"Z":i?"T"+dn(t,2)+":"+dn(n,2)+":"+dn(i,2)+"Z":n||t?"T"+dn(t,2)+":"+dn(n,2)+"Z":"")}function T5(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,p,g=r(f,function(m,v){if(h)return h(m,v-1);p=m,h=d?A5(m,d):Sk(m)});return g.columns=p||[],g}function r(f,d){var h=[],p=f.length,g=0,m=0,v,y=p<=0,b=!1;f.charCodeAt(p-1)===eu&&--p,f.charCodeAt(p-1)===i0&&--p;function E(){if(y)return t0;if(b)return b=!1,Ak;var k,w=g,A;if(f.charCodeAt(w)===n0){for(;g++<p&&f.charCodeAt(g)!==n0||f.charCodeAt(++g)===n0;);return(k=g)>=p?y=!0:(A=f.charCodeAt(g++))===eu?b=!0:A===i0&&(b=!0,f.charCodeAt(g)===eu&&++g),f.slice(w+1,k-1).replace(/""/g,'"')}for(;g<p;){if((A=f.charCodeAt(k=g++))===eu)b=!0;else if(A===i0)b=!0,f.charCodeAt(g)===eu&&++g;else if(A!==n)continue;return f.slice(w,k)}return y=!0,f.slice(w,p)}for(;(v=E())!==t0;){for(var x=[];v!==Ak&&v!==t0;)x.push(v),v=E();if(d&&(x=d(x,m++))==null)continue;h.push(x)}return h}function a(f,d){return f.map(function(h){return d.map(function(p){return c(h[p])}).join(e)})}function o(f,d){return d==null&&(d=Ok(f)),[d.map(c).join(e)].concat(a(f,d)).join(`
`)}function s(f,d){return d==null&&(d=Ok(f)),a(f,d).join(`
`)}function l(f){return f.map(u).join(`
`)}function u(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?O5(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:o,formatBody:s,formatRows:l,formatRow:u,formatValue:c}}function Tk(e){const t=function(n,i){const r={delimiter:e};return r0(n,i?fe(i,r):r)};return t.responseType="text",t}function r0(e,t){return t.header&&(e=t.header.map(B).join(t.delimiter)+`
`+e),T5(t.delimiter).parse(e+"")}r0.responseType="text";function C5(e){return typeof Buffer=="function"&&ge(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function a0(e,t){const n=t&&t.property?Fi(t.property):Yt;return K(e)&&!C5(e)?$5(n(e)):n(JSON.parse(e))}a0.responseType="json";function $5(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}function D5(e){return e}function R5(e){if(e==null)return D5;var t,n,i=e.scale[0],r=e.scale[1],a=e.translate[0],o=e.translate[1];return function(s,l){l||(t=n=0);var u=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*i+a,f[1]=(n+=s[1])*r+o;u<c;)f[u]=s[u],++u;return f}}function F5(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function N5(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return Ck(e,n)})}:Ck(e,t)}function Ck(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,a=$k(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:a}:i==null?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function $k(e,t){var n=R5(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));c<0&&F5(f,p)}function a(c){return n(c)}function o(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(s)}function u(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":d=a(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(a);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:f,coordinates:d}}return u(t)}function I5(e,t){var n={},i={},r={},a=[],o=-1;t.forEach(function(u,c){var f=e.arcs[u<0?~u:u],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++o],t[o]=u,t[c]=d)}),t.forEach(function(u){var c=s(u),f=c[0],d=c[1],h,p;if(h=r[f])if(delete r[h.end],h.push(u),h.end=d,p=i[d]){delete i[p.start];var g=p===h?h:h.concat(p);i[g.start=h.start]=r[g.end=p.end]=g}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(u),h.start=f,p=r[f]){delete r[p.end];var m=p===h?h:p.concat(h);i[m.start=p.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[u],i[h.start=f]=r[h.end=d]=h});function s(u){var c=e.arcs[u<0?~u:u],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],u<0?[d,f]:[f,d]}function l(u,c){for(var f in u){var d=u[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),a.push(d)}}return l(r,i),l(i,r),t.forEach(function(u){n[u<0?~u:u]||a.push([u])}),a}function M5(e){return $k(e,j5.apply(this,arguments))}function j5(e,t,n){var i,r,a;if(arguments.length>1)i=L5(e,t,n);else for(r=0,i=new Array(a=e.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:I5(e,i)}}function L5(e,t,n){var i=[],r=[],a;function o(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:a})}function s(f){f.forEach(o)}function l(f){f.forEach(s)}function u(f){f.forEach(l)}function c(f){switch(a=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":s(f.arcs);break;case"MultiLineString":case"Polygon":l(f.arcs);break;case"MultiPolygon":u(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}const P5={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Dk(e,t){let n,i,r,a;return e=a0(e,t),t&&t.feature?(n=N5,r=t.feature):t&&t.mesh?(n=M5,r=t.mesh,a=P5[t.filter]):F("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,a):F("Invalid TopoJSON object: "+r),i&&i.features||[i]}Dk.responseType="json";const ud={dsv:r0,csv:Tk(","),tsv:Tk("	"),json:a0,topojson:Dk};function o0(e,t){return arguments.length>1?(ud[e]=t,this):Q(ud,e)?ud[e]:null}function Rk(e){const t=o0(e);return t&&t.responseType||"text"}function tu(e){const t={};return n=>t[n]||(t[n]=e(n))}function Es(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function cd(e){return e.length===1&&(e=z5(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function z5(e){return function(t,n){return Es(e(t),n)}}var Fk=cd(Es),Zr=Fk.right,B5=Fk.left;function U5(e,t){let n=0,i,r=0,a=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,a+=i*(o-r));else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,a+=i*(s-r))}if(n>1)return a/(n-1)}function q5(e,t){const n=U5(e,t);return n&&Math.sqrt(n)}function lo(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}var s0=Math.sqrt(50),l0=Math.sqrt(10),u0=Math.sqrt(2);function c0(e,t,n){var i,r=-1,a,o,s;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(a=e,e=t,t=a),(s=fd(e,t,n))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++r<a;)o[r]=(e+r)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++r<a;)o[r]=(e-r)/s;return i&&o.reverse(),o}function fd(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=s0?10:a>=l0?5:a>=u0?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=s0?10:a>=l0?5:a>=u0?2:1)}function ea(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=s0?r*=10:a>=l0?r*=5:a>=u0&&(r*=2),t<e?-r:r}function uo(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function f0(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function Nk(e,t,n=0,i=e.length-1,r=Es){for(;i>n;){if(i-n>600){const l=i-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),h=Math.max(n,Math.floor(t-u*f/l+d)),p=Math.min(i,Math.floor(t+(l-u)*f/l+d));Nk(e,t,h,p,r)}const a=e[t];let o=n,s=i;for(nu(e,n,t),r(e[i],a)>0&&nu(e,n,i);o<s;){for(nu(e,o,s),++o,--s;r(e[o],a)<0;)++o;for(;r(e[s],a)>0;)--s}r(e[n],a)===0?nu(e,n,s):(++s,nu(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}return e}function nu(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function W5(e){return e===null?NaN:+e}function*G5(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}function dd(e,t,n){if(e=Float64Array.from(G5(e,n)),!(i=e.length))return;if((t=+t)<=0||i<2)return f0(e);if(t>=1)return uo(e);var i,r=(i-1)*t,a=Math.floor(r),o=uo(Nk(e,a).subarray(0,a+1)),s=f0(e.subarray(a+1));return o+(s-o)*(r-a)}function H5(e,t,n=W5){if(!(i=e.length))return;if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,a=Math.floor(r),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(r-a)}function Y5(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let a of e)(a=t(a,++r,e))!=null&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n}function Ik(e,t){return dd(e,.5,t)}function V5(e,t){return Array.from(t,n=>e[n])}function Mk(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function hd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function ks(e){return e=hd(Math.abs(e)),e?e[1]:NaN}function X5(e,t){return function(n,i){for(var r=n.length,a=[],o=0,s=e[0],l=0;r>0&&s>0&&!(l+s+1>i&&(s=Math.max(1,i-l)),a.push(n.substring(r-=s,r+s)),(l+=s+1)>i);)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function J5(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var K5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _s(e){if(!(t=K5.exec(e)))throw new Error("invalid format: "+e);var t;return new d0({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}_s.prototype=d0.prototype;function d0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}d0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Q5(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var jk;function Z5(e,t){var n=hd(e,t);if(!n)return e+"";var i=n[0],r=n[1],a=r-(jk=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+hd(e,Math.max(0,t+a-1))[0]}function Lk(e,t){var n=hd(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var Pk={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Lk(e*100,t)},r:Lk,s:Z5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function zk(e){return e}var Bk=Array.prototype.map,Uk=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function qk(e){var t=e.grouping===void 0||e.thousands===void 0?zk:X5(Bk.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?zk:J5(Bk.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=_s(f);var d=f.fill,h=f.align,p=f.sign,g=f.symbol,m=f.zero,v=f.width,y=f.comma,b=f.precision,E=f.trim,x=f.type;x==="n"?(y=!0,x="g"):Pk[x]||(b===void 0&&(b=12),E=!0,x="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var k=g==="$"?n:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=g==="$"?i:/[%p]/.test(x)?o:"",A=Pk[x],_=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function O(S){var T=k,D=w,M,C,N;if(x==="c")D=A(S)+D,S="";else{S=+S;var W=S<0||1/S<0;if(S=isNaN(S)?l:A(Math.abs(S),b),E&&(S=Q5(S)),W&&+S===0&&p!=="+"&&(W=!1),T=(W?p==="("?p:s:p==="-"||p==="("?"":p)+T,D=(x==="s"?Uk[8+jk/3]:"")+D+(W&&p==="("?")":""),_){for(M=-1,C=S.length;++M<C;)if(N=S.charCodeAt(M),48>N||N>57){D=(N===46?r+S.slice(M+1):S.slice(M))+D,S=S.slice(0,M);break}}}y&&!m&&(S=t(S,Infinity));var X=T.length+S.length+D.length,J=X<v?new Array(v-X+1).join(d):"";y&&m&&(S=t(J+S,J.length?v-D.length:Infinity),J="");switch(h){case"<":S=T+S+D+J;break;case"=":S=T+J+S+D;break;case"^":S=J.slice(0,X=J.length>>1)+T+S+D+J.slice(X);break;default:S=J+T+S+D;break}return a(S)}return O.toString=function(){return f+""},O}function c(f,d){var h=u((f=_s(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(ks(d)/3)))*3,g=Math.pow(10,-p),m=Uk[8+p/3];return function(v){return h(g*v)+m}}return{format:u,formatPrefix:c}}var pd,gd,h0;e6({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function e6(e){return pd=qk(e),gd=pd.format,h0=pd.formatPrefix,pd}function Wk(e){return Math.max(0,-ks(Math.abs(e)))}function Gk(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ks(t)/3)))*3-ks(Math.abs(e)))}function Hk(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ks(t)-ks(e))+1}function t6(e,t){return n=>{var i=e(n),r=i.indexOf(t),a,o;if(r<0)return i;for(a=n6(i,r),o=a<i.length?i.slice(a):"";--a>r;)if(i[a]!=="0"){++a;break}return i.slice(0,a)+o}}function n6(e,t){var n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function Yk(e){const t=tu(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){var r=_s(i||",");if(r.precision==null){r.precision=12;switch(r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return t6(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,a,o){o=_s(o??",f");const s=ea(i,r,a),l=Math.max(Math.abs(i),Math.abs(r));let u;if(o.precision==null)switch(o.type){case"s":return isNaN(u=Gk(s,l))||(o.precision=u),n(o,l);case"":case"e":case"g":case"p":case"r":{isNaN(u=Hk(s,l))||(o.precision=u-(o.type==="e"));break}case"f":case"%":{isNaN(u=Wk(s))||(o.precision=u-(o.type==="%")*2);break}}return t(o)}}}let p0;Vk();function Vk(){return p0=Yk({format:gd,formatPrefix:h0})}function Xk(e){return Yk(qk(e))}function md(e){return arguments.length?p0=Xk(e):p0}const _t="year",hn="quarter",Nt="month",ot="week",pn="date",It="day",Ii="dayofyear",Fn="hours",Nn="minutes",qn="seconds",fi="milliseconds",g0=[_t,hn,Nt,ot,pn,It,Ii,Fn,Nn,qn,fi],m0=g0.reduce((e,t,n)=>(e[t]=1+n,e),{});function v0(e){const t=G(e).slice(),n={};t.length||F("Missing time unit."),t.forEach(r=>{Q(m0,r)?n[r]=1:F(`Invalid time unit: ${r}.`)});const i=(n[ot]||n[It]?1:0)+(n[hn]||n[Nt]||n[pn]?1:0)+(n[Ii]?1:0);return i>1&&F(`Incompatible time units: ${e}`),t.sort((r,a)=>m0[r]-m0[a]),t}const i6={[_t]:"%Y ",[hn]:"Q%q ",[Nt]:"%b ",[pn]:"%d ",[ot]:"W%U ",[It]:"%a ",[Ii]:"%j ",[Fn]:"%H:00",[Nn]:"00:%M",[qn]:":%S",[fi]:".%L",[`${_t}-${Nt}`]:"%Y-%m ",[`${_t}-${Nt}-${pn}`]:"%Y-%m-%d ",[`${Fn}-${Nn}`]:"%H:%M"};function Jk(e,t){const n=fe({},i6,t),i=v0(e),r=i.length;let a="",o=0,s,l;for(o=0;o<r;)for(s=i.length;s>o;--s)if(l=i.slice(o,s).join("-"),n[l]!=null){a+=n[l],o=s;break}return a.trim()}var y0=new Date(),b0=new Date();function pt(e,t,n,i){function r(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return r.floor=function(a){return e(a=new Date(+a)),a},r.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},r.round=function(a){var o=r(a),s=r.ceil(a);return a-o<s-a?o:s},r.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},r.range=function(a,o,s){var l=[],u;if(a=r.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},r.filter=function(a){return pt(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(r.count=function(a,o){return y0.setTime(+a),b0.setTime(+o),e(y0),e(b0),Math.floor(n(y0,b0))},r.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?r.filter(i?function(o){return i(o)%a===0}:function(o){return r.count(0,o)%a===0}):r}),r}var As=pt(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});As.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?pt(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):As};var vd=1e3,co=6e4,yd=36e5,Kk=864e5,Qk=6048e5,bd=pt(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*vd)},function(e,t){return(t-e)/vd},function(e){return e.getUTCSeconds()}),Zk=pt(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*vd)},function(e,t){e.setTime(+e+t*co)},function(e,t){return(t-e)/co},function(e){return e.getMinutes()}),e_=pt(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*vd-e.getMinutes()*co)},function(e,t){e.setTime(+e+t*yd)},function(e,t){return(t-e)/yd},function(e){return e.getHours()}),fo=pt(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*co)/Kk},function(e){return e.getDate()-1});function ho(e){return pt(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*co)/Qk})}var wd=ho(0),w0=ho(1),Ode=ho(2),Tde=ho(3),x0=ho(4),Cde=ho(5),$de=ho(6),E0=pt(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),ta=pt(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});ta.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:pt(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var t_=pt(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*co)},function(e,t){return(t-e)/co},function(e){return e.getUTCMinutes()}),n_=pt(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*yd)},function(e,t){return(t-e)/yd},function(e){return e.getUTCHours()}),po=pt(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Kk},function(e){return e.getUTCDate()-1});function go(e){return pt(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/Qk})}var xd=go(0),k0=go(1),Dde=go(2),Rde=go(3),_0=go(4),Fde=go(5),Nde=go(6),A0=pt(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),na=pt(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});na.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:pt(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const mo=new Date();function S0(e){return mo.setFullYear(e),mo.setMonth(0),mo.setDate(1),mo.setHours(0,0,0,0),mo}function i_(e){return a_(new Date(e))}function r_(e){return O0(new Date(e))}function a_(e){return fo.count(S0(e.getFullYear())-1,e)}function O0(e){return wd.count(S0(e.getFullYear())-1,e)}function T0(e){return S0(e).getDay()}function r6(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,i,r,a,o);return s.setFullYear(e),s}return new Date(e,t,n,i,r,a,o)}function o_(e){return l_(new Date(e))}function s_(e){return C0(new Date(e))}function l_(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return po.count(t-1,e)}function C0(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return xd.count(t-1,e)}function $0(e){return mo.setTime(Date.UTC(e,0,1)),mo.getUTCDay()}function a6(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,i,r,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,i,r,a,o))}function u_(e,t,n,i,r){const a=t||1,o=ve(e),s=(v,y,b)=>(b=b||v,o6(n[b],i[b],v===o&&a,y)),l=new Date(),u=kt(e),c=u[_t]?s(_t):Vt(2012),f=u[Nt]?s(Nt):u[hn]?s(hn):to,d=u[ot]&&u[It]?s(It,1,ot+It):u[ot]?s(ot,1):u[It]?s(It,1):u[pn]?s(pn,1):u[Ii]?s(Ii,1):Jl,h=u[Fn]?s(Fn):to,p=u[Nn]?s(Nn):to,g=u[qn]?s(qn):to,m=u[fi]?s(fi):to;return function(v){l.setTime(+v);const y=c(l);return r(y,f(l),d(l,y),h(l),p(l),g(l),m(l))}}function o6(e,t,n,i){const r=n<=1?e:i?(a,o)=>i+n*Math.floor((e(a,o)-i)/n):(a,o)=>n*Math.floor(e(a,o)/n);return t?(a,o)=>t(r(a,o),o):r}function Ss(e,t,n){return t+e*7-(n+6)%7}const s6={[_t]:e=>e.getFullYear(),[hn]:e=>Math.floor(e.getMonth()/3),[Nt]:e=>e.getMonth(),[pn]:e=>e.getDate(),[Fn]:e=>e.getHours(),[Nn]:e=>e.getMinutes(),[qn]:e=>e.getSeconds(),[fi]:e=>e.getMilliseconds(),[Ii]:e=>a_(e),[ot]:e=>O0(e),[ot+It]:(e,t)=>Ss(O0(e),e.getDay(),T0(t)),[It]:(e,t)=>Ss(1,e.getDay(),T0(t))},l6={[hn]:e=>3*e,[ot]:(e,t)=>Ss(e,0,T0(t))};function c_(e,t){return u_(e,t||1,s6,l6,r6)}const u6={[_t]:e=>e.getUTCFullYear(),[hn]:e=>Math.floor(e.getUTCMonth()/3),[Nt]:e=>e.getUTCMonth(),[pn]:e=>e.getUTCDate(),[Fn]:e=>e.getUTCHours(),[Nn]:e=>e.getUTCMinutes(),[qn]:e=>e.getUTCSeconds(),[fi]:e=>e.getUTCMilliseconds(),[Ii]:e=>l_(e),[ot]:e=>C0(e),[It]:(e,t)=>Ss(1,e.getUTCDay(),$0(t)),[ot+It]:(e,t)=>Ss(C0(e),e.getUTCDay(),$0(t))},c6={[hn]:e=>3*e,[ot]:(e,t)=>Ss(e,0,$0(t))};function f_(e,t){return u_(e,t||1,u6,c6,a6)}const f6={[_t]:ta,[hn]:E0.every(3),[Nt]:E0,[ot]:wd,[pn]:fo,[It]:fo,[Ii]:fo,[Fn]:e_,[Nn]:Zk,[qn]:bd,[fi]:As},d6={[_t]:na,[hn]:A0.every(3),[Nt]:A0,[ot]:xd,[pn]:po,[It]:po,[Ii]:po,[Fn]:n_,[Nn]:t_,[qn]:bd,[fi]:As};function Os(e){return f6[e]}function Ts(e){return d6[e]}function d_(e,t,n){return e?e.offset(t,n):void 0}function h_(e,t,n){return d_(Os(e),t,n)}function p_(e,t,n){return d_(Ts(e),t,n)}function g_(e,t,n,i){return e?e.range(t,n,i):void 0}function m_(e,t,n,i){return g_(Os(e),t,n,i)}function v_(e,t,n,i){return g_(Ts(e),t,n,i)}const iu=1e3,ru=iu*60,au=ru*60,Ed=au*24,h6=Ed*7,y_=Ed*30,D0=Ed*365,b_=[_t,Nt,pn,Fn,Nn,qn,fi],ou=b_.slice(0,-1),su=ou.slice(0,-1),lu=su.slice(0,-1),p6=lu.slice(0,-1),g6=[_t,ot],w_=[_t,Nt],x_=[_t],uu=[[ou,1,iu],[ou,5,5*iu],[ou,15,15*iu],[ou,30,30*iu],[su,1,ru],[su,5,5*ru],[su,15,15*ru],[su,30,30*ru],[lu,1,au],[lu,3,3*au],[lu,6,6*au],[lu,12,12*au],[p6,1,Ed],[g6,1,h6],[w_,1,y_],[w_,3,3*y_],[x_,1,D0]];function E_(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(td(t))/n;let r=cd(s=>s[2]).right(uu,i),a,o;return r===uu.length?(a=x_,o=ea(t[0]/D0,t[1]/D0,n)):r?(r=uu[i/uu[r-1][2]<uu[r][2]/i?r-1:r],a=r[0],o=r[1]):(a=b_,o=Math.max(ea(t[0],t[1],n),1)),{units:a,step:o}}function R0(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function F0(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function cu(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function k_(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=fu(r),c=du(r),f=fu(a),d=du(a),h=fu(o),p=du(o),g=fu(s),m=du(s),v=fu(l),y=du(l),b={a:W,A:X,b:J,B:xe,c:null,d:O_,e:O_,f:z6,H:j6,I:L6,j:P6,L:T_,m:B6,M:U6,p:Pe,q:dt,Q:R_,s:F_,S:q6,u:W6,U:G6,V:H6,w:Y6,W:V6,x:null,X:null,y:X6,Y:J6,Z:K6,"%":D_},E={a:ht,A:Ke,b:Rt,B:ui,c:null,d:C_,e:C_,f:t4,H:Q6,I:Z6,j:e4,L:$_,m:n4,M:i4,p:Va,q:Xr,Q:R_,s:F_,S:r4,u:a4,U:o4,V:s4,w:l4,W:u4,x:null,X:null,y:c4,Y:f4,Z:d4,"%":D_},x={a:O,A:S,b:T,B:D,c:M,d:A_,e:A_,f:F6,H:S_,I:S_,j:C6,L:R6,m:T6,M:$6,p:_,q:O6,Q:I6,s:M6,S:D6,u:w6,U:x6,V:E6,w:b6,W:k6,x:C,X:N,y:A6,Y:_6,Z:S6,"%":N6};b.x=k(n,b),b.X=k(i,b),b.c=k(t,b),E.x=k(n,E),E.X=k(i,E),E.c=k(t,E);function k(H,ue){return function(me){var L=[],un=-1,Ie=0,Tn=H.length,Cn,Xa,hE;for(me instanceof Date||(me=new Date(+me));++un<Tn;)H.charCodeAt(un)===37&&(L.push(H.slice(Ie,un)),(Xa=__[Cn=H.charAt(++un)])!=null?Cn=H.charAt(++un):Xa=Cn==="e"?" ":"0",(hE=ue[Cn])&&(Cn=hE(me,Xa)),L.push(Cn),Ie=un+1);return L.push(H.slice(Ie,un)),L.join("")}}function w(H,ue){return function(me){var L=cu(1900,void 0,1),un=A(L,H,me+="",0),Ie,Tn;if(un!=me.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(ue&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(Ie=F0(cu(L.y,0,1)),Tn=Ie.getUTCDay(),Ie=Tn>4||Tn===0?k0.ceil(Ie):k0(Ie),Ie=po.offset(Ie,(L.V-1)*7),L.y=Ie.getUTCFullYear(),L.m=Ie.getUTCMonth(),L.d=Ie.getUTCDate()+(L.w+6)%7):(Ie=R0(cu(L.y,0,1)),Tn=Ie.getDay(),Ie=Tn>4||Tn===0?w0.ceil(Ie):w0(Ie),Ie=fo.offset(Ie,(L.V-1)*7),L.y=Ie.getFullYear(),L.m=Ie.getMonth(),L.d=Ie.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),Tn="Z"in L?F0(cu(L.y,0,1)).getUTCDay():R0(cu(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(Tn+5)%7:L.w+L.U*7-(Tn+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,F0(L)):R0(L)}}function A(H,ue,me,L){for(var un=0,Ie=ue.length,Tn=me.length,Cn,Xa;un<Ie;){if(L>=Tn)return-1;if(Cn=ue.charCodeAt(un++),Cn===37){if(Cn=ue.charAt(un++),Xa=x[Cn in __?ue.charAt(un++):Cn],!Xa||(L=Xa(H,me,L))<0)return-1}else if(Cn!=me.charCodeAt(L++))return-1}return L}function _(H,ue,me){var L=u.exec(ue.slice(me));return L?(H.p=c[L[0].toLowerCase()],me+L[0].length):-1}function O(H,ue,me){var L=h.exec(ue.slice(me));return L?(H.w=p[L[0].toLowerCase()],me+L[0].length):-1}function S(H,ue,me){var L=f.exec(ue.slice(me));return L?(H.w=d[L[0].toLowerCase()],me+L[0].length):-1}function T(H,ue,me){var L=v.exec(ue.slice(me));return L?(H.m=y[L[0].toLowerCase()],me+L[0].length):-1}function D(H,ue,me){var L=g.exec(ue.slice(me));return L?(H.m=m[L[0].toLowerCase()],me+L[0].length):-1}function M(H,ue,me){return A(H,t,ue,me)}function C(H,ue,me){return A(H,n,ue,me)}function N(H,ue,me){return A(H,i,ue,me)}function W(H){return o[H.getDay()]}function X(H){return a[H.getDay()]}function J(H){return l[H.getMonth()]}function xe(H){return s[H.getMonth()]}function Pe(H){return r[+(H.getHours()>=12)]}function dt(H){return 1+~~(H.getMonth()/3)}function ht(H){return o[H.getUTCDay()]}function Ke(H){return a[H.getUTCDay()]}function Rt(H){return l[H.getUTCMonth()]}function ui(H){return s[H.getUTCMonth()]}function Va(H){return r[+(H.getUTCHours()>=12)]}function Xr(H){return 1+~~(H.getUTCMonth()/3)}return{format:function(H){var ue=k(H+="",b);return ue.toString=function(){return H},ue},parse:function(H){var ue=w(H+="",!1);return ue.toString=function(){return H},ue},utcFormat:function(H){var ue=k(H+="",E);return ue.toString=function(){return H},ue},utcParse:function(H){var ue=w(H+="",!0);return ue.toString=function(){return H},ue}}}var __={"-":"",_:" ","0":"0"},gt=/^\s*\d+/,m6=/^%/,v6=/[\\^$*+?|[\]().{}]/g;function Ce(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function y6(e){return e.replace(v6,"\\$&")}function fu(e){return new RegExp("^(?:"+e.map(y6).join("|")+")","i")}function du(e){for(var t={},n=-1,i=e.length;++n<i;)t[e[n].toLowerCase()]=n;return t}function b6(e,t,n){var i=gt.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function w6(e,t,n){var i=gt.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function x6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function E6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function k6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function _6(e,t,n){var i=gt.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function A6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function S6(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function O6(e,t,n){var i=gt.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function T6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function A_(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function C6(e,t,n){var i=gt.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function S_(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function $6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function D6(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function R6(e,t,n){var i=gt.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function F6(e,t,n){var i=gt.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function N6(e,t,n){var i=m6.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function I6(e,t,n){var i=gt.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function M6(e,t,n){var i=gt.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function O_(e,t){return Ce(e.getDate(),t,2)}function j6(e,t){return Ce(e.getHours(),t,2)}function L6(e,t){return Ce(e.getHours()%12||12,t,2)}function P6(e,t){return Ce(1+fo.count(ta(e),e),t,3)}function T_(e,t){return Ce(e.getMilliseconds(),t,3)}function z6(e,t){return T_(e,t)+"000"}function B6(e,t){return Ce(e.getMonth()+1,t,2)}function U6(e,t){return Ce(e.getMinutes(),t,2)}function q6(e,t){return Ce(e.getSeconds(),t,2)}function W6(e){var t=e.getDay();return t===0?7:t}function G6(e,t){return Ce(wd.count(ta(e)-1,e),t,2)}function H6(e,t){var n=e.getDay();return e=n>=4||n===0?x0(e):x0.ceil(e),Ce(x0.count(ta(e),e)+(ta(e).getDay()===4),t,2)}function Y6(e){return e.getDay()}function V6(e,t){return Ce(w0.count(ta(e)-1,e),t,2)}function X6(e,t){return Ce(e.getFullYear()%100,t,2)}function J6(e,t){return Ce(e.getFullYear()%1e4,t,4)}function K6(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ce(t/60|0,"0",2)+Ce(t%60,"0",2)}function C_(e,t){return Ce(e.getUTCDate(),t,2)}function Q6(e,t){return Ce(e.getUTCHours(),t,2)}function Z6(e,t){return Ce(e.getUTCHours()%12||12,t,2)}function e4(e,t){return Ce(1+po.count(na(e),e),t,3)}function $_(e,t){return Ce(e.getUTCMilliseconds(),t,3)}function t4(e,t){return $_(e,t)+"000"}function n4(e,t){return Ce(e.getUTCMonth()+1,t,2)}function i4(e,t){return Ce(e.getUTCMinutes(),t,2)}function r4(e,t){return Ce(e.getUTCSeconds(),t,2)}function a4(e){var t=e.getUTCDay();return t===0?7:t}function o4(e,t){return Ce(xd.count(na(e)-1,e),t,2)}function s4(e,t){var n=e.getUTCDay();return e=n>=4||n===0?_0(e):_0.ceil(e),Ce(_0.count(na(e),e)+(na(e).getUTCDay()===4),t,2)}function l4(e){return e.getUTCDay()}function u4(e,t){return Ce(k0.count(na(e)-1,e),t,2)}function c4(e,t){return Ce(e.getUTCFullYear()%100,t,2)}function f4(e,t){return Ce(e.getUTCFullYear()%1e4,t,4)}function d4(){return"+0000"}function D_(){return"%"}function R_(e){return+e}function F_(e){return Math.floor(+e/1e3)}var Cs,N0,N_,I0,I_;h4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function h4(e){return Cs=k_(e),N0=Cs.format,N_=Cs.parse,I0=Cs.utcFormat,I_=Cs.utcParse,Cs}function M_(e,t,n){n=n||{},K(n)||F(`Invalid time multi-format specifier: ${n}`);const i=t(qn),r=t(Nn),a=t(Fn),o=t(pn),s=t(ot),l=t(Nt),u=t(hn),c=t(_t),f=e(n[fi]||".%L"),d=e(n[qn]||":%S"),h=e(n[Nn]||"%I:%M"),p=e(n[Fn]||"%I %p"),g=e(n[pn]||n[It]||"%a %d"),m=e(n[ot]||"%b %d"),v=e(n[Nt]||"%B"),y=e(n[hn]||"%B"),b=e(n[_t]||"%Y");return E=>(i(E)<E?f:r(E)<E?d:a(E)<E?h:o(E)<E?p:l(E)<E?s(E)<E?g:m:c(E)<E?u(E)<E?v:y:b)(E)}function j_(e){const t=tu(e.format),n=tu(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):M_(t,Os,i),utcFormat:i=>Y(i)?n(i):M_(n,Ts,i),timeParse:tu(e.parse),utcParse:tu(e.utcParse)}}let M0;L_();function L_(){return M0=j_({format:N0,parse:N_,utcFormat:I0,utcParse:I_})}function P_(e){return j_(k_(e))}function hu(e){return arguments.length?M0=P_(e):M0}const j0=(e,t)=>fe({},e,t);function z_(e,t){const n=e?Xk(e):md(),i=t?P_(t):hu();return j0(n,i)}function L0(e,t){const n=arguments.length;return n&&n!==2&&F("defaultLocale expects either zero or two arguments."),n?j0(md(e),hu(t)):j0(md(),hu())}function p4(){return Vk(),L_(),L0()}function B_(e,t,n,i){t=t||{};const r=o0(t.type||"json");return r||F("Unknown data format type: "+t.type),e=r(e,t),t.parse&&g4(e,t.parse,n,i),Q(e,"columns")&&delete e.columns,e}function g4(e,t,n,i){if(!e.length)return;const r=hu();n=n||r.timeParse,i=i||r.utcParse;var a=e.columns||Object.keys(e[0]),o,s,l,u,c,f,d;for(t==="auto"&&(t=kk(e,a)),a=Object.keys(t),o=a.map(function(h){var p=t[h],g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:"))){g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1));const v=g[0]==="utc"?i:n;return v(m)}if(!e0[p])throw Error("Illegal format pattern: "+h+":"+p);return e0[p]}),u=0,f=e.length,d=a.length;u<f;++u)for(s=e[u],c=0;c<d;++c)l=a[c],s[l]=o[c](s[l])}var kd=h5(typeof fetch!="undefined"&&fetch,null);function m4(e,t){const n=this.locale();return B_(e,t,n.timeParse,n.utcParse)}function v4(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function y4(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:Rk(t&&t.type)});try{r=n.parse(r,t)}catch(a){i=-2,n.warn("Data ingestion failed",e,a)}}catch(a){i=-1,n.warn("Loading failed",e,a)}return{data:r,status:i}}async function b4(e,t,n){const i=this,r=i._pending||w4(i);r.requests+=1;const a=await i.request(t,n);return i.pulse(e,i.changeset().remove(Ni).insert(a.data||[])),r.done(),a}function w4(e){var t=new Promise(function(i){n=i}),n;return t.requests=0,t.done=function(){--t.requests===0&&(e._pending=null,n(e))},e._pending=t}var x4={skip:!0};function E4(e,t,n,i,r){var a=e instanceof Fe?_4:k4;return a(this,e,t,n,i,r),this}function k4(e,t,n,i,r,a){var o=fe({},a,x4),s,l;ge(n)||(n=Vt(n)),i===void 0?s=u=>e.touch(n(u)):ge(i)?(l=new Fe(null,i,r,!1),s=u=>{l.evaluate(u);const c=n(u),f=l.value;bk(f)?e.pulse(c,f,a):e.update(c,f,o)}):s=u=>e.update(n(u),i,o),t.apply(s)}function _4(e,t,n,i,r,a){if(i===void 0)t.targets().add(n);else{const o=a||{},s=new Fe(null,A4(n,i),r,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function A4(e,t){return t=ge(t)?t:Vt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function S4(e){e.rank=++this._rank}function O4(e){for(var t=[e],n,i,r;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&F("Cycle detected in dataflow graph.")}const _d={},Mi=1<<0,ia=1<<1,br=1<<2,T4=Mi|ia,U_=Mi|br,$s=Mi|ia|br,q_=1<<3,pu=1<<4,W_=1<<5,G_=1<<6;function ra(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}const ze=ra.prototype;ze.StopPropagation=_d,ze.ADD=Mi,ze.REM=ia,ze.MOD=br,ze.ADD_REM=T4,ze.ADD_MOD=U_,ze.ALL=$s,ze.REFLOW=q_,ze.SOURCE=pu,ze.NO_SOURCE=W_,ze.NO_FIELDS=G_,ze.fork=function(e){return new ra(this.dataflow).init(this,e)},ze.clone=function(){const e=this.fork($s);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize($s|pu)},ze.addAll=function(){let e=this;return!e.source||e.source.length===e.add.length||(e=new ra(this.dataflow).init(this),e.add=e.source),e},ze.init=function(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&G_)&&(n.fields=e.fields),t&Mi?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&ia?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&br?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&W_?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},ze.runAfter=function(e){this.dataflow.runAfter(e)},ze.changed=function(e){var t=e||$s;return t&Mi&&this.add.length||t&ia&&this.rem.length||t&br&&this.mod.length},ze.reflow=function(e){if(e)return this.fork($s).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(br,H_(this,Mi))),this},ze.clean=function(e){return arguments.length?(this.cleans=!!e,this):this.cleans},ze.modifies=function(e){var t=this.fields||(this.fields={});return I(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},ze.modified=function(e,t){var n=this.fields;return(t||this.mod.length)&&n?arguments.length?I(e)?e.some(i=>n[i]):n[e]:!!n:!1},ze.filter=function(e,t){var n=this;return e&Mi&&(n.addF=Ad(n.addF,t)),e&ia&&(n.remF=Ad(n.remF,t)),e&br&&(n.modF=Ad(n.modF,t)),e&pu&&(n.srcF=Ad(n.srcF,t)),n};function Ad(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}ze.materialize=function(e){e=e||$s;var t=this;return e&Mi&&t.addF&&(t.add=P0(t.add,t.addF),t.addF=null),e&ia&&t.remF&&(t.rem=P0(t.rem,t.remF),t.remF=null),e&br&&t.modF&&(t.mod=P0(t.mod,t.modF),t.modF=null),e&pu&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t};function P0(e,t){var n=[];return ao(e,t,i=>n.push(i)),n}function H_(e,t){var n={};return e.visit(t,function(i){n[ee(i)]=1}),i=>n[ee(i)]?null:i}ze.visit=function(e,t){var n=this,i=t,r,a;return e&pu?(ao(n.source,n.srcF,i),n):(e&Mi&&ao(n.add,n.addF,i),e&ia&&ao(n.rem,n.remF,i),e&br&&ao(n.mod,n.modF,i),e&q_&&(r=n.source)&&(a=n.add.length+n.mod.length,a===r.length||(a?ao(r,H_(n,U_),i):ao(r,n.srcF,i))),n)};function z0(e,t,n,i){var r=this,a=0,o,s,l,u,c;for(this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n,l=0,u=n.length;l<u;++l){if(o=n[l],o.stamp!==t)continue;if(o.fields){s=r.fields||(r.fields={});for(c in o.fields)s[c]=1}o.changed(r.ADD)&&(a|=r.ADD),o.changed(r.REM)&&(a|=r.REM),o.changed(r.MOD)&&(a|=r.MOD)}this.changes=a}var Ds=P(z0,ra);Ds.fork=function(e){var t=new ra(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,function(n){return t.add.push(n)}),e&t.REM&&this.visit(t.REM,function(n){return t.rem.push(n)}),e&t.MOD&&this.visit(t.MOD,function(n){return t.mod.push(n)})),t},Ds.changed=function(e){return this.changes&e},Ds.modified=function(e){var t=this,n=t.fields;return n&&t.changes&t.MOD?I(e)?e.some(function(i){return n[i]}):n[e]:0},Ds.filter=function(){F("MultiPulse does not support filtering.")},Ds.materialize=function(){F("MultiPulse does not support materialization.")},Ds.visit=function(e,t){var n=this,i=n.pulses,r=i.length,a=0;if(e&n.SOURCE)for(;a<r;++a)i[a].visit(e,t);else for(;a<r;++a)i[a].stamp===n.stamp&&i[a].visit(e,t);return n};async function C4(e,t,n){const i=this,r=[];if(i._pulse)return Y_(i);if(i._pending&&await i._pending,t&&await id(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const a=++i._clock;i._pulse=new ra(i,a,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=nd(Vf);let o=0,s,l,u;try{for(;i._heap.size()>0;){if(s=i._heap.pop(),s.rank!==s.qrank){i._enqueue(s,!0);continue}l=s.run(i._getPulse(s,e)),l.then?l=await l:l.async&&(r.push(l.async),l=_d),l!==_d&&(s._targets&&s._targets.forEach(c=>i._enqueue(c))),++o}}catch(c){i._heap.clear(),u=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${a}: ${o} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await id(i,c[f].callback)}return n&&await id(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function $4(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function D4(e,t,n){return this._pulse?Y_(this):(this.evaluate(e,t,n),this)}function R4(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function Y_(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function F4(e,t){var n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function N4(e,t){var n=e.source,i=this._clock;return n&&I(n)?new z0(this,i,n.map(r=>r.pulse),t):this._input[e.id]||I4(this._pulse,n&&n.pulse)}function I4(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==_d&&(e.source=t.source),e)}var B0={skip:!1,force:!1};function M4(e,t){var n=t||B0;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function j4(e,t,n){var i=n||B0;return(e.set(t)||i.force)&&this.touch(e,i),this}function L4(e,t,n){this.touch(e,n||B0);var i=new ra(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function P4(e){var t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),V_(t,0,t.length-1,e)),pop:()=>{var n=t.pop(),i;return t.length?(i=t[0],t[0]=n,z4(t,0,e)):i=n,i}}}function V_(e,t,n,i){var r,a,o;for(r=e[n];n>t;){if(o=n-1>>1,a=e[o],i(r,a)<0){e[n]=a,n=o;continue}break}return e[n]=r}function z4(e,t,n){for(var i=t,r=e.length,a=e[t],o=(t<<1)+1,s;o<r;)s=o+1,s<r&&n(e[o],e[s])>=0&&(o=s),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=a,V_(e,i,t,n)}function Rs(){this.logger(ek()),this.logLevel(QE),this._clock=0,this._rank=0,this._locale=L0();try{this._loader=kd()}catch(e){}this._touched=nd(Vf),this._input={},this._pulse=null,this._heap=P4((e,t)=>e.qrank-t.qrank),this._postrun=[]}var Ae=Rs.prototype;Ae.stamp=function(){return this._clock},Ae.loader=function(e){return arguments.length?(this._loader=e,this):this._loader},Ae.locale=function(e){return arguments.length?(this._locale=e,this):this._locale},Ae.cleanThreshold=1e4,Ae.add=o5,Ae.connect=s5,Ae.rank=S4,Ae.rerank=O4,Ae.pulse=L4,Ae.touch=M4,Ae.update=j4,Ae.changeset=so,Ae.ingest=v4,Ae.parse=m4,Ae.preload=b4,Ae.request=y4,Ae.events=u5,Ae.on=E4,Ae.evaluate=C4,Ae.run=D4,Ae.runAsync=$4,Ae.runAfter=R4,Ae._enqueue=F4,Ae._getPulse=N4;function gu(e){return function(){return this._log[e].apply(this,arguments)}}Ae.logger=function(e){return arguments.length?(this._log=e,this):this._log},Ae.error=gu("error"),Ae.warn=gu("warn"),Ae.info=gu("info"),Ae.debug=gu("debug"),Ae.logLevel=gu("level");function $(e,t){Fe.call(this,e,null,t)}var U0=P($,Fe);U0.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},U0.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},U0.transform=function(){};var Fs={};function X_(e){var t=J_(e);return t&&t.Definition||null}function J_(e){return e=e&&e.toLowerCase(),Q(Fs,e)?Fs[e]:null}function B4(e){return function(t){for(var n=e.length,i=1,r=String(e[0](t));i<n;++i)r+="|"+e[i](t);return r}}function q0(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:B4(e)}function K_(e,t,n){return n||e+(t?"_"+t:"")}const W0=()=>{},U4={init:W0,add:W0,rem:W0,idx:0},mu={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},vu=Object.keys(mu);function q4(e,t){return n=>fe({name:e,out:n||e},U4,t)}vu.forEach(e=>{mu[e]=q4(e,mu[e])});function Q_(e,t){return mu[e](t)}function Z_(e,t){return e.idx-t.idx}function W4(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{if(!i.req)return;i.req.forEach(r=>{t[r]||n(t[r]=mu[r]())})};return e.forEach(n),Object.values(t).sort(Z_)}function G4(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function H4(e,t){if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid,this._ops.forEach(n=>n.add(this,e,t))}function Y4(e,t){if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid,this._ops.forEach(n=>n.rem(this,e,t))}function V4(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function eA(e,t){var n=t||Yt,i=W4(e),r=e.slice().sort(Z_);function a(o){this._ops=i,this._out=r,this.cell=o,this.init()}return a.prototype.init=G4,a.prototype.add=H4,a.prototype.rem=Y4,a.prototype.set=V4,a.prototype.get=n,a.fields=e.map(o=>o.out),a}function*tA(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function G0(e,t,n){var i=Float64Array.from(tA(e,n));return i.sort(Es),t.map(r=>H5(i,r))}function H0(e,t){return G0(e,[.25,.5,.75],t)}function Y0(e,t){var n=e.length,i=q5(e,t),r=H0(e,t),a=(r[2]-r[0])/1.34;return i=Math.min(i,a)||i||Math.abs(r[0])||1,1.06*i*Math.pow(n,-.2)}function nA(e){var t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2],a=e.extent[0],o=e.extent[1],s=e.span||o-a||Math.abs(a)||1,l,u,c,f,d,h,p,g;if(e.step)l=e.step;else if(e.steps){for(d=s/t,h=0,p=e.steps.length;h<p&&e.steps[h]<d;++h);l=e.steps[Math.max(0,h-1)]}else{for(u=Math.ceil(Math.log(t)/i),c=e.minstep||0,l=Math.max(c,Math.pow(n,Math.round(Math.log(s)/i)-u));Math.ceil(s/l)>t;)l*=n;for(h=0,p=r.length;h<p;++h)d=l/r[h],d>=c&&s/d<=t&&(l=d)}return d=Math.log(l),f=d>=0?0:~~(-d/i)+1,g=Math.pow(n,-f-1),(e.nice||e.nice===void 0)&&(d=Math.floor(a/l+g)*l,a=a<d?d-l:d,o=Math.ceil(o/l)*l),{start:a,stop:o===a?a+l:o,step:l}}var Wn=Math.random;function X4(e){Wn=e}function iA(e,t,n,i){if(!e.length)return[void 0,void 0];var r=Float64Array.from(tA(e,i)),a=r.length,o=t,s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=r[~~(Wn()*a)];c[u]=s/a}return c.sort(Es),[dd(c,n/2),dd(c,1-n/2)]}function rA(e,t,n,i){i=i||(d=>d);let r=0,a=1,o=e.length,s=new Float64Array(o),l=i(e[0]),u=l,c=l+t,f;for(;a<o;++a){if(f=i(e[a]),f>=c){for(u=(l+u)/2;r<a;++r)s[r]=u;c=f+t,l=f}u=f}for(u=(l+u)/2;r<a;++r)s[r]=u;return n?J4(s,t+t/4):s}function J4(e,t){let n=e.length,i=0,r=1,a,o;for(;e[i]===e[r];)++r;for(;r<n;){for(a=r+1;e[r]===e[a];)++a;if(e[r]-e[r-1]<t){for(o=r+(i+a-r-r>>1);o<r;)e[o++]=e[r];for(;o>r;)e[o--]=e[i]}i=r,r=a}return e}function K4(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function Q4(e,t){t==null&&(t=e,e=0);var n={},i,r,a;return n.min=function(o){return arguments.length?(i=o||0,a=r-i,n):i},n.max=function(o){return arguments.length?(r=o||0,a=r-i,n):r},n.sample=function(){return i+Math.floor(a*Wn())},n.pdf=function(o){return o===Math.floor(o)&&o>=i&&o<r?1/a:0},n.cdf=function(o){var s=Math.floor(o);return s<i?0:s>=r?1:(s-i+1)/a},n.icdf=function(o){return o>=0&&o<=1?i-1+Math.floor(o*a):NaN},n.min(e).max(t)}const aA=Math.sqrt(2*Math.PI),Z4=Math.SQRT2;let yu=NaN;function Sd(e,t){e=e||0,t=t??1;let n=0,i=0,r,a;if(yu===yu)n=yu,yu=NaN;else{do n=Wn()*2-1,i=Wn()*2-1,r=n*n+i*i;while(r===0||r>1);a=Math.sqrt(-2*Math.log(r)/r),n*=a,yu=i*a}return e+n*t}function V0(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*aA)}function Od(e,t,n){t=t||0,n=n??1;let i,r=(e-t)/n,a=Math.abs(r);if(a>37)i=0;else{let o,s=Math.exp(-a*a/2);a<7.07106781186547?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,i=s*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,i=i/o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,i=s/o/2.506628274631)}return r>0?1-i:i}function Td(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*Z4*e8(2*e-1)}function e8(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=Infinity,n*e}function X0(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>Sd(n,i),pdf:a=>V0(a,n,i),cdf:a=>Od(a,n,i),icdf:a=>Td(a,n,i)};return r.mean(e).stdev(t)}function J0(e,t){var n=X0(),i={},r=0;return i.data=function(a){return arguments.length?(e=a,r=a?a.length:0,i.bandwidth(t)):e},i.bandwidth=function(a){return arguments.length?(t=a,!t&&e&&(t=Y0(e)),i):t},i.sample=function(){return e[~~(Wn()*r)]+t*n.sample()},i.pdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.pdf((a-e[s])/t);return o/t/r},i.cdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.cdf((a-e[s])/t);return o/r},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)}function K0(e,t){return e=e||0,t=t??1,Math.exp(e+Sd()*t)}function Q0(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*aA*e)}function Z0(e,t,n){return Od(Math.log(e),t,n)}function ev(e,t,n){return Math.exp(Td(e,t,n))}function oA(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>K0(n,i),pdf:a=>Q0(a,n,i),cdf:a=>Z0(a,n,i),icdf:a=>ev(a,n,i)};return r.mean(e).stdev(t)}function sA(e,t){var n={},i=0,r;function a(o){var s=[],l=0,u;for(u=0;u<i;++u)l+=s[u]=o[u]==null?1:+o[u];for(u=0;u<i;++u)s[u]/=l;return s}return n.weights=function(o){return arguments.length?(r=a(t=o||[]),n):t},n.distributions=function(o){return arguments.length?(o?(i=o.length,e=o):(i=0,e=[]),n.weights(t)):e},n.sample=function(){for(var o=Wn(),s=e[i-1],l=r[0],u=0;u<i-1;l+=r[++u])if(o<l){s=e[u];break}return s.sample()},n.pdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].pdf(o);return s},n.cdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].cdf(o);return s},n.icdf=function(){throw Error("Mixture icdf not supported.")},n.distributions(e).weights(t)}function tv(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Wn()}function nv(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function iv(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function rv(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function lA(e,t){var n,i,r={min:function(a){return arguments.length?(n=a||0,r):n},max:function(a){return arguments.length?(i=a??1,r):i},sample:()=>tv(n,i),pdf:a=>nv(a,n,i),cdf:a=>iv(a,n,i),icdf:a=>rv(a,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function bu(e,t,n,i){const r=i-e*e,a=Math.abs(r)<1e-24?0:(n-e*t)/r,o=t-a*e;return[o,a]}function Cd(e,t,n,i){e=e.filter(h=>{let p=t(h),g=n(h);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),i&&e.sort((h,p)=>t(h)-t(p));const r=e.length,a=new Float64Array(r),o=new Float64Array(r);let s=0,l=0,u=0,c,f,d;for(d of e)a[s]=c=+t(d),o[s]=f=+n(d),++s,l+=(c-l)/s,u+=(f-u)/s;for(s=0;s<r;++s)a[s]-=l,o[s]-=u;return[a,o,l,u]}function wu(e,t,n,i){let r=-1,a,o;for(let s of e)a=t(s),o=n(s),a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o&&i(a,o,++r)}function Ns(e,t,n,i,r){let a=0,o=0;return wu(e,t,n,(s,l)=>{const u=l-r(s),c=l-i;a+=u*u,o+=c*c}),1-a/o}function av(e,t,n){let i=0,r=0,a=0,o=0,s=0;wu(e,t,n,(c,f)=>{++s,i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=bu(i,r,a,o),u=c=>l[0]+l[1]*c;return{coef:l,predict:u,rSquared:Ns(e,t,n,r,u)}}function uA(e,t,n){let i=0,r=0,a=0,o=0,s=0;wu(e,t,n,(c,f)=>{++s,c=Math.log(c),i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=bu(i,r,a,o),u=c=>l[0]+l[1]*Math.log(c);return{coef:l,predict:u,rSquared:Ns(e,t,n,r,u)}}function cA(e,t,n){const[i,r,a,o]=Cd(e,t,n);let s=0,l=0,u=0,c=0,f=0,d,h,p;wu(e,t,n,(y,b)=>{d=i[f++],h=Math.log(b),p=d*b,s+=(b*h-s)/f,l+=(p-l)/f,u+=(p*h-u)/f,c+=(d*p-c)/f});const[g,m]=bu(l/o,s/o,u/o,c/o),v=y=>Math.exp(g+m*(y-a));return{coef:[Math.exp(g-m*a),m],predict:v,rSquared:Ns(e,t,n,o,v)}}function fA(e,t,n){let i=0,r=0,a=0,o=0,s=0,l=0;wu(e,t,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++l,i+=(h-i)/l,r+=(p-r)/l,a+=(h*p-a)/l,o+=(h*h-o)/l,s+=(d-s)/l});const u=bu(i,r,a,o),c=f=>u[0]*Math.pow(f,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:Ns(e,t,n,s,c)}}function ov(e,t,n){const[i,r,a,o]=Cd(e,t,n),s=i.length;let l=0,u=0,c=0,f=0,d=0,h,p,g,m;for(h=0;h<s;)p=i[h],g=r[h++],m=p*p,l+=(m-l)/h,u+=(m*p-u)/h,c+=(m*m-c)/h,f+=(p*g-f)/h,d+=(m*g-d)/h;const v=c-l*l,y=l*v-u*u,b=(d*l-f*u)/y,E=(f*v-d*u)/y,x=-b*l,k=w=>(w=w-a,b*w*w+E*w+x+o);return{coef:[x-E*a+b*a*a+o,E-2*b*a,b],predict:k,rSquared:Ns(e,t,n,o,k)}}function dA(e,t,n,i){if(i===1)return av(e,t,n);if(i===2)return ov(e,t,n);const[r,a,o,s]=Cd(e,t,n),l=r.length,u=[],c=[],f=i+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d)*a[p];for(u.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d+h);m[h]=g}c.push(m)}c.push(u);const v=n8(c),y=b=>{b-=o;let E=s+v[0]+v[1]*b+v[2]*b*b;for(d=3;d<f;++d)E+=v[d]*Math.pow(b,d);return E};return{coef:t8(f,v,-o,s),predict:y,rSquared:Ns(e,t,n,s,y)}}function t8(e,t,n,i){const r=Array(e);let a,o,s,l;for(a=0;a<e;++a)r[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,r[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,r[a-o]+=s*Math.pow(n,o)*l;return r[0]+=i,r}function n8(e){const t=e.length-1,n=[];let i,r,a,o,s;for(i=0;i<t;++i){for(o=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][o])&&(o=r);for(a=i;a<t+1;++a)s=e[a][i],e[a][i]=e[a][o],e[a][o]=s;for(r=i+1;r<t;++r)for(a=t;a>=i;a--)e[a][r]-=e[a][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(s=0,a=r+1;a<t;++a)s+=e[a][r]*n[a];n[r]=(e[t][r]-s)/e[r][r]}return n}const hA=2,pA=1e-12;function gA(e,t,n,i){const[r,a,o,s]=Cd(e,t,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let h=-1;++h<=hA;){const p=[0,u-1];for(let m=0;m<l;++m){const v=r[m],y=p[0],b=p[1],E=v-r[y]>r[b]-v?y:b;let x=0,k=0,w=0,A=0,_=0,O=1/Math.abs(r[E]-v||1);for(let D=y;D<=b;++D){const M=r[D],C=a[D],N=i8(Math.abs(v-M)*O)*d[D],W=M*N;x+=N,k+=W,w+=C*N,A+=C*W,_+=M*W}const[S,T]=bu(k/x,w/x,A/x,_/x);c[m]=S+T*v,f[m]=Math.abs(a[m]-c[m]),r8(r,m+1,p)}if(h===hA)break;const g=Ik(f);if(Math.abs(g)<pA)break;for(let m=0,v,y;m<l;++m)v=f[m]/(6*g),d[m]=v>=1?pA:(y=1-v*v)*y}return a8(r,c,o,s)}function i8(e){return(e=1-e*e*e)*e*e}function r8(e,t,n){let i=e[t],r=n[0],a=n[1]+1;if(a>=e.length)return;for(;t>r&&e[a]-i<=i-e[r];)n[0]=++r,n[1]=a,++a}function a8(e,t,n,i){const r=e.length,a=[];let o=0,s=0,l=[],u;for(;o<r;++o)u=e[o]+n,l[0]===u?l[1]+=(t[o]-l[1])/++s:(s=0,l[1]+=i,l=[u,t[o]],a.push(l));return l[1]+=i,a}const o8=.1*Math.PI/180;function $d(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=h=>[h,e(h)],a=t[0],o=t[1],s=o-a,l=s/i,u=[r(a)],c=[];if(n===i){for(let h=1;h<i;++h)u.push(r(a+h/n*s));return u.push(r(o)),u}else{c.push(r(o));for(let h=n;--h>0;)c.push(r(a+h/n*s))}let f=u[0],d=c[c.length-1];for(;d;){const h=r((f[0]+d[0])/2);h[0]-f[0]>=l&&s8(f,h,d)>o8?c.push(h):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function s8(e,t,n){const i=Math.atan2(n[1]-e[1],n[0]-e[0]),r=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(i-r)}function sv(e){this._key=e?Fi(e):ee,this.reset()}var At=sv.prototype;At.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},At.add=function(e){this._add.push(e)},At.rem=function(e){this._rem.push(e)},At.values=function(){if(this._get=null,this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,a=Array(i-r),o={},s,l,u;for(s=0;s<r;++s)o[n(t[s])]=1;for(s=0,l=0;s<i;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},At.distinct=function(e){for(var t=this.values(),n=t.length,i={},r=0,a;--n>=0;)a=e(t[n])+"",Q(i,a)||(i[a]=1,++r);return r},At.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=qz(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},At.argmin=function(e){return this.extent(e)[0]||{}},At.argmax=function(e){return this.extent(e)[1]||{}},At.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):void 0},At.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):void 0},At.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=H0(this.values(),e),this._get=e),this._q},At.q1=function(e){return this.quartile(e)[0]},At.q2=function(e){return this.quartile(e)[1]},At.q3=function(e){return this.quartile(e)[2]},At.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=iA(this.values(),1e3,.05,e),this._get=e),this._ci},At.ci0=function(e){return this.ci(e)[0]},At.ci1=function(e){return this.ci(e)[1]};function vo(e){$.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}vo.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:vu},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Gn=P(vo,$);Gn.transform=function(e,t){var n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(n.value=n.value||n.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},Gn.cross=function(){var e=this,t=e.value,n=e._dnames,i=n.map(function(){return{}}),r=n.length;function a(s){var l,u,c,f;for(l in s)for(c=s[l].tuple,u=0;u<r;++u)i[u][f=c[n[u]]]=f}a(e._prev),a(t);function o(s,l,u){var c=n[u],f=i[u++],d,h;for(d in f)l[c]=f[d],h=s?s+"|"+d:d,u<r?o(h,l,u):t[h]||e.cell(h,l)}o("",{},0)},Gn.init=function(e){var t=this._inputs=[],n=this._outputs=[],i={};function r(m){for(var v=G(Ht(m)),y=0,b=v.length,E;y<b;++y)i[E=v[y]]||(i[E]=1,t.push(E))}this._dims=G(e.groupby),this._dnames=this._dims.map(function(m){var v=et(m);return r(m),n.push(v),v}),this.cellkey=e.key?e.key:q0(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={},c,f,d,h,p,g;for(l!==o.length&&F("Unmatched number of fields and aggregate ops."),g=0;g<l;++g){if(c=a[g],f=o[g],c==null&&f!=="count"&&F("Null aggregate field specified."),h=et(c),p=K_(f,h,s[g]),n.push(p),f==="count"){this._counts.push(p);continue}d=u[h],d||(r(c),d=u[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(Q_(f,p))}return this._measures=this._measures.map(function(m){return eA(m,m.field)}),{}},Gn.cellkey=q0(),Gn.cell=function(e,t){var n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},Gn.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var i=this._measures,r=i.length,a;for(n.agg=Array(r),a=0;a<r;++a)n.agg[a]=new i[a](n)}return n.store&&(n.data=new sv()),n},Gn.newtuple=function(e,t){var n=this._dnames,i=this._dims,r={},a,o;for(a=0,o=i.length;a<o;++a)r[n[a]]=i[a](e);return t?yk(t.tuple,r):ke(r)},Gn.clean=function(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},Gn.add=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num+=1,this._countOnly)return;for(n.store&&n.data.add(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].add(i[r].get(e),e)},Gn.rem=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num-=1,this._countOnly)return;for(n.store&&n.data.rem(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].rem(i[r].get(e),e)},Gn.celltuple=function(e){var t=e.tuple,n=this._counts,i,r,a;for(e.store&&e.data.values(),r=0,a=n.length;r<a;++r)t[n[r]]=e.num;if(!this._countOnly)for(i=e.agg,r=0,a=i.length;r<a;++r)i[r].set(t);return t},Gn.changes=function(e){var t=this._adds,n=this._mods,i=this._prev,r=this._drop,a=e.add,o=e.rem,s=e.mod,l,u,c,f;if(i)for(u in i)l=i[u],(!r||l.num)&&o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(l.num===0&&r?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e};const l8=1e-14;function lv(e){$.call(this,null,e)}lv.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var mA=P(lv,$);mA.transform=function(e,t){var n=e.interval!==!1,i=this._bins(e),r=i.start,a=i.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1],u;return e.modified()?(t=t.reflow(!0),u=t.SOURCE):u=t.modified(Ht(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?function(c){var f=i(c);c[s]=f,c[l]=f==null?null:r+a*(1+(f-r)/a)}:function(c){c[s]=i(c)}),t.modifies(n?o:s)},mA._bins=function(e){if(this.value&&!e.modified())return this.value;var t=e.field,n=nA(e),i=n.step,r=n.start,a=r+Math.ceil((n.stop-r)/i)*i,o,s;(o=e.anchor)!=null&&(s=o-(r+i*Math.floor((o-r)/i)),r+=s,a+=s);var l=function(u){var c=fn(t(u));return c==null?null:c<r?-Infinity:c>a?Infinity:(c=Math.max(r,Math.min(c,a-i)),r+i*Math.floor(l8+(c-r)/i))};return l.start=r,l.stop=n.stop,l.step=i,this.value=Rn(l,Ht(t),e.name||"bin_"+et(t))};function vA(e,t,n){var i=e,r=t||[],a=n||[],o={},s=0;return{add:function(l){a.push(l)},remove:function(l){o[i(l)]=++s},size:function(){return r.length},data:function(l,u){return s&&(r=r.filter(function(c){return!o[i(c)]}),o={},s=0),u&&l&&r.sort(l),a.length&&(r=l?Jz(l,r,a.sort(l)):r.concat(a),a=[]),r}}}function uv(e){$.call(this,[],e)}uv.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};var u8=P(uv,$);u8.transform=function(e,t){var n=t.fork(t.ALL),i=vA(ee,this.value,n.materialize(n.ADD).add),r=e.sort,a=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(oo(r),a),t.source&&t.source.root&&(this.value.root=t.source.root),n};function yA(e){Fe.call(this,null,c8,e)}P(yA,Fe);function c8(e){return this.value&&!e.modified()?this.value:uk(e.fields,e.orders)}function cv(e){$.call(this,null,e)}cv.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function f8(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}var fv=P(cv,$);fv.transform=function(e,t){function n(f){return function(d){for(var h=f8(s(d),e.case,a)||[],p,g=0,m=h.length;g<m;++g)o.test(p=h[g])||f(p)}}var i=this._parameterCheck(e,t),r=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(function(f){r[f]=1+(r[f]||0)}),c=n(function(f){r[f]-=1});return i?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},fv._parameterCheck=function(e,t){var n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},fv._finish=function(e,t){var n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS),s,l,u;for(s in n)l=i[s],u=n[s]||0,!l&&u?(i[s]=l=ke({}),l[r]=s,l[a]=u,o.add.push(l)):u===0?(l&&o.rem.push(l),n[s]=null,i[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)};function dv(e){$.call(this,null,e)}dv.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};var d8=P(dv,$);d8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=this.value,r=e.as||["a","b"],a=r[0],o=r[1],s=!i||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");return s?(i&&(n.rem=i),i=t.materialize(t.SOURCE).source,n.add=this.value=h8(i,a,o,e.filter||Ni)):n.mod=i,n.source=this.value,n.modifies(r)};function h8(e,t,n,i){for(var r=[],a={},o=e.length,s=0,l,u;s<o;++s)for(a[t]=u=e[s],l=0;l<o;++l)a[n]=e[l],i(a)&&(r.push(ke(a)),a={},a[t]=u);return r}var bA={kde:J0,mixture:sA,normal:X0,lognormal:oA,uniform:lA},p8="distributions",wA="function",g8="field";function xA(e,t){var n=e[wA];Q(bA,n)||F("Unknown distribution function: "+n);var i=bA[n]();for(var r in e)r===g8?i.data((e.from||t()).map(e[r])):r===p8?i[r](e[r].map(function(a){return xA(a,t)})):typeof i[r]===wA&&i[r](e[r]);return i}function hv(e){$.call(this,null,e)}var EA=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],m8={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:EA},{name:"weights",type:"number",array:!0}]};hv.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:EA.concat(m8)},{name:"as",type:"string",array:!0,default:["value","density"]}]};var v8=P(hv,$);v8.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var i=xA(e.distribution,y8(t)),r=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200,o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&F("Invalid density method: "+o),!e.extent&&!i.data&&F("Missing density extent parameter."),o=i[o];var s=e.as||["value","density"],l=e.extent||vr(i.data()),u=$d(o,l,r,a).map(c=>{var f={};return f[s[0]]=c[0],f[s[1]]=c[1],ke(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function y8(e){return function(){return e.materialize(e.SOURCE).source}}function kA(e,t){return e?e.map(function(n,i){return t[i]||et(n)}):null}function pv(e,t,n){var i=[],r=function(f){return f(l)},a,o,s,l,u,c;if(t==null)i.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(r),c=a[u],c||(a[u]=c=[],c.dims=u,i.push(c)),c.push(n(l));return i}const _A="bin";function gv(e){$.call(this,null,e)}gv.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:_A}]};const b8=P(gv,$);b8.transform=function(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=pv(t.source,e.groupby,Yt),r=e.smooth||!1,a=e.field,o=e.step||w8(n,a),s=oo((p,g)=>a(p)-a(g)),l=e.as||_A,u=i.length;let c=Infinity,f=-Infinity,d=0,h;for(;d<u;++d){const p=i[d].sort(s);h=-1;for(const g of rA(p,o,r,a))g<c&&(c=g),g>f&&(f=g),p[++h][l]=g}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(l)};function w8(e,t){return td(vr(e,t))/30}function AA(e){Fe.call(this,null,x8,e),this.modified(!0)}P(AA,Fe);function x8(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:Rn(n=>t(n,e),Ht(t),et(t))}function mv(e){$.call(this,[void 0,void 0],e)}mv.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};var E8=P(mv,$);E8.transform=function(e,t){var n=this.value,i=e.field,r=n[0],a=n[1],o;if(o=t.changed()||t.modified(i.fields)||e.modified("field"),(o||r==null)&&(r=Infinity,a=-Infinity),t.visit(o?t.SOURCE:t.ADD,function(s){var l=fn(i(s));l!=null&&(l<r&&(r=l),l>a&&(a=l))}),!Number.isFinite(r)||!Number.isFinite(a)){let s=et(i);s&&(s=` for field "${s}"`),t.dataflow.warn(`Infinite extent${s}: [${r}, ${a}]`),r=a=void 0}this.value=[r,a]};function vv(e,t){Fe.call(this,e),this.parent=t,this.count=0}var Is=P(vv,Fe);Is.connect=function(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},Is.add=function(e){this.count+=1,this.value.add.push(e)},Is.rem=function(e){this.count-=1,this.value.rem.push(e)},Is.mod=function(e){this.value.mod.push(e)},Is.init=function(e){this.value.init(e,e.NO_SOURCE)},Is.evaluate=function(){return this.value};function Dd(e){$.call(this,{},e),this._keys=Ql();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}const xu=P(Dd,$);xu.activate=function(e){this._targets[this._targets.active++]=e},xu.subflow=function(e,t,n,i){let r=this.value,a=Q(r,e)&&r[e],o,s;return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=i||(s=this._group[e])&&s.tuple,o=n.dataflow,a=new vv(n.fork(n.NO_SOURCE),this),o.add(a).connect(t(o,e,s)),r[e]=a,this.activate(a)),a},xu.clean=function(){const e=this.value;for(const t in e)if(e[t].count===0){const n=e[t].detachSubflow;n&&n(),delete e[t]}},xu.initTargets=function(){const e=this._targets,t=e.length;for(let n=0;n<t&&e[n]!=null;++n)e[n]=null;e.active=0},xu.transform=function(e,t){const n=t.dataflow,i=e.key,r=e.subflow,a=this._keys,o=e.modified("key"),s=l=>this.subflow(l,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,l=>{const u=ee(l),c=a.get(u);c!==void 0&&(a.delete(u),s(c).rem(l))}),t.visit(t.ADD,l=>{const u=i(l);a.set(ee(l),u),s(u).add(l)}),o||t.modified(i.fields)?t.visit(t.MOD,l=>{const u=ee(l),c=a.get(u),f=i(l);c===f?s(f).mod(l):(a.set(u,f),s(c).rem(l),s(f).add(l))}):t.changed(t.MOD)&&t.visit(t.MOD,l=>{s(a.get(ee(l))).mod(l)}),o&&t.visit(t.REFLOW,l=>{const u=ee(l),c=a.get(u),f=i(l);c!==f&&(a.set(u,f),s(c).rem(l),s(f).add(l))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t};function SA(e){Fe.call(this,null,k8,e)}P(SA,Fe);function k8(e){return this.value&&!e.modified()?this.value:I(e.name)?G(e.name).map(function(t){return Fi(t)}):Fi(e.name,e.as)}function yv(e){$.call(this,Ql(),e)}yv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};var _8=P(yv,$);_8.transform=function(e,t){var n=t.dataflow,i=this.value,r=t.fork(),a=r.add,o=r.rem,s=r.mod,l=e.expr,u=!0;t.visit(t.REM,function(f){var d=ee(f);i.has(d)?i.delete(d):o.push(f)}),t.visit(t.ADD,function(f){l(f,e)?a.push(f):i.set(ee(f),1)});function c(f){var d=ee(f),h=l(f,e),p=i.get(d);h&&p?(i.delete(d),a.push(f)):!h&&!p?(i.set(d,1),o.push(f)):u&&h&&!p&&s.push(f)}return t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r};function bv(e){$.call(this,[],e)}bv.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};var A8=P(bv,$);A8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=kA(i,e.as||[]),a=e.index||null,o=r.length;return n.rem=this.value,t.visit(t.SOURCE,function(s){for(var l=i.map(p=>p(s)),u=l.reduce((p,g)=>Math.max(p,g.length),0),c=0,f,d,h;c<u;++c){for(d=Km(s),f=0;f<o;++f)d[r[f]]=(h=l[f][c])==null?null:h;a&&(d[a]=c),n.add.push(d)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)};function wv(e){$.call(this,[],e)}wv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};var S8=P(wv,$);S8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(et),a=e.as||["key","value"],o=a[0],s=a[1],l=i.length;return n.rem=this.value,t.visit(t.SOURCE,function(u){for(var c=0,f;c<l;++c)f=Km(u),f[o]=r[c],f[s]=i[c](u),n.add.push(f)}),this.value=n.source=n.add,n.modifies(a)};function xv(e){$.call(this,null,e)}xv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};var O8=P(xv,$);O8.transform=function(e,t){var n=e.expr,i=e.as,r=e.modified(),a=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(a,o=>o[i]=n(o,e))};function OA(e){$.call(this,[],e)}var T8=P(OA,$);T8.transform=function(e,t){var n=this.value,i=t.fork(t.ALL),r=e.size-n.length,a=e.generator,o,s,l;if(r>0){for(o=[];--r>=0;)o.push(l=ke(a(e))),n.push(l);i.add=i.add.length?i.materialize(i.ADD).add.concat(o):o}else s=n.slice(0,-r),i.rem=i.rem.length?i.materialize(i.REM).rem.concat(s):s,n=n.slice(-r);return i.source=this.value=n,i};var Rd={value:"value",median:Ik,mean:Y5,min:f0,max:uo},C8=[];function Ev(e){$.call(this,[],e)}Ev.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var $8=P(Ev,$);function D8(e){var t=e.method||Rd.value,n;if(Rd[t]==null)F("Unrecognized imputation method: "+t);else return t===Rd.value?(n=e.value!==void 0?e.value:0,function(){return n}):Rd[t]}function R8(e){var t=e.field;return function(n){return n?t(n):NaN}}$8.transform=function(e,t){var n=t.fork(t.ALL),i=D8(e),r=R8(e),a=et(e.field),o=et(e.key),s=(e.groupby||[]).map(et),l=F8(t.source,e.groupby,e.key,e.keyvals),u=[],c=this.value,f=l.domain.length,d,h,p,g,m,v,y,b,E,x;for(m=0,b=l.length;m<b;++m)for(d=l[m],p=d.values,h=NaN,y=0;y<f;++y){if(d[y]!=null)continue;for(g=l.domain[y],x={_impute:!0},v=0,E=p.length;v<E;++v)x[s[v]]=p[v];x[o]=g,x[a]=Number.isNaN(h)?h=i(d,r):h,u.push(ke(x))}return u.length&&(n.add=n.materialize(n.ADD).add.concat(u)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=u,n};function F8(e,t,n,i){var r=function(v){return v(m)},a=[],o=i?i.slice():[],s={},l={},u,c,f,d,h,p,g,m;for(o.forEach(function(v,y){s[v]=y+1}),d=0,g=e.length;d<g;++d)m=e[d],p=n(m),h=s[p]||(s[p]=o.push(p)),c=(u=t?t.map(r):C8)+"",(f=l[c])||(f=l[c]=[],a.push(f),f.values=u),f[h-1]=m;return a.domain=o,a}function kv(e){vo.call(this,e)}kv.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:vu},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var TA=P(kv,vo);TA.transform=function(e,t){var n=this,i=e.modified(),r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,function(a){n.add(a)})):(r=n.value=n.value||this.init(e),t.visit(t.REM,function(a){n.rem(a)}),t.visit(t.ADD,function(a){n.add(a)})),n.changes(),t.visit(t.SOURCE,function(a){fe(a,r[n.cellkey(a)].tuple)}),t.reflow(i).modifies(this._outputs)},TA.changes=function(){var e=this._adds,t=this._mods,n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0};function _v(e){$.call(this,null,e)}_v.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};var N8=P(_v,$);N8.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=pv(i,e.groupby,e.field),a=(e.groupby||[]).map(et),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;s!=="pdf"&&s!=="cdf"&&F("Invalid density method: "+s),e.resolve==="shared"&&(c||(c=vr(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const p=J0(h,o)[s],g=e.counts?h.length:1,m=c||vr(h);$d(p,m,f,d).forEach(v=>{const y={};for(let b=0;b<a.length;++b)y[a[b]]=h.dims[b];y[l[0]]=v[0],y[l[1]]=v[1]*g,u.push(ke(y))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function CA(e){Fe.call(this,null,I8,e)}P(CA,Fe);function I8(e){return this.value&&!e.modified()?this.value:dk(e.fields,e.flat)}function $A(e){$.call(this,[],e),this._pending=null}var M8=P($A,$);M8.transform=function(e,t){const n=t.dataflow;if(this._pending)return Av(this,t,this._pending);if(j8(e))return t.StopPropagation;if(e.values)return Av(this,t,n.parse(e.values,e.format));if(e.async){const i=n.request(e.url,e.format).then(r=>(this._pending=G(r.data),a=>a.touch(this)));return{async:i}}else return n.request(e.url,e.format).then(i=>Av(this,t,G(i.data)))};function j8(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Av(e,t,n){n.forEach(ke);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Sv(e){$.call(this,{},e)}Sv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};var L8=P(Sv,$);L8.transform=function(e,t){var n=t,i=e.as,r=e.fields,a=e.index,o=e.values,s=e.default==null?null:e.default,l=e.modified(),u=l?t.SOURCE:t.ADD,c=r.length,f,d,h;return o?(d=o.length,c>1&&!i&&F('Multi-field lookup requires explicit "as" parameter.'),i&&i.length!==c*d&&F('The "as" parameter has too few output field names.'),i=i||o.map(et),f=function(p){for(var g=0,m=0,v,y;g<c;++g)if(y=a.get(r[g](p)),y==null)for(v=0;v<d;++v,++m)p[i[m]]=s;else for(v=0;v<d;++v,++m)p[i[m]]=o[v](y)}):(i||F("Missing output field names."),f=function(p){for(var g=0,m;g<c;++g)m=a.get(r[g](p)),p[i[g]]=m??s}),l?n=t.reflow(!0):(h=r.some(function(p){return t.modified(p.fields)}),u|=h?t.MOD:0),t.visit(u,f),n.modifies(i)};function DA(e){Fe.call(this,null,P8,e)}P(DA,Fe);function P8(e){if(this.value&&!e.modified())return this.value;var t=Infinity,n=-Infinity,i=e.extents,r,a,o;for(r=0,a=i.length;r<a;++r)o=i[r],o[0]<t&&(t=o[0]),o[1]>n&&(n=o[1]);return[t,n]}function RA(e){Fe.call(this,null,z8,e)}P(RA,Fe);function z8(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(t,n){return t.concat(n)},[])}function Ov(e){$.call(this,null,e)}P(Ov,$),Ov.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)};function Tv(e){vo.call(this,e)}Tv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:vu,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var Cv=P(Tv,vo);Cv._transform=Cv.transform,Cv.transform=function(e,t){return this._transform(B8(e,t),t)};function B8(e,t){var n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",a=Ht(n).concat(Ht(i)),o=q8(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(function(){return r}),fields:o.map(function(s){return U8(s,n,i,a)}),as:o.map(function(s){return s+""}),modified:e.modified.bind(e)}}function U8(e,t,n,i){return Rn(function(r){return t(r)===e?n(r):NaN},i,e+"")}function q8(e,t,n){var i={},r=[];return n.visit(n.SOURCE,function(a){var o=e(a);i[o]||(i[o]=1,r.push(o))}),r.sort(function(a,o){return(a<o||a==null)&&o!=null?-1:(a>o||o==null)&&a!=null?1:(o=o instanceof Date?+o:o,a=a instanceof Date?+a:a)!==a&&o===o?-1:o!==o&&a===a?1:0}),t?r.slice(0,t):r}function FA(e){Dd.call(this,e)}const W8=P(FA,Dd);W8.transform=function(e,t){const n=e.subflow,i=e.field,r=a=>this.subflow(ee(a),n,t,a);return(e.modified("field")||i&&t.modified(Ht(i)))&&F("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,a=>{const o=r(a);i(a).forEach(s=>o.mod(s))}),t.visit(t.ADD,a=>{const o=r(a);i(a).forEach(s=>o.add(ke(s)))}),t.visit(t.REM,a=>{const o=r(a);i(a).forEach(s=>o.rem(s))})):(t.visit(t.MOD,a=>r(a).mod(a)),t.visit(t.ADD,a=>r(a).add(a)),t.visit(t.REM,a=>r(a).rem(a))),t.clean()&&t.runAfter(()=>this.clean()),t};function $v(e){$.call(this,null,e)}$v.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};var G8=P($v,$);G8.transform=function(e,t){var n=e.fields,i=kA(e.fields,e.as||[]),r=n?function(s,l){return H8(s,l,n,i)}:Qm,a,o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),a=t.fork(t.NO_SOURCE),t.visit(t.REM,function(s){var l=ee(s);a.rem.push(o[l]),o[l]=null}),t.visit(t.ADD,function(s){var l=r(s,ke({}));o[ee(s)]=l,a.add.push(l)}),t.visit(t.MOD,function(s){a.mod.push(r(s,o[ee(s)]))}),a};function H8(e,t,n,i){for(var r=0,a=n.length;r<a;++r)t[i[r]]=n[r](e);return t}function NA(e){$.call(this,null,e)}var Y8=P(NA,$);Y8.transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Dv(e){$.call(this,null,e)}Dv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var V8=P(Dv,$),X8=1e-14;V8.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,a=pv(r,e.groupby,e.field),o=(e.groupby||[]).map(et),s=[],l=e.step||.01,u=e.probs||lo(l/2,1-X8,l),c=u.length;return a.forEach(f=>{const d=G0(f,u);for(let h=0;h<c;++h){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[i[0]]=u[h],p[i[1]]=d[h],s.push(ke(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n};function IA(e){$.call(this,null,e)}var J8=P(IA,$);J8.transform=function(e,t){var n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{var a=ee(r);n.rem.push(i[a]),i[a]=null}),t.visit(t.ADD,r=>{var a=Km(r);i[ee(r)]=a,n.add.push(a)}),t.visit(t.MOD,r=>{var a=i[ee(r)],o;for(o in r)a[o]=r[o],n.modifies(o);n.mod.push(a)})),n};function Rv(e){$.call(this,[],e),this.count=0}Rv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var K8=P(Rv,$);K8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,a=this.value,o=this.count,s=0,l=a.reduce(function(d,h){return d[ee(h)]=1,d},{});function u(d){var h,p;a.length<r?a.push(d):(p=~~((o+1)*Wn()),p<a.length&&p>=s&&(h=a[p],l[ee(h)]&&n.rem.push(h),a[p]=d)),++o}if(t.rem.length&&(t.visit(t.REM,function(d){var h=ee(d);l[h]&&(l[h]=-1,n.rem.push(d)),--o}),a=a.filter(function(d){return l[ee(d)]!==-1})),(t.rem.length||i)&&a.length<r&&t.source&&(s=o=a.length,t.visit(t.SOURCE,function(d){l[ee(d)]||u(d)}),s=-1),i&&a.length>r){for(var c=0,f=a.length-r;c<f;++c)l[ee(a[c])]=-1,n.rem.push(a[c]);a=a.slice(f)}return t.mod.length&&t.visit(t.MOD,function(d){l[ee(d)]&&n.mod.push(d)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||s<0)&&(n.add=a.filter(function(d){return!l[ee(d)]})),this.count=o,this.value=n.source=a,n};function Fv(e){$.call(this,null,e)}Fv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var Q8=P(Fv,$);Q8.transform=function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=lo(e.start,e.stop,e.step||1).map(function(r){var a={};return a[i]=r,ke(a)}),n.add=t.add.concat(this.value),n};function MA(e){$.call(this,null,e),this.modified(!0)}var Z8=P(MA,$);Z8.transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Nv(e){$.call(this,null,e)}const jA=["unit0","unit1"];Nv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:g0,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:jA}]};var LA=P(Nv,$);LA.transform=function(e,t){var n=e.field,i=e.interval!==!1,r=e.timezone==="utc",a=this._floor(e,t),o=(r?Ts:Os)(a.unit).offset,s=e.as||jA,l=s[0],u=s[1],c=a.start||Infinity,f=a.stop||-Infinity,d=a.step,h=t.ADD;return(e.modified()||t.modified(Ht(n)))&&(t=t.reflow(!0),h=t.SOURCE,c=Infinity,f=-Infinity),t.visit(h,function(p){var g=n(p),m,v;g==null?(p[l]=null,i&&(p[u]=null)):(p[l]=m=v=a(g),i&&(p[u]=v=o(m,d)),m<c&&(c=m),v>f&&(f=v))}),a.start=c,a.stop=f,t.modifies(i?s:l)},LA._floor=function(e,t){const n=e.timezone==="utc";let{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:E_({extent:e.extent||vr(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins});i=v0(i);const a=this.value||{},o=(n?f_:c_)(i,r);return o.unit=ve(i),o.units=i,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o};function PA(e){$.call(this,Ql(),e)}var e9=P(PA,$);e9.transform=function(e,t){var n=t.dataflow,i=e.field,r=this.value,a=!0;function o(s){r.set(i(s),s)}return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,function(s){r.delete(i(s))}),t.visit(t.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()};function zA(e){$.call(this,null,e)}var t9=P(zA,$);t9.transform=function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);n&&(this.value=(e.sort?t.source.slice().sort(oo(e.sort)):t.source).map(e.field))};function n9(e,t,n,i){let r=Eu[e](t,n);return{init:r.init||to,update:function(a,o){o[i]=r.next(a)}}}const Eu={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){let e=Eu.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{let n=t.index,i=t.data,r=t.compare;if(e<n){for(;n+1<i.length&&!r(i[n],i[n+1]);)++n;e=n}return(1+e)/i.length}}},ntile:function(e,t){t=+t,t>0||F("ntile num must be greater than zero.");let n=Eu.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{let i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{let i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||F("nth_value nth must be greater than zero."),{next:n=>{let i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{let i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{let r=i.data;return i.index<=n?t:(n=i9(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function i9(e,t,n){for(let i=t.length;n<i;++n){let r=e(t[n]);if(r!=null)return n}return-1}var r9=Object.keys(Eu);function BA(e){let t=this,n=G(e.ops),i=G(e.fields),r=G(e.params),a=G(e.as),o=t.outputs=[],s=t.windows=[],l={},u={},c=!0,f=[],d=[];function h(p){G(Ht(p)).forEach(g=>l[g]=1)}h(e.sort),n.forEach(function(p,g){let m=i[g],v=et(m),y=K_(p,v,a[g]);if(h(m),o.push(y),Q(Eu,p))s.push(n9(p,i[g],r[g],y));else{if(m==null&&p!=="count"&&F("Null aggregate field specified."),p==="count"){f.push(y);return}c=!1;let b=u[v];b||(b=u[v]=[],b.field=m,d.push(b)),b.push(Q_(p,y))}}),(f.length||d.length)&&(t.cell=a9(d,f,c)),t.inputs=Object.keys(l)}const UA=BA.prototype;UA.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},UA.update=function(e,t){let n=this,i=n.cell,r=n.windows,a=e.data,o=r&&r.length,s;if(i){for(s=e.p0;s<e.i0;++s)i.rem(a[s]);for(s=e.p1;s<e.i1;++s)i.add(a[s]);i.set(t)}for(s=0;s<o;++s)r[s].update(e,t)};function a9(e,t,n){e=e.map(l=>eA(l,l.field));let i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,a=i.agg=Array(r),o=0;o<r;++o)a[o]=new e[o](i);if(i.store)var s=i.data=new sv();return i.add=function(l){if(i.num+=1,n)return;s&&s.add(l);for(let u=0;u<r;++u)a[u].add(a[u].get(l),l)},i.rem=function(l){if(i.num-=1,n)return;s&&s.rem(l);for(let u=0;u<r;++u)a[u].rem(a[u].get(l),l)},i.set=function(l){let u,c;for(s&&s.values(),u=0,c=t.length;u<c;++u)l[t[u]]=i.num;if(!n)for(u=0,c=a.length;u<c;++u)a[u].set(l)},i.init=function(){i.num=0,s&&s.reset();for(let l=0;l<r;++l)a[l].init()},i}function Iv(e){$.call(this,{},e),this._mlen=0,this._mods=[]}Iv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:r9.concat(vu)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var qA=P(Iv,$);qA.transform=function(e,t){var n=this,i=n.state,r=e.modified(),a=oo(e.sort),o,s;this.stamp=t.stamp,(!i||r)&&(i=n.state=new BA(e));var l=q0(e.groupby);function u(c){return n.group(l(c))}for(r||t.modified(i.inputs)?(n.value={},t.visit(t.SOURCE,function(c){u(c).add(c)})):(t.visit(t.REM,function(c){u(c).remove(c)}),t.visit(t.ADD,function(c){u(c).add(c)})),o=0,s=n._mlen;o<s;++o)o9(n._mods[o],i,a,e);return n._mlen=0,n._mods=[],t.reflow(r).modifies(i.outputs)},qA.group=function(e){var t=this,n=t.value[e];return n||(n=t.value[e]=vA(ee),n.stamp=-1),n.stamp<t.stamp&&(n.stamp=t.stamp,t._mods[t._mlen++]=n),n};function o9(e,t,n,i){var r=i.sort,a=r&&!i.ignorePeers,o=i.frame||[null,0],s=e.data(n),l=s.length,u=0,c=a?cd(r):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Vt(-1)};for(t.init();u<l;++u)s9(f,o,u,l),a&&l9(f,c),t.update(f,s[u])}function s9(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function l9(e,t){var n=e.i0,i=e.i1-1,r=e.compare,a=e.data,o=a.length-1;n>0&&!r(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),i<o&&!r(a[i],a[i+1])&&(e.i1=t.right(a,a[i]))}var u9=Object.freeze({__proto__:null,aggregate:vo,bin:lv,collect:uv,compare:yA,countpattern:cv,cross:dv,density:hv,dotbin:gv,expression:AA,extent:mv,facet:Dd,field:SA,filter:yv,flatten:bv,fold:wv,formula:xv,generate:OA,impute:Ev,joinaggregate:kv,kde:_v,key:CA,load:$A,lookup:Sv,multiextent:DA,multivalues:RA,params:Ov,pivot:Tv,prefacet:FA,project:$v,proxy:NA,quantile:Dv,relay:IA,sample:Rv,sequence:Fv,sieve:MA,subflow:vv,timeunit:Nv,tupleindex:PA,values:zA,window:Iv});const Ms="top",di="left",hi="right",aa="bottom",c9="top-left",f9="top-right",d9="bottom-left",h9="bottom-right",Mv="start",jv="middle",Xt="end",p9="x",g9="y",Fd="group",Lv="axis",Pv="title",m9="frame",v9="scope",zv="legend",WA="row-header",GA="row-footer",HA="row-title",YA="column-header",VA="column-footer",XA="column-title",y9="padding",b9="symbol",JA="fit",w9="fit-x",x9="fit-y",E9="pad",Bv="none",Nd="all",Uv="each",qv="flush",oa="column",sa="row";var KA=0;function k9(){KA=0}const Id="p_";function Wv(e){return e&&e.gradient}function QA(e,t,n){let i=e.id,r=e.gradient,a=r==="radial"?Id:"";return i||(i=e.id="gradient_"+KA++,r==="radial"?(e.x1=ji(e.x1,.5),e.y1=ji(e.y1,.5),e.r1=ji(e.r1,0),e.x2=ji(e.x2,.5),e.y2=ji(e.y2,.5),e.r2=ji(e.r2,.5),a=Id):(e.x1=ji(e.x1,0),e.y1=ji(e.y1,0),e.x2=ji(e.x2,1),e.y2=ji(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function ji(e,t){return e??t}function ZA(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,a){return n.push({offset:r,color:a}),i}}}var Gv=Math.PI,Hv=2*Gv,yo=1e-6,_9=Hv-yo;function Yv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function bo(){return new Yv()}Yv.prototype=bo.prototype={constructor:Yv,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var a=this._x1,o=this._y1,s=n-e,l=i-t,u=a-e,c=o-t,f=u*u+c*c;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>yo)if(!(Math.abs(c*s-l*u)>yo)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-a,h=i-o,p=s*s+l*l,g=d*d+h*h,m=Math.sqrt(p),v=Math.sqrt(f),y=r*Math.tan((Gv-Math.acos((p+f-g)/(2*m*v)))/2),b=y/v,E=y/m;Math.abs(b-1)>yo&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+E*s)+","+(this._y1=t+E*l)}},arc:function(e,t,n,i,r,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(i),s=n*Math.sin(i),l=e+o,u=t+s,c=1^a,f=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null?this._+="M"+l+","+u:(Math.abs(this._x1-l)>yo||Math.abs(this._y1-u)>yo)&&(this._+="L"+l+","+u),!n)return;f<0&&(f=f%Hv+Hv),f>_9?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>yo&&(this._+="A"+n+","+n+",0,"+ +(f>=Gv)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r)))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function je(e){return function(){return e}}var eS=Math.abs,Mt=Math.atan2,wo=Math.cos,A9=Math.max,Vv=Math.min,Li=Math.sin,js=Math.sqrt,jt=1e-12,Ls=Math.PI,Md=Ls/2,tS=2*Ls;function S9(e){return e>1?0:e<-1?Ls:Math.acos(e)}function nS(e){return e>=1?Md:e<=-1?-Md:Math.asin(e)}function O9(e){return e.innerRadius}function T9(e){return e.outerRadius}function C9(e){return e.startAngle}function $9(e){return e.endAngle}function D9(e){return e&&e.padAngle}function R9(e,t,n,i,r,a,o,s){var l=n-e,u=i-t,c=o-r,f=s-a,d=f*l-c*u;return d*d<jt?void 0:(d=(c*(t-a)-f*(e-r))/d,[e+d*l,t+d*u])}function jd(e,t,n,i,r,a,o){var s=e-n,l=t-i,u=(o?a:-a)/js(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,g=i+f,m=(d+p)/2,v=(h+g)/2,y=p-d,b=g-h,E=y*y+b*b,x=r-a,k=d*g-p*h,w=(b<0?-1:1)*js(A9(0,x*x*E-k*k)),A=(k*b-y*w)/E,_=(-k*y-b*w)/E,O=(k*b+y*w)/E,S=(-k*y+b*w)/E,T=A-m,D=_-v,M=O-m,C=S-v;return T*T+D*D>M*M+C*C&&(A=O,_=S),{cx:A,cy:_,x01:-c,y01:-f,x11:A*(r/x-1),y11:_*(r/x-1)}}function F9(){var e=O9,t=T9,n=je(0),i=null,r=C9,a=$9,o=D9,s=null;function l(){var u,c,f=+e.apply(this,arguments),d=+t.apply(this,arguments),h=r.apply(this,arguments)-Md,p=a.apply(this,arguments)-Md,g=eS(p-h),m=p>h;if(s||(s=u=bo()),d<f&&(c=d,d=f,f=c),!(d>jt))s.moveTo(0,0);else if(g>tS-jt)s.moveTo(d*wo(h),d*Li(h)),s.arc(0,0,d,h,p,!m),f>jt&&(s.moveTo(f*wo(p),f*Li(p)),s.arc(0,0,f,p,h,m));else{var v=h,y=p,b=h,E=p,x=g,k=g,w=o.apply(this,arguments)/2,A=w>jt&&(i?+i.apply(this,arguments):js(f*f+d*d)),_=Vv(eS(d-f)/2,+n.apply(this,arguments)),O=_,S=_,T,D;if(A>jt){var M=nS(A/f*Li(w)),C=nS(A/d*Li(w));(x-=M*2)>jt?(M*=m?1:-1,b+=M,E-=M):(x=0,b=E=(h+p)/2),(k-=C*2)>jt?(C*=m?1:-1,v+=C,y-=C):(k=0,v=y=(h+p)/2)}var N=d*wo(v),W=d*Li(v),X=f*wo(E),J=f*Li(E);if(_>jt){var xe=d*wo(y),Pe=d*Li(y),dt=f*wo(b),ht=f*Li(b),Ke;if(g<Ls&&(Ke=R9(N,W,dt,ht,xe,Pe,X,J))){var Rt=N-Ke[0],ui=W-Ke[1],Va=xe-Ke[0],Xr=Pe-Ke[1],H=1/Li(S9((Rt*Va+ui*Xr)/(js(Rt*Rt+ui*ui)*js(Va*Va+Xr*Xr)))/2),ue=js(Ke[0]*Ke[0]+Ke[1]*Ke[1]);O=Vv(_,(f-ue)/(H-1)),S=Vv(_,(d-ue)/(H+1))}}k>jt?S>jt?(T=jd(dt,ht,N,W,d,S,m),D=jd(xe,Pe,X,J,d,S,m),s.moveTo(T.cx+T.x01,T.cy+T.y01),S<_?s.arc(T.cx,T.cy,S,Mt(T.y01,T.x01),Mt(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,S,Mt(T.y01,T.x01),Mt(T.y11,T.x11),!m),s.arc(0,0,d,Mt(T.cy+T.y11,T.cx+T.x11),Mt(D.cy+D.y11,D.cx+D.x11),!m),s.arc(D.cx,D.cy,S,Mt(D.y11,D.x11),Mt(D.y01,D.x01),!m))):(s.moveTo(N,W),s.arc(0,0,d,v,y,!m)):s.moveTo(N,W),!(f>jt)||!(x>jt)?s.lineTo(X,J):O>jt?(T=jd(X,J,xe,Pe,f,-O,m),D=jd(N,W,dt,ht,f,-O,m),s.lineTo(T.cx+T.x01,T.cy+T.y01),O<_?s.arc(T.cx,T.cy,O,Mt(T.y01,T.x01),Mt(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,O,Mt(T.y01,T.x01),Mt(T.y11,T.x11),!m),s.arc(0,0,f,Mt(T.cy+T.y11,T.cx+T.x11),Mt(D.cy+D.y11,D.cx+D.x11),m),s.arc(D.cx,D.cy,O,Mt(D.y11,D.x11),Mt(D.y01,D.x01),!m))):s.arc(0,0,f,E,b,m)}if(s.closePath(),u)return s=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-Ls/2;return[wo(c)*u,Li(c)*u]},l.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:je(+u),l):e},l.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:je(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:je(+u),l):n},l.padRadius=function(u){return arguments.length?(i=u==null?null:typeof u=="function"?u:je(+u),l):i},l.startAngle=function(u){return arguments.length?(r=typeof u=="function"?u:je(+u),l):r},l.endAngle=function(u){return arguments.length?(a=typeof u=="function"?u:je(+u),l):a},l.padAngle=function(u){return arguments.length?(o=typeof u=="function"?u:je(+u),l):o},l.context=function(u){return arguments.length?(s=u??null,l):s},l}function iS(e){this._context=e}iS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Xv(e){return new iS(e)}function rS(e){return e[0]}function aS(e){return e[1]}function oS(){var e=rS,t=aS,n=je(!0),i=null,r=Xv,a=null;function o(s){var l,u=s.length,c,f=!1,d;for(i==null&&(a=r(d=bo())),l=0;l<=u;++l)!(l<u&&n(c=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(c,l,s),+t(c,l,s));if(d)return a=null,d+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:je(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:je(+s),o):t},o.defined=function(s){return arguments.length?(n=typeof s=="function"?s:je(!!s),o):n},o.curve=function(s){return arguments.length?(r=s,i!=null&&(a=r(i)),o):r},o.context=function(s){return arguments.length?(s==null?i=a=null:a=r(i=s),o):i},o}function sS(){var e=rS,t=null,n=je(0),i=aS,r=je(!0),a=null,o=Xv,s=null;function l(c){var f,d,h,p=c.length,g,m=!1,v,y=new Array(p),b=new Array(p);for(a==null&&(s=o(v=bo())),f=0;f<=p;++f){if(!(f<p&&r(g=c[f],f,c))===m)if(m=!m)d=f,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=f-1;h>=d;--h)s.point(y[h],b[h]);s.lineEnd(),s.areaEnd()}m&&(y[f]=+e(g,f,c),b[f]=+n(g,f,c),s.point(t?+t(g,f,c):y[f],i?+i(g,f,c):b[f]))}if(v)return s=null,v+""||null}function u(){return oS().defined(r).curve(o).context(a)}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),t=null,l):e},l.x0=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),l):e},l.x1=function(c){return arguments.length?(t=c==null?null:typeof c=="function"?c:je(+c),l):t},l.y=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),i=null,l):n},l.y0=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),l):n},l.y1=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:je(+c),l):i},l.lineX0=l.lineY0=function(){return u().x(e).y(n)},l.lineY1=function(){return u().x(e).y(i)},l.lineX1=function(){return u().x(t).y(n)},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:je(!!c),l):r},l.curve=function(c){return arguments.length?(o=c,a!=null&&(s=o(a)),l):o},l.context=function(c){return arguments.length?(c==null?a=s=null:s=o(a=c),l):a},l}var N9={draw:function(e,t){var n=Math.sqrt(t/Ls);e.moveTo(n,0),e.arc(0,0,n,0,tS)}};function I9(){var e=je(N9),t=je(64),n=null;function i(){var r;if(n||(n=r=bo()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(e=typeof r=="function"?r:je(r),i):e},i.size=function(r){return arguments.length?(t=typeof r=="function"?r:je(+r),i):t},i.context=function(r){return arguments.length?(n=r??null,i):n},i}function la(){}function Ld(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Pd(e){this._context=e}Pd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ld(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ld(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function M9(e){return new Pd(e)}function lS(e){this._context=e}lS.prototype={areaStart:la,areaEnd:la,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Ld(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function j9(e){return new lS(e)}function uS(e){this._context=e}uS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Ld(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function L9(e){return new uS(e)}function cS(e,t){this._basis=new Pd(e),this._beta=t}cS.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],a=e[n]-i,o=t[n]-r,s=-1,l;++s<=n;)l=s/n,this._basis.point(this._beta*e[s]+(1-this._beta)*(i+l*a),this._beta*t[s]+(1-this._beta)*(r+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var P9=function e(t){function n(i){return t===1?new Pd(i):new cS(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function zd(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Jv(e,t){this._context=e,this._k=(1-t)/6}Jv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:zd(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:zd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var z9=function e(t){function n(i){return new Jv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Kv(e,t){this._context=e,this._k=(1-t)/6}Kv.prototype={areaStart:la,areaEnd:la,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:zd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var B9=function e(t){function n(i){return new Kv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Qv(e,t){this._context=e,this._k=(1-t)/6}Qv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:zd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var U9=function e(t){function n(i){return new Qv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Zv(e,t,n){var i=e._x1,r=e._y1,a=e._x2,o=e._y2;if(e._l01_a>jt){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>jt){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,a,o,e._x2,e._y2)}function fS(e,t){this._context=e,this._alpha=t}fS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Zv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var q9=function e(t){function n(i){return t?new fS(i,t):new Jv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function dS(e,t){this._context=e,this._alpha=t}dS.prototype={areaStart:la,areaEnd:la,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Zv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var W9=function e(t){function n(i){return t?new dS(i,t):new Kv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function hS(e,t){this._context=e,this._alpha=t}hS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Zv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var G9=function e(t){function n(i){return t?new hS(i,t):new Qv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function pS(e){this._context=e}pS.prototype={areaStart:la,areaEnd:la,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function H9(e){return new pS(e)}function gS(e){return e<0?-1:1}function mS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,a=(e._y1-e._y0)/(i||r<0&&-0),o=(n-e._y1)/(r||i<0&&-0),s=(a*r+o*i)/(i+r);return(gS(a)+gS(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function vS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function ey(e,t,n){var i=e._x0,r=e._y0,a=e._x1,o=e._y1,s=(a-i)/3;e._context.bezierCurveTo(i+s,r+s*t,a-s,o-s*n,a,o)}function Bd(e){this._context=e}Bd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ey(this,this._t0,vS(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ey(this,vS(this,n=mS(this,e,t)),n);break;default:ey(this,this._t0,n=mS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}};function yS(e){this._context=new bS(e)}(yS.prototype=Object.create(Bd.prototype)).point=function(e,t){Bd.prototype.point.call(this,t,e)};function bS(e){this._context=e}bS.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,a){this._context.bezierCurveTo(t,e,i,n,a,r)}};function Y9(e){return new Bd(e)}function V9(e){return new yS(e)}function wS(e){this._context=e}wS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=xS(e),r=xS(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(i[0][a],r[0][a],i[1][a],r[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function xS(e){var t,n=e.length-1,i,r=new Array(n),a=new Array(n),o=new Array(n);for(r[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/a[t-1],a[t]-=i,o[t]-=i*o[t-1];for(r[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)r[t]=(o[t]-r[t+1])/a[t];for(a[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-r[t+1];return[r,a]}function X9(e){return new wS(e)}function Ud(e,t){this._context=e,this._t=t}Ud.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function J9(e){return new Ud(e,.5)}function K9(e){return new Ud(e,0)}function Q9(e){return new Ud(e,1)}var ES={basis:{curve:M9},"basis-closed":{curve:j9},"basis-open":{curve:L9},bundle:{curve:P9,tension:"beta",value:.85},cardinal:{curve:z9,tension:"tension",value:0},"cardinal-open":{curve:U9,tension:"tension",value:0},"cardinal-closed":{curve:B9,tension:"tension",value:0},"catmull-rom":{curve:q9,tension:"alpha",value:.5},"catmull-rom-closed":{curve:W9,tension:"alpha",value:.5},"catmull-rom-open":{curve:G9,tension:"alpha",value:.5},linear:{curve:Xv},"linear-closed":{curve:H9},monotone:{horizontal:V9,vertical:Y9},natural:{curve:X9},step:{curve:J9},"step-after":{curve:Q9},"step-before":{curve:K9}};function ty(e,t,n){var i=Q(ES,e)&&ES[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}var Z9={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},qd=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function Ps(e){var t=[],n,i,r,a,o,s,l,u,c,f,d;for(n=e.slice().replace(qd[0],"###$1").split(qd[1]).slice(1),u=0,f=n.length;u<f;++u){for(i=n[u],r=i.slice(1).trim().replace(qd[2],"$1###$2").split(qd[3]),s=i.charAt(0),a=[s],c=0,d=r.length;c<d;++c)(o=+r[c])===o&&a.push(o);if(l=Z9[s.toLowerCase()],a.length-1>l)for(c=1,d=a.length;c<d;c+=l)t.push([s].concat(a.slice(c,c+l)));else t.push(a)}return t}const wr=Math.PI/180,e7=1e-14,xo=Math.PI/2,Pi=Math.PI*2,zs=Math.sqrt(3)/2;var ny={},iy={},kS=[].join;function t7(e,t,n,i,r,a,o,s,l){var u=kS.call(arguments);if(ny[u])return ny[u];var c=o*wr,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);var h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5,g=h*h/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var m=d/n,v=f/n,y=-f/i,b=d/i,E=m*s+v*l,x=y*s+b*l,k=m*e+v*t,w=y*e+b*t,A=(k-E)*(k-E)+(w-x)*(w-x),_=1/A-.25;_<0&&(_=0);var O=Math.sqrt(_);a==r&&(O=-O);var S=.5*(E+k)-O*(w-x),T=.5*(x+w)+O*(k-E),D=Math.atan2(x-T,E-S),M=Math.atan2(w-T,k-S),C=M-D;C<0&&a===1?C+=Pi:C>0&&a===0&&(C-=Pi);for(var N=Math.ceil(Math.abs(C/(xo+.001))),W=[],X=0;X<N;++X){var J=D+X*C/N,xe=D+(X+1)*C/N;W[X]=[S,T,J,xe,n,i,f,d]}return ny[u]=W}function n7(e){var t=kS.call(e);if(iy[t])return iy[t];var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(r),g=Math.sin(r),m=Math.cos(a),v=Math.sin(a),y=.5*(a-r),b=Math.sin(y*.5),E=8/3*b*b/Math.sin(y),x=n+p-E*g,k=i+g+E*p,w=n+m,A=i+v,_=w+E*v,O=A-E*m;return iy[t]=[c*x+f*k,d*x+h*k,c*_+f*O,d*_+h*O,c*w+f*A,d*w+h*A]}var Hn=["l",0,0,0,0,0,0,0];function i7(e,t,n){var i=Hn[0]=e[0];if(i==="a"||i==="A")Hn[1]=t*e[1],Hn[2]=n*e[2],Hn[3]=e[3],Hn[4]=e[4],Hn[5]=e[5],Hn[6]=t*e[6],Hn[7]=n*e[7];else if(i==="h"||i==="H")Hn[1]=t*e[1];else if(i==="v"||i==="V")Hn[1]=n*e[1];else for(var r=1,a=e.length;r<a;++r)Hn[r]=(r%2==1?t:n)*e[r];return Hn}function ku(e,t,n,i,r,a){var o,s=null,l=0,u=0,c=0,f=0,d,h,p,g;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),a==null&&(a=r),e.beginPath&&e.beginPath();for(var m=0,v=t.length;m<v;++m){o=t[m],(r!==1||a!==1)&&(o=i7(o,r,a));switch(o[0]){case"l":l+=o[1],u+=o[2],e.lineTo(l+n,u+i);break;case"L":l=o[1],u=o[2],e.lineTo(l+n,u+i);break;case"h":l+=o[1],e.lineTo(l+n,u+i);break;case"H":l=o[1],e.lineTo(l+n,u+i);break;case"v":u+=o[1],e.lineTo(l+n,u+i);break;case"V":u=o[1],e.lineTo(l+n,u+i);break;case"m":l+=o[1],u+=o[2],e.moveTo(l+n,u+i);break;case"M":l=o[1],u=o[2],e.moveTo(l+n,u+i);break;case"c":d=l+o[5],h=u+o[6],c=l+o[3],f=u+o[4],e.bezierCurveTo(l+o[1]+n,u+o[2]+i,c+n,f+i,d+n,h+i),l=d,u=h;break;case"C":l=o[5],u=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+i,c+n,f+i,l+n,u+i);break;case"s":d=l+o[3],h=u+o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,l+o[1]+n,u+o[2]+i,d+n,h+i),c=l+o[1],f=u+o[2],l=d,u=h;break;case"S":d=o[3],h=o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"q":d=l+o[3],h=u+o[4],c=l+o[1],f=u+o[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"Q":d=o[3],h=o[4],e.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"t":d=l+o[1],h=u+o[2],s[0].match(/[QqTt]/)===null?(c=l,f=u):s[0]==="t"?(c=2*l-p,f=2*u-g):s[0]==="q"&&(c=2*l-c,f=2*u-f),p=c,g=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h,c=l+o[1],f=u+o[2];break;case"T":d=o[1],h=o[2],c=2*l-c,f=2*u-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"a":_S(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+l+n,o[7]+u+i]),l+=o[6],u+=o[7];break;case"A":_S(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),l=o[6],u=o[7];break;case"z":case"Z":e.closePath();break}s=o}}function _S(e,t,n,i){for(var r=t7(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n),a=0;a<r.length;++a){var o=n7(r[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var AS=.5773502691896257,SS={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Pi)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,a=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-a),e.lineTo(r,-a),e.lineTo(0,-n),e.lineTo(-r,-a),e.lineTo(-i,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=zs*n,r=i-n*AS,a=n/4;e.moveTo(0,-i-r),e.lineTo(-a,i-r),e.lineTo(a,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=zs*n,r=i-n*AS;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=zs*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=zs*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=zs*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=zs*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function OS(e){return Q(SS,e)?SS[e]:r7(e)}var ry={};function r7(e){if(!Q(ry,e)){var t=Ps(e);ry[e]={draw:function(n,i){ku(n,t,0,0,Math.sqrt(i)/2)}}}return ry[e]}const ua=.448084975506;function a7(e){return e.x}function o7(e){return e.y}function s7(e){return e.width}function l7(e){return e.height}function xr(e){return typeof e=="function"?e:()=>+e}function Wd(e,t,n){return Math.max(t,Math.min(e,n))}function TS(){var e=a7,t=o7,n=s7,i=l7,r=xr(0),a=r,o=r,s=r,l=null;function u(c,f,d){var h,p=f??+e.call(this,c),g=d??+t.call(this,c),m=+n.call(this,c),v=+i.call(this,c),y=Math.min(m,v)/2,b=Wd(+r.call(this,c),0,y),E=Wd(+a.call(this,c),0,y),x=Wd(+o.call(this,c),0,y),k=Wd(+s.call(this,c),0,y);if(l||(l=h=bo()),b<=0&&E<=0&&x<=0&&k<=0)l.rect(p,g,m,v);else{var w=p+m,A=g+v;l.moveTo(p+b,g),l.lineTo(w-E,g),l.bezierCurveTo(w-ua*E,g,w,g+ua*E,w,g+E),l.lineTo(w,A-k),l.bezierCurveTo(w,A-ua*k,w-ua*k,A,w-k,A),l.lineTo(p+x,A),l.bezierCurveTo(p+ua*x,A,p,A-ua*x,p,A-x),l.lineTo(p,g+b),l.bezierCurveTo(p,g+ua*b,p+ua*b,g,p+b,g),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(c){return arguments.length?(e=xr(c),u):e},u.y=function(c){return arguments.length?(t=xr(c),u):t},u.width=function(c){return arguments.length?(n=xr(c),u):n},u.height=function(c){return arguments.length?(i=xr(c),u):i},u.cornerRadius=function(c,f,d,h){return arguments.length?(r=xr(c),a=f!=null?xr(f):r,s=d!=null?xr(d):r,o=h!=null?xr(h):a,u):r},u.context=function(c){return arguments.length?(l=c??null,u):l},u}function CS(){var e,t,n,i,r=null,a,o,s,l;function u(f,d,h){var p=h/2;if(a){var g=s-d,m=f-o;if(g||m){var v=Math.sqrt(g*g+m*m),y=(g/=v)*l,b=(m/=v)*l,E=Math.atan2(m,g);r.moveTo(o-y,s-b),r.lineTo(f-g*p,d-m*p),r.arc(f,d,p,E-Math.PI,E),r.lineTo(o+y,s+b),r.arc(o,s,l,E,E+Math.PI)}else r.arc(f,d,p,0,Pi);r.closePath()}else a=1;o=f,s=d,l=p}function c(f){var d,h=f.length,p,g=!1,m;for(r==null&&(r=m=bo()),d=0;d<=h;++d)!(d<h&&i(p=f[d],d,f))===g&&((g=!g)&&(a=0)),g&&u(+e(p,d,f),+t(p,d,f),+n(p,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function _u(e,t){return e??t}const Au=e=>e.x||0,Su=e=>e.y||0,u7=e=>e.width||0,c7=e=>e.height||0,f7=e=>(e.x||0)+(e.width||0),d7=e=>(e.y||0)+(e.height||0),h7=e=>e.startAngle||0,p7=e=>e.endAngle||0,g7=e=>e.padAngle||0,m7=e=>e.innerRadius||0,v7=e=>e.outerRadius||0,y7=e=>e.cornerRadius||0,b7=e=>_u(e.cornerRadiusTopLeft,e.cornerRadius)||0,w7=e=>_u(e.cornerRadiusTopRight,e.cornerRadius)||0,x7=e=>_u(e.cornerRadiusBottomRight,e.cornerRadius)||0,E7=e=>_u(e.cornerRadiusBottomLeft,e.cornerRadius)||0,k7=e=>_u(e.size,64),_7=e=>e.size||1,Gd=e=>!(e.defined===!1),A7=e=>OS(e.shape||"circle"),S7=F9().startAngle(h7).endAngle(p7).padAngle(g7).innerRadius(m7).outerRadius(v7).cornerRadius(y7),O7=sS().x(Au).y1(Su).y0(d7).defined(Gd),T7=sS().y(Su).x1(Au).x0(f7).defined(Gd),C7=oS().x(Au).y(Su).defined(Gd),$7=TS().x(Au).y(Su).width(u7).height(c7).cornerRadius(b7,w7,x7,E7),D7=I9().type(A7).size(k7),R7=CS().x(Au).y(Su).defined(Gd).size(_7);function ay(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function F7(e,t){return S7.context(e)(t)}function N7(e,t){var n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?T7:O7).curve(ty(i,n.orient,n.tension)).context(e)(t)}function I7(e,t){var n=t[0],i=n.interpolate||"linear";return C7.curve(ty(i,n.orient,n.tension)).context(e)(t)}function Bs(e,t,n,i){return $7.context(e)(t,n,i)}function M7(e,t){return(t.mark.shape||t.shape).context(e)(t)}function j7(e,t){return D7.context(e)(t)}function L7(e,t){return R7.context(e)(t)}var $S=1;function DS(){$S=1}function oy(e,t,n){var i=t.clip,r=e._defs,a=t.clip_id||(t.clip_id="clip"+$S++),o=r.clipping[a]||(r.clipping[a]={id:a});return ge(i)?o.path=i(null):ay(n)?o.path=Bs(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function st(e){this.clear(),e&&this.union(e)}var it=st.prototype;it.clone=function(){return new st(this)},it.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},it.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},it.equals=function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},it.set=function(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},it.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},it.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},it.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},it.scale=function(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},it.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},it.rotate=function(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},it.rotatedPoints=function(e,t,n){var{x1:i,y1:r,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*i-l*r+u,l*i+s*r+c,s*i-l*o+u,l*i+s*o+c,s*a-l*r+u,l*a+s*r+c,s*a-l*o+u,l*a+s*o+c]},it.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},it.intersect=function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},it.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1)&&this.y2>=e.y2},it.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},it.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},it.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},it.width=function(){return this.x2-this.x1},it.height=function(){return this.y2-this.y1};function Hd(e){this.mark=e,this.bounds=this.bounds||new st()}function Yd(e){Hd.call(this,e),this.items=this.items||[]}P(Yd,Hd);function Ou(e,t){if(typeof document!="undefined"&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}function P7(){return typeof Image!="undefined"?Image:null}function sy(e){this._pending=0,this._loader=e||kd()}var Vd=sy.prototype;Vd.pending=function(){return this._pending};function RS(e){e._pending+=1}function Tu(e){e._pending-=1}Vd.sanitizeURL=function(e){var t=this;return RS(t),t._loader.sanitize(e,{context:"href"}).then(function(n){return Tu(t),n}).catch(function(){return Tu(t),null})},Vd.loadImage=function(e){const t=this,n=P7();return RS(t),t._loader.sanitize(e,{context:"image"}).then(function(i){const r=i.href;if(!r||!n)throw{url:r};const a=new n(),o=Q(i,"crossOrigin")?i.crossOrigin:"anonymous";return o!=null&&(a.crossOrigin=o),a.onload=()=>Tu(t),a.onerror=()=>Tu(t),a.src=r,a}).catch(function(i){return Tu(t),{complete:!1,width:0,height:0,src:i&&i.url||""}})},Vd.ready=function(){var e=this;return new Promise(function(t){function n(i){e.pending()?setTimeout(function(){n(!0)},10):t(i)}n(!1)})};function Er(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?z7(t,i):0))}return e}function z7(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}var Xd,Jd,Kd,B7=Pi-1e-8;function gn(e){return Xd=e,gn}function FS(){}function Eo(e,t){Xd.add(e,t)}function Cu(e,t){Eo(Jd=e,Kd=t)}function NS(e){Eo(e,Xd.y1)}function IS(e){Eo(Xd.x1,e)}gn.beginPath=FS,gn.closePath=FS,gn.moveTo=Cu,gn.lineTo=Cu,gn.rect=function(e,t,n,i){Eo(e+n,t+i),Cu(e,t)},gn.quadraticCurveTo=function(e,t,n,i){MS(Jd,e,n,NS),MS(Kd,t,i,IS),Cu(n,i)};function MS(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}gn.bezierCurveTo=function(e,t,n,i,r,a){jS(Jd,e,n,r,NS),jS(Kd,t,i,a,IS),Cu(r,a)};function jS(e,t,n,i,r){const a=i-e+3*t-3*n,o=e+n-2*t,s=e-t;let l=0,u=0,c;Math.abs(a)>e7?(c=o*o+s*a,c>=0&&(c=Math.sqrt(c),l=(-o+c)/a,u=(-o-c)/a)):l=.5*s/o,0<l&&l<1&&r(LS(l,e,t,n,i)),0<u&&u<1&&r(LS(u,e,t,n,i))}function LS(e,t,n,i,r){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*i+s*e*r}gn.arc=function(e,t,n,i,r,a){if(Jd=n*Math.cos(r)+e,Kd=n*Math.sin(r)+t,Math.abs(r-i)>B7)Eo(e-n,t-n),Eo(e+n,t+n);else{const o=u=>Eo(n*Math.cos(u)+e,n*Math.sin(u)+t);let s,l;if(o(i),o(r),r!==i)if(i=i%Pi,i<0&&(i+=Pi),r=r%Pi,r<0&&(r+=Pi),r<i&&(a=!a,s=i,i=r,r=s),a)for(r-=Pi,s=i-i%xo,l=0;l<4&&s>r;++l,s-=xo)o(s);else for(s=i-i%xo+xo,l=0;l<4&&s<r;++l,s=s+xo)o(s)}};var ca=(ca=Ou(1,1))?ca.getContext("2d"):null;const ly=new st();function uy(e){return function(t,n){if(!ca)return!0;e(ca,t),ly.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:a,y2:o}=ly;for(let s=r;s<=o;++s)for(let l=i;l<=a;++l)if(ca.isPointInPath(l,s))return!0;return!1}}function cy(e,t){return t.contains(e.x||0,e.y||0)}function PS(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,a=e.height||0;return t.intersects(ly.set(n,i,n+r,i+a))}function zS(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:i;return Us(t,n,i,r,a)}function Us(e,t,n,i,r){const{x1:a,y1:o,x2:s,y2:l}=e,u=i-t,c=r-n;let f=0,d=1,h,p,g,m;for(m=0;m<4;++m){if(m===0&&(h=-u,p=-(a-t)),m===1&&(h=u,p=s-t),m===2&&(h=-c,p=-(o-n)),m===3&&(h=c,p=l-n),Math.abs(h)<1e-10&&p<0)return!1;if(g=p/h,h<0){if(g>d)return!1;g>f&&(f=g)}else if(h>0){if(g<f)return!1;g<d&&(d=g)}}return!0}function qs(e,t){e.globalCompositeOperation=t.blend||"source-over"}function pi(e,t){return e??t}function BS(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function U7(e,t,n){const i=n.width(),r=n.height();let a;if(t.gradient==="radial")a=e.createRadialGradient(n.x1+pi(t.x1,.5)*i,n.y1+pi(t.y1,.5)*r,Math.max(i,r)*pi(t.r1,0),n.x1+pi(t.x2,.5)*i,n.y1+pi(t.y2,.5)*r,Math.max(i,r)*pi(t.r2,.5));else{const o=pi(t.x1,0),s=pi(t.y1,0),l=pi(t.x2,1),u=pi(t.y2,0);if(o===l||s===u||i===r)a=e.createLinearGradient(n.x1+o*i,n.y1+s*r,n.x1+l*i,n.y1+u*r);else{const c=Ou(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=BS(f.createLinearGradient(o,s,l,u),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return BS(a,t.stops)}function US(e,t,n){return Wv(n)?U7(e,n,t.bounds):n}function Qd(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=US(e,t,t.fill),!0):!1}var q7=[];function Ws(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=US(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||q7),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function W7(e,t){return e.zindex-t.zindex||e.index-t.index}function fy(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,a;for(r=0,a=t.length;r<a;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(W7)}function gi(e,t){var n=e.items,i,r;if(!n||!n.length)return;var a=fy(e);if(a&&a.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=a}for(i=0,r=n.length;i<r;++i)t(n[i])}function Zd(e,t){var n=e.items,i,r;if(!n||!n.length)return null;var a=fy(e);for(a&&a.length&&(n=a),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===a){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function dy(e){return function(t,n,i){gi(n,function(r){(!i||i.intersects(r.bounds))&&qS(e,t,r,r)})}}function G7(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&qS(e,t,n.items[0],n.items)}}function qS(e,t,n,i){var r=n.opacity==null?1:n.opacity;if(r===0)return;if(e(t,i))return;qs(t,n),n.fill&&Qd(t,n,r)&&t.fill(),n.stroke&&Ws(t,n,r)&&t.stroke()}function eh(e){return e=e||Ni,function(t,n,i,r,a,o){return i*=t.pixelRatio,r*=t.pixelRatio,Zd(n,function(s){var l=s.bounds;if(l&&!l.contains(a,o)||!l)return;if(e(t,s,i,r,a,o))return s})}}function th(e,t){return function(n,i,r,a){var o=Array.isArray(i)?i[0]:i,s=t??o.fill,l=o.stroke&&n.isPointInStroke,u,c;return l&&(u=o.strokeWidth,c=o.strokeCap,n.lineWidth=u??1,n.lineCap=c??"butt"),e(n,i)?!1:s&&n.isPointInPath(r,a)||l&&n.isPointInStroke(r,a)}}function hy(e){return eh(th(e))}function Gs(e,t){return"translate("+e+","+t+")"}function WS(e){return"rotate("+e+")"}function H7(e,t){return"scale("+e+","+t+")"}function GS(e){return Gs(e.x||0,e.y||0)}function HS(e){return Gs(e.x||0,e.y||0)+(e.angle?" "+WS(e.angle):"")+(e.scaleX||e.scaleY?" "+H7(e.scaleX||1,e.scaleY||1):"")}function py(e,t,n){function i(o,s){o("transform",HS(s)),o("d",t(null,s))}function r(o,s){var l=s.x||0,u=s.y||0;return t(gn(o),s),Er(o,s).translate(l,u),s.angle&&o.rotate(s.angle*wr,l,u),o}function a(o,s){var l=s.x||0,u=s.y||0,c=s.angle||0;o.translate(l,u),c&&o.rotate(c*=wr),o.beginPath(),t(o,s),c&&o.rotate(-c),o.translate(-l,-u)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:dy(a),pick:hy(a),isect:n||uy(a)}}var Y7=py("arc",F7);function V7(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,a=Infinity,o,s;--r>=0;){if(e[r].defined===!1)continue;s=Math.abs(e[r][i]-n),s<a&&(a=s,o=e[r])}return o}function X7(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,a,o;--i>=0;){if(e[i].defined===!1)continue;if(r=e[i].x-t[0],a=e[i].y-t[1],o=r*r+a*a,o<n)return e[i]}return null}function J7(e,t){for(var n=e.length,i,r,a;--n>=0;){if(e[n].defined===!1)continue;if(i=e[n].x-t[0],r=e[n].y-t[1],a=i*i+r*r,i=e[n].size||1,a<i*i)return e[n]}return null}function gy(e,t,n){function i(l,u){var c=u.mark.items;c.length&&l("d",t(null,c))}function r(l,u){var c=u.items;return c.length===0?l:(t(gn(l),c),Er(l,c[0]))}function a(l,u){l.beginPath(),t(l,u)}var o=th(a);function s(l,u,c,f,d,h){var p=u.items,g=u.bounds;return!p||!p.length||g&&!g.contains(d,h)?null:(c*=l.pixelRatio,f*=l.pixelRatio,o(l,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:G7(a),pick:s,isect:cy,tip:n}}var K7=gy("area",N7,V7);function Q7(e,t){var n=t.clip;e.save(),ge(n)?(e.beginPath(),n(e),e.clip()):YS(e,t.group)}function YS(e,t){e.beginPath(),ay(t)?Bs(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function VS(e){const t=pi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Z7(e,t){e("transform",GS(t))}function XS(e,t){const n=VS(t);e("d",Bs(null,t,n,n))}function eB(e,t){e("class","background"),e("aria-hidden",!0),XS(e,t)}function tB(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?XS(e,t):e("d","")}function nB(e,t,n){const i=t.clip?oy(n,t,t):null;e("clip-path",i)}function iB(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Er(e,t),e.translate(t.x||0,t.y||0)}function nh(e,t,n,i){const r=VS(t);e.beginPath(),Bs(e,t,(n||0)+r,(i||0)+r)}const JS=th(nh),rB=th(nh,!1);function aB(e,t,n){gi(t,i=>{const r=i.x||0,a=i.y||0,o=i.strokeForeground,s=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&s&&(nh(e,i,r,a),qs(e,i),i.fill&&Qd(e,i,s)&&e.fill(),i.stroke&&!o&&Ws(e,i,s)&&e.stroke()),e.save(),e.translate(r,a),i.clip&&YS(e,i),n&&n.translate(-r,-a),gi(i,l=>{this.draw(e,l,n)}),n&&n.translate(r,a),e.restore(),o&&i.stroke&&s&&(nh(e,i,r,a),qs(e,i),Ws(e,i,s)&&e.stroke())})}function oB(e,t,n,i,r,a){if(t.bounds&&!t.bounds.contains(r,a)||!t.items)return null;const o=n*e.pixelRatio,s=i*e.pixelRatio;return Zd(t,l=>{let u,c,f,d,h,p,g,m,v;return m=l.bounds,m&&!m.contains(r,a)?void 0:(d=l.x||0,h=l.y||0,p=d+(l.width||0),g=h+(l.height||0),v=l.clip,v&&(r<d||r>p||a<h||a>g)?void 0:(e.save(),e.translate(d,h),d=r-d,h=a-h,v&&ay(l)&&!JS(e,l,o,s)?(e.restore(),null):(c=l.strokeForeground,f=t.interactive!==!1,f&&c&&l.stroke&&rB(e,l,o,s)?(e.restore(),l):(u=Zd(l,y=>sB(y,d,h)?this.pick(y,n,i,d,h):null),!u&&f&&(l.fill||!c&&l.stroke)&&JS(e,l,o,s)&&(u=l),e.restore(),u||null))))})}function sB(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var lB={type:"group",tag:"g",nested:!1,attr:Z7,bound:iB,draw:aB,pick:oB,isect:PS,content:nB,background:eB,foreground:tB},Hs={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function my(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function vy(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function yy(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function ih(e,t){return e==="center"?t/2:e==="right"?t:0}function rh(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function uB(e,t,n){const i=my(t,n),r=vy(t,i),a=yy(t,i),o=(t.x||0)-ih(t.align,r),s=(t.y||0)-rh(t.baseline,a),l=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",l,Hs["xmlns:xlink"],"xlink:href"),e("transform",Gs(o,s)),e("width",r),e("height",a),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function cB(e,t){const n=t.image,i=vy(t,n),r=yy(t,n),a=(t.x||0)-ih(t.align,i),o=(t.y||0)-rh(t.baseline,r);return e.set(a,o,a+i,o+r)}function fB(e,t,n){gi(t,i=>{if(n&&!n.intersects(i.bounds))return;let r=my(i,this),a=vy(i,r),o=yy(i,r),s=(i.x||0)-ih(i.align,a),l=(i.y||0)-rh(i.baseline,o),u,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=a/c,l+=(o-d)/2,o=d):(d=o*c,s+=(a-d)/2,a=d))),(r.complete||r.toDataURL)&&(qs(e,i),e.globalAlpha=(u=i.opacity)!=null?u:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,s,l,a,o))})}var dB={type:"image",tag:"image",nested:!1,attr:uB,bound:cB,draw:fB,pick:eh(),isect:Ni,get:my,xOffset:ih,yOffset:rh},hB=gy("line",I7,X7);function pB(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",HS(t)),e("d",t.path)}function ah(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*wr,l=t.pathCache;(!l||l.path!==n)&&((t.pathCache=l=Ps(n)).path=n),s&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(s),ku(e,l,0,0,a,o),e.rotate(-s),e.translate(-i,-r)):ku(e,l,i,r,a,o)}function gB(e,t){return ah(gn(e),t)?e.set(0,0,0,0):Er(e,t,!0),t.angle&&e.rotate(t.angle*wr,t.x||0,t.y||0),e}var mB={type:"path",tag:"path",nested:!1,attr:pB,bound:gB,draw:dy(ah),pick:hy(ah),isect:uy(ah)};function vB(e,t){e("d",Bs(null,t))}function yB(e,t){var n,i;return Er(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function KS(e,t){e.beginPath(),Bs(e,t)}var bB={type:"rect",tag:"path",nested:!1,attr:vB,bound:yB,draw:dy(KS),pick:hy(KS),isect:PS};function wB(e,t){e("transform",GS(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function xB(e,t){var n,i;return Er(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function QS(e,t,n){var i,r,a,o;return t.stroke&&Ws(e,t,n)?(i=t.x||0,r=t.y||0,a=t.x2!=null?t.x2:i,o=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(a,o),!0):!1}function EB(e,t,n){gi(t,function(i){if(n&&!n.intersects(i.bounds))return;var r=i.opacity==null?1:i.opacity;r&&QS(e,i,r)&&(qs(e,i),e.stroke())})}function kB(e,t,n,i){return e.isPointInStroke?QS(e,t,1)&&e.isPointInStroke(n,i):!1}var _B={type:"rule",tag:"line",nested:!1,attr:wB,bound:xB,draw:EB,pick:eh(kB),isect:zS},AB=py("shape",M7),SB=py("symbol",j7,cy);const ZS=Xz();var Ys={height:zi,measureWidth:wy,estimateWidth:by,width:by,canvas:eO};eO(!0);function eO(e){Ys.width=e&&ca?wy:by}function by(e,t){return tO(da(e,t),zi(e))}function tO(e,t){return~~(.8*e.length*t)}function wy(e,t){return zi(e)<=0||!(t=da(e,t))?0:nO(t,oh(e))}function nO(e,t){const n=`(${t}) ${e}`;let i=ZS.get(n);return i===void 0&&(ca.font=t,i=ca.measureText(e).width,ZS.set(n,i)),i}function zi(e){return e.fontSize!=null?+e.fontSize||0:11}function fa(e){return e.lineHeight!=null?e.lineHeight:zi(e)+2}function OB(e){return I(e)?e.length>1?e:e[0]:e}function $u(e){return OB(e.lineBreak&&e.text&&!I(e.text)?e.text.split(e.lineBreak):e.text)}function xy(e){const t=$u(e);return(I(t)?t.length-1:0)*fa(e)}function da(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?CB(e,n):n}function TB(e){if(Ys.width===wy){const t=oh(e);return n=>nO(n,t)}else{const t=zi(e);return n=>tO(n,t)}}function CB(e,t){var n=+e.limit,i=TB(e);if(i(t)<n)return t;var r=e.ellipsis||"…",a=e.dir==="rtl",o=0,s=t.length,l;if(n-=i(r),a){for(;o<s;)l=o+s>>>1,i(t.slice(l))>n?o=l+1:s=l;return r+t.slice(o)}else{for(;o<s;)l=1+(o+s>>>1),i(t.slice(0,l))<n?o=l:s=l-1;return t.slice(0,o)+r}}function Du(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function oh(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+zi(e)+"px "+Du(e,t)}function Ey(e){var t=e.baseline,n=zi(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*fa(e):t==="line-bottom"?.29*n-.5*fa(e):0)}var $B={left:"start",center:"middle",right:"end"},Ru=new st();function sh(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-xo,t+=i*Math.cos(r),n+=i*Math.sin(r)),Ru.x1=t,Ru.y1=n,Ru}function DB(e,t){var n=t.dx||0,i=(t.dy||0)+Ey(t),r=sh(t),a=r.x1,o=r.y1,s=t.angle||0,l;e("text-anchor",$B[t.align]||"start"),s?(l=Gs(a,o)+" "+WS(s),(n||i)&&(l+=" "+Gs(n,i))):l=Gs(a+n,o+i),e("transform",l)}function ky(e,t,n){var i=Ys.height(t),r=t.align,a=sh(t),o=a.x1,s=a.y1,l=t.dx||0,u=(t.dy||0)+Ey(t)-Math.round(.8*i),c=$u(t),f;if(I(c)?(i+=fa(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,Ys.width(t,h)),0)):f=Ys.width(t,c),r==="center"?l-=f/2:r==="right"&&(l-=f),e.set(l+=o,u+=s,l+f,u+i),t.angle&&!n)e.rotate(t.angle*wr,o,s);else if(n===2)return e.rotatedPoints(t.angle*wr,o,s);return e}function RB(e,t,n){gi(t,function(i){var r=i.opacity==null?1:i.opacity,a,o,s,l,u,c,f;if(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)return;if(e.font=oh(i),e.textAlign=i.align||"left",a=sh(i),o=a.x1,s=a.y1,i.angle&&(e.save(),e.translate(o,s),e.rotate(i.angle*wr),o=s=0),o+=i.dx||0,s+=(i.dy||0)+Ey(i),c=$u(i),qs(e,i),I(c))for(u=fa(i),l=0;l<c.length;++l)f=da(i,c[l]),i.fill&&Qd(e,i,r)&&e.fillText(f,o,s),i.stroke&&Ws(e,i,r)&&e.strokeText(f,o,s),s+=u;else f=da(i,c),i.fill&&Qd(e,i,r)&&e.fillText(f,o,s),i.stroke&&Ws(e,i,r)&&e.strokeText(f,o,s);i.angle&&e.restore()})}function FB(e,t,n,i,r,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=sh(t),s=o.x1,l=o.y1,u=ky(Ru,t,1),c=-t.angle*wr,f=Math.cos(c),d=Math.sin(c),h=f*r-d*a+(s-f*s+d*l),p=d*r+f*a+(l-d*s-f*l);return u.contains(h,p)}function NB(e,t){var n=ky(Ru,e,2);return Us(t,n[0],n[1],n[2],n[3])||Us(t,n[0],n[1],n[4],n[5])||Us(t,n[4],n[5],n[6],n[7])||Us(t,n[2],n[3],n[6],n[7])}var IB={type:"text",tag:"text",nested:!1,attr:DB,bound:ky,draw:RB,pick:eh(FB),isect:NB},MB=gy("trail",L7,J7),Yn={arc:Y7,area:K7,group:lB,image:dB,line:hB,path:mB,rect:bB,rule:_B,shape:AB,symbol:SB,text:IB,trail:MB};function _y(e,t,n){var i=Yn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new st()),e,n)}var iO={mark:null};function rO(e,t,n){var i=Yn[e.marktype],r=i.bound,a=e.items,o=a&&a.length,s,l,u,c;if(i.nested)return o?u=a[0]:(iO.mark=e,u=iO),c=_y(u,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new st(),o)for(s=0,l=a.length;s<l;++s)t.union(_y(a[s],r,n));return e.bounds=t}var jB=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function aO(e,t){return JSON.stringify(e,jB,t)}function oO(e){var t=typeof e=="string"?JSON.parse(e):e;return sO(t)}function sO(e){var t=e.marktype,n=e.items,i,r,a;if(n)for(r=0,a=n.length;r<a;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&sO(n[r]);return t&&rO(e),e}function Ay(e){arguments.length?this.root=oO(e):(this.root=uO({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Yd(this.root)])}var lO=Ay.prototype;lO.toJSON=function(e){return aO(this.root,e||0)},lO.mark=function(e,t,n){t=t||this.root.items[0];var i=uO(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};function uO(e,t){const n={bounds:new st(),clip:!!e.clip,group:t,interactive:!(e.interactive===!1),items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function ha(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Sy(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function In(e,t,n,i){var r=e.childNodes[t],a;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(a=r||null,r=ha(e.ownerDocument,n,i),e.insertBefore(r,a)),r}function mi(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function cO(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function lh(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function LB(e,t,n,i){var r=e&&e.mark,a,o;if(r&&(a=Yn[r.marktype]).tip){for(o=lh(t,n),o[0]-=i[0],o[1]-=i[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=a.tip(r.items,o)}return e}function pa(e,t){this._active=null,this._handlers={},this._loader=e||kd(),this._tooltip=t||PB}function PB(e,t,n,i){e.element().setAttribute("title",i||"")}const Mn=pa.prototype;Mn.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},Mn.element=function(){return this._el},Mn.canvas=function(){return this._el&&this._el.firstChild},Mn.origin=function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},Mn.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},Mn.on=function(){},Mn.off=function(){},Mn._handlerIndex=function(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},Mn.handlers=function(e){const t=this._handlers,n=[];if(e)n.push.apply(n,t[this.eventName(e)]);else for(const i in t)n.push.apply(n,t[i]);return n},Mn.eventName=function(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},Mn.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),a=ha(null,"a");for(const o in i)a.setAttribute(o,i[o]);a.dispatchEvent(r)}).catch(function(){})},Mn.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=LB(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},Mn.getItemBoundingClientRect=function(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,a=r.width(),o=r.height();let s=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}};function vi(e){this._el=null,this._bgcolor=null,this._loader=new sy(e)}var Vn=vi.prototype;Vn.initialize=function(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},Vn.element=function(){return this._el},Vn.canvas=function(){return this._el&&this._el.firstChild},Vn.background=function(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},Vn.resize=function(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},Vn.dirty=function(){},Vn.render=function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},Vn._render=function(){},Vn.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)},Vn._load=function(e,t){var n=this,i=n._loader[e](t);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then(function(a){a&&r(),n._ready=null})}return i},Vn.sanitizeURL=function(e){return this._load("sanitizeURL",e)},Vn.loadImage=function(e){return this._load("loadImage",e)};const zB="keydown",BB="keypress",UB="keyup",fO="dragenter",uh="dragleave",dO="dragover",Oy="mousedown",qB="mouseup",ch="mousemove",Fu="mouseout",hO="mouseover",fh="click",WB="dblclick",GB="wheel",pO="mousewheel",dh="touchstart",hh="touchmove",ph="touchend",HB=[zB,BB,UB,fO,uh,dO,Oy,qB,ch,Fu,hO,fh,WB,GB,pO,dh,hh,ph],Ty=ch,Nu=Fu,Cy=fh;function Iu(e,t){pa.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const lt=P(Iu,pa);lt.initialize=function(e,t,n){return this._canvas=e&&Sy(e,"canvas"),[fh,Oy,ch,Fu,uh].forEach(i=>gO(this,i)),pa.prototype.initialize.call(this,e,t,n)};const YB=e=>e===dh||e===hh||e===ph?[dh,hh,ph]:[e];function gO(e,t){YB(t).forEach(n=>VB(e,n))}function VB(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}lt.canvas=function(){return this._canvas},lt.context=function(){return this._canvas.getContext("2d")},lt.events=HB;function mO(e,t,n){return function(i){const r=this._active,a=this.pickEvent(i);a===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=a,this.fire(t,i),this.fire(e,i))}}function vO(e){return function(t){this.fire(e,t),this._active=null}}lt.DOMMouseScroll=function(e){this.fire(pO,e)},lt.mousemove=mO(ch,hO,Fu),lt.dragover=mO(dO,fO,uh),lt.mouseout=vO(Fu),lt.dragleave=vO(uh),lt.mousedown=function(e){this._down=this._active,this.fire(Oy,e)},lt.click=function(e){this._down===this._active&&(this.fire(fh,e),this._down=null)},lt.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(dh,e,!0)},lt.touchmove=function(e){this.fire(hh,e,!0)},lt.touchend=function(e){this.fire(ph,e,!0),this._touch=null},lt.fire=function(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===Cy&&i&&i.href?this.handleHref(t,i,i.href):(e===Ty||e===Nu)&&this.handleTooltip(t,i,e!==Nu),r)for(let a=0,o=r.length;a<o;++a)r[a].handler.call(this._obj,t,i)},lt.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);return r<0&&(gO(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},lt.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},lt.pickEvent=function(e){const t=lh(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},lt.pick=function(e,t,n,i,r){const a=this.context(),o=Yn[e.marktype];return o.pick.call(this,a,e,t,n,i,r)};function XB(){return typeof window!="undefined"&&window.devicePixelRatio||1}var JB=XB();function KB(e,t,n,i,r,a){const o=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),l=o?JB:r;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];return o&&l!==1&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*i[0],l*i[1]),e}function gh(e){vi.call(this,e),this._options={},this._redraw=!1,this._dirty=new st(),this._tempb=new st()}const ga=P(gh,vi),yO=vi.prototype;ga.initialize=function(e,t,n,i,r,a){return this._options=a||{},this._canvas=this._options.externalContext?null:Ou(1,1,this._options.type),e&&this._canvas&&(mi(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),yO.initialize.call(this,e,t,n,i,r)},ga.resize=function(e,t,n,i){if(yO.resize.call(this,e,t,n,i),this._canvas)KB(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||F("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},ga.canvas=function(){return this._canvas},ga.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},ga.dirty=function(e){let t=this._tempb.clear().union(e.bounds),n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)};function QB(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}const ZB=(e,t,n)=>new st().set(0,0,t,n).translate(-e[0],-e[1]);ga._render=function(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,a=this._dirty,o=ZB(n,i,r);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):QB(t,o.intersect(a),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,s),t.restore(),a.clear(),this},ga.draw=function(e,t,n){const i=Yn[t.marktype];t.clip&&Q7(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},ga.clear=function(e,t,n,i){const r=this._options,a=this.context();r.type!=="pdf"&&!r.externalContext&&a.clearRect(e,t,n,i),this._bgcolor!=null&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,i))};function $y(e,t){pa.call(this,e,t);const n=this;n._hrefHandler=Dy(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=Dy(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Nu)})}const mh=P($y,pa);mh.initialize=function(e,t,n){let i=this._svg;return i&&(i.removeEventListener(Cy,this._hrefHandler),i.removeEventListener(Ty,this._tooltipHandler),i.removeEventListener(Nu,this._tooltipHandler)),this._svg=i=e&&Sy(e,"svg"),i&&(i.addEventListener(Cy,this._hrefHandler),i.addEventListener(Ty,this._tooltipHandler),i.addEventListener(Nu,this._tooltipHandler)),pa.prototype.initialize.call(this,e,t,n)},mh.canvas=function(){return this._svg};const Dy=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};mh.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);if(r<0){const a={type:e,handler:t,listener:Dy(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},mh.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this};function Ry(e,t,n){var i=e-t+n*2;return e?i>0?i:1:0}const eU="identity",Vs="linear",kr="log",Mu="pow",ju="sqrt",vh="symlog",ko="time",_o="utc",Bi="sequential",Xs="diverging",Js="quantile",yh="quantize",bh="threshold",Fy="ordinal",Ny="point",bO="band",Iy="bin-ordinal",ut="continuous",Lu="discrete",Pu="discretizing",Xn="interpolating",My="temporal";function tU(e){return function(t){var n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function nU(e){return function(t){var n=e.range(),i=t[0],r=t[1],a=-1,o,s,l,u;for(r<i&&(s=i,i=r,r=s),l=0,u=n.length;l<u;++l)n[l]>=i&&n[l]<=r&&(a<0&&(a=l),o=l);return a<0?void 0:(i=e.invertExtent(n[a]),r=e.invertExtent(n[o]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]])}}function Ui(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ma(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const jy=Symbol("implicit");function Ly(){var e=new Map(),t=[],n=[],i=jy;function r(a){var o=a+"",s=e.get(o);if(!s){if(i!==jy)return i;e.set(o,s=t.push(a))}return n[(s-1)%n.length]}return r.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new Map();for(const o of a){const s=o+"";if(e.has(s))continue;e.set(s,t.push(o))}return r},r.range=function(a){return arguments.length?(n=Array.from(a),r):n.slice()},r.unknown=function(a){return arguments.length?(i=a,r):i},r.copy=function(){return Ly(t,n).unknown(i)},Ui.apply(r,arguments),r}function Ks(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function zu(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function va(){}var Ao=.7,Qs=1/Ao,Zs="\\s*([+-]?\\d+)\\s*",Bu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",qi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",iU=/^#([0-9a-f]{3,8})$/,rU=new RegExp("^rgb\\("+[Zs,Zs,Zs]+"\\)$"),aU=new RegExp("^rgb\\("+[qi,qi,qi]+"\\)$"),oU=new RegExp("^rgba\\("+[Zs,Zs,Zs,Bu]+"\\)$"),sU=new RegExp("^rgba\\("+[qi,qi,qi,Bu]+"\\)$"),lU=new RegExp("^hsl\\("+[Bu,qi,qi]+"\\)$"),uU=new RegExp("^hsla\\("+[Bu,qi,qi,Bu]+"\\)$"),wO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ks(va,Uu,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:xO,formatHex:xO,formatHsl:cU,formatRgb:EO,toString:EO});function xO(){return this.rgb().formatHex()}function cU(){return OO(this).formatHsl()}function EO(){return this.rgb().formatRgb()}function Uu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=iU.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?kO(t):n===3?new St(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?wh(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?wh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=rU.exec(e))?new St(t[1],t[2],t[3],1):(t=aU.exec(e))?new St(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=oU.exec(e))?wh(t[1],t[2],t[3],t[4]):(t=sU.exec(e))?wh(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=lU.exec(e))?SO(t[1],t[2]/100,t[3]/100,1):(t=uU.exec(e))?SO(t[1],t[2]/100,t[3]/100,t[4]):wO.hasOwnProperty(e)?kO(wO[e]):e==="transparent"?new St(NaN,NaN,NaN,0):null}function kO(e){return new St(e>>16&255,e>>8&255,e&255,1)}function wh(e,t,n,i){return i<=0&&(e=t=n=NaN),new St(e,t,n,i)}function Py(e){return e instanceof va||(e=Uu(e)),e?(e=e.rgb(),new St(e.r,e.g,e.b,e.opacity)):new St()}function ya(e,t,n,i){return arguments.length===1?Py(e):new St(e,t,n,i??1)}function St(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Ks(St,ya,zu(va,{brighter:function(e){return e=e==null?Qs:Math.pow(Qs,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Ao:Math.pow(Ao,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_O,formatHex:_O,formatRgb:AO,toString:AO}));function _O(){return"#"+zy(this.r)+zy(this.g)+zy(this.b)}function AO(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function zy(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function SO(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Wi(e,t,n,i)}function OO(e){if(e instanceof Wi)return new Wi(e.h,e.s,e.l,e.opacity);if(e instanceof va||(e=Uu(e)),!e)return new Wi();if(e instanceof Wi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(t===a?o=(n-i)/s+(n<i)*6:n===a?o=(i-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new Wi(o,s,l,e.opacity)}function xh(e,t,n,i){return arguments.length===1?OO(e):new Wi(e,t,n,i??1)}function Wi(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ks(Wi,xh,zu(va,{brighter:function(e){return e=e==null?Qs:Math.pow(Qs,e),new Wi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ao:Math.pow(Ao,e),new Wi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new St(By(e>=240?e-240:e+120,r,i),By(e,r,i),By(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function By(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var TO=Math.PI/180,CO=180/Math.PI,Eh=18,$O=.96422,DO=1,RO=.82521,FO=4/29,el=6/29,NO=3*el*el,fU=el*el*el;function IO(e){if(e instanceof Gi)return new Gi(e.l,e.a,e.b,e.opacity);if(e instanceof _r)return MO(e);e instanceof St||(e=Py(e));var t=Gy(e.r),n=Gy(e.g),i=Gy(e.b),r=Uy((.2225045*t+.7168786*n+.0606169*i)/DO),a,o;return t===n&&n===i?a=o=r:(a=Uy((.4360747*t+.3850649*n+.1430804*i)/$O),o=Uy((.0139322*t+.0971045*n+.7141733*i)/RO)),new Gi(116*r-16,500*(a-r),200*(r-o),e.opacity)}function kh(e,t,n,i){return arguments.length===1?IO(e):new Gi(e,t,n,i??1)}function Gi(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}Ks(Gi,kh,zu(va,{brighter:function(e){return new Gi(this.l+Eh*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Gi(this.l-Eh*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=$O*qy(t),e=DO*qy(e),n=RO*qy(n),new St(Wy(3.1338561*t-1.6168667*e-.4906146*n),Wy(-.9787684*t+1.9161415*e+.033454*n),Wy(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Uy(e){return e>fU?Math.pow(e,1/3):e/NO+FO}function qy(e){return e>el?e*e*e:NO*(e-FO)}function Wy(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Gy(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function dU(e){if(e instanceof _r)return new _r(e.h,e.c,e.l,e.opacity);if(e instanceof Gi||(e=IO(e)),e.a===0&&e.b===0)return new _r(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*CO;return new _r(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function _h(e,t,n,i){return arguments.length===1?dU(e):new _r(e,t,n,i??1)}function _r(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function MO(e){if(isNaN(e.h))return new Gi(e.l,0,0,e.opacity);var t=e.h*TO;return new Gi(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Ks(_r,_h,zu(va,{brighter:function(e){return new _r(this.h,this.c,this.l+Eh*(e??1),this.opacity)},darker:function(e){return new _r(this.h,this.c,this.l-Eh*(e??1),this.opacity)},rgb:function(){return MO(this).rgb()}}));var jO=-.14861,Hy=1.78277,Yy=-.29227,Ah=-.90649,qu=1.97294,LO=qu*Ah,PO=qu*Hy,zO=Hy*Yy-Ah*jO;function hU(e){if(e instanceof So)return new So(e.h,e.s,e.l,e.opacity);e instanceof St||(e=Py(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(zO*i+LO*t-PO*n)/(zO+LO-PO),a=i-r,o=(qu*(n-r)-Yy*a)/Ah,s=Math.sqrt(o*o+a*a)/(qu*r*(1-r)),l=s?Math.atan2(o,a)*CO-120:NaN;return new So(l<0?l+360:l,s,r,e.opacity)}function Vy(e,t,n,i){return arguments.length===1?hU(e):new So(e,t,n,i??1)}function So(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ks(So,Vy,zu(va,{brighter:function(e){return e=e==null?Qs:Math.pow(Qs,e),new So(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ao:Math.pow(Ao,e),new So(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*TO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new St(255*(t+n*(jO*i+Hy*r)),255*(t+n*(Yy*i+Ah*r)),255*(t+n*(qu*i)),this.opacity)}}));function BO(e,t,n,i,r){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*i+o*r)/6}function UO(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1],o=i>0?e[i-1]:2*r-a,s=i<t-1?e[i+2]:2*a-r;return BO((n-i/t)*t,o,r,a,s)}}function qO(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],a=e[i%t],o=e[(i+1)%t],s=e[(i+2)%t];return BO((n-i/t)*t,r,a,o,s)}}function Sh(e){return function(){return e}}function WO(e,t){return function(n){return e+n*t}}function pU(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Oh(e,t){var n=t-e;return n?WO(e,n>180||n<-180?n-360*Math.round(n/360):n):Sh(isNaN(e)?t:e)}function gU(e){return(e=+e)===1?mt:function(t,n){return n-t?pU(t,n,e):Sh(isNaN(t)?n:t)}}function mt(e,t){var n=t-e;return n?WO(e,n):Sh(isNaN(e)?t:e)}var Xy=function e(t){var n=gU(t);function i(r,a){var o=n((r=ya(r)).r,(a=ya(a)).r),s=n(r.g,a.g),l=n(r.b,a.b),u=mt(r.opacity,a.opacity);return function(c){return r.r=o(c),r.g=s(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=e,i}(1);function GO(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o)s=ya(t[o]),i[o]=s.r||0,r[o]=s.g||0,a[o]=s.b||0;return i=e(i),r=e(r),a=e(a),s.opacity=1,function(l){return s.r=i(l),s.g=r(l),s.b=a(l),s+""}}}var mU=GO(UO),vU=GO(qO);function Jy(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function HO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function yU(e,t){return(HO(t)?Jy:YO)(e,t)}function YO(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),a=new Array(n),o;for(o=0;o<i;++o)r[o]=Oo(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=r[o](s);return a}}function VO(e,t){var n=new Date();return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function yi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function XO(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Oo(e[r],t[r]):i[r]=t[r];return function(a){for(r in n)i[r]=n[r](a);return i}}var Ky=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qy=new RegExp(Ky.source,"g");function bU(e){return function(){return e}}function wU(e){return function(t){return e(t)+""}}function JO(e,t){var n=Ky.lastIndex=Qy.lastIndex=0,i,r,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(i=Ky.exec(e))&&(r=Qy.exec(t));)(a=r.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:yi(i,r)})),n=Qy.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?wU(l[0].x):bU(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function Oo(e,t){var n=typeof t,i;return t==null||n==="boolean"?Sh(t):(n==="number"?yi:n==="string"?(i=Uu(t))?(t=i,Xy):JO:t instanceof Uu?Xy:t instanceof Date?VO:HO(t)?Jy:Array.isArray(t)?YO:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?XO:yi)(e,t)}function xU(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function EU(e,t){var n=Oh(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function Wu(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var KO=180/Math.PI,Zy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function QO(e,t,n,i,r,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*KO,skewX:Math.atan(l)*KO,scaleX:o,scaleY:s}}var Gu,eb,ZO,Th;function kU(e){return e==="none"?Zy:(Gu||(Gu=document.createElement("DIV"),eb=document.documentElement,ZO=document.defaultView),Gu.style.transform=e,e=ZO.getComputedStyle(eb.appendChild(Gu),null).getPropertyValue("transform"),eb.removeChild(Gu),e=e.slice(7,-1).split(","),QO(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function _U(e){return e==null?Zy:(Th||(Th=document.createElementNS("http://www.w3.org/2000/svg","g")),Th.setAttribute("transform",e),(e=Th.transform.baseVal.consolidate())?(e=e.matrix,QO(e.a,e.b,e.c,e.d,e.e,e.f)):Zy)}function eT(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function a(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push("translate(",null,t,null,n);p.push({i:g-4,x:yi(u,f)},{i:g-2,x:yi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function o(u,c,f,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:yi(u,c)})):c&&f.push(r(f)+"rotate("+c+i)}function s(u,c,f,d){u!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:yi(u,c)}):c&&f.push(r(f)+"skewX("+c+i)}function l(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push(r(h)+"scale(",null,",",null,")");p.push({i:g-4,x:yi(u,f)},{i:g-2,x:yi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(u,c){var f=[],d=[];return u=e(u),c=e(c),a(u.translateX,u.translateY,c.translateX,c.translateY,f,d),o(u.rotate,c.rotate,f,d),s(u.skewX,c.skewX,f,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,d),u=c=null,function(h){for(var p=-1,g=d.length,m;++p<g;)f[(m=d[p]).i]=m.x(h);return f.join("")}}}var AU=eT(kU,"px, ","px)","deg)"),SU=eT(_U,", ",")",")"),Hu=Math.SQRT2,tb=2,tT=4,OU=1e-12;function nT(e){return((e=Math.exp(e))+1/e)/2}function TU(e){return((e=Math.exp(e))-1/e)/2}function CU(e){return((e=Math.exp(2*e))-1)/(e+1)}function $U(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],o=t[1],s=t[2],l=a-n,u=o-i,c=l*l+u*u,f,d;if(c<OU)d=Math.log(s/r)/Hu,f=function(y){return[n+y*l,i+y*u,r*Math.exp(Hu*y*d)]};else{var h=Math.sqrt(c),p=(s*s-r*r+tT*c)/(2*r*tb*h),g=(s*s-r*r-tT*c)/(2*s*tb*h),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);d=(v-m)/Hu,f=function(y){var b=y*d,E=nT(m),x=r/(tb*h)*(E*CU(Hu*b+m)-TU(m));return[n+x*l,i+x*u,r*E/nT(Hu*b+m)]}}return f.duration=d*1e3,f}function iT(e){return function(t,n){var i=e((t=xh(t)).h,(n=xh(n)).h),r=mt(t.s,n.s),a=mt(t.l,n.l),o=mt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.s=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var DU=iT(Oh),RU=iT(mt);function FU(e,t){var n=mt((e=kh(e)).l,(t=kh(t)).l),i=mt(e.a,t.a),r=mt(e.b,t.b),a=mt(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=i(o),e.b=r(o),e.opacity=a(o),e+""}}function rT(e){return function(t,n){var i=e((t=_h(t)).h,(n=_h(n)).h),r=mt(t.c,n.c),a=mt(t.l,n.l),o=mt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.c=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var NU=rT(Oh),IU=rT(mt);function aT(e){return function t(n){n=+n;function i(r,a){var o=e((r=Vy(r)).h,(a=Vy(a)).h),s=mt(r.s,a.s),l=mt(r.l,a.l),u=mt(r.opacity,a.opacity);return function(c){return r.h=o(c),r.s=s(c),r.l=l(Math.pow(c,n)),r.opacity=u(c),r+""}}return i.gamma=t,i}(1)}var MU=aT(Oh),jU=aT(mt);function nb(e,t){for(var n=0,i=t.length-1,r=t[0],a=new Array(i<0?0:i);n<i;)a[n]=e(r,r=t[++n]);return function(o){var s=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return a[s](o-s)}}function LU(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}var PU=Object.freeze({__proto__:null,interpolate:Oo,interpolateArray:yU,interpolateBasis:UO,interpolateBasisClosed:qO,interpolateDate:VO,interpolateDiscrete:xU,interpolateHue:EU,interpolateNumber:yi,interpolateNumberArray:Jy,interpolateObject:XO,interpolateRound:Wu,interpolateString:JO,interpolateTransformCss:AU,interpolateTransformSvg:SU,interpolateZoom:$U,interpolateRgb:Xy,interpolateRgbBasis:mU,interpolateRgbBasisClosed:vU,interpolateHsl:DU,interpolateHslLong:RU,interpolateLab:FU,interpolateHcl:NU,interpolateHclLong:IU,interpolateCubehelix:MU,interpolateCubehelixLong:jU,piecewise:nb,quantize:LU});function zU(e){return function(){return e}}function ib(e){return+e}var oT=[0,1];function mn(e){return e}function rb(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:zU(isNaN(t)?NaN:.5)}function BU(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function UU(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];return r<i?(i=rb(r,i),a=n(o,a)):(i=rb(i,r),a=n(a,o)),function(s){return a(i(s))}}function qU(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=rb(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(s){var l=Zr(e,s,1,i)-1;return a[l](r[l](s))}}function Yu(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ch(){var e=oT,t=oT,n=Oo,i,r,a,o=mn,s,l,u;function c(){var d=Math.min(e.length,t.length);return o!==mn&&(o=BU(e[0],e[d-1])),s=d>2?qU:UU,l=u=null,f}function f(d){return isNaN(d=+d)?a:(l||(l=s(e.map(i),t,n)))(i(o(d)))}return f.invert=function(d){return o(r((u||(u=s(t,e.map(i),yi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,ib),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=Wu,c()},f.clamp=function(d){return arguments.length?(o=d?!0:mn,c()):o!==mn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(a=d,f):a},function(d,h){return i=d,r=h,c()}}function sT(){return Ch()(mn,mn)}function lT(e,t,n,i){var r=ea(e,t,n),a;i=_s(i??",f");switch(i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(a=Gk(r,o))&&(i.precision=a),h0(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=Hk(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=Wk(r))&&(i.precision=a-(i.type==="%")*2);break}}return gd(i)}function To(e){var t=e.domain;return e.ticks=function(n){var i=t();return c0(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return lT(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,a=i.length-1,o=i[r],s=i[a],l;return s<o&&(l=o,o=s,s=l,l=r,r=a,a=l),l=fd(o,s,n),l>0?(o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l,l=fd(o,s,n)):l<0&&(o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l,l=fd(o,s,n)),l>0?(i[r]=Math.floor(o/l)*l,i[a]=Math.ceil(s/l)*l,t(i)):l<0&&(i[r]=Math.ceil(o*l)/l,i[a]=Math.floor(s*l)/l,t(i)),e},e}function uT(){var e=sT();return e.copy=function(){return Yu(e,uT())},Ui.apply(e,arguments),To(e)}function cT(e){var t;function n(i){return isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,ib),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return cT(e).unknown(t)},e=arguments.length?Array.from(e,ib):[0,1],To(n)}function fT(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],a=e[i],o;return a<r&&(o=n,n=i,i=o,o=r,r=a,a=o),e[n]=t.floor(r),e[i]=t.ceil(a),e}function dT(e){return Math.log(e)}function hT(e){return Math.exp(e)}function WU(e){return-Math.log(-e)}function GU(e){return-Math.exp(-e)}function HU(e){return isFinite(e)?+("1e"+e):e<0?0:e}function YU(e){return e===10?HU:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function VU(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function pT(e){return function(t){return-e(-t)}}function ab(e){var t=e(dT,hT),n=t.domain,i=10,r,a;function o(){return r=VU(i),a=YU(i),n()[0]<0?(r=pT(r),a=pT(a),e(WU,GU)):e(dT,hT),t}return t.base=function(s){return arguments.length?(i=+s,o()):i},t.domain=function(s){return arguments.length?(n(s),o()):n()},t.ticks=function(s){var l=n(),u=l[0],c=l[l.length-1],f;(f=c<u)&&(d=u,u=c,c=d);var d=r(u),h=r(c),p,g,m,v=s==null?10:+s,y=[];if(!(i%1)&&h-d<v){if(d=Math.floor(d),h=Math.ceil(h),u>0)for(;d<=h;++d)for(g=1,p=a(d);g<i;++g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}else for(;d<=h;++d)for(g=i-1,p=a(d);g>=1;--g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}y.length*2<v&&(y=c0(u,c,v))}else y=c0(d,h,Math.min(h-d,v)).map(a);return f?y.reverse():y},t.tickFormat=function(s,l){if(l==null&&(l=i===10?".0e":","),typeof l!="function"&&(l=gd(l)),s===Infinity)return l;s==null&&(s=10);var u=Math.max(1,i*s/t.ticks().length);return function(c){var f=c/a(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=u?l(c):""}},t.nice=function(){return n(fT(n(),{floor:function(s){return a(Math.floor(r(s)))},ceil:function(s){return a(Math.ceil(r(s)))}}))},t}function gT(){var e=ab(Ch()).domain([1,10]);return e.copy=function(){return Yu(e,gT()).base(e.base())},Ui.apply(e,arguments),e}function mT(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function vT(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ob(e){var t=1,n=e(mT(t),vT(t));return n.constant=function(i){return arguments.length?e(mT(t=+i),vT(t)):t},To(n)}function yT(){var e=ob(Ch());return e.copy=function(){return Yu(e,yT()).constant(e.constant())},Ui.apply(e,arguments)}function bT(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function XU(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function JU(e){return e<0?-e*e:e*e}function sb(e){var t=e(mn,mn),n=1;function i(){return n===1?e(mn,mn):n===.5?e(XU,JU):e(bT(n),bT(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},To(t)}function lb(){var e=sb(Ch());return e.copy=function(){return Yu(e,lb()).exponent(e.exponent())},Ui.apply(e,arguments),e}function KU(){return lb.apply(null,arguments).exponent(.5)}function wT(){var e=[],t=[],n=[],i;function r(){var o=0,s=Math.max(1,t.length);for(n=new Array(s-1);++o<s;)n[o-1]=dd(e,o/s);return a}function a(o){return isNaN(o=+o)?i:t[Zr(n,o)]}return a.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Es),r()},a.range=function(o){return arguments.length?(t=Array.from(o),r()):t.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.quantiles=function(){return n.slice()},a.copy=function(){return wT().domain(e).range(t).unknown(i)},Ui.apply(a,arguments)}function xT(){var e=0,t=1,n=1,i=[.5],r=[0,1],a;function o(l){return l<=l?r[Zr(i,l,0,n)]:a}function s(){var l=-1;for(i=new Array(n);++l<n;)i[l]=((l+1)*t-(l-n)*e)/(n+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(n=(r=Array.from(l)).length-1,s()):r.slice()},o.invertExtent=function(l){var u=r.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,i[0]]:u>=n?[i[n-1],t]:[i[u-1],i[u]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return i.slice()},o.copy=function(){return xT().domain([e,t]).range(r).unknown(a)},Ui.apply(To(o),arguments)}function ET(){var e=[.5],t=[0,1],n,i=1;function r(a){return a<=a?t[Zr(e,a,0,i)]:n}return r.domain=function(a){return arguments.length?(e=Array.from(a),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(a){return arguments.length?(t=Array.from(a),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},r.unknown=function(a){return arguments.length?(n=a,r):n},r.copy=function(){return ET().domain(e).range(t).unknown(n)},Ui.apply(r,arguments)}var Vu=1e3,Xu=Vu*60,Ju=Xu*60,Ku=Ju*24,QU=Ku*7,kT=Ku*30,ub=Ku*365;function ZU(e){return new Date(e)}function eq(e){return e instanceof Date?+e:+new Date(+e)}function cb(e,t,n,i,r,a,o,s,l){var u=sT(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),g=l("%I %p"),m=l("%a %d"),v=l("%b %d"),y=l("%B"),b=l("%Y"),E=[[o,1,Vu],[o,5,5*Vu],[o,15,15*Vu],[o,30,30*Vu],[a,1,Xu],[a,5,5*Xu],[a,15,15*Xu],[a,30,30*Xu],[r,1,Ju],[r,3,3*Ju],[r,6,6*Ju],[r,12,12*Ju],[i,1,Ku],[i,2,2*Ku],[n,1,QU],[t,1,kT],[t,3,3*kT],[e,1,ub]];function x(w){return(o(w)<w?d:a(w)<w?h:r(w)<w?p:i(w)<w?g:t(w)<w?n(w)<w?m:v:e(w)<w?y:b)(w)}function k(w,A,_){if(w==null&&(w=10),typeof w=="number"){var O=Math.abs(_-A)/w,S=cd(function(D){return D[2]}).right(E,O),T;return S===E.length?(T=ea(A/ub,_/ub,w),w=e):S?(S=E[O/E[S-1][2]<E[S][2]/O?S-1:S],T=S[1],w=S[0]):(T=Math.max(ea(A,_,w),1),w=s),w.every(T)}return w}return u.invert=function(w){return new Date(c(w))},u.domain=function(w){return arguments.length?f(Array.from(w,eq)):f().map(ZU)},u.ticks=function(w){var A=f(),_=A[0],O=A[A.length-1],S=O<_,T;return S&&(T=_,_=O,O=T),T=k(w,_,O),T=T?T.range(_,O+1):[],S?T.reverse():T},u.tickFormat=function(w,A){return A==null?x:l(A)},u.nice=function(w){var A=f();return(w=k(w,A[0],A[A.length-1]))?f(fT(A,w)):u},u.copy=function(){return Yu(u,cb(e,t,n,i,r,a,o,s,l))},u}function tq(){return Ui.apply(cb(ta,E0,wd,fo,e_,Zk,bd,As,N0).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function nq(){return Ui.apply(cb(na,A0,xd,po,n_,t_,bd,As,I0).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function $h(){var e=0,t=1,n,i,r,a,o=mn,s=!1,l;function u(f){return isNaN(f=+f)?l:o(r===0?.5:(f=(a(f)-n)*r,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,n=a(e=+e),i=a(t=+t),r=n===i?0:1/(i-n),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function c(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),u):[o(0),o(1)]}}return u.range=c(Oo),u.rangeRound=c(Wu),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return a=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),u}}function ba(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function fb(){var e=To($h()(mn));return e.copy=function(){return ba(e,fb())},ma.apply(e,arguments)}function _T(){var e=ab($h()).domain([1,10]);return e.copy=function(){return ba(e,_T()).base(e.base())},ma.apply(e,arguments)}function AT(){var e=ob($h());return e.copy=function(){return ba(e,AT()).constant(e.constant())},ma.apply(e,arguments)}function db(){var e=sb($h());return e.copy=function(){return ba(e,db()).exponent(e.exponent())},ma.apply(e,arguments)}function iq(){return db.apply(null,arguments).exponent(.5)}function Dh(){var e=0,t=.5,n=1,i=1,r,a,o,s,l,u=mn,c,f=!1,d;function h(g){return isNaN(g=+g)?d:(g=.5+((g=+c(g))-a)*(i*g<i*a?s:l),u(f?Math.max(0,Math.min(1,g)):g))}h.domain=function(g){return arguments.length?([e,t,n]=g,r=c(e=+e),a=c(t=+t),o=c(n=+n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h):[e,t,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(u=g,h):u};function p(g){return function(m){var v,y,b;return arguments.length?([v,y,b]=m,u=nb(g,[v,y,b]),h):[u(0),u(.5),u(1)]}}return h.range=p(Oo),h.rangeRound=p(Wu),h.unknown=function(g){return arguments.length?(d=g,h):d},function(g){return c=g,r=g(e),a=g(t),o=g(n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h}}function ST(){var e=To(Dh()(mn));return e.copy=function(){return ba(e,ST())},ma.apply(e,arguments)}function OT(){var e=ab(Dh()).domain([.1,1,10]);return e.copy=function(){return ba(e,OT()).base(e.base())},ma.apply(e,arguments)}function TT(){var e=ob(Dh());return e.copy=function(){return ba(e,TT()).constant(e.constant())},ma.apply(e,arguments)}function hb(){var e=sb(Dh());return e.copy=function(){return ba(e,hb()).exponent(e.exponent())},ma.apply(e,arguments)}function rq(){return hb.apply(null,arguments).exponent(.5)}function pb(){var e=Ly().unknown(void 0),t=e.domain,n=e.range,i=[0,1],r,a,o=!1,s=0,l=0,u=.5;delete e.unknown;function c(){var f=t().length,d=i[1]<i[0],h=i[d-0],p=i[1-d],g=Ry(f,s,l);r=(p-h)/(g||1),o&&(r=Math.floor(r)),h+=(p-h-r*(f-s))*u,a=r*(1-s),o&&(h=Math.round(h),a=Math.round(a));var m=lo(f).map(function(v){return h+r*v});return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return r},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),s=l,c()):s},e.paddingInner=function(f){return arguments.length?(s=Math.max(0,Math.min(1,f)),c()):s},e.paddingOuter=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;var d=+f[0],h=+f[1],p=i[1]<i[0],g=p?n().reverse():n(),m=g.length-1,v,y,b;return d!==d||h!==h?void 0:(h<d&&(b=d,d=h,h=b),h<g[0]||d>i[1-p]?void 0:(v=Math.max(0,Zr(g,d)-1),y=d===h?v:Zr(g,h)-1,d-g[v]>a+1e-10&&++v,p&&(b=v,v=m-y,y=m-b),v>y?void 0:t().slice(v,y+1)))},e.invert=function(f){var d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return pb().domain(t()).range(i).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function CT(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return CT(t())},e}function aq(){return CT(pb().paddingInner(1))}var oq=Array.prototype.map;function sq(e){return oq.call(e,function(t){return+t})}var lq=Array.prototype.slice;function $T(){var e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(Zr(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=sq(i),n):e.slice()},n.range=function(i){return arguments.length?(t=lq.call(i),n):t.slice()},n.tickFormat=function(i,r){return lT(e[0],ve(e),i??10,r)},n.copy=function(){return $T().domain(n.domain()).range(n.range())},n}const Rh={};function uq(e,t,n){const i=function(){var a=t();return a.invertRange||(a.invertRange=a.invert?tU(a):a.invertExtent?nU(a):void 0),a.type=e,a};return i.metadata=kt(G(n)),i}function Ee(e,t,n){return arguments.length>1?(Rh[e]=uq(e,t,n),this):DT(e)?Rh[e]:void 0}Ee(eU,cT),Ee(Vs,uT,ut),Ee(kr,gT,[ut,kr]),Ee(Mu,lb,ut),Ee(ju,KU,ut),Ee(vh,yT,ut),Ee(ko,tq,[ut,My]),Ee(_o,nq,[ut,My]),Ee(Bi,fb,[ut,Xn]),Ee(`${Bi}-${Vs}`,fb,[ut,Xn]),Ee(`${Bi}-${kr}`,_T,[ut,Xn,kr]),Ee(`${Bi}-${Mu}`,db,[ut,Xn]),Ee(`${Bi}-${ju}`,iq,[ut,Xn]),Ee(`${Bi}-${vh}`,AT,[ut,Xn]),Ee(`${Xs}-${Vs}`,ST,[ut,Xn]),Ee(`${Xs}-${kr}`,OT,[ut,Xn,kr]),Ee(`${Xs}-${Mu}`,hb,[ut,Xn]),Ee(`${Xs}-${ju}`,rq,[ut,Xn]),Ee(`${Xs}-${vh}`,TT,[ut,Xn]),Ee(Js,wT,[Pu,Js]),Ee(yh,xT,Pu),Ee(bh,ET,Pu),Ee(Iy,$T,[Lu,Pu]),Ee(Fy,Ly,Lu),Ee(bO,pb,Lu),Ee(Ny,aq,Lu);function DT(e){return Q(Rh,e)}function Co(e,t){const n=Rh[e];return n&&n.metadata[t]}function gb(e){return Co(e,ut)}function tl(e){return Co(e,Lu)}function mb(e){return Co(e,Pu)}function RT(e){return Co(e,kr)}function cq(e){return Co(e,My)}function FT(e){return Co(e,Xn)}function NT(e){return Co(e,Js)}const fq=["clamp","base","constant","exponent"];function IT(e,t){var n=t[0],i=ve(t)-n;return function(r){return e(n+r*i)}}function Fh(e,t,n){return nb(vb(t||"rgb",n),e)}function MT(e,t){for(var n=new Array(t),i=t+1,r=0;r<t;)n[r]=e(++r/i);return n}function jT(e,t,n){var i=n-t,r,a,o;return!i||!Number.isFinite(i)?Vt(.5):(r=(a=e.type).indexOf("-"),a=r<0?a:a.slice(r+1),o=Ee(a)().domain([t,n]).range([0,1]),fq.forEach(s=>e[s]?o[s](e[s]()):0),o)}function vb(e,t){var n=PU[dq(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function dq(e){return"interpolate"+e.toLowerCase().split("-").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("")}const hq={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},pq={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function LT(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function PT(e,t){for(let n in e)yb(n,t(e[n]))}const zT={};PT(pq,LT),PT(hq,e=>Fh(LT(e)));function yb(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(zT[e]=t,this):zT[e]}var Nh="symbol",gq="discrete",mq="gradient";const vq=e=>I(e)?e.map(t=>String(t)):String(e),yq=(e,t)=>e[1]-t[1],bq=(e,t)=>t[1]-e[1];function bb(e,t,n){var i;return Re(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(td(e.domain())/n||1)))),K(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===ko?Os(t):e.type==_o?Ts(t):F("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function BT(e,t,n){let i=e.range(),r=i[0],a=ve(i),o=yq;if(r>a&&(i=a,a=r,r=i,o=bq),r=Math.floor(r),a=Math.ceil(a),t=t.map(s=>[s,e(s)]).filter(s=>r<=s[1]&&s[1]<=a).sort(o).map(s=>s[0]),n>0&&t.length>1){const s=[t[0],ve(t)];for(;t.length>n&&t.length>=3;)t=t.filter((l,u)=>!(u%2));t.length<3&&(t=s)}return t}function wb(e,t){return e.bins?BT(e,e.bins):e.ticks?e.ticks(t):e.domain()}function UT(e,t,n,i,r,a){var o=t.type;let s=vq;if(o===ko||r===ko)s=e.timeFormat(i);else if(o===_o||r===_o)s=e.utcFormat(i);else if(RT(o)){const l=e.formatFloat(i);if(a||t.bins)s=l;else{const u=qT(t,n,!1);s=c=>u(c)?l(c):""}}else if(t.tickFormat){const l=t.domain();s=e.formatSpan(l[0],l[l.length-1],n,i)}else i&&(s=e.format(i));return s}function qT(e,t,n){const i=wb(e,t),r=e.base(),a=Math.log(r),o=Math.max(1,r*t/i.length),s=l=>{let u=l/Math.pow(r,Math.round(Math.log(l)/a));return u*r<r-.5&&(u*=r),u<=o};return n?i.filter(s):s}const xb={[Js]:"quantiles",[yh]:"thresholds",[bh]:"domain"},WT={[Js]:"quantiles",[yh]:"domain"};function GT(e,t){return e.bins?Eq(e.bins):e.type===kr?qT(e,t,!0):xb[e.type]?xq(e[xb[e.type]]()):wb(e,t)}function wq(e,t,n){var i=t[WT[t.type]](),r=i.length,a=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)a=Math.min(a,i[o]-i[o-1]);return e.formatSpan(0,a,3*10,n)}function xq(e){const t=[-Infinity].concat(e);return t.max=Infinity,t}function Eq(e){const t=e.slice(0,-1);return t.max=ve(e),t}function kq(e){return xb[e.type]||e.bins}function HT(e,t,n,i,r,a,o){const s=WT[t.type]&&a!==ko&&a!==_o?wq(e,t,r):UT(e,t,n,r,a,o);return i===Nh&&kq(t)?_q(s):i===gq?Aq(s):Sq(s)}function _q(e){return(t,n,i)=>{var r=YT(i[n+1],YT(i.max,Infinity)),a=VT(t,e),o=VT(r,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a}}function YT(e,t){return e??t}function Aq(e){return(t,n)=>n?e(t):null}function Sq(e){return t=>e(t)}function VT(e,t){return Number.isFinite(e)?t(e):null}function Oq(e){var t=e.domain(),n=t.length-1,i=+t[0],r=+ve(t),a=r-i;if(e.type===bh){const o=n?a/n:.1;i-=o,r+=o,a=r-i}return o=>(o-i)/a}function Tq(e,t,n,i){const r=i||t.type;return Y(n)&&cq(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===ko?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===_o?e.utcFormat("%A, %d %B %Y, %X UTC"):HT(e,t,5,null,n,i,!0)}function XT(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=Tq(e,t,n.format,n.formatType);if(mb(t.type)){const a=GT(t).slice(1).map(r),o=a.length;return`${o} boundar${o===1?"y":"ies"}: ${a.join(", ")}`}else if(tl(t.type)){const a=t.domain(),o=a.length,s=o>i?a.slice(0,i-2).map(r).join(", ")+", ending with "+a.slice(-1).map(r):a.map(r).join(", ");return`${o} value${o===1?"":"s"}: ${s}`}else{const a=t.domain();return`values from ${r(a[0])} to ${r(ve(a))}`}}const JT="aria-hidden",Eb="aria-label",kb="role",_b="aria-roledescription",KT="graphics-object",Ab="graphics-symbol",QT=(e,t,n)=>({[kb]:e,[_b]:t,[Eb]:n||void 0}),Cq=kt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),ZT={axis:{desc:"axis",caption:Rq},legend:{desc:"legend",caption:Fq},"title-text":{desc:"title",caption:e=>`Title text '${iC(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${iC(e)}'`}},eC={ariaRole:kb,ariaRoleDescription:_b,description:Eb};function tC(e,t){const n=t.aria===!1;if(e(JT,n||void 0),n||t.description==null)for(const i in eC)e(eC[i],void 0);else{const i=t.mark.marktype;e(Eb,t.description),e(kb,t.ariaRole||(i==="group"?KT:Ab)),e(_b,t.ariaRoleDescription||`${i} mark`)}}function nC(e){return e.aria===!1?{[JT]:!0}:Cq[e.role]?null:ZT[e.role]?Dq(e,ZT[e.role]):$q(e)}function $q(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return QT(n?KT:Ab,`${t} mark container`,e.description)}function Dq(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return QT(t.role||Ab,t.desc,n.description||i(n))}catch(n){return null}}function iC(e){return G(e.text).join(" ")}function Rq(e){const t=e.datum,n=e.orient,i=t.title?rC(e):null,r=e.context,a=r.scales[t.scale].value,o=r.dataflow.locale(),s=a.type,l=n==="left"||n==="right"?"Y":"X";return`${l}-axis`+(i?` titled '${i}'`:"")+` for a ${tl(s)?"discrete":s} scale with ${XT(o,a,e)}`}function Fq(e){const t=e.datum,n=t.title?rC(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,a=Object.keys(r),o=e.context,s=o.scales[r[a[0]]].value,l=o.dataflow.locale();return Iq(i)+(n?` titled '${n}'`:"")+` for ${Nq(a)} with ${XT(l,s,e)}`}function rC(e){try{return G(ve(e.items).items[0].text).join(" ")}catch(t){return null}}function Nq(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ve(e)}function Iq(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const Mq=e=>(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function We(e,t,n){var i="<"+e,r,a;if(t)for(r in t)a=t[r],a!=null&&(i+=" "+r+'="'+Mq(a)+'"');return n&&(i+=" "+n),i+">"}function Ye(e){return"</"+e+">"}const Ih={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Sb={fill:"none","stroke-miterlimit":10},Mh=0,Ot=Hs.xmlns;function Ob(e){vi.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var vn=P(Ob,vi),Tb=vi.prototype;vn.initialize=function(e,t,n,i){if(this._defs={gradient:{},clipping:{}},e){this._svg=In(e,0,"svg",Ot),this._svg.setAttribute("class","marks"),mi(e,1),this._root=In(this._svg,Mh,"g",Ot);for(const r in Sb)this._root.setAttribute(r,Sb[r]);mi(this._svg,Mh+1)}return this.background(this._bgcolor),Tb.initialize.call(this,e,t,n,i)},vn.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Tb.background.apply(this,arguments)},vn.resize=function(e,t,n,i){return Tb.resize.call(this,e,t,n,i),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},vn.canvas=function(){return this._svg},vn.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in Hs)e[t]=Hs[t];var n=this._bgcolor?We("rect",{width:this._width,height:this._height,fill:this._bgcolor})+Ye("rect"):"";return We("svg",e)+(this._defs.el?this._defs.el.outerHTML:"")+n+this._root.outerHTML+Ye("svg")},vn._render=function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e),mi(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},vn.updateDefs=function(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=In(e,Mh,"defs",Ot)),i=jq(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=In(e,Mh,"defs",Ot)),i=Lq(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):mi(n,i))};function jq(e,t,n){var i,r,a;if(t.gradient==="radial"){var o=In(e,n++,"pattern",Ot);o.setAttribute("id",Id+t.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),o=In(o,0,"rect",Ot),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+sC()+"#"+t.id+")"),e=In(e,n++,"radialGradient",Ot),e.setAttribute("id",t.id),e.setAttribute("fx",t.x1),e.setAttribute("fy",t.y1),e.setAttribute("fr",t.r1),e.setAttribute("cx",t.x2),e.setAttribute("cy",t.y2),e.setAttribute("r",t.r2)}else e=In(e,n++,"linearGradient",Ot),e.setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2);for(i=0,r=t.stops.length;i<r;++i)a=In(e,i,"stop",Ot),a.setAttribute("offset",t.stops[i].offset),a.setAttribute("stop-color",t.stops[i].color);return mi(e,i),n}function Lq(e,t,n){var i;return e=In(e,n,"clipPath",Ot),e.setAttribute("id",t.id),t.path?(i=In(e,0,"path",Ot),i.setAttribute("d",t.path)):(i=In(e,0,"rect",Ot),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",t.width),i.setAttribute("height",t.height)),mi(e,1),n+1}vn._resetDefs=function(){var e=this._defs;e.gradient={},e.clipping={}},vn.dirty=function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},vn.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},vn._dirtyCheck=function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length||!this._dirtyID)return!0;var t=++this._dirtyID,n,i,r,a,o,s,l;for(o=0,s=e.length;o<s;++o){if(n=e[o],i=n.mark,i.marktype!==r&&(r=i.marktype,a=Yn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,aC(n,t),i.items.forEach(function(u){u.dirty=t})),i.zdirty)continue;if(n.exit){a.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null;continue}if(n=a.nested?i.items[0]:n,n._update===t)continue;!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,aC(n,t)):this._update(a,n._svg,n),n._update=t}return!this._dirtyAll};function aC(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}vn.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var i=this._svg,r=Yn[t.marktype],a=t.interactive===!1?"none":null,o=r.tag==="g",s=null,l=0,u;u=oC(t,e,n,"g",i),u.setAttribute("class",cO(t));const c=nC(t);for(const d in c)yn(u,d,c[d]);o||yn(u,"pointer-events",a),yn(u,"clip-path",t.clip?oy(this,t,t.group):null);const f=d=>{const h=this.isDirty(d),p=oC(d,u,s,r.tag,i);h&&(this._update(r,p,d),o&&Pq(this,p,d)),s=p,++l};return r.nested?t.items.length&&f(t.items[0]):gi(t,f),mi(u,l),u};function Pq(e,t,n){t=t.lastChild.previousSibling;let i,r=0;gi(n,a=>{i=e.draw(t,a,i),++r}),mi(t,1+r)}function oC(e,t,n,i,r){let a=e._svg,o;if(!a&&(o=t.ownerDocument,a=ha(o,i,Ot),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},i==="g"))){const s=ha(o,"path",Ot);a.appendChild(s),s.__data__=e;const l=ha(o,"g",Ot);a.appendChild(l),l.__data__=e;const u=ha(o,"path",Ot);a.appendChild(u),u.__data__=e,u.__values__={fill:"default"}}return(a.ownerSVGElement!==r||zq(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}function zq(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}var Ar=null,Lt=null,Bq={group:function(e,t,n){const i=Ar=t.childNodes[2];Lt=i.__values__,e.foreground(Qu,n,this),Lt=t.__values__,Ar=t.childNodes[1],e.content(Qu,n,this);const r=Ar=t.childNodes[0];e.background(Qu,n,this);const a=n.mark.interactive===!1?"none":null;if(a!==Lt.events&&(yn(i,"pointer-events",a),yn(r,"pointer-events",a),Lt.events=a),n.strokeForeground&&n.stroke){const o=n.fill;yn(i,"display",null),this.style(r,n),yn(r,"stroke",null),o&&(n.fill=null),Lt=i.__values__,this.style(i,n),o&&(n.fill=o),Ar=null}else yn(i,"display","none")},image:function(e,t,n){n.smooth===!1?(Cb(t,"image-rendering","optimizeSpeed"),Cb(t,"image-rendering","pixelated")):Cb(t,"image-rendering",null)},text:function(e,t,n){let i=$u(n),r,a,o,s;I(i)?(a=i.map(l=>da(n,l)),r=a.join(`
`),r!==Lt.text&&(mi(t,0),o=t.ownerDocument,s=fa(n),a.forEach((l,u)=>{const c=ha(o,"tspan",Ot);c.__data__=n,c.textContent=l,u&&(c.setAttribute("x",0),c.setAttribute("dy",s)),t.appendChild(c)}),Lt.text=r)):(a=da(n,i),a!==Lt.text&&(t.textContent=a,Lt.text=a)),yn(t,"font-family",Du(n)),yn(t,"font-size",zi(n)+"px"),yn(t,"font-style",n.fontStyle),yn(t,"font-variant",n.fontVariant),yn(t,"font-weight",n.fontWeight)}};function Cb(e,t,n){n!==Lt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Lt[t]=n)}vn._update=function(e,t,n){Ar=t,Lt=t.__values__,tC(Qu,n),e.attr(Qu,n,this);const i=Bq[e.type];i&&i.call(this,e,t,n),Ar&&this.style(Ar,n)};function Qu(e,t,n){if(t===Lt[e])return;n?Uq(Ar,e,t,n):yn(Ar,e,t),Lt[e]=t}function yn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function Uq(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}vn.style=function(e,t){if(t==null)return;for(const n in Ih){let i=n==="font"?Du(t):t[n];if(i===Lt[n])continue;const r=Ih[n];i==null?e.removeAttribute(r):(Wv(i)&&(i=QA(i,this._defs.gradient,sC())),e.setAttribute(r,i+"")),Lt[n]=i}};function sC(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function $b(e){vi.call(this,e),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}var Sr=P($b,vi),lC=vi.prototype;Sr.resize=function(e,t,n,i){lC.resize.call(this,e,t,n,i);var r=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var s in Hs)o[s]=Hs[s];a.head=We("svg",o);var l=this._bgcolor;return(l==="transparent"||l==="none")&&(l=null),l?a.bg=We("rect",{width:this._width,height:this._height,fill:l})+Ye("rect"):a.bg="",a.root=We("g",fe({},Sb,{transform:"translate("+r+")"})),a.foot=Ye("g")+Ye("svg"),this},Sr.background=function(){var e=lC.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),e},Sr.svg=function(){var e=this._text;return e.head+e.defs+e.bg+e.root+e.body+e.foot},Sr._render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},Sr.buildDefs=function(){let e="",t;for(const n in this._defs.gradient){const i=this._defs.gradient[n],r=i.stops;i.gradient==="radial"?(e+=We(t="pattern",{id:Id+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e+=We("rect",{width:"1",height:"1",fill:"url(#"+n+")"})+Ye("rect"),e+=Ye(t),e+=We(t="radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e+=We(t="linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let a=0;a<r.length;++a)e+=We("stop",{offset:r[a].offset,"stop-color":r[a].color})+Ye("stop");e+=Ye(t)}for(const n in this._defs.clipping){const i=this._defs.clipping[n];e+=We("clipPath",{id:n}),i.path?e+=We("path",{d:i.path})+Ye("path"):e+=We("rect",{x:0,y:0,width:i.width,height:i.height})+Ye("rect"),e+=Ye("clipPath")}return e?We("defs")+e+Ye("defs"):""},Sr.attr=function(e,t,n,i){const r={},a=(o,s,l,u)=>{r[u||o]=s};return Array.isArray(n)?n.forEach(o=>o(a,t,this)):n(a,t,this),i&&qq(r,t,e,i,this._defs),r},Sr.href=function(e){var t=this,n=e.href,i;if(n){if(i=t._hrefs&&t._hrefs[n])return i;t.sanitizeURL(n).then(r=>{r["xlink:href"]=r.href,r.href=null,(t._hrefs||(t._hrefs={}))[n]=r})}return null},Sr.mark=function(e){const t=Yn[e.marktype],n=t.tag,i=[tC,t.attr];let r="";r+=We("g",fe({class:cO(e),"clip-path":e.clip?oy(this,e,e.group):null},nC(e),{"pointer-events":n!=="g"&&e.interactive===!1?"none":null}));const a=o=>{const s=this.href(o);if(s&&(r+=We("a",s)),r+=We(n,this.attr(e,o,i,n!=="g"?n:null)),n==="text"){const l=$u(o);if(I(l)){const u={x:0,dy:fa(o)};for(let c=0;c<l.length;++c)r+=We("tspan",c?u:null)+uC(da(o,l[c]))+Ye("tspan")}else r+=uC(da(o,l))}else if(n==="g"){const l=o.strokeForeground,u=o.fill,c=o.stroke;l&&c&&(o.stroke=null),r+=We("path",this.attr(e,o,t.background,"bgrect"))+Ye("path"),r+=We("g",this.attr(e,o,t.content))+this.markGroup(o)+Ye("g"),l&&c?(u&&(o.fill=null),o.stroke=c,r+=We("path",this.attr(e,o,t.foreground,"bgrect"))+Ye("path"),u&&(o.fill=u)):r+=We("path",this.attr(e,o,t.foreground,"bgfore"))+Ye("path")}r+=Ye(n),s&&(r+=Ye("a"))};return t.nested?e.items&&e.items.length&&a(e.items[0]):gi(e,a),r+Ye("g")},Sr.markGroup=function(e){let t="";return gi(e,n=>{t+=this.mark(n)}),t};function qq(e,t,n,i,r){if(t==null)return e;if(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null))return e;i==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),i==="text"&&(e["font-family"]=Du(t),e["font-size"]=zi(t)+"px",t.fontStyle&&(e["font-style"]=t.fontStyle),t.fontVariant&&(e["font-variant"]=t.fontVariant),t.fontWeight&&(e["font-weight"]=t.fontWeight));for(const a in Ih){let o=t[a];const s=Ih[a];o==="transparent"&&(s==="fill"||s==="stroke")||o!=null&&(Wv(o)&&(o=QA(o,r.gradient,"")),e[s]=o)}return e}function uC(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var cC="canvas",fC="png",dC="svg",hC="none",wa={Canvas:cC,PNG:fC,SVG:dC,None:hC},nl={};nl[cC]=nl[fC]={renderer:gh,headless:gh,handler:Iu},nl[dC]={renderer:Ob,headless:$b,handler:$y},nl[hC]={};function jh(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(nl[e]=t,this):nl[e]}function pC(e,t,n){const i=[],r=new st().union(t),a=e.marktype;return a?gC(e,r,n,i):a==="group"?mC(e,r,n,i):F("Intersect scene must be mark node or group item.")}function gC(e,t,n,i){if(Wq(e,t,n)){const r=e.items,a=e.marktype,o=r.length;let s=0;if(a==="group")for(;s<o;++s)mC(r[s],t,n,i);else for(const l=Yn[a].isect;s<o;++s){let u=r[s];vC(u,t,l)&&i.push(u)}}return i}function Wq(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function mC(e,t,n,i){n&&n(e.mark)&&vC(e,t,Yn.group.isect)&&i.push(e);const r=e.items,a=r&&r.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let l=0;l<a;++l)gC(r[l],t,n,i);t.translate(o,s)}return i}function vC(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}var Db=new st();function yC(e){var t=e.clip;if(ge(t))t(gn(Db.clear()));else if(t)Db.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(Db)}var Gq=1e-9;function Rb(e,t,n){return e===t?!0:n==="path"?bC(e,t):e instanceof Date&&t instanceof Date?+e===+t:Re(e)&&Re(t)?Math.abs(e-t)<=Gq:!e||!t||!K(e)&&!K(t)?e==t:e==null||t==null?!1:Hq(e,t)}function bC(e,t){return Rb(Ps(e),Ps(t))}function Hq(e,t){var n=Object.keys(e),i=Object.keys(t),r,a;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),a=n.length-1;a>=0;a--)if(n[a]!=i[a])return!1;for(a=n.length-1;a>=0;a--)if(r=n[a],!Rb(e[r],t[r],r))return!1;return typeof e===typeof t}function Yq(){DS(),k9()}function wC(e){$.call(this,null,e)}var Vq=P(wC,$);Vq.transform=function(e,t){var n=t.dataflow,i=e.mark,r=i.marktype,a=Yn[r],o=a.bound,s=i.bounds,l;if(a.nested)i.items.length&&n.dirty(i.items[0]),s=Lh(i,o),i.items.forEach(function(u){u.bounds.clear().union(s)});else if(r===Fd||e.modified()){t.visit(t.MOD,u=>n.dirty(u)),s.clear(),i.items.forEach(u=>s.union(Lh(u,o)));switch(i.role){case Lv:case zv:case Pv:t.reflow()}}else l=t.changed(t.REM),t.visit(t.ADD,u=>{s.union(Lh(u,o))}),t.visit(t.MOD,u=>{l=l||s.alignsWith(u.bounds),n.dirty(u),s.union(Lh(u,o))}),l&&(s.clear(),i.items.forEach(u=>s.union(u.bounds)));return yC(i),t.modifies("bounds")};function Lh(e,t,n){return t(e.bounds.clear(),e,n)}var xC=":vega_identifier:";function Fb(e){$.call(this,0,e)}Fb.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};var Xq=P(Fb,$);Xq.transform=function(e,t){var n=Jq(t.dataflow),i=n.value,r=e.as;return t.visit(t.ADD,a=>{a[r]||(a[r]=++i)}),n.set(this.value=i),t};function Jq(e){var t=e._signals[xC];return t||(e._signals[xC]=t=e.add(0)),t}function EC(e){$.call(this,null,e)}var Kq=P(EC,$);Kq.transform=function(e,t){var n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,Qq(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);var i=n.marktype===Fd?Yd:Hd;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t};function Qq(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function kC(e){$.call(this,null,e)}var Zq=P(kC,$),_C={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{var n;return e.filter((i,r)=>!r||!AC(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}};function AC(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)}function SC(e,t){for(var n=1,i=e.length,r=e[0].bounds,a;n<i;r=a,++n)if(AC(r,a=e[n].bounds,t))return!0}function eW(e){var t=e.bounds;return t.width()>1&&t.height()>1}function tW(e,t,n){var i=e.range(),r=new st();return t===Ms||t===aa?r.set(i[0],-Infinity,i[1],Infinity):r.set(-Infinity,i[0],Infinity,i[1]),r.expand(n||1),a=>r.encloses(a.bounds)}function OC(e){return e.forEach(t=>t.opacity=1),e}function TC(e,t){return e.reflow(t.modified()).modifies("opacity")}Zq.transform=function(e,t){var n=_C[e.method]||_C.parity,i=t.materialize(t.SOURCE).source,r=e.separation||0,a,o,s;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(OC(i),t=TC(t,e)),t;if(i=i.filter(eW),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),a=OC(i),t=TC(t,e),a.length>=3&&SC(a,r)){do a=n(a,r);while(a.length>=3&&SC(a,r));a.length<3&&!ve(i).opacity&&(a.length>1&&(ve(a).opacity=0),ve(i).opacity=1)}return e.boundScale&&e.boundTolerance>=0&&(o=tW(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(l=>{o(l)||(l.opacity=0)})),s=a[0].mark.bounds.clear(),i.forEach(l=>{l.opacity&&s.union(l.bounds)}),t};function CC(e){$.call(this,null,e)}var nW=P(CC,$);nW.transform=function(e,t){var n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){var i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}};const Pt=new st();function il(e,t,n){return e[t]===n?0:(e[t]=n,1)}function iW(e){var t=e.items[0].orient;return t===di||t===hi}function rW(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function aW(e,t,n,i){var r=t.items[0],a=r.datum,o=r.translate!=null?r.translate:.5,s=r.orient,l=rW(a),u=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,p=a.title&&r.items[l[2]].items[0],g=r.titlePadding,m=r.bounds,v=p&&xy(p),y=0,b=0,E,x;Pt.clear().union(m),m.clear(),(E=l[0])>-1&&m.union(r.items[E].bounds),(E=l[1])>-1&&m.union(r.items[E].bounds);switch(s){case Ms:y=f||0,b=-c,x=Math.max(d,Math.min(h,-m.y1)),m.add(0,-x).add(u,0),p&&Ph(e,p,x,g,v,0,-1,m);break;case di:y=-c,b=f||0,x=Math.max(d,Math.min(h,-m.x1)),m.add(-x,0).add(0,u),p&&Ph(e,p,x,g,v,1,-1,m);break;case hi:y=n+c,b=f||0,x=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(x,u),p&&Ph(e,p,x,g,v,1,1,m);break;case aa:y=f||0,b=i+c,x=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(u,x),p&&Ph(e,p,x,g,0,0,1,m);break;default:y=r.x,b=r.y}return Er(m.translate(y,b),r),il(r,"x",y+o)|il(r,"y",b+o)&&(r.bounds=Pt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Ph(e,t,n,i,r,a,o,s){const l=t.bounds;if(t.auto){const u=o*(n+r+i);let c=0,f=0;e.dirty(t),a?c=(t.x||0)-(t.x=u):f=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-c,-f)),e.dirty(t)}s.union(l)}const $C=(e,t)=>Math.floor(Math.min(e,t)),DC=(e,t)=>Math.ceil(Math.max(e,t));function oW(e){for(var t=e.items,n=t.length,i=0,r,a,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};i<n;++i)if(r=t[i],a=r.items,r.marktype===Fd)switch(r.role){case Lv:case zv:case Pv:break;case WA:o.rowheaders.push(...a);break;case GA:o.rowfooters.push(...a);break;case YA:o.colheaders.push(...a);break;case VA:o.colfooters.push(...a);break;case HA:o.rowtitle=a[0];break;case XA:o.coltitle=a[0];break;default:o.marks.push(...a)}return o}function sW(e){return new st().set(0,0,e.width||0,e.height||0)}function lW(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Be(e,t,n){var i=K(e)?e[t]:e;return i??(n!==void 0?n:0)}function RC(e){return e<0?Math.ceil(-e):0}function FC(e,t,n){var i=!n.nodirty,r=n.bounds===qv?sW:lW,a=Pt.set(0,0,0,0),o=Be(n.align,oa),s=Be(n.align,sa),l=Be(n.padding,oa),u=Be(n.padding,sa),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),p=Array(c),g=0,m=Array(d),v=Array(f),y=0,b=Array(d),E=Array(d),x=Array(d),k,w,A,_,O,S,T,D,M,C,N;for(w=0;w<c;++w)p[w]=0;for(w=0;w<f;++w)v[w]=0;for(w=0;w<d;++w)S=t[w],O=x[w]=r(S),S.x=S.x||0,b[w]=0,S.y=S.y||0,E[w]=0,A=w%c,_=~~(w/c),g=Math.max(g,T=Math.ceil(O.x2)),y=Math.max(y,D=Math.ceil(O.y2)),p[A]=Math.max(p[A],T),v[_]=Math.max(v[_],D),h[w]=l+RC(O.x1),m[w]=u+RC(O.y1),i&&e.dirty(t[w]);for(w=0;w<d;++w)w%c===0&&(h[w]=0),w<c&&(m[w]=0);if(o===Uv)for(A=1;A<c;++A){for(N=0,w=A;w<d;w+=c)N<h[w]&&(N=h[w]);for(w=A;w<d;w+=c)h[w]=N+p[A-1]}else if(o===Nd){for(N=0,w=0;w<d;++w)w%c&&N<h[w]&&(N=h[w]);for(w=0;w<d;++w)w%c&&(h[w]=N+g)}else for(o=!1,A=1;A<c;++A)for(w=A;w<d;w+=c)h[w]+=p[A-1];if(s===Uv)for(_=1;_<f;++_){for(N=0,w=_*c,k=w+c;w<k;++w)N<m[w]&&(N=m[w]);for(w=_*c;w<k;++w)m[w]=N+v[_-1]}else if(s===Nd){for(N=0,w=c;w<d;++w)N<m[w]&&(N=m[w]);for(w=c;w<d;++w)m[w]=N+y}else for(s=!1,_=1;_<f;++_)for(w=_*c,k=w+c;w<k;++w)m[w]+=v[_-1];for(M=0,w=0;w<d;++w)M=h[w]+(w%c?M:0),b[w]+=M-t[w].x;for(A=0;A<c;++A)for(C=0,w=A;w<d;w+=c)C+=m[w],E[w]+=C-t[w].y;if(o&&Be(n.center,oa)&&f>1)for(w=0;w<d;++w)O=o===Nd?g:p[w%c],M=O-x[w].x2-t[w].x-b[w],M>0&&(b[w]+=M/2);if(s&&Be(n.center,sa)&&c!==1)for(w=0;w<d;++w)O=s===Nd?y:v[~~(w/c)],C=O-x[w].y2-t[w].y-E[w],C>0&&(E[w]+=C/2);for(w=0;w<d;++w)a.union(x[w].translate(b[w],E[w]));M=Be(n.anchor,p9),C=Be(n.anchor,g9);switch(Be(n.anchor,oa)){case Xt:M-=a.width();break;case jv:M-=a.width()/2}switch(Be(n.anchor,sa)){case Xt:C-=a.height();break;case jv:C-=a.height()/2}for(M=Math.round(M),C=Math.round(C),a.clear(),w=0;w<d;++w)t[w].mark.bounds.clear();for(w=0;w<d;++w)S=t[w],S.x+=b[w]+=M,S.y+=E[w]+=C,a.union(S.mark.bounds.union(S.bounds.translate(b[w],E[w]))),i&&e.dirty(S);return a}function uW(e,t,n){var i=oW(t),r=i.marks,a=n.bounds===qv?cW:fW,o=n.offset,s=n.columns||r.length,l=s<=0?1:Math.ceil(r.length/s),u=l*s,c,f,d,h,p,g,m;const v=FC(e,r,n);v.empty()&&v.set(0,0,0,0),i.rowheaders&&(g=Be(n.headerBand,sa,null),c=zh(e,i.rowheaders,r,s,l,-Be(o,"rowHeader"),$C,0,a,"x1",0,s,1,g)),i.colheaders&&(g=Be(n.headerBand,oa,null),f=zh(e,i.colheaders,r,s,s,-Be(o,"columnHeader"),$C,1,a,"y1",0,1,s,g)),i.rowfooters&&(g=Be(n.footerBand,sa,null),d=zh(e,i.rowfooters,r,s,l,Be(o,"rowFooter"),DC,0,a,"x2",s-1,s,1,g)),i.colfooters&&(g=Be(n.footerBand,oa,null),h=zh(e,i.colfooters,r,s,s,Be(o,"columnFooter"),DC,1,a,"y2",u-s,1,s,g)),i.rowtitle&&(p=Be(n.titleAnchor,sa),m=Be(o,"rowTitle"),m=p===Xt?d+m:c-m,g=Be(n.titleBand,sa,.5),NC(e,i.rowtitle,m,0,v,g)),i.coltitle&&(p=Be(n.titleAnchor,oa),m=Be(o,"columnTitle"),m=p===Xt?h+m:f-m,g=Be(n.titleBand,oa,.5),NC(e,i.coltitle,m,1,v,g))}function cW(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function fW(e,t){return e.bounds[t]}function zh(e,t,n,i,r,a,o,s,l,u,c,f,d,h){var p=n.length,g=0,m=0,v,y,b,E,x,k,w,A,_;if(!p)return g;for(v=c;v<p;v+=f)n[v]&&(g=o(g,l(n[v],u)));if(!t.length)return g;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),g+=a,y=0,E=t.length;y<E;++y)e.dirty(t[y]),t[y].mark.bounds.clear();for(v=c,y=0,E=t.length;y<E;++y,v+=f){for(k=t[y],x=k.mark.bounds,b=v;b>=0&&(w=n[b])==null;b-=d);s?(A=h==null?w.x:Math.round(w.bounds.x1+h*w.bounds.width()),_=g):(A=g,_=h==null?w.y:Math.round(w.bounds.y1+h*w.bounds.height())),x.union(k.bounds.translate(A-(k.x||0),_-(k.y||0))),k.x=A,k.y=_,e.dirty(k),m=o(m,x[u])}return m}function NC(e,t,n,i,r,a){if(!t)return;e.dirty(t);var o=n,s=n;i?o=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}function dW(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function hW(e,t){var n=-Infinity;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-Infinity?n:t}function pW(e,t,n,i,r,a,o){const s=dW(n,t),l=hW(e,s("offset",0)),u=s("anchor",Mv),c=u===Xt?1:u===jv?.5:0,f={align:Uv,bounds:s("bounds",qv),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case di:f.anchor={x:Math.floor(i.x1)-l,column:Xt,y:c*(o||i.height()+2*i.y1),row:u};break;case hi:f.anchor={x:Math.ceil(i.x2)+l,y:c*(o||i.height()+2*i.y1),row:u};break;case Ms:f.anchor={y:Math.floor(r.y1)-l,row:Xt,x:c*(a||r.width()+2*r.x1),column:u};break;case aa:f.anchor={y:Math.ceil(r.y2)+l,x:c*(a||r.width()+2*r.x1),column:u};break;case c9:f.anchor={x:l,y:l};break;case f9:f.anchor={x:a-l,y:l,column:Xt};break;case d9:f.anchor={x:l,y:o-l,row:Xt};break;case h9:f.anchor={x:a-l,y:o-l,column:Xt,row:Xt};break}return f}function gW(e,t){var n=t.items[0],i=n.datum,r=n.orient,a=n.bounds,o=n.x,s=n.y,l,u;return n._bounds?n._bounds.clear().union(a):n._bounds=a.clone(),a.clear(),vW(e,n,n.items[0].items[0]),a=mW(n,a),l=2*n.padding,u=2*n.padding,a.empty()||(l=Math.ceil(a.width()+l),u=Math.ceil(a.height()+u)),i.type===b9&&yW(n.items[0].items[0].items[0].items),r!==Bv&&(n.x=o=0,n.y=s=0),n.width=l,n.height=u,Er(a.set(o,s,o+l,s+u),n),n.mark.bounds.clear().union(a),n}function mW(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function vW(e,t,n){var i=t.padding,r=i-n.x,a=i-n.y;if(!t.datum.title)(r||a)&&Zu(e,n,r,a);else{var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=i-o.x,c=i-o.y;switch(o.orient){case di:r+=Math.ceil(o.bounds.width())+l;break;case hi:case aa:break;default:a+=o.bounds.height()+l}(r||a)&&Zu(e,n,r,a);switch(o.orient){case di:c+=rl(t,n,o,s,1,1);break;case hi:u+=rl(t,n,o,Xt,0,0)+l,c+=rl(t,n,o,s,1,1);break;case aa:u+=rl(t,n,o,s,0,0),c+=rl(t,n,o,Xt,-1,0,1)+l;break;default:u+=rl(t,n,o,s,0,0)}(u||c)&&Zu(e,o,u,c),(u=Math.round(o.bounds.x1-i))<0&&(Zu(e,n,-u,0),Zu(e,o,-u,0))}}function rl(e,t,n,i,r,a,o){const s=e.datum.type!=="symbol",l=n.datum.vgrad,u=s&&(a||!l)&&!o?t.items[0]:t,c=u.bounds[r?"y2":"x2"]-e.padding,f=l&&a?c:0,d=l&&a?0:c,h=r<=0?0:xy(n);return Math.round(i===Mv?f:i===Xt?d-h:.5*(c-h))}function Zu(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function yW(e){var t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function bW(e,t,n,i,r){var a=t.items[0],o=a.frame,s=a.orient,l=a.anchor,u=a.offset,c=a.padding,f=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],h=s===di||s===hi?i:n,p=0,g=0,m=0,v=0,y=0,b;if(o!==Fd?s===di?(p=r.y2,h=r.y1):s===hi?(p=r.y1,h=r.y2):(p=r.x1,h=r.x2):s===di&&(p=i,h=0),b=l===Mv?p:l===Xt?h:(p+h)/2,d&&d.text){switch(s){case Ms:case aa:y=f.bounds.height()+c;break;case di:v=f.bounds.width()+c;break;case hi:v=-f.bounds.width()-c;break}Pt.clear().union(d.bounds),Pt.translate(v-(d.x||0),y-(d.y||0)),il(d,"x",v)|il(d,"y",y)&&(e.dirty(d),d.bounds.clear().union(Pt),d.mark.bounds.clear().union(Pt),e.dirty(d)),Pt.clear().union(d.bounds)}else Pt.clear();Pt.union(f.bounds);switch(s){case Ms:g=b,m=r.y1-Pt.height()-u;break;case di:g=r.x1-Pt.width()-u,m=b;break;case hi:g=r.x2+Pt.width()+u,m=b;break;case aa:g=b,m=r.y2+u;break;default:g=a.x,m=a.y}return il(a,"x",g)|il(a,"y",m)&&(Pt.translate(g,m),e.dirty(a),a.bounds.clear().union(Pt),t.bounds.clear().union(Pt),e.dirty(a)),a.bounds}function IC(e){$.call(this,null,e)}var wW=P(IC,$);wW.transform=function(e,t){var n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&uW(n,i,e.layout),EW(n,i,e)}),xW(e.mark.group)?t.reflow():t};function xW(e){return e&&e.mark.role!=="legend-entry"}function EW(e,t,n){var i=t.items,r=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=new st().set(0,0,r,a),s=o.clone(),l=o.clone(),u=[],c,f,d,h,p,g;for(p=0,g=i.length;p<g;++p){f=i[p];switch(f.role){case Lv:h=iW(f)?s:l,h.union(aW(e,f,r,a));break;case Pv:c=f;break;case zv:u.push(gW(e,f));break;case m9:case v9:case WA:case GA:case HA:case YA:case VA:case XA:s.union(f.bounds),l.union(f.bounds);break;default:o.union(f.bounds)}}if(u.length){const m={};u.forEach(v=>{d=v.orient||hi,d!==Bv&&(m[d]||(m[d]=[])).push(v)});for(let v in m){const y=m[v];FC(e,y,pW(y,v,n.legends,s,l,r,a))}u.forEach(v=>{const y=v.bounds;if(y.equals(v._bounds)||(v.bounds=v._bounds,e.dirty(v),v.bounds=y,e.dirty(v)),n.autosize&&n.autosize.type===JA)switch(v.orient){case di:case hi:o.add(y.x1,0).add(y.x2,0);break;case Ms:case aa:o.add(0,y.y1).add(0,y.y2)}else o.union(y)})}o.union(s).union(l),c&&o.union(bW(e,c,r,a,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),kW(e,t,o,n)}function kW(e,t,n,i){const r=i.autosize||{},a=r.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-l)),f=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1)),h=Math.max(0,Math.ceil(n.y2-f));if(r.contains===y9){const p=e.padding();o-=p.left+p.right,s-=p.top+p.bottom}a===Bv?(u=0,d=0,l=o,f=s):a===JA?(l=Math.max(0,o-u-c),f=Math.max(0,s-d-h)):a===w9?(l=Math.max(0,o-u-c),s=f+d+h):a===x9?(o=l+u+c,f=Math.max(0,s-d-h)):a===E9&&(o=l+u+c,s=f+d+h),e._resizeView(o,s,l,f,[u,d],r.resize)}var _W=Object.freeze({__proto__:null,bound:wC,identifier:Fb,mark:EC,overlap:kC,render:CC,viewlayout:IC});function MC(e){$.call(this,null,e)}var AW=P(MC,$);AW.transform=function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,s=bb(a,o,e.minstep),l=e.format||UT(n,a,s,e.formatSpecifier,e.formatType,!!e.values),u=e.values?BT(a,e.values,s):wb(a,s);return r&&(i.rem=r),r=u.map(function(c,f){return ke({index:f/(u.length-1||1),value:c,label:l(c)})}),e.extra&&r.length&&r.push(ke({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i};function jC(e){$.call(this,null,e)}var SW=P(jC,$);function OW(){return ke({})}function TW(e){const t=Ql().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}SW.transform=function(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||OW,a=e.key||ee,o=this.value;return I(i.encode)&&(i.encode=null),o&&(e.modified("key")||t.modified(a))&&F("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=TW(a)),t.visit(t.ADD,s=>{const l=a(s);let u=o.get(l);u?u.exit?(o.empty--,i.add.push(u)):i.mod.push(u):(u=r(s),o.set(l,u),i.add.push(u)),u.datum=s,u.exit=!1}),t.visit(t.MOD,s=>{const l=a(s),u=o.get(l);u&&(u.datum=s,i.mod.push(u))}),t.visit(t.REM,s=>{const l=a(s),u=o.get(l);s===u.datum&&!u.exit&&(i.rem.push(u),u.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i};function LC(e){$.call(this,null,e)}var CW=P(LC,$);CW.transform=function(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,a=t.encode;if(I(a))if(n.changed()||a.every(function(d){return r[d]}))a=a[0],n.encode=null;else return t.StopPropagation;var o=a==="enter",s=r.update||no,l=r.enter||no,u=r.exit||no,c=(a&&!o?r[a]:s)||no;if(t.changed(t.ADD)&&(t.visit(t.ADD,function(d){l(d,e),s(d,e)}),n.modifies(l.output),n.modifies(s.output),c!==no&&c!==s&&(t.visit(t.ADD,function(d){c(d,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==no&&(t.visit(t.REM,function(d){u(d,e)}),n.modifies(u.output)),o||c!==no){var f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,function(d){var h=l(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)):t.visit(f,function(d){(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation};function PC(e){$.call(this,[],e)}var $W=P(PC,$);$W.transform=function(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.type||Nh,o=e.scale,s=+e.limit,l=bb(o,e.count==null?5:e.count,e.minstep),u=!!e.values||a===Nh,c=e.format||HT(n,o,l,a,e.formatSpecifier,e.formatType,u),f=e.values||GT(o,l),d,h,p,g,m;return r&&(i.rem=r),a===Nh?(s&&f.length>s?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,s-1),m=!0):r=f,ge(p=e.size)?(!e.values&&o(r[0])===0&&(r=r.slice(1)),g=r.reduce(function(v,y){return Math.max(v,p(y,e))},0)):p=Vt(g=p||8),r=r.map(function(v,y){return ke({index:y,label:c(v,y,r),value:v,offset:g,size:p(v,e)})}),m&&(m=f[r.length],r.push(ke({index:r.length,label:`…${f.length-r.length} entries`,value:m,offset:g,size:p(m,e)})))):a===mq?(d=o.domain(),h=jT(o,d[0],ve(d)),f.length<3&&!e.values&&d[0]!==ve(d)&&(f=[d[0],ve(d)]),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:h(v)})})):(p=f.length-1,h=Oq(o),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:y?h(v):0,perc2:y===p?1:h(f[y+1])})})),i.source=r,i.add=r,this.value=r,i};var zC=Ql({line:BC,"line-radial":MW,arc:UC,"arc-radial":jW,curve:qC,"curve-radial":LW,"orthogonal-horizontal":PW,"orthogonal-vertical":zW,"orthogonal-radial":BW,"diagonal-horizontal":UW,"diagonal-vertical":qW,"diagonal-radial":WW});function DW(e){return e.source.x}function RW(e){return e.source.y}function FW(e){return e.target.x}function NW(e){return e.target.y}function Nb(e){$.call(this,{},e)}Nb.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var IW=P(Nb,$);IW.transform=function(e,t){var n=e.sourceX||DW,i=e.sourceY||RW,r=e.targetX||FW,a=e.targetY||NW,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=zC.get(l+"-"+s)||zC.get(l);return u||F("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,function(c){c[o]=u(n(c),i(c),r(c),a(c))}),t.reflow(e.modified()).modifies(o)};function BC(e,t,n,i){return"M"+e+","+t+"L"+n+","+i}function MW(e,t,n,i){return BC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function UC(e,t,n,i){var r=n-e,a=i-t,o=Math.sqrt(r*r+a*a)/2,s=180*Math.atan2(a,r)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1 "+n+","+i}function jW(e,t,n,i){return UC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function qC(e,t,n,i){var r=n-e,a=i-t,o=.2*(r+a),s=.2*(a-r);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(i-o)+" "+n+","+i}function LW(e,t,n,i){return qC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function PW(e,t,n,i){return"M"+e+","+t+"V"+i+"H"+n}function zW(e,t,n,i){return"M"+e+","+t+"H"+n+"V"+i}function BW(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*a+"A"+t+","+t+" 0 0,"+(l?1:0)+" "+t*o+","+t*s+"L"+i*o+","+i*s}function UW(e,t,n,i){var r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i}function qW(e,t,n,i){var r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i}function WW(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+i)/2;return"M"+t*r+","+t*a+"C"+l*r+","+l*a+" "+l*o+","+l*s+" "+i*o+","+i*s}function Ib(e){$.call(this,null,e)}Ib.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};var GW=P(Ib,$);GW.transform=function(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],a=e.field||Jl,o=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,l=t.source,u=l.map(a),c=u.length,f=o,d=(s-o)/Mk(u),h=lo(c),p,g,m;for(e.sort&&h.sort(function(v,y){return u[v]-u[y]}),p=0;p<c;++p)m=u[h[p]],g=l[h[p]],g[i]=f,g[r]=f+=m*d;return this.value=u,t.reflow(e.modified()).modifies(n)};var HW=5;function YW(e){const t=e.type;return!e.bins&&(t===Vs||t===Mu||t===ju)}function WC(e){return gb(e)&&e!==Bi}var VW=kt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function GC(e){$.call(this,null,e),this.modified(!0)}var XW=P(GC,$);XW.transform=function(e,t){var n=t.dataflow,i=this.value,r=JW(e);(!i||r!==i.type)&&(this.value=i=Ee(r)());for(r in e)if(!VW[r]){if(r==="padding"&&WC(i.type))continue;ge(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return nG(i,e,tG(i,e,QW(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function JW(e){var t=e.type,n="",i;return t===Bi?Bi+"-"+Vs:(KW(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?Bi+"-":i===3?Xs+"-":""),(n+t||Vs).toLowerCase())}function KW(e){const t=e.type;return gb(t)&&t!==ko&&t!==_o&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function QW(e,t,n){var i=ZW(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,a=e.type,o=t.zero||t.zero===void 0&&YW(e),s,l;if(!r)return 0;if(WC(a)&&t.padding&&r[0]!==ve(r)&&(r=eG(a,r,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(s=(r=r.slice()).length-1||1,o&&(r[0]>0&&(r[0]=0),r[s]<0&&(r[s]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[s]=t.domainMax),t.domainMid!=null)){l=t.domainMid;const u=l>r[s]?s+1:l<r[0]?0:s;u!==s&&n.warn("Scale domainMid exceeds domain min or max.",l),r.splice(u,0,l)}return e.domain(HC(a,r,n)),a===Fy&&e.unknown(t.domainImplicit?jy:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&bb(e,t.nice)||null),r.length}function ZW(e,t,n){return t?(e.domain(HC(e.type,t,n)),t.length):-1}function eG(e,t,n,i,r,a){var o=Math.abs(ve(n)-n[0]),s=o/(o-2*i),l=e===kr?sk(t,null,s):e===ju?Jm(t,null,s,.5):e===Mu?Jm(t,null,s,r||1):e===vh?lk(t,null,s,a||1):ok(t,null,s);return t=t.slice(),t[0]=l[0],t[t.length-1]=l[1],t}function HC(e,t,n){if(RT(e)){var i=Math.abs(t.reduce(function(r,a){return r+(a<0?-1:a>0?1:0)},0));i!==t.length&&n.warn("Log scale domain includes zero: "+B(t))}return t}function tG(e,t,n){let i=t.bins;if(i&&!I(i)){let r=e.domain(),a=r[0],o=ve(r),s=i.start==null?a:i.start,l=i.stop==null?o:i.stop,u=i.step;u||F("Scale bins parameter missing step property."),s<a&&(s=u*Math.ceil(a/u)),l>o&&(l=u*Math.floor(o/u)),i=lo(s,l+u/2,u)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Iy&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function nG(e,t,n){var i=e.type,r=t.round||!1,a=t.range;if(t.rangeStep!=null)a=iG(i,t,n);else if(t.scheme&&(a=rG(i,t,n),ge(a))){if(e.interpolator)return e.interpolator(a);F(`Scale type ${i} does not support interpolating color schemes.`)}if(a&&FT(i))return e.interpolator(Fh(Mb(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(vb(t.interpolate,t.interpolateGamma)):ge(e.round)?e.round(r):ge(e.rangeRound)&&e.interpolate(r?Wu:Oo),a&&e.range(Mb(a,t.reverse))}function iG(e,t,n){e!==bO&&e!==Ny&&F("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===Ny?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Ry(n,r,i)]}function rG(e,t,n){var i=t.schemeExtent,r,a;return I(t.scheme)?a=Fh(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),a=yb(r),a||F(`Unrecognized scheme name: ${t.scheme}`)),n=e===bh?n+1:e===Iy?n-1:e===Js||e===yh?+t.schemeCount||HW:n,FT(e)?YC(a,i,t.reverse):ge(a)?MT(YC(a,i),n):e===Fy?a:a.slice(0,n)}function YC(e,t,n){return ge(e)&&(t||n)?IT(e,Mb(t||[0,1],n)):e}function Mb(e,t){return t?e.slice().reverse():e}function VC(e){$.call(this,null,e)}var aG=P(VC,$);aG.transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(oo(e.sort)),this.modified(n),t};var XC="zero",JC="center",KC="normalize",QC=["y0","y1"];function jb(e){$.call(this,null,e)}jb.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:XC,values:[XC,JC,KC]},{name:"as",type:"string",array:!0,length:2,default:QC}]};var oG=P(jb,$);oG.transform=function(e,t){var n=e.as||QC,i=n[0],r=n[1],a=oo(e.sort),o=e.field||Jl,s=e.offset===JC?sG:e.offset===KC?lG:uG,l,u,c,f;for(l=cG(t.source,e.groupby,a,o),u=0,c=l.length,f=l.max;u<c;++u)s(l[u],f,o,i,r);return t.reflow(e.modified()).modifies(n)};function sG(e,t,n,i,r){for(var a=(t-e.sum)/2,o=e.length,s=0,l;s<o;++s)l=e[s],l[i]=a,l[r]=a+=Math.abs(n(l))}function lG(e,t,n,i,r){for(var a=1/e.sum,o=0,s=e.length,l=0,u=0,c;l<s;++l)c=e[l],c[i]=o,c[r]=o=a*(u+=Math.abs(n(c)))}function uG(e,t,n,i,r){for(var a=0,o=0,s=e.length,l=0,u,c;l<s;++l)c=e[l],u=+n(c),u<0?(c[i]=o,c[r]=o+=u):(c[i]=a,c[r]=a+=u)}function cG(e,t,n,i){var r=[],a=function(g){return g(c)},o,s,l,u,c,f,d,h,p;if(t==null)r.push(e.slice());else for(o={},s=0,l=e.length;s<l;++s)c=e[s],f=t.map(a),d=o[f],d||(o[f]=d=[],r.push(d)),d.push(c);for(f=0,p=0,u=r.length;f<u;++f){for(d=r[f],s=0,h=0,l=d.length;s<l;++s)h+=Math.abs(i(d[s]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return r.max=p,r}var fG=Object.freeze({__proto__:null,axisticks:MC,datajoin:jC,encode:LC,legendentries:PC,linkpath:Nb,pie:Ib,scale:GC,sortitems:VC,stack:jb});function dG(){}const Or=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ZC(){var e=1,t=1,n=s;function i(l,u){return u.map(c=>r(l,c))}function r(l,u){var c=[],f=[];return a(l,u,function(d){n(d,l,u),hG(d)>0?c.push([d]):f.push(d)}),f.forEach(function(d){for(var h=0,p=c.length,g;h<p;++h)if(pG((g=c[h])[0],d)!==-1){g.push(d);return}}),{type:"MultiPolygon",value:u,coordinates:c}}function a(l,u,c){var f=new Array(),d=new Array(),h,p,g,m,v,y;for(h=p=-1,m=l[0]>=u,Or[m<<1].forEach(b);++h<e-1;)g=m,m=l[h+1]>=u,Or[g|m<<1].forEach(b);for(Or[m<<0].forEach(b);++p<t-1;){for(h=-1,m=l[p*e+e]>=u,v=l[p*e]>=u,Or[m<<1|v<<2].forEach(b);++h<e-1;)g=m,m=l[p*e+e+h+1]>=u,y=v,v=l[p*e+h+1]>=u,Or[g|m<<1|v<<2|y<<3].forEach(b);Or[m|v<<3].forEach(b)}for(h=-1,v=l[p*e]>=u,Or[v<<2].forEach(b);++h<e-1;)y=v,v=l[p*e+h+1]>=u,Or[v<<2|y<<3].forEach(b);Or[v<<3].forEach(b);function b(E){var x=[E[0][0]+h,E[0][1]+p],k=[E[1][0]+h,E[1][1]+p],w=o(x),A=o(k),_,O;(_=d[w])?(O=f[A])?(delete d[_.end],delete f[O.start],_===O?(_.ring.push(k),c(_.ring)):f[_.start]=d[O.end]={start:_.start,end:O.end,ring:_.ring.concat(O.ring)}):(delete d[_.end],_.ring.push(k),d[_.end=A]=_):(_=f[A])?(O=d[w])?(delete f[_.start],delete d[O.end],_===O?(_.ring.push(k),c(_.ring)):f[O.start]=d[_.end]={start:O.start,end:_.end,ring:O.ring.concat(_.ring)}):(delete f[_.start],_.ring.unshift(x),f[_.start=w]=_):f[w]=d[A]={start:w,end:A,ring:[x,k]}}}function o(l){return l[0]*2+l[1]*(e+1)*4}function s(l,u,c){l.forEach(function(f){var d=f[0],h=f[1],p=d|0,g=h|0,m,v=u[g*e+p];d>0&&d<e&&p===d&&(m=u[g*e+p-1],f[0]=d+(c-m)/(v-m)-.5),h>0&&h<t&&g===h&&(m=u[(g-1)*e+p],f[1]=h+(c-m)/(v-m)-.5)})}return i.contour=r,i.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),c=Math.floor(l[1]);return u>=0&&c>=0||F("invalid size"),e=u,t=c,i},i.smooth=function(l){return arguments.length?(n=l?s:dG,i):n===s},i}function hG(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function pG(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=gG(e,t[n]))return r;return 0}function gG(e,t){for(var n=t[0],i=t[1],r=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(mG(l,f,t))return 0;c>i!==h>i&&n<(d-u)*(i-c)/(h-c)+u&&(r=-r)}return r}function mG(e,t,n){var i;return vG(e,t,n)&&yG(e[i=+(e[0]===t[0])],n[i],t[i])}function vG(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function yG(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function e$(e,t,n){return function(i){var r=vr(i),a=n?Math.min(r[0],0):r[0],o=r[1],s=o-a,l=t?ea(a,o,e):s/(e+1);return lo(l,o,l)}}function Lb(e){$.call(this,null,e)}Lb.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};var bG=P(Lb,$);bG.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||Yt,a=ZC().smooth(e.smooth!==!1),o=e.thresholds||wG(i,r,e),s=e.as===null?null:e.as||"contour",l=[];return i.forEach(u=>{const c=r(u),f=a.size([c.width,c.height])(c.values,I(o)?o:o(c.values));xG(f,c,u,e),f.forEach(d=>{l.push(Qm(u,ke(s!=null?{[s]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function wG(e,t,n){const i=e$(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>uo(t(r).values)))}function xG(e,t,n,i){let r=i.scale||t.scale,a=i.translate||t.translate;if(ge(r)&&(r=r(n,i)),ge(a)&&(a=a(n,i)),(r===1||r==null)&&!a)return;const o=(Re(r)?r:r[0])||1,s=(Re(r)?r:r[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(t$(t,o,s,l,u))}function t$(e,t,n,i,r){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(f){f.forEach(u)}function u(f){s&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-a)*t+i,f[1]=(f[1]-o)*n+r}return function(f){return f.coordinates.forEach(l),f}}function n$(e,t,n){const i=e>=0?e:Y0(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Pb(e){return ge(e)?e:Vt(+e)}function i$(){var e=l=>l[0],t=l=>l[1],n=Jl,i=[-1,-1],r=960,a=500,o=2;function s(l,u){const c=n$(i[0],l,e)>>o,f=n$(i[1],l,t)>>o,d=c?c+2:0,h=f?f+2:0,p=2*d+(r>>o),g=2*h+(a>>o),m=new Float32Array(p*g),v=new Float32Array(p*g);let y=m;l.forEach(E=>{const x=d+(+e(E)>>o),k=h+(+t(E)>>o);x>=0&&x<p&&k>=0&&k<g&&(m[x+k*p]+=+n(E))}),c>0&&f>0?(al(p,g,m,v,c),ol(p,g,v,m,f),al(p,g,m,v,c),ol(p,g,v,m,f),al(p,g,m,v,c),ol(p,g,v,m,f)):c>0?(al(p,g,m,v,c),al(p,g,v,m,c),al(p,g,m,v,c),y=v):f>0&&(ol(p,g,m,v,f),ol(p,g,v,m,f),ol(p,g,m,v,f),y=v);let b=u?Math.pow(2,-2*o):1/Mk(y);for(let E=0,x=p*g;E<x;++E)y[E]*=b;return{values:y,scale:1<<o,width:p,height:g,x1:d,y1:h,x2:d+(r>>o),y2:h+(a>>o)}}return s.x=function(l){return arguments.length?(e=Pb(l),s):e},s.y=function(l){return arguments.length?(t=Pb(l),s):t},s.weight=function(l){return arguments.length?(n=Pb(l),s):n},s.size=function(l){if(!arguments.length)return[r,a];var u=+l[0],c=+l[1];return u>=0&&c>=0||F("invalid size"),r=u,a=c,s},s.cellSize=function(l){return arguments.length?((l=+l)>=1||F("invalid cell size"),o=Math.floor(Math.log(l)/Math.LN2),s):1<<o},s.bandwidth=function(l){return arguments.length?(l=G(l),l.length===1&&(l=[+l[0],+l[0]]),l.length!==2&&F("invalid bandwidth"),i=l,s):i},s}function al(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<t;++o)for(let s=0,l=0;s<e+r;++s)s<e&&(l+=n[s+o*e]),s>=r&&(s>=a&&(l-=n[s-a+o*e]),i[s-r+o*e]=l/Math.min(s+1,e-1+a-s,a))}function ol(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<e;++o)for(let s=0,l=0;s<t+r;++s)s<t&&(l+=n[o+s*e]),s>=r&&(s>=a&&(l-=n[o+(s-a)*e]),i[o+(s-r)*e]=l/Math.min(s+1,t-1+a-s,a))}function zb(e){$.call(this,null,e)}zb.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var EG=P(zb,$);const kG=["x","y","weight","size","cellSize","bandwidth"];function r$(e,t){return kG.forEach(n=>t[n]!=null?e[n](t[n]):0),e}EG.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=_G(i,e.groupby),a=(e.groupby||[]).map(et),o=r$(i$(),e),s=e.as||"grid",l=[];function u(c,f){for(let d=0;d<a.length;++d)c[a[d]]=f[d];return c}return l=r.map(c=>ke(u({[s]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function _G(e,t){var n=[],i=c=>c(s),r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function Bb(e){$.call(this,null,e)}Bb.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};var AG=P(Bb,$);AG.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=ZC().smooth(e.smooth!==!1),r=e.values,a=e.thresholds||e$(e.count||10,e.nice,!!r),o=e.size,s,l;return r||(r=t.materialize(t.SOURCE).source,s=r$(i$(),e)(r,!0),l=t$(s,s.scale||1,s.scale||1,0,0),o=[s.width,s.height],r=s.values),a=I(a)?a:a(r),r=i.size(o)(r,a),l&&r.forEach(l),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(ke),n};var Ub="Feature",qb="FeatureCollection",SG="MultiPoint";function Wb(e){$.call(this,null,e)}Wb.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};var OG=P(Wb,$);OG.transform=function(e,t){var n=this._features,i=this._points,r=e.fields,a=r&&r[0],o=r&&r[1],s=e.geojson||!r&&Yt,l=t.ADD,u;u=e.modified()||t.changed(t.REM)||t.modified(Ht(s))||a&&t.modified(Ht(a))||o&&t.modified(Ht(o)),(!this.value||u)&&(l=t.SOURCE,this._features=n=[],this._points=i=[]),s&&t.visit(l,function(c){n.push(s(c))}),a&&o&&(t.visit(l,function(c){var f=a(c),d=o(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:Ub,geometry:{type:SG,coordinates:i}})),this.value={type:qb,features:n}};function $o(){return new Bh()}function Bh(){this.reset()}Bh.prototype={constructor:Bh,reset:function(){this.s=this.t=0},add:function(e){a$(Uh,e,this.t),a$(this,Uh.s,this.s),this.s?this.t+=Uh.t:this.s=Uh.t},valueOf:function(){return this.s}};var Uh=new Bh();function a$(e,t,n){var i=e.s=t+n,r=i-t,a=i-r;e.t=t-a+(n-r)}var ie=1e-6,Gb=1e-12,de=Math.PI,Ve=de/2,qh=de/4,Jt=de*2,tt=180/de,he=de/180,ye=Math.abs,sl=Math.atan,Jn=Math.atan2,re=Math.cos,Wh=Math.ceil,o$=Math.exp,Gh=Math.log,Hb=Math.pow,te=Math.sin,Kn=Math.sign||function(e){return e>0?1:e<0?-1:0},Tt=Math.sqrt,Yb=Math.tan;function s$(e){return e>1?0:e<-1?de:Math.acos(e)}function bn(e){return e>1?Ve:e<-1?-Ve:Math.asin(e)}function Ct(){}function Hh(e,t){e&&u$.hasOwnProperty(e.type)&&u$[e.type](e,t)}var l$={Feature:function(e,t){Hh(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Hh(n[i].geometry,t)}},u$={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Vb(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Vb(n[i],t,0)},Polygon:function(e,t){c$(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)c$(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Hh(n[i],t)}};function Vb(e,t,n){var i=-1,r=e.length-n,a;for(t.lineStart();++i<r;)a=e[i],t.point(a[0],a[1],a[2]);t.lineEnd()}function c$(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Vb(e[n],t,1);t.polygonEnd()}function Tr(e,t){e&&l$.hasOwnProperty(e.type)?l$[e.type](e,t):Hh(e,t)}var Yh=$o(),Vh=$o(),f$,d$,Xb,Jb,Kb,Hi={point:Ct,lineStart:Ct,lineEnd:Ct,polygonStart:function(){Yh.reset(),Hi.lineStart=TG,Hi.lineEnd=CG},polygonEnd:function(){var e=+Yh;Vh.add(e<0?Jt+e:e),this.lineStart=this.lineEnd=this.point=Ct},sphere:function(){Vh.add(Jt)}};function TG(){Hi.point=$G}function CG(){h$(f$,d$)}function $G(e,t){Hi.point=h$,f$=e,d$=t,e*=he,t*=he,Xb=e,Jb=re(t=t/2+qh),Kb=te(t)}function h$(e,t){e*=he,t*=he,t=t/2+qh;var n=e-Xb,i=n>=0?1:-1,r=i*n,a=re(t),o=te(t),s=Kb*o,l=Jb*a+s*re(r),u=s*i*te(r);Yh.add(Jn(u,l)),Xb=e,Jb=a,Kb=o}function DG(e){return Vh.reset(),Tr(e,Hi),Vh*2}function Xh(e){return[Jn(e[1],e[0]),bn(e[2])]}function Do(e){var t=e[0],n=e[1],i=re(n);return[i*re(t),i*te(t),te(n)]}function Jh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ll(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Qb(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Kh(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Qh(e){var t=Tt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ge,wn,Xe,jn,Ro,p$,g$,ul,ec=$o(),xa,Cr,$r={point:Zb,lineStart:v$,lineEnd:y$,polygonStart:function(){$r.point=b$,$r.lineStart=RG,$r.lineEnd=FG,ec.reset(),Hi.polygonStart()},polygonEnd:function(){Hi.polygonEnd(),$r.point=Zb,$r.lineStart=v$,$r.lineEnd=y$,Yh<0?(Ge=-(Xe=180),wn=-(jn=90)):ec>ie?jn=90:ec<-ie&&(wn=-90),Cr[0]=Ge,Cr[1]=Xe},sphere:function(){Ge=-(Xe=180),wn=-(jn=90)}};function Zb(e,t){xa.push(Cr=[Ge=e,Xe=e]),t<wn&&(wn=t),t>jn&&(jn=t)}function m$(e,t){var n=Do([e*he,t*he]);if(ul){var i=ll(ul,n),r=[i[1],-i[0],0],a=ll(r,i);Qh(a),a=Xh(a);var o=e-Ro,s=o>0?1:-1,l=a[0]*tt*s,u,c=ye(o)>180;c^(s*Ro<l&&l<s*e)?(u=a[1]*tt,u>jn&&(jn=u)):(l=(l+360)%360-180,c^(s*Ro<l&&l<s*e))?(u=-a[1]*tt,u<wn&&(wn=u)):(t<wn&&(wn=t),t>jn&&(jn=t)),c?e<Ro?Ln(Ge,e)>Ln(Ge,Xe)&&(Xe=e):Ln(e,Xe)>Ln(Ge,Xe)&&(Ge=e):Xe>=Ge?(e<Ge&&(Ge=e),e>Xe&&(Xe=e)):e>Ro?Ln(Ge,e)>Ln(Ge,Xe)&&(Xe=e):Ln(e,Xe)>Ln(Ge,Xe)&&(Ge=e)}else xa.push(Cr=[Ge=e,Xe=e]);t<wn&&(wn=t),t>jn&&(jn=t),ul=n,Ro=e}function v$(){$r.point=m$}function y$(){Cr[0]=Ge,Cr[1]=Xe,$r.point=Zb,ul=null}function b$(e,t){if(ul){var n=e-Ro;ec.add(ye(n)>180?n+(n>0?360:-360):n)}else p$=e,g$=t;Hi.point(e,t),m$(e,t)}function RG(){Hi.lineStart()}function FG(){b$(p$,g$),Hi.lineEnd(),ye(ec)>ie&&(Ge=-(Xe=180)),Cr[0]=Ge,Cr[1]=Xe,ul=null}function Ln(e,t){return(t-=e)<0?t+360:t}function NG(e,t){return e[0]-t[0]}function w$(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function IG(e){var t,n,i,r,a,o,s;if(jn=Xe=-(Ge=wn=Infinity),xa=[],Tr(e,$r),n=xa.length){for(xa.sort(NG),t=1,i=xa[0],a=[i];t<n;++t)r=xa[t],w$(i,r[0])||w$(i,r[1])?(Ln(i[0],r[1])>Ln(i[0],i[1])&&(i[1]=r[1]),Ln(r[0],i[1])>Ln(i[0],i[1])&&(i[0]=r[0])):a.push(i=r);for(o=-Infinity,n=a.length-1,t=0,i=a[n];t<=n;i=r,++t)r=a[t],(s=Ln(i[1],r[0]))>o&&(o=s,Ge=r[0],Xe=i[1])}return xa=Cr=null,Ge===Infinity||wn===Infinity?[[NaN,NaN],[NaN,NaN]]:[[Ge,wn],[Xe,jn]]}var tc,Zh,ep,tp,np,ip,rp,ap,e1,t1,n1,x$,E$,Kt,Qt,Zt,bi={sphere:Ct,point:i1,lineStart:k$,lineEnd:_$,polygonStart:function(){bi.lineStart=LG,bi.lineEnd=PG},polygonEnd:function(){bi.lineStart=k$,bi.lineEnd=_$}};function i1(e,t){e*=he,t*=he;var n=re(t);nc(n*re(e),n*te(e),te(t))}function nc(e,t,n){++tc,ep+=(e-ep)/tc,tp+=(t-tp)/tc,np+=(n-np)/tc}function k$(){bi.point=MG}function MG(e,t){e*=he,t*=he;var n=re(t);Kt=n*re(e),Qt=n*te(e),Zt=te(t),bi.point=jG,nc(Kt,Qt,Zt)}function jG(e,t){e*=he,t*=he;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Jn(Tt((o=Qt*a-Zt*r)*o+(o=Zt*i-Kt*a)*o+(o=Kt*r-Qt*i)*o),Kt*i+Qt*r+Zt*a);Zh+=o,ip+=o*(Kt+(Kt=i)),rp+=o*(Qt+(Qt=r)),ap+=o*(Zt+(Zt=a)),nc(Kt,Qt,Zt)}function _$(){bi.point=i1}function LG(){bi.point=zG}function PG(){A$(x$,E$),bi.point=i1}function zG(e,t){x$=e,E$=t,e*=he,t*=he,bi.point=A$;var n=re(t);Kt=n*re(e),Qt=n*te(e),Zt=te(t),nc(Kt,Qt,Zt)}function A$(e,t){e*=he,t*=he;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Qt*a-Zt*r,s=Zt*i-Kt*a,l=Kt*r-Qt*i,u=Tt(o*o+s*s+l*l),c=bn(u),f=u&&-c/u;e1+=f*o,t1+=f*s,n1+=f*l,Zh+=c,ip+=c*(Kt+(Kt=i)),rp+=c*(Qt+(Qt=r)),ap+=c*(Zt+(Zt=a)),nc(Kt,Qt,Zt)}function BG(e){tc=Zh=ep=tp=np=ip=rp=ap=e1=t1=n1=0,Tr(e,bi);var t=e1,n=t1,i=n1,r=t*t+n*n+i*i;return r<Gb&&(t=ip,n=rp,i=ap,Zh<ie&&(t=ep,n=tp,i=np),r=t*t+n*n+i*i,r<Gb)?[NaN,NaN]:[Jn(n,t)*tt,bn(i/Tt(r))*tt]}function r1(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function a1(e,t){return[ye(e)>de?e+Math.round(-e/Jt)*Jt:e,t]}a1.invert=a1;function S$(e,t,n){return(e%=Jt)?t||n?r1(T$(e),C$(t,n)):T$(e):t||n?C$(t,n):a1}function O$(e){return function(t,n){return t+=e,[t>de?t-Jt:t<-de?t+Jt:t,n]}}function T$(e){var t=O$(e);return t.invert=O$(-e),t}function C$(e,t){var n=re(e),i=te(e),r=re(t),a=te(t);function o(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*n+c*i;return[Jn(f*r-h*a,c*n-d*i),bn(h*r+f*a)]}return o.invert=function(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*r-f*a;return[Jn(f*r+d*a,c*n+h*i),bn(h*n-c*i)]},o}function UG(e){e=S$(e[0]*he,e[1]*he,e.length>2?e[2]*he:0);function t(n){return n=e(n[0]*he,n[1]*he),n[0]*=tt,n[1]*=tt,n}return t.invert=function(n){return n=e.invert(n[0]*he,n[1]*he),n[0]*=tt,n[1]*=tt,n},t}function qG(e,t,n,i,r,a){if(!n)return;var o=re(t),s=te(t),l=i*n;r==null?(r=t+i*Jt,a=t-l/2):(r=$$(o,r),a=$$(o,a),(i>0?r<a:r>a)&&(r+=i*Jt));for(var u,c=r;i>0?c>a:c<a;c-=l)u=Xh([o,-s*re(c),-s*te(c)]),e.point(u[0],u[1])}function $$(e,t){t=Do(t),t[0]-=e,Qh(t);var n=s$(-t[1]);return((-t[2]<0?-n:n)+Jt-ie)%Jt}function D$(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Ct,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function op(e,t){return ye(e[0]-t[0])<ie&&ye(e[1]-t[1])<ie}function sp(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function R$(e,t,n,i,r){var a=[],o=[],s,l;if(e.forEach(function(p){if((g=p.length-1)<=0)return;var g,m=p[0],v=p[g],y;if(op(m,v)){if(!m[2]&&!v[2]){for(r.lineStart(),s=0;s<g;++s)r.point((m=p[s])[0],m[1]);r.lineEnd();return}v[0]+=2*ie}a.push(y=new sp(m,p,null,!0)),o.push(y.o=new sp(m,null,y,!1)),a.push(y=new sp(v,p,null,!1)),o.push(y.o=new sp(v,null,y,!0))}),!a.length)return;for(o.sort(t),F$(a),F$(o),s=0,l=o.length;s<l;++s)o[s].e=n=!n;for(var u=a[0],c,f;;){for(var d=u,h=!0;d.v;)if((d=d.n)===u)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,l=c.length;s<l;++s)r.point((f=c[s])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)r.point((f=c[s])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}function F$(e){if(!(t=e.length))return;for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}var o1=$o();function s1(e){return ye(e[0])<=de?e[0]:Kn(e[0])*((ye(e[0])+de)%Jt-de)}function WG(e,t){var n=s1(t),i=t[1],r=te(i),a=[te(n),-re(n),0],o=0,s=0;o1.reset(),r===1?i=Ve+ie:r===-1&&(i=-Ve-ie);for(var l=0,u=e.length;l<u;++l){if(!(f=(c=e[l]).length))continue;for(var c,f,d=c[f-1],h=s1(d),p=d[1]/2+qh,g=te(p),m=re(p),v=0;v<f;++v,h=b,g=x,m=k,d=y){var y=c[v],b=s1(y),E=y[1]/2+qh,x=te(E),k=re(E),w=b-h,A=w>=0?1:-1,_=A*w,O=_>de,S=g*x;if(o1.add(Jn(S*A*te(_),m*k+S*re(_))),o+=O?w+A*Jt:w,O^h>=n^b>=n){var T=ll(Do(d),Do(y));Qh(T);var D=ll(a,T);Qh(D);var M=(O^w>=0?-1:1)*bn(D[2]);(i>M||i===M&&(T[0]||T[1]))&&(s+=O^w>=0?1:-1)}}}return(o<-ie||o<ie&&o1<-ie)^s&1}function N$(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function GG(e){return e.length===1&&(e=HG(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function HG(e){return function(t,n){return N$(e(t),n)}}var Ide=GG(N$);function cl(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}function I$(e){for(var t=e.length,n,i=-1,r=0,a,o;++i<t;)r+=e[i].length;for(a=new Array(r);--t>=0;)for(o=e[t],n=o.length;--n>=0;)a[--r]=o[n];return a}function M$(e,t,n,i){return function(r){var a=t(r),o=D$(),s=t(o),l=!1,u,c,f,d={point:h,lineStart:g,lineEnd:m,polygonStart:function(){d.point=v,d.lineStart=y,d.lineEnd=b,c=[],u=[]},polygonEnd:function(){d.point=h,d.lineStart=g,d.lineEnd=m,c=I$(c);var E=WG(u,i);c.length?(l||(r.polygonStart(),l=!0),R$(c,VG,E,n,r)):E&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),c=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(E,x){e(E,x)&&r.point(E,x)}function p(E,x){a.point(E,x)}function g(){d.point=p,a.lineStart()}function m(){d.point=h,a.lineEnd()}function v(E,x){f.push([E,x]),s.point(E,x)}function y(){s.lineStart(),f=[]}function b(){v(f[0][0],f[0][1]),s.lineEnd();var E=s.clean(),x=o.result(),k,w=x.length,A,_,O;if(f.pop(),u.push(f),f=null,!w)return;if(E&1){if(_=x[0],(A=_.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),k=0;k<A;++k)r.point((O=_[k])[0],O[1]);r.lineEnd()}return}w>1&&E&2&&x.push(x.pop().concat(x.shift())),c.push(x.filter(YG))}return d}}function YG(e){return e.length>1}function VG(e,t){return((e=e.x)[0]<0?e[1]-Ve-ie:Ve-e[1])-((t=t.x)[0]<0?t[1]-Ve-ie:Ve-t[1])}var j$=M$(function(){return!0},XG,KG,[-de,-Ve]);function XG(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(a,o){var s=a>0?de:-de,l=ye(a-t);ye(l-de)<ie?(e.point(t,n=(n+o)/2>0?Ve:-Ve),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),r=0):i!==s&&l>=de&&(ye(t-i)<ie&&(t-=i*ie),ye(a-s)<ie&&(a-=s*ie),n=JG(t,n,a,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),r=0),e.point(t=a,n=o),i=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function JG(e,t,n,i){var r,a,o=te(e-n);return ye(o)>ie?sl((te(t)*(a=re(i))*te(n)-te(i)*(r=re(t))*te(e))/(r*a*o)):(t+i)/2}function KG(e,t,n,i){var r;if(e==null)r=n*Ve,i.point(-de,r),i.point(0,r),i.point(de,r),i.point(de,0),i.point(de,-r),i.point(0,-r),i.point(-de,-r),i.point(-de,0),i.point(-de,r);else if(ye(e[0]-t[0])>ie){var a=e[0]<t[0]?de:-de;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function QG(e){var t=re(e),n=6*he,i=t>0,r=ye(t)>ie;function a(c,f,d,h){qG(h,e,n,d,c,f)}function o(c,f){return re(c)*re(f)>t}function s(c){var f,d,h,p,g;return{lineStart:function(){p=h=!1,g=1},point:function(m,v){var y=[m,v],b,E=o(m,v),x=i?E?0:u(m,v):E?u(m+(m<0?de:-de),v):0;if(!f&&(p=h=E)&&c.lineStart(),E!==h&&(b=l(f,y),(!b||op(f,b)||op(y,b))&&(y[2]=1)),E!==h)g=0,E?(c.lineStart(),b=l(y,f),c.point(b[0],b[1])):(b=l(f,y),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(r&&f&&i^E){var k;!(x&d)&&(k=l(y,f,!0))&&(g=0,i?(c.lineStart(),c.point(k[0][0],k[0][1]),c.point(k[1][0],k[1][1]),c.lineEnd()):(c.point(k[1][0],k[1][1]),c.lineEnd(),c.lineStart(),c.point(k[0][0],k[0][1],3)))}E&&(!f||!op(f,y))&&c.point(y[0],y[1]),f=y,h=E,d=x},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return g|(p&&h)<<1}}}function l(c,f,d){var h=Do(c),p=Do(f),g=[1,0,0],m=ll(h,p),v=Jh(m,m),y=m[0],b=v-y*y;if(!b)return!d&&c;var E=t*v/b,x=-t*y/b,k=ll(g,m),w=Kh(g,E),A=Kh(m,x);Qb(w,A);var _=k,O=Jh(w,_),S=Jh(_,_),T=O*O-S*(Jh(w,w)-1);if(T<0)return;var D=Tt(T),M=Kh(_,(-O-D)/S);if(Qb(M,w),M=Xh(M),!d)return M;var C=c[0],N=f[0],W=c[1],X=f[1],J;N<C&&(J=C,C=N,N=J);var xe=N-C,Pe=ye(xe-de)<ie,dt=Pe||xe<ie;if(!Pe&&X<W&&(J=W,W=X,X=J),dt?Pe?W+X>0^M[1]<(ye(M[0]-C)<ie?W:X):W<=M[1]&&M[1]<=X:xe>de^(C<=M[0]&&M[0]<=N)){var ht=Kh(_,(-O+D)/S);return Qb(ht,w),[M,Xh(ht)]}}function u(c,f){var d=i?e:de-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return M$(o,s,a,i?[0,-e]:[-de,e-de])}function ZG(e,t,n,i,r,a){var o=e[0],s=e[1],l=t[0],u=t[1],c=0,f=1,d=l-o,h=u-s,p;if(p=n-o,!d&&p>0)return;if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=r-o,!d&&p<0)return;if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}if(p=i-s,!h&&p>0)return;if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=a-s,!h&&p<0)return;if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*d,e[1]=s+c*h),f<1&&(t[0]=o+f*d,t[1]=s+f*h),!0}var ic=1e9,lp=-ic;function L$(e,t,n,i){function r(u,c){return e<=u&&u<=n&&t<=c&&c<=i}function a(u,c,f,d){var h=0,p=0;if(u==null||(h=o(u,f))!==(p=o(c,f))||l(u,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==p);else d.point(c[0],c[1])}function o(u,c){return ye(u[0]-e)<ie?c>0?0:3:ye(u[0]-n)<ie?c>0?2:1:ye(u[1]-t)<ie?c>0?1:0:c>0?3:2}function s(u,c){return l(u.x,c.x)}function l(u,c){var f=o(u,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-u[1]:f===1?u[0]-c[0]:f===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,f=D$(),d,h,p,g,m,v,y,b,E,x,k,w={point:A,lineStart:T,lineEnd:D,polygonStart:O,polygonEnd:S};function A(C,N){r(C,N)&&c.point(C,N)}function _(){for(var C=0,N=0,W=h.length;N<W;++N)for(var X=h[N],J=1,xe=X.length,Pe=X[0],dt,ht,Ke=Pe[0],Rt=Pe[1];J<xe;++J)dt=Ke,ht=Rt,Pe=X[J],Ke=Pe[0],Rt=Pe[1],ht<=i?Rt>i&&(Ke-dt)*(i-ht)>(Rt-ht)*(e-dt)&&++C:Rt<=i&&(Ke-dt)*(i-ht)<(Rt-ht)*(e-dt)&&--C;return C}function O(){c=f,d=[],h=[],k=!0}function S(){var C=_(),N=k&&C,W=(d=I$(d)).length;(N||W)&&(u.polygonStart(),N&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),W&&R$(d,s,C,a,u),u.polygonEnd()),c=u,d=h=p=null}function T(){w.point=M,h&&h.push(p=[]),x=!0,E=!1,y=b=NaN}function D(){d&&(M(g,m),v&&E&&f.rejoin(),d.push(f.result())),w.point=A,E&&c.lineEnd()}function M(C,N){var W=r(C,N);if(h&&p.push([C,N]),x)g=C,m=N,v=W,x=!1,W&&(c.lineStart(),c.point(C,N));else if(W&&E)c.point(C,N);else{var X=[y=Math.max(lp,Math.min(ic,y)),b=Math.max(lp,Math.min(ic,b))],J=[C=Math.max(lp,Math.min(ic,C)),N=Math.max(lp,Math.min(ic,N))];ZG(X,J,e,t,n,i)?(E||(c.lineStart(),c.point(X[0],X[1])),c.point(J[0],J[1]),W||c.lineEnd(),k=!1):W&&(c.lineStart(),c.point(C,N),k=!1)}y=C,b=N,E=W}return w}}function P$(e,t,n){var i=cl(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[r,a]})}}function z$(e,t,n){var i=cl(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[a,r]})}}function eH(){var e,t,n,i,r,a,o,s,l=10,u=l,c=90,f=360,d,h,p,g,m=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return cl(Wh(i/c)*c,n,c).map(p).concat(cl(Wh(s/f)*f,o,f).map(g)).concat(cl(Wh(t/l)*l,e,l).filter(function(b){return ye(b%c)>ie}).map(d)).concat(cl(Wh(a/u)*u,r,u).filter(function(b){return ye(b%f)>ie}).map(h))}return v.lines=function(){return y().map(function(b){return{type:"LineString",coordinates:b}})},v.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(g(o).slice(1),p(n).reverse().slice(1),g(s).reverse().slice(1))]}},v.extent=function(b){return arguments.length?v.extentMajor(b).extentMinor(b):v.extentMinor()},v.extentMajor=function(b){return arguments.length?(i=+b[0][0],n=+b[1][0],s=+b[0][1],o=+b[1][1],i>n&&(b=i,i=n,n=b),s>o&&(b=s,s=o,o=b),v.precision(m)):[[i,s],[n,o]]},v.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],a=+b[0][1],r=+b[1][1],t>e&&(b=t,t=e,e=b),a>r&&(b=a,a=r,r=b),v.precision(m)):[[t,a],[e,r]]},v.step=function(b){return arguments.length?v.stepMajor(b).stepMinor(b):v.stepMinor()},v.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],v):[c,f]},v.stepMinor=function(b){return arguments.length?(l=+b[0],u=+b[1],v):[l,u]},v.precision=function(b){return arguments.length?(m=+b,d=P$(a,r,90),h=z$(t,e,m),p=P$(s,o,90),g=z$(i,n,m),v):m},v.extentMajor([[-180,-90+ie],[180,90-ie]]).extentMinor([[-180,-80-ie],[180,80+ie]])}function rc(e){return e}var l1=$o(),u1=$o(),B$,U$,c1,f1,Dr={point:Ct,lineStart:Ct,lineEnd:Ct,polygonStart:function(){Dr.lineStart=tH,Dr.lineEnd=iH},polygonEnd:function(){Dr.lineStart=Dr.lineEnd=Dr.point=Ct,l1.add(ye(u1)),u1.reset()},result:function(){var e=l1/2;return l1.reset(),e}};function tH(){Dr.point=nH}function nH(e,t){Dr.point=q$,B$=c1=e,U$=f1=t}function q$(e,t){u1.add(f1*e-c1*t),c1=e,f1=t}function iH(){q$(B$,U$)}var fl=Infinity,up=fl,ac=-fl,cp=ac,fp={point:rH,lineStart:Ct,lineEnd:Ct,polygonStart:Ct,polygonEnd:Ct,result:function(){var e=[[fl,up],[ac,cp]];return ac=cp=-(up=fl=Infinity),e}};function rH(e,t){e<fl&&(fl=e),e>ac&&(ac=e),t<up&&(up=t),t>cp&&(cp=t)}var d1=0,h1=0,oc=0,dp=0,hp=0,dl=0,p1=0,g1=0,sc=0,W$,G$,Yi,Vi,Qn={point:Fo,lineStart:H$,lineEnd:Y$,polygonStart:function(){Qn.lineStart=sH,Qn.lineEnd=lH},polygonEnd:function(){Qn.point=Fo,Qn.lineStart=H$,Qn.lineEnd=Y$},result:function(){var e=sc?[p1/sc,g1/sc]:dl?[dp/dl,hp/dl]:oc?[d1/oc,h1/oc]:[NaN,NaN];return d1=h1=oc=dp=hp=dl=p1=g1=sc=0,e}};function Fo(e,t){d1+=e,h1+=t,++oc}function H$(){Qn.point=aH}function aH(e,t){Qn.point=oH,Fo(Yi=e,Vi=t)}function oH(e,t){var n=e-Yi,i=t-Vi,r=Tt(n*n+i*i);dp+=r*(Yi+e)/2,hp+=r*(Vi+t)/2,dl+=r,Fo(Yi=e,Vi=t)}function Y$(){Qn.point=Fo}function sH(){Qn.point=uH}function lH(){V$(W$,G$)}function uH(e,t){Qn.point=V$,Fo(W$=Yi=e,G$=Vi=t)}function V$(e,t){var n=e-Yi,i=t-Vi,r=Tt(n*n+i*i);dp+=r*(Yi+e)/2,hp+=r*(Vi+t)/2,dl+=r,r=Vi*e-Yi*t,p1+=r*(Yi+e),g1+=r*(Vi+t),sc+=r*3,Fo(Yi=e,Vi=t)}function X$(e){this._context=e}X$.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Jt);break}}},result:Ct};var m1=$o(),v1,J$,K$,lc,uc,cc={point:Ct,lineStart:function(){cc.point=cH},lineEnd:function(){v1&&Q$(J$,K$),cc.point=Ct},polygonStart:function(){v1=!0},polygonEnd:function(){v1=null},result:function(){var e=+m1;return m1.reset(),e}};function cH(e,t){cc.point=Q$,J$=lc=e,K$=uc=t}function Q$(e,t){lc-=e,uc-=t,m1.add(Tt(lc*lc+uc*uc)),lc=e,uc=t}function Z$(){this._string=[]}Z$.prototype={_radius:4.5,_circle:eD(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=eD(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function eD(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function tD(e,t){var n=4.5,i,r;function a(o){return o&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Tr(o,i(r))),r.result()}return a.area=function(o){return Tr(o,i(Dr)),Dr.result()},a.measure=function(o){return Tr(o,i(cc)),cc.result()},a.bounds=function(o){return Tr(o,i(fp)),fp.result()},a.centroid=function(o){return Tr(o,i(Qn)),Qn.result()},a.projection=function(o){return arguments.length?(i=o==null?(e=null,rc):(e=o).stream,a):e},a.context=function(o){return arguments.length?(r=o==null?(t=null,new Z$()):new X$(t=o),typeof n!="function"&&r.pointRadius(n),a):t},a.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(r.pointRadius(+o),+o),a):n},a.projection(e).context(t)}function pp(e){return function(t){var n=new y1();for(var i in e)n[i]=e[i];return n.stream=t,n}}function y1(){}y1.prototype={constructor:y1,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function b1(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Tr(n,e.stream(fp)),t(fp.result()),i!=null&&e.clipExtent(i),e}function gp(e,t,n){return b1(e,function(i){var r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),a/(i[1][1]-i[0][1])),s=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(a-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([s,l])},n)}function w1(e,t,n){return gp(e,[[0,0],t],n)}function x1(e,t,n){return b1(e,function(i){var r=+t,a=r/(i[1][0]-i[0][0]),o=(r-a*(i[1][0]+i[0][0]))/2,s=-a*i[0][1];e.scale(150*a).translate([o,s])},n)}function E1(e,t,n){return b1(e,function(i){var r=+t,a=r/(i[1][1]-i[0][1]),o=-a*i[0][0],s=(r-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var nD=16,fH=re(30*he);function iD(e,t){return+t?hH(e,t):dH(e)}function dH(e){return pp({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function hH(e,t){function n(i,r,a,o,s,l,u,c,f,d,h,p,g,m){var v=u-i,y=c-r,b=v*v+y*y;if(b>4*t&&g--){var E=o+d,x=s+h,k=l+p,w=Tt(E*E+x*x+k*k),A=bn(k/=w),_=ye(ye(k)-1)<ie||ye(a-f)<ie?(a+f)/2:Jn(x,E),O=e(_,A),S=O[0],T=O[1],D=S-i,M=T-r,C=y*D-v*M;(C*C/b>t||ye((v*D+y*M)/b-.5)>.3||o*d+s*h+l*p<fH)&&(n(i,r,a,o,s,l,S,T,_,E/=w,x/=w,k,g,m),m.point(S,T),n(S,T,_,E,x,k,u,c,f,d,h,p,g,m))}}return function(i){var r,a,o,s,l,u,c,f,d,h,p,g,m={point:v,lineStart:y,lineEnd:E,polygonStart:function(){i.polygonStart(),m.lineStart=x},polygonEnd:function(){i.polygonEnd(),m.lineStart=y}};function v(A,_){A=e(A,_),i.point(A[0],A[1])}function y(){f=NaN,m.point=b,i.lineStart()}function b(A,_){var O=Do([A,_]),S=e(A,_);n(f,d,c,h,p,g,f=S[0],d=S[1],c=A,h=O[0],p=O[1],g=O[2],nD,i),i.point(f,d)}function E(){m.point=v,i.lineEnd()}function x(){y(),m.point=k,m.lineEnd=w}function k(A,_){b(r=A,_),a=f,o=d,s=h,l=p,u=g,m.point=b}function w(){n(f,d,c,h,p,g,a,o,r,s,l,u,nD,i),m.lineEnd=E,E()}return m}}var pH=pp({point:function(e,t){this.stream.point(e*he,t*he)}});function gH(e){return pp({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function mH(e,t,n,i,r){function a(o,s){return o*=i,s*=r,[t+e*o,n-e*s]}return a.invert=function(o,s){return[(o-t)/e*i,(n-s)/e*r]},a}function rD(e,t,n,i,r,a){var o=re(a),s=te(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(g,m){return g*=i,m*=r,[l*g-u*m+t,n-u*g-l*m]}return p.invert=function(g,m){return[i*(c*g-f*m+d),r*(h-f*g-c*m)]},p}function Xi(e){return aD(function(){return e})()}function aD(e){var t,n=150,i=480,r=250,a=0,o=0,s=0,l=0,u=0,c,f=0,d=1,h=1,p=null,g=j$,m=null,v,y,b,E=rc,x=.5,k,w,A,_,O;function S(C){return A(C[0]*he,C[1]*he)}function T(C){return C=A.invert(C[0],C[1]),C&&[C[0]*tt,C[1]*tt]}S.stream=function(C){return _&&O===C?_:_=pH(gH(c)(g(k(E(O=C)))))},S.preclip=function(C){return arguments.length?(g=C,p=void 0,M()):g},S.postclip=function(C){return arguments.length?(E=C,m=v=y=b=null,M()):E},S.clipAngle=function(C){return arguments.length?(g=+C?QG(p=C*he):(p=null,j$),M()):p*tt},S.clipExtent=function(C){return arguments.length?(E=C==null?(m=v=y=b=null,rc):L$(m=+C[0][0],v=+C[0][1],y=+C[1][0],b=+C[1][1]),M()):m==null?null:[[m,v],[y,b]]},S.scale=function(C){return arguments.length?(n=+C,D()):n},S.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],D()):[i,r]},S.center=function(C){return arguments.length?(a=C[0]%360*he,o=C[1]%360*he,D()):[a*tt,o*tt]},S.rotate=function(C){return arguments.length?(s=C[0]%360*he,l=C[1]%360*he,u=C.length>2?C[2]%360*he:0,D()):[s*tt,l*tt,u*tt]},S.angle=function(C){return arguments.length?(f=C%360*he,D()):f*tt},S.reflectX=function(C){return arguments.length?(d=C?-1:1,D()):d<0},S.reflectY=function(C){return arguments.length?(h=C?-1:1,D()):h<0},S.precision=function(C){return arguments.length?(k=iD(w,x=C*C),M()):Tt(x)},S.fitExtent=function(C,N){return gp(S,C,N)},S.fitSize=function(C,N){return w1(S,C,N)},S.fitWidth=function(C,N){return x1(S,C,N)},S.fitHeight=function(C,N){return E1(S,C,N)};function D(){var C=rD(n,0,0,d,h,f).apply(null,t(a,o)),N=(f?rD:mH)(n,i-C[0],r-C[1],d,h,f);return c=S$(s,l,u),w=r1(t,N),A=r1(c,w),k=iD(w,x),M()}function M(){return _=O=null,S}return function(){return t=e.apply(this,arguments),S.invert=t.invert&&T,D()}}function k1(e){var t=0,n=de/3,i=aD(e),r=i(t,n);return r.parallels=function(a){return arguments.length?i(t=a[0]*he,n=a[1]*he):[t*tt,n*tt]},r}function vH(e){var t=re(e);function n(i,r){return[i*t,te(r)/t]}return n.invert=function(i,r){return[i/t,bn(r*t)]},n}function yH(e,t){var n=te(e),i=(n+te(t))/2;if(ye(i)<ie)return vH(e);var r=1+n*(2*i-n),a=Tt(r)/i;function o(s,l){var u=Tt(r-2*i*te(l))/i;return[u*te(s*=i),a-u*re(s)]}return o.invert=function(s,l){var u=a-l,c=Jn(s,ye(u))*Kn(u);return u*i<0&&(c-=de*Kn(s)*Kn(u)),[c/i,bn((r-(s*s+u*u)*i*i)/(2*i))]},o}function mp(){return k1(yH).scale(155.424).center([0,33.6442])}function oD(){return mp().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function bH(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function wH(){var e,t,n=oD(),i,r=mp().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=mp().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,l,u={point:function(d,h){l=[d,h]}};function c(d){var h=d[0],p=d[1];return l=null,(i.point(h,p),l)||(a.point(h,p),l)||(s.point(h,p),l)}c.invert=function(d){var h=n.scale(),p=n.translate(),g=(d[0]-p[0])/h,m=(d[1]-p[1])/h;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=bH([n.stream(t=d),r.stream(d),o.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),o.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),o.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],g=+d[1];return i=n.translate(d).clipExtent([[p-.455*h,g-.238*h],[p+.455*h,g+.238*h]]).stream(u),a=r.translate([p-.307*h,g+.201*h]).clipExtent([[p-.425*h+ie,g+.12*h+ie],[p-.214*h-ie,g+.234*h-ie]]).stream(u),s=o.translate([p-.205*h,g+.212*h]).clipExtent([[p-.214*h+ie,g+.166*h+ie],[p-.115*h-ie,g+.234*h-ie]]).stream(u),f()},c.fitExtent=function(d,h){return gp(c,d,h)},c.fitSize=function(d,h){return w1(c,d,h)},c.fitWidth=function(d,h){return x1(c,d,h)},c.fitHeight=function(d,h){return E1(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function sD(e){return function(t,n){var i=re(t),r=re(n),a=e(i*r);return[a*r*te(t),a*te(n)]}}function fc(e){return function(t,n){var i=Tt(t*t+n*n),r=e(i),a=te(r),o=re(r);return[Jn(t*a,i*o),bn(i&&n*a/i)]}}var lD=sD(function(e){return Tt(2/(1+e))});lD.invert=fc(function(e){return 2*bn(e/2)});function xH(){return Xi(lD).scale(124.75).clipAngle(180-.001)}var uD=sD(function(e){return(e=s$(e))&&e/te(e)});uD.invert=fc(function(e){return e});function EH(){return Xi(uD).scale(79.4188).clipAngle(180-.001)}function vp(e,t){return[e,Gh(Yb((Ve+t)/2))]}vp.invert=function(e,t){return[e,2*sl(o$(t))-Ve]};function kH(){return cD(vp).scale(961/Jt)}function cD(e){var t=Xi(e),n=t.center,i=t.scale,r=t.translate,a=t.clipExtent,o=null,s,l,u;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=s=l=u=null:(o=+f[0][0],s=+f[0][1],l=+f[1][0],u=+f[1][1]),c()):o==null?null:[[o,s],[l,u]]};function c(){var f=de*i(),d=t(UG(t.rotate()).invert([0,0]));return a(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===vp?[[Math.max(d[0]-f,o),s],[Math.min(d[0]+f,l),u]]:[[o,Math.max(d[1]-f,s)],[l,Math.min(d[1]+f,u)]])}return c()}function yp(e){return Yb((Ve+e)/2)}function _H(e,t){var n=re(e),i=e===t?te(e):Gh(n/re(t))/Gh(yp(t)/yp(e)),r=n*Hb(yp(e),i)/i;if(!i)return vp;function a(o,s){r>0?s<-Ve+ie&&(s=-Ve+ie):s>Ve-ie&&(s=Ve-ie);var l=r/Hb(yp(s),i);return[l*te(i*o),r-l*re(i*o)]}return a.invert=function(o,s){var l=r-s,u=Kn(i)*Tt(o*o+l*l),c=Jn(o,ye(l))*Kn(l);return l*i<0&&(c-=de*Kn(o)*Kn(l)),[c/i,2*sl(Hb(r/u,1/i))-Ve]},a}function AH(){return k1(_H).scale(109.5).parallels([30,30])}function bp(e,t){return[e,t]}bp.invert=bp;function SH(){return Xi(bp).scale(152.63)}function OH(e,t){var n=re(e),i=e===t?te(e):(n-re(t))/(t-e),r=n/i+e;if(ye(i)<ie)return bp;function a(o,s){var l=r-s,u=i*o;return[l*te(u),r-l*re(u)]}return a.invert=function(o,s){var l=r-s,u=Jn(o,ye(l))*Kn(l);return l*i<0&&(u-=de*Kn(o)*Kn(l)),[u/i,r-Kn(i)*Tt(o*o+l*l)]},a}function TH(){return k1(OH).scale(131.154).center([0,13.9389])}var dc=1.340264,hc=-.081106,pc=893e-6,gc=.003796,wp=Tt(3)/2,CH=12;function fD(e,t){var n=bn(wp*te(t)),i=n*n,r=i*i*i;return[e*re(n)/(wp*(dc+3*hc*i+r*(7*pc+9*gc*i))),n*(dc+hc*i+r*(pc+gc*i))]}fD.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,a=0,o,s,l;a<CH&&!(s=n*(dc+hc*i+r*(pc+gc*i))-t,l=dc+3*hc*i+r*(7*pc+9*gc*i),n-=o=s/l,i=n*n,r=i*i*i,ye(o)<Gb);++a);return[wp*e*(dc+3*hc*i+r*(7*pc+9*gc*i))/re(n),bn(te(n)/wp)]};function $H(){return Xi(fD).scale(177.158)}function dD(e,t){var n=re(t),i=re(e)*n;return[n*te(e)/i,te(t)/i]}dD.invert=fc(sl);function DH(){return Xi(dD).scale(144.049).clipAngle(60)}function RH(){var e=1,t=0,n=0,i=1,r=1,a=0,o,s,l=null,u,c,f,d=1,h=1,p=pp({point:function(E,x){var k=b([E,x]);this.stream.point(k[0],k[1])}}),g=rc,m,v;function y(){return d=e*i,h=e*r,m=v=null,b}function b(E){var x=E[0]*d,k=E[1]*h;if(a){var w=k*o-x*s;x=x*o+k*s,k=w}return[x+t,k+n]}return b.invert=function(E){var x=E[0]-t,k=E[1]-n;if(a){var w=k*o+x*s;x=x*o-k*s,k=w}return[x/d,k/h]},b.stream=function(E){return m&&v===E?m:m=p(g(v=E))},b.postclip=function(E){return arguments.length?(g=E,l=u=c=f=null,y()):g},b.clipExtent=function(E){return arguments.length?(g=E==null?(l=u=c=f=null,rc):L$(l=+E[0][0],u=+E[0][1],c=+E[1][0],f=+E[1][1]),y()):l==null?null:[[l,u],[c,f]]},b.scale=function(E){return arguments.length?(e=+E,y()):e},b.translate=function(E){return arguments.length?(t=+E[0],n=+E[1],y()):[t,n]},b.angle=function(E){return arguments.length?(a=E%360*he,s=te(a),o=re(a),y()):a*tt},b.reflectX=function(E){return arguments.length?(i=E?-1:1,y()):i<0},b.reflectY=function(E){return arguments.length?(r=E?-1:1,y()):r<0},b.fitExtent=function(E,x){return gp(b,E,x)},b.fitSize=function(E,x){return w1(b,E,x)},b.fitWidth=function(E,x){return x1(b,E,x)},b.fitHeight=function(E,x){return E1(b,E,x)},b}function hD(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}hD.invert=function(e,t){var n=t,i=25,r;do{var a=n*n,o=a*a;n-=r=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(ye(r)>ie&&--i>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function FH(){return Xi(hD).scale(175.295)}function pD(e,t){return[re(t)*te(e),te(t)]}pD.invert=fc(bn);function NH(){return Xi(pD).scale(249.5).clipAngle(90+ie)}function gD(e,t){var n=re(t),i=1+re(e)*n;return[n*te(e)/i,te(t)/i]}gD.invert=fc(function(e){return 2*sl(e)});function IH(){return Xi(gD).scale(250).clipAngle(142)}function mD(e,t){return[Gh(Yb((Ve+t)/2)),-e]}mD.invert=function(e,t){return[-t,2*sl(o$(e))-Ve]};function MH(){var e=cD(mD),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var jH=Math.abs,_1=Math.cos,xp=Math.sin,LH=1e-6,vD=Math.PI,A1=vD/2,yD=PH(2);function bD(e){return e>1?A1:e<-1?-A1:Math.asin(e)}function PH(e){return e>0?Math.sqrt(e):0}function zH(e,t){var n=e*xp(t),i=30,r;do t-=r=(t+xp(t)-n)/(1+_1(t));while(jH(r)>LH&&--i>0);return t/2}function BH(e,t,n){function i(r,a){return[e*r*_1(a=zH(n,a)),t*xp(a)]}return i.invert=function(r,a){return a=bD(a/t),[r/(e*_1(a)),bD((2*a+xp(2*a))/n)]},i}var UH=BH(yD/A1,yD,vD);function qH(){return Xi(UH).scale(169.529)}var WH=tD(),S1=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function GH(e,t){return function n(){var i=t();return i.type=e,i.path=tD().projection(i),i.copy=i.copy||function(){var r=n();return S1.forEach(function(a){i[a]&&r[a](i[a]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function O1(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Ep[e]=GH(e,t),this):Ep[e]||null}function wD(e){return e&&e.path||WH}var Ep={albers:oD,albersusa:wH,azimuthalequalarea:xH,azimuthalequidistant:EH,conicconformal:AH,conicequalarea:mp,conicequidistant:TH,equalEarth:$H,equirectangular:SH,gnomonic:DH,identity:RH,mercator:kH,mollweide:qH,naturalEarth1:FH,orthographic:NH,stereographic:IH,transversemercator:MH};for(var xD in Ep)O1(xD,Ep[xD]);function T1(e){$.call(this,null,e)}T1.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};var HH=P(T1,$);HH.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||Yt,a=e.as||"path",o=n.SOURCE;function s(u){u[a]=i(r(u))}!i||e.modified()?(this.value=i=wD(e.projection),n.materialize().reflow()):o=r===Yt||t.modified(r.fields)?n.ADD_MOD:n.ADD;var l=YH(i,e.pointRadius);return n.visit(o,s),i.pointRadius(l),n.modifies(a)};function YH(e,t){var n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function C1(e){$.call(this,null,e)}C1.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};var VH=P(C1,$);VH.transform=function(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],a=e.as||["x","y"],o=a[0],s=a[1],l;function u(c){var f=n([i(c),r(c)]);f?(c[o]=f[0],c[s]=f[1]):(c[o]=void 0,c[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(l=t.modified(i.fields)||t.modified(r.fields),t.visit(l?t.ADD_MOD:t.ADD,u)),t.modifies(a)};function $1(e){$.call(this,null,e)}$1.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};var XH=P($1,$);XH.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",a=n.ADD;return(!i||e.modified())&&(this.value=i=JH(wD(e.projection),e.field||Fi("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,function(o){o[r]=i}),n.modifies(r)};function JH(e,t,n){var i=n==null?function(r){return e(t(r))}:function(r){var a=e.pointRadius(),o=e.pointRadius(n)(t(r));return e.pointRadius(a),o};return i.context=function(r){return e.context(r),i},i}function D1(e){$.call(this,[],e),this.generator=eH()}D1.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var KH=P(D1,$);KH.transform=function(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(var a in e)ge(i[a])&&i[a](e[a]);return r=i(),n.length?t.mod.push(yk(n[0],r)):t.add.push(ke(r)),n[0]=r,t};function R1(e){$.call(this,null,e)}R1.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};var QH=P(R1,$);QH.transform=function(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||Yt,a=eY(e.opacity,e),o=ZH(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:i?uo(n.map(u=>uo(r(u).values))):0};return n.forEach(u=>{const c=r(u),f=fe({},u,l);i||(f.$max=uo(c.values||[])),u[s]=tY(c,f,o.dep?o:Vt(o(f)),a.dep?a:Vt(a(f)))}),t.reflow(!0).modifies(s)};function ZH(e,t){let n;return ge(e)?(n=i=>ya(e(i,t)),n.dep=ED(e)):n=Vt(ya(e||"#888")),n}function eY(e,t){let n;return ge(e)?(n=i=>e(i,t),n.dep=ED(e)):e?n=Vt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function ED(e){if(!ge(e))return!1;const t=kt(Ht(e));return t.$x||t.$y||t.$value||t.$max}function tY(e,t,n,i){const r=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||r,u=e.y2||a,c=e.values,f=c?m=>c[m]:to,d=Ou(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),g=p.data;for(let m=s,v=0;m<u;++m){t.$y=m-s;for(let y=o,b=m*r;y<l;++y,v+=4){t.$x=y-o,t.$value=f(y+b);const E=n(t);g[v+0]=E.r,g[v+1]=E.g,g[v+2]=E.b,g[v+3]=~~(255*i(t))}}return h.putImageData(p,0,0),d}function kD(e){$.call(this,null,e),this.modified(!0)}var nY=P(kD,$);nY.transform=function(e,t){var n=this.value;return!n||e.modified("type")?(this.value=n=rY(e.type),S1.forEach(function(i){e[i]!=null&&_D(n,i,e[i])})):S1.forEach(function(i){e.modified(i)&&_D(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&iY(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function iY(e,t){var n=aY(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function rY(e){var t=O1((e||"mercator").toLowerCase());return t||F("Unrecognized projection type: "+e),t()}function _D(e,t,n){ge(e[t])&&e[t](n)}function aY(e){return e=G(e),e.length===1?e[0]:{type:qb,features:e.reduce((t,n)=>t.concat(oY(n)),[])}}function oY(e){return e.type===qb?e.features:G(e).filter(t=>t!=null).map(t=>t.type===Ub?t:{type:Ub,geometry:t})}var sY=Object.freeze({__proto__:null,contour:Bb,geojson:Wb,geopath:T1,geopoint:C1,geoshape:$1,graticule:D1,heatmap:R1,isocontour:Lb,kde2d:zb,projection:kD});function lY(e,t){var n;e==null&&(e=0),t==null&&(t=0);function i(){var r,a=n.length,o,s=0,l=0;for(r=0;r<a;++r)o=n[r],s+=o.x,l+=o.y;for(s=s/a-e,l=l/a-t,r=0;r<a;++r)o=n[r],o.x-=s,o.y-=l}return i.initialize=function(r){n=r},i.x=function(r){return arguments.length?(e=+r,i):e},i.y=function(r){return arguments.length?(t=+r,i):t},i}function uY(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return AD(this.cover(t,n),t,n,e)}function AD(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,a=e._root,o={data:i},s=e._x0,l=e._y0,u=e._x1,c=e._y1,f,d,h,p,g,m,v,y;if(!a)return e._root=o,e;for(;a.length;)if((g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d,r=a,!(a=a[v=m<<1|g]))return r[v]=o,e;if(h=+e._x.call(null,a.data),p=+e._y.call(null,a.data),t===h&&n===p)return o.next=a,r?r[v]=o:e._root=o,e;do r=r?r[v]=new Array(4):e._root=new Array(4),(g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d;while((v=m<<1|g)===(y=(p>=d)<<1|h>=f));return r[y]=a,r[v]=o,e}function cY(e){var t,n,i=e.length,r,a,o=new Array(i),s=new Array(i),l=Infinity,u=Infinity,c=-Infinity,f=-Infinity;for(n=0;n<i;++n){if(isNaN(r=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=r,s[n]=a,r<l&&(l=r),r>c&&(c=r),a<u&&(u=a),a>f&&(f=a)}if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<i;++n)AD(this,o[n],s[n],e[n]);return this}function fY(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,a=(i=Math.floor(t))+1;else{for(var o=r-n,s=this._root,l,u;n>e||e>=r||i>t||t>=a;){u=(t<i)<<1|e<n,l=new Array(4),l[u]=s,s=l,o*=2;switch(u){case 0:r=n+o,a=i+o;break;case 1:n=r-o,a=i+o;break;case 2:r=n+o,i=a-o;break;case 3:n=r-o,i=a-o;break}}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this}function dY(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function hY(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function en(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function pY(e,t,n){var i,r=this._x0,a=this._y0,o,s,l,u,c=this._x1,f=this._y1,d=[],h=this._root,p,g;for(h&&d.push(new en(h,r,a,c,f)),n==null?n=Infinity:(r=e-n,a=t-n,c=e+n,f=t+n,n*=n);p=d.pop();){if(!(h=p.node)||(o=p.x0)>c||(s=p.y0)>f||(l=p.x1)<r||(u=p.y1)<a)continue;if(h.length){var m=(o+l)/2,v=(s+u)/2;d.push(new en(h[3],m,v,l,u),new en(h[2],o,v,m,u),new en(h[1],m,s,l,v),new en(h[0],o,s,m,v)),(g=(t>=v)<<1|e>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var y=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),E=y*y+b*b;if(E<n){var x=Math.sqrt(n=E);r=e-x,a=t-x,c=e+x,f=t+x,i=h.data}}}return i}function gY(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,a,o=this._x0,s=this._y0,l=this._x1,u=this._y1,c,f,d,h,p,g,m,v;if(!n)return this;if(n.length)for(;;){if((p=c>=(d=(o+l)/2))?o=d:l=d,(g=f>=(h=(s+u)/2))?s=h:u=h,!(t=n,n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,v=m)}for(;n.data!==e;)if(!(r=n,n=n.next))return this;return(a=n.next)&&delete n.next,r?(a?r.next=a:delete r.next,this):t?(a?t[m]=a:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[v]=n:this._root=n),this):(this._root=a,this)}function mY(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function vY(){return this._root}function yY(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function bY(e){var t=[],n,i=this._root,r,a,o,s,l;for(i&&t.push(new en(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,a=n.x0,o=n.y0,s=n.x1,l=n.y1)&&i.length){var u=(a+s)/2,c=(o+l)/2;(r=i[3])&&t.push(new en(r,u,c,s,l)),(r=i[2])&&t.push(new en(r,a,c,u,l)),(r=i[1])&&t.push(new en(r,u,o,s,c)),(r=i[0])&&t.push(new en(r,a,o,u,c))}return this}function wY(e){var t=[],n=[],i;for(this._root&&t.push(new en(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var a,o=i.x0,s=i.y0,l=i.x1,u=i.y1,c=(o+l)/2,f=(s+u)/2;(a=r[0])&&t.push(new en(a,o,s,c,f)),(a=r[1])&&t.push(new en(a,c,s,l,f)),(a=r[2])&&t.push(new en(a,o,f,c,u)),(a=r[3])&&t.push(new en(a,c,f,l,u))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function xY(e){return e[0]}function EY(e){return arguments.length?(this._x=e,this):this._x}function kY(e){return e[1]}function _Y(e){return arguments.length?(this._y=e,this):this._y}function F1(e,t,n){var i=new N1(t??xY,n??kY,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function N1(e,t,n,i,r,a){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function SD(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var tn=F1.prototype=N1.prototype;tn.copy=function(){var e=new N1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=SD(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=SD(i));return e},tn.add=uY,tn.addAll=cY,tn.cover=fY,tn.data=dY,tn.extent=hY,tn.find=pY,tn.remove=gY,tn.removeAll=mY,tn.root=vY,tn.size=yY,tn.visit=bY,tn.visitAfter=wY,tn.x=EY,tn.y=_Y;function nn(e){return function(){return e}}function Ea(){return(Math.random()-.5)*1e-6}function AY(e){return e.x+e.vx}function SY(e){return e.y+e.vy}function OY(e){var t,n,i=1,r=1;typeof e!="function"&&(e=nn(e==null?1:+e));function a(){for(var l,u=t.length,c,f,d,h,p,g,m=0;m<r;++m)for(c=F1(t,AY,SY).visitAfter(o),l=0;l<u;++l)f=t[l],p=n[f.index],g=p*p,d=f.x+f.vx,h=f.y+f.vy,c.visit(v);function v(y,b,E,x,k){var w=y.data,A=y.r,_=p+A;if(w){if(w.index>f.index){var O=d-w.x-w.vx,S=h-w.y-w.vy,T=O*O+S*S;T<_*_&&(O===0&&(O=Ea(),T+=O*O),S===0&&(S=Ea(),T+=S*S),T=(_-(T=Math.sqrt(T)))/T*i,f.vx+=(O*=T)*(_=(A*=A)/(g+A)),f.vy+=(S*=T)*_,w.vx-=O*(_=1-_),w.vy-=S*_)}return}return b>d+_||x<d-_||E>h+_||k<h-_}}function o(l){if(l.data)return l.r=n[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function s(){if(!t)return;var l,u=t.length,c;for(n=new Array(u),l=0;l<u;++l)c=t[l],n[c.index]=+e(c,l,t)}return a.initialize=function(l){t=l,s()},a.iterations=function(l){return arguments.length?(r=+l,a):r},a.strength=function(l){return arguments.length?(i=+l,a):i},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:nn(+l),s(),a):e},a}function TY(e){return e.index}function OD(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function CY(e){var t=TY,n=c,i,r=nn(30),a,o,s,l,u=1;e==null&&(e=[]);function c(g){return 1/Math.min(s[g.source.index],s[g.target.index])}function f(g){for(var m=0,v=e.length;m<u;++m)for(var y=0,b,E,x,k,w,A,_;y<v;++y)b=e[y],E=b.source,x=b.target,k=x.x+x.vx-E.x-E.vx||Ea(),w=x.y+x.vy-E.y-E.vy||Ea(),A=Math.sqrt(k*k+w*w),A=(A-a[y])/A*g*i[y],k*=A,w*=A,x.vx-=k*(_=l[y]),x.vy-=w*_,E.vx+=k*(_=1-_),E.vy+=w*_}function d(){if(!o)return;var g,m=o.length,v=e.length,y=new Map(o.map((E,x)=>[t(E,x,o),E])),b;for(g=0,s=new Array(m);g<v;++g)b=e[g],b.index=g,typeof b.source!="object"&&(b.source=OD(y,b.source)),typeof b.target!="object"&&(b.target=OD(y,b.target)),s[b.source.index]=(s[b.source.index]||0)+1,s[b.target.index]=(s[b.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)b=e[g],l[g]=s[b.source.index]/(s[b.source.index]+s[b.target.index]);i=new Array(v),h(),a=new Array(v),p()}function h(){if(!o)return;for(var g=0,m=e.length;g<m;++g)i[g]=+n(e[g],g,e)}function p(){if(!o)return;for(var g=0,m=e.length;g<m;++g)a[g]=+r(e[g],g,e)}return f.initialize=function(g){o=g,d()},f.links=function(g){return arguments.length?(e=g,d(),f):e},f.id=function(g){return arguments.length?(t=g,f):t},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:nn(+g),h(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:nn(+g),p(),f):r},f}var $Y={value:function(){}};function TD(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new kp(n)}function kp(e){this._=e}function DY(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}kp.prototype=TD.prototype={constructor:kp,on:function(e,t){var n=this._,i=DY(e+"",n),r,a=-1,o=i.length;if(arguments.length<2){for(;++a<o;)if((r=(e=i[a]).type)&&(r=RY(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(r=(e=i[a]).type)n[r]=CD(n[r],e.name,t);else if(t==null)for(r in n)n[r]=CD(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new kp(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,a;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],i=0,r=a.length;i<r;++i)a[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};function RY(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function CD(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=$Y,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var hl=0,mc=0,vc=0,$D=1e3,_p,yc,Ap=0,No=0,Sp=0,bc=typeof performance=="object"&&performance.now?performance:Date,DD=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function I1(){return No||(DD(FY),No=bc.now()+Sp)}function FY(){No=0}function Op(){this._call=this._time=this._next=null}Op.prototype=RD.prototype={constructor:Op,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?I1():+n)+(t==null?0:+t),!this._next&&yc!==this&&(yc?yc._next=this:_p=this,yc=this),this._call=e,this._time=n,M1()},stop:function(){this._call&&(this._call=null,this._time=Infinity,M1())}};function RD(e,t,n){var i=new Op();return i.restart(e,t,n),i}function NY(){I1(),++hl;for(var e=_p,t;e;)(t=No-e._time)>=0&&e._call.call(null,t),e=e._next;--hl}function FD(){No=(Ap=bc.now())+Sp,hl=mc=0;try{NY()}finally{hl=0,MY(),No=0}}function IY(){var e=bc.now(),t=e-Ap;t>$D&&(Sp-=t,Ap=e)}function MY(){for(var e,t=_p,n,i=Infinity;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:_p=n);yc=e,M1(i)}function M1(e){if(hl)return;mc&&(mc=clearTimeout(mc));var t=e-No;t>24?(e<Infinity&&(mc=setTimeout(FD,e-bc.now()-Sp)),vc&&(vc=clearInterval(vc))):(vc||(Ap=bc.now(),vc=setInterval(IY,$D)),hl=1,DD(FD))}function jY(e,t,n){var i=new Op(),r=t;return t==null?(i.restart(e,t,n),i):(t=+t,n=n==null?I1():+n,i.restart(function a(o){o+=r,i.restart(a,r+=t,n),e(o)},t,n),i)}function LY(e){return e.x}function PY(e){return e.y}var zY=10,BY=Math.PI*(3-Math.sqrt(5));function UY(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,o=.6,s=new Map(),l=RD(c),u=TD("tick","end");e==null&&(e=[]);function c(){f(),u.call("tick",t),n<i&&(l.stop(),u.call("end",t))}function f(p){var g,m=e.length,v;p===void 0&&(p=1);for(var y=0;y<p;++y)for(n+=(a-n)*r,s.forEach(function(b){b(n)}),g=0;g<m;++g)v=e[g],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return t}function d(){for(var p=0,g=e.length,m;p<g;++p){if(m=e[p],m.index=p,m.fx!=null&&(m.x=m.fx),m.fy!=null&&(m.y=m.fy),isNaN(m.x)||isNaN(m.y)){var v=zY*Math.sqrt(p),y=p*BY;m.x=v*Math.cos(y),m.y=v*Math.sin(y)}(isNaN(m.vx)||isNaN(m.vy))&&(m.vx=m.vy=0)}}function h(p){return p.initialize&&p.initialize(e),p}return d(),t={tick:f,restart:function(){return l.restart(c),t},stop:function(){return l.stop(),t},nodes:function(p){return arguments.length?(e=p,d(),s.forEach(h),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(a=+p,t):a},velocityDecay:function(p){return arguments.length?(o=1-p,t):1-o},force:function(p,g){return arguments.length>1?(g==null?s.delete(p):s.set(p,h(g)),t):s.get(p)},find:function(p,g,m){var v=0,y=e.length,b,E,x,k,w;for(m==null?m=Infinity:m*=m,v=0;v<y;++v)k=e[v],b=p-k.x,E=g-k.y,x=b*b+E*E,x<m&&(w=k,m=x);return w},on:function(p,g){return arguments.length>1?(u.on(p,g),t):u.on(p)}}}function qY(){var e,t,n,i=nn(-30),r,a=1,o=Infinity,s=.81;function l(d){var h,p=e.length,g=F1(e,LY,PY).visitAfter(c);for(n=d,h=0;h<p;++h)t=e[h],g.visit(f)}function u(){if(!e)return;var d,h=e.length,p;for(r=new Array(h),d=0;d<h;++d)p=e[d],r[p.index]=+i(p,d,e)}function c(d){var h=0,p,g,m=0,v,y,b;if(d.length){for(v=y=b=0;b<4;++b)(p=d[b])&&(g=Math.abs(p.value))&&(h+=p.value,m+=g,v+=g*p.x,y+=g*p.y);d.x=v/m,d.y=y/m}else{p=d,p.x=p.data.x,p.y=p.data.y;do h+=r[p.data.index];while(p=p.next)}d.value=h}function f(d,h,p,g){if(!d.value)return!0;var m=d.x-t.x,v=d.y-t.y,y=g-h,b=m*m+v*v;if(y*y/s<b)return b<o&&(m===0&&(m=Ea(),b+=m*m),v===0&&(v=Ea(),b+=v*v),b<a&&(b=Math.sqrt(a*b)),t.vx+=m*d.value*n/b,t.vy+=v*d.value*n/b),!0;if(d.length||b>=o)return;(d.data!==t||d.next)&&(m===0&&(m=Ea(),b+=m*m),v===0&&(v=Ea(),b+=v*v),b<a&&(b=Math.sqrt(a*b)));do d.data!==t&&(y=r[d.data.index]*n/b,t.vx+=m*y,t.vy+=v*y);while(d=d.next)}return l.initialize=function(d){e=d,u()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:nn(+d),u(),l):i},l.distanceMin=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.distanceMax=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.theta=function(d){return arguments.length?(s=d*d,l):Math.sqrt(s)},l}function WY(e){var t=nn(.1),n,i,r;typeof e!="function"&&(e=nn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vx+=(r[l]-c.x)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:nn(+s),o(),a):t},a.x=function(s){return arguments.length?(e=typeof s=="function"?s:nn(+s),o(),a):e},a}function GY(e){var t=nn(.1),n,i,r;typeof e!="function"&&(e=nn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vy+=(r[l]-c.y)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:nn(+s),o(),a):t},a.y=function(s){return arguments.length?(e=typeof s=="function"?s:nn(+s),o(),a):e},a}var ND={center:lY,collide:OY,nbody:qY,link:CY,x:WY,y:GY},wc="forces",j1=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],HY=["static","iterations"],ID=["x","y","vx","vy"];function L1(e){$.call(this,null,e)}L1.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:ID}]};var MD=P(L1,$);MD.transform=function(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(j1),a=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&jD(n,e,0,t)):(this.value=n=VY(t.source,e),n.on("tick",YY(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(HY)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},MD.finish=function(e,t){for(var n=t.dataflow,i=this._argops,r=0,a=i.length,o;r<a;++r){if(o=i[r],o.name!==wc||o.op._argval.force!=="link")continue;for(var s=o.op._argops,l=0,u=s.length,c;l<u;++l)if(s[l].name==="links"&&(c=s[l].op.source)){n.pulse(c,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(ID)};function YY(e,t){return function(){e.touch(t).run()}}function VY(e,t){var n=UY(e),i=!1,r=n.stop,a=n.restart;return n.stopped=function(){return i},n.restart=function(){return i=!1,a()},n.stop=function(){return i=!0,r()},jD(n,t,!0).on("end",function(){i=!0})}function jD(e,t,n,i){var r=G(t.forces),a,o,s,l;for(a=0,o=j1.length;a<o;++a)s=j1[a],s!==wc&&t.modified(s)&&e[s](t[s]);for(a=0,o=r.length;a<o;++a)l=wc+a,s=n||t.modified(wc,a)?JY(r[a]):i&&XY(r[a],i)?e.force(l):null,s&&e.force(l,s);for(o=e.numForces||0;a<o;++a)e.force(wc+a,null);return e.numForces=r.length,e}function XY(e,t){var n,i;for(n in e)if(ge(i=e[n])&&t.modified(Ht(i)))return 1;return 0}function JY(e){var t,n;Q(ND,e.force)||F("Unrecognized force: "+e.force),t=ND[e.force]();for(n in e)ge(t[n])&&KY(t[n],e[n],e);return t}function KY(e,t,n){e(ge(t)?function(i){return t(i,n)}:t)}var QY=Object.freeze({__proto__:null,force:L1});function P1(e,t,n){var i={};return e.each(function(r){var a=r.data;n(a)&&(i[t(a)]=r)}),e.lookup=i,e}function ZY(e,t){return e.parent===t.parent?1:2}function eV(e){return e.reduce(tV,0)/e.length}function tV(e,t){return e+t.x}function nV(e){return 1+e.reduce(iV,0)}function iV(e,t){return Math.max(e,t.y)}function rV(e){for(var t;t=e.children;)e=t[0];return e}function aV(e){for(var t;t=e.children;)e=t[t.length-1];return e}function oV(){var e=ZY,t=1,n=1,i=!1;function r(a){var o,s=0;a.eachAfter(function(d){var h=d.children;h?(d.x=eV(h),d.y=nV(h)):(d.x=o?s+=e(d,o):0,d.y=0,o=d)});var l=rV(a),u=aV(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(i?function(d){d.x=(d.x-a.x)*t,d.y=(a.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(a.y?d.y/a.y:1))*n})}return r.separation=function(a){return arguments.length?(e=a,r):e},r.size=function(a){return arguments.length?(i=!1,t=+a[0],n=+a[1],r):i?null:[t,n]},r.nodeSize=function(a){return arguments.length?(i=!0,t=+a[0],n=+a[1],r):i?[t,n]:null},r}function sV(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function lV(){return this.eachAfter(sV)}function uV(e){var t=this,n,i=[t],r,a,o;do for(n=i.reverse(),i=[];t=n.pop();)if(e(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)i.push(r[a]);while(i.length);return this}function cV(e){for(var t=this,n=[t],i,r;t=n.pop();)if(e(t),i=t.children,i)for(r=i.length-1;r>=0;--r)n.push(i[r]);return this}function fV(e){for(var t=this,n=[t],i=[],r,a,o;t=n.pop();)if(i.push(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)n.push(r[a]);for(;t=i.pop();)e(t);return this}function dV(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function hV(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function pV(e){for(var t=this,n=gV(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function gV(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function mV(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function vV(){var e=[];return this.each(function(t){e.push(t)}),e}function yV(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function bV(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function z1(e,t){var n=new pl(e),i=+e.value&&(n.value=e.value),r,a=[n],o,s,l,u;for(t==null&&(t=xV);r=a.pop();)if(i&&(r.value=+r.data.value),(s=t(r.data))&&(u=s.length))for(r.children=new Array(u),l=u-1;l>=0;--l)a.push(o=r.children[l]=new pl(s[l])),o.parent=r,o.depth=r.depth+1;return n.eachBefore(LD)}function wV(){return z1(this).eachBefore(EV)}function xV(e){return e.children}function EV(e){e.data=e.data.data}function LD(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function pl(e){this.data=e,this.depth=this.height=0,this.parent=null}pl.prototype=z1.prototype={constructor:pl,count:lV,each:uV,eachAfter:fV,eachBefore:cV,sum:dV,sort:hV,path:pV,ancestors:mV,descendants:vV,leaves:yV,links:bV,copy:wV};var kV=Array.prototype.slice;function _V(e){for(var t=e.length,n,i;t;)i=Math.random()*t--|0,n=e[t],e[t]=e[i],e[i]=n;return e}function AV(e){for(var t=0,n=(e=_V(kV.call(e))).length,i=[],r,a;t<n;)r=e[t],a&&PD(a,r)?++t:(a=OV(i=SV(i,r)),t=0);return a}function SV(e,t){var n,i;if(B1(t,e))return[t];for(n=0;n<e.length;++n)if(Tp(t,e[n])&&B1(xc(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(Tp(xc(e[n],e[i]),t)&&Tp(xc(e[n],t),e[i])&&Tp(xc(e[i],t),e[n])&&B1(zD(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error()}function Tp(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function PD(e,t){var n=e.r-t.r+1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function B1(e,t){for(var n=0;n<t.length;++n)if(!PD(e,t[n]))return!1;return!0}function OV(e){switch(e.length){case 1:return TV(e[0]);case 2:return xc(e[0],e[1]);case 3:return zD(e[0],e[1],e[2])}}function TV(e){return{x:e.x,y:e.y,r:e.r}}function xc(e,t){var n=e.x,i=e.y,r=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-i,c=s-r,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(i+o+u/f*c)/2,r:(f+r+s)/2}}function zD(e,t,n){var i=e.x,r=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=i-o,h=i-u,p=r-s,g=r-c,m=l-a,v=f-a,y=i*i+r*r-a*a,b=y-o*o-s*s+l*l,E=y-u*u-c*c+f*f,x=h*p-d*g,k=(p*E-g*b)/(x*2)-i,w=(g*m-p*v)/x,A=(h*b-d*E)/(x*2)-r,_=(d*v-h*m)/x,O=w*w+_*_-1,S=2*(a+k*w+A*_),T=k*k+A*A-a*a,D=-(O?(S+Math.sqrt(S*S-4*O*T))/(2*O):T/S);return{x:i+k+w*D,y:r+A+_*D,r:D}}function BD(e,t,n){var i=e.x-t.x,r,a,o=e.y-t.y,s,l,u=i*i+o*o;u?(a=t.r+n.r,a*=a,l=e.r+n.r,l*=l,a>l?(r=(u+l-a)/(2*u),s=Math.sqrt(Math.max(0,l/u-r*r)),n.x=e.x-r*i-s*o,n.y=e.y-r*o+s*i):(r=(u+a-l)/(2*u),s=Math.sqrt(Math.max(0,a/u-r*r)),n.x=t.x+r*i-s*o,n.y=t.y+r*o+s*i)):(n.x=t.x+n.r,n.y=t.y)}function UD(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function qD(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,a=(t.y*n.r+n.y*t.r)/i;return r*r+a*a}function Cp(e){this._=e,this.next=null,this.previous=null}function CV(e){if(!(r=e.length))return 0;var t,n,i,r,a,o,s,l,u,c,f;if(t=e[0],t.x=0,t.y=0,!(r>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;BD(n,t,i=e[2]),t=new Cp(t),n=new Cp(n),i=new Cp(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(s=3;s<r;++s){BD(t._,n._,i=e[s]),i=new Cp(i),l=n.next,u=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(UD(l._,i._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(UD(u._,i._)){t=u,t.next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}while(l!==u.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,a=qD(t);(i=i.next)!==n;)(o=qD(i))<a&&(t=i,a=o);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=AV(t),s=0;s<r;++s)t=e[s],t.x-=i.x,t.y-=i.y;return i.r}function $V(e){return e==null?null:$p(e)}function $p(e){if(typeof e!="function")throw new Error();return e}function Io(){return 0}function gl(e){return function(){return e}}function DV(e){return Math.sqrt(e.value)}function RV(){var e=null,t=1,n=1,i=Io;function r(a){return a.x=t/2,a.y=n/2,e?a.eachBefore(WD(e)).eachAfter(U1(i,.5)).eachBefore(GD(1)):a.eachBefore(WD(DV)).eachAfter(U1(Io,1)).eachAfter(U1(i,a.r/Math.min(t,n))).eachBefore(GD(Math.min(t,n)/(2*a.r))),a}return r.radius=function(a){return arguments.length?(e=$V(a),r):e},r.size=function(a){return arguments.length?(t=+a[0],n=+a[1],r):[t,n]},r.padding=function(a){return arguments.length?(i=typeof a=="function"?a:gl(+a),r):i},r}function WD(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function U1(e,t){return function(n){if(i=n.children){var i,r,a=i.length,o=e(n)*t||0,s;if(o)for(r=0;r<a;++r)i[r].r+=o;if(s=CV(i),o)for(r=0;r<a;++r)i[r].r-=o;n.r=s+o}}}function GD(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function HD(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Ec(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(i-t)/e.value;++s<l;)o=a[s],o.y0=n,o.y1=r,o.x0=t,o.x1=t+=o.value*u}function FV(){var e=1,t=1,n=0,i=!1;function r(o){var s=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/s,o.eachBefore(a(t,s)),i&&o.eachBefore(HD),o}function a(o,s){return function(l){l.children&&Ec(l,l.x0,o*(l.depth+1)/s,l.x1,o*(l.depth+2)/s);var u=l.x0,c=l.y0,f=l.x1-n,d=l.y1-n;f<u&&(u=f=(u+f)/2),d<c&&(c=d=(c+d)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=d}}return r.round=function(o){return arguments.length?(i=!!o,r):i},r.size=function(o){return arguments.length?(e=+o[0],t=+o[1],r):[e,t]},r.padding=function(o){return arguments.length?(n=+o,r):n},r}var YD="$",NV={depth:-1},VD={};function IV(e){return e.id}function MV(e){return e.parentId}function XD(){var e=IV,t=MV;function n(i){var r,a,o=i.length,s,l,u,c=new Array(o),f,d,h={};for(a=0;a<o;++a)r=i[a],u=c[a]=new pl(r),(f=e(r,a,i))!=null&&(f+="")&&(d=YD+(u.id=f),h[d]=d in h?VD:u);for(a=0;a<o;++a)if(u=c[a],f=t(i[a],a,i),f==null||!(f+="")){if(s)throw new Error("multiple roots");s=u}else{if(l=h[YD+f],!l)throw new Error("missing: "+f);if(l===VD)throw new Error("ambiguous: "+f);l.children?l.children.push(u):l.children=[u],u.parent=l}if(!s)throw new Error("no root");if(s.parent=NV,s.eachBefore(function(p){p.depth=p.parent.depth+1,--o}).eachBefore(LD),s.parent=null,o>0)throw new Error("cycle");return s}return n.id=function(i){return arguments.length?(e=$p(i),n):e},n.parentId=function(i){return arguments.length?(t=$p(i),n):t},n}function jV(e,t){return e.parent===t.parent?1:2}function q1(e){var t=e.children;return t?t[0]:e.t}function W1(e){var t=e.children;return t?t[t.length-1]:e.t}function LV(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function PV(e){for(var t=0,n=0,i=e.children,r=i.length,a;--r>=0;)a=i[r],a.z+=t,a.m+=t,t+=a.s+(n+=a.c)}function zV(e,t,n){return e.a.parent===t.parent?e.a:n}function Dp(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Dp.prototype=Object.create(pl.prototype);function BV(e){for(var t=new Dp(e,0),n,i=[t],r,a,o,s;n=i.pop();)if(a=n._.children)for(n.children=new Array(s=a.length),o=s-1;o>=0;--o)i.push(r=n.children[o]=new Dp(a[o],o)),r.parent=n;return(t.parent=new Dp(null,0)).children=[t],t}function UV(){var e=jV,t=1,n=1,i=null;function r(u){var c=BV(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(o),i)u.eachBefore(l);else{var f=u,d=u,h=u;u.eachBefore(function(y){y.x<f.x&&(f=y),y.x>d.x&&(d=y),y.depth>h.depth&&(h=y)});var p=f===d?1:e(f,d)/2,g=p-f.x,m=t/(d.x+p+g),v=n/(h.depth||1);u.eachBefore(function(y){y.x=(y.x+g)*m,y.y=y.depth*v})}return u}function a(u){var c=u.children,f=u.parent.children,d=u.i?f[u.i-1]:null;if(c){PV(u);var h=(c[0].z+c[c.length-1].z)/2;d?(u.z=d.z+e(u._,d._),u.m=u.z-h):u.z=h}else d&&(u.z=d.z+e(u._,d._));u.parent.A=s(u,d,u.parent.A||f[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function s(u,c,f){if(c){for(var d=u,h=u,p=c,g=d.parent.children[0],m=d.m,v=h.m,y=p.m,b=g.m,E;p=W1(p),d=q1(d),p&&d;)g=q1(g),h=W1(h),h.a=u,E=p.z+y-d.z-m+e(p._,d._),E>0&&(LV(zV(p,u,f),u,E),m+=E,v+=E),y+=p.m,m+=d.m,b+=g.m,v+=h.m;p&&!W1(h)&&(h.t=p,h.m+=y-v),d&&!q1(g)&&(g.t=d,g.m+=m-b,f=u)}return f}function l(u){u.x*=t,u.y=u.depth*n}return r.separation=function(u){return arguments.length?(e=u,r):e},r.size=function(u){return arguments.length?(i=!1,t=+u[0],n=+u[1],r):i?null:[t,n]},r.nodeSize=function(u){return arguments.length?(i=!0,t=+u[0],n=+u[1],r):i?[t,n]:null},r}function Rp(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(r-n)/e.value;++s<l;)o=a[s],o.x0=t,o.x1=i,o.y0=n,o.y1=n+=o.value*u}var JD=(1+Math.sqrt(5))/2;function KD(e,t,n,i,r,a){for(var o=[],s=t.children,l,u,c=0,f=0,d=s.length,h,p,g=t.value,m,v,y,b,E,x,k;c<d;){h=r-n,p=a-i;do m=s[f++].value;while(!m&&f<d);for(v=y=m,x=Math.max(p/h,h/p)/(g*e),k=m*m*x,E=Math.max(y/k,k/v);f<d;++f){if(m+=u=s[f].value,u<v&&(v=u),u>y&&(y=u),k=m*m*x,b=Math.max(y/k,k/v),b>E){m-=u;break}E=b}o.push(l={value:m,dice:h<p,children:s.slice(c,f)}),l.dice?Ec(l,n,i,r,g?i+=p*m/g:a):Rp(l,n,i,g?n+=h*m/g:r,a),g-=m,c=f}return o}var QD=function e(t){function n(i,r,a,o,s){KD(t,i,r,a,o,s)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(JD);function qV(){var e=QD,t=!1,n=1,i=1,r=[0],a=Io,o=Io,s=Io,l=Io,u=Io;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(HD),d}function f(d){var h=r[d.depth],p=d.x0+h,g=d.y0+h,m=d.x1-h,v=d.y1-h;m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),d.x0=p,d.y0=g,d.x1=m,d.y1=v,d.children&&(h=r[d.depth+1]=a(d)/2,p+=u(d)-h,g+=o(d)-h,m-=s(d)-h,v-=l(d)-h,m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),e(d,p,g,m,v))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=$p(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(a=typeof d=="function"?d:gl(+d),c):a},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:gl(+d),c):o},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:gl(+d),c):s},c.paddingBottom=function(d){return arguments.length?(l=typeof d=="function"?d:gl(+d),c):l},c.paddingLeft=function(d){return arguments.length?(u=typeof d=="function"?d:gl(+d),c):u},c}function WV(e,t,n,i,r){var a=e.children,o,s=a.length,l,u=new Array(s+1);for(u[0]=l=o=0;o<s;++o)u[o+1]=l+=a[o].value;c(0,s,e.value,t,n,i,r);function c(f,d,h,p,g,m,v){if(f>=d-1){var y=a[f];y.x0=p,y.y0=g,y.x1=m,y.y1=v;return}for(var b=u[f],E=h/2+b,x=f+1,k=d-1;x<k;){var w=x+k>>>1;u[w]<E?x=w+1:k=w}E-u[x-1]<u[x]-E&&f+1<x&&--x;var A=u[x]-b,_=h-A;if(m-p>v-g){var O=(p*_+m*A)/h;c(f,x,A,p,g,O,v),c(x,d,_,O,g,m,v)}else{var S=(g*_+v*A)/h;c(f,x,A,p,g,m,S),c(x,d,_,p,S,m,v)}}}function GV(e,t,n,i,r){(e.depth&1?Rp:Ec)(e,t,n,i,r)}var HV=function e(t){function n(i,r,a,o,s){if((l=i._squarify)&&l.ratio===t)for(var l,u,c,f,d=-1,h,p=l.length,g=i.value;++d<p;){for(u=l[d],c=u.children,f=u.value=0,h=c.length;f<h;++f)u.value+=c[f].value;u.dice?Ec(u,r,a,o,a+=(s-a)*u.value/g):Rp(u,r,a,r+=(o-r)*u.value/g,s),g-=u.value}else i._squarify=l=KD(t,i,r,a,o,s),l.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(JD);function G1(e){$.call(this,null,e)}G1.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var YV=P(G1,$);function VV(e){return e.values}YV.transform=function(e,t){t.source||F("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),a=this.value;return(!a||i||t.changed())&&(a&&a.each(o=>{o.children&&rd(o.data)&&r.rem.push(o.data)}),this.value=a=z1({values:G(e.keys).reduce((o,s)=>(o.key(s),o),XV()).entries(r.source)},VV),n&&a.each(o=>{o.children&&(o=ke(o.data),r.add.push(o),r.source.push(o))}),P1(a,ee,ee)),r.source.root=a,r};function XV(){var e=[],t;function n(r,a){if(a>=e.length)return r;for(var o=-1,s=r.length,l=e[a++],u,c,f={},d,h={};++o<s;)u=l(c=r[o])+"",(d=f[u])?d.push(c):f[u]=[c];for(u in f)h[u]=n(f[u],a);return h}function i(r,a){if(++a>e.length)return r;var o=[],s;for(s in r)o.push({key:s,values:i(r[s],a)});return o}return t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)}}function Rr(e){$.call(this,null,e)}var JV=P(Rr,$);JV.transform=function(e,t){(!t.source||!t.source.root)&&F(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),i=this.fields,r=t.source.root,a=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(oo(e.sort,o=>o.data)),KV(n,this.params,e),n.separation&&n.separation(e.separation!==!1?ZV:Jl);try{this.value=n(r)}catch(o){F(o)}return r.each(function(o){QV(o,i,a)}),t.reflow(e.modified()).modifies(a).modifies("leaf")};function KV(e,t,n){for(var i,r=0,a=t.length;r<a;++r)i=t[r],i in n&&e[i](n[i])}function QV(e,t,n){for(var i=e.data,r=0,a=t.length-1;r<a;++r)i[n[r]]=e[t[r]];i[n[a]]=e.children?e.children.length:0}function ZV(e,t){return e.parent===t.parent?1:2}var H1=["x","y","r","depth","children"];function Y1(e){Rr.call(this,e)}Y1.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:H1.length,default:H1}]};var V1=P(Y1,Rr);V1.layout=RV,V1.params=["radius","size","padding"],V1.fields=H1;var X1=["x0","y0","x1","y1","depth","children"];function J1(e){Rr.call(this,e)}J1.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:X1.length,default:X1}]};var K1=P(J1,Rr);K1.layout=FV,K1.params=["size","round","padding"],K1.fields=X1;function Q1(e){$.call(this,null,e)}Q1.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};var eX=P(Q1,$);eX.transform=function(e,t){t.source||F("Stratify transform requires an upstream data source.");var n=this.value,i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),a=!this.value||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),a&&(r.source.length?n=P1(XD().id(e.key).parentId(e.parentKey)(r.source),e.key,Ni):n=P1(XD()([{}]),e.key,e.key)),r.source.root=this.value=n,r};var ZD={tidy:UV,cluster:oV},Z1=["x","y","depth","children"];function ew(e){Rr.call(this,e)}ew.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:Z1.length,default:Z1}]};var tw=P(ew,Rr);tw.layout=function(e){var t=e||"tidy";if(Q(ZD,t))return ZD[t]();F("Unrecognized Tree layout method: "+t)},tw.params=["size","nodeSize"],tw.fields=Z1;function nw(e){$.call(this,[],e)}nw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};var tX=P(nw,$);tX.transform=function(e,t){var n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),a={};return i||F("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,function(o){a[ee(o)]=1}),i.each(function(o){var s=o.data,l=o.parent&&o.parent.data;l&&a[ee(s)]&&a[ee(l)]&&r.add.push(ke({source:l,target:s}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,function(o){a[ee(o)]=1}),n.forEach(function(o){(a[ee(o.source)]||a[ee(o.target)])&&r.mod.push(o)})),r};var eR={binary:WV,dice:Ec,slice:Rp,slicedice:GV,squarify:QD,resquarify:HV},iw=["x0","y0","x1","y1","depth","children"];function rw(e){Rr.call(this,e)}rw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:iw.length,default:iw}]};var aw=P(rw,Rr);aw.layout=function(){var e=qV();return e.ratio=function(t){var n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=function(t){Q(eR,t)?e.tile(eR[t]):F("Unrecognized Treemap layout method: "+t)},e},aw.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],aw.fields=iw;var nX=Object.freeze({__proto__:null,nest:G1,pack:Y1,partition:J1,stratify:Q1,tree:ew,treelinks:nw,treemap:rw});function tR(e,t){var n=[],i=function(c){return c(s)},r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function ow(e){$.call(this,null,e)}ow.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};var iX=P(ow,$);iX.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=tR(i,e.groupby),a=(e.groupby||[]).map(et),o=a.length,s=e.as||[et(e.x),et(e.y)],l=[];r.forEach(u=>{gA(u,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<o;++d)f[a[d]]=u.dims[d];f[s[0]]=c[0],f[s[1]]=c[1],l.push(ke(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};const sw={linear:av,log:uA,exp:cA,pow:fA,quad:ov,poly:dA};function rX(e,t){return e==="poly"?t:e==="quad"?2:1}function lw(e){$.call(this,null,e)}lw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(sw)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};var aX=P(lw,$);aX.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=tR(i,e.groupby),a=(e.groupby||[]).map(et),o=e.method||"linear",s=e.order||3,l=rX(o,s),u=e.as||[et(e.x),et(e.y)],c=sw[o],f=[];let d=e.extent;Q(sw,o)||F("Invalid regression method: "+o),d!=null&&(o==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null)),r.forEach(h=>{const p=h.length;if(p<=l){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(h,e.x,e.y,s);if(e.params){f.push(ke({keys:h.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=d||vr(h,e.x),v=y=>{const b={};for(let E=0;E<a.length;++E)b[a[E]]=h.dims[E];b[u[0]]=y[0],b[u[1]]=y[1],f.push(ke(b))};o==="linear"?m.forEach(y=>v([y,g.predict(y)])):$d(g.predict,m,25,200).forEach(v)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n};var oX=Object.freeze({__proto__:null,loess:ow,regression:lw});const nR=Math.pow(2,-52),Fp=new Uint32Array(512);class uw{static from(e,t=fX,n=dX){const i=e.length,r=new Float64Array(i*2);for(let a=0;a<i;a++){const o=e[a];r[2*a]=t(o),r[2*a+1]=n(o)}return new uw(r)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,a=e.length>>1;let o=Infinity,s=Infinity,l=-Infinity,u=-Infinity;for(let _=0;_<a;_++){const O=e[2*_],S=e[2*_+1];O<o&&(o=O),S<s&&(s=S),O>l&&(l=O),S>u&&(u=S),this._ids[_]=_}const c=(o+l)/2,f=(s+u)/2;let d=Infinity,h,p,g;for(let _=0;_<a;_++){const O=cw(c,f,e[2*_],e[2*_+1]);O<d&&(h=_,d=O)}const m=e[2*h],v=e[2*h+1];d=Infinity;for(let _=0;_<a;_++){if(_===h)continue;const O=cw(m,v,e[2*_],e[2*_+1]);O<d&&O>0&&(p=_,d=O)}let y=e[2*p],b=e[2*p+1],E=Infinity;for(let _=0;_<a;_++){if(_===h||_===p)continue;const O=uX(m,v,y,b,e[2*_],e[2*_+1]);O<E&&(g=_,E=O)}let x=e[2*g],k=e[2*g+1];if(E===Infinity){for(let S=0;S<a;S++)this._dists[S]=e[2*S]-e[0]||e[2*S+1]-e[1];ml(this._ids,this._dists,0,a-1);const _=new Uint32Array(a);let O=0;for(let S=0,T=-Infinity;S<a;S++){const D=this._ids[S];this._dists[D]>T&&(_[O++]=D,T=this._dists[D])}this.hull=_.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Np(m,v,y,b,x,k)){const _=p,O=y,S=b;p=g,y=x,b=k,g=_,x=O,k=S}const w=cX(m,v,y,b,x,k);this._cx=w.x,this._cy=w.y;for(let _=0;_<a;_++)this._dists[_]=cw(e[2*_],e[2*_+1],w.x,w.y);ml(this._ids,this._dists,0,a-1),this._hullStart=h;let A=3;n[h]=t[g]=p,n[p]=t[h]=g,n[g]=t[p]=h,i[h]=0,i[p]=1,i[g]=2,r.fill(-1),r[this._hashKey(m,v)]=h,r[this._hashKey(y,b)]=p,r[this._hashKey(x,k)]=g,this.trianglesLen=0,this._addTriangle(h,p,g,-1,-1,-1);for(let _=0,O,S;_<this._ids.length;_++){const T=this._ids[_],D=e[2*T],M=e[2*T+1];if(_>0&&Math.abs(D-O)<=nR&&Math.abs(M-S)<=nR)continue;if(O=D,S=M,T===h||T===p||T===g)continue;let C=0;for(let xe=0,Pe=this._hashKey(D,M);xe<this._hashSize&&!(C=r[(Pe+xe)%this._hashSize],C!==-1&&C!==n[C]);xe++);C=t[C];let N=C,W;for(;W=n[N],!Np(D,M,e[2*N],e[2*N+1],e[2*W],e[2*W+1]);)if(N=W,N===C){N=-1;break}if(N===-1)continue;let X=this._addTriangle(N,T,n[N],-1,-1,i[N]);i[T]=this._legalize(X+2),i[N]=X,A++;let J=n[N];for(;W=n[J],Np(D,M,e[2*J],e[2*J+1],e[2*W],e[2*W+1]);)X=this._addTriangle(J,T,W,i[T],-1,i[J]),i[T]=this._legalize(X+2),n[J]=J,A--,J=W;if(N===C)for(;W=t[N],Np(D,M,e[2*W],e[2*W+1],e[2*N],e[2*N+1]);)X=this._addTriangle(W,T,N,-1,i[N],i[W]),this._legalize(X+2),i[W]=X,n[N]=N,A--,N=W;this._hullStart=t[T]=N,n[N]=t[J]=T,n[T]=J,r[this._hashKey(D,M)]=T,r[this._hashKey(e[2*N],e[2*N+1])]=N}this.hull=new Uint32Array(A);for(let _=0,O=this._hullStart;_<A;_++)this.hull[_]=O,O=n[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(sX(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,o===-1){if(r===0)break;e=Fp[--r];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c],g=lX(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1]);if(g){t[e]=p,t[o]=f;const m=n[c];if(m===-1){let y=this._hullStart;do{if(this._hullTri[y]===c){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,m),this._link(o,n[a]),this._link(a,c);const v=l+(o+1)%3;r<Fp.length&&(Fp[r++]=v)}else{if(r===0)break;e=Fp[--r]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,a),this.trianglesLen+=3,o}}function sX(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function cw(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}function fw(e,t,n,i,r,a){const o=(i-t)*(r-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function Np(e,t,n,i,r,a){const o=fw(r,a,e,t,n,i)||fw(e,t,n,i,r,a)||fw(n,i,r,a,e,t);return o<0}function lX(e,t,n,i,r,a,o,s){const l=e-o,u=t-s,c=n-o,f=i-s,d=r-o,h=a-s,p=l*l+u*u,g=c*c+f*f,m=d*d+h*h;return l*(f*m-g*h)-u*(c*m-g*d)+p*(c*h-f*d)<0}function uX(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function cX(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=e+(u*c-s*f)*d,p=t+(o*f-l*c)*d;return{x:h,y:p}}function ml(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const a=e[r],o=t[a];let s=r-1;for(;s>=n&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=a}else{const r=n+i>>1;let a=n+1,o=i;kc(e,r,a),t[e[n]]>t[e[i]]&&kc(e,n,i),t[e[a]]>t[e[i]]&&kc(e,a,i),t[e[n]]>t[e[a]]&&kc(e,n,a);const s=e[a],l=t[s];for(;;){do a++;while(t[e[a]]<l);do o--;while(t[e[o]]>l);if(o<a)break;kc(e,a,o)}e[n+1]=e[o],e[o]=s,i-a+1>=o-n?(ml(e,t,a,i),ml(e,t,n,o-1)):(ml(e,t,n,o-1),ml(e,t,a,i))}}function kc(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function fX(e){return e[0]}function dX(e){return e[1]}const iR=1e-6;class Mo{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const i=e+n,r=t;if(n<0)throw new Error("negative radius");if(this._x1===null?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>iR||Math.abs(this._y1-r)>iR)&&(this._+="L"+i+","+r),!n)return;this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class dw{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class hX{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d=0,h=0,p=n.length,g,m;d<p;d+=3,h+=2){const v=n[d]*2,y=n[d+1]*2,b=n[d+2]*2,E=e[v],x=e[v+1],k=e[y],w=e[y+1],A=e[b],_=e[b+1],O=k-E,S=w-x,T=A-E,D=_-x,M=O*O+S*S,C=T*T+D*D,N=(O*D-S*T)*2;if(!N)g=(E+A)/2-1e8*D,m=(x+_)/2+1e8*T;else if(Math.abs(N)<1e-8)g=(E+A)/2,m=(x+_)/2;else{const W=1/N;g=E+(D*M-S*C)*W,m=x+(O*C-T*M)*W}r[h]=g,r[h+1]=m}let a=t[t.length-1],o,s=a*4,l,u=e[2*a],c,f=e[2*a+1];i.fill(0);for(let d=0;d<t.length;++d)a=t[d],o=s,l=u,c=f,s=a*4,u=e[2*a],f=e[2*a+1],i[o+2]=i[s]=c-f,i[o+3]=i[s+1]=u-l}render(e){const t=e==null?e=new Mo():void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:a,vectors:o}=this;if(r.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const f=n[u];if(f<u)continue;const d=Math.floor(u/3)*2,h=Math.floor(f/3)*2,p=a[d],g=a[d+1],m=a[h],v=a[h+1];this._renderSegment(p,g,m,v,e)}let s,l=r[r.length-1];for(let u=0;u<r.length;++u){s=l,l=r[u];const c=Math.floor(i[l]/3)*2,f=a[c],d=a[c+1],h=s*4,p=this._project(f,d,o[h+2],o[h+3]);p&&this._renderSegment(f,d,p[0],p[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new Mo():void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=t==null?t=new Mo():void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let a=2;a<r;a+=2)(i[a]!==i[a-2]||i[a+1]!==i[a-1])&&t.lineTo(i[a],i[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new dw();return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let a;const o=this._regioncode(e,t),s=this._regioncode(n,i);o===0&&s===0?(r.moveTo(e,t),r.lineTo(n,i)):(a=this._clipSegment(e,t,n,i,o,s))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t,t!==t)||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const i=this._clip(n);if(i)e:for(let r=0,a=t.length;r<a;r+=2)for(let o=0,s=i.length;o<s;o+=2)if(t[r]==i[o]&&t[r+1]==i[o+1]&&t[(r+2)%a]==i[(o+s-2)%s]&&t[(r+3)%a]==i[(o+s-1)%s]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,a=n[e];if(a===-1)return null;const o=[];let s=a;do{const l=Math.floor(s/3);if(o.push(t[l*2],t[l*2+1]),s=s%3===2?s-2:s+1,r[s]!==e)break;s=i[s]}while(s!==a&&s!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:n}=this,i=e*4;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let i=null,r,a,o=t[n-2],s=t[n-1],l,u=this._regioncode(o,s),c,f;for(let d=0;d<n;d+=2)if(r=o,a=s,o=t[d],s=t[d+1],l=u,u=this._regioncode(o,s),l===0&&u===0)c=f,f=0,i?i.push(o,s):i=[o,s];else{let h,p,g,m,v;if(l===0){if((h=this._clipSegment(r,a,o,s,l,u))===null)continue;[p,g,m,v]=h}else{if((h=this._clipSegment(o,s,r,a,u,l))===null)continue;[m,v,p,g]=h,c=f,f=this._edgecode(p,g),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(p,g):i=[p,g]}c=f,f=this._edgecode(m,v),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(m,v):i=[m,v]}if(i)c=f,f=this._edgecode(i[0],i[1]),c&&f&&this._edge(e,c,f,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,n,i,r,a){for(;;){if(r===0&&a===0)return[e,t,n,i];if(r&a)return null;let o,s,l=r||a;l&8?(o=e+(n-e)*(this.ymax-t)/(i-t),s=this.ymax):l&4?(o=e+(n-e)*(this.ymin-t)/(i-t),s=this.ymin):l&2?(s=t+(i-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(i-t)*(this.xmin-e)/(n-e),o=this.xmin),r?(e=o,t=s,r=this._regioncode(e,t)):(n=o,i=s,a=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,a){let o=Array.from(t),s;if((s=this._project(o[0],o[1],n,i))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],r,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let l=0,u=o.length,c,f=this._edgecode(o[u-2],o[u-1]);l<u;l+=2)c=f,f=this._edgecode(o[l],o[l+1]),c&&f&&(l=this._edge(e,c,f,o,l),u=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,i,r){for(;t!==n;){let a,o;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}(i[r]!==a||i[r+1]!==o)&&this.contains(e,a,o)&&(i.splice(r,0,a,o),r+=2)}if(i.length>4)for(let a=0;a<i.length;a+=2){const o=(a+2)%i.length,s=(a+4)%i.length;(i[a]===i[o]&&i[o]===i[s]||i[a+1]===i[o+1]&&i[o+1]===i[s+1])&&(i.splice(o,2),a-=2)}return r}_project(e,t,n,i){let r=Infinity,a,o,s;if(i<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/i)<r&&(s=this.ymin,o=e+(r=a)*n)}else if(i>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/i)<r&&(s=this.ymax,o=e+(r=a)*n)}if(n>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/n)<r&&(o=this.xmax,s=t+(r=a)*i)}else if(n<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/n)<r&&(o=this.xmin,s=t+(r=a)*i)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const pX=2*Math.PI,vl=Math.pow;function gX(e){return e[0]}function mX(e){return e[1]}function vX(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],a=2*t[i+1],o=2*t[i+2],s=(n[o]-n[r])*(n[a+1]-n[r+1])-(n[a]-n[r])*(n[o+1]-n[r+1]);if(s>1e-10)return!1}return!0}function yX(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class rR{static from(e,t=gX,n=mX,i){return new rR("length"in e?bX(e,t,n,i):Float64Array.from(wX(e,t,n,i)))}constructor(e){this._delaunator=new uw(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&vX(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const s=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[t[2*s],t[2*s+1],t[2*l],t[2*l+1]],c=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let f=0,d=t.length/2;f<d;++f){const h=yX(t[2*f],t[2*f+1],c);t[2*f]=h[0],t[2*f+1]=h[1]}this._delaunator=new uw(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const u=r[s%3===2?s-2:s+1];(n[s]===-1||a[u]===-1)&&(a[u]=s)}for(let s=0,l=i.length;s<l;++s)o[i[s]]=s;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],a[i[0]]=1,i.length===2&&(a[i[1]]=0))}voronoi(e){return new hX(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:a,collinear:o}=this;if(o){const c=o.indexOf(e);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const s=t[e];if(s===-1)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3===2?l-2:l+1,a[l]!==e)return;if(l=r[l],l===-1){const c=n[(i[e]+1)%n.length];c!==u&&(yield c);return}}while(l!==s)}find(e,t,n=0){if((e=+e,e!==e)||(t=+t,t!==t))return-1;const i=n;let r;for(;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}_step(e,t,n){const{inedges:i,hull:r,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);let u=e,c=vl(t-l[e*2],2)+vl(n-l[e*2+1],2);const f=i[e];let d=f;do{let h=s[d];const p=vl(t-l[h*2],2)+vl(n-l[h*2+1],2);if(p<c&&(c=p,u=h),d=d%3===2?d-2:d+1,s[d]!==e)break;if(d=o[d],d===-1){if(d=r[(a[e]+1)%r.length],d!==h&&vl(t-l[d*2],2)+vl(n-l[d*2+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=e==null?e=new Mo():void 0,{points:n,halfedges:i,triangles:r}=this;for(let a=0,o=i.length;a<o;++a){const s=i[a];if(s<a)continue;const l=r[a]*2,u=r[s]*2;e.moveTo(n[l],n[l+1]),e.lineTo(n[u],n[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=e==null?e=new Mo():void 0,{points:i}=this;for(let r=0,a=i.length;r<a;r+=2){const o=i[r],s=i[r+1];e.moveTo(o+t,s),e.arc(o,s,t,0,pX)}return n&&n.value()}renderHull(e){const t=e==null?e=new Mo():void 0,{hull:n,points:i}=this,r=n[0]*2,a=n.length;e.moveTo(i[r],i[r+1]);for(let o=1;o<a;++o){const s=2*n[o];e.lineTo(i[s],i[s+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new dw();return this.renderHull(e),e.value()}renderTriangle(e,t){const n=t==null?t=new Mo():void 0,{points:i,triangles:r}=this,a=r[e*=3]*2,o=r[e+1]*2,s=r[e+2]*2;return t.moveTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.lineTo(i[s],i[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new dw();return this.renderTriangle(e,t),t.value()}}function bX(e,t,n,i){const r=e.length,a=new Float64Array(r*2);for(let o=0;o<r;++o){const s=e[o];a[o*2]=t.call(i,s,o,e),a[o*2+1]=n.call(i,s,o,e)}return a}function*wX(e,t,n,i){let r=0;for(const a of e)yield t.call(i,a,r,e),yield n.call(i,a,r,e),++r}function hw(e){$.call(this,null,e)}hw.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const xX=P(hw,$),EX=[-1e5,-1e5,1e5,1e5];xX.transform=function(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:EX;const a=this.value=rR.from(i,e.x,e.y).voronoi(r);for(let o=0,s=i.length;o<s;++o){const l=a.cellPolygon(o);i[o][n]=l?kX(l):null}return t.reflow(e.modified()).modifies(n)};function kX(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}var _X=Object.freeze({__proto__:null,voronoi:hw}),pw=Math.PI/180,_c=1<<11>>5,Ip=1<<11;function AX(){var e=[256,256],t,n,i,r,a,o,s,l=aR,u=[],c=Math.random,f={};f.layout=function(){for(var p=d(Ou()),g=DX((e[0]>>5)*e[1]),m=null,v=u.length,y=-1,b=[],E=u.map(function(k){return{text:t(k),font:n(k),style:r(k),weight:a(k),rotate:o(k),size:~~(i(k)+1e-14),padding:s(k),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:k}}).sort(function(k,w){return w.size-k.size});++y<v;){var x=E[y];x.x=e[0]*(c()+.5)>>1,x.y=e[1]*(c()+.5)>>1,SX(p,x,E,y),x.hasText&&h(g,x,m)&&(b.push(x),m?TX(m,x):m=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return b};function d(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(_c<<5)/g,p.height=Ip/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function h(p,g,m){for(var v=g.x,y=g.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),E=l(e),x=c()<.5?1:-1,k=-x,w,A,_;(w=E(k+=x))&&!(A=~~w[0],_=~~w[1],Math.min(Math.abs(A),Math.abs(_))>=b);){if(g.x=v+A,g.y=y+_,g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])continue;if((!m||!OX(g,p,e[0]))&&(!m||CX(g,m))){for(var O=g.sprite,S=g.width>>5,T=e[0]>>5,D=g.x-(S<<4),M=D&127,C=32-M,N=g.y1-g.y0,W=(g.y+g.y0)*T+(D>>5),X,J=0;J<N;J++){X=0;for(var xe=0;xe<=S;xe++)p[W+xe]|=X<<C|(xe<S?(X=O[J*S+xe])>>>M:0);W+=T}return g.sprite=null,!0}}return!1}return f.words=function(p){return arguments.length?(u=p,f):u},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=jo(p),f):n},f.fontStyle=function(p){return arguments.length?(r=jo(p),f):r},f.fontWeight=function(p){return arguments.length?(a=jo(p),f):a},f.rotate=function(p){return arguments.length?(o=jo(p),f):o},f.text=function(p){return arguments.length?(t=jo(p),f):t},f.spiral=function(p){return arguments.length?(l=RX[p]||p,f):l},f.fontSize=function(p){return arguments.length?(i=jo(p),f):i},f.padding=function(p){return arguments.length?(s=jo(p),f):s},f.random=function(p){return arguments.length?(c=p,f):c},f}function SX(e,t,n,i){if(t.sprite)return;var r=e.context,a=e.ratio;r.clearRect(0,0,(_c<<5)/a,Ip/a);var o=0,s=0,l=0,u=n.length,c,f,d,h,p;for(--i;++i<u;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,c=r.measureText(t.text+"m").width*a,d=t.size<<1,t.rotate){var g=Math.sin(t.rotate*pw),m=Math.cos(t.rotate*pw),v=c*m,y=c*g,b=d*m,E=d*g;c=Math.max(Math.abs(v+E),Math.abs(v-E))+31>>5<<5,d=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else c=c+31>>5<<5;if(d>l&&(l=d),o+c>=_c<<5&&(o=0,s+=l,l=0),s+d>=Ip)break;r.translate((o+(c>>1))/a,(s+(d>>1))/a),t.rotate&&r.rotate(t.rotate*pw),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var x=r.getImageData(0,0,(_c<<5)/a,Ip/a).data,k=[];--i>=0;){if(t=n[i],!t.hasText)continue;for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)k[h]=0;if(o=t.xoff,o==null)return;s=t.yoff;var w=0,A=-1;for(p=0;p<d;p++){for(h=0;h<c;h++){var _=f*p+(h>>5),O=x[(s+p)*(_c<<5)+(o+h)<<2]?1<<31-h%32:0;k[_]|=O,w|=O}w?A=p:(t.y0++,d--,p--,s++)}t.y1=t.y0+A,t.sprite=k.slice(0,(t.y1-t.y0)*f)}}function OX(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,a=e.x-(r<<4),o=a&127,s=32-o,l=e.y1-e.y0,u=(e.y+e.y0)*n+(a>>5),c,f=0;f<l;f++){c=0;for(var d=0;d<=r;d++)if((c<<s|(d<r?(c=i[f*r+d])>>>o:0))&t[u+d])return!0;u+=n}return!1}function TX(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function CX(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function aR(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function $X(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function DX(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function jo(e){return typeof e=="function"?e:function(){return e}}var RX={archimedean:aR,rectangular:$X},oR=["x","y","font","fontSize","fontStyle","fontWeight","angle"],FX=["text","font","rotate","fontSize","fontStyle","fontWeight"];function gw(e){$.call(this,AX(),e)}gw.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:oR}]};var NX=P(gw,$);NX.transform=function(e,t){e.size&&!(e.size[0]&&e.size[1])&&F("Wordcloud size dimensions must be non-zero.");function n(b){var E=e[b];return ge(E)&&t.modified(E.fields)}var i=e.modified();if(!(i||t.changed(t.ADD_REM)||FX.some(n)))return;var r=t.materialize(t.SOURCE).source,a=this.value,o=e.as||oR,s=e.fontSize||14,l;if(ge(s)?l=e.fontSizeRange:s=Vt(s),l){var u=s,c=Ee("sqrt")().domain(vr(r,u)).range(l);s=function(b){return c(u(b))}}r.forEach(function(b){b[o[0]]=NaN,b[o[1]]=NaN,b[o[3]]=0});for(var f=a.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(Wn).layout(),d=a.size(),h=d[0]>>1,p=d[1]>>1,g=0,m=f.length,v,y;g<m;++g)v=f[g],y=v.datum,y[o[0]]=v.x+h,y[o[1]]=v.y+p,y[o[2]]=v.font,y[o[3]]=v.size,y[o[4]]=v.style,y[o[5]]=v.weight,y[o[6]]=v.rotate;return t.reflow(i).modifies(o)};var IX=Object.freeze({__proto__:null,wordcloud:gw});function MX(e){return new Uint8Array(e)}function jX(e){return new Uint16Array(e)}function Ac(e){return new Uint32Array(e)}function LX(){var e=8,t=[],n=Ac(0),i=Mp(0,e),r=Mp(0,e);return{data:function(){return t},seen:function(){return n=PX(n,t.length)},add:function(a){for(var o=0,s=t.length,l=a.length,u;o<l;++o)u=a[o],u._index=s++,t.push(u)},remove:function(a,o){var s=t.length,l=Array(s-a),u=t,c,f,d;for(f=0;!o[f]&&f<s;++f)l[f]=t[f],u[f]=f;for(d=f;f<s;++f)c=t[f],o[f]?u[f]=-1:(u[f]=d,i[d]=i[f],r[d]=r[f],l[d]=c,c._index=d++),i[f]=0;return t=l,u},size:function(){return t.length},curr:function(){return i},prev:function(){return r},reset:function(a){r[a]=i[a]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(a,o){i[a]|=o},clear:function(a,o){i[a]&=~o},resize:function(a,o){var s=i.length;(a>s||o>e)&&(e=Math.max(o,e),i=Mp(a,e,i),r=Mp(a,e))}}}function PX(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function Mp(e,t,n){var i=(t<257?MX:t<65537?jX:Ac)(e);return n&&i.set(n),i}function sR(e,t,n){var i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(r,a){var o=this,s=o.bisect(o.range,r.value),l=r.index,u=s[0],c=s[1],f=l.length,d;for(d=0;d<u;++d)a[l[d]]|=i;for(d=c;d<f;++d)a[l[d]]|=i;return o}}}function lR(){var e=Ac(0),t=[],n=0;function i(s,l,u){if(!l.length)return[];var c=n,f=l.length,d=Array(f),h=Ac(f),p,g,m;for(m=0;m<f;++m)d[m]=s(l[m]),h[m]=m;if(d=zX(d,h),c)p=t,g=e,t=Array(c+f),e=Ac(c+f),BX(u,p,g,c,d,h,f,t,e);else{if(u>0)for(m=0;m<f;++m)h[m]+=u;t=d,e=h}return n=c+f,{index:h,value:d}}function r(s,l){var u=n,c,f,d;for(f=0;!l[e[f]]&&f<u;++f);for(d=f;f<u;++f)l[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=u-s}function a(s){for(var l=0,u=n;l<u;++l)e[l]=s[e[l]]}function o(s,l){var u;return l?u=l.length:(l=t,u=n),[B5(l,s[0],0,u),Zr(l,s[1],0,u)]}return{insert:i,remove:r,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function zX(e,t){return e.sort.call(t,function(n,i){var r=e[n],a=e[i];return r<a?-1:r>a?1:0}),V5(e,t)}function BX(e,t,n,i,r,a,o,s,l){var u=0,c=0,f;for(f=0;u<i&&c<o;++f)t[u]<r[c]?(s[f]=t[u],l[f]=n[u++]):(s[f]=r[c],l[f]=a[c++]+e);for(;u<i;++u,++f)s[f]=t[u],l[f]=n[u];for(;c<o;++c,++f)s[f]=r[c],l[f]=a[c]+e}function mw(e){$.call(this,LX(),e),this._indices=null,this._dims=null}mw.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var wi=P(mw,$);wi.transform=function(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(function(i){return t.modified(i.fields)});return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},wi.init=function(e,t){for(var n=e.fields,i=e.query,r=this._indices={},a=this._dims=[],o=i.length,s=0,l,u;s<o;++s)l=n[s].fname,u=r[l]||(r[l]=lR()),a.push(sR(u,s,i[s]));return this.eval(e,t)},wi.reinit=function(e,t){var n=t.materialize().fork(),i=e.fields,r=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=r.length,p={},g,m,v,y,b,E,x,k,w;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(E={},y=t.mod,x=0,k=y.length;x<k;++x)E[y[x]._index]=1;for(x=0;x<h;++x)w=i[x],(!o[x]||e.modified("fields",x)||t.modified(w.fields))&&(v=w.fname,(g=p[v])||(a[v]=m=lR(),p[v]=g=m.insert(w,t.source,0)),o[x]=sR(m,x,r[x]).onAdd(g,l));for(x=0,k=s.data().length;x<k;++x){if(b[x])continue;u[x]!==l[x]?f.push(x):E[x]&&l[x]!==c&&d.push(x)}return s.mask=(1<<h)-1,n},wi.eval=function(e,t){var n=t.materialize().fork(),i=this._dims.length,r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},wi.insert=function(e,t,n){var i=t.add,r=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=r.size(),f=c+i.length,d=a.length,h,p,g;r.resize(f,d),r.add(i);var m=r.curr(),v=r.prev(),y=r.all();for(h=0;h<d;++h)p=s[h].fname,g=l[p]||(l[p]=o[p].insert(s[h],i,c)),a[h].onAdd(g,m);for(;c<f;++c)v[c]=y,m[c]!==y&&u.push(c)},wi.modify=function(e,t){var n=t.mod,i=this.value,r=i.curr(),a=i.all(),o=e.mod,s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,r[u]!==a&&n.push(u)},wi.remove=function(e,t,n){var i=this._indices,r=this.value,a=r.curr(),o=r.prev(),s=r.all(),l={},u=n.rem,c=t.rem,f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in i)i[h].remove(d,l);return this.reindex(t,d,l),l},wi.reindex=function(e,t,n){var i=this._indices,r=this.value;e.runAfter(function(){var a=r.remove(t,n);for(var o in i)i[o].reindex(a)})},wi.update=function(e,t,n){var i=this._dims,r=e.query,a=t.stamp,o=i.length,s=0,l,u;for(n.filters=0,u=0;u<o;++u)e.modified("query",u)&&(l=u,++s);if(s===1)s=i[l].one,this.incrementOne(i[l],r[l],n.add,n.rem);else for(u=0,s=0;u<o;++u){if(!e.modified("query",u))continue;s|=i[u].one,this.incrementAll(i[u],r[u],a,n.add),n.rem=n.add}return s},wi.incrementAll=function(e,t,n,i){var r=this.value,a=r.seen(),o=r.curr(),s=r.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],g=e.one,m,v,y;if(f<h)for(m=f,v=Math.min(h,d);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(f>h)for(m=h,v=Math.min(f,p);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;if(d>p)for(m=Math.max(f,p),v=d;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(d<p)for(m=Math.max(h,d),v=p;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;e.range=t.slice()},wi.incrementOne=function(e,t,n,i){var r=this.value,a=r.curr(),o=e.index(),s=e.bisect(e.range),l=e.bisect(t),u=l[0],c=l[1],f=s[0],d=s[1],h=e.one,p,g,m;if(u<f)for(p=u,g=Math.min(f,c);p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(u>f)for(p=f,g=Math.min(u,d);p<g;++p)m=o[p],a[m]^=h,i.push(m);if(c>d)for(p=Math.max(u,d),g=c;p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(c<d)for(p=Math.max(f,c),g=d;p<g;++p)m=o[p],a[m]^=h,i.push(m);e.range=t.slice()};function vw(e){$.call(this,null,e)}vw.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var UX=P(vw,$);UX.transform=function(e,t){var n=~(e.ignore||0),i=e.filter,r=i.mask;if((r&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=i.data(),s=i.curr(),l=i.prev(),u=function(c){return s[c]&n?null:o[c]};return a.filter(a.MOD,u),r&r-1?(a.filter(a.ADD,function(c){var f=s[c]&n,d=!f&&f^l[c]&n;return d?o[c]:null}),a.filter(a.REM,function(c){var f=s[c]&n,d=f&&!(f^(f^l[c]&n));return d?o[c]:null})):(a.filter(a.ADD,u),a.filter(a.REM,function(c){return(s[c]&n)===r?o[c]:null})),a.filter(a.SOURCE,function(c){return u(c._index)})};var qX=Object.freeze({__proto__:null,crossfilter:mw,resolvefilter:vw});const WX="5.13.0";function GX(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),uR(t,e.description()))}function uR(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function HX(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const yw="default";function YX(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:yw,item:null}));e.on(e.events("view","mousemove"),t,function(n,i){const r=t.value,a=r?Y(r)?r:r.user:yw,o=i.item&&i.item.cursor||null;return r&&a===r.user&&o==r.item?r:{user:a,item:o}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),bw(e,i&&i!==yw?i:r||i),r},{cursor:t})}function bw(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function jp(e,t){var n=e._runtime.data;return Q(n,t)||F("Unrecognized data set: "+t),n[t]}function VX(e,t){return arguments.length<2?jp(this,e).values.value:Lp.call(this,e,so().remove(Ni).insert(t))}function Lp(e,t){bk(t)||F("Second argument to changes must be a changeset.");var n=jp(this,e);return n.modified=!0,this.pulse(n.input,t)}function XX(e,t){return Lp.call(this,e,so().insert(t))}function JX(e,t){return Lp.call(this,e,so().remove(t))}function cR(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function fR(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Pp(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function KX(e){var t=Pp(e),n=cR(e),i=fR(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(function(r){try{r(n,i)}catch(a){e.error(a)}})}function QX(e,t,n){var i=e._renderer,r=i&&i.canvas(),a,o,s;return r&&(s=Pp(e),o=t.changedTouches?t.changedTouches[0]:t,a=lh(o,r),a[0]-=s[0],a[1]-=s[1]),t.dataflow=e,t.item=n,t.vega=ZX(e,n,a),t}function ZX(e,t,n){var i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(o){var s=i,l;if(o){for(l=t;l;l=l.mark.group)if(l.mark.name===o){s=l;break}}return s&&s.mark&&s.mark.interactive?s:{}}function a(o){if(!o)return n;Y(o)&&(o=r(o));for(var s=n.slice();o;)s[0]-=o.x||0,s[1]-=o.y||0,o=o.mark&&o.mark.group;return s}return{view:Vt(e),item:Vt(t||{}),group:r,xy:a,x:function(o){return a(o)[0]},y:function(o){return a(o)[1]}}}const dR="view",eJ="timer",tJ="window",nJ={trap:!1};function iJ(e){const t=fe({defaults:{}},e),n=(i,r)=>{r.forEach(a=>{I(i[a])&&(i[a]=kt(i[a]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function rJ(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function zp(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||K(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function aJ(e,t,n){var i=this,r=new sd(n),a=function(u,c){i.runAsync(null,()=>{e===dR&&rJ(i,t)&&u.preventDefault(),r.receive(QX(i,u,c))})},o;if(e===eJ)zp(i,"timer",t)&&i.timer(a,t);else if(e===dR)zp(i,"view",t)&&i.addEventListener(t,a,nJ);else if(e===tJ?zp(i,"window",t)&&typeof window!="undefined"&&(o=[window]):typeof document!="undefined"&&(zp(i,"selector",t)&&(o=document.querySelectorAll(e))),!o)i.warn("Can not resolve event source: "+e);else{for(var s=0,l=o.length;s<l;++s)o[s].addEventListener(t,a);i._eventListeners.push({type:t,sources:o,handler:a})}return r}function hR(e){return e.item}function pR(e){return e.item.mark.source}function gR(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function oJ(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",hR),pR,gR(e)),this.on(this.events("view","mouseout",hR),pR,gR(t)),this}function sJ(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,a;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(a=n[i],r=a.sources.length;--r>=0;)a.sources[r].removeEventListener(a.type,a.handler);return e&&e.call(this,this._handler,null,null,null),this}function Pn(e,t,n){var i=document.createElement(e);for(var r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const lJ="vega-bind",uJ="vega-bind-name",cJ="vega-bind-radio";function fJ(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:a=>{a!==e.signal(i.signal)&&e.runAsync(null,function(){r.source=!0,e.signal(i.signal,a)})}},i.debounce&&(r.update=fk(i.debounce,r.update))),dJ(r,t,i,e.signal(i.signal)),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function dJ(e,t,n,i){const r=Pn("div",{class:lJ}),a=n.input==="radio"?r:r.appendChild(Pn("label"));a.appendChild(Pn("span",{class:uJ},n.name||n.signal)),t.appendChild(r);let o=hJ;switch(n.input){case"checkbox":o=pJ;break;case"select":o=gJ;break;case"radio":o=mJ;break;case"range":o=vJ;break}o(e,a,n,i)}function hJ(e,t,n,i){const r=Pn("input");for(const a in n)a!=="signal"&&a!=="element"&&r.setAttribute(a==="input"?"type":a,n[a]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=a=>r.value=a}function pJ(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const a=Pn("input",r);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=o=>a.checked=!!o||null}function gJ(e,t,n,i){const r=Pn("select",{name:n.signal}),a=n.labels||[];n.options.forEach((o,s)=>{const l={value:o};Bp(o,i)&&(l.selected=!0),r.appendChild(Pn("option",l,(a[s]||o)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=o=>{for(let s=0,l=n.options.length;s<l;++s)if(Bp(n.options[s],o)){r.selectedIndex=s;return}}}function mJ(e,t,n,i){const r=Pn("span",{class:cJ}),a=n.labels||[];t.appendChild(r),e.elements=n.options.map((o,s)=>{const l={type:"radio",name:n.signal,value:o};Bp(o,i)&&(l.checked=!0);const u=Pn("input",l);u.addEventListener("change",()=>e.update(o));const c=Pn("label",{},(a[s]||o)+"");return c.prepend(u),r.appendChild(c),u}),e.set=o=>{const s=e.elements,l=s.length;for(let u=0;u<l;++u)Bp(s[u].value,o)&&(s[u].checked=!0)}}function vJ(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,o=n.step||ea(a,r,100),s=Pn("input",{type:"range",name:n.signal,min:a,max:r,step:o});s.value=i;const l=Pn("span",{},+i);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=c=>{s.value=c,l.textContent=c}}function Bp(e,t){return e===t||e+""===t+""}function mR(e,t,n,i,r,a){return t=t||new i(e.loader()),t.initialize(n,cR(e),fR(e),Pp(e),r,a).background(e.background())}function ww(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function yJ(e,t,n,i){var r=new i(e.loader(),ww(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Pp(e),e);return t&&t.handlers().forEach(function(a){r.on(a.type,a.handler)}),r}function bJ(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,a=jh(i);e=n._el=e?xw(n,e):null,GX(n),a||n.error("Unrecognized renderer type: "+i);const o=a.handler||Iu,s=e?a.renderer:a.headless;return n._renderer=s?mR(n,n._renderer,e,s):null,n._handler=yJ(n,n._handler,e,o),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=xw(n,t):e.appendChild(Pn("form",{class:"vega-bindings"})),n._bind.forEach(function(l){l.param.element&&r!=="container"&&(l.element=xw(n,l.param.element))}),n._bind.forEach(function(l){fJ(n,l.element||t,l)})),n}function xw(e,t){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const Sc=e=>+e||0,wJ=e=>({top:e,bottom:e,left:e,right:e});function vR(e){return K(e)?{top:Sc(e.top),bottom:Sc(e.bottom),left:Sc(e.left),right:Sc(e.right)}:wJ(Sc(e))}async function Ew(e,t,n,i){const r=jh(t),a=r&&r.headless;return a||F("Unrecognized renderer type: "+t),await e.runAsync(),mR(e,null,null,a,n,i).renderAsync(e._scenegraph.root)}async function xJ(e,t){e!==wa.Canvas&&e!==wa.SVG&&e!==wa.PNG&&F("Unrecognized image type: "+e);const n=await Ew(this,e,t);return e===wa.SVG?EJ(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function EJ(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function kJ(e,t){const n=await Ew(this,wa.Canvas,e,t);return n.canvas()}async function _J(e){const t=await Ew(this,wa.SVG,e);return t.svg()}function yR(e){const t=this.context.data[e];return t?t.values.value:[]}function AJ(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function SJ(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Ni).insert(t)),1}function OJ(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const Oc=e=>function(t,n){const i=this.context.dataflow.locale();return i[e](n)(t)},TJ=Oc("format"),bR=Oc("timeFormat"),CJ=Oc("utcFormat"),$J=Oc("timeParse"),DJ=Oc("utcParse");var Up=new Date(2e3,0,1);function qp(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Up.setYear(2e3),Up.setMonth(e),Up.setDate(t),bR.call(this,Up,n))}function RJ(e){return qp.call(this,e,1,"%B")}function FJ(e){return qp.call(this,e,1,"%b")}function NJ(e){return qp.call(this,0,2+e,"%A")}function IJ(e){return qp.call(this,0,2+e,"%a")}const MJ=":",jJ="@",kw="%",wR="$";var LJ="RawCode",Lo="Literal",PJ="Property",zJ="Identifier",BJ="ArrayExpression",UJ="BinaryExpression",xR="CallExpression",qJ="ConditionalExpression",WJ="LogicalExpression",GJ="MemberExpression",HJ="ObjectExpression",YJ="UnaryExpression";function xi(e){this.type=e}xi.prototype.visit=function(e){var t=this,n,i,r;if(e(t))return 1;for(n=VJ(t),i=0,r=n.length;i<r;++i)if(n[i].visit(e))return 1};function VJ(e){switch(e.type){case BJ:return e.elements;case UJ:case WJ:return[e.left,e.right];case xR:var t=e.arguments.slice();return t.unshift(e.callee),t;case qJ:return[e.test,e.consequent,e.alternate];case GJ:return[e.object,e.property];case HJ:return e.properties;case PJ:return[e.key,e.value];case YJ:return[e.argument];case zJ:case Lo:case LJ:default:return[]}}var Ji,V,R,zt,Te,Wp=1,Tc=2,Po=3,ka=4,Gp=5,zo=6,xn=7,Cc=8,XJ=9;Ji={},Ji[Wp]="Boolean",Ji[Tc]="<end>",Ji[Po]="Identifier",Ji[ka]="Keyword",Ji[Gp]="Null",Ji[zo]="Numeric",Ji[xn]="Punctuator",Ji[Cc]="String",Ji[XJ]="RegularExpression";var JJ="ArrayExpression",KJ="BinaryExpression",QJ="CallExpression",ZJ="ConditionalExpression",ER="Identifier",eK="Literal",tK="LogicalExpression",nK="MemberExpression",iK="ObjectExpression",rK="Property",aK="UnaryExpression",$t="Unexpected token %0",oK="Unexpected number",sK="Unexpected string",lK="Unexpected identifier",uK="Unexpected reserved word",cK="Unexpected end of input",_w="Invalid regular expression",Aw="Invalid regular expression: missing /",kR="Octal literals are not allowed in strict mode.",fK="Duplicate data property in object literal not allowed in strict mode",Bt="ILLEGAL",$c="Disabled.",dK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),hK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Hp(e,t){if(!e)throw new Error("ASSERT: "+t)}function Fr(e){return e>=48&&e<=57}function Sw(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Dc(e){return"01234567".indexOf(e)>=0}function pK(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Rc(e){return e===10||e===13||e===8232||e===8233}function Fc(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&dK.test(String.fromCharCode(e))}function Yp(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&hK.test(String.fromCharCode(e))}var gK={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function _R(){for(var e;R<zt&&(e=V.charCodeAt(R),pK(e)||Rc(e));)++R}function Ow(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)R<zt&&Sw(V[R])?(i=V[R++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):_e({},$t,Bt);return String.fromCharCode(r)}function mK(){var e,t,n,i;for(e=V[R],t=0,e==="}"&&_e({},$t,Bt);R<zt&&!(e=V[R++],!Sw(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&_e({},$t,Bt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function AR(){var e,t;for(e=V.charCodeAt(R++),t=String.fromCharCode(e),e===92&&(V.charCodeAt(R)!==117&&_e({},$t,Bt),++R,e=Ow("u"),(!e||e==="\\"||!Fc(e.charCodeAt(0)))&&_e({},$t,Bt),t=e);R<zt&&!(e=V.charCodeAt(R),!Yp(e));)++R,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),V.charCodeAt(R)!==117&&_e({},$t,Bt),++R,e=Ow("u"),(!e||e==="\\"||!Yp(e.charCodeAt(0)))&&_e({},$t,Bt),t+=e);return t}function vK(){var e,t;for(e=R++;R<zt;){if(t=V.charCodeAt(R),t===92)return R=e,AR();if(Yp(t))++R;else break}return V.slice(e,R)}function yK(){var e,t,n;return e=R,t=V.charCodeAt(R)===92?AR():vK(),t.length===1?n=Po:gK.hasOwnProperty(t)?n=ka:t==="null"?n=Gp:t==="true"||t==="false"?n=Wp:n=Po,{type:n,value:t,start:e,end:R}}function Tw(){var e=R,t=V.charCodeAt(R),n,i=V[R],r,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++R,{type:xn,value:String.fromCharCode(t),start:e,end:R};default:if(n=V.charCodeAt(R+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return R+=2,{type:xn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:R};case 33:case 61:return R+=2,V.charCodeAt(R)===61&&++R,{type:xn,value:V.slice(e,R),start:e,end:R}}}if(o=V.substr(R,4),o===">>>=")return R+=4,{type:xn,value:o,start:e,end:R};if(a=o.substr(0,3),a===">>>"||a==="<<="||a===">>=")return R+=3,{type:xn,value:a,start:e,end:R};if(r=a.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return R+=2,{type:xn,value:r,start:e,end:R};if("<>=!+-*%&|^/".indexOf(i)>=0)return++R,{type:xn,value:i,start:e,end:R};_e({},$t,Bt)}function bK(e){for(var t="";R<zt&&Sw(V[R]);)t+=V[R++];return t.length===0&&_e({},$t,Bt),Fc(V.charCodeAt(R))&&_e({},$t,Bt),{type:zo,value:parseInt("0x"+t,16),start:e,end:R}}function wK(e){for(var t="0"+V[R++];R<zt&&Dc(V[R]);)t+=V[R++];return(Fc(V.charCodeAt(R))||Fr(V.charCodeAt(R)))&&_e({},$t,Bt),{type:zo,value:parseInt(t,8),octal:!0,start:e,end:R}}function SR(){var e,t,n;if(n=V[R],Hp(Fr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=R,e="",n!=="."){if(e=V[R++],n=V[R],e==="0"){if(n==="x"||n==="X")return++R,bK(t);if(Dc(n))return wK(t);n&&Fr(n.charCodeAt(0))&&_e({},$t,Bt)}for(;Fr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="."){for(e+=V[R++];Fr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="e"||n==="E")if(e+=V[R++],n=V[R],(n==="+"||n==="-")&&(e+=V[R++]),Fr(V.charCodeAt(R)))for(;Fr(V.charCodeAt(R));)e+=V[R++];else _e({},$t,Bt);return Fc(V.charCodeAt(R))&&_e({},$t,Bt),{type:zo,value:parseFloat(e),start:t,end:R}}function xK(){var e="",t,n,i,r,a=!1;for(t=V[R],Hp(t==="'"||t==='"',"String literal must starts with a quote"),n=R,++R;R<zt;)if(i=V[R++],i===t){t="";break}else if(i==="\\")if(i=V[R++],!i||!Rc(i.charCodeAt(0)))switch(i){case"u":case"x":V[R]==="{"?(++R,e+=mK()):e+=Ow(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Dc(i)?(r="01234567".indexOf(i),r!==0&&(a=!0),R<zt&&Dc(V[R])&&(a=!0,r=r*8+"01234567".indexOf(V[R++]),"0123".indexOf(i)>=0&&R<zt&&Dc(V[R])&&(r=r*8+"01234567".indexOf(V[R++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&V[R]===`
`&&++R;else{if(Rc(i.charCodeAt(0)))break;e+=i}return t!==""&&_e({},$t,Bt),{type:Cc,value:e,octal:a,start:n,end:R}}function EK(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(i,r){if(parseInt(r,16)<=1114111)return"x";_e({},_w)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){_e({},_w)}try{return new RegExp(e,t)}catch(i){return null}}function kK(){var e,t,n,i,r;for(e=V[R],Hp(e==="/","Regular expression literal must start with a slash"),t=V[R++],n=!1,i=!1;R<zt;)if(e=V[R++],t+=e,e==="\\")e=V[R++],Rc(e.charCodeAt(0))&&_e({},Aw),t+=e;else if(Rc(e.charCodeAt(0)))_e({},Aw);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||_e({},Aw),r=t.substr(1,t.length-2),{value:r,literal:t}}function _K(){var e,t,n;for(t="",n="";R<zt&&!(e=V[R],!Yp(e.charCodeAt(0)));)++R,e==="\\"&&R<zt?_e({},$t,Bt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_e({},_w,n),{value:n,literal:t}}function AK(){var e,t,n,i;return Te=null,_R(),e=R,t=kK(),n=_K(),i=EK(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:R}}function SK(e){return e.type===Po||e.type===ka||e.type===Wp||e.type===Gp}function OR(){var e;return _R(),R>=zt?{type:Tc,start:R,end:R}:(e=V.charCodeAt(R),Fc(e)?yK():e===40||e===41||e===59?Tw():e===39||e===34?xK():e===46?Fr(V.charCodeAt(R+1))?SR():Tw():Fr(e)?SR():Tw())}function En(){var e;return e=Te,R=e.end,Te=OR(),R=e.end,e}function TR(){var e;e=R,Te=OR(),R=e}function OK(e){var t=new xi(JJ);return t.elements=e,t}function CR(e,t,n){var i=new xi(e==="||"||e==="&&"?tK:KJ);return i.operator=e,i.left=t,i.right=n,i}function TK(e,t){var n=new xi(QJ);return n.callee=e,n.arguments=t,n}function CK(e,t,n){var i=new xi(ZJ);return i.test=e,i.consequent=t,i.alternate=n,i}function Cw(e){var t=new xi(ER);return t.name=e,t}function Nc(e){var t=new xi(eK);return t.value=e.value,t.raw=V.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function $R(e,t,n){var i=new xi(nK);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function $K(e){var t=new xi(iK);return t.properties=e,t}function DR(e,t,n){var i=new xi(rK);return i.key=t,i.value=n,i.kind=e,i}function DK(e,t){var n=new xi(aK);return n.operator=e,n.argument=t,n.prefix=!0,n}function _e(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,function(a,o){return Hp(o<i.length,"Message reference must be in range"),i[o]});throw n=new Error(r),n.index=R,n.description=r,n}function Vp(e){e.type===Tc&&_e(e,cK),e.type===zo&&_e(e,oK),e.type===Cc&&_e(e,sK),e.type===Po&&_e(e,lK),e.type===ka&&_e(e,uK),_e(e,$t,e.value)}function Ut(e){var t=En();(t.type!==xn||t.value!==e)&&Vp(t)}function Le(e){return Te.type===xn&&Te.value===e}function $w(e){return Te.type===ka&&Te.value===e}function RK(){var e=[];for(R=Te.start,Ut("[");!Le("]");)Le(",")?(En(),e.push(null)):(e.push(Bo()),Le("]")||Ut(","));return En(),OK(e)}function RR(){var e;return R=Te.start,e=En(),e.type===Cc||e.type===zo?(e.octal&&_e(e,kR),Nc(e)):Cw(e.value)}function FK(){var e,t,n,i;if(R=Te.start,e=Te,e.type===Po)return n=RR(),Ut(":"),i=Bo(),DR("init",n,i);if(e.type===Tc||e.type===xn)Vp(e);else return t=RR(),Ut(":"),i=Bo(),DR("init",t,i)}function NK(){var e=[],t,n,i,r={},a=String;for(R=Te.start,Ut("{");!Le("}");)t=FK(),t.key.type===ER?n=t.key.name:n=a(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?_e({},fK):r[i]=!0,e.push(t),Le("}")||Ut(",");return Ut("}"),$K(e)}function IK(){var e;return Ut("("),e=Dw(),Ut(")"),e}var MK={if:1};function jK(){var e,t,n;if(Le("("))return IK();if(Le("["))return RK();if(Le("{"))return NK();if(e=Te.type,R=Te.start,e===Po||MK[Te.value])n=Cw(En().value);else if(e===Cc||e===zo)Te.octal&&_e(Te,kR),n=Nc(En());else{if(e===ka)throw new Error($c);e===Wp?(t=En(),t.value=t.value==="true",n=Nc(t)):e===Gp?(t=En(),t.value=null,n=Nc(t)):Le("/")||Le("/=")?(n=Nc(AK()),TR()):Vp(En())}return n}function LK(){var e=[];if(Ut("("),!Le(")"))for(;R<zt&&!(e.push(Bo()),Le(")"));)Ut(",");return Ut(")"),e}function PK(){var e;return R=Te.start,e=En(),SK(e)||Vp(e),Cw(e.value)}function zK(){return Ut("."),PK()}function BK(){var e;return Ut("["),e=Dw(),Ut("]"),e}function UK(){var e,t,n;for(e=jK();;)if(Le("."))n=zK(),e=$R(".",e,n);else if(Le("("))t=LK(),e=TK(e,t);else if(Le("["))n=BK(),e=$R("[",e,n);else break;return e}function FR(){var e=UK();if(Te.type===xn&&(Le("++")||Le("--")))throw new Error($c);return e}function Xp(){var e,t;if(Te.type!==xn&&Te.type!==ka)t=FR();else{if(Le("++")||Le("--"))throw new Error($c);if(Le("+")||Le("-")||Le("~")||Le("!"))e=En(),t=Xp(),t=DK(e.value,t);else{if($w("delete")||$w("void")||$w("typeof"))throw new Error($c);t=FR()}}return t}function NR(e){var t=0;if(e.type!==xn&&e.type!==ka)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function qK(){var e,t,n,i,r,a,o,s,l,u;if(e=Te,l=Xp(),i=Te,r=NR(i),r===0)return l;for(i.prec=r,En(),t=[e,Te],o=Xp(),a=[l,i,o];(r=NR(Te))>0;){for(;a.length>2&&r<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=CR(s,l,o),a.push(n);i=En(),i.prec=r,a.push(i),t.push(Te),n=Xp(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)t.pop(),n=CR(a[u-1].value,a[u-2],n),u-=2;return n}function Bo(){var e,t,n;return e=qK(),Le("?")&&(En(),t=Bo(),Ut(":"),n=Bo(),e=CK(e,t,n)),e}function Dw(){var e=Bo();if(Le(","))throw new Error($c);return e}function IR(e){V=e,R=0,zt=V.length,Te=null,TR();var t=Dw();if(Te.type!==Tc)throw new Error("Unexpect token after expression.");return t}var MR={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function jR(e){function t(o,s,l,u){var c=e(s[0]);return l&&(c=l+"("+c+")",l.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(u<0?"":u===0?"()":"("+s.slice(1).map(e).join(",")+")")}function n(o,s,l){return function(u){return t(o,u,s,l)}}var i="new Date",r="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&F("Missing arguments to clamp function."),o.length>3&&F("Too many arguments to clamp function.");var s=o.map(e);return"Math.max("+s[1]+", Math.min("+s[2]+","+s[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),join:n("join",null),indexof:n("indexOf",null),lastindexof:n("lastIndexOf",null),slice:n("slice",null),reverse:function(o){return"("+e(o[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),replace:n("replace",r),trim:n("trim",r,0),regexp:a,test:n("test",a),if:function(o){o.length<3&&F("Missing arguments to if function."),o.length>3&&F("Too many arguments to if function.");var s=o.map(e);return"("+s[0]+"?"+s[1]+":"+s[2]+")"}}}function WK(e){var t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function GK(e){e=e||{};var t=e.whitelist?kt(e.whitelist):{},n=e.blacklist?kt(e.blacklist):{},i=e.constants||MR,r=(e.functions||jR)(f),a=e.globalvar,o=e.fieldvar,s={},l={},u=0,c=ge(a)?a:function(p){return a+'["'+p+'"]'};function f(p){if(Y(p))return p;var g=d[p.type];return g==null&&F("Unsupported type: "+p.type),g(p)}var d={Literal:function(p){return p.raw},Identifier:function(p){var g=p.name;return u>0?g:Q(n,g)?F("Illegal identifier: "+g):Q(i,g)?i[g]:Q(t,g)?g:(s[g]=1,c(g))},MemberExpression:function(p){var g=!p.computed,m=f(p.object);g&&(u+=1);var v=f(p.property);return m===o&&(l[WK(v)]=1),g&&(u-=1),m+(g?"."+v:"["+v+"]")},CallExpression:function(p){p.callee.type!=="Identifier"&&F("Illegal callee type: "+p.callee.type);var g=p.callee.name,m=p.arguments,v=Q(r,g)&&r[g];return v||F("Unrecognized function: "+g),ge(v)?v(m):v+"("+m.map(f).join(",")+")"},ArrayExpression:function(p){return"["+p.elements.map(f).join(",")+"]"},BinaryExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},UnaryExpression:function(p){return"("+p.operator+f(p.argument)+")"},ConditionalExpression:function(p){return"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")"},LogicalExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},ObjectExpression:function(p){return"{"+p.properties.map(f).join(",")+"}"},Property:function(p){u+=1;var g=f(p.key);return u-=1,g+":"+f(p.value)}};function h(p){var g={code:f(p),globals:Object.keys(s),fields:Object.keys(l)};return s={},l={},g}return h.functions=r,h.constants=i,h}function Rw(e,t,n,i){t[0].type!==Lo&&F("First argument to data functions must be a string literal.");const r=t[0].value,a=MJ+r;if(!Q(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(o){}}function HK(e,t,n,i){t[0].type!==Lo&&F("First argument to indata must be a string literal."),t[1].type!==Lo&&F("Second argument to indata must be a string literal.");const r=t[0].value,a=t[1].value,o=jJ+a;Q(o,i)||(i[o]=n.getData(r).indataRef(n,a))}function kn(e,t,n,i){if(t[0].type===Lo)LR(n,i,t[0].value);else for(e in n.scales)LR(n,i,e)}function LR(e,t,n){const i=kw+n;if(!Q(t,i))try{t[i]=e.scaleRef(n)}catch(r){}}function Nr(e,t){let n;return ge(e)?e:Y(e)?(n=t.scales[e])&&n.value:void 0}function YK(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=kn,n._range=kn,n._scale=kn;const i=r=>"_["+(r.type===Lo?B(kw+r.value):B(kw)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function Fw(e,t){return function(n,i,r){if(n){const a=Nr(n,(r||this).context);return a&&a.path[e](i)}else return t(i)}}const VK=Fw("area",DG),XK=Fw("bounds",IG),JK=Fw("centroid",BG);function KK(e){let t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function Nw(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function QK(){return Nw(this.context.dataflow,"warn",arguments)}function ZK(){return Nw(this.context.dataflow,"info",arguments)}function eQ(){return Nw(this.context.dataflow,"debug",arguments)}function Iw(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Mw(e){const t=ya(e),n=Iw(t.r),i=Iw(t.g),r=Iw(t.b);return .2126*n+.7152*i+.0722*r}function tQ(e,t){const n=Mw(e),i=Mw(t),r=Math.max(n,i),a=Math.min(n,i);return(r+.05)/(a+.05)}function nQ(){var e=[].slice.call(arguments);return e.unshift({}),fe.apply(null,e)}function PR(e,t){return e===t||e!==e&&t!==t?!0:I(e)?I(t)&&e.length===t.length?iQ(e,t):!1:K(e)&&K(t)?zR(e,t):!1}function iQ(e,t){for(let n=0,i=e.length;n<i;++n)if(!PR(e[n],t[n]))return!1;return!0}function zR(e,t){for(let n in e)if(!PR(e[n],t[n]))return!1;return!0}function BR(e){return t=>zR(e,t)}function rQ(e,t,n,i,r,a){let o=this.context.dataflow,s=this.context.data[e],l=s.input,u=s.changes,c=o.stamp(),f,d;if(o._trigger===!1||!(l.value.length||t||i))return 0;if((!u||u.stamp<c)&&(s.changes=u=o.changeset(),u.stamp=c,o.runAfter(function(){s.modified=!0,o.pulse(l,u).run()},!0,1)),n&&(f=n===!0?Ni:I(n)||rd(n)?n:BR(n),u.remove(f)),t&&u.insert(t),i&&(f=BR(i),l.value.some(f)?u.remove(f):u.insert(i)),r)for(d in a)u.modify(r,d,a[d]);return 1}function aQ(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function oQ(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}function sQ(e,t,n){return Ry(e||0,t||0,n||0)}function lQ(e,t){const n=Nr(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function uQ(e,t){const n=Nr(e,(t||this).context);return n?n.copy():void 0}function cQ(e,t){const n=Nr(e,(t||this).context);return n?n.domain():[]}function fQ(e,t,n){const i=Nr(e,(n||this).context);return i?I(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function dQ(e,t){const n=Nr(e,(t||this).context);return n&&n.range?n.range():[]}function hQ(e,t,n){const i=Nr(e,(n||this).context);return i?i(t):void 0}function pQ(e,t,n,i,r){e=Nr(e,(r||this).context);const a=ZA(t,n);let o=e.domain(),s=o[0],l=ve(o),u=Yt;return l-s?u=jT(e,s,l):e=(e.interpolator?Ee("sequential")().interpolator(e.interpolator()):Ee("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+i||15),s!==o[0]&&o.unshift(s),l!==ve(o)&&o.push(l)),o.forEach(c=>a.stop(u(c),e(c))),a}function gQ(e,t,n){const i=Nr(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function mQ(e){let t=null;return function(n){return n?ku(n,t=t||Ps(e)):e}}const UR=e=>e.data;function qR(e,t){const n=yR.call(t,e);return n.root&&n.root.lookup||{}}function vQ(e,t,n){const i=qR(e,this),r=i[t],a=i[n];return r&&a?r.path(a).map(UR):void 0}function yQ(e,t){const n=qR(e,this)[t];return n?n.ancestors().map(UR):void 0}const WR=()=>typeof window!="undefined"&&window||null;function bQ(){const e=WR();return e?e.screen:{}}function wQ(){const e=WR();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function xQ(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}const GR="intersect",HR="union",EQ="vlMulti",YR="or",kQ="and";var _Q="E",AQ="R",SQ="R-E",OQ="R-LE",TQ="R-RE",VR="index:unit";function XR(e,t){for(var n=t.fields,i=t.values,r=n.length,a=0,o,s;a<r;++a)if(s=n[a],s.getter=Fi.getter||Fi(s.field),o=s.getter(e),ro(o)&&(o=fn(o)),ro(i[a])&&(i[a]=fn(i[a])),ro(i[a][0])&&(i[a]=i[a].map(fn)),s.type===_Q){if(I(i[a])?i[a].indexOf(o)<0:o!==i[a])return!1}else if(s.type===AQ){if(!Zl(o,i[a]))return!1}else if(s.type===TQ){if(!Zl(o,i[a],!0,!1))return!1}else if(s.type===SQ){if(!Zl(o,i[a],!1,!1))return!1}else if(s.type===OQ&&!Zl(o,i[a],!1,!0))return!1;return!0}function CQ(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a=i?i[VR]&&i[VR].value:void 0,o=n===GR,s=r.length,l=0,u,c,f,d,h;l<s;++l)if(u=r[l],a&&o){if(c=c||{},f=c[d=u.unit]||0,f===-1)continue;if(h=XR(t,u),c[d]=h?-1:++f,h&&a.size===1)return!0;if(!h&&f===a.get(d).count)return!1}else if(h=XR(t,u),o^h)return h;return s&&o}function $Q(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a={},o={},s={},l,u,c,f,d,h,p,g,m,v=r.length,y=0,b,E;y<v;++y){for(l=r[y],f=l.unit,u=l.fields,c=l.values,b=0,E=u.length;b<E;++b)d=u[b],h=a[d.field]||(a[d.field]={}),p=h[f]||(h[f]=[]),s[d.field]=g=d.type.charAt(0),m=JR[g+"_union"],h[f]=m(p,G(c[b]));n&&(p=o[f]||(o[f]=[]),p.push(G(c).reduce((x,k,w)=>(x[u[w].field]=k,x),{})))}return t=t||HR,Object.keys(a).forEach(function(x){a[x]=Object.keys(a[x]).map(k=>a[x][k]).reduce((k,w)=>k===void 0?w:JR[s[x]+"_"+t](k,w))}),r=Object.keys(o),n&&r.length&&(a[EQ]=t===HR?{[YR]:r.reduce((x,k)=>(x.push.apply(x,o[k]),x),[])}:{[kQ]:r.map(x=>({[YR]:o[x]}))}),a}var JR={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(function(n){return t.indexOf(n)>=0}):t},R_union:function(e,t){var n=fn(t[0]),i=fn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=fn(t[0]),i=fn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const DQ=":",RQ="@";function KR(e,t,n,i){t[0].type!==Lo&&F("First argument to selection functions must be a string literal.");const r=t[0].value,a=t.length>=2&&ve(t).value,o="unit",s=RQ+o,l=DQ+r;a===GR&&!Q(i,s)&&(i[s]=n.getData(r).indataRef(n,o)),Q(i,l)||(i[l]=n.getData(r).tuplesRef())}function FQ(e,t,n){if(!e)return[];const[i,r]=e,a=new st().set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return pC(o,a,NQ(t))}function NQ(e){let t=null;if(e){const n=G(e.marktype),i=G(e.markname);t=r=>(!n.length||n.some(a=>r.marktype===a))&&(!i.length||i.some(a=>r.name===a))}return t}const Ic={random:function(){return Wn()},cumulativeNormal:Od,cumulativeLogNormal:Z0,cumulativeUniform:iv,densityNormal:V0,densityLogNormal:Q0,densityUniform:nv,quantileNormal:Td,quantileLogNormal:ev,quantileUniform:rv,sampleNormal:Sd,sampleLogNormal:K0,sampleUniform:tv,isArray:I,isBoolean:io,isDate:ro,isDefined:function(e){return e!==void 0},isNumber:Re,isObject:K,isRegExp:Hz,isString:Y,isTuple:rd,isValid:function(e){return e!=null&&e===e},toBoolean:hk,toDate:pk,toNumber:fn,toString:gk,flush:Gz,lerp:Yz,merge:nQ,pad:Kz,peek:ve,span:td,inrange:Zl,truncate:Zz,rgb:ya,lab:kh,hcl:_h,hsl:xh,luminance:Mw,contrast:tQ,sequence:lo,format:TJ,utcFormat:CJ,utcParse:DJ,utcOffset:p_,utcSequence:v_,timeFormat:bR,timeParse:$J,timeOffset:h_,timeSequence:m_,timeUnitSpecifier:Jk,monthFormat:RJ,monthAbbrevFormat:FJ,dayFormat:NJ,dayAbbrevFormat:IJ,quarter:Mz,utcquarter:jz,week:r_,utcweek:s_,dayofyear:i_,utcdayofyear:o_,warn:QK,info:ZK,debug:eQ,extent:vr,inScope:KK,intersect:FQ,clampRange:Lz,pinchDistance:aQ,pinchAngle:oQ,screen:bQ,containerSize:xQ,windowSize:wQ,bandspace:sQ,setdata:SJ,pathShape:mQ,panLinear:Rz,panLog:Fz,panPow:Nz,panSymlog:Iz,zoomLinear:ok,zoomLog:sk,zoomPow:Jm,zoomSymlog:lk,encode:OJ,modify:rQ},IQ=["view","item","group","xy","x","y"],MQ="event.vega.",QR="this.",jw={};function jQ(e){const t=jR(e);IQ.forEach(n=>t[n]=MQ+n);for(let n in Ic)t[n]=QR+n;return fe(t,YK(e,Ic,jw)),t}function vt(e,t,n){return arguments.length===1?Ic[e]:(Ic[e]=t,n&&(jw[e]=n),Lw&&(Lw.functions[e]=QR+e),this)}vt("bandwidth",lQ,kn),vt("copy",uQ,kn),vt("domain",cQ,kn),vt("range",dQ,kn),vt("invert",fQ,kn),vt("scale",hQ,kn),vt("gradient",pQ,kn),vt("geoArea",VK,kn),vt("geoBounds",XK,kn),vt("geoCentroid",JK,kn),vt("geoShape",gQ,kn),vt("indata",AJ,HK),vt("data",yR,Rw),vt("treePath",vQ,Rw),vt("treeAncestors",yQ,Rw),vt("vlSelectionTest",CQ,KR),vt("vlSelectionResolve",$Q,KR);const ZR={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_["+B(wR+e)+"]",functions:jQ,constants:MR,visitors:jw};var Lw=GK(ZR);function Ki(e,t){var n={},i,r;try{e=Y(e)?e:B(e)+"",i=IR(e)}catch(a){F("Expression parse error: "+e)}return i.visit(a=>{if(a.type!==xR)return;var o=a.callee.name,s=ZR.visitors[o];s&&s(o,a.arguments,t,n)}),r=Lw(i),r.globals.forEach(a=>{var o=wR+a;!Q(n,o)&&t.getSignal(a)&&(n[o]=t.signalRef(a))}),{$expr:fe({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function LQ(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const PQ=kt(["rule"]),eF=kt(["group","image","rect"]);function zQ(e,t){let n="";return PQ[t]||(e.x2&&(e.x?(eF[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(eF[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function Pw(e){return(e+"").toLowerCase()}function BQ(e){return Pw(e)==="operator"}function UQ(e){return Pw(e)==="collect"}function Mc(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");var i=Function.apply(null,t.concat(n));return e&&e.functions?i.bind(e.functions):i}function qQ(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var WQ={operator:(e,t)=>Mc(e,["_"],t.code),parameter:(e,t)=>Mc(e,["datum","_"],t.code),event:(e,t)=>Mc(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return Mc(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const a in i){const o="o["+B(a)+"]";r+=`$=${i[a].code};if(${o}!==$)${o}=$,m=1;`}return r+=zQ(i,n),r+="return m;",Mc(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(B).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(a,o)=>{const s=t[o];let l,u;return a.path?(l=`a${a.path}`,u=`b${a.path}`):((n=n||{})["f"+o]=a,l=`this.f${o}(a)`,u=`this.f${o}(b)`),qQ(l,u,-s,s)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function GQ(e){const t=this;BQ(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function HQ(e){const t=this;if(e.params){const n=t.get(e.id);n||F("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function YQ(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=I(r)?r.map(a=>tF(a,n,t)):tF(r,n,t)}return t}function tF(e,t,n){if(!e||!K(e))return e;for(let i=0,r=nF.length,a;i<r;++i)if(a=nF[i],Q(e,a.key))return a.parse(e,t,n);return e}var nF=[{key:"$ref",parse:VQ},{key:"$key",parse:JQ},{key:"$expr",parse:XQ},{key:"$field",parse:KQ},{key:"$encode",parse:ZQ},{key:"$compare",parse:QQ},{key:"$context",parse:eZ},{key:"$subflow",parse:tZ},{key:"$tupleid",parse:nZ}];function VQ(e,t){return t.get(e.$ref)||F("Operator not defined: "+e.$ref)}function XQ(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Rn(t.parameterExpression(e.$expr),e.$fields,e.$name))}function JQ(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=dk(e.$key,e.$flat,t.expr.codegen))}function KQ(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Fi(e.$field,e.$name,t.expr.codegen))}function QQ(e,t){const n="c:"+e.$compare+"_"+e.$order,i=G(e.$compare).map(r=>r&&r.$tupleid?ee:r);return t.fn[n]||(t.fn[n]=uk(i,e.$order,t.expr.codegen))}function ZQ(e,t){const n=e.$encode,i={};for(const r in n){const a=n[r];i[r]=Rn(t.encodeExpression(a.$expr),a.$fields),i[r].output=a.$output}return i}function eZ(e,t){return t}function tZ(e,t){const n=e.$subflow;return function(i,r,a){const o=t.fork().parse(n),s=o.get(n.operators[0].id),l=o.signals.parent;return l&&l.set(a),s.detachSubflow=()=>t.detach(o),s}}function nZ(){return ee}function iZ(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(a=>t.get(a)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(a=>t.get(a)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&F("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function rZ(e){var t=this,n=K(n=e.source)?n.$ref:n,i=t.get(n),r=null,a=e.update,o=void 0;i||F("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),a&&a.$expr&&(a.$params&&(o=t.parseParameters(a.$params)),a=t.handlerExpression(a.$expr)),t.update(e,i,r,a,o)}var aZ={skip:!0};function oZ(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(a=>{var o=t.signals[a];e.signals(a,o)&&(i[a]=o.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(a=>{var o=t.data[a];e.data(a,o)&&(r[a]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(a=>a.getState(e))),n}function sZ(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(a=>{n.update(t.signals[a],r[a],aZ)}),Object.keys(i||{}).forEach(a=>{n.pulse(t.data[a].input,n.changeset().remove(Ni).insert(i[a]))}),(e.subcontext||[]).forEach((a,o)=>{var s=t.subcontext[o];s&&s.setState(a)})}function iF(e,t,n,i){return new rF(e,t,n,i)}function rF(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||WQ,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function aF(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}rF.prototype=aF.prototype={fork(){const e=new aF(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),UQ(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){var a=n.get(e.parent.$ref);a?(i.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(e.parent.$ref),i.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const s=n.data[o]||(n.data[o]={});e.data[o].forEach(l=>s[l]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Pw(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:LQ,parseOperator:GQ,parseOperatorParameters:HQ,parseParameters:YQ,parseStream:iZ,parseUpdate:rZ,getState:oZ,setState:sZ};function lZ(e,t,n){return iF(e,Fs,Ic,n).parse(t)}function uZ(e){var t=this._runtime.scales;return Q(t,e)||F("Unrecognized scale or projection: "+e),t[e].value}var oF="width",sF="height",zw="padding",lF={skip:!0};function uF(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===zw?i.left+i.right:0)}function cF(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===zw?i.top+i.bottom:0)}function cZ(e){var t=e._signals,n=t[oF],i=t[sF],r=t[zw];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,function(s){e._width=s.size,e._viewWidth=uF(e,s.size),a()},{size:n}),e._resizeHeight=e.add(null,function(s){e._height=s.size,e._viewHeight=cF(e,s.size),a()},{size:i});var o=e.add(null,a,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function fZ(e,t,n,i,r,a){this.runAfter(function(o){var s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(oF,n,lF),o._resizeWidth.skip(!0)),o.height()!==i&&(s=1,o.signal(sF,i,lF),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),s&&o.run("enter"),a&&o.runAfter(l=>l.resize())},!1,1)}function dZ(e){return this._runtime.getState(e||{data:hZ,signals:pZ,recurse:!0})}function hZ(e,t){return t.modified&&I(t.input.value)&&e.indexOf("_:vega:_")}function pZ(e,t){return!(e==="parent"||t instanceof Fs.proxy)}function gZ(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function mZ(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(jY(n,t))}function vZ(e,t,n,i){var r=e.element();r&&r.setAttribute("title",yZ(i))}function yZ(e){return e==null?"":I(e)?fF(e):K(e)&&!ro(e)?bZ(e):e+""}function bZ(e){return Object.keys(e).map(function(t){var n=e[t];return t+": "+(I(n)?fF(n):dF(n))}).join(`
`)}function fF(e){return"["+e.map(dF).join(", ")+"]"}function dF(e){return I(e)?"[…]":K(e)&&!ro(e)?"{…}":e}function hF(e,t){const n=this;if(t=t||{},Rs.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const a=fe({},e.locale,t.locale);n.locale(z_(a.number,a.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||wa.Canvas,n._scenegraph=new Ay();const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||vZ,n._redraw=!0,n._handler=new Iu().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=iJ(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=lZ(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(a=>({state:null,param:fe({},a)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=uF(n,n._width),n._viewHeight=cF(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,cZ(n),HX(n),YX(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}var le=P(hF,Rs);le.evaluate=async function(e,t,n){if(await Rs.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,KX(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&id(this,n),this},le.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},le.description=function(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&uR(this._el,this._desc=t),this}return this._desc},le.container=function(){return this._el},le.scenegraph=function(){return this._scenegraph},le.origin=function(){return this._origin.slice()};function Jp(e,t){return Q(e._signals,t)?e._signals[t]:F("Unrecognized signal name: "+B(t))}le.signal=function(e,t,n){var i=Jp(this,e);return arguments.length===1?i.value:this.update(i,t,n)},le.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},le.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},le.padding=function(e){return arguments.length?this.signal("padding",vR(e)):vR(this.signal("padding"))},le.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},le.background=function(e){return arguments.length?this.signal("background",e):this.signal("background")},le.renderer=function(e){return arguments.length?(jh(e)||F("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},le.tooltip=function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},le.loader=function(e){return arguments.length?(e!==this._loader&&(Rs.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},le.resize=function(){return this._autosize=1,this.touch(Jp(this,"autosize"))},le._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},le._resizeView=fZ,le.addEventListener=function(e,t,n){var i=t;return n&&n.trap===!1||(i=ww(this,t),i.raw=t),this._handler.on(e,i),this},le.removeEventListener=function(e,t){for(var n=this._handler.handlers(e),i=n.length,r,a;--i>=0;)if(a=n[i].type,r=n[i].handler,e===a&&(t===r||t===r.raw)){this._handler.off(a,r);break}return this},le.addResizeListener=function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},le.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this};function pF(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function gF(e,t,n,i){var r=pF(n,i);return r||(r=ww(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function mF(e,t,n){var i=pF(t,n);return i&&t._targets.remove(i),e}le.addSignalListener=function(e,t){return gF(this,e,Jp(this,e),t)},le.removeSignalListener=function(e,t){return mF(this,Jp(this,e),t)},le.addDataListener=function(e,t){return gF(this,e,jp(this,e).values,t)},le.removeDataListener=function(e,t){return mF(this,jp(this,e).values,t)},le.globalCursor=function(e){if(arguments.length){if(this._globalCursor!==!!e){const t=bw(this,null);this._globalCursor=!!e,t&&bw(this,t)}return this}else return this._globalCursor},le.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},le.timer=mZ,le.events=aJ,le.finalize=sJ,le.hover=oJ,le.data=VX,le.change=Lp,le.insert=XX,le.remove=JX,le.scale=uZ,le.initialize=bJ,le.toImageURL=xJ,le.toCanvas=kJ,le.toSVG=_J,le.getState=dZ,le.setState=gZ;function wZ(e){return K(e)?e:{type:e||"pad"}}const jc=e=>+e||0,xZ=e=>({top:e,bottom:e,left:e,right:e});function EZ(e){return K(e)?e.signal?e:{top:jc(e.top),bottom:jc(e.bottom),left:jc(e.left),right:jc(e.right)}:xZ(jc(e))}const yt=e=>K(e)&&!I(e)?fe({},e):{value:e};function vF(e,t,n,i){return n!=null?(K(n)&&!I(n)?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function Dt(e,t,n){for(const i in t)vF(e,i,t[i]);for(const i in n)vF(e,i,n[i],"update")}function yl(e,t,n){for(const i in t){if(n&&Q(n,i))continue;e[i]=fe(e[i]||{},t[i])}return e}function bl(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var Bw="mark",Uw="frame",qw="scope",kZ="axis",_Z="axis-domain",AZ="axis-grid",SZ="axis-label",OZ="axis-tick",TZ="axis-title",CZ="legend",$Z="legend-band",DZ="legend-entry",RZ="legend-gradient",yF="legend-label",FZ="legend-symbol",NZ="legend-title",IZ="title",MZ="title-text",jZ="title-subtitle";function LZ(e,t,n,i,r){const a={},o={};let s,l,u,c;l="lineBreak",t==="text"&&r[l]!=null&&!bl(l,e)&&Ww(a,l,r[l]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===Uw?r.group:n===Bw?fe({},r.mark,r[t]):null;for(l in c)u=bl(l,e)||(l==="fill"||l==="stroke")&&(bl("fill",e)||bl("stroke",e)),u||Ww(a,l,c[l]);G(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)bl(h,e)||Ww(a,h,d[h])}),e=fe({},e);for(l in a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=fe(o,e.enter),s&&(e.update=fe(s,e.update)),e}function Ww(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const bF=e=>Y(e)?B(e):e.signal?`(${e.signal})`:wF(e);function Kp(e){if(e.gradient!=null)return zZ(e);let t=e.signal?`(${e.signal})`:e.color?PZ(e.color):e.field!=null?wF(e.field):e.value!==void 0?B(e.value):void 0;return e.scale!=null&&(t=BZ(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Zp(e.exponent)})`),e.mult!=null&&(t+=`*${Zp(e.mult)}`),e.offset!=null&&(t+=`+${Zp(e.offset)}`),e.round&&(t=`round(${t})`),t}const Qp=(e,t,n,i)=>`(${e}(${[t,n,i].map(Kp).join(",")})+'')`;function PZ(e){return e.c?Qp("hcl",e.h,e.c,e.l):e.h||e.s?Qp("hsl",e.h,e.s,e.l):e.l||e.a?Qp("lab",e.l,e.a,e.b):e.r||e.g||e.b?Qp("rgb",e.r,e.g,e.b):null}function zZ(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:B(n));for(;t.length&&ve(t)==null;)t.pop();return t.unshift(bF(e.gradient)),`gradient(${t.join(",")})`}function Zp(e){return K(e)?"("+Kp(e)+")":e}function wF(e){return xF(K(e)?e:{datum:e})}function xF(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):F("Invalid field reference: "+B(e));return e.signal||(i=Y(i)?mr(i).map(B).join("]["):xF(i)),t+"["+i+"]"}function BZ(e,t){const n=bF(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band===1?"":"*"+Zp(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function UZ(e){let t="";return e.forEach(n=>{const i=Kp(n);t+=n.test?`(${n.test})?${i}:`:i}),ve(t)===":"&&(t+="null"),t}function EF(e,t,n,i,r,a){const o={};a=a||{},a.encoders={$encode:o},e=LZ(e,t,n,i,r.config);for(const s in e)o[s]=qZ(e[s],t,a,r);return a}function qZ(e,t,n,i){const r={},a={};for(const o in e)e[o]!=null&&(r[o]=GZ(WZ(e[o]),i,n,a));return{$expr:{marktype:t,channels:r},$fields:Object.keys(a),$output:Object.keys(e)}}function WZ(e){return I(e)?UZ(e):Kp(e)}function GZ(e,t,n,i){const r=Ki(e,t);return r.$fields.forEach(a=>i[a]=1),fe(n,r.$params),r.$expr}var HZ="outer",YZ=["value","update","init","react","bind"];function kF(e,t){F(e+' for "outer" push: '+B(t))}function _F(e,t){var n=e.name;if(e.push===HZ)t.signals[n]||kF("No prior signal definition",n),YZ.forEach(function(r){e[r]!==void 0&&kF("Invalid property ",r)});else{var i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Gw(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function eg(e,t,n,i){return new Gw(e,t,n,i)}function tg(e,t){return eg("operator",e,t)}function ne(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Lc(e,t){return t?{$field:e,$name:t}:{$field:e}}var Hw=Lc("key");function AF(e,t){return{$compare:e,$order:t}}function VZ(e,t){var n={$key:e};return t&&(n.$flat=!0),n}var XZ="ascending",JZ="descending";function KZ(e){return K(e)?(e.order===JZ?"-":"+")+ng(e.op,e.field):""}function ng(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var Yw="scope",Vw="view";function bt(e){return e&&e.signal}function QZ(e){return e&&e.expr}function Pc(e){if(bt(e))return!0;if(K(e)){for(var t in e)if(Pc(e[t]))return!0}return!1}function Ei(e,t){return e??t}function Uo(e){return e&&e.signal||e}var SF="timer";function zc(e,t){var n=e.merge?eee:e.stream?tee:e.type?nee:F("Invalid stream specification: "+B(e));return n(e,t)}function ZZ(e){return e===Yw?Vw:e||Vw}function eee(e,t){var n=e.merge.map(r=>zc(r,t)),i=Xw({merge:n},e,t);return t.addStream(i).id}function tee(e,t){var n=zc(e.stream,t),i=Xw({stream:n},e,t);return t.addStream(i).id}function nee(e,t){var n,i;return e.type===SF?(n=t.event(SF,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(ZZ(e.source),e.type),i=Xw({stream:n},e,t),Object.keys(i).length===1?n:t.addStream(i).id}function Xw(e,t,n){var i=t.between;return i&&(i.length!==2&&F('Stream "between" parameter must have 2 entries: '+B(t)),e.between=[zc(i[0],n),zc(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(iee(t.marktype,t.markname,t.markrole)),t.source===Yw&&i.push("inScope(event.item)"),i.length&&(e.filter=Ki("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function iee(e,t,n){var i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}function qo(e,t,n){return $F=t||ree,DF=n||uee,RF(e.trim()).map(Jw)}var ree="view",ig="[",rg="]",OF="{",TF="}",aee=":",CF=",",oee="@",see=">",lee=/[[\]{}]/,$F,DF,uee={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function cee(e){return DF[e]}function Bc(e,t,n,i,r){for(var a=0,o=e.length,s;t<o;++t){if(s=e[t],!a&&s===n)return t;r&&r.indexOf(s)>=0?--a:i&&i.indexOf(s)>=0&&++a}return t}function RF(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=Bc(e,r,CF,ig+OF,rg+TF),t.push(e.substring(n,r).trim()),n=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function Jw(e){return e[0]==="["?fee(e):dee(e)}function fee(e){var t=e.length,n=1,i,r;if(n=Bc(e,n,rg,ig,rg),n===t)throw"Empty between selector: "+e;if(i=RF(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==see)throw"Expected '>' after between selector: "+e;return i=i.map(Jw),r=Jw(e.slice(1).trim()),r.between?{between:i,stream:r}:(r.between=i,r)}function dee(e){var t={source:$F},n=[],i=[0,0],r=0,a=0,o=e.length,s=0,l,u;if(e[o-1]===TF){if(s=e.lastIndexOf(OF),s>=0){try{i=hee(e.substring(s+1,o-1))}catch(c){throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),o=e.length}else throw"Unmatched right brace: "+e;s=0}if(!o)throw e;if(e[0]===oee&&(r=++s),l=Bc(e,s,aee),l<o&&(n.push(e.substring(a,l).trim()),a=s=++l),s=Bc(e,s,ig),s===o)n.push(e.substring(a,o).trim());else if(n.push(e.substring(a,s).trim()),u=[],a=++s,a===o)throw"Unmatched left bracket: "+e;for(;s<o;){if(s=Bc(e,s,rg),s===o)throw"Unmatched left bracket: "+e;if(u.push(e.substring(a,s).trim()),s<o-1&&e[++s]!==ig)throw"Expected left bracket: "+e;a=++s}if(!(o=n.length)||lee.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],r?t.markname=n[0].slice(1):cee(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),u!=null&&(t.filter=u),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function hee(e){var t=e.split(CF);if(!e.length||t.length>2)throw e;return t.map(function(n){var i=+n;if(i!==i)throw e;return i})}const pee={code:"_.$value",ast:{type:"Identifier",value:"value"}};function gee(e,t,n){var i=e.events,r=e.update,a=e.encode,o=[],s={target:n};i||F("Signal update missing events specification."),Y(i)&&(i=qo(i,t.isSubscope()?Yw:Vw)),i=G(i).filter(l=>l.signal||l.scale?(o.push(l),0):1),o.length>1&&(o=[vee(o)]),i.length&&o.push(i.length>1?{merge:i}:i[0]),a!=null&&(r&&F("Signal encode and update are mutually exclusive."),r="encode(item(),"+B(a)+")"),s.update=Y(r)?Ki(r,t):r.expr!=null?Ki(r.expr,t):r.value!=null?r.value:r.signal!=null?{$expr:pee,$params:{$value:t.signalRef(r.signal)}}:F("Invalid signal update specification."),e.force&&(s.options={force:!0}),o.forEach(function(l){t.addUpdate(fe(mee(l,t),s))})}function mee(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):zc(e,t)}}function vee(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function yee(e,t){var n=t.getSignal(e.name),i=e.update;e.init&&(i?F("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=Ki(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(function(r){gee(r,t,n.id)})}const $e=e=>(t,n,i)=>eg(e,n,t||void 0,i);var FF=$e("aggregate"),bee=$e("axisticks"),NF=$e("bound"),ki=$e("collect"),IF=$e("compare"),wee=$e("datajoin"),MF=$e("encode"),xee=$e("expression"),Eee=$e("facet"),kee=$e("field"),_ee=$e("key"),Aee=$e("legendentries"),See=$e("load"),Oee=$e("mark"),Tee=$e("multiextent"),Cee=$e("multivalues"),$ee=$e("overlap"),Dee=$e("params"),jF=$e("prefacet"),Ree=$e("projection"),Fee=$e("proxy"),Nee=$e("relay"),LF=$e("render"),Iee=$e("scale"),Wo=$e("sieve"),Mee=$e("sortitems"),PF=$e("viewlayout"),jee=$e("values"),Lee=0,zF={min:"min",max:"max",count:"sum"};function Pee(e,t){var n=e.type||"linear";DT(n)||F("Unrecognized scale type: "+B(n)),t.addScale(e.name,{type:n,domain:void 0})}function zee(e,t){var n=t.getScale(e.name).params,i;n.domain=BF(e.domain,e,t),e.range!=null&&(n.range=qF(e,t,n)),e.interpolate!=null&&Jee(e.interpolate,n),e.nice!=null&&(n.nice=Xee(e.nice)),e.bins!=null&&(n.bins=Vee(e.bins,t));for(i in e){if(Q(n,i)||i==="name")continue;n[i]=Zn(e[i],t)}}function Zn(e,t){return K(e)?e.signal?t.signalRef(e.signal):F("Unsupported object: "+B(e)):e}function ag(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Zn(n,t))}function og(e){F("Can not find data set: "+B(e))}function BF(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&F("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(I(e)?Bee:e.fields?qee:Uee)(e,t,n)}function Bee(e,t,n){return e.map(function(i){return Zn(i,n)})}function Uee(e,t,n){var i=n.getData(e.data);return i||og(e.data),tl(t.type)?i.valuesRef(n,e.field,UF(e.sort,!1)):NT(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function qee(e,t,n){var i=e.data,r=e.fields.reduce(function(a,o){return o=Y(o)?{data:i,field:o}:I(o)||o.signal?Wee(o,n):o,a.push(o),a},[]);return(tl(t.type)?Gee:NT(t.type)?Hee:Yee)(e,n,r)}function Wee(e,t){var n="_:vega:_"+Lee++,i=ki({});if(I(e))i.value={$ingest:e};else if(e.signal){var r="setdata("+B(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Wo({})]),{data:n,field:"data"}}function Gee(e,t,n){var i=UF(e.sort,!0),r,a,o,s,l;return r=n.map(function(u){var c=t.getData(u.data);return c||og(u.data),c.countsRef(t,u.field,i)}),a={groupby:Hw,pulse:r},i&&(o=i.op||"count",l=i.field?ng(o,i.field):"count",a.ops=[zF[o]],a.fields=[t.fieldRef(l)],a.as=[l]),o=t.add(FF(a)),s=t.add(ki({pulse:ne(o)})),l=t.add(jee({field:Hw,sort:t.sortRef(i),pulse:ne(s)})),ne(l)}function UF(e,t){return e&&(!e.field&&!e.op?K(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?F("No field provided for sort aggregate op: "+e.op):t&&e.field&&(e.op&&!zF[e.op]&&F("Multiple domain scales can not be sorted using "+e.op))),e}function Hee(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||og(r.data),a.domainRef(t,r.field)});return ne(t.add(Cee({values:i})))}function Yee(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||og(r.data),a.extentRef(t,r.field)});return ne(t.add(Tee({extents:i})))}function Vee(e,t){return e.signal||I(e)?ag(e,t):t.objectProperty(e)}function Xee(e){return K(e)?{interval:Zn(e.interval),step:Zn(e.step)}:Zn(e)}function Jee(e,t){t.interpolate=Zn(e.type||e),e.gamma!=null&&(t.interpolateGamma=Zn(e.gamma))}function qF(e,t,n){var i=e.range,r=t.config.range;if(i.signal)return t.signalRef(i.signal);if(Y(i)){if(r&&Q(r,i))return e=fe({},e,{range:r[i]}),qF(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=tl(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:F("Unrecognized scale range value: "+B(i))}else if(i.scheme){n.scheme=I(i.scheme)?ag(i.scheme,t):Zn(i.scheme,t),i.extent&&(n.schemeExtent=ag(i.extent,t)),i.count&&(n.schemeCount=Zn(i.count,t));return}else if(i.step){n.rangeStep=Zn(i.step,t);return}else{if(tl(e.type)&&!I(i))return BF(i,e,t);I(i)||F("Unsupported range type: "+B(i))}return i.map(a=>(I(a)?ag:Zn)(a,t))}function Kee(e,t){var n=t.config.projection||{},i={};for(var r in e){if(r==="name")continue;i[r]=Kw(e[r],r,t)}for(r in n)i[r]==null&&(i[r]=Kw(n[r],r,t));t.addProjection(e.name,i)}function Kw(e,t,n){return I(e)?e.map(function(i){return Kw(i,t,n)}):K(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:F("Unsupported parameter object: "+B(e)):e}const _i="top",wl="left",xl="right",_a="bottom",WF="center",Qee="vertical",Zee="start",ete="middle",tte="end",Qw="index",Zw="label",nte="offset",El="perc",ite="perc2",ei="value",Uc="guide-label",ex="guide-title",rte="group-title",ate="group-subtitle",GF="symbol",sg="gradient",tx="discrete",nx="size",ote="shape",ste="fill",lte="stroke",ute="strokeWidth",cte="strokeDash",fte="opacity",ix=[nx,ote,ste,lte,ute,cte,fte],qc={name:1,style:1,interactive:1},be={value:0},ti={value:1};var lg="group",HF="rect",rx="rule",dte="symbol",Go="text";function Wc(e){return e.type=lg,e.interactive=e.interactive||!1,e}function _n(e,t){const n=(i,r)=>Ei(e[i],Ei(t[i],r));return n.isVertical=i=>Qee===Ei(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>Ei(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>Ei(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>Ei(e.columns,Ei(t.columns,+n.isVertical(!0))),n}function YF(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function hte(e,t,n){var i=t.config.style[n];return i&&i[e]}function ug(e,t,n){return`item.anchor === '${Zee}' ? ${e} : item.anchor === '${tte}' ? ${t} : ${n}`}const ax=ug(B(wl),B(xl),B(WF));function pte(e){let t=e("tickBand"),n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},K(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function VF(e,t){return t?e?K(e)?Object.assign({},e,{offset:VF(e.offset,t)}):{value:e,offset:t}:t:e}function zn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=yl(e.encode,t,qc)):e.interactive=!1,e}function gte(e,t,n,i){var r=_n(e,n),a=r.isVertical(),o=r.gradientThickness(),s=r.gradientLength(),l,u,c,f,d,h;return a?(c=[0,1],f=[0,0],d=o,h=s):(c=[0,0],f=[1,0],d=s,h=o),l={enter:u={opacity:be,x:be,y:be,width:yt(d),height:yt(h)},update:fe({},u,{opacity:ti,fill:{gradient:t,start:c,stop:f}}),exit:{opacity:be}},Dt(l,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),zn({type:HF,role:RZ,encode:l},i)}function mte(e,t,n,i,r){var a=_n(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength(),u,c,f,d,h,p,g="";return o?(f="y",h="y2",d="x",p="width",g="1-"):(f="x",h="x2",d="y",p="height"),c={opacity:be,fill:{scale:t,field:ei}},c[f]={signal:g+"datum."+El,mult:l},c[d]=be,c[h]={signal:g+"datum."+ite,mult:l},c[p]=yt(s),u={enter:c,update:fe({},c,{opacity:ti}),exit:{opacity:be}},Dt(u,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),zn({type:HF,role:$Z,key:ei,from:r,encode:u},i)}const vte=`datum.${El}<=0?"${wl}":datum.${El}>=1?"${xl}":"${WF}"`,yte=`datum.${El}<=0?"${_a}":datum.${El}>=1?"${_i}":"${ete}"`;function XF(e,t,n,i){var r=_n(e,t),a=r.isVertical(),o=yt(r.gradientThickness()),s=r.gradientLength(),l=r("labelOverlap"),u,c,f,d,h,p="";return u={enter:c={opacity:be},update:f={opacity:ti,text:{field:Zw}},exit:{opacity:be}},Dt(u,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:Ei(e.labelLimit,t.gradientLabelLimit)}),a?(c.align={value:"left"},c.baseline=f.baseline={signal:yte},d="y",h="x",p="1-"):(c.align=f.align={signal:vte},c.baseline={value:"top"},d="x",h="y"),c[d]=f[d]={signal:p+"datum."+El,mult:s},c[h]=f[h]=o,o.offset=Ei(e.labelOffset,t.gradientLabelOffset)||0,l=l?{separation:r("labelSeparation"),method:l,order:"datum."+Qw}:void 0,zn({type:Go,role:yF,style:Uc,key:ei,from:i,encode:u,overlap:l},n)}function bte(e,t,n,i,r){var a=_n(e,t),o=n.entries,s=!!(o&&o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d={},h=`(${r}) ? datum.${nte} : datum.${nx}`,p=u?yt(u):{field:nx},g=`datum.${Qw}`,m=`max(1, ${r})`,v,y,b,E,x,k,w;p.mult=.5,d={enter:v={opacity:be,x:{signal:h,mult:.5,offset:c},y:p},update:y={opacity:ti,x:v.x,y:v.y},exit:{opacity:be}};var A=null,_=null;return e.fill||(A=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Dt(d,{fill:a("symbolFillColor",A),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),ix.forEach(function(O){e[O]&&(y[O]=v[O]={scale:e[O],field:ei})}),E=zn({type:dte,role:FZ,key:ei,from:f,clip:u?!0:void 0,encode:d},n.symbols),b=yt(c),b.offset=a("labelOffset"),d={enter:v={opacity:be,x:{signal:h,offset:b},y:p},update:y={opacity:ti,text:{field:Zw},x:v.x,y:v.y},exit:{opacity:be}},Dt(d,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")}),x=zn({type:Go,role:yF,style:Uc,key:ei,from:f,encode:d},n.labels),d={enter:{noBound:{value:!u},width:be,height:u?yt(u):be,opacity:be},exit:{opacity:be},update:y={opacity:ti,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(k=`ceil(item.mark.items.length / ${m})`,y.row.signal=`${g}%${k}`,y.column.signal=`floor(${g} / ${k})`,w={field:["row",g]}):(y.row.signal=`floor(${g} / ${m})`,y.column.signal=`${g} % ${m}`,w={field:g}),y.column.signal=`(${r})?${y.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:Qw}},Wc({role:qw,from:i,encode:yl(d,o,qc),marks:[E,x],name:l,interactive:s,sort:w})}function wte(e,t){const n=_n(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const ox='item.orient === "left"',sx='item.orient === "right"',cg=`(${ox} || ${sx})`,xte=`datum.vgrad && ${cg}`,Ete=ug('"top"','"bottom"','"middle"'),kte=ug('"right"','"left"','"center"'),_te=`datum.vgrad && ${sx} ? (${kte}) : (${cg} && !(datum.vgrad && ${ox})) ? "left" : ${ax}`,Ate=`item._anchor || (${cg} ? "middle" : "start")`,Ste=`${xte} ? (${ox} ? -90 : 90) : 0`,Ote=`${cg} ? (datum.vgrad ? (${sx} ? "bottom" : "top") : ${Ete}) : "top"`;function Tte(e,t,n,i){var r=_n(e,t),a;return a={enter:{opacity:be},update:{opacity:ti,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:be}},Dt(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Ate},angle:{signal:Ste},align:{signal:_te},baseline:{signal:Ote},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),zn({type:Go,role:NZ,style:ex,from:i,encode:a},n)}function Cte(e,t){var n;return K(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+JF(e.path)+")":e.sphere&&(n="geoShape("+JF(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function JF(e){return K(e)&&e.signal?e.signal:B(e)}function KF(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===lg?qw:t||Bw}function $te(e){return{marktype:e.type,name:e.name||void 0,role:e.role||KF(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Dte(e,t){return e&&e.signal?t.signalRef(e.signal):!(e===!1)}function lx(e,t){var n=X_(e.type);n||F("Unrecognized transform type: "+B(e.type));var i=eg(n.type.toLowerCase(),null,QF(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function QF(e,t,n){var i={},r,a,o;for(a=0,o=e.params.length;a<o;++a)r=e.params[a],i[r.name]=Rte(r,t,n);return i}function Rte(e,t,n){var i=e.type,r=t[e.name];if(i==="index")return Fte(e,t,n);if(r===void 0){e.required&&F("Missing required "+B(t.type)+" parameter: "+B(e.name));return}else{if(i==="param")return Nte(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!bt(r)?r.map(function(a){return ZF(e,a,n)}):ZF(e,r,n)}function ZF(e,t,n){var i=e.type;if(bt(t))return tN(i)?F("Expression references can not be signals."):ux(i)?n.fieldRef(t):nN(i)?n.compareRef(t):n.signalRef(t.signal);var r=e.expr||ux(i);return r&&Ite(t)?n.exprRef(t.expr,t.as):r&&Mte(t)?Lc(t.field,t.as):tN(i)?Ki(t,n):jte(i)?ne(n.getData(t).values):ux(i)?Lc(t):nN(i)?n.compareRef(t):t}function Fte(e,t,n){return Y(t.from)||F('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function Nte(e,t,n){var i=t[e.name];return e.array?(I(i)||F("Expected an array of sub-parameters. Instead: "+B(i)),i.map(function(r){return eN(e,r,n)})):eN(e,i,n)}function eN(e,t,n){var i,r,a,o,s;for(o=0,s=e.params.length;o<s;++o){r=e.params[o];for(a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}return r||F("Unsupported parameter: "+B(t)),i=fe(QF(r,t,n),r.key),ne(n.add(Dee(i)))}function Ite(e){return e&&e.expr}function Mte(e){return e&&e.field}function jte(e){return e==="data"}function tN(e){return e==="expr"}function ux(e){return e==="field"}function nN(e){return e==="compare"}function Lte(e,t,n){var i,r,a,o,s;return e?(i=e.facet)&&(t||F("Only group marks can be faceted."),i.field!=null?o=s=fg(i,n):(e.data?s=ne(n.getData(e.data).aggregate):(a=lx(fe({type:"aggregate",groupby:G(i.groupby)},i.aggregate),n),a.params.key=n.keyRef(i.groupby),a.params.pulse=fg(i,n),o=s=ne(n.add(a))),r=n.keyRef(i.groupby,!0))):o=ne(n.add(ki(null,[{}]))),o||(o=fg(e,n)),{key:r,pulse:o,parent:s}}function fg(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ne(t.getData(e.data).output)}function Ho(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Ho.fromEntries=function(e,t){var n=t.length,i=1,r=t[0],a=t[n-1],o=t[n-2],s=null;for(r&&r.type==="load"&&(r=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=ne(t[i-1]),e.add(t[i]),t[i].type==="aggregate"&&(s=t[i]);return new Ho(e,r,o,a,s)};var Yo=Ho.prototype;Yo.countsRef=function(e,t,n){var i=this,r=i.counts||(i.counts={}),a=iN(t),o,s,l;return a!=null&&(e=i.scope,o=r[a]),o?n&&n.field&&rN(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:ne(i.output)},n&&n.field&&rN(e,l,n),s=e.add(FF(l)),o=e.add(ki({pulse:ne(s)})),o={agg:s,ref:ne(o)},a!=null&&(r[a]=o)),o.ref};function iN(e){return Y(e)?e:null}function rN(e,t,n){var i=ng(n.op,n.field),r;if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Gc(e,t,n,i,r,a,o){var s=t[n]||(t[n]={}),l=KZ(a),u=iN(r),c,f;if(u!=null&&(e=t.scope,u=u+(l?"|"+l:""),c=s[u]),!c){var d=a?{field:Hw,pulse:t.countsRef(e,r,a)}:{field:e.fieldRef(r),pulse:ne(t.output)};l&&(d.sort=e.sortRef(a)),f=e.add(eg(i,void 0,d)),o&&(t.index[r]=f),c=ne(f),u!=null&&(s[u]=c)}return c}Yo.tuplesRef=function(){return ne(this.values)},Yo.extentRef=function(e,t){return Gc(e,this,"extent","extent",t,!1)},Yo.domainRef=function(e,t){return Gc(e,this,"domain","values",t,!1)},Yo.valuesRef=function(e,t,n){return Gc(e,this,"vals","values",t,n||!0)},Yo.lookupRef=function(e,t){return Gc(e,this,"lookup","tupleindex",t,!1)},Yo.indataRef=function(e,t){return Gc(e,this,"indata","tupleindex",t,!0,!0)};function Pte(e,t,n){var i=e.from.facet,r=i.name,a=fg(i,t),o,s,l,u;i.name||F("Facet must have a name: "+B(i)),i.data||F("Facet must reference a data set: "+B(i)),i.field?u=t.add(jF({field:t.fieldRef(i.field),pulse:a})):i.groupby?u=t.add(Eee({key:t.keyRef(i.groupby),group:ne(t.proxy(n.parent)),pulse:a})):F("Facet must specify groupby or field: "+B(i)),o=t.fork(),s=o.add(ki()),l=o.add(Wo({pulse:ne(s)})),o.addData(r,new Ho(o,s,s,l)),o.addSignal("parent",null),u.params.subflow={$subflow:o.parse(e).toRuntime()}}function zte(e,t,n){var i=t.add(jF({pulse:n.pulse})),r=t.fork();r.add(Wo()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function aN(e,t,n){var i=e.remove,r=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(tg()),u,c;u="if("+e.trigger+',modify("'+n+'",'+[r,i,a,o,s].map(function(f){return f??"null"}).join(",")+"),0)",c=Ki(u,t),l.update=c.$expr,l.params=c.$params}function dg(e,t){var n=KF(e),i=e.type===lg,r=e.from&&e.from.facet,a=e.layout||n===qw||n===Uw,o=n===Bw||a||r,s=e.overlap,l,u,c,f,d,h,p,g,m,v,y,b,E,x;c=Lte(e.from,i,t),u=t.add(wee({key:c.key||(e.key?Lc(e.key):void 0),pulse:c.pulse,clean:!i})),v=ne(u),u=f=t.add(ki({pulse:v})),u=t.add(Oee({markdef:$te(e),interactive:Dte(e.interactive,t),clip:Cte(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ne(u)})),y=ne(u),u=d=t.add(MF(EF(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(function(k){const w=lx(k,t),A=w.metadata;(A.generates||A.changes)&&F("Mark transforms should not generate new data."),A.nomod||(d.params.mod=!0),w.params.pulse=ne(u),t.add(u=w)}),e.sort&&(u=t.add(Mee({sort:t.compareRef(e.sort),pulse:ne(u)}))),b=ne(u),(r||a)&&(a=t.add(PF({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),E=ne(a)),h=t.add(NF({mark:y,pulse:E||b})),x=ne(h),i&&(o&&(l=t.operators,l.pop(),a&&l.pop()),t.pushState(b,E||x,v),r?Pte(e,t,c):o?zte(e,t,c):t.parse(e),t.popState(),o&&(a&&l.push(a),l.push(h))),s&&(x=Bte(s,x,t)),p=t.add(LF({pulse:x})),g=t.add(Wo({pulse:ne(p)},void 0,t.parent())),e.name!=null&&(m=e.name,t.addData(m,new Ho(t,f,p,g)),e.on&&e.on.forEach(function(k){(k.insert||k.remove||k.toggle)&&F("Marks only support modify triggers."),aN(k,t,m)}))}function Bte(e,t,n){var i=e.method,r=e.bound,a=e.separation,o,s={separation:bt(a)?n.signalRef(a.signal):a,method:bt(i)?n.signalRef(i.signal):i,pulse:t};return e.order&&(s.sort=n.compareRef({field:e.order})),r&&(o=r.tolerance,s.boundTolerance=bt(o)?n.signalRef(o.signal):+o,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient),ne(n.add($ee(s)))}function Ute(e,t){var n=t.config.legend,i=e.encode||{},r=i.legend||{},a=r.name||void 0,o=r.interactive,s=r.style,l=_n(e,n),u={},c=0,f,d,h,p,g,m,v,y;return ix.forEach(b=>e[b]?(u[b]=e[b],c=c||e[b]):0),c||F("Missing valid scale for legend."),g=qte(e,t.scaleType(c)),m={title:e.title!=null,scales:u,type:g,vgrad:g!=="symbol"&&l.isVertical()},v=ne(t.add(ki(null,[m]))),r=yl(Gte(l,e,n),r,qc),f={enter:{x:{value:0},y:{value:0}}},y=ne(t.add(Aee(h={type:g,scale:t.scaleRef(c),count:t.objectProperty(l("tickCount")),limit:t.property(l("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),g===sg?(p=[gte(e,c,n,i.gradient),XF(e,n,i.labels,y)],h.count=h.count||t.signalRef(`max(2,2*floor((${Uo(l.gradientLength())})/100))`)):g===tx?p=[mte(e,c,n,i.gradient,y),XF(e,n,i.labels,y)]:(d=wte(e,n),p=[bte(e,n,i,y,Uo(d.columns))],h.size=Hte(e,t,p[0].marks)),p=[Wc({role:DZ,from:v,encode:f,marks:p,layout:d,interactive:o})],m.title&&p.push(Tte(e,n,i.title,v)),dg(Wc({role:CZ,from:v,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function qte(e,t){var n=e.type||GF;return!e.type&&Wte(e)===1&&(e.fill||e.stroke)&&(n=gb(t)?sg:mb(t)?tx:GF),n!==sg?n:mb(t)?tx:sg}function Wte(e){return ix.reduce(function(t,n){return t+(e[n]?1:0)},0)}function Gte(e,t,n){var i={enter:{},update:{}};return Dt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Hte(e,t,n){var i=Uo(oN("size",e,n)),r=Uo(oN("strokeWidth",e,n)),a=Uo(Yte(n[1].encode,t,Uc));return Ki(`max(ceil(sqrt(${i})+${r}),${a})`,t)}function oN(e,t,n){return t[e]?`scale("${t[e]}",datum)`:YF(e,n[0].encode)}function Yte(e,t,n){return YF("fontSize",e)||hte("fontSize",t,n)}const Vte=`item.orient==="${wl}"?-90:item.orient==="${xl}"?90:0`;function Xte(e,t){e=Y(e)?{text:e}:e;var n=_n(e,t.config.title),i=e.encode||{},r=i.group||{},a=r.name||void 0,o=r.interactive,s=r.style,l=[],u,c;return u={},c=ne(t.add(ki(null,[u]))),l.push(Qte(e,n,Jte(e),c)),e.subtitle&&l.push(Zte(e,n,i.subtitle,c)),dg(Wc({role:IZ,from:c,encode:Kte(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function Jte(e){const t=e.encode;return t&&t.title||fe({name:e.name,interactive:e.interactive,style:e.style},t)}function Kte(e,t){var n={enter:{},update:{}};return Dt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:ax},angle:{signal:Vte},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),yl(n,t,qc)}function Qte(e,t,n,i){var r={value:0},a=e.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Dt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:Go,role:MZ,style:rte,from:i,encode:o},n)}function Zte(e,t,n,i){var r={value:0},a=e.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Dt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:Go,role:jZ,style:ate,from:i,encode:o},n)}function ene(e,t){var n=[];e.transform&&e.transform.forEach(function(i){n.push(lx(i,t))}),e.on&&e.on.forEach(function(i){aN(i,t,e.name)}),t.addDataPipeline(e.name,tne(e,t,n))}function tne(e,t,n){var i=[],r=null,a=!1,o=!1,s,l,u,c,f;for(e.values?Pc(e.values)||Pc(e.format)?(i.push(sN(t,e)),i.push(r=Vo())):i.push(r=Vo({$ingest:e.values,$format:e.format})):e.url?Pc(e.url)||Pc(e.format)?(i.push(sN(t,e)),i.push(r=Vo())):i.push(r=Vo({$request:e.url,$format:e.format})):e.source&&(r=s=G(e.source).map(function(d){return ne(t.getData(d).output)}),i.push(null)),l=0,u=n.length;l<u;++l)c=n[l],f=c.metadata,!r&&!f.source&&i.push(r=Vo()),i.push(c),f.generates&&(o=!0),f.modifies&&!o&&(a=!0),f.source?r=c:f.changes&&(r=null);return s&&(u=s.length-1,i[0]=Nee({derive:a,pulse:u?s:s[0]}),(a||u)&&i.splice(1,0,Vo())),r||i.push(Vo()),i.push(Wo({})),i}function Vo(e){var t=ki({},e);return t.metadata={source:!0},t}function sN(e,t){return See({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const lN=e=>e===_a||e===_i,hg=(e,t,n)=>bt(e)?ane(e.signal,t,n):e===wl||e===_i?t:n,wt=(e,t,n)=>bt(e)?ine(e.signal,t,n):lN(e)?t:n,Ai=(e,t,n)=>bt(e)?rne(e.signal,t,n):lN(e)?n:t,uN=(e,t,n)=>bt(e)?one(e.signal,t,n):e===_i?{value:t}:{value:n},nne=(e,t,n)=>bt(e)?sne(e.signal,t,n):e===xl?{value:t}:{value:n},ine=(e,t,n)=>cN(`${e} === '${_i}' || ${e} === '${_a}'`,t,n),rne=(e,t,n)=>cN(`${e} !== '${_i}' && ${e} !== '${_a}'`,t,n),ane=(e,t,n)=>cx(`${e} === '${wl}' || ${e} === '${_i}'`,t,n),one=(e,t,n)=>cx(`${e} === '${_i}'`,t,n),sne=(e,t,n)=>cx(`${e} === '${xl}'`,t,n),cN=(e,t,n)=>(t=t!=null?yt(t):t,n=n!=null?yt(n):n,fN(t)&&fN(n)?(t=t?t.signal||B(t.value):null,n=n?n.signal||B(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[fe({test:e},t)].concat(n||[])),fN=e=>e==null||Object.keys(e).length===1,cx=(e,t,n)=>({signal:`${e} ? (${kl(t)}) : (${kl(n)})`}),lne=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${wl}' ? (${kl(i)}) : `:"")+(n!=null?`${e} === '${_a}' ? (${kl(n)}) : `:"")+(r!=null?`${e} === '${xl}' ? (${kl(r)}) : `:"")+(t!=null?`${e} === '${_i}' ? (${kl(t)}) : `:"")+"(null)"}),kl=e=>bt(e)?e.signal:e==null?null:B(e),une=(e,t)=>t===0?0:bt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},_l=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Al(e,t,n,i){let r;if(t&&Q(t,e))return t[e];if(Q(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[ex][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Uc][r]}return null}function dN(e){const t={};for(const n of e){if(!n)continue;for(const i in n)t[i]=1}return Object.keys(t)}function cne(e,t){var n=t.config,i=n.style,r=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,s,l,u;if(bt(o)){const f=dN([n.axisX,n.axisY]),d=dN([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(u of f)s[u]=wt(o,Al(u,n.axisX,r,i),Al(u,n.axisY,r,i));l={};for(u of d)l[u]=lne(o.signal,Al(u,n.axisTop,r,i),Al(u,n.axisBottom,r,i),Al(u,n.axisLeft,r,i),Al(u,n.axisRight,r,i))}else s=o===_i||o===_a?n.axisX:n.axisY,l=n["axis"+o[0].toUpperCase()+o.slice(1)];var c=s||l||a?fe({},r,s,l,a):r;return c}function fne(e,t,n,i){var r=_n(e,t),a=e.orient,o,s,l;o={enter:s={opacity:be},update:l={opacity:ti},exit:{opacity:be}},Dt(o,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const u=hN(e,0),c=hN(e,1);return s.x=l.x=wt(a,u,be),s.x2=l.x2=wt(a,c),s.y=l.y=Ai(a,u,be),s.y2=l.y2=Ai(a,c),zn({type:rx,role:_Z,from:i,encode:o},n)}function hN(e,t){return{scale:e.scale,range:t}}function dne(e,t,n,i,r){var a=_n(e,t),o=e.orient,s=e.gridScale,l=hg(o,1,-1),u=hne(e.offset,l),c,f,d,h,p,g,m,v;return c={enter:f={opacity:be},update:h={opacity:ti},exit:d={opacity:be}},Dt(c,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")}),p={scale:e.scale,field:ei,band:r.band,extra:r.extra,offset:r.offset,round:a("tickRound")},v=wt(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},m=s?{scale:s,range:1,mult:l,offset:u}:fe(v,{mult:l,offset:u}),f.x=h.x=wt(o,p,g),f.y=h.y=Ai(o,p,g),f.x2=h.x2=Ai(o,m),f.y2=h.y2=wt(o,m),d.x=wt(o,p),d.y=Ai(o,p),zn({type:rx,role:AZ,key:ei,from:i,encode:c},n)}function hne(e,t){if(!(t===1))if(!K(e))e=bt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=fe({},e);for(;n.mult!=null;)if(K(n.mult))n=n.mult=fe({},n.mult);else return n.mult=bt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function pne(e,t,n,i,r,a){var o=_n(e,t),s=e.orient,l=hg(s,-1,1),u,c,f,d,h,p;return u={enter:c={opacity:be},update:d={opacity:ti},exit:f={opacity:be}},Dt(u,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")}),h=yt(r),h.mult=l,p={scale:e.scale,field:ei,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")},d.y=c.y=wt(s,be,p),d.y2=c.y2=wt(s,h),f.x=wt(s,p),d.x=c.x=Ai(s,be,p),d.x2=c.x2=Ai(s,h),f.y=Ai(s,p),zn({type:rx,role:OZ,key:ei,from:i,encode:u},n)}function fx(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function gne(e,t,n,i,r,a){var o=_n(e,t),s=e.orient,l=e.scale,u=hg(s,-1,1),c=Uo(o("labelFlush")),f=Uo(o("labelFlushOffset")),d=c===0||!!c,h=o("labelAlign"),p=o("labelBaseline"),g,m,v,y,b,E,x,k,w,A;return y=yt(r),y.mult=u,y.offset=yt(o("labelPadding")||0),y.offset.mult=u,b={scale:l,field:ei,band:.5,offset:VF(a.offset,o("labelOffset"))},E=wt(s,d?fx(l,c,'"left"','"right"','"center"'):{value:"center"},nne(s,"left","right")),x=wt(s,uN(s,"bottom","top"),d?fx(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),A=fx(l,c,`-(${f})`,f,0),d=d&&f,m={opacity:be,x:wt(s,b,y),y:Ai(s,b,y)},g={enter:m,update:v={opacity:ti,text:{field:Zw},x:m.x,y:m.y,align:E,baseline:x},exit:{opacity:be,x:m.x,y:m.y}},Dt(g,{dx:!h&&d?wt(s,A):null,dy:!p&&d?Ai(s,A):null}),Dt(g,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:p}),k=o("labelBound"),w=o("labelOverlap"),w=w||k?{separation:o("labelSeparation"),method:w,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,v.align!==E&&(v.align=_l(v.align,E)),v.baseline!==x&&(v.baseline=_l(v.baseline,x)),zn({type:Go,role:SZ,style:Uc,key:ei,from:i,encode:g,overlap:w},n)}function mne(e,t,n,i){var r=_n(e,t),a=e.orient,o=hg(a,-1,1),s,l,u,c;return s={enter:l={opacity:be,anchor:yt(r("titleAnchor",null)),align:{signal:ax}},update:u=fe({},l,{opacity:ti,text:yt(e.title)}),exit:{opacity:be}},c={signal:`lerp(range("${e.scale}"), ${ug(0,1,.5)})`},u.x=wt(a,c),u.y=Ai(a,c),l.angle=wt(a,be,une(o,90)),l.baseline=wt(a,uN(a,_a,_i),{value:_a}),u.angle=l.angle,u.baseline=l.baseline,Dt(s,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),vne(r,a,s,n),s.update.align=_l(s.update.align,l.align),s.update.angle=_l(s.update.angle,l.angle),s.update.baseline=_l(s.update.baseline,l.baseline),zn({type:Go,role:TZ,style:ex,from:i,encode:s},n)}function vne(e,t,n,i){const r=(s,l)=>s!=null?(n.update[l]=_l(yt(s),n.update[l]),!1):!bl(l,i),a=r(e("titleX"),"x"),o=r(e("titleY"),"y");n.enter.auto=o===a?yt(o):wt(t,yt(o),yt(a))}function yne(e,t){var n=cne(e,t),i=e.encode||{},r=i.axis||{},a=r.name||void 0,o=r.interactive,s=r.style,l=_n(e,n),u=pte(l),c,f,d,h,p;return c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:e.title!=null},f=ne(t.add(ki({},[c]))),r=yl(bne(l,e),r,qc),d=ne(t.add(bee({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),p=[],c.grid&&p.push(dne(e,n,i.grid,d,u)),c.ticks&&(h=l("tickSize"),p.push(pne(e,n,i.ticks,d,h,u))),c.labels&&(h=c.ticks?h:0,p.push(gne(e,n,i.labels,d,h,u))),c.domain&&p.push(fne(e,n,i.domain,f)),c.title&&p.push(mne(e,n,i.title,f)),dg(Wc({role:kZ,from:f,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function bne(e,t){var n={enter:{},update:{}};return Dt(n,{orient:e("orient"),offset:e("offset")||0,position:Ei(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function pN(e,t,n){var i=G(e.signals),r=G(e.scales);return n||i.forEach(a=>_F(a,t)),G(e.projections).forEach(a=>Kee(a,t)),r.forEach(a=>Pee(a,t)),G(e.data).forEach(a=>ene(a,t)),r.forEach(a=>zee(a,t)),(n||i).forEach(a=>yee(a,t)),G(e.axes).forEach(a=>yne(a,t)),G(e.marks).forEach(a=>dg(a,t)),G(e.legends).forEach(a=>Ute(a,t)),e.title&&Xte(e.title,t),t.parseLambdas(),t}const wne=e=>yl({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function xne(e,t){const n=t.config,i=ne(t.root=t.add(tg())),r=Ene(e,n);r.forEach(u=>_F(u,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(ki()),o=t.add(MF(EF(wne(e.encode),lg,Uw,e.style,t,{pulse:ne(a)}))),s=t.add(PF({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:ne(o)}));t.operators.pop(),t.pushState(ne(o),ne(s),null),pN(e,t,r),t.operators.push(s);let l=t.add(NF({mark:i,pulse:ne(s)}));return l=t.add(LF({pulse:ne(l)})),l=t.add(Wo({pulse:ne(l)})),t.addData("root",new Ho(t,a,a,l)),t}function Hc(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Ene(e,t){const n=o=>Ei(e[o],t[o]),i=[Hc("background",n("background")),Hc("autosize",wZ(n("autosize"))),Hc("padding",EZ(n("padding"))),Hc("width",n("width")||0),Hc("height",n("height")||0)],r=i.reduce((o,s)=>(o[s.name]=s,o),{}),a={};return G(e.signals).forEach(o=>{Q(r,o.name)?o=fe(r[o.name],o):i.push(o),a[o.name]=o}),G(t.signals).forEach(o=>{!Q(a,o.name)&&!Q(r,o.name)&&i.push(o)}),i}function gN(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function mN(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var ce=gN.prototype=mN.prototype;ce.parse=function(e){return pN(e,this)},ce.fork=function(){return new mN(this)},ce.isSubscope=function(){return this._subid>0},ce.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},ce.id=function(){return(this._subid?this._subid+":":0)+this._id++},ce.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},ce.proxy=function(e){var t=e instanceof Gw?ne(e):e;return this.add(Fee({value:t}))},ce.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},ce.addUpdate=function(e){return this.updates.push(e),e},ce.finish=function(){var e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,a,o){var s,l;r&&(s=r.data||(r.data={}),l=s[a]||(s[a]=[]),l.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(var i in t.index)n(t.index[i],e,"index:"+i)}return this},ce.pushState=function(e,t,n){this._encode.push(ne(this.add(Wo({pulse:e})))),this._parent.push(t),this._lookup.push(n?ne(this.proxy(n)):null),this._markpath.push(-1)},ce.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},ce.parent=function(){return ve(this._parent)},ce.encode=function(){return ve(this._encode)},ce.lookup=function(){return ve(this._lookup)},ce.markpath=function(){var e=this._markpath;return++e[e.length-1]},ce.fieldRef=function(e,t){if(Y(e))return Lc(e,t);e.signal||F("Unsupported field reference: "+B(e));var n=e.signal,i=this.field[n],r;return i||(r={name:this.signalRef(n)},t&&(r.as=t),this.field[n]=i=ne(this.add(kee(r)))),i},ce.compareRef=function(e){function t(o){return bt(o)?(i=!0,n.signalRef(o.signal)):QZ(o)?(i=!0,n.exprRef(o.expr)):o}var n=this,i=!1,r=G(e.field).map(t),a=G(e.order).map(t);return i?ne(this.add(IF({fields:r,orders:a}))):AF(r,a)},ce.keyRef=function(e,t){function n(a){return bt(a)?(r=!0,ne(i[a.signal])):a}var i=this.signals,r=!1;return e=G(e).map(n),r?ne(this.add(_ee({fields:e,flat:t}))):VZ(e,t)},ce.sortRef=function(e){if(!e)return e;var t=ng(e.op,e.field),n=e.order||XZ;return n.signal?ne(this.add(IF({fields:t,orders:this.signalRef(n.signal)}))):AF(t,n)},ce.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},ce.hasOwnSignal=function(e){return Q(this.signals,e)},ce.addSignal=function(e,t){this.hasOwnSignal(e)&&F("Duplicate signal name: "+B(e));var n=t instanceof Gw?t:this.add(tg(t));return this.signals[e]=n},ce.getSignal=function(e){return this.signals[e]||F("Unrecognized signal name: "+B(e)),this.signals[e]},ce.signalRef=function(e){return this.signals[e]?ne(this.signals[e]):(Q(this.lambdas,e)||(this.lambdas[e]=this.add(tg(null))),ne(this.lambdas[e]))},ce.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],r=Ki(i,this),a=this.lambdas[i];a.params=r.$params,a.update=r.$expr}},ce.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},ce.objectProperty=function(e){return!e||!K(e)?e:this.signalRef(e.signal||dx(e))};function dx(e){return(I(e)?kne:_ne)(e)}function kne(e){for(var t="[",n=0,i=e.length,r;n<i;++n)r=e[n],t+=(n>0?",":"")+(K(r)?r.signal||dx(r):B(r));return t+"]"}function _ne(e){var t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+B(i)+":"+(K(r)?r.signal||dx(r):B(r));return t+"}"}ce.exprRef=function(e,t){var n={expr:Ki(e,this)};return t&&(n.expr.$name=t),ne(this.add(xee(n)))},ce.addBinding=function(e,t){this.bindings||F("Nested signals do not support binding: "+B(e)),this.bindings.push(fe({signal:e},t))},ce.addScaleProj=function(e,t){Q(this.scales,e)&&F("Duplicate scale or projection name: "+B(e)),this.scales[e]=this.add(t)},ce.addScale=function(e,t){this.addScaleProj(e,Iee(t))},ce.addProjection=function(e,t){this.addScaleProj(e,Ree(t))},ce.getScale=function(e){return this.scales[e]||F("Unrecognized scale name: "+B(e)),this.scales[e]},ce.projectionRef=ce.scaleRef=function(e){return ne(this.getScale(e))},ce.projectionType=ce.scaleType=function(e){return this.getScale(e).params.type},ce.addData=function(e,t){return Q(this.data,e)&&F("Duplicate data set name: "+B(e)),this.data[e]=t},ce.getData=function(e){return this.data[e]||F("Undefined data set name: "+B(e)),this.data[e]},ce.addDataPipeline=function(e,t){return Q(this.data,e)&&F("Duplicate data set name: "+B(e)),this.addData(e,Ho.fromEntries(this,t))};function Ane(){const e="sans-serif",t=30,n=2,i="#4c78a8",r="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:n},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:n},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:a,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:a,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Sne(e,t,n){return K(e)||F("Input Vega specification must be an object."),t=Kl(Ane(),t,e.config),xne(e,new gN(t,n)).toRuntime()}HE(Fs,u9,_W,fG,sY,QY,nX,oX,_X,IX,qX);var One=Object.freeze({__proto__:null,version:WX,Dataflow:Rs,EventStream:sd,Parameters:od,Pulse:ra,MultiPulse:z0,Operator:Fe,Transform:$,changeset:so,ingest:ke,isTuple:rd,definition:X_,transform:J_,transforms:Fs,tupleid:ee,scale:Ee,scheme:yb,interpolate:vb,interpolateColors:Fh,interpolateRange:IT,quantizeInterpolator:MT,projection:O1,View:hF,formatLocale:md,timeFormatLocale:hu,locale:z_,defaultLocale:L0,resetDefaultLocale:p4,expressionFunction:vt,parse:Sne,runtimeContext:iF,bandwidthNRD:Y0,bin:nA,bootstrapCI:iA,dotbin:rA,quantiles:G0,quartiles:H0,get random(){return Wn},setRandom:X4,randomLCG:K4,randomInteger:Q4,randomKDE:J0,randomLogNormal:oA,sampleLogNormal:K0,densityLogNormal:Q0,cumulativeLogNormal:Z0,quantileLogNormal:ev,randomMixture:sA,randomNormal:X0,sampleNormal:Sd,densityNormal:V0,cumulativeNormal:Od,quantileNormal:Td,randomUniform:lA,sampleUniform:tv,densityUniform:nv,cumulativeUniform:iv,quantileUniform:rv,regressionLinear:av,regressionLog:uA,regressionExp:cA,regressionPow:fA,regressionQuad:ov,regressionPoly:dA,regressionLoess:gA,sampleCurve:$d,TIME_UNITS:g0,YEAR:_t,QUARTER:hn,MONTH:Nt,WEEK:ot,DATE:pn,DAY:It,DAYOFYEAR:Ii,HOURS:Fn,MINUTES:Nn,SECONDS:qn,MILLISECONDS:fi,timeUnitSpecifier:Jk,timeUnits:v0,dayofyear:i_,week:r_,utcdayofyear:o_,utcweek:s_,timeFloor:c_,utcFloor:f_,timeInterval:Os,timeOffset:h_,timeSequence:m_,utcInterval:Ts,utcOffset:p_,utcSequence:v_,timeBin:E_,accessor:gr,accessorName:TP,accessorFields:FE,id:DP,identity:Hm,zero:RP,one:FP,truthy:NP,falsy:IP,logger:MP,None:IE,Error:ME,Warn:jE,Info:LE,Debug:PE,mergeConfig:jP,writeConfig:qf,panLinear:PP,panLog:zP,panPow:BP,panSymlog:UP,zoomLinear:qP,zoomLog:WP,zoomPow:GP,zoomSymlog:HP,quarter:YP,utcquarter:VP,array:Yl,clampRange:XP,compare:KP,constant:tz,debounce:nz,error:Pf,extend:HE,extent:iz,extentIndex:rz,fastmap:oz,field:Gm,flush:sz,hasOwnProperty:eo,inherits:lz,inrange:uz,isArray:Bf,isBoolean:cz,isDate:YE,isFunction:Vm,isNumber:VE,isObject:Uf,isRegExp:fz,isString:XE,key:dz,lerp:hz,lruCache:gz,merge:mz,pad:vz,peek:xs,repeat:Vl,span:yz,splitAccessPath:Wm,stringValue:JE,toBoolean:bz,toDate:xz,toNumber:Ym,toString:Ez,toSet:kz,truncate:_z,visitArray:Az,read:B_,inferType:Ek,inferTypes:kk,typeParsers:e0,format:ud,formats:o0,responseType:Rk,loader:kd,Bounds:st,Gradient:ZA,GroupItem:Yd,ResourceLoader:sy,Item:Hd,Scenegraph:Ay,Handler:pa,Renderer:vi,CanvasHandler:Iu,CanvasRenderer:gh,SVGHandler:$y,SVGRenderer:Ob,SVGStringRenderer:$b,RenderType:wa,renderModule:jh,intersect:pC,Marks:Yn,boundClip:yC,boundContext:gn,boundStroke:Er,boundItem:_y,boundMark:rO,pathCurves:ty,pathSymbols:OS,pathRectangle:TS,pathTrail:CS,pathParse:Ps,pathRender:ku,point:lh,domCreate:ha,domFind:Sy,domChild:In,domClear:mi,openTag:We,closeTag:Ye,font:oh,fontFamily:Du,fontSize:zi,lineHeight:fa,multiLineOffset:xy,textMetrics:Ys,sceneEqual:Rb,pathEqual:bC,sceneToJSON:aO,sceneFromJSON:oO,intersectPath:uy,intersectPoint:cy,intersectRule:zS,intersectBoxLine:Us,sceneZOrder:fy,sceneVisit:gi,scenePickVisit:Zd,resetSVGClipId:DS,resetSVGDefIds:Yq});const Tne="vega-lite",Cne='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',$ne="4.13.1",Dne=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Rne="https://vega.github.io/vega-lite/",Fne="Vega-Lite is a concise high-level language for interactive visualization.",Nne="build/vega-lite.js",Ine="build/vega-lite.min.js",Mne="build/vega-lite.min.js",jne="build/src/index",Lne="build/src/index.d.ts",Pne={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},zne={test:"test"},Bne={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},Une={type:"git",url:"https://github.com/vega/vega-lite.git"},qne="BSD-3-Clause",Wne={url:"https://github.com/vega/vega-lite/issues"},Gne={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},Hne={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},Yne={vega:"^5.12.1"},Vne={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1};var Xne={name:Tne,author:Cne,version:$ne,collaborators:Dne,homepage:Rne,description:Fne,main:Nne,unpkg:Ine,jsdelivr:Mne,module:jne,types:Lne,bin:Pne,directories:zne,scripts:Bne,repository:Une,license:qne,bugs:Wne,devDependencies:Gne,dependencies:Hne,peerDependencies:Yne,jest:Vne};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Jne=Tm(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch(d){i=function(){}}var r;try{r=Set}catch(d){r=function(){}}var a;try{a=Promise}catch(d){a=function(){}}function o(d,h,p,g,m){typeof h=="object"&&(p=h.depth,g=h.prototype,m=h.includeNonEnumerable,h=h.circular);var v=[],y=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof p=="undefined"&&(p=Infinity);function E(x,k){if(x===null)return null;if(k===0)return x;var w,A;if(typeof x!="object")return x;if(n(x,i))w=new i();else if(n(x,r))w=new r();else if(n(x,a))w=new a(function(W,X){x.then(function(J){W(E(J,k-1))},function(J){X(E(J,k-1))})});else if(o.__isArray(x))w=[];else if(o.__isRegExp(x))w=new RegExp(x.source,f(x)),x.lastIndex&&(w.lastIndex=x.lastIndex);else if(o.__isDate(x))w=new Date(x.getTime());else{if(b&&Buffer.isBuffer(x))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(x.length):w=new Buffer(x.length),x.copy(w),w;n(x,Error)?w=Object.create(x):typeof g=="undefined"?(A=Object.getPrototypeOf(x),w=Object.create(A)):(w=Object.create(g),A=g)}if(h){var _=v.indexOf(x);if(_!=-1)return y[_];v.push(x),y.push(w)}n(x,i)&&x.forEach(function(W,X){var J=E(X,k-1),xe=E(W,k-1);w.set(J,xe)}),n(x,r)&&x.forEach(function(W){var X=E(W,k-1);w.add(X)});for(var O in x){var S;if(A&&(S=Object.getOwnPropertyDescriptor(A,O)),S&&S.set==null)continue;w[O]=E(x[O],k-1)}if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(x),O=0;O<T.length;O++){var D=T[O],M=Object.getOwnPropertyDescriptor(x,D);if(M&&!M.enumerable&&!m)continue;w[D]=E(x[D],k-1),M.enumerable||Object.defineProperty(w,D,{enumerable:!1})}if(m)for(var C=Object.getOwnPropertyNames(x),O=0;O<C.length;O++){var N=C[O],M=Object.getOwnPropertyDescriptor(x,N);if(M&&M.enumerable)continue;w[N]=E(x[N],k-1),Object.defineProperty(w,N,{enumerable:!1})}return w}return E(d,p)}o.clonePrototype=function(h){if(h===null)return null;var p=function(){};return p.prototype=h,new p()};function s(d){return Object.prototype.toString.call(d)}o.__objToStr=s;function l(d){return typeof d=="object"&&s(d)==="[object Date]"}o.__isDate=l;function u(d){return typeof d=="object"&&s(d)==="[object Array]"}o.__isArray=u;function c(d){return typeof d=="object"&&s(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)}),Kne=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,a;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),i=a.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;r--!==0;){var o=a[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},Yc=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(a){return function(o){return function(s,l){var u={key:s,value:o[s]},c={key:l,value:o[l]};return a(u,c)}}}(t.cmp),r=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var s,l;if(Array.isArray(o)){for(l="[",s=0;s<o.length;s++)s&&(l+=","),l+=a(o[s])||"null";return l+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=r.push(o)-1,c=Object.keys(o).sort(i&&i(o));for(l="",s=0;s<c.length;s++){var f=c[s],d=a(o[f]);if(!d)continue;l&&(l+=","),l+=JSON.stringify(f)+":"+d}return r.splice(u,1),"{"+l+"}"}(e)};function hx(e){return!!e.or}function px(e){return!!e.and}function gx(e){return!!e.not}function pg(e,t){if(gx(e))pg(e.not,t);else if(px(e))for(const n of e.and)pg(n,t);else if(hx(e))for(const n of e.or)pg(n,t);else t(e)}function gg(e,t){return gx(e)?{not:gg(e.not,t)}:px(e)?{and:e.and.map(n=>gg(n,t))}:hx(e)?{or:e.or.map(n=>gg(n,t))}:t(e)}const Vc=Kne,pe=Jne;function Xc(e,t){const n={};for(const i of t)Q(e,i)&&(n[i]=e[i]);return n}function Ir(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Yc(e)).join(",")})`};const Ue=Yc;function we(e){if(Re(e))return e;const t=Y(e)?e:Yc(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function vN(e){return e===!1||e===null}function ae(e,t){return e.indexOf(t)>-1}function Jc(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function yN(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function Qne(e,...t){for(const n of t)Zne(e,n??{});return e}function Zne(e,t){for(const n of z(t))Xm(e,n,t[n],!0)}function Aa(e,t){const n=[],i={};let r;for(const a of e){if(r=t(a),r in i)continue;i[r]=1,n.push(a)}return n}function eie(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function bN(e,t){for(const n of e)if(t.has(n))return!0;return!1}function wN(e){const t=new Set();for(const n of e){const i=mr(n),r=i.map((o,s)=>s===0?o:`[${o}]`),a=r.map((o,s)=>r.slice(0,s+1).join(""));for(const o of a)t.add(o)}return t}function xN(e,t){return e===void 0||t===void 0?!0:bN(wN(e),wN(t))}function Ne(e){return z(e).length===0}const z=Object.keys,Sa=Object.values;function EN(e){const t=[];for(const n in e)Q(e,n)&&t.push({key:n,value:e[n]});return t}function mg(e){return e===!0||e===!1}function qe(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Kc(e,t){return gx(e)?"!("+Kc(e.not,t)+")":px(e)?"("+e.and.map(n=>Kc(n,t)).join(") && (")+")":hx(e)?"("+e.or.map(n=>Kc(n,t)).join(") || (")+")":t(e)}function mx(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&mx(e[n],t)&&delete e[n],Ne(e)}function vg(e){return e.charAt(0).toUpperCase()+e.substr(1)}function kN(e,t="datum"){const n=mr(e),i=[];for(let r=1;r<=n.length;r++){const a=`[${n.slice(0,r).map(B).join("][")}]`;i.push(`${t}${a}`)}return i.join(" && ")}function tie(e,t="datum"){return`${t}[${B(mr(e).join("."))}]`}function nie(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Oa(e){return`${mr(e).map(nie).join("\\.")}`}function Sl(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function _N(e){return`${mr(e).join(".")}`}function Qc(e){return e?mr(e).length:0}function rt(...e){for(const t of e)if(t!==void 0)return t;return}let iie=42;function rie(e){const t=++iie;return e?String(e)+t:t}function aie(e){return oie(e)?e:`__${e}`}function oie(e){return e.indexOf("__")===0}function yg(e){return e===void 0?void 0:(e%360+360)%360}function vx(e){return Re(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const AN={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function yx(e){return e&&e.condition}const SN=["domain","grid","labels","ticks","title"],sie={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},ON={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},lie=Object.assign(Object.assign({},ON),{style:1,labelExpr:1,encoding:1});function TN(e){return!!lie[e]}const rn={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},CN=rn.arc,bg=rn.area,wg=rn.bar,uie=rn.image,xg=rn.line,Eg=rn.point,cie=rn.rect,kg=rn.rule,$N=rn.text,bx=rn.tick,fie=rn.trail,wx=rn.circle,xx=rn.square,DN=rn.geoshape;function Xo(e){return ae(["line","area","trail"],e)}function RN(e){return ae(["rect","bar","image","arc"],e)}const FN=z(rn);function Qi(e){return e.type}const Mde=kt(FN),die=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],hie=["fill","fillOpacity"],pie=[...die,...hie],gie={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},NN=z(gie),mie={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},vie={color:"#4c78a8",invalid:"filter",timeUnitBand:1},yie={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},IN=5,bie={binSpacing:1,continuousBandSize:IN,timeUnitBandPosition:.5},wie={binSpacing:0,continuousBandSize:IN,timeUnitBandPosition:.5},xie={thickness:1};function Eie(e){return Qi(e)?e.type:e}function Mr(e){return"mark"in e}class _g{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return Mr(e)?Eie(e.mark)===this.name:!1}}const kie={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},_ie={count:1,min:1,max:1};function Ta(e){return!!e&&!!e.argmin}function Jo(e){return!!e&&!!e.argmax}function Ex(e){return Y(e)&&!!kie[e]}const Aie=["count","valid","missing","distinct"];function MN(e){return Y(e)&&ae(Aie,e)}function Sie(e){return Y(e)&&ae(["min","max"],e)}const Oie=["count","sum","distinct","valid","missing"],Tie=["mean","average","median","q1","q3","min","max"],Cie=kt(Tie),jr="row",Lr="column",Ag="facet",He="x",ct="y",Si="x2",Zi="y2",er="radius",Pr="radius2",Oi="theta",zr="theta2",tr="latitude",nr="longitude",Ti="latitude2",ni="longitude2",An="color",ir="fill",rr="stroke",Sn="shape",Br="size",Ko="angle",Ur="opacity",Ca="fillOpacity",$a="strokeOpacity",Da="strokeWidth",Ra="strokeDash",Zc="text",ef="order",tf="detail",Sg="key",Qo="tooltip",Og="href",Tg="url",Cg="description",$ie={x:1,y:1,x2:1,y2:1},jN={theta:1,theta2:1,radius:1,radius2:1};function LN(e){return e in jN}const kx={longitude:1,longitude2:1,latitude:1,latitude2:1};function Die(e){switch(e){case tr:return"y";case Ti:return"y2";case nr:return"x";case ni:return"x2"}}function Rie(e){return e in kx}const Fie=z(kx),PN=Object.assign(Object.assign(Object.assign(Object.assign({},$ie),jN),kx),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Ol(e){return e===An||e===ir||e===rr}const zN={row:1,column:1,facet:1},ii=z(zN),_x=Object.assign(Object.assign({},PN),zN),BN=z(_x),Nie=Z(_x,["order","detail","tooltip"]),Iie=Z(Nie,["row","column","facet"]);function Mie(e){return!!Iie[e]}function UN(e){return!!_x[e]}const jie=[Si,Zi,Ti,ni,zr,Pr];function qN(e){const t=Zo(e);return t!==e}function Zo(e){switch(e){case Si:return He;case Zi:return ct;case Ti:return tr;case ni:return nr;case zr:return Oi;case Pr:return er}return e}function Fa(e){if(LN(e))switch(e){case Oi:return"startAngle";case zr:return"endAngle";case er:return"outerRadius";case Pr:return"innerRadius"}return e}function ar(e){switch(e){case He:return Si;case ct:return Zi;case tr:return Ti;case nr:return ni;case Oi:return zr;case er:return Pr}return}function or(e){switch(e){case He:case Si:return"width";case ct:case Zi:return"height"}return}function Lie(e){switch(e){case He:return"xOffset";case ct:return"yOffset";case Si:return"x2Offset";case Zi:return"y2Offset";case Oi:return"thetaOffset";case er:return"radiusOffset";case zr:return"theta2Offset";case Pr:return"radius2Offset"}return}const Ax=Z(PN,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Pie=z(Ax),Na={x:1,y:1},ri=z(Na);function sr(e){return e in Na}const Sx={theta:1,radius:1},zie=z(Sx);function $g(e){return e==="width"?He:ct}const WN=Z(Ax,["text","tooltip","href","url","description","detail","key","order"]),Bie=z(WN);function Uie(e){return!!Ax[e]}function qie(e){switch(e){case An:case ir:case rr:case Br:case Sn:case Ur:case Da:case Ra:return!0;case Ca:case $a:case Ko:return!1}}const GN=Object.assign(Object.assign(Object.assign({},Na),Sx),WN),Dg=z(GN);function Ia(e){return!!GN[e]}function Wie(e,t){return Hie(e)[t]}const HN={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Gie=Z(HN,["geoshape"]);function Hie(e){switch(e){case An:case ir:case rr:case Cg:case tf:case Sg:case Qo:case Og:case ef:case Ur:case Ca:case $a:case Da:case Ag:case jr:case Lr:return HN;case He:case ct:case tr:case nr:return Gie;case Si:case Zi:case Ti:case ni:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Br:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Ra:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Sn:return{point:"always",geoshape:"always"};case Zc:return{text:"always"};case Ko:return{point:"always",square:"always",text:"always"};case Tg:return{image:"always"};case Oi:return{text:"always",arc:"always"};case er:return{text:"always",arc:"always"};case zr:case Pr:return{arc:"always"}}}function Rg(e){switch(e){case He:case ct:case Oi:case er:case Br:case Ko:case Da:case Ur:case Ca:case $a:case Si:case Zi:case zr:case Pr:return;case Ag:case jr:case Lr:case Sn:case Ra:case Zc:case Qo:case Og:case Tg:case Cg:return"discrete";case An:case ir:case rr:return"flexible";case tr:case nr:case Ti:case ni:case tf:case Sg:case ef:return}}function YN(e){return io(e)&&(e=Wg(e,void 0)),"bin"+z(e).map(t=>Fg(e[t])?qe(`_${t}_${Object.entries(e[t])}`):qe(`_${t}_${e[t]}`)).join("")}function Me(e){return e===!0||nf(e)&&!e.binned}function an(e){return e==="binned"||nf(e)&&e.binned===!0}function nf(e){return K(e)}function Fg(e){return e==null?void 0:e.selection}function VN(e){switch(e){case jr:case Lr:case Br:case An:case ir:case rr:case Da:case Ur:case Ca:case $a:case Sn:return 6;case Ra:return 4;default:return 10}}function Ox(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Yie='Autosize "fit" only works for single views and layered views.';function XN(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function JN(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function KN(e){return e?`Dropping "fit-${e}" because spec has discrete ${or(e)}.`:'Dropping "fit" because spec has discrete size.'}function QN(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Vie(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Xie(e){return`The "nearest" transform is not supported for ${e} marks.`}function ZN(e){return`Selection not supported for ${e} yet.`}function Jie(e){return`Cannot find a selection named "${e}".`}const Kie="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Qie="Legend bindings are only supported for selections over an individual field or encoding channel.";function Zie(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function ere(e){return`Unknown repeated value "${e}".`}function eI(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const tre="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function nre(e){return`Unrecognized parse "${e}".`}function tI(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function ire(e){return`Ignoring an invalid transform: ${Ue(e)}.`}const rre='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function nI(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function are(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function ore(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Ue(t)} is overridden by a child projection ${Ue(n)}.`}const sre="Arc marks uses theta channel rather than angle, replacing angle with theta.";function lre(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Ue(n)}}.`}function iI(e){return`Invalid field type "${e}".`}function ure(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function cre(e){return`Invalid aggregation operator "${e}".`}function fre(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function rI(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Tx(e,t){return`Dropping ${Ue(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const dre="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ng(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function hre(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function pre(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function gre(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Cx(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function mre(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function vre(e,t){return`Specified orient "${e}" overridden with "${t}".`}const yre=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function bre(e){return`Cannot use the scale property "${e}" with non-color channel.`}function wre(e){return`Using unaggregated domain with raw field has no effect (${Ue(e)}).`}function xre(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Ere(e){return`Unaggregated domain is currently unsupported for log scale (${Ue(e)}).`}function kre(e){return`Cannot apply size to non-oriented mark "${e}".`}function _re(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Are(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function aI(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function oI(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Sre(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ue(n)} and ${Ue(i)}). Using ${Ue(n)}.`}function Ore(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ue(n)} and ${Ue(i)}). Using the union of the two domains.`}function Tre(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Cre(e){return`Dropping sort property ${Ue(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const sI="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",$re="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Dre="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Rre="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Fre(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Nre(e){return`Cannot stack non-linear scale (${e}).`}function Ire(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Ig(e,t){return`Invalid ${e}: ${Ue(t)}.`}function Mre(e){return`Dropping day from datetime ${Ue(e)} as day cannot be combined with other units.`}function jre(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Lre(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Pre(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function zre(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function lI(e){return`1D error band does not support ${e}.`}function uI(e){return`Channel ${e} is required for "binned" bin.`}function Bre(e){return`Domain for ${e} is required for threshold scale.`}const cI=ek(ZE);let Tl=cI;function Ure(e){return Tl=e,Tl}function qre(){return Tl=cI,Tl}function j(...e){Tl.warn(...e)}function Wre(...e){Tl.debug(...e)}function Cl(e){if(e&&K(e)){for(const t of Dx)if(t in e)return!0}return!1}const fI=["january","february","march","april","may","june","july","august","september","october","november","december"],Gre=fI.map(e=>e.substr(0,3)),dI=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Hre=dI.map(e=>e.substr(0,3));function Yre(e){if(vx(e)&&(e=+e),Re(e))return e>4&&j(Ig("quarter",e)),e-1;throw new Error(Ig("quarter",e))}function Vre(e){if(vx(e)&&(e=+e),Re(e))return e-1;{const t=e.toLowerCase(),n=fI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Gre.indexOf(i);if(r!==-1)return r;throw new Error(Ig("month",e))}}function Xre(e){if(vx(e)&&(e=+e),Re(e))return e%7;{const t=e.toLowerCase(),n=dI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Hre.indexOf(i);if(r!==-1)return r;throw new Error(Ig("day",e))}}function $x(e,t){const n=[];if(t&&e.day!==void 0&&(z(e).length>1&&(j(Mre(e)),e=pe(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Vre(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Yre(e.quarter):e.quarter;n.push(Re(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Xre(e.day):e.day;n.push(Re(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function rf(e){const t=$x(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Jre(e){const t=$x(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Kre(e){const t=$x(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const hI={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Dx=z(hI);function Qre(e){return!!hI[e]}function Rx(e){return e.startsWith("utc")}function Zre(e){return e.substr(3)}const eae={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Fx(e){const t=[];for(const n of Dx)pI(e,n)&&t.push(n);return t}function pI(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function tae(e,t,{end:n}={end:!1}){const i=kN(t),r=Rx(e)?"utc":"";function a(l){return l==="quarter"?`(${r}quarter(${i})-1)`:`${r}${l}(${i})`}let o;const s={};for(const l of Dx)pI(e,l)&&(s[l]=a(l),o=l);return n&&(s[o]+="+1"),Jre(s)}function gI(e){if(!e)return;const t=Fx(e);return`timeUnitSpecifier(${Yc(t)}, ${Yc(eae)})`}function nae(e,t,n){if(!e)return;const i=gI(e),r=n||Rx(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function on(e){if(!e)return;let t;return Y(e)?t={unit:e}:K(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Rx(t.unit)&&(t.utc=!0,t.unit=Zre(t.unit)),t}function iae(e){const t=on(e),{utc:n}=t,i=Z(t,["utc"]);return i.unit?(n?"utc":"")+z(i).map(r=>qe(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+z(i).map(r=>qe(`_${r}_${i[r]}`)).join("")}function oe(e){return e&&!!e.signal}function Ma(e){return!!e.step}function rae(e){return I(e)?!1:"fields"in e&&!("data"in e)}function aae(e){return I(e)?!1:"fields"in e&&"data"in e}function ja(e){return I(e)?!1:"field"in e&&"data"in e}const oae={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},sae=z(oae),lae={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Nx=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function uae(e){return e==null?void 0:e.selection}function Ix(e){return e&&!!e.field&&e.equal!==void 0}function mI(e){return e&&!!e.field&&e.lt!==void 0}function vI(e){return e&&!!e.field&&e.lte!==void 0}function yI(e){return e&&!!e.field&&e.gt!==void 0}function bI(e){return e&&!!e.field&&e.gte!==void 0}function Mx(e){if(e&&e.field){if(I(e.range)&&e.range.length===2)return!0;if(oe(e.range))return!0}return!1}function jx(e){return e&&!!e.field&&(I(e.oneOf)||I(e.in))}function cae(e){return e&&!!e.field&&e.valid!==void 0}function wI(e){return jx(e)||Ix(e)||Mx(e)||mI(e)||yI(e)||vI(e)||bI(e)}function lr(e,t){return t2(e,{timeUnit:t,wrapTime:!0})}function fae(e,t){return e.map(n=>lr(n,t))}function xI(e,t=!0){var n;const{field:i}=e,r=(n=on(e.timeUnit))===null||n===void 0?void 0:n.unit,a=r?"time("+tae(r,i)+")":U(e,{expr:"datum"});if(Ix(e))return a+"==="+lr(e.equal,r);if(mI(e)){const o=e.lt;return`${a}<${lr(o,r)}`}else if(yI(e)){const o=e.gt;return`${a}>${lr(o,r)}`}else if(vI(e)){const o=e.lte;return`${a}<=${lr(o,r)}`}else if(bI(e)){const o=e.gte;return`${a}>=${lr(o,r)}`}else{if(jx(e))return`indexof([${fae(e.oneOf,r).join(",")}], ${a}) !== -1`;if(cae(e))return Lx(a,e.valid);if(Mx(e)){const{range:o}=e,s=oe(o)?{signal:`${o.signal}[0]`}:o[0],l=oe(o)?{signal:`${o.signal}[1]`}:o[1];if(s!==null&&l!==null&&t)return"inrange("+a+", ["+lr(s,r)+", "+lr(l,r)+"])";const u=[];return s!==null&&u.push(`${a} >= ${lr(s,r)}`),l!==null&&u.push(`${a} <= ${lr(l,r)}`),u.length>0?u.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function Lx(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function dae(e){var t;return wI(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=on(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const $l={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},es=$l.quantitative,Px=$l.ordinal,Dl=$l.temporal,zx=$l.nominal,Rl=$l.geojson,hae=z($l);function pae(e){if(e){e=e.toLowerCase();switch(e){case"q":case es:return"quantitative";case"t":case Dl:return"temporal";case"o":case Px:return"ordinal";case"n":case zx:return"nominal";case Rl:return"geojson"}}return}const at={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Bx={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},gae=z(Bx);function mae(e,t){const n=Bx[e],i=Bx[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const vae={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function EI(e){return vae[e]}const kI=["linear","log","pow","sqrt","symlog","time","utc"],yae=kt(kI),bae=["linear","log","pow","sqrt","symlog"],wae=kt(bae);function xae(e){return e in wae}const Eae=["quantile","quantize","threshold"],kae=kt(Eae),_ae=kI.concat(["quantile","quantize","threshold","sequential","identity"]),Aae=kt(_ae),Sae=["ordinal","bin-ordinal","point","band"],Oae=kt(Sae);function On(e){return e in Oae}function ai(e){return e in Aae}function Ci(e){return e in yae}function Mg(e){return e in kae}const Tae={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Cae(e){return!Y(e)&&!!e.name}function _I(e){return e==null?void 0:e.selection}function $ae(e){return e&&e.unionWith}const Dae={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Rae=Z(Dae,["type","domain","range","scheme"]),Fae=z(Rae),jde=Nae();function AI(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!ae(["point","band","identity"],e);case"bins":return!ae(["point","band","identity","ordinal"],e);case"round":return Ci(e)||e==="band"||e==="point";case"padding":return Ci(e)||ae(["point","band"],e);case"paddingOuter":case"align":return ae(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return Ci(e);case"nice":return Ci(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ai(e)&&!ae(["log","time","utc","threshold","quantile"],e)}}function SI(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Ol(e)?void 0:bre(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function OI(e,t){return ae([Px,zx],t)?e===void 0||On(e):t===Dl?ae([at.TIME,at.UTC,void 0],e):t===es?ae([at.LOG,at.POW,at.SQRT,at.SYMLOG,at.QUANTILE,at.QUANTIZE,at.THRESHOLD,at.LINEAR,void 0],e):!0}function TI(e,t){if(!Ia(e))return!1;switch(e){case He:case ct:case Oi:case er:return Ci(t)||ae(["band","point"],t);case Br:case Da:case Ur:case Ca:case $a:case Ko:return Ci(t)||Mg(t)||ae(["band","point","ordinal"],t);case An:case ir:case rr:return t!=="band";case Ra:return t==="ordinal"||Mg(t);case Sn:return t==="ordinal"}}function Nae(){var e;const t={};for(const n of BN)for(const i of hae)for(const r of gae){const a=Iae(n,i);TI(n,r)&&OI(r,i)&&(t[a]=(e=t[a])!==null&&e!==void 0?e:[],t[a].push(r))}return t}function Iae(e,t){return e+"_"+t}function Ux(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:a}=e,o=$I(e);return q(n)&&!MN(n.aggregate)&&r&&Ci(r.get("type"))&&r.get("zero")===!1?CI({fieldDef:n,channel:t,markDef:i,ref:o,config:a}):o}function CI({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(Xo(n.type))return i;const a=Se("invalid",n,r);return a===null?i:[Mae(e,t),i]}function Mae(e,t){const n=qx(e,!0),i=Zo(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function qx(e,t=!0){return Lx(Y(e)?e:U(e,{expr:"datum"}),!t)}function jae(e){const{datum:t}=e;return Cl(t)?rf(t):`${JSON.stringify(t)}`}function ts(e,t,n,i){const r={};if(t&&(r.scale=t),Pa(e)){const{datum:a}=e;Cl(a)?r.signal=rf(a):oe(a)?r.signal=a.signal:r.value=a}else r.field=U(e,n);if(i){const{offset:a,band:o}=i;a&&(r.offset=a),o&&(r.band=o)}return r}function jg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=U(t,{expr:o,suffix:r}),l=n!==void 0?U(n,{expr:o}):U(t,{suffix:"end",expr:o}),u={};if(a===0||a===1){u.scale=e;const c=a===0?s:l;u.field=c}else{const c=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${c})`}return i&&(u.offset=i),u}function $I({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(se(t)){if(Bn(t)){c=c??sf({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:s,config:r,isMidPoint:!0});const{bin:h,timeUnit:p,type:g}=t;if(Me(h)||c&&p&&g===Dl)return s&&s.impute?ts(t,a,{binSuffix:"mid"},{offset:l}):c?jg({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):ts(t,a,lf(t,e)?{binSuffix:"range"}:{},{offset:l});if(an(h)){if(q(n))return jg({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});{const m=e===He?Si:Zi;j(uI(m))}}}const d=o==null?void 0:o.get("type");return ts(t,a,On(d)?{binSuffix:"range"}:{},{offset:l,band:d==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(qr(t)){const d=t.value,h=l?{offset:l}:{};return Object.assign(Object.assign({},af(e,d)),h)}}return ge(u)&&(u=u()),u&&Object.assign(Object.assign({},u),l?{offset:l}:{})}function af(e,t){return ae(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:ae(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:nt(t)}function ns(e){return e&&e!=="number"&&e!=="time"}function DI(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const Lae=" – ";function Wx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a}){var o,s;if(ns(n))return Gx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:a});const l=RI(e,i,r);if(Gg(e)){const u=zae(l,q(e)?(o=on(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,a.timeFormat,Kx(e)&&((s=e.scale)===null||s===void 0?void 0:s.type)===at.UTC);return u?{signal:u}:void 0}if(t=II(La(e),t,a),q(e)&&Me(e.bin)){const u=U(e,{expr:i,binSuffix:"end"});return{signal:Lg(l,u,t,n,a)}}else return t||La(e)==="quantitative"?{signal:`${MI(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function RI(e,t,n){return q(e)?n?`${U(e,{expr:t,suffix:"end"})}-${U(e,{expr:t,suffix:"start"})}`:U(e,{expr:t}):jae(e)}function Gx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a,field:o}){if(o=o??RI(e,i,r),q(e)&&Me(e.bin)){const s=U(e,{expr:i,binSuffix:"end"});return{signal:Lg(o,s,t,n,a)}}return{signal:DI(n,o,t)}}function FI(e,t,n,i,r,a){var o;if(ns(i))return;if(Gg(e)){const s=q(e)?(o=on(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Pae(n,s,r,a)}return II(t,n,r)}function NI(e,t,n){return e&&(oe(e)||e==="number"||e==="time")?e:Gg(t)&&n!=="time"&&n!=="utc"?"time":void 0}function II(e,t,n){return Y(t)?t:e===es?n.numberFormat:void 0}function Pae(e,t,n,i){return e||(t?{signal:gI(t)}:i?void 0:n.timeFormat)}function MI(e,t){return`format(${e}, "${t||""}")`}function jI(e,t,n,i){var r;return ns(n)?DI(n,e,t):MI(e,(r=Y(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Lg(e,t,n,i,r){const a=jI(e,n,i,r),o=jI(t,n,i,r);return`${Lx(e,!1)} ? "null" : ${a} + "${Lae}" + ${o}`}function zae(e,t,n,i,r){return!t||n?(n=Y(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):nae(t,e,r)}const Pg="min",Bae={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function LI(e){return e in Bae}function PI(e){return!!e&&!!e.encoding}function ur(e){return!!e&&(e.op==="count"||!!e.field)}function zI(e){return!!e&&I(e)}function of(e){return"row"in e||"column"in e}function Hx(e){return!!e&&"header"in e}function zg(e){return"facet"in e}function Uae(e){return e.selection}function qae(e){return e&&!Y(e)&&"repeat"in e}function BI(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function UI(e){return Bn(e)&&"sort"in e}function sf({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:a,isMidPoint:o}){if(se(t)&&t.band!==void 0)return t.band;if(q(t)){const{timeUnit:s,bin:l}=t;if(s&&!n)return o?as("timeUnitBandPosition",i,a):RN(i.type)?as("timeUnitBand",i,a):0;if(Me(l))return RN(i.type)&&!o?1:.5}return(r==null?void 0:r.fieldChannel)===e&&o?.5:void 0}function Yx(e,t,n,i,r,a){return Me(t.bin)||t.timeUnit&&Bn(t)&&t.type==="temporal"?!!sf({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:a}):!1}function Vx(e){return!!e&&"condition"in e}function Bg(e){const t=e&&e.condition;return!!t&&!I(t)&&q(t)}function Xx(e){const t=e&&e.condition;return!!t&&!I(t)&&se(t)}function Wae(e){const t=e&&e.condition;return!!t&&(I(t)||qr(t))}function q(e){return!!e&&(!!e.field||e.aggregate==="count")}function La(e){return e&&e.type}function Pa(e){return!!e&&"datum"in e}function cr(e){return Bn(e)&&HI(e)||Jx(e)}function Jx(e){return Pa(e)&&Re(e.datum)}function se(e){return q(e)||Pa(e)}function Bn(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function qr(e){return e&&"value"in e&&"value"in e}function Kx(e){return!!e&&("scale"in e||"sort"in e)}function Qx(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function qI(e){return!!e&&"legend"in e}function WI(e){return!!e&&("format"in e||"formatType"in e)}function Gae(e){return"op"in e}function U(e,t={}){var n,i,r;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(Hae(e))a=aie("count");else{let u;if(!t.nofn)if(Gae(e))u=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;Me(c)?(u=YN(c),s=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?Jo(f)?(l=`["${a}"]`,a=`argmax_${f.argmax}`):Ta(f)?(l=`["${a}"]`,a=`argmin_${f.argmin}`):u=String(f):d&&(u=iae(d),s=(!ae(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}u&&(a=a?`${u}_${a}`:u)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?_N(a):t.expr?tie(a,t.expr)+l:Oa(a)+l}function GI(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return q(e)&&!!e.bin;case"temporal":return!1}throw new Error(iI(e.type))}function HI(e){return!GI(e)}function Hae(e){return e.aggregate==="count"}function Yae(e,t){var n;const{field:i,bin:r,timeUnit:a,aggregate:o}=e;if(o==="count")return t.countTitle;if(Me(r))return`${i} (binned)`;if(a){const s=(n=on(a))===null||n===void 0?void 0:n.unit;if(s)return`${i} (${Fx(s).join("-")})`}else if(o)return Jo(o)?`${i} for max ${o.argmax}`:Ta(o)?`${i} for min ${o.argmin}`:`${vg(o)} of ${i}`;return i}function Vae(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(Jo(t))return`${r} for argmax(${t.argmax})`;if(Ta(t))return`${r} for argmin(${t.argmin})`;const a=on(i),o=t||(a==null?void 0:a.unit)||(a==null?void 0:a.maxbins)&&"timeunit"||Me(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const YI=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Vae(e);default:return Yae(e,t)}};let VI=YI;function XI(e){VI=e}function Xae(){XI(YI)}function is(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,a;const o=(r=Zx(e))!==null&&r!==void 0?r:{},s=o.title;if(!q(e))return s;const l=e,u=i?JI(l,t):void 0;return n?rt(s,l.title,u):(a=s??l.title)!==null&&a!==void 0?a:u}function Zx(e){return Qx(e)&&e.axis?e.axis:qI(e)&&e.legend?e.legend:Hx(e)&&e.header?e.header:void 0}function JI(e,t){return VI(e,t)}function Ug(e){var t;if(WI(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=Zx(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function Jae(e,t){if(e.timeUnit)return"temporal";if(Me(e.bin))return"quantitative";switch(Rg(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function fr(e){return q(e)?e:Bg(e)?e.condition:void 0}function ft(e){return se(e)?e:Xx(e)?e.condition:void 0}function e2(e,t,n){if(Y(e)||Re(e)||io(e)){const i=Y(e)?"string":Re(e)?"number":"boolean";return j(lre(t,i,e)),{value:e}}return se(e)?qg(e,t,n):Xx(e)?Object.assign(Object.assign({},e),{condition:qg(e.condition,t,n)}):e}function qg(e,t,n){if(WI(e)){const{format:i,formatType:r}=e,a=Z(e,["format","formatType"]);if(ns(r)&&!n.customFormatTypes)return j(nI(t)),qg(a,t,n)}else{const i=Qx(e)?"axis":qI(e)?"legend":Hx(e)?"header":null;if(i&&e[i]){const r=e[i],{format:a,formatType:o}=r,s=Z(r,["format","formatType"]);if(ns(o)&&!n.customFormatTypes)return j(nI(t)),qg(Object.assign(Object.assign({},e),{[i]:s}),t,n)}}return q(e)?KI(e,t):Kae(e)}function Kae(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Re(n)?"quantitative":Y(n)?"nominal":Cl(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function KI(e,t){const{aggregate:n,timeUnit:i,bin:r,field:a}=e,o=Object.assign({},e);if(n&&!Ex(n)&&!Jo(n)&&!Ta(n)&&(j(cre(n)),delete o.aggregate),i&&(o.timeUnit=on(i)),a&&(o.field=`${a}`),Me(r)&&(o.bin=Wg(r,t)),an(r)&&!sr(t)&&j(`Channel ${t} should not be used with "binned" bin.`),Bn(o)){const{type:s}=o,l=pae(s);s!==l&&(o.type=l),s!=="quantitative"&&(MN(n)&&(j(ure(s,n)),o.type="quantitative"))}else if(!qN(t)){const s=Jae(o,t);j(fre(t,s)),o.type=s}if(Bn(o)){const{compatible:s,warning:l}=Qae(o,t);s||j(l)}if(UI(o)&&Y(o.sort)){const{sort:s}=o;if(LI(s))return Object.assign(Object.assign({},o),{sort:{encoding:s}});const l=s.substr(1);if(s.charAt(0)==="-"&&LI(l))return Object.assign(Object.assign({},o),{sort:{encoding:l,order:"descending"}})}if(Hx(o)){const{header:s}=o,{orient:l}=s,u=Z(s,["orient"]);if(l)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},u),{labelOrient:s.labelOrient||l,titleOrient:s.titleOrient||l})})}return o}function Wg(e,t){return io(e)?{maxbins:VN(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:VN(t)}):e}const rs={compatible:!0};function Qae(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case jr:case Lr:case Ag:return HI(e)?{compatible:!1,warning:pre(t)}:rs;case He:case ct:case An:case ir:case rr:case Zc:case tf:case Sg:case Qo:case Og:case Tg:case Ko:case Oi:case er:case Cg:return rs;case nr:case ni:case tr:case Ti:return n!==es?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:rs;case Ur:case Ca:case $a:case Da:case Br:case zr:case Pr:case Si:case Zi:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:rs;case Ra:return ae(["ordinal","nominal"],e.type)?rs:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Sn:return ae(["ordinal","nominal","geojson"],e.type)?rs:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case ef:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:rs}}function Gg(e){const{formatType:t}=Ug(e);return t==="time"||!t&&Zae(e)}function Zae(e){return e&&(e.type==="temporal"||q(e)&&!!e.timeUnit)}function t2(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var a;const o=t&&((a=on(t))===null||a===void 0?void 0:a.unit);let s=o||n==="temporal",l;return oe(e)?l=e.signal:Cl(e)?(s=!0,l=rf(e)):(Y(e)||Re(e))&&(s&&(l=`datetime(${JSON.stringify(e)})`,Qre(o)&&((Re(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(l=rf({[o]:e}))))),l?i&&s?`time(${l})`:l:r?void 0:JSON.stringify(e)}function QI(e,t){const{type:n}=e;return t.map(i=>{const r=t2(i,{timeUnit:q(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function lf(e,t){return Me(e.bin)?Ia(t)&&ae(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function ZI(e){const{anchor:t,frame:n,offset:i,orient:r,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=Z(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),v=Xc(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:v,nonMark:g,subtitle:m}}function za(e){return Y(e)||I(e)&&Y(e[0])}function nt(e){return oe(e)?e:e!==void 0?{value:e}:void 0}function eM(e){return oe(e)?e.signal:B(e.value)}function uf(e){return oe(e)?e.signal:e==null?null:B(e)}function eoe(e,t,n){for(const i of n){const r=as(i,t.markDef,t.config);r!==void 0&&(e[i]=nt(r))}return e}function tM(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Se(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:a}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:a&&(!r||r===e)?void 0:as(e,t,n,i)}function as(e,t,n,{vgChannel:i}={}){return rt(i?Hg(e,t,n.style):void 0,Hg(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Hg(e,t,n){return nM(e,tM(t),n)}function nM(e,t,n){t=G(t);let i;for(const r of t){const a=n[r];a&&a[e]!==void 0&&(i=a[e])}return i}function iM(e,t){return G(e).reduce((n,i)=>{var r;return n.field.push(U(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function rM(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Vc(r,i))return;n.push(i)}),n}function aM(e,t){return Vc(e,t)||!t?e:e?[...G(e),...G(t)].join(", "):t}function oM(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((za(n)||oe(n))&&(za(i)||oe(i)))return{explicit:e.explicit,value:aM(n,i)};if(za(n)||oe(n))return{explicit:e.explicit,value:n};if(za(i)||oe(i))return{explicit:e.explicit,value:i};if(!za(n)&&!oe(n)&&!za(i)&&!oe(i))return{explicit:e.explicit,value:rM(n,i)};throw new Error("It should never reach here")}function os(e,t){const n=e&&e[t];return n?I(n)?Jc(n,i=>!!i.field):q(n)||Bg(n):!1}function n2(e){return Jc(BN,t=>{if(os(e,t)){const n=e[t];if(I(n))return Jc(n,i=>!!i.aggregate);{const i=fr(n);return i&&!!i.aggregate}}return!1})}function i2(e,t){const n=[],i=[],r=[],a=[],o={};return r2(e,(s,l)=>{if(q(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=Z(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const p=Zx(s),g=p&&p.title;let m=U(s,{forAs:!0});const v=Object.assign(Object.assign(Object.assign({},g?[]:{title:is(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let y;if(Jo(c)?(y="argmax",m=U({op:"argmax",field:c.argmax},{forAs:!0}),v.field=`${m}.${u}`):Ta(c)?(y="argmin",m=U({op:"argmin",field:c.argmin},{forAs:!0}),v.field=`${m}.${u}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(y=c),y){const b={op:y,as:m};u&&(b.field=u),a.push(b)}}else if(n.push(m),Bn(s)&&Me(f)){if(i.push({bin:f,field:u,as:m}),n.push(U(s,{binSuffix:"end"})),lf(s,l)&&n.push(U(s,{binSuffix:"range"})),sr(l)){const y={field:m+"_end"};o[l+"2"]=y}v.bin="binned",qN(l)||(v.type=es)}else if(d){r.push({timeUnit:d,field:u,as:m});const y=Bn(s)&&s.type!==Dl&&"time";y&&(l===Zc||l===Qo?v.formatType=y:Uie(l)?v.legend=Object.assign({formatType:y},v.legend):sr(l)&&(v.axis=Object.assign({formatType:y},v.axis)))}o[l]=v}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:i,timeUnits:r,aggregate:a,groupby:n,encoding:o}}function toe(e,t,n){const i=Wie(t,n);if(i){if(i==="binned"){const r=e[t===Si?He:ct];return!!(q(r)&&q(e[t])&&an(r.bin))}}else return!1;return!0}function noe(e,t,n){const i=t.type;return z(e).reduce((r,a)=>{if(!UN(a))return j(hre(a)),r;const o=e[a];if(a==="angle"&&i==="arc"&&!e.theta&&(j(sre),a=Oi),!toe(e,a,i))return j(Ng(a,i)),r;if(a===Br&&i==="line"){const s=fr(e[a]);if(s==null?void 0:s.aggregate)return j(dre),r}if(a===An&&(t.filled?"fill"in e:"stroke"in e))return j(rI("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(a===tf||a===ef&&!I(o)&&!qr(o)||a===Qo&&I(o))o&&(r[a]=G(o).reduce((s,l)=>(q(l)?s.push(KI(l,a)):j(Tx(l,a)),s),[]));else{if(a===Qo&&o===null)r[a]=null;else if(!q(o)&&!Pa(o)&&!qr(o)&&!Vx(o)&&!oe(o))return j(Tx(o,a)),r;r[a]=e2(o,a,n)}return r},{})}function ioe(e){const t=[];for(const n of z(e))if(os(e,n)){const i=e[n],r=G(i);for(const a of r)q(a)?t.push(a):Bg(a)&&t.push(a.condition)}return t}function r2(e,t,n){if(!e)return;for(const i of z(e)){const r=e[i];if(I(r))for(const a of r)t.call(n,a,i);else t.call(n,r,i)}}function sM(e,t,n,i){return e?z(e).reduce((r,a)=>{const o=e[a];return I(o)?o.reduce((s,l)=>t.call(i,s,l,a),r):t.call(i,r,o,a)},n):n}function lM(e,t){return z(t).reduce((n,i)=>{switch(i){case He:case ct:case Og:case Cg:case Tg:case Si:case Zi:case Oi:case zr:case er:case Pr:case tr:case nr:case Ti:case ni:case Zc:case Sn:case Ko:case Qo:return n;case ef:if(e==="line"||e==="trail")return n;case tf:case Sg:{const r=t[i];if(I(r)||q(r))for(const a of G(r))a.aggregate||n.push(U(a,{}));return n}case Br:if(e==="trail")return n;case An:case ir:case rr:case Ur:case Ca:case $a:case Ra:case Da:{const r=fr(t[i]);return r&&!r.aggregate&&n.push(U(r,{})),n}}},[])}function roe(e){const{tooltip:t}=e,n=Z(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;if(I(t)){for(const a of t)a.aggregate?(i||(i=[]),i.push(a)):(r||(r=[]),r.push(a));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return I(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function a2(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:a,titlePrefix:o})=>{const s=i?` of ${t.field}`:"";return{field:a+t.field,type:t.type,title:oe(o)?{signal:o+`"${escape(s)}"`}:o+s}});return{tooltip:[...r,...ioe(n)]}}function uM(e){const{axis:t,title:n,field:i}=e;return t&&t.title!==void 0?void 0:rt(n,i)}function o2(e,t,n,i,r){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c=void 0,aria:f,extraEncoding:d={}})=>{const h=uM(n);return cM(e,s,r,f,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},h!==void 0?{title:h}:{}),a!==void 0?{scale:a}:{}),o!==void 0?{axis:o}:{})},Y(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),d)})}}function cM(e,t,n,i,r){const{clip:a,color:o,opacity:s}=e,l=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),o?{color:o}:{}),s?{opacity:s}:{}),Qi(r.mark)?r.mark:{type:r.mark}),{style:`${l}-${t}`}),io(e[t])?{}:e[t]),i===!1?{aria:i}:{})})]:[]}function fM(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",a=i[r],o=i[r+"2"],s=i[r+"Error"],l=i[r+"Error2"];return{continuousAxisChannelDef:Yg(a,n),continuousAxisChannelDef2:Yg(o,n),continuousAxisChannelDefError:Yg(s,n),continuousAxisChannelDefError2:Yg(l,n),continuousAxis:r}}function Yg(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Z(e,["aggregate"]);return n!==t&&j(Pre(n,t)),i}else return e}function dM(e,t){const{mark:n,encoding:i}=e,{x:r,y:a}=i;if(cr(r)){if(cr(a)){const o=q(r)&&r.aggregate,s=q(a)&&a.aggregate;if(!o&&s===t)return"vertical";if(!s&&o===t)return"horizontal";if(o===t&&s===t)throw new Error("Both x and y cannot have aggregate");return Qi(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(cr(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const Vg="boxplot",aoe=["box","median","outliers","rule","ticks"],ooe=new _g(Vg,pM);function hM(e){return Re(e)?"tukey":e}function pM(e,{config:t}){var n,i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=Qi(r)?r:{type:r};o&&j(ZN("boxplot"));const c=(n=u.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Se("size",u,t),d=hM(c),{transform:h,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:v,encodingWithoutContinuousAxis:y,ticksOrient:b,boxOrient:E,customTooltipWithoutAggregatedField:x}=soe(e,c,t),{color:k,size:w}=y,A=Z(y,["color","size"]),_=J=>o2(u,g,p,J,t.boxplot),O=_(A),S=_(y),T=_(Object.assign(Object.assign({},A),w?{size:w}:{})),D=a2([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,y),M={type:"tick",color:"black",opacity:1,orient:b,invalid:null},C=d==="min-max"?D:a2([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,y),N=[...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:C}),...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:M,positionPrefix:"lower_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:M,positionPrefix:"upper_whisker",aria:!1,extraEncoding:C})],W=[...d!=="tukey"?N:[],...S({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:E,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:D}),...T({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},K(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:D})];let X;if(d!=="min-max"){const J=`datum["lower_box_${p.field}"]`,xe=`datum["upper_box_${p.field}"]`,Pe=`(${xe} - ${J})`,dt=`${J} - ${c} * ${Pe}`,ht=`${xe} + ${c} * ${Pe}`,Ke=`datum["${p.field}"]`,Rt={joinaggregate:gM(p.field),groupby:m};let ui;d==="tukey"&&(ui={transform:[{filter:`(${dt} <= ${Ke}) && (${Ke} <= ${ht})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:m}],layer:N});const Va=Z(A,["tooltip"]),{scale:Xr,axis:H}=p,ue=uM(p),me=cM(u,"outliers",t.boxplot,!0,{transform:[{filter:`(${Ke} < ${dt}) || (${Ke} > ${ht})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},ue!==void 0?{title:ue}:{}),Xr!==void 0?{scale:Xr}:{}),H!==void 0?{axis:H}:{})},Va),x?{tooltip:x}:{})})[0];me&&ui?X={transform:[Rt],layer:[me,ui]}:me?(X=me,X.transform.unshift(Rt)):ui&&(X=ui,X.transform.unshift(Rt))}return X?Object.assign(Object.assign({},l),{layer:[X,{transform:h,layer:W}]}):Object.assign(Object.assign({},l),{transform:((i=l.transform)!==null&&i!==void 0?i:[]).concat(h),layer:W})}function gM(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function soe(e,t,n){const i=dM(e,Vg),{continuousAxisChannelDef:r,continuousAxis:a}=fM(e,i,Vg),o=r.field,s=hM(t),l=[...gM(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(s==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(s==="min-max"?"upper_whisker_":"max_")+o}],u=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=c[f],h=Z(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:g}=roe(h),{bins:m,timeUnits:v,aggregate:y,groupby:b,encoding:E}=i2(g,n),x=i==="vertical"?"horizontal":"vertical",k=i,w=[...m,...v,{aggregate:[...y,...l],groupby:b},...u];return{transform:w,groupby:b,aggregate:y,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:E,ticksOrient:x,boxOrient:k,customTooltipWithoutAggregatedField:p}}const s2="errorbar",loe=["ticks","rule"],uoe=new _g(s2,mM);function mM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=vM(e,s2,t),c=o2(s,r,i,a,t.errorbar),f={type:"tick",orient:o},d=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:u}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function coe(e,t){const{encoding:n}=e;if(foe(n))return{orient:dM(e,t),inputType:"raw"};const i=doe(n),r=hoe(n),a=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const s=n.x2,l=n.y2;if(se(s)&&se(l))throw new Error(`${t} cannot have both x2 and y2`);if(se(s)){if(cr(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(l)){if(cr(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const s=n.xError,l=n.xError2,u=n.yError,c=n.yError2;if(se(l)&&!se(s))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(u))throw new Error(`${t} cannot have yError2 without yError`);if(se(s)&&se(u))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(s)){if(cr(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(u)){if(cr(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function foe(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function doe(e){return se(e.x2)||se(e.y2)}function hoe(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function vM(e,t,n){var i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=Qi(r)?r:{type:r};o&&j(ZN(t));const{orient:c,inputType:f}=coe(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=fM(e,c,t),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:E}=poe(u,d,h,p,g,f,t,n),x=a,k=m,w=x[k],A=m==="x"?"x2":"y2",_=x[A],O=m==="x"?"xError":"yError",S=x[O],T=m==="x"?"xError2":"yError2",D=x[T],M=Z(x,[typeof k=="symbol"?k:k+"",typeof A=="symbol"?A:A+"",typeof O=="symbol"?O:O+"",typeof T=="symbol"?T:T+""]),{bins:C,timeUnits:N,aggregate:W,groupby:X,encoding:J}=i2(M,n),xe=[...W,...v],Pe=f!=="raw"?[]:X,dt=a2(b,d,J,E);return{transform:[...(i=l.transform)!==null&&i!==void 0?i:[],...C,...N,...xe.length===0?[]:[{aggregate:xe,groupby:Pe}],...y],groupby:Pe,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:J,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:dt}}function poe(e,t,n,i,r,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if(a==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center,p=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!==(p==="iqr")&&j(Lre(h,p,o)),p==="stderr"||p==="stdev")l=[{op:p,field:c,as:"extent_"+c},{op:h,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:vg(h)},{fieldPrefix:"upper_",titlePrefix:yM(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:yM(h,p,"-")}],d=!0;else{e.center&&e.extent&&j(zre(e.extent,o));let g,m,v;p==="ci"?(g="mean",m="ci0",v="ci1"):(g="median",m="q1",v="q3"),l=[{op:m,field:c,as:"lower_"+c},{op:v,field:c,as:"upper_"+c},{op:g,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:is({field:c,aggregate:v,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:is({field:c,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:is({field:c,aggregate:g,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&j(jre(e.center,e.extent)),a==="aggregated-upper-lower"?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):a==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?u.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const h of u)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Sl(Sl(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}function yM(e,t,n){return vg(e)+" "+n+" "+t}const l2="errorband",goe=["band","borders"],moe=new _g(l2,bM);function bM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=vM(e,l2,t),u=o,c=o2(u,r,i,a,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign({},h),p)):u.interpolate?j(lI("interpolate")):u.tension&&j(lI("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:l})]})}const wM={};function u2(e,t,n){const i=new _g(e,t);wM[e]={normalizer:i,parts:n}}function voe(){return z(wM)}u2(Vg,pM,aoe),u2(s2,mM,loe),u2(l2,bM,goe);const yoe=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],xM=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],boe={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},woe={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},xoe={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Fl="_vgsid_",Eoe={single:{on:"click",fields:[Fl],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Fl],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function c2(e){return!!e&&(e==="legend"||!!e.legend)}function f2(e){return c2(e)&&K(e)}function koe(e){return Xg(e)||h2(e)||d2(e)}function d2(e){return"concat"in e}function Xg(e){return"vconcat"in e}function h2(e){return"hconcat"in e}function dr(e){return K(e)&&e.step!==void 0}function EM(e){return e.view||e.width||e.height}const kM=20,_oe={align:1,bounds:1,center:1,columns:1,spacing:1},Aoe=z(_oe);function Soe(e,t,n){var i,r;const a=n[t],o={},{spacing:s,columns:l}=a;s!==void 0&&(o.spacing=s),l!==void 0&&((zg(e)&&!of(e.facet)||d2(e))&&(o.columns=l)),Xg(e)&&(o.columns=1);for(const u of Aoe)if(e[u]!==void 0)if(u==="spacing"){const c=e[u];o[u]=Re(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:s,column:(r=c.column)!==null&&r!==void 0?r:s}}else o[u]=e[u];return o}function p2(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function Jg(e,t){const n=cf(e,t);return dr(n)?n.step:g2}function cf(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return rt(i,{step:e.step})}const g2=20,Ooe={continuousWidth:200,continuousHeight:200,step:g2},Toe={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Ooe,mark:vie,arc:{},area:{},bar:bie,circle:{},geoshape:{},image:{},line:{},point:{},rect:wie,rule:{color:"black"},square:{},text:{color:"black"},tick:xie,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Tae,projection:{},legend:woe,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Eoe,style:{},title:{},facet:{spacing:kM},concat:{spacing:kM}},Wr=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],_M={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},AM={blue:Wr[0],orange:Wr[1],red:Wr[2],teal:Wr[3],green:Wr[4],yellow:Wr[5],purple:Wr[6],pink:Wr[7],brown:Wr[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Coe(e={}){return{signals:[{name:"color",value:K(e)?Object.assign(Object.assign({},AM),e):AM}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function $oe(e){return{signals:[{name:"fontSize",value:K(e)?Object.assign(Object.assign({},_M),e):_M}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Doe(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function SM(e={}){const{color:t,font:n,fontSize:i}=e,r=Z(e,["color","font","fontSize"]);return Kl({},Toe,n?Doe(n):{},t?Coe(t):{},i?$oe(i):{},r||{})}const Roe=["view",...FN],Foe=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Noe=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},mie);function Ioe(e){e=pe(e);for(const t of Foe)delete e[t];if(e.axis)for(const t in e.axis)yx(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of yoe)delete e.legend[t];if(e.mark){for(const t of NN)delete e.mark[t];e.mark.tooltip&&K(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of Roe){for(const i of NN)delete e[t][i];const n=Noe[t];if(n)for(const i of n)delete e[t][i];joe(e,t)}for(const t of voe())delete e[t];Moe(e);for(const t in e)K(e[t])&&Ne(e[t])&&delete e[t];return Ne(e)?void 0:e}function Moe(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=ZI(e.title);Ne(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Ne(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Ne(i)?delete e.title:e.title=i}function joe(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const a=Object.assign(Object.assign({},r),e.style[n??t]);Ne(a)||(e.style[n??t]=a),i||delete e[t]}function Kg(e){return"layer"in e}function Loe(e){return"repeat"in e}function Poe(e){return!I(e.repeat)&&e.repeat.layer}class OM{map(e,t){return zg(e)?this.mapFacet(e,t):Loe(e)?this.mapRepeat(e,t):h2(e)?this.mapHConcat(e,t):Xg(e)?this.mapVConcat(e,t):d2(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(Kg(e))return this.mapLayer(e,t);if(Mr(e))return this.mapUnit(e,t);throw new Error(Ox(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(n=>this.mapLayerOrUnit(n,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(n=>this.map(n,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(n=>this.map(n,t))})}mapConcat(e,t){const{concat:n}=e,i=Z(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(r=>this.map(r,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const zoe={zero:1,center:1,normalize:1};function Boe(e){return e in zoe}const Uoe=new Set([CN,wg,bg,kg,Eg,wx,xx,xg,$N,bx]),qoe=new Set([wg,bg,CN]);function TM(e,t){var n,i;const r=t==="x"?"y":"radius",a=e[t],o=e[r];if(q(a)&&q(o))if(La(a)==="quantitative"&&La(o)==="quantitative"){if(a.stack)return t;if(o.stack)return r;const s=q(a)&&!!a.aggregate,l=q(o)&&!!o.aggregate;if(s!==l)return s?t:r;{const u=(n=a.scale)===null||n===void 0?void 0:n.type,c=(i=o.scale)===null||i===void 0?void 0:i.type;if(u&&u!=="linear")return r;if(c&&c!=="linear")return t}}else{if(La(a)==="quantitative")return t;if(La(o)==="quantitative")return r}else{if(La(a)==="quantitative")return t;if(La(o)==="quantitative")return r}return}function Woe(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function CM(e,t,n={}){const i=Qi(e)?e.type:e;if(!Uoe.has(i))return null;const r=TM(t,"x")||TM(t,"theta");if(!r)return null;const a=t[r],o=q(a)?U(a,{}):void 0;let s=Woe(r),l=t[s],u=q(l)?U(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=Pie.reduce((d,h)=>{if(h!=="tooltip"&&os(t,h)){const p=t[h];for(const g of G(p)){const m=fr(g);if(m.aggregate)continue;const v=U(m,{});(!v||v!==u)&&d.push({channel:h,fieldDef:m})}}return d},[]);let f;if(a.stack!==void 0?io(a.stack)?f=a.stack?"zero":null:f=a.stack:c.length>0&&qoe.has(i)&&(f="zero"),!f||!Boe(f))return null;if(n2(t)&&c.length===0)return null;if(a.scale&&a.scale.type&&a.scale.type!==at.LINEAR){if(n.disallowNonLinearStack)return null;j(Nre(a.scale.type))}return se(t[ar(r)])?(a.stack!==void 0&&j(Fre(r)),null):(q(a)&&a.aggregate&&!ae(Oie,a.aggregate)&&j(Ire(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:r,impute:a.impute===null?!1:Xo(i),stackBy:c,offset:f})}function Goe(e){const t=Z(e,["point","line"]);return z(t).length>1?t:t.type}function Hoe(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Ir(e[t],["point","line"])}));return e}function m2(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?K(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?K(t.point)?t.point:{}:void 0}function $M(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Yoe{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(Mr(e)){const{mark:n,encoding:i}=e,r=Qi(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!m2(r,t[r.type],i);case"area":return!!m2(r,t[r.type],i)||!!$M(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:a,encoding:o,mark:s}=e,l=Z(e,["selection","projection","encoding","mark"]),u=Qi(s)?s:{type:s},c=m2(u,i[u.type],o),f=u.type==="area"&&$M(u,i[u.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:Goe(Object.assign(Object.assign({},u.type==="area"&&u.opacity===void 0&&u.fillOpacity===void 0?{opacity:.7}:{}),u)),encoding:Ir(o,["shape"])})],h=CM(u,o);let p=o;if(h){const{fieldChannel:g,offset:m}=h;p=Object.assign(Object.assign({},o),{[g]:Object.assign(Object.assign({},o[g]),m?{stack:m}:{})})}return f&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},Xc(u,["clip","interpolate","tension","tooltip"])),f),encoding:p})),c&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Xc(u,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},t),{config:Hoe(i)}))}}class Voe{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(Mr(e)&&e.encoding)for(const n of ri){const i=e.encoding[n];if(i&&se(i)&&((t=i==null?void 0:i.scale)===null||t===void 0?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const r of ri){const a=or(r),o=i[r];if(o&&se(o)&&((t=o==null?void 0:o.scale)===null||t===void 0?void 0:t.rangeStep)){const{scale:s}=o,l=Z(o,["scale"]),u=s,c=Z(u,["rangeStep"]);n[a]={step:s.rangeStep},j(yre),i=Object.assign(Object.assign({},i),{[r]:Object.assign(Object.assign({},l),Ne(c)?{}:{scale:c})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function Xoe(e,t){return t?of(e)?NM(e,t):DM(e,t):e}function v2(e,t){return t?NM(e,t):e}function y2(e,t,n){const i=t[e];if(qae(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});j(ere(i.repeat));return}return t}function DM(e,t){if(e=y2("field",e,t),e===void 0)return;if(e===null)return null;if(UI(e)&&ur(e.sort)){const n=y2("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function RM(e,t){if(q(e))return DM(e,t);{const n=y2("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function FM(e,t){if(se(e)){const n=RM(e,t);if(n)return n;if(Vx(e))return{condition:e.condition}}else{if(Xx(e)){const n=RM(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=Z(e,["condition"]);return i}}return e}return}function NM(e,t){const n={};for(const i in e)if(Q(e,i)){const r=e[i];if(I(r))n[i]=r.map(a=>FM(a,t)).filter(a=>a);else{const a=FM(r,t);a!==void 0&&(n[i]=a)}}return n}class Joe{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Mr(e)){const{encoding:t,mark:n}=e;if(n==="line")for(const i of jie){const r=Zo(i),a=t[r];if(t[i]&&(q(a)&&!an(a.bin)||Pa(a)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;return j(mre(!!i.x2,!!i.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}class Koe extends OM{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[ooe,uoe,moe,new Yoe(),new Joe(),new Voe()]}map(e,t){if(Mr(e)){const n=os(e.encoding,jr),i=os(e.encoding,Lr),r=os(e.encoding,Ag);if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Object.assign(Object.assign({},e),{encoding:v2(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const a=this.mapLayerOrUnit.bind(this);for(const o of this.nonFacetUnitNormalizers)if(o.hasMatchingType(r,t.config))return o.run(r,t,a);return r}mapRepeat(e,t){return Poe(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=Z(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:i}}),t):Object.assign(Object.assign({},r),{layer:s.map(c=>{const f=Object.assign(Object.assign({},l),{layer:c}),d=(i.name||"")+u+`child__layer_${qe(c)}`,h=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:f,repeaterPrefix:d}));return h.name=d,h})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:a}=e,o=Z(e,["repeat","spec","data"]);!I(i)&&e.columns&&(e=Ir(e,["columns"]),j(eI("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!I(i)&&i.row||[l?l.row:null],f=!I(i)&&i.column||[l?l.column:null],d=I(i)&&i||[l?l.repeat:null];for(const p of d)for(const g of c)for(const m of f){const v={repeat:p,row:g,column:m,layer:l.layer},y=(r.name||"")+u+"child__"+(I(i)?`${qe(p)}`:(i.row?`row_${qe(g)}`:"")+(i.column?`column_${qe(m)}`:"")),b=this.map(r,Object.assign(Object.assign({},t),{repeater:v,repeaterPrefix:y}));b.name=y,s.push(Ir(b,["data"]))}const h=I(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(n=r.data)!==null&&n!==void 0?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return of(n)&&e.columns&&(e=Ir(e,["columns"]),j(eI("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:a,config:o}=t,s=MM({parentProjection:a,projection:i}),l=IM({parentEncoding:r,encoding:v2(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:a}=n,o=Z(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=Z(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:a},t),v=v2(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:v}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:a}=e;if(i||r){a&&j(gre([...i?[jr]:[],...r?[Lr]:[]]));const o={},s={};for(const l of[jr,Lr]){const u=e[l];if(u){const c=Z(u,["align","center","spacing","columns"]);o[l]=c;for(const f of["align","center","spacing"])u[f]!==void 0&&(s[f]=(n=s[f])!==null&&n!==void 0?n:{},s[f][l]=u[f])}}return{facetMapping:o,layout:s}}else{const{align:o,center:s,spacing:l,columns:u}=a,c=Z(a,["align","center","spacing","columns"]);return{facetMapping:Xoe(c,t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},o?{align:o}:{}),s?{center:s}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=Z(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=Z(e,["encoding","projection"]),l=Object.assign(Object.assign({},r),{parentEncoding:IM({parentEncoding:n,encoding:a}),parentProjection:MM({parentProjection:i,projection:o})});return super.mapLayer(s,l)}}function IM(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const r=z(t).reduce((a,o)=>(n[o]&&a.push(o),a),[]);r.length>0&&j(are(r))}const i=Object.assign(Object.assign({},t??{}),n??{});return Ne(i)?void 0:i}function MM(e){const{parentProjection:t,projection:n}=e;return t&&n&&j(ore({parentProjection:t,projection:n})),n??t}function jM(e,t){t===void 0&&(t=SM(e.config));const n=Zoe(e,t),{width:i,height:r}=e,a=ese(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const Qoe=new Koe();function Zoe(e,t={}){return Qoe.map(e,{config:t})}function LM(e){return Y(e)?{type:e}:e??{}}function ese(e,t,n){let{width:i,height:r}=t;const a=Mr(e)||Kg(e),o={};a?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(j(XN("width")),i=void 0),r=="container"&&(j(XN("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?LM(n.autosize):{}),LM(e.autosize));return s.type==="fit"&&!a&&(j(Yie),s.type="pad"),i=="container"&&!(s.type=="fit"||s.type=="fit-x")&&j(JN("width")),r=="container"&&!(s.type=="fit"||s.type=="fit-y")&&j(JN("height")),Vc(s,{type:"pad"})?void 0:s}function tse(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function nse(e){return e?`fit-${$g(e)}`:"fit"}const ise=["background","padding"];function PM(e){return ise.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class Ba{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Ba(pe(this.explicit),pe(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return rt(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){t.value!==void 0&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){t.explicit[e]!==void 0?this.set(e,t.explicit[e],!0):t.implicit[e]!==void 0&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){t[e]!==void 0&&this.set(e,t[e],!0)}copyAll(e){for(const t of z(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function ss(e){return{explicit:!0,value:e}}function Un(e){return{explicit:!1,value:e}}function zM(e){return(t,n,i,r)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:Qg(t,n,i,r)}}function Qg(e,t,n,i){return e.explicit&&t.explicit&&j(Sre(n,i,e.value,t.value)),e}function Ua(e,t,n,i,r=Qg){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Vc(e.value,t.value)?e:r(e,t,n,i)}class rse extends Ba{constructor(e={},t={},n=!1){super(e,t);this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function ff(e){return"url"in e}function Zg(e){return"values"in e}function BM(e){return"name"in e&&!ff(e)&&!Zg(e)&&!ls(e)}function ls(e){return e&&(UM(e)||qM(e)||b2(e))}function UM(e){return"sequence"in e}function qM(e){return"sphere"in e}function b2(e){return"graticule"in e}const qt="main",em="raw";function WM(e){return"filter"in e}function ase(e){return(e==null?void 0:e.stop)!==void 0}function ose(e){return"lookup"in e}function sse(e){return"data"in e}function lse(e){return"selection"in e}function use(e){return"pivot"in e}function cse(e){return"density"in e}function fse(e){return"quantile"in e}function dse(e){return"regression"in e}function hse(e){return"loess"in e}function pse(e){return"sample"in e}function gse(e){return"window"in e}function mse(e){return"joinaggregate"in e}function vse(e){return"flatten"in e}function yse(e){return"calculate"in e}function bse(e){return"bin"in e}function wse(e){return"impute"in e}function xse(e){return"timeUnit"in e}function Ese(e){return"aggregate"in e}function kse(e){return"stack"in e}function _se(e){return"fold"in e}function Ase(e){return e.map(t=>WM(t)?{filter:gg(t.filter,dae)}:t)}function df(e,t,n,i){const r=Vx(t)&&t.condition,a=i(t);if(r){const o=G(r),s=o.map(l=>{const u=i(l),c=Uae(l)?mj(e,l.selection):om(e,l.test);return Object.assign({test:c},u)});return{[n]:[...s,...a!==void 0?[a]:[]]}}else return a!==void 0?{[n]:a}:{}}function w2(e,t="text"){const n=e.encoding[t];return df(e,n,t,i=>tm(i,e.config))}function tm(e,t,n="datum"){if(e){if(qr(e))return nt(e.value);if(se(e)){const{format:i,formatType:r}=Ug(e);return Wx({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function GM(e,t={}){const{encoding:n,markDef:i,config:r,stack:a}=e,o=n.tooltip;if(I(o))return{tooltip:YM({tooltip:o},a,r,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return df(e,o,"tooltip",l=>{const u=tm(l,r,s);if(u)return u;if(l===null)return;let c=Se("tooltip",i,r);return c===!0&&(c={content:"encoding"}),Y(c)?{value:c}:K(c)?c.content==="encoding"?YM(n,a,r,t):{signal:s}:void 0})}}function HM(e,t,n,{reactiveGeom:i}={}){const r={},a=i?"datum.datum":"datum",o=[];function s(u,c){const f=Zo(c),d=Bn(u)?u:Object.assign(Object.assign({},u),{type:e[f].type}),h=G(is(d,n,{allowDisabling:!1})).join(", ");let p;if(sr(c)){const g=c==="x"?"x2":"y2",m=fr(e[g]);if(an(d.bin)&&m){const v=U(d,{expr:a}),y=U(m,{expr:a}),{format:b,formatType:E}=Ug(d);p=Lg(v,y,b,E,n),r[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:y}=Ug(d);p=Wx({fieldOrDatumDef:d,format:v,formatType:y,expr:a,config:n,normalizeStack:!0}).signal}}p=p??tm(d,n,a).signal,o.push({channel:c,key:h,value:p})}r2(e,(u,c)=>{q(u)?s(u,c):Bg(u)&&s(u.condition,c)});const l={};for(const{channel:u,key:c,value:f}of o)!r[u]&&!l[c]&&(l[B(c)]=f);return l}function YM(e,t,n,{reactiveGeom:i}={}){const r=HM(e,t,n,{reactiveGeom:i}),a=EN(r).map(({key:o,value:s})=>`${o}: ${s}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function Sse(e){const{markDef:t,config:n}=e,i=Se("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Ose(e)),Tse(e))}function Ose(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Se("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in lae?{}:{ariaRoleDescription:{value:t}}}function Tse(e){const{encoding:t,markDef:n,config:i,stack:r}=e,a=t.description;if(a)return df(e,a,"description",l=>tm(l,e.config));const o=Se("description",n,i);if(o!=null)return{description:nt(o)};if(i.aria===!1)return{};const s=HM(t,r,i);return Ne(s)?void 0:{description:{signal:EN(s).map(({key:l,value:u})=>`${l} + ": " + (${u})`).join(' + "; " + ')}}}function xt(e,t,n={}){const{markDef:i,encoding:r,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;s===void 0&&(l=l??Se(e,i,a,{vgChannel:o,ignoreVgConfig:!0}),l!==void 0&&(s=nt(l)));const u=r[e];return df(t,u,o??e,c=>$I({channel:e,channelDef:c,markDef:i,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function VM(e,t={filled:void 0}){var n,i,r,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=(n=t.filled)!==null&&n!==void 0?n:Se("filled",o,l),f=ae(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=(r=(i=Se(c===!0?"color":void 0,o,l,{vgChannel:"fill"}))!==null&&i!==void 0?i:l.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,h=(a=Se(c===!1?"color":void 0,o,l,{vgChannel:"stroke"}))!==null&&a!==void 0?a:l.mark[c===!1&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},d?{fill:nt(d)}:{}),h?{stroke:nt(h)}:{});return o.color&&(c?o.fill:o.stroke)&&j(rI("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),xt("color",e,{vgChannel:p,defaultValue:c?d:h})),xt("fill",e,{defaultValue:s.fill?d:void 0})),xt("stroke",e,{defaultValue:s.stroke?h:void 0}))}function hf(e,t){const n=Lie(e),i=t[n];return i||void 0}function Wt(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[ar(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=hf(e,o),p=x2({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),g=!u&&sr(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:Cse({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:r,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return g?{[i||e]:g}:void 0}function Cse(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:a,offset:o,markDef:s,config:l}=e;if(se(n)&&a&&t===a.fieldChannel){if(q(n)){const u=sf({channel:t,fieldDef:n,isMidPoint:i,markDef:s,stack:a,config:l});if(u!==void 0)return jg({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:u,offset:o})}return ts(n,r,{suffix:"end"},{offset:o})}return Ux(e)}function x2({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:a,config:o}=e;return()=>{const s=Zo(n),l=Fa(n),u=Se(n,a,o,{vgChannel:l});if(u!==void 0)return af(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!ae([at.LOG,at.TIME,at.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return s==="y"?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[or(n)];return Object.assign(Object.assign({},c),{mult:.5})}}return}}const $se={left:"x",center:"xc",right:"x2"},Dse={top:"y",middle:"yc",bottom:"y2"};function XM(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Fa(e);const r=e==="x"?"align":"baseline",a=Se(r,t,n);return e==="x"?$se[a||(i==="top"?"left":"center")]:Dse[a||i]}function nm(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?JM(e,t,{defaultPos:n,defaultPos2:i}):Wt(e,t,{defaultPos:n})}function JM(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:a}=t,o=ar(e),s=or(e),l=Rse(t,i,o),u=l[s]?XM(e,r,a):Fa(e);return Object.assign(Object.assign({},Wt(e,t,{defaultPos:n,vgChannel:u})),l)}function Rse(e,t,n){const{encoding:i,mark:r,markDef:a,stack:o,config:s}=e,l=Zo(n),u=or(n),c=Fa(n),f=i[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=n in i||n in a?hf(n,e.markDef):hf(l,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const g=Fse({channel:n,channelDef:f,channel2Def:i[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:im(n,a)||im(n,{[n]:Hg(n,a,s.style),[u]:Hg(u,a,s.style)})||im(n,s[r])||im(n,s.mark)||{[c]:x2({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function Fse({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return se(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?ts(t,a,{suffix:"start"},{offset:l}):Ux({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:i,config:r,offset:l,defaultRef:u})}function im(e,t){const n=or(e),i=Fa(e);return t[i]!==void 0?{[i]:af(e,t[i])}:t[e]!==void 0?{[i]:af(e,t[e])}:t[n]?{[n]:af(e,t[n])}:void 0}function qa(e,t,n){var i,r,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=ar(t),d=or(t),h=l[t],p=l[f],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,v=e.scaleName(t),y=u.orient,b=(r=(i=l[d])!==null&&i!==void 0?i:l.size)!==null&&r!==void 0?r:Se("size",u,s,{vgChannel:d}),E=n==="bar"&&(t==="x"?y==="vertical":y==="horizontal");if(q(h)&&(Me(h.bin)||an(h.bin)||h.timeUnit&&!p)&&!b&&!On(m)){const x=sf({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),k=(a=e.component.axes[t])===null||a===void 0?void 0:a[0],w=(o=k==null?void 0:k.get("translate"))!==null&&o!==void 0?o:.5;return Mse({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:v,band:x,axisTranslate:w,spacing:sr(t)?Se("binSpacing",u,s):void 0,reverse:g.get("reverse"),config:s})}else return(se(h)&&On(m)||E)&&!p?Ise(n,h,t,e):JM(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Nse(e,t,n,i,r,a){if(i){const l=i.get("type");if(l==="point"||l==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(l===at.POINT){const u=i.get("range");return Ma(u)&&Re(u.step)?{value:u.step-2}:{value:g2-2}}else return{scale:n,band:a}}else return{value:r[e].continuousBandSize}}const o=Jg(r.view,t),s=rt(r[e].discreteBandSize,o-2);return s!==void 0?{value:s}:void 0}function Ise(e,t,n,i){var r;const{markDef:a,encoding:o,config:s,stack:l}=i,u=a.orient,c=i.scaleName(n),f=i.getScaleComponent(n),d=or(n),h=ar(n),p=u==="horizontal"&&n==="y"||u==="vertical"&&n==="x",g=Se(p?"size":d,a,s,{vgChannel:d});let m;(o.size||g!==void 0)&&(p?m=xt("size",i,{vgChannel:d,defaultValue:g}):j(kre(a.type)));const v=(r=se(t)?sf({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)!==null&&r!==void 0?r:1;m=m||{[d]:Nse(e,d,c,f,s,v)};const y=(f==null?void 0:f.get("type"))!=="band"||!("band"in m[d]),b=XM(n,a,s,y?"middle":"top"),E=hf(n,a),x=Ux({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:E,defaultRef:x2({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:y?.5:(1-v)/2});if(d)return Object.assign({[b]:x},m);{const k=Fa(h),w=m[d],A=E?Object.assign(Object.assign({},w),{offset:E}):w;return{[b]:x,[k]:I(x)?[x[0],Object.assign(Object.assign({},x[1]),{offset:A})]:Object.assign(Object.assign({},x),{offset:A})}}}function pf(e,t,n,i,r){if(LN(e))return 0;const a=e==="x"||e==="y2"?-t/2:t/2;if(oe(n)){const o=uf(r);return{signal:`${n.signal} ? ${i-a}${o?"-"+o:""} : ${i+a}${o?"+"+o:""}`}}else{if(oe(r)){const o=i+(n?-a:a);return{signal:`${o||""}${n?" - ":o?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-a:+r+a)}}function Mse({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=ar(n),f=Fa(n),d=Fa(c),h=hf(n,a);if(Me(e.bin)||e.timeUnit)return{[d]:KM({channel:n,fieldDef:e,scaleName:r,markDef:a,band:(1-i)/2,offset:pf(c,o,l,s,h),config:u}),[f]:KM({channel:n,fieldDef:e,scaleName:r,markDef:a,band:1-(1-i)/2,offset:pf(n,o,l,s,h),config:u})};if(an(e.bin)){const p=ts(e,r,{},{offset:pf(c,o,l,s,h)});if(q(t))return{[d]:p,[f]:ts(t,r,{},{offset:pf(n,o,l,s,h)})};if(nf(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${U(e,{expr:"datum"})} + ${e.bin.step})`,offset:pf(n,o,l,s,h)}}}j(uI(c));return}function KM({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:a,config:o}){const s=jg({scaleName:n,fieldOrDatumDef:t,band:r,offset:a});return CI({fieldDef:t,channel:e,markDef:i,ref:s,config:o})}const jse=new Set(["aria"]);function oi(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?VM(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Lse(e.markDef,t)),QM(e,"fill",n)),QM(e,"stroke",i)),xt("opacity",e)),xt("fillOpacity",e)),xt("strokeOpacity",e)),xt("strokeWidth",e)),xt("strokeDash",e)),GM(e)),w2(e,"href")),Sse(e))}function QM(e,t,n){const{config:i,mark:r,markDef:a}=e,o=Se("invalid",a,i);if(o==="hide"&&n&&!Xo(r)){const s=Pse(e,{invalid:!0,channels:Dg});if(s)return{[t]:[{test:s,value:null},...G(n)]}}return n?{[t]:n}:{}}function Lse(e,t){return sae.reduce((n,i)=>(!jse.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=nt(e[i])),n),{})}function Pse(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ai(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>qx(o,t)).join(` ${a} `)}return}function E2(e){const{config:t,markDef:n}=e,i=Se("invalid",n,t);if(i){const r=zse(e,{channels:ri});if(r)return{defined:{signal:r}}}return{}}function zse(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ai(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>qx(o,t)).join(` ${a} `)}return}function ZM(e,t){return t!==void 0?{[e]:nt(t)}:void 0}const k2="voronoi",ej={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(k2)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,a=e.mark;if(Xo(a))return j(Xie(a)),n;const o={name:e.getName(k2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},GM(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((u,c)=>{var f;const d=(f=u.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?s=c:d.indexOf(k2)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}};class De{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){if(this._children.indexOf(e)>-1){console.warn("Attempt to add the same child twice.");return}t!==void 0?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class sn extends De{constructor(e,t,n,i){super(e,t);this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor();return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return this._hash===void 0&&(this._hash=`Output ${rie()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class Gr extends De{constructor(e,t){super(e);this.formula=t}clone(){return new Gr(null,pe(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{const{field:o,timeUnit:s}=r,l=Je(t)?t.encoding[ar(a)]:void 0,u=Je(t)&&Yx(a,r,l,t.stack,t.markDef,t.config);if(s){const c=U(r,{forAs:!0});i[we({as:c,field:o,timeUnit:s})]=Object.assign({as:c,field:o,timeUnit:s},u?{band:!0}:{})}return i},{});return Ne(n)?null:new Gr(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=Z(n,["timeUnit"]),a=on(i),o=Object.assign(Object.assign({},r),{timeUnit:a});return new Gr(e,{[we(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)(!this.formula[t]||e.formula[t].band)&&(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Sa(this.formula).map(e=>e.as))}dependentFields(){return new Set(Sa(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${we(this.formula)}`}assemble(){const e=[];for(const t of Sa(this.formula)){const{field:n,as:i,timeUnit:r}=t,a=on(r),{unit:o,utc:s}=a,l=Z(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Oa(n),type:"timeunit"},o?{units:Fx(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return e}}const gf="_tuple_fields";class Bse{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const Use={has:()=>!0,parse:(e,t,n)=>{var i,r,a;const o=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new Bse(),l={},u={},c=new Set(),f=(d,h)=>{const p=h==="visual"?d.channel:d.field;let g=qe(`${o}_${p}`);for(let m=1;c.has(g);m++)g=qe(`${o}_${p}_${m}`);return c.add(g),{[h]:g}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const h of G(n.init))for(const p of z(h))Mie(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(j('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const h={type:"E",field:d};h.signals=Object.assign({},f(h,"data")),s.items.push(h),s.hasField[d]=h}for(const d of(a=n.encodings)!==null&&a!==void 0?a:[]){const h=e.fieldDef(d);if(h){let p=h.field;if(h.aggregate){j(Vie(d,h.aggregate));continue}else if(!p){j(QN(d));continue}if(h.timeUnit){p=e.vgField(d);const g={timeUnit:h.timeUnit,as:p,field:h.field};u[we(g)]=g}if(!l[p]){let g="E";if(t.type==="interval"){const v=e.getScaleComponent(d).get("type");ai(v)&&(g="R")}else h.bin&&(g="R-RE");const m={field:p,channel:d,type:g};m.signals=Object.assign(Object.assign({},f(m,"data")),f(m,"visual")),s.items.push(l[p]=m),s.hasField[p]=s.hasChannel[d]=l[p]}}else j(QN(d))}if(n.init){const d=h=>s.items.map(p=>h[p.channel]!==void 0?h[p.channel]:h[p.field]);if(n.type==="interval")t.init=d(n.init);else{const h=G(n.init);t.init=h.map(d)}}Ne(u)||(s.timeUnit=new Gr(null,u))},signals:(e,t,n)=>{const i=t.name+gf,r=n.filter(a=>a.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(a=>{const o=Z(a,["signals","hasLegend"]);return o.field=Oa(o.field),o})})}},tj={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!c2(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,a=t.bind,o=t.init&&t.init[0],s=ej.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((l,u)=>{var c,f;const d=qe(`${i}_${l.field}`),h=n.filter(p=>p.name===d);h.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Nl(o[u])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${B(l.field)}] : null`}]:[],bind:(f=(c=a[l.field])!==null&&c!==void 0?c:a[l.channel])!==null&&f!==void 0?f:a}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.filter(u=>u.name===i+hr)[0],o=i+gf,s=r.items.map(u=>qe(`${i}_${u.field}`)),l=s.map(u=>`${u} !== null`).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},rm="_toggle",nj={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+rm,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+hr,i=t.name+rm;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Hr(e)}}, `)+`${i} ? ${n} : null`}},qse={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=Y(n.clear)?qo(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(tj.has(t))for(const i of t.project.items){const r=n.findIndex(a=>a.name===qe(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,a){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:a})}if(t.type==="interval")for(const r of t.project.items){const a=n.findIndex(o=>o.name===r.signals.visual);if(i(a,"[0, 0]"),a===-1){const o=n.findIndex(s=>s.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(a=>a.name===t.name+hr);i(r,"null"),nj.has(t)&&(r=n.findIndex(a=>a.name===t.name+rm),i(r,"false"))}return n}},Wa={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Ia(r))continue;const a=e.getScaleComponent(r),o=a?a.get("type"):void 0;if(!a||!ai(o)){j(Kie);continue}const s={selection:t.name,field:i.field};a.set("selectionExtent",s,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(s=>s.name===o.signals.data).length===0);if(!e.parent||A2(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let a=r.update;if(a.indexOf(hj)>=0)r.update=`{${i.map(o=>`${B(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const s=`${B(o.field)}: ${o.signals.data}`;a.indexOf(s)<0&&(a=`${a.substring(0,a.length-1)}, ${s}}`)}r.update=a}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!A2(e))for(const i of t.scales){const r=n.filter(a=>a.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function _2(e,t){const n=B(e.scaleName(t));return`domain(${n})`}function A2(e){var t;return e.parent&&zl(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:A2(e.parent.parent))}const ij={has:e=>{const t=e.resolve==="global"&&e.bind&&c2(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Fl;return t&&!n&&j(Qie),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const l of t.events)l.filter=G((r=l.filter)!==null&&r!==void 0?r:[]),l.filter.indexOf(s)<0&&l.filter.push(s)}const a=f2(t.bind)?t.bind.legend:"click",o=Y(a)?qo(a,"view"):G(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=f2(t.bind)&&t.bind.legend,a=o=>s=>{const l=pe(s);return l.markname=o,l};for(const o of t.project.items){if(!o.hasLegend)continue;const s=`${qe(o.field)}_legend`,l=`${i}_${s}`,u=n.filter(c=>c.name===l);if(u.length===0){const c=r.merge.map(a(`${s}_symbols`)).concat(r.merge.map(a(`${s}_labels`))).concat(r.merge.map(a(`${s}_entries`)));n.unshift(Object.assign(Object.assign({name:l},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${l}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.find(d=>d.name===i+hr),o=i+gf,s=r.items.filter(d=>d.hasLegend).map(d=>qe(`${i}_${qe(d.field)}_legend`)),l=s.map(d=>`${d} !== null`).join(" && "),u=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(d=>({signal:d})),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);const c=n.find(d=>d.name===i+rm),f=f2(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function Wse(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;cs(e,a=>{var o,s;const l=(o=a.project.hasField[r])!==null&&o!==void 0?o:a.project.hasChannel[t];if(l&&ij.has(a)){const u=(s=n.get("selections"))!==null&&s!==void 0?s:[];u.push(a.name),n.set("selections",u,!1),l.hasLegend=!0}})}const rj="_translate_anchor",aj="_translate_delta",Gse={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Wa.has(t),a=i+rj,{x:o,y:s}=t.project.hasChannel;let l=qo(t.translate,"scope");return r||(l=l.map(u=>(u.between[0].markname=i+mf,u))),n.push({name:a,value:{},on:[{events:l.map(u=>u.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?_2(e,He):`slice(${o.signals.visual})`):"")+(s!==void 0?", extent_y: "+(r?_2(e,ct):`slice(${s.signals.visual})`):"")+"}"}]},{name:i+aj,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),o!==void 0&&oj(e,t,o,"width",n),s!==void 0&&oj(e,t,s,"height",n),n}};function oj(e,t,n,i,r){var a;const o=t.name,s=o+rj,l=o+aj,u=n.channel,c=Wa.has(t),f=r.filter(E=>E.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(u),p=h.get("type"),g=c&&u===He?"-":"",m=`${s}.extent_${u}`,v=`${g}${l}.${u} / `+(c?`${d}`:`span(${m})`),y=c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear",b=`${y}(${m}, ${v}`+(c&&p==="pow"?`, ${(a=h.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?b:`clampRange(${b}, 0, ${d})`})}const sj="_zoom_anchor",lj="_zoom_delta",Hse={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Wa.has(t),a=i+lj,{x:o,y:s}=t.project.hasChannel,l=B(e.scaleName(He)),u=B(e.scaleName(ct));let c=qo(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+mf,f))),n.push({name:i+sj,on:[{events:c,update:r?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&uj(e,t,o,"width",n),s!==void 0&&uj(e,t,s,"height",n),n}};function uj(e,t,n,i,r){var a;const o=t.name,s=n.channel,l=Wa.has(t),u=r.filter(y=>y.name===n.signals[l?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?_2(e,s):u.name,p=o+lj,g=`${o}${sj}.${s}`,m=l?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=`${m}(${h}, ${g}, ${p}`+(l&&d==="pow"?`, ${(a=f.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?v:`clampRange(${v}, 0, ${c})`})}const Yse=[Use,nj,Wa,ij,Gse,Hse,tj,ej,qse];function am(e,t){for(const n of Yse)n.has(e)&&t(n)}function Nl(e,t=!0,n=Yt){if(I(e)){const i=e.map(r=>Nl(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Cl(e))return n(t?rf(e):Kre(e));return t?n(JSON.stringify(e)):e}function Vse(e,t){return cs(e,(n,i)=>{const r=n.name;let a=i.modifyExpr(e,n);t.push(...i.signals(e,n)),am(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(a=o.modifyExpr(e,n,a))}),t.push({name:r+rle,on:[{events:{signal:n.name+hr},update:`modify(${B(n.name+us)}, ${a})`}]})}),S2(t)}function Xse(e,t){if(e.component.selection&&z(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:qo("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return S2(t)}function Jse(e,t){let n=!1;if(cs(e,(i,r)=>{const a=i.name,o=B(a+us),s=t.filter(l=>l.name===a);if(s.length===0){const l=i.resolve==="global"?"union":i.resolve,u=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${hj}(${o}, ${B(l)}${u}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),am(i,l=>{l.topLevelSignals&&(t=l.topLevelSignals(e,i,t))})}),n){const i=t.filter(r=>r.name==="unit");i.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return S2(t)}function Kse(e,t){const n=[...t];return cs(e,i=>{const r={name:i.name+us};if(i.init){const o=i.project.items.map(l=>{const u=Z(l,["signals"]);return u}),s=i.init.map(l=>Nl(l,!1));r.values=i.type==="interval"?[{unit:Hr(e,{escape:!1}),fields:o,values:s}]:s.map(l=>({unit:Hr(e,{escape:!1}),fields:o,values:l}))}const a=n.filter(o=>o.name===i.name+us);a.length||n.push(r)}),n}function cj(e,t){return cs(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,am(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function Qse(e,t){for(const n of e.children)Je(n)&&(t=cj(n,t));return t}function Zse(e,t){const n=t.selection,i=e.getSelectionComponent(n,qe(n));return{signal:vj(i,t)}}function S2(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const mf="_brush",O2="_scale_trigger",ele={signals:(e,t)=>{const n=t.name,i=n+gf,r=Wa.has(t),a=[],o=[],s=[];if(t.translate&&!r){const c=`!event.item || event.item.mark.name !== ${B(n+mf)}`;fj(t,(f,d)=>{var h;const p=G((h=d.between[0].filter)!==null&&h!==void 0?h:d.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==He&&d!==ct){j("Interval selections only support x and y encoding channels.");return}const h=t.init?t.init[f]:null,p=tle(e,t,c,h),g=c.signals.data,m=c.signals.visual,v=B(e.scaleName(d)),y=e.getScaleComponent(d).get("type"),b=ai(y)?"+":"";a.push(...p),o.push(g),s.push({scaleName:e.scaleName(d),expr:`(!isArray(${g}) || (${b}invert(${v}, ${m})[0] === ${b}${g}[0] && ${b}invert(${v}, ${m})[1] === ${b}${g}[1]))`})}),r||a.push({name:n+O2,value:{},on:[{events:s.map(c=>({scale:c.scaleName})),update:s.map(c=>c.expr).join(" && ")+` ? ${n+O2} : {}`}]});const l=t.init,u=`unit: ${Hr(e)}, fields: ${i}, values`;return a.concat(Object.assign(Object.assign({name:n+hr},l?{init:`{${u}: ${Nl(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>{const n=t.name+hr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Hr(e)}}`)},marks:(e,t,n)=>{const i=t.name,{x:r,y:a}=t.project.hasChannel,o=r&&r.signals.visual,s=a&&a.signals.visual,l=`data(${B(t.name+us)})`;if(Wa.has(t))return n;const u={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:a!==void 0?{signal:`${s}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:a!==void 0?{signal:`${s}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of z(u))u[m]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${Hr(e)}`},u[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=Z(c,["fill","fillOpacity","cursor"]),g=z(p).reduce((m,v)=>(m[v]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,a!==void 0&&`${s}[0] !== ${s}[1]`].filter(y=>y).join(" && "),value:p[v]},{value:null}],m),{});return[{name:i+mf+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:i+mf,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),g)}}]}};function tle(e,t,n,i){const r=n.channel,a=n.signals.visual,o=n.signals.data,s=Wa.has(t),l=B(e.scaleName(r)),u=e.getScaleComponent(r),c=u?u.get("type"):void 0,f=g=>`scale(${l}, ${g})`,d=e.getSizeSignalRef(r===He?"width":"height").signal,h=`${r}(unit)`,p=fj(t,(g,m)=>[...g,{events:m.between[0],update:`[${h}, ${h}]`},{events:m,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]);return p.push({events:{signal:t.name+O2},update:ai(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},i?{init:Nl(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:Nl(i)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}function fj(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(j(`${i} is not an ordered event stream for interval selections.`),n),[])}function dj(e,t){const n=t.name,i=n+gf,r=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(u=>{const c=e.fieldDef(u.channel);return c&&c.bin?`[${a}[${B(e.vgField(u.channel,{}))}], ${a}[${B(e.vgField(u.channel,{binSuffix:"end"}))}]]`:`${a}[${B(u.field)}]`}).join(", "),s=`unit: ${Hr(e)}, fields: ${i}, values`,l=t.events;return[{name:n+hr,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const nle={signals:dj,modifyExpr:(e,t)=>{const n=t.name+hr;return n+", "+(t.resolve==="global"?"null":`{unit: ${Hr(e)}}`)}},ile={signals:dj,modifyExpr:(e,t)=>{const n=t.name+hr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Hr(e)}}`)}},us="_store",hr="_tuple",rle="_modify",hj="vlSelectionResolve",ale={single:ile,multi:nle,interval:ele};function cs(e,t){const n=e.component.selection;if(n)for(const i of Sa(n)){const r=t(i,ale[i.type]);if(r===!0)break}}function ole(e){let t=e.parent;for(;t&&!Di(t);)t=t.parent;return t}function Hr(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=ole(e);if(i){const{facet:r}=i;for(const a of ii)r[a]&&(n+=` + '__facet_${a}_' + (facet[${B(i.vgField(a))}])`)}return n}function T2(e){let t=!1;return cs(e,n=>{t=t||n.project.items.some(i=>i.field===Fl)}),t}function C2(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...C2(e.object)),t.push(...C2(e.property))),t)}function pj(e){return e.object.type==="MemberExpression"?pj(e.object):e.object.name==="datum"}function gj(e){const t=IR(e),n=new Set();return t.visit(i=>{i.type==="MemberExpression"&&pj(i)&&n.add(C2(i).slice(1).join("."))}),n}class vf extends De{constructor(e,t,n){super(e);this.model=t,this.filter=n,this.expr=om(this.model,this.filter,this),this._dependentFields=gj(this.expr)}clone(){return new vf(null,this.model,pe(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set()}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function sle(e,t){var n;const i={},r=e.config.selection;for(const a of z(t??{})){const o=pe(t[a]),s=r[o.type],l=Z(s,["fields","encodings"]);for(const f in l){if(f==="encodings"&&o.fields||f==="fields"&&o.encodings)continue;f==="mark"&&(o[f]=Object.assign(Object.assign({},l[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=l[f])!==null&&n!==void 0?n:o[f])}const u=qe(a),c=i[u]=Object.assign(Object.assign({},o),{name:u,events:Y(o.on)?qo(o.on,"scope"):pe(o.on)});am(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[a])})}return i}function mj(e,t,n,i="datum"){const r=[];function a(s){const l=qe(s),u=e.getSelectionComponent(l,s),c=B(l+us);if(u.project.timeUnit){const f=n??e.component.data.raw,d=u.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return u.empty!=="none"&&r.push(c),`vlSelectionTest(${c}, ${i}`+(u.resolve==="global"?")":`, ${B(u.resolve)})`)}const o=Kc(t,a);return(r.length?"!("+r.map(s=>`length(data(${s}))`).join(" || ")+") || ":"")+`(${o})`}function vj(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&j(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${B(i)}.`);else if(n&&!i){const r=e.project.items.filter(a=>a.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,j((r.length?"Multiple ":"No ")+`matching ${B(n)} encoding found for selection ${B(t.selection)}. Using "field": ${B(i)}.`)):i=r[0].field}return`${e.name}[${B(i)}]`}function lle(e,t){cs(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new sn(new vf(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)})}function om(e,t,n){return Kc(t,i=>Y(i)?i:uae(i)?mj(e,i.selection,n):xI(i))}function ule(e,t){return e?I(e)&&!za(e)?e.map(n=>JI(n,t)).join(", "):e:void 0}function $2(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function yf(e,t,n,i={header:!1}){var r,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=Z(o,["disable","orient","scale","labelExpr","title","zindex"]);if(s)return;for(const p in h){const g=sie[p],m=h[p];if(g&&g!==t&&g!=="both")delete h[p];else if(yx(m)){const{condition:v}=m,y=Z(m,["condition"]),b=G(v),E=AN[p];if(E){const{vgProp:x,part:k}=E,w=[...b.map(A=>{const{test:_}=A,O=Z(A,["test"]);return Object.assign({test:om(null,_)},O)}),y];$2(h,k,x,w),delete h[p]}else if(E===null){const x={signal:b.map(k=>{const{test:w}=k,A=Z(k,["test"]);return`${om(null,w)} ? ${eM(A)} : `}).join("")+eM(y)};h[p]=x}}else if(oe(m)){const v=AN[p];if(v){const{vgProp:y,part:b}=v;$2(h,b,y,m),delete h[p]}}}if(t==="grid"){if(!h.grid)return;if(h.encode){const{grid:p}=h.encode;h.encode=Object.assign({},p?{grid:p}:{}),Ne(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:rt(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let g=c;((a=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||a===void 0?void 0:a.update)&&oe(h.encode.labels.update.text)&&(g=Sl(c,"datum.label",h.encode.labels.update.text.signal)),$2(h,"labels","text",{signal:g})}if(h.labelAlign===null&&delete h.labelAlign,h.encode){for(const g of SN)e.hasAxisPart(g)||delete h.encode[g];Ne(h.encode)&&delete h.encode}const p=ule(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},p?{title:p}:{}),h),n.aria===!1?{aria:!1}:{}),{zindex:rt(d,0)})}}function yj(e){const{axes:t}=e.component,n=[];for(const i of ri)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const a=i==="x"?"height":"width",o=e.getSizeSignalRef(a).signal;a!==o&&n.push({name:a,update:o})}}return n}function cle(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>yf(r,"grid",t)),...i.map(r=>yf(r,"grid",t)),...n.map(r=>yf(r,"main",t)),...i.map(r=>yf(r,"main",t))].filter(r=>r)}const bj={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},wj={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},fle=z(bj),dle=z(wj);function xj(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const a=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},s=t[n==="x"?"axisTop":"axisRight"]||{},l=new Set([...z(o),...z(s)]),u={};for(const c of l.values())u[c]={signal:`${i.signal} === "${a}" ? ${uf(o[c])} : ${uf(s[c])}`};return u}return t[r]})])}function hle(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:xae(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],a=e==="x"?"axisX":"axisY",o=oe(n)?"axisOrient":"axis"+vg(n),s=[...r,...r.map(u=>a+u.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:xj(s,i,e,n),vgAxisConfig:xj(l,i,e,n),axisConfigStyle:ple([...l,...s],i)}}function ple(e,t){var n;const i=[{}];for(const r of e){let a=(n=t[r])===null||n===void 0?void 0:n.style;if(a){a=G(a);for(const o of a)i.push(t.style[o])}}return Object.assign.apply(null,i)}function D2(e,t,n,i={}){var r;const a=nM(e,n,t.style);if(a!==void 0)return{configFrom:"style",configValue:a};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const Ej={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return FI(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return NI(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return q(e)&&an(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:gle(n,e)},gridScale:({model:e,channel:t})=>mle(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||_j(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||kj(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:yle(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:ble(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var a;const o=e==="x"?"width":e==="y"?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return(a=n.tickCount)!==null&&a!==void 0?a:xle({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=Aj(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),a=n==="x"?"x2":"y2",o=t.fieldDef(a);return rM(r?[BI(r)]:[],q(o)?[BI(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Ele(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:kle(n,t)}};function gle(e,t){return!On(e)&&q(t)&&!Me(t==null?void 0:t.bin)}function mle(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function vle(e,t,n,i,r){const a=t==null?void 0:t.labelAngle;if(a!==void 0)return oe(a)?a:yg(a);{const{configValue:o}=D2("labelAngle",e.config,t==null?void 0:t.style,r);return o!==void 0?yg(o):n===He&&ae([zx,Px],i.type)?270:void 0}}function R2(e){return`(((${e.signal} % 360) + 360) % 360)`}function kj(e,t,n,i){if(e!==void 0)if(n==="x"){if(oe(e)){const r=R2(e),a=oe(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${a} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(oe(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(oe(e)){const r=R2(e),a=oe(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${a} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(oe(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function _j(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,a=i?"bottom":"left";if(oe(e)){const o=R2(e),s=oe(t)?`(${t.signal} === "${a}")`:t===a;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${s} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(oe(t)){const o=r<e&&e<180+r?"===":"!==",s=`${t.signal} ${o} "${a}"`;return{signal:`${s} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===a)?"left":"right"}function yle(e,t){return t==="x"&&ae(["quantitative","temporal"],e)?!0:void 0}function ble(e,t){return e!=="nominal"?t==="log"?"greedy":!0:void 0}function wle(e){return e==="x"?"bottom":"left"}function xle({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!On(t)&&t!=="log"){if(q(e)){if(Me(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&ae(["month","hours","day","quarter"],(r=on(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function Aj(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),a=i?i.title:void 0,o=r?r.title:void 0;return a&&o?aM(a,o):a||(o||(a!==void 0?a:o!==void 0?o:void 0))}function Ele(e,t){const n=e.values;return I(n)?QI(t,n):oe(n)?n:void 0}function kle(e,t){return e==="rect"&&GI(t)?1:0}class bf extends De{constructor(e,t){super(e);this.transform=t,this._dependentFields=gj(this.transform.calculate)}clone(){return new bf(null,pe(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((n,i)=>{if(!Kx(n))return;if(zI(n.sort)){const{field:r,timeUnit:a}=n,o=n.sort,s=o.map((l,u)=>`${xI({field:r,timeUnit:a,equal:l})} ? ${u} : `).join("")+o.length;e=new bf(e,{calculate:s,as:Il(n,i,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${we(this.transform)}`}}function Il(e,t,n){return U(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function sm(e,t){return ae(["top","bottom"],t)?"column":ae(["left","right"],t)||e==="row"?"row":"column"}function Ml(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return rt(((t==null?void 0:t.header)||{})[e],r[e],n.header[e])}function lm(e,t,n,i){const r={};for(const a of e){const o=Ml(a,t,n,i);o!==void 0&&(r[a]=o)}return r}const F2=["row","column"],N2=["header","footer"];function _le(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=lm(["titleAnchor","titleAngle","titleOrient"],r,i,t),l=sm(t,s),u=yg(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Oj(u,l)),Sj(l,u,a)),Tj(i,r,t,fle,bj))}}function Sj(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=_j(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function Oj(e,t){const n=kj(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Ale(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of N2)if(n[r])for(const a of n[r]){const o=Ole(e,t,r,n,a);o!=null&&i.push(o)}return i}function Sle(e,t){var n;const{sort:i}=e;return ur(i)?{field:U(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:I(i)?{field:Il(e,t,{expr:"datum"}),order:"ascending"}:{field:U(e,{expr:"datum"}),order:i??"ascending"}}function I2(e,t,n){const{format:i,formatType:r,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=lm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),u=Wx({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=sm(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?Sl(Sl(l,"datum.label",u),"datum.value",U(e,{expr:"parent"})):u}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Oj(a,c)),Sj(c,a,o)),Tj(n,e,t,dle,wj))}function Ole(e,t,n,i,r){if(r){let a=null;const{facetFieldDef:o}=i,s=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=lm(["labelOrient"],o,s,t);(t==="row"&&!ae(["top","bottom"],f)||t==="column"&&!ae(["left","right"],f))&&(a=I2(o,t,s))}const l=Di(e)&&!of(e.facet),u=r.axes,c=(u==null?void 0:u.length)>0;if(a||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Sle(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const Tle={column:{start:0,end:1},row:{start:1,end:0}};function Cle(e,t){return Tle[t][e]}function $le(e,t){const n={};for(const i of ii){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:a,titleOrient:o}=lm(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),s=sm(i,o),l=Cle(a,s);l!==void 0&&(n[s]=l)}}return Ne(n)?void 0:n}function Tj(e,t,n,i,r){const a={};for(const o of i){if(!r[o])continue;const s=Ml(o,t,e,n);s!==void 0&&(a[r[o]]=s)}return a}function M2(e){return[...um(e,"width"),...um(e,"height"),...um(e,"childWidth"),...um(e,"childHeight")]}function um(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const a=e.getScaleComponent(n);if(a){const o=a.get("type"),s=a.get("range");if(On(o)&&Ma(s)){const l=e.scaleName(n);if(Di(e.parent)){const u=e.parent.component.resolve;if(u.scale[n]==="independent")return[Cj(l,s)]}return[Cj(l,s),{name:r,update:$j(l,a,`domain('${l}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const a=r.endsWith("width"),o=a?"containerSize()[0]":"containerSize()[1]",s=p2(e.config.view,a?"width":"height"),l=`isFinite(${o}) ? ${o} : ${s}`;return[{name:r,init:l,on:[{update:l,events:"window:resize"}]}]}else return[{name:r,value:i}]}function Cj(e,t){return{name:e+"_step",value:t.step}}function $j(e,t,n){const i=t.get("type"),r=t.get("padding"),a=rt(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${o}, ${a}) * ${e}_step`}function Dj(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Rj(e,t){return z(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),df(t,r,i,a=>oe(a)?a:{value:a.value}))},{})}function Dle(e,t){if(zl(t)||Di(t))return"shared";if(X2(t))return sr(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function j2(e,t){const n=e.scale[t],i=sr(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&j(Tre(t)),"independent"):e[i][t]||"shared"}const Rle=Object.assign(Object.assign({},xoe),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Fj=z(Rle);class Fle extends Ba{}const Nj={symbols:Nle,gradient:Ile,labels:Mle,entries:jle};function Nle(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:a}){var o,s,l,u,c;if(a!=="symbol")return;const{markDef:f,encoding:d,config:h,mark:p}=n,g=f.filled&&p!=="trail";let m=Object.assign(Object.assign({},eoe({},n,pie)),VM(n,{filled:g}));const v=(o=Ij(d.opacity))!==null&&o!==void 0?o:f.opacity;if(m.fill){if(i==="fill"||g&&i===An)delete m.fill;else if(m.fill.field)r.get("symbolFillColor")?delete m.fill:(m.fill=nt((s=h.legend.symbolBaseFillColor)!==null&&s!==void 0?s:"black"),m.fillOpacity=nt(v??1));else if(I(m.fill)){const y=(c=(u=L2((l=d.fill)!==null&&l!==void 0?l:d.color))!==null&&u!==void 0?u:f.fill)!==null&&c!==void 0?c:g&&f.color;y&&(m.fill=nt(y))}}if(m.stroke){if(i==="stroke"||!g&&i===An)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(I(m.stroke)){const y=rt(L2(d.stroke||d.color),f.stroke,g?f.color:void 0);y&&(m.stroke={value:y})}}if(i!==Ur){const y=q(t)&&jj(n,r,t);y?m.opacity=[Object.assign({test:y},nt(v??1)),nt(h.legend.unselectedOpacity)]:v&&(m.opacity=nt(v))}return m=Object.assign(Object.assign({},m),e),Ne(m)?void 0:m}function Ile(e,{model:t,legendType:n}){if(n!=="gradient")return;let i={};const r=Ij(t.encoding.opacity)||t.markDef.opacity;return r&&(i.opacity=nt(r)),i=Object.assign(Object.assign({},i),e),Ne(i)?void 0:i}function Mle(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const a=n.legend(i)||{},o=n.config,s=q(t)?jj(n,r,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=ns(c)?Gx({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return Ne(d)?void 0:d}function jle(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Ij(e){return Mj(e,(t,n)=>Math.max(t,n.value))}function L2(e){return Mj(e,(t,n)=>rt(t,n.value))}function Mj(e,t){return Wae(e)?G(e.condition).reduce(t,e.value):qr(e)?e.value:void 0}function jj(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=B(n.field);return i.map(a=>{const o=B(qe(a)+us);return`(!length(data(${o})) || (${a}[${r}] && indexof(${a}[${r}], datum.value) >= 0))`}).join(" || ")}const Lj={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return FI(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return NI(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Wle(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:Gle(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:Ple(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>is(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Ol(n)&&Ci(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Lle(t,e)};function Lle(e,t){const n=e.values;return I(n)?QI(t,n):oe(n)?n:void 0}function Ple(e,t,n,i){var r;if(t!=="shape"){const a=(r=L2(n))!==null&&r!==void 0?r:i;if(a)return a}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function zle(e){const{legend:t}=e;return rt(t.type,Ble(e))}function Ble({channel:e,timeUnit:t,scaleType:n}){if(Ol(e)){if(ae(["quarter","month","day"],t))return"symbol";if(Ci(n))return"gradient"}return"symbol"}function Ule({legendConfig:e,legendType:t,orient:n,legend:i}){var r,a;return(a=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&a!==void 0?a:qle(n,t)}function qle(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Wle({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;return Ci(r)?n==="horizontal"?i==="top"||i==="bottom"?Pj(t,"width",o,a):o:Pj(t,"height",l,s):void 0}function Pj(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function Gle(e){return ae(["quantile","threshold","log"],e)?"greedy":void 0}function zj(e){const t=Je(e)?Hle(e):Jle(e);return e.component.legends=t,t}function Hle(e){const{encoding:t}=e,n={};for(const i of[An,...xM]){const r=ft(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===Sn&&q(r)&&r.type===Rl)continue;n[i]=Xle(e,i)}return n}function Yle(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Vle(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Xle(e,t){var n,i,r;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new Fle({},Yle(e,t));Wse(e,t,c);const f=a!==void 0?!a:u.disable;if(c.set("disable",f,a!==void 0),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=ft(s[t]),p=q(h)?(n=on(h.timeUnit))===null||n===void 0?void 0:n.unit:void 0,g=a.orient||l.legend.orient||"right",m=zle({legend:a,channel:t,timeUnit:p,scaleType:d}),v=Ule({legend:a,legendType:m,orient:g,legendConfig:u}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:g,legendType:m,direction:v};for(const w of Fj){const A=w in Lj?Lj[w](y):a[w];if(A!==void 0){const _=Vle(A,w,a,e.fieldDef(t));(_||l.legend[w]===void 0)&&c.set(w,A,_)}}const b=(i=a==null?void 0:a.encoding)!==null&&i!==void 0?i:{},E=c.get("selections"),x={},k={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:m};for(const w of["labels","legend","title","symbols","gradient","entries"]){const A=Rj((r=b[w])!==null&&r!==void 0?r:{},e),_=w in Nj?Nj[w](A,k):A;_!==void 0&&!Ne(_)&&(x[w]=Object.assign(Object.assign(Object.assign({},(E==null?void 0:E.length)&&q(h)?{name:`${qe(h.field)}_legend_${w}`}:{}),(E==null?void 0:E.length)?{interactive:!!E}:{}),{update:_}))}return Ne(x)||c.set("encode",x,!!(a==null?void 0:a.encoding)),c}function Jle(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){zj(i);for(const r of z(i.component.legends))n.legend[r]=j2(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Bj(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of z(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function Bj(e,t){var n,i,r,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const u of Fj){const c=Ua(e.getWithExplicit(u),t.getWithExplicit(u),u,"legend",(f,d)=>{switch(u){case"symbolType":return Kle(f,d);case"title":return oM(f,d);case"type":return l=!0,Un("symbol")}return Qg(f,d,u,"legend")});e.setWithExplicit(u,c)}return l&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&mx(e.implicit,["encode","gradient"]),((a=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||a===void 0?void 0:a.gradient)&&mx(e.explicit,["encode","gradient"])),e}function Kle(e,t){return t.value==="circle"?t:e}function Uj(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function qj(e){const t=e.component.legends,n={};for(const r of z(t)){const a=e.getScaleComponent(r),o=Ue(a.get("domains"));if(n[o])for(const s of n[o]){const l=Bj(s,t[r]);l||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=Sa(n).flat().map(r=>Qle(r,e.config)).filter(r=>r!==void 0);return i}function Qle(e,t){var n,i,r;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=Z(a,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&u.aria==null&&(u.aria=!1),(n=u.encode)===null||n===void 0?void 0:n.symbols){const c=u.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!u.stroke&&(c.stroke={value:"transparent"});for(const f of xM)u[f]&&delete c[f]}if(u.title||delete u.title,s!==void 0){let c=s;((r=(i=u.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&oe(u.encode.labels.update.text)&&(c=Sl(s,"datum.label",u.encode.labels.update.text.signal)),Uj(u,"labels","text",{signal:c})}for(const c in u){const f=u[c];if(oe(f)){const d=boe[c];if(d){const{vgProp:h,part:p}=d;Uj(u,p,h,f),delete u[c]}}}return u}function Zle(e){return zl(e)||X2(e)?eue(e):Wj(e)}function eue(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Wj(e))}function Wj(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},a=t.data.reduce((o,s)=>{const l=oe(s)?s.signal:`data('${e.lookupDataSource(s)}')`;return ae(o,l)||o.push(l),o},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const tue=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Gj extends Ba{constructor(e,t,n,i){super(Object.assign({},t),{name:e});this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function Hj(e){e.component.projection=Je(e)?nue(e):aue(e)}function nue(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=i?iue(e):void 0;return new Gj(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),r,a)}return}function iue(e){const t=[],{encoding:n}=e;for(const i of[[nr,tr],[ni,Ti]])(ft(n[i[0]])||ft(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Sn)&&e.typedFieldDef(Sn).type===Rl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(qt)),t}function rue(e,t){const n=yN(tue,r=>!Q(e.explicit,r)&&!Q(t.explicit,r)?!0:!!(Q(e.explicit,r)&&Q(t.explicit,r)&&Ue(e.get(r))===Ue(t.get(r)))),i=Ue(e.size)===Ue(t.size);if(i){if(n)return e;if(Ue(e.explicit)===Ue({}))return t;if(Ue(t.explicit)===Ue({}))return e}return null}function aue(e){if(e.children.length===0)return;let t;for(const i of e.children)Hj(i);const n=yN(e.children,i=>{const r=i.component.projection;if(r)if(t){const a=rue(t,r);return a&&(t=a),!!a}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Gj(i,t.specifiedProjection,t.size,pe(t.data));for(const a of e.children){const o=a.component.projection;o&&(o.isFit&&r.data.push(...a.component.projection.data),a.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}function oue(e,t,n,i){var r,a;if(lf(t,n)){const o=Je(e)?(a=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&a!==void 0?a:{}:{},s=U(t,{expr:"datum"}),l=U(t,{expr:"datum",binSuffix:"end"});return{formulaAs:U(t,{binSuffix:"range",forAs:!0}),formula:Lg(s,l,o.format,o.formatType,i)}}return{}}function Yj(e,t){return`${YN(e)}_${t}`}function sue(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function P2(e,t,n){var i;const r=(i=Wg(n,void 0))!==null&&i!==void 0?i:{},a=Yj(r,t);return e.getName(`${a}_bins`)}function lue(e){return"as"in e}function Vj(e,t,n){let i,r;lue(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[U(e,{forAs:!0}),U(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},Wg(t,void 0)),o=Yj(a,e.field),{signal:s,extentSignal:l}=sue(n,o);if(Fg(a.extent)){const c=a.extent,f=c.selection;r=vj(n.getSelectionComponent(qe(f),f),c),delete a.extent}const u=Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[i]},s?{signal:s}:{}),l?{extentSignal:l}:{}),r?{span:r}:{});return{key:o,binComponent:u}}class Yr extends De{constructor(e,t){super(e);this.bins=t}clone(){return new Yr(null,pe(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{if(Bn(r)&&Me(r.bin)){const{key:o,binComponent:s}=Vj(r,r.bin,t);i[o]=Object.assign(Object.assign(Object.assign({},s),i[o]),oue(t,r,a,t.config))}return i},{});return Ne(n)?null:new Yr(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=Vj(t,t.bin,n);return new Yr(e,{[i]:r})}merge(e,t){for(const n of z(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=Aa([...this.bins[n].as,...e.bins[n].as],we)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(Sa(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(Sa(this.bins).map(e=>e.field))}hash(){return`Bin ${we(this.bins)}`}assemble(){return Sa(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:a}=r,o=Z(r,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:Oa(e.field),as:n,signal:e.signal},Fg(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:Oa(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const l of i)for(let u=0;u<2;u++)t.push({type:"formula",expr:U({field:n[u]},{expr:"datum"}),as:l[u]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class jl extends De{constructor(e){super(null);e=e??{name:"source"};let t;if(ls(e)||(t=e.format?Object.assign({},Ir(e.format,["parse"])):{}),Zg(e))this._data={values:e.values};else if(ff(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];ae(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else qM(e)?this._data={values:[{type:"Sphere"}]}:(BM(e)||ls(e))&&(this._data={});this._generator=ls(e),e.name&&(this._name=e.name),t&&!Ne(t)&&(this._data.format=t)}dependentFields(){return new Set()}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function z2(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!z2(t.children))return!1}return!0}class cm extends De{constructor(e,t){super(e);this.params=t}clone(){return new cm(null,this.params)}dependentFields(){return new Set()}producedFields(){return}hash(){return`Graticule ${we(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class fm extends De{constructor(e,t){super(e);this.params=t}clone(){return new fm(null,this.params)}dependentFields(){return new Set()}producedFields(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])}hash(){return`Hash ${we(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function dm(e){return e instanceof jl||e instanceof cm||e instanceof fm}class Xj{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Vr extends Xj{constructor(){super();this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(dm(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class B2 extends Xj{}function uue(e,t,n,i){const r=Je(i)?i.encoding[ar(t)]:void 0;if(Bn(n)&&Je(i)&&Yx(t,n,r,i.stack,i.markDef,i.config))e.add(U(n,{})),e.add(U(n,{suffix:"end"})),n.bin&&lf(n,t)&&e.add(U(n,{binSuffix:"range"}));else if(Rie(t)){const a=Die(t);e.add(i.getName(a))}else e.add(U(n));return e}function cue(e,t){var n;for(const i of z(t)){const r=t[i];for(const a of z(r))i in e?e[i][a]=new Set([...(n=e[i][a])!==null&&n!==void 0?n:[],...r[a]]):e[i]={[a]:r[a]}}}class pr extends De{constructor(e,t,n){super(e);this.dimensions=t,this.measures=n}clone(){return new pr(null,new Set(this.dimensions),pe(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(a=>{a.aggregate&&(n=!0)});const i={},r=new Set();return n?(t.forEachFieldDef((a,o)=>{var s,l,u,c;const{aggregate:f,field:d}=a;if(f)if(f==="count")i["*"]=(s=i["*"])!==null&&s!==void 0?s:{},i["*"].count=new Set([U(a,{forAs:!0})]);else{if(Ta(f)||Jo(f)){const h=Ta(f)?"argmin":"argmax",p=f[h];i[p]=(l=i[p])!==null&&l!==void 0?l:{},i[p][h]=new Set([U({op:h,field:p},{forAs:!0})])}else i[d]=(u=i[d])!==null&&u!==void 0?u:{},i[d][f]=new Set([U(a,{forAs:!0})]);Ia(o)&&t.scaleDomain(o)==="unaggregated"&&(i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d].min=new Set([U({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([U({field:d,aggregate:"max"},{forAs:!0})]))}else uue(r,o,a,t)}),r.size+z(i).length===0?null:new pr(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const a=new Set(),o={};for(const s of t.aggregate){const{op:l,field:u,as:c}=s;l&&(l==="count"?(o["*"]=(n=o["*"])!==null&&n!==void 0?n:{},o["*"].count=new Set([c||U(s,{forAs:!0})])):(o[u]=(i=o[u])!==null&&i!==void 0?i:{},o[u][l]=new Set([c||U(s,{forAs:!0})])))}for(const s of(r=t.groupby)!==null&&r!==void 0?r:[])a.add(s);return a.size+z(o).length===0?null:new pr(e,a,o)}merge(e){return eie(this.dimensions,e.dimensions)?(cue(this.measures,e.measures),!0):(Wre("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...z(this.measures)])}producedFields(){const e=new Set();for(const t of z(this.measures))for(const n of z(this.measures[t])){const i=this.measures[t][n];i.size===0?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${we({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of z(this.measures))for(const a of z(this.measures[r]))for(const o of this.measures[r][a])n.push(o),e.push(a),t.push(r==="*"?null:Oa(r));const i={type:"aggregate",groupby:[...this.dimensions].map(Oa),ops:e,fields:t,as:n};return i}}class Ll extends De{constructor(e,t,n,i){super(e);this.model=t,this.name=n,this.data=i;for(const r of ii){const a=t.facet[r];if(a){const{bin:o,sort:s}=a;this[r]=Object.assign({name:t.getName(`${r}_domain`),fields:[U(a),...Me(o)?[U(a,{binSuffix:"end"})]:[]]},ur(s)?{sortField:s}:I(s)?{sortIndexField:Il(a,r)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of ii)this[t]&&(e+=` ${t.charAt(0)}:${we(this[t])}`);return e}get fields(){var e;const t=[];for(const n of ii)((e=this[n])===null||e===void 0?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of ii)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set()}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of ri){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(On(i)&&Ma(r)){const a=pm(this.childModel,t),o=Y2(a);o?e[t]=o:j(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],a=[],o=[];n&&n[i]&&(t?(r.push(`distinct_${n[i]}`),a.push("max")):(r.push(n[i]),a.push("distinct")),o.push(`distinct_${n[i]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:u=Pg,field:c}=s;r.push(c),a.push(u),o.push(U(s,{forAs:!0}))}else l&&(r.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:t??this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,a=[],o={};for(const u of F2){for(const c of N2){const f=(t=r[u]&&r[u][c])!==null&&t!==void 0?t:[];for(const d of f)if(((n=d.axes)===null||n===void 0?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const c=`length(data("${this.facet.name}"))`,f=u==="row"?i?{signal:`ceil(${c} / ${i})`}:1:i?{signal:`min(${c}, ${i})`}:{signal:c};a.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((e=r.x)!==null&&e!==void 0?e:[],(t=r.y)!==null&&t!==void 0?t:[]),u=l.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[Lr,jr])this[l]&&n.push(this.assembleRowColumnHeaderData(l,i,r));if(s){const l=this.assembleFacetHeaderData(r);l&&n.push(...l)}return n}}function Jj(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function fue(e,t){const n=kN(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=Jj(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=Jj(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return j(nre(t)),null}function due(e){const t={};return pg(e.filter,n=>{var i;if(wI(n)){let r=null;Ix(n)?r=n.equal:Mx(n)?r=n.range[0]:jx(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Cl(r)?t[n.field]="date":Re(r)?t[n.field]="number":Y(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function hue(e){const t={};function n(i){Gg(i)?t[i.field]="date":i.type==="quantitative"&&Sie(i.aggregate)?t[i.field]="number":Qc(i.field)>1?i.field in t||(t[i.field]="flatten"):Kx(i)&&ur(i.sort)&&Qc(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Je(e)||Di(e))&&e.forEachFieldDef((i,r)=>{if(Bn(i))n(i);else{const a=Zo(r),o=e.fieldDef(a);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Je(e)){const{mark:i,markDef:r,encoding:a}=e;if(Xo(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",s=a[o];q(s)&&s.type==="quantitative"&&!(s.field in t)&&(t[s.field]="number")}}return t}function pue(e){const t={};if(Je(e)&&e.component.selection)for(const n of z(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&Qc(r.field)>1&&(t[r.field]="flatten")}return t}class ln extends De{constructor(e,t){super(e);this._parse=t}clone(){return new ln(null,pe(this._parse))}hash(){return`Parse ${we(this._parse)}`}static makeExplicit(e,t,n){let i={};const r=t.data;return!ls(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const o of z(n)){const s=i.getWithExplicit(o);s.value!==void 0&&(s.explicit||s.value===n[o]||s.value==="derived"||n[o]==="flatten"?delete n[o]:j(tI(o,n[o],s.value)))}for(const o of z(t)){const s=i.get(o);s!==void 0&&(s===t[o]?delete t[o]:j(tI(o,t[o],s)))}const r=new Ba(t,n);i.copyAll(r);const a={};for(const o of z(r.combine())){const s=r.get(o);s!==null&&(a[o]=s)}return z(a).length===0||i.parseNothing?null:new ln(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of z(this._parse)){const n=this._parse[t];Qc(t)===1&&(e[t]=n)}return e}producedFields(){return new Set(z(this._parse))}dependentFields(){return new Set(z(this._parse))}assembleTransforms(e=!1){return z(this._parse).filter(t=>e?Qc(t)>1:!0).map(t=>{const n=fue(t,this._parse[t]);if(!n)return null;const i={type:"formula",expr:n,as:_N(t)};return i}).filter(t=>t!==null)}}class fs extends De{clone(){return new fs(null)}constructor(e){super(e)}dependentFields(){return new Set()}producedFields(){return new Set([Fl])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Fl}}}class Pl extends De{constructor(e,t){super(e);this.transform=t}clone(){return new Pl(null,pe(this.transform))}addDimensions(e){this.transform.groupby=Aa(this.transform.groupby.concat(e),t=>t)}dependentFields(){const e=new Set();return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(t=>t.field).filter(t=>t!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`JoinAggregateTransform ${we(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(r.field===void 0?null:r.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},i!==void 0?{groupby:i}:{})}}function gue(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=U(i);return r&&t.push(r),t},[])}function mue(e){return I(e)&&e.every(t=>Y(t))&&e.length>1}class Ga extends De{constructor(e,t){super(e);this._stack=t}clone(){return new Ga(null,pe(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:a="zero"}=t,o=[],s=[];if(t.sort!==void 0)for(const c of t.sort)o.push(c.field),s.push(rt(c.order,"ascending"));const l={field:o,order:s};let u;return mue(r)?u=r:Y(r)?u=[r,r+"_end"]:u=[t.stack+"_start",t.stack+"_end"],new Ga(e,{stackField:n,groupby:i,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:a,offset:o,impute:s}=n;let l;if(r){const d=i[r];l=fr(d)}const u=gue(t),c=t.encoding.order;let f;return I(c)||q(c)?f=iM(c):f=u.reduce((d,h)=>(d.field.push(h),d.order.push(a==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Ga(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set();return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${we(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[U(e,{binSuffix:"mid"})]:[U(e,{}),U(e,{binSuffix:"end"})]:[U(e)]:n??[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:u=.5,bin:c}=n;c&&e.push({type:"formula",expr:`${u}*`+U(n,{expr:"datum"})+`+${1-u}*`+U(n,{expr:"datum",binSuffix:"end"}),as:U(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:U(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:a,as:l,offset:o}),e}}class wf extends De{constructor(e,t){super(e);this.transform=t}clone(){return new wf(null,pe(this.transform))}addDimensions(e){this.transform.groupby=Aa(this.transform.groupby.concat(e),t=>t)}dependentFields(){var e,t;const n=new Set();return((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(n.add,n),((t=this.transform.sort)!==null&&t!==void 0?t:[]).forEach(i=>n.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`WindowTransform ${we(this.transform)}`}assemble(){var e;const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&a[0]===null&&a[1]===null&&n.every(f=>Ex(f)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},o!==void 0?{groupby:o}:{});const s=[],l=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)s.push(f.field),l.push((e=f.order)!==null&&e!==void 0?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:u},c!==void 0?{ignorePeers:c}:{}),o!==void 0?{groupby:o}:{}),a!==void 0?{frame:a}:{})}}class vue extends Vr{run(e){const t=e.parent;if(e instanceof ln){if(dm(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof ln)this.setMutated(),t.merge(e);else{if(xN(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class yue extends B2{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(i=>i.hash()),n={};for(let i=0;i<t.length;i++)n[t[i]]===void 0?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const i of z(n))n[i].length>1&&(this.setMutated(),this.mergeNodes(e,n[i]));for(const i of e.children)this.run(i);return this.mutatedFlag}}class bue extends Vr{run(e){return e instanceof sn||e.numChildren()>0||e instanceof Ll?this.flags:(this.setMutated(),e.remove(),this.flags)}}class wue extends Vr{constructor(){super(...arguments);this.fields=new Set(),this.prev=null}run(e){if(this.setContinue(),e instanceof Gr){const t=e.producedFields();bN(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class xue extends Vr{run(e){this.setContinue();const t=e.parent,n=t.children.filter(r=>r instanceof Gr),i=n.pop();for(const r of n)this.setMutated(),i.merge(r);return this.flags}}function Eue(e){function t(n){if(!(n instanceof Ll)){const i=n.clone();if(i instanceof sn){const r=q2+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof pr||i instanceof Ga||i instanceof wf||i instanceof Pl)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function U2(e){if(e instanceof Ll)if(e.numChildren()===1&&!(e.children[0]instanceof sn)){const t=e.children[0];(t instanceof pr||t instanceof Ga||t instanceof wf||t instanceof Pl)&&t.addDimensions(e.fields),t.swapWithParent(),U2(e)}else{const t=e.model.component.data.main;Kj(t);const n=Eue(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(U2)}function Kj(e){if(e instanceof sn&&e.type===qt&&e.numChildren()===1){const t=e.children[0];t instanceof Ll||(t.swapWithParent(),Kj(e))}}class kue extends B2{constructor(){super()}run(e){e instanceof sn&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class _ue extends B2{constructor(e){super();this.requiresSelectionId=e&&T2(e)}run(e){e instanceof fs&&(this.requiresSelectionId&&(dm(e.parent)||e.parent instanceof pr||e.parent instanceof ln)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class Aue extends Vr{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(r=>r instanceof ln);if(t.numChildren()>1&&i.length>=1){const r={},a=new Set();for(const o of i){const s=o.parse;for(const l of z(s))l in r?r[l]!==s[l]&&a.add(l):r[l]=s[l]}for(const o of a)delete r[o];if(!Ne(r)){this.setMutated();const o=new ln(t,r);for(const s of n){if(s instanceof ln)for(const l of z(r))delete s.parse[l];t.removeChild(s),s.parent=o,s instanceof ln&&z(s.parse).length===0&&s.remove()}}}return this.setContinue(),this.flags}}class Sue extends Vr{run(e){const t=e.parent,n=t.children.filter(r=>r instanceof pr),i={};for(const r of n){const a=we(r.groupBy);a in i||(i[a]=[]),i[a].push(r)}for(const r of z(i)){const a=i[r];if(a.length>1){const o=a.pop();for(const s of a)o.merge(s)&&(t.removeChild(s),s.parent=o,s.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Oue extends Vr{constructor(e){super();this.model=e}run(e){const t=e.parent,n=!(dm(t)||t instanceof vf||t instanceof ln||t instanceof fs),i=[],r=[];for(const a of t.children)a instanceof Yr&&(n&&!xN(t.producedFields(),a.dependentFields())?i.push(a):r.push(a));if(i.length>0){const a=i.pop();for(const o of i)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof Yr?t.merge(a,this.model.renameSignal.bind(this.model)):a.swapWithParent()}if(r.length>1){const a=r.pop();for(const o of r)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class Tue extends Vr{run(e){const t=e.parent,n=[...t.children],i=Jc(n,o=>o instanceof sn);if(!i||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let a;for(const o of n)if(o instanceof sn){let s=o;for(;s.numChildren()===1;){const l=s.children[0];if(l instanceof sn)s=l;else break}r.push(...s.children),a?(t.removeChild(o),o.parent=a.parent,a.parent.removeChild(a),a.parent=s,this.setMutated()):a=s}else r.push(o);if(r.length){this.setMutated();for(const o of r)o.parent.removeChild(o),o.parent=a}return this.setContinue(),this.flags}}const q2="scale_",hm=5;function Ha(e){const t=[];function n(i){if(i.numChildren()===0)t.push(i);else for(const r of i.children)n(r)}for(const i of e)n(i);return t}function Cue(e){return e}function $i(e,t){const n=t.map(i=>{if(e instanceof Vr){const r=e.optimizeNextFromLeaves(i);return e.reset(),r}else return e.run(i)});return n.some(Cue)}function Qj(e,t){let n=e.sources;const i=new Set();return i.add($i(new kue(),n)),i.add($i(new _ue(t),n)),n=n.filter(r=>r.numChildren()>0),i.add($i(new bue(),Ha(n))),n=n.filter(r=>r.numChildren()>0),i.add($i(new vue(),Ha(n))),i.add($i(new Oue(t),Ha(n))),i.add($i(new wue(),Ha(n))),i.add($i(new Aue(),Ha(n))),i.add($i(new Sue(),Ha(n))),i.add($i(new xue(),Ha(n))),i.add($i(new yue(),n)),i.add($i(new Tue(),Ha(n))),e.sources=n,i.has(!0)}function $ue(e,t){z2(e.sources);let n=0,i=0;for(let r=0;r<hm&&Qj(e,t);r++)n++;e.sources.map(U2);for(let r=0;r<hm&&Qj(e,t);r++)i++;z2(e.sources),Math.max(n,i)===hm&&j(`Maximum optimization runs(${hm}) reached.`)}class si{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new si(()=>e(t))}}function Zj(e){Je(e)?Due(e):Rue(e)}function Due(e){const t=e.component.scales;for(const n of z(t)){const i=Nue(e,n),r=t[n];if(r.setWithExplicit("domains",i),Mue(e,n),e.component.data.isFaceted){let a=e;for(;!Di(a)&&a.parent;)a=a.parent;const o=a.component.resolve.scale[n];if(o==="shared")for(const s of i.value)ja(s)&&(s.data=q2+s.data.replace(q2,""))}}}function Rue(e){for(const n of e.children)Zj(n);const t=e.component.scales;for(const n of z(t)){let i,r=null;for(const a of e.children){const o=a.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Ua(i,o.getWithExplicit("domains"),"domains","scale",H2);const s=o.get("selectionExtent");r&&s&&r.selection!==s.selection&&j("The same selection must be used to override scale domains in a layered view."),r=s}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function Fue(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:a}=e3(t,n);if(!r){j(a);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=e3(t,n);if(r)return"unaggregated"}return e}function Nue(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=Fue(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&ft(i.x2)?ft(i.x)?Ua(Ya(n,r,e,"x"),Ya(n,r,e,"x2"),"domain","scale",H2):Ya(n,r,e,"x2"):t==="y"&&ft(i.y2)?ft(i.y)?Ua(Ya(n,r,e,"y"),Ya(n,r,e,"y2"),"domain","scale",H2):Ya(n,r,e,"y2"):Ya(n,r,e,t)}function Iue(e,t,n){return e.map(i=>{const r=t2(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function W2(e,t,n){var i;const r=(i=on(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?Iue(e,t,r):[e]}function Ya(e,t,n,i){const{encoding:r}=n,a=ft(r[i]),{type:o}=a,s=a.timeUnit;if($ae(t)){const f=Ya(e,void 0,n,i),d=W2(t.unionWith,o,s);return ss([...f.value,...d])}else{if(oe(t))return ss([t]);if(t&&t!=="unaggregated"&&!_I(t))return ss(W2(t,o,s))}const l=n.stack;if(l&&i===l.fieldChannel){if(l.offset==="normalize")return Un([[0,1]]);const f=n.requestDataName(qt);return Un([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const u=Ia(i)&&q(a)?jue(n,i,e):void 0;if(Pa(a)){const f=W2([a.datum],o,s);return Un(f)}const c=a;if(t==="unaggregated"){const f=n.requestDataName(qt),{field:d}=a;return Un([{data:f,field:U({field:d,aggregate:"min"})},{data:f,field:U({field:d,aggregate:"max"})}])}else if(Me(c.bin)){if(On(e))return e==="bin-ordinal"?Un([]):Un([{data:mg(u)?n.requestDataName(qt):n.requestDataName(em),field:n.vgField(i,lf(c,i)?{binSuffix:"range"}:{}),sort:u===!0||!K(u)?{field:n.vgField(i,{}),op:"min"}:u}]);{const{bin:f}=c;if(Me(f)){const d=P2(n,c.field,f);return Un([new si(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return Un([{data:n.requestDataName(qt),field:n.vgField(i,{})}])}}else if(c.timeUnit&&ae(["time","utc"],e)&&Yx(i,c,Je(n)?n.encoding[ar(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(qt);return Un([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Un(u?[{data:mg(u)?n.requestDataName(qt):n.requestDataName(em),field:n.vgField(i),sort:u}]:[{data:n.requestDataName(qt),field:n.vgField(i)}])}function G2(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Pg)},i?{field:Oa(i)}:{}),r?{order:r}:{})}function Mue(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,a=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=_I(r)&&r,s=nf(a)&&Fg(a.extent)&&a.extent;(o||s)&&i.set("selectionExtent",o??s,!0)}function jue(e,t,n){if(!On(n))return;const i=e.fieldDef(t),r=i.sort;if(zI(r))return{op:"min",field:Il(i,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(s=>s.fieldDef.field)]:void 0;if(ur(r)){const s=a&&!ae(o,r.field);return G2(r,s)}else if(PI(r)){const{encoding:s,order:l}=r,u=e.fieldDef(s),{aggregate:c,field:f}=u,d=a&&!ae(o,f);if(Ta(c)||Jo(c))return G2({field:U(u),order:l},d);if(Ex(c)||!c)return G2({op:c,field:f,order:l},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(ae(["ascending",void 0],r))return!0}return}function e3(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!Cie[n]?{valid:!1,reason:xre(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:Ere(e)}:{valid:!0}:{valid:!1,reason:wre(e)}}function H2(e,t,n,i){return e.explicit&&t.explicit&&j(Ore(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Lue(e){const t=Aa(e.map(o=>{if(ja(o)){const s=Z(o,["sort"]);return s}return o}),we),n=Aa(e.map(o=>{if(ja(o)){const s=o.sort;return s!==void 0&&!mg(s)&&("op"in s&&s.op==="count"&&delete s.field,s.order==="ascending"&&delete s.order),s}return}).filter(o=>o!==void 0),we);if(t.length===0)return;if(t.length===1){const o=e[0];if(ja(o)&&n.length>0){let s=n[0];if(n.length>1)j(sI),s=!0;else if(K(s)&&"field"in s){const l=s.field;o.field===l&&(s=s.order?{order:s.order}:!0)}return Object.assign(Object.assign({},o),{sort:s})}return o}const i=Aa(n.map(o=>mg(o)||!("op"in o)||o.op in _ie?o:(j(Cre(o)),!0)),we);let r;i.length===1?r=i[0]:i.length>1&&(j(sI),r=!0);const a=Aa(e.map(o=>ja(o)?o.data:null),o=>o);if(a.length===1&&a[0]!==null){const o=Object.assign({data:a[0],fields:t.map(s=>s.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function Y2(e){if(ja(e)&&Y(e.field))return e.field;if(rae(e)){let t;for(const n of e.fields)if(ja(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return j($re),t}return j(Dre),t}else if(aae(e)){j(Rre);const t=e.fields[0];return Y(t)?t:void 0}return}function pm(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(ja(r)&&(r.data=e.lookupDataSource(r.data)),r));return Lue(i)}function t3(e){return zl(e)||X2(e)?e.children.reduce((t,n)=>t.concat(t3(n)),n3(e)):n3(e)}function n3(e){return z(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=r,f=Z(r,["name","type","selectionExtent","domains","range","reverse"]),d=Pue(r.range,a,n);let h;s&&(h=Zse(e,s));const p=pm(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function Pue(e,t,n){return sr(n)&&Ma(e)?{step:{signal:t+"_step"}}:e}class i3 extends Ba{constructor(e,t){super({},{name:e});this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Jc(this.get("domains"),e=>I(e)&&e.length===2&&e[0]<=0&&e[1]>=0)}}const zue=["range","scheme"];function r3(e){return e==="x"?"width":e==="y"?"height":void 0}function Bue(e){const t=e.component.scales;for(const n of Dg){const i=t[n];if(!i)continue;const r=Uue(n,e);i.setWithExplicit("range",r)}}function a3(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Me(n.bin)){const i=P2(e,n.field,n.bin),r=r3(t),a=e.getName(r);return new si(()=>{const o=e.getSignalName(i),s=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(a)} / (${s})`})}return}function Uue(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),a=r.get("type");for(const o of zue)if(n[o]!==void 0){const s=AI(a,o),l=SI(e,o);if(!s)j(aI(a,o,e));else if(l)j(l);else switch(o){case"range":return I(n.range)&&sr(e)?ss(n.range.map(u=>{if(u==="width"||u==="height"){const c=t.getName(u),f=t.getSignalName.bind(t);return si.fromName(f,c)}return u})):ss(n.range);case"scheme":return ss(que(n[o]))}}if(e===He||e===ct){const o=e===He?"width":"height",s=i[o];if(dr(s)){if(On(a))return ss({step:s.step});j(oI(o))}}return Un(Wue(e,t))}function que(e){return Cae(e)?Object.assign({scheme:e.name},Ir(e,["name"])):{scheme:e}}function Wue(e,t){const{size:n,config:i,mark:r,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=ft(a[e]),l=t.getScaleComponent(e),u=l.get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case He:case ct:{if(ae(["point","band"],u)){if(e===He&&!n.width){const p=cf(i.view,"width");if(dr(p))return p}else if(e===ct&&!n.height){const p=cf(i.view,"height");if(dr(p))return p}}const d=r3(e),h=t.getName(d);return e===ct&&ai(u)?[si.fromName(o,h),0]:[0,si.fromName(o,h)]}case Br:{const d=t.component.scales[e].get("zero"),h=o3(r,d,i),p=Yue(r,n,t,i);return Mg(u)?Hue(h,p,Gue(u,i,c,e)):[h,p]}case Oi:return[0,Math.PI*2];case Ko:return[0,360];case er:return[0,new si(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case Da:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Ra:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Sn:return"symbol";case An:case ir:case rr:return u==="ordinal"?s==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Ur:case Ca:case $a:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function Gue(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&I(n)?n.length+1:(j(Bre(i)),3)}}function Hue(e,t,n){const i=()=>{const r=uf(t),a=uf(e),o=`(${r} - ${a}) / (${n} - 1)`;return`sequence(${a}, ${r} + ${o}, ${o})`};return oe(t)?new si(i):{signal:i()}}function o3(e,t,n){if(t)return oe(t)?{signal:`${t.signal} ? 0 : ${o3(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Ng("size",e))}const s3=.95;function Yue(e,t,n,i){const r={x:a3(n,"x"),y:a3(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const a=l3(t,r,i.view);return Re(a)?a-1:new si(()=>`${a.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const a=l3(t,r,i.view);return Re(a)?Math.pow(s3*a,2):new si(()=>`pow(${s3} * ${a.signal}, 2)`)}}throw new Error(Ng("size",e))}function l3(e,t,n){const i=dr(e.width)?e.width.step:Jg(n,"width"),r=dr(e.height)?e.height.step:Jg(n,"height");return t.x||t.y?new si(()=>{const a=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${a.join(", ")})`}):Math.min(i,r)}function u3(e,t){Je(e)?Vue(e,t):d3(e,t)}function Vue(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:a,specifiedScales:o}=e;for(const s of z(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=ft(r[s]),d=l[t],h=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=AI(h,t),v=SI(s,t);if(d!==void 0&&(m?v&&j(v):j(aI(h,t,s))),m&&v===void 0)if(d!==void 0)u.copyKeyFromObject(t,l);else{const y=t in c3?c3[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:g,domain:l.domain,markDef:a,config:i}):i.scale[t];y!==void 0&&u.set(t,y,!1)}}}const c3={bins:({model:e,fieldOrDatumDef:t})=>q(t)?Xue(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Jue(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>Kue(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>Que(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>Zue(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:a})=>ece(e,t,n,i.type,r,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=q(e)?e.sort:void 0;return tce(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>nce(e,t,n,i,r)};function f3(e){Je(e)?Bue(e):d3(e,"range")}function d3(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?f3(i):u3(i,t);for(const i of z(n)){let r;for(const a of e.children){const o=a.component.scales[i];if(o){const s=o.getWithExplicit(t);r=Ua(r,s,t,"scale",zM((l,u)=>{switch(t){case"range":return l.step&&u.step?l.step-u.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Xue(e,t){const n=t.bin;if(Me(n)){const i=P2(e,t.field,n);return new si(()=>e.getSignalName(i))}else if(an(n)&&nf(n)&&n.step!==void 0)return{step:n.step};return}function Jue(e,t){return ae([An,ir,rr],e)&&t!=="nominal"?"hcl":void 0}function Kue(e,t,n){var i;return((i=fr(n))===null||i===void 0?void 0:i.bin)||ae([at.TIME,at.UTC],e)?void 0:t in Na?!0:void 0}function Que(e,t,n,i,r,a){if(e in Na){if(Ci(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:s}=r;if(o==="bar"&&!(q(i)&&(i.bin||i.timeUnit))&&(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"))return a.continuousBandSize}if(t===at.POINT)return n.pointPadding}return}function Zue(e,t,n,i){if(e!==void 0)return;if(t in Na){const{bandPaddingInner:r,barBandPaddingInner:a,rectBandPaddingInner:o}=i;return rt(r,n==="bar"?a:o)}return}function ece(e,t,n,i,r,a){if(e!==void 0)return;if(t in Na&&n===at.BAND){const{bandPaddingOuter:o}=a;return rt(o,oe(r)?{signal:`${r.signal}/2`}:r/2)}return}function tce(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ai(e)&&t==="descending"?oe(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ai(e)&&t==="descending"?!0:void 0}function nce(e,t,n,i,r){const a=!!n&&n!=="unaggregated";if(a&&ai(r)){if(I(n)){const o=n[0],s=n[n.length-1];if(o<=0&&s>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Mg(r))return!0;if(!(q(t)&&t.bin)&&ae([...ri,...zie],e)){const{orient:o,type:s}=i;return!(ae(["bar","area","line","trail"],s)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function ice(e,t,n,i){const r=rce(t,n,i),{type:a}=e;return Ia(t)?a!==void 0?TI(t,a)?q(n)&&!OI(a,n.type)?(j(Are(a,r)),r):a:(j(_re(t,a,r)),r):r:null}function rce(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(Ol(e)||Rg(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&j(Cx(e,"ordinal")),"ordinal";if(e in Na){if(ae(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Sx)return"band";return t.band!==void 0||Qx(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point";case"temporal":return Ol(e)?"time":Rg(e)==="discrete"?(j(Cx(e,"temporal")),"ordinal"):q(t)&&t.timeUnit&&on(t.timeUnit).utc?"utc":"time";case"quantitative":return Ol(e)?q(t)&&Me(t.bin)?"bin-ordinal":"linear":Rg(e)==="discrete"?(j(Cx(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(iI(t.type))}function ace(e,{ignoreRange:t}={}){h3(e),Zj(e);for(const n of Fae)u3(e,n);t||f3(e)}function h3(e){Je(e)?e.component.scales=oce(e):e.component.scales=lce(e)}function oce(e){const{encoding:t,mark:n}=e;return Dg.reduce((i,r)=>{const a=ft(t[r]);if(a&&n===DN&&r===Sn&&a.type===Rl)return i;let o=a&&a.scale;if(a&&o!==null&&o!==!1){o=o??{};const s=ice(o,r,a,n);i[r]=new i3(e.scaleName(r+"",!0),{value:s,explicit:o.type===s})}return i},{})}const sce=zM((e,t)=>EI(e)-EI(t));function lce(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const a of e.children){h3(a);for(const o of z(a.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:Dle(o,e),r.scale[o]==="shared"){const s=i[o],l=a.component.scales[o].getWithExplicit("type");s?mae(s.value,l.value)?i[o]=Ua(s,l,"type","scale",sce):(r.scale[o]="independent",delete i[o]):i[o]=l}}for(const a of z(i)){const o=e.scaleName(a,!0),s=i[a];n[a]=new i3(o,s);for(const l of e.children){const u=l.component.scales[a];u&&(l.renameScale(u.get("name"),o),u.merged=!0)}}return n}class V2{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Je(e){return(e==null?void 0:e.type)==="unit"}function Di(e){return(e==null?void 0:e.type)==="facet"}function X2(e){return(e==null?void 0:e.type)==="concat"}function zl(e){return(e==null?void 0:e.type)==="layer"}class J2{constructor(e,t,n,i,r,a,o){var s,l;this.type=t,this.parent=n,this.config=r,this.view=o,this.children=[],this.correctDataNames=u=>(u.from&&u.from.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from&&u.from.facet&&u.from.facet.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=n,this.config=r,this.name=(s=e.name)!==null&&s!==void 0?s:i,this.title=za(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new V2(),this.projectionNameMap=n?n.projectionNameMap:new V2(),this.signalNameMap=n?n.signalNameMap:new V2(),this.data=e.data,this.description=e.description,this.transforms=Ase((l=e.transform)!==null&&l!==void 0?l:[]),this.layout=t==="layer"||t==="unit"?{}:Soe(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:zg(e)||n&&n.component.data.isFaceted&&e.data===void 0},layoutSize:new Ba(),layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?pe(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){ace(this)}parseProjection(){Hj(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){zj(this)}assembleGroupStyle(){var e,t;return this.type==="unit"||this.type==="layer"?(t=(e=this.view)===null||e===void 0?void 0:e.style)!==null&&t!==void 0?t:"cell":void 0}assembleEncodeFromView(e){const t=Z(e,["style"]),n={};for(const i of z(t)){const r=t[i];r!==void 0&&(n[i]=nt(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(t.description=nt(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},t??{}):Ne(t)?void 0:t}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=Z(e,["spacing"]),{component:i,config:r}=this,a=$le(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of ii)e[n].title&&t.push(_le(this,n));for(const n of F2)t=t.concat(Ale(this,n));return t}assembleAxes(){return cle(this.component.axes,this.config)}assembleLegends(){return qj(this)}assembleProjections(){return Zle(this)}assembleTitle(){var e,t,n;const i=(e=this.title)!==null&&e!==void 0?e:{},{encoding:r}=i,a=Z(i,["encoding"]),o=Object.assign(Object.assign(Object.assign({},ZI(this.config.title).nonMark),a),r?{encode:{update:r}}:{});return o.text?(ae(["unit","layer"],this.type)?ae(["middle",void 0],o.anchor)&&(o.frame=(t=o.frame)!==null&&t!==void 0?t:"group"):o.anchor=(n=o.anchor)!==null&&n!==void 0?n:"start",Ne(o)?void 0:o):void 0}assembleGroup(e=[]){const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Di(this.parent)?t3(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return qe((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=((t=i[n])!==null&&t!==void 0?t:0)+1,n}getSizeSignalRef(e){if(Di(this.parent)){const t=Dj(e),n=$g(t),i=this.component.scales[n];if(i&&!i.merged){const r=i.get("type"),a=i.get("range");if(On(r)&&Ma(a)){const o=i.get("name"),s=pm(this,n),l=Y2(s);if(l){const u=U({aggregate:"distinct",field:l},{expr:"datum"});return{signal:$j(o,i,u)}}else return j(`Unknown field for ${n}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):UN(e)&&Ia(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(Jie(t));return n}hasAxisOrientSignalRef(){var e,t;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some(n=>n.hasOrientSignalRef()))||((t=this.component.axes.y)===null||t===void 0?void 0:t.some(n=>n.hasOrientSignalRef()))}}class p3 extends J2{vgField(e,t={}){const n=this.fieldDef(e);return n?U(n,t):void 0}reduceFieldDef(e,t){return sM(this.getMapping(),(n,i,r)=>{const a=fr(i);return a?e(n,a,r):n},t)}forEachFieldDef(e,t){r2(this.getMapping(),(n,i)=>{const r=fr(n);r&&e(r,i)},t)}}class K2 extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"value",(r=a[1])!==null&&r!==void 0?r:"density"]}clone(){return new K2(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${we(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=Z(e,["density"]),i=Object.assign({type:"kde",field:t},n);return i}}class gm extends De{constructor(e,t){super(e);this.filter=t}clone(){return new gm(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t,a=Se("invalid",r,n);if(a!=="filter")return null;const o=t.reduceFieldDef((s,l,u)=>{const c=Ia(u)&&t.getScaleComponent(u);if(c){const f=c.get("type");ai(f)&&l.aggregate!=="count"&&!Xo(i)&&(s[l.field]=l)}return s},{});return z(o).length?new gm(e,o):null}dependentFields(){return new Set(z(this.filter))}producedFields(){return new Set()}hash(){return`FilterInvalid ${we(this.filter)}`}assemble(){const e=z(this.filter).reduce((t,n)=>{const i=this.filter[n],r=U(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?t.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):i.type==="quantitative"&&(t.push(`isValid(${r})`),t.push(`isFinite(+${r})`))),t},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class Q2 extends De{constructor(e,t){super(e);this.transform=t,this.transform=pe(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((r,a)=>{var o;return(o=i[a])!==null&&o!==void 0?o:r})}clone(){return new Q2(this.parent,pe(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${we(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform,n={type:"flatten",fields:e,as:t};return n}}class Z2 extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"key",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new Z2(null,pe(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${we(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform,n={type:"fold",fields:e,as:t};return n}}class xf extends De{constructor(e,t,n,i){super(e);this.fields=t,this.geojson=n,this.signal=i}clone(){return new xf(null,pe(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[nr,tr],[ni,Ti]]){const r=i.map(a=>{const o=ft(t.encoding[a]);return q(o)?o.field:Pa(o)?{expr:`${o.datum}`}:qr(o)?{expr:`${o.value}`}:void 0});(r[0]||r[1])&&(e=new xf(e,r,null,t.getName(`geojson_${n++}`)))}if(t.channelHasField(Sn)){const i=t.typedFieldDef(Sn);i.type===Rl&&(e=new xf(e,null,i.field,t.getName(`geojson_${n++}`)))}return e}dependentFields(){var e;const t=((e=this.fields)!==null&&e!==void 0?e:[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set()}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${we(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class mm extends De{constructor(e,t,n,i){super(e);this.projection=t,this.fields=n,this.as=i}clone(){return new mm(null,this.projection,pe(this.fields),pe(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[nr,tr],[ni,Ti]]){const i=n.map(a=>{const o=ft(t.encoding[a]);return q(o)?o.field:Pa(o)?{expr:`${o.datum}`}:qr(o)?{expr:`${o.value}`}:void 0}),r=n[0]===ni?"2":"";(i[0]||i[1])&&(e=new mm(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${we(this.fields)} ${we(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Bl extends De{constructor(e,t){super(e);this.transform=t}clone(){return new Bl(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e,r=[t,n,...i?[i]:[]].join(",");return{signal:`sequence(${r})`}}static makeFromTransform(e,t){return new Bl(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(q(i)&&q(r)){const a=i.impute?i:r.impute?r:void 0;if(a===void 0)return;const o=i.impute?r:r.impute?i:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=lM(t.mark,n);return new Bl(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),c!==void 0?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${we(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:ase(n)?this.processSequence(n):n}:{}),{method:"value"}),r?{groupby:r}:{}),{value:!i||i==="value"?a:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:o,ignorePeers:!1},r?{groupby:r}:{}),u={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[s,l,u]}else return[s]}}class eE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.loess]}clone(){return new eE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${we(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,i=Z(e,["loess","on"]),r=Object.assign({type:"loess",x:n,y:t},i);return r}}class vm extends De{constructor(e,t,n){super(e);this.transform=t,this.secondary=n}clone(){return new vm(null,pe(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:a}=n;let o=null;if(sse(a)){let s=y3(a.data,r);s||(s=new jl(a.data),r.push(s));const l=t.getName(`lookup_${i}`);o=new sn(s,l,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[l]=o}else if(lse(a)){const s=a.selection;if(n=Object.assign({as:s},n),o=t.getSelectionComponent(qe(s),s).materialized,!o)throw new Error(Zie(s))}return new vm(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?G(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${we({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:G(this.transform.as)}:{});else{let t=this.transform.as;Y(t)||(j(rre),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class tE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"prob",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new tE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${we(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=Z(e,["quantile"]),i=Object.assign({type:"quantile",field:t},n);return i}}class nE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.regression]}clone(){return new nE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${we(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,i=Z(e,["regression","on"]),r=Object.assign({type:"regression",x:n,y:t},i);return r}}class iE extends De{constructor(e,t){super(e);this.transform=t}clone(){return new iE(null,pe(this.transform))}addDimensions(e){var t;this.transform.groupby=Aa(((t=this.transform.groupby)!==null&&t!==void 0?t:[]).concat(e),n=>n)}producedFields(){return}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}hash(){return`PivotTransform ${we(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},i!==void 0?{limit:i}:{}),r!==void 0?{op:r}:{}),n!==void 0?{groupby:n}:{})}}class rE extends De{constructor(e,t){super(e);this.transform=t}clone(){return new rE(null,pe(this.transform))}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return`SampleTransform ${we(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function g3(e){let t=0;function n(i,r){var a;if(i instanceof jl&&(!i.isGenerator&&!ff(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof ln&&(i.parent instanceof jl&&!r.source?(r.format=Object.assign(Object.assign({},(a=r.format)!==null&&a!==void 0?a:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Ll){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}if((i instanceof cm||i instanceof fm||i instanceof gm||i instanceof vf||i instanceof bf||i instanceof mm||i instanceof xf||i instanceof pr||i instanceof vm||i instanceof wf||i instanceof Pl||i instanceof Z2||i instanceof Q2||i instanceof K2||i instanceof eE||i instanceof tE||i instanceof nE||i instanceof fs||i instanceof rE||i instanceof iE)&&r.transform.push(i.assemble()),(i instanceof Yr||i instanceof Gr||i instanceof Bl||i instanceof Ga)&&r.transform.push(...i.assemble()),i instanceof sn){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof sn)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof sn&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const s of i.children){const l={name:null,source:o,transform:[]};n(s,l)}break}}}return n}function uce(e){const t=[],n=g3(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function cce(e,t){var n,i;const r=[],a=g3(r);let o=0;for(const l of e.sources){l.hasName()||(l.dataName=`source_${o++}`);const u=l.assemble();a(l,u)}for(const l of r)l.transform.length===0&&delete l.transform;let s=0;for(const[l,u]of r.entries())((n=u.transform)!==null&&n!==void 0?n:[]).length===0&&!u.source&&r.splice(s++,0,r.splice(l,1)[0]);for(const l of r)for(const u of(i=l.transform)!==null&&i!==void 0?i:[])u.type==="lookup"&&(u.from=e.outputNodes[u.from].getSource());for(const l of r)l.name in t&&(l.values=t[l.name]);return r}function fce(e){return e==="top"||e==="left"||oe(e)?"header":"footer"}function dce(e){for(const t of ii)hce(e,t);v3(e,"x"),v3(e,"y")}function hce(e,t){var n;const{facet:i,config:r,child:a,component:o}=e;if(e.channelHasField(t)){const s=i[t],l=Ml("title",null,r,t);let u=is(s,r,{allowDisabling:!0,includeDefault:l===void 0||!!l});a.component.layoutHeaders[t].title&&(u=I(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=Ml("labelOrient",s,r,t),f=(n=s.header)!==null&&n!==void 0?n:{},d=rt(f.labels,r.header.labels,!0),h=ae(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[h]:t==="facet"?[]:[m3(e,t,d)]}}}function m3(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function v3(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:a}=e.component;if(a.axis[t]=j2(a,t),a.axis[t]==="shared"){const o=t==="x"?"column":"row",s=r[o];for(const l of i.component.axes[t]){const u=fce(l.get("orient"));s[u]=(n=s[u])!==null&&n!==void 0?n:[m3(e,o,!1)];const c=yf(l,"main",e.config,{header:!0});c&&s[u][0].axes.push(c),l.mainExtracted=!0}}}}function pce(e){aE(e),ym(e,"width"),ym(e,"height")}function gce(e){aE(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";ym(e,t),ym(e,n)}function aE(e){for(const t of e.children)t.parseLayoutSize()}function ym(e,t){const n=Dj(t),i=$g(n),r=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const l=s.component.layoutSize.getWithExplicit(n),u=r.scale[i];if(u==="independent"&&l.value==="step"){o=void 0;break}if(o){if(u==="independent"&&o.value!==l.value){o=void 0;break}o=Ua(o,l,n,"")}else o=l}if(o){for(const s of e.children)e.renameSignal(s.getName(n),e.getName(t)),s.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function mce(e){const{size:t,component:n}=e;for(const i of ri){const r=or(i);if(t[r]){const a=t[r];n.layoutSize.set(r,dr(a)?"step":a,!0)}else{const a=vce(e,r);n.layoutSize.set(r,a,!1)}}}function vce(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const a=r.get("type"),o=r.get("range");if(On(a)){const s=cf(i.view,t);return Ma(o)||dr(s)?"step":s}else return p2(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return p2(i.view,t);{const a=cf(i.view,t);return dr(a)?a.step:a}}}function oE(e,t,n){return U(t,Object.assign({suffix:`by_${U(e)}`},n??{}))}class bm extends p3{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve);this.child=lE(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return of(e)?sM(e,(n,i,r)=>ae([jr,Lr],r)?i.field===void 0?(j(Tx(i,r)),n):(n[r]=e2(i,r,t),n):(j(Ng(r,"facet")),n),{}):{facet:e2(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=wm(this),this.child.parseData()}parseLayoutSize(){aE(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),dce(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of ii)for(const a of N2){const o=this.component.layoutHeaders[r],s=o[a],{facetFieldDef:l}=o;if(l){const u=Ml("titleOrient",l,this.config,r);if(ae(["right","bottom"],u)){const c=sm(r,u);i.titleAnchor=(e=i.titleAnchor)!==null&&e!==void 0?e:{},i.titleAnchor[c]="end"}}if(s==null?void 0:s[0]){const u=r==="row"?"height":"width",c=a==="header"?"headerBand":"footerBand";r!=="facet"&&!this.child.component.layoutSize.get(u)&&(i[c]=(t=i[c])!==null&&t!==void 0?t:{},i[c][r]=.5),o.title&&(i.offset=(n=i.offset)!==null&&n!==void 0?n:{},i.offset[r==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(!t&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof bm)return;{const e=this.getName("column_domain");return{signal:`length(data('${e}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof bm?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:U(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof bm){if(this.child.channelHasField("column")){const i=U(this.child.facet.column);e.push(i),t.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of ri){const r=this.child.component.scales[i];if(r&&!r.merged){const a=r.get("type"),o=r.get("range");if(On(a)&&Ma(o)){const s=pm(this.child,i),l=Y2(s);l?(e.push(l),t.push("distinct"),n.push(`distinct_${l}`)):j(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of ii){const c=this.facet[u];if(c){s.push(U(c));const{bin:f,sort:d}=c;if(Me(f)&&s.push(U(c,{binSuffix:"end"})),ur(d)){const{field:h,op:p=Pg}=d,g=oE(c,d);n&&i?(r.push(g),a.push("max"),o.push(g)):(r.push(h),a.push(p),o.push(g))}else if(I(d)){const h=Il(c,u);r.push(h),a.push("max"),o.push(h)}}}const l=!!n&&!!i;return Object.assign({name:e,data:t,groupby:s},l||r.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),r.length?{fields:r,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?ur(n.sort)?[oE(n,n.sort,{expr:"datum"})]:I(n.sort)?[Il(n,e,{expr:"datum"})]:[U(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:i}=n,r=(ur(i)?i.order:!I(i)&&i)||"ascending";return[r]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return I2(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of F2)if(e[i]){const r=Ml("labelOrient",e[i],t,i);if(ae(n[i],r))return I2(e[i],i,t)}return}assembleMarks(){const{child:e}=this,t=this.component.data.facetRoot,n=uce(t),i=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),a=e.assembleGroupStyle(),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:ii.map(s=>this.facetSortFields(s)).flat(),order:ii.map(s=>this.facetSortOrder(s)).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup(Xse(this,[])));return[o]}getMapping(){return this.facet}}function yce(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const a of[n,i])if(ur(a.sort)){const{field:o,op:s=Pg}=a.sort;e=r=new Pl(e,{joinaggregate:[{op:s,field:o,as:oE(a,a.sort,{forAs:!0})}],groupby:[U(a)]})}return r}return null}function y3(e,t){var n,i,r,a,o,s,l,u,c,f;for(const d of t){const h=d.data;if(e.name&&d.hasName()&&e.name!==d.dataName)continue;if(((n=e.format)===null||n===void 0?void 0:n.mesh)&&((i=h.format)===null||i===void 0?void 0:i.feature))continue;if((((r=e.format)===null||r===void 0?void 0:r.feature)||((a=h.format)===null||a===void 0?void 0:a.feature))&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((s=h.format)===null||s===void 0?void 0:s.feature))continue;if((((l=e.format)===null||l===void 0?void 0:l.mesh)||((u=h.format)===null||u===void 0?void 0:u.mesh))&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=h.format)===null||f===void 0?void 0:f.mesh))continue;if(Zg(e)&&Zg(h)){if(Vc(e.values,h.values))return d}else if(ff(e)&&ff(h)){if(e.url===h.url)return d}else if(BM(e)&&e.name===d.dataName)return d}return null}function bce(e,t){if(e.data||!e.parent){if(e.data===null){const i=new jl({values:[]});return t.push(i),i}const n=y3(e.data,t);if(n)return ls(e.data)||(n.data.format=Qne({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new jl(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function wce(e,t,n){var i,r;let a=0;for(const o of t.transforms){let s,l;if(yse(o))l=e=new bf(e,o),s="derived";else if(WM(o)){const u=due(o);l=e=(i=ln.makeWithAncestors(e,{},u,n))!==null&&i!==void 0?i:e,e=new vf(e,t,o.filter)}else if(bse(o))l=e=Yr.makeFromTransform(e,o,t),s="number";else if(xse(o)){s="date";const u=n.getWithExplicit(o.field);u.value===void 0&&(e=new ln(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=Gr.makeFromTransform(e,o)}else if(Ese(o))l=e=pr.makeFromTransform(e,o),s="number",T2(t)&&(e=new fs(e));else if(ose(o))l=e=vm.make(e,t,o,a++),s="derived";else if(gse(o))l=e=new wf(e,o),s="number";else if(mse(o))l=e=new Pl(e,o),s="number";else if(kse(o))l=e=Ga.makeFromTransform(e,o),s="derived";else if(_se(o))l=e=new Z2(e,o),s="derived";else if(vse(o))l=e=new Q2(e,o),s="derived";else if(use(o))l=e=new iE(e,o),s="derived";else if(pse(o))e=new rE(e,o);else if(wse(o))l=e=Bl.makeFromTransform(e,o),s="derived";else if(cse(o))l=e=new K2(e,o),s="derived";else if(fse(o))l=e=new tE(e,o),s="derived";else if(dse(o))l=e=new nE(e,o),s="derived";else if(hse(o))l=e=new eE(e,o),s="derived";else{j(ire(o));continue}if(l&&s!==void 0)for(const u of(r=l.producedFields())!==null&&r!==void 0?r:[])n.set(u,s,!1)}return e}function wm(e){var t,n,i,r,a,o,s,l,u,c;let f=bce(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new rse(),g=e.data;ls(g)?(UM(g)?f=new fm(f,g.sequence):b2(g)&&(f=new cm(f,g.graticule)),p.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=ln.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new fs(f);const m=e.parent&&zl(e.parent);(Je(e)||Di(e))&&(m&&(f=(i=Yr.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=wce(f,e,p));const v=pue(e),y=hue(e);f=(r=ln.makeWithAncestors(f,{},Object.assign(Object.assign({},v),y),p))!==null&&r!==void 0?r:f,Je(e)&&(f=xf.parseAll(f,e),f=mm.parseAll(f,e)),(Je(e)||Di(e))&&(m||(f=(a=Yr.makeFromEncoding(f,e))!==null&&a!==void 0?a:f),f=(o=Gr.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=bf.parseAllForSortIndex(f,e));const b=e.getName(em),E=new sn(f,b,em,h);if(d[b]=E,f=E,Je(e)){const A=pr.makeFromEncoding(f,e);A&&(f=A,T2(e)&&(f=new fs(f))),f=(s=Bl.makeFromEncoding(f,e))!==null&&s!==void 0?s:f,f=(l=Ga.makeFromEncoding(f,e))!==null&&l!==void 0?l:f}Je(e)&&(f=(u=gm.make(f,e))!==null&&u!==void 0?u:f);const x=e.getName(qt),k=new sn(f,x,qt,h);d[x]=k,f=k,Je(e)&&lle(e,k);let w=null;if(Di(e)){const A=e.getName("facet");f=(c=yce(f,e.facet))!==null&&c!==void 0?c:f,w=new Ll(f,e,A,k.getSource()),d[A]=w}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:E,main:k,facetRoot:w,ancestorParse:p})}class xce extends J2{constructor(e,t,n,i){var r,a,o,s;super(e,"concat",t,n,i,e.resolve);(((a=(r=e.resolve)===null||r===void 0?void 0:r.axis)===null||a===void 0?void 0:a.x)==="shared"||((s=(o=e.resolve)===null||o===void 0?void 0:o.axis)===null||s===void 0?void 0:s.y)==="shared")&&j(tre),this.children=this.getChildren(e).map((l,u)=>lE(l,this,this.getName("concat_"+u),void 0,i))}parseData(){this.component.data=wm(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return Xg(e)?e.vconcat:h2(e)?e.hconcat:e.concat}parseLayoutSize(){gce(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=M2(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})}}function Ece(e){return e===!1||e===null}const kce=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},ON),{labelExpr:1,encode:1}),b3=z(kce);class w3 extends Ba{constructor(e={},t={},n=!1){super();this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new w3(pe(this.explicit),pe(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!Ece(this.get(e))}hasOrientSignalRef(){return oe(this.explicit.orient)}}function _ce(e,t,n){var i;const{encoding:r,config:a}=e,o=(i=ft(r[t]))!==null&&i!==void 0?i:ft(r[ar(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return ns(u)?Object.assign({text:Gx({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}function Ace(e){return ri.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Rce(n,e)]),t),{})}const Sce={bottom:"top",top:"bottom",left:"right",right:"left"};function Oce(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const o of z(a.component.axes))i.axis[o]=j2(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=Tce(n[o],a.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const a of ri){for(const o of e.children){if(!o.component.axes[a])continue;if(i.axis[a]==="independent"){n[a]=((t=n[a])!==null&&t!==void 0?t:[]).concat(o.component.axes[a]);for(const s of o.component.axes[a]){const{value:l,explicit:u}=s.getWithExplicit("orient");if(oe(l))continue;if(r[l]>0&&!u){const c=Sce[l];r[l]>r[c]&&s.set("orient",c,!1)}r[l]++}}delete o.component.axes[a]}if(i.axis[a]==="independent"&&n[a]&&n[a].length>1)for(const o of n[a])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function Tce(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],a=t[i];if(!!r!==!!a)return;if(r&&a){const o=r.getWithExplicit("orient"),s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;e[i]=Cce(r,a)}}}else return t.map(n=>n.clone());return e}function Cce(e,t){for(const n of b3){const i=Ua(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,a)=>{switch(n){case"title":return oM(r,a);case"gridScale":return{explicit:r.explicit,value:rt(r.value,a.value)}}return Qg(r,a,n,"axis")});e.setWithExplicit(n,i)}return e}function $ce(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(oe(n.labelAngle)?n.labelAngle:yg(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Aj(i,r))return!0}return e===n[t]}const Dce=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Rce(e,t){var n,i,r;let a=t.axis(e);const o=new w3(),s=ft(t.encoding[e]),{mark:l,config:u}=t,c=(a==null?void 0:a.orient)||((n=u[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=u.axis)===null||i===void 0?void 0:i.orient)||wle(e),f=t.getScaleComponent(e).get("type"),d=hle(e,f,c,t.config),h=a!==void 0?!a:D2("disable",u,a==null?void 0:a.style,d).configValue;if(o.set("disable",h,a!==void 0),h)return o;a=a||{};const p=vle(t,a,e,s,d),g={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const y of b3){const b=y in Ej?Ej[y](g):TN(y)?a[y]:void 0,E=b!==void 0,x=$ce(b,y,a,t,e);if(E&&x)o.set(y,b,x);else{const{configValue:k=void 0,configFrom:w=void 0}=TN(y)&&y!=="values"?D2(y,t.config,a.style,d):{},A=k!==void 0;E&&!A?o.set(y,b,x):(!(w==="vgAxisConfig")||Dce.has(y)&&A||yx(k)||oe(k))&&o.set(y,k,!1)}}const m=(r=a.encoding)!==null&&r!==void 0?r:{},v=SN.reduce((y,b)=>{var E;if(!o.hasAxisPart(b))return y;const x=Rj((E=m[b])!==null&&E!==void 0?E:{},t),k=b==="labels"?_ce(t,e,x):x;return k!==void 0&&!Ne(k)&&(y[b]={update:k}),y},{});return Ne(v)||o.set("encode",v,!!a.encoding||a.labelAngle!==void 0),o}function Fce({encoding:e,size:t}){for(const n of ri){const i=or(n);dr(t[i])&&(cr(e[n])&&(delete t[i],j(oI(i))))}return t}function Nce(e,t,n,{graticule:i}){const r=Qi(e)?Object.assign({},e):{type:e},a=Se("orient",r,n);if(r.orient=Lce(r.type,t,a),a!==void 0&&a!==r.orient&&j(vre(r.orient,a)),r.type==="bar"&&r.orient){const u=Se("cornerRadiusEnd",r,n);if(u!==void 0){const c=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:yie[r.orient];for(const f of c)r[f]=u;r.cornerRadiusEnd!==void 0&&delete r.cornerRadiusEnd}}const o=Se("opacity",r,n);o===void 0&&(r.opacity=Mce(r.type,t));const s=r.filled;s===void 0&&(r.filled=i?!1:jce(r,n));const l=Se("cursor",r,n);return l===void 0&&(r.cursor=Ice(r,t,n)),r}function Ice(e,t,n){return t.href||e.href||Se("href",e,n)?"pointer":e.cursor}function Mce(e,t){return ae([Eg,bx,wx,xx],e)&&!n2(t)?.7:void 0}function jce(e,t){const n=as("filled",e,t),i=e.type;return rt(n,i!==Eg&&i!==xg&&i!==kg)}function Lce(e,t,n){switch(e){case Eg:case wx:case xx:case $N:case cie:case uie:return}const{x:i,y:r,x2:a,y2:o}=t;switch(e){case wg:if(q(i)&&(an(i.bin)||q(r)&&r.aggregate&&!i.aggregate))return"vertical";if(q(r)&&(an(r.bin)||q(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(q(i)&&i.type===es&&!Me(i.bin)||Jx(i)))return"horizontal";if(!o&&(q(r)&&r.type===es&&!Me(r.bin)||Jx(r)))return"vertical"}case kg:if(a&&!(q(i)&&an(i.bin))&&o&&!(q(r)&&an(r.bin)))return;case bg:if(o)return q(r)&&an(r.bin)?"horizontal":"vertical";if(a)return q(i)&&an(i.bin)?"vertical":"horizontal";if(e===kg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case xg:case bx:{const s=cr(i),l=cr(r);if(s&&!l)return e!=="tick"?"horizontal":"vertical";if(!s&&l)return e!=="tick"?"vertical":"horizontal";if(s&&l){const u=i,c=r,f=u.type===Dl,d=c.type===Dl;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!u.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":u.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const Pce={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),qa(e,"radius","arc")),qa(e,"theta","arc"))},zce={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),nm("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),nm("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),E2(e))},Bce={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),qa(e,"x","bar")),qa(e,"y","bar"))},Uce={vgMark:"shape",encodeEntry:e=>Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&q(n)&&n.type===Rl?{field:U(n,{expr:"datum"})}:{});return[i]}},qce={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),qa(e,"x","image")),qa(e,"y","image")),w2(e,"url"))},Wce={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),xt("size",e,{vgChannel:"strokeWidth"})),E2(e))},Gce={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),xt("size",e)),E2(e))};function sE(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),xt("size",e)),xt("angle",e)),Hce(e,n,t))}function Hce(e,t,n){return n?{shape:{value:n}}:xt("shape",e)}const Yce={vgMark:"symbol",encodeEntry:e=>sE(e)},Vce={vgMark:"symbol",encodeEntry:e=>sE(e,"circle")},Xce={vgMark:"symbol",encodeEntry:e=>sE(e,"square")},Jce={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),qa(e,"x","rect")),qa(e,"y","rect"))},Kce={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),nm("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),nm("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),xt("size",e,{vgChannel:"strokeWidth"}))}},Qce={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),w2(e)),xt("size",e,{vgChannel:"fontSize"})),xt("angle",e)),ZM("align",Zce(e.markDef,n,t))),ZM("baseline",efe(e.markDef,n,t))),Wt("radius",e,{defaultPos:null,isMidPoint:!0})),Wt("theta",e,{defaultPos:null,isMidPoint:!0}))}};function Zce(e,t,n){const i=Se("align",e,n);return i===void 0?"center":void 0}function efe(e,t,n){const i=Se("baseline",e,n);return i===void 0?"middle":void 0}const tfe={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",a=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid",vgChannel:"xc"})),Wt("y",e,{defaultPos:"mid",vgChannel:"yc"})),xt("size",e,{defaultValue:nfe(e),vgChannel:r})),{[a]:nt(Se("thickness",n,t))})}};function nfe(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,a=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),s=(t=Se("size",i,n,{vgChannel:a}))!==null&&t!==void 0?t:n.tick.bandSize;if(s!==void 0)return s;{const l=o?o.get("range"):void 0;if(l&&Ma(l)&&Re(l.step))return l.step*3/4;const u=Jg(n.view,a);return u*3/4}}const xm={arc:Pce,area:zce,bar:Bce,circle:Vce,geoshape:Uce,image:qce,line:Wce,point:Yce,rect:Jce,rule:Kce,square:Xce,text:Qce,tick:tfe,trail:Gce};function ife(e){return ae([xg,bg,fie],e.mark)?rfe(e):ae([wg],e.mark)?afe(e):Em(e)}const x3="faceted_path_";function rfe(e){const t=lM(e.mark,e.encoding),n=Em(e,{fromPrefix:t.length>0?x3:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:x3+e.requestDataName(qt),data:e.requestDataName(qt),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const E3="stack_group_";function afe(e){const t=Nx.some(n=>Se(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=Em(e,{fromPrefix:E3}),i=e.scaleName(e.stack.fieldChannel),r=(f={})=>e.vgField(e.stack.fieldChannel,f),a=(f,d)=>{const h=[r({prefix:"min",suffix:"start",expr:d}),r({prefix:"max",suffix:"start",expr:d}),r({prefix:"min",suffix:"end",expr:d}),r({prefix:"max",suffix:"end",expr:d})];return`${f}(${h.map(p=>`scale('${i}',${p})`).join(",")})`};let o,s;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},Xc(n.encode.update,["y","yc","y2","height",...Nx])),{x:{signal:a("min","datum")},x2:{signal:a("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},Ir(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},Xc(n.encode.update,["x","xc","x2","width"])),{y:{signal:a("min","datum")},y2:{signal:a("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},Ir(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of Nx){const d=as(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):d&&(o[f]=nt(d)),d&&(n.encode.update[f]={value:0})}const l=e.fieldDef(e.stack.groupbyChannel),u=U(l)?[U(l)]:[];((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&u.push(U(l,{binSuffix:"end"}));const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=c.reduce((f,d)=>{if(n.encode.update[d])return Object.assign(Object.assign({},f),{[d]:n.encode.update[d]});{const h=as(d,e.markDef,e.config);return h!==void 0?Object.assign(Object.assign({},f),{[d]:nt(h)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(qt),name:E3+e.requestDataName(qt),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}else return Em(e)}function ofe(e){const{encoding:t,stack:n,mark:i,markDef:r,config:a}=e,o=t.order;if(!I(o)&&qr(o)&&vN(o.value)||!o&&vN(Se("order",r,a)))return;if((I(o)||q(o))&&!n)return iM(o,{expr:"datum"});if(Xo(i)){const s=r.orient==="horizontal"?"y":"x",l=t[s];if(q(l)){const u=l.sort;if(I(u))return{field:U(l,{prefix:s,suffix:"sort_index",expr:"datum"})};if(ur(u))return{field:U({aggregate:n2(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(PI(u)){const c=e.fieldDef(u.encoding);return{field:U(c,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:U(l,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function Em(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:r}=e,a=rt(i.clip,sfe(e),lfe(e)),o=tM(i),s=e.encoding.key,l=ofe(e),u=ufe(e),c=Se("aria",i,r),f=xm[n].postEncodingTransform?xm[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:xm[n].vgMark},a?{clip:!0}:{}),o?{style:o}:{}),s?{key:s.field}:{}),l?{sort:l}:{}),u||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(qt)},encode:{update:xm[n].encodeEntry(e)}}),f?{transform:f}:{})]}function sfe(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function lfe(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function ufe(e){if(!e.component.selection)return null;const t=z(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=z(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}class k3 extends p3{constructor(e,t,n,i={},r){var a,o;super(e,"unit",t,n,r,void 0,EM(e)?e.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=Qi(e.mark)?e.mark.type:e.mark;this.markDef=Nce(e.mark,(a=e.encoding)!==null&&a!==void 0?a:{},r,{graticule:e.data&&b2(e.data)});const l=this.encoding=noe((o=e.encoding)!==null&&o!==void 0?o:{},this.markDef,r);this.size=Fce({encoding:l,size:EM(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=CM(s,l),this.specifiedScales=this.initScales(s,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===DN,n=e&&Fie.some(i=>se(e[i]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return Dg.reduce((n,i)=>{var r;const a=ft(t[i]);return a&&(n[i]=(r=a.scale)!==null&&r!==void 0?r:{}),n},{})}initAxes(e){return ri.reduce((t,n)=>{const i=e[n];if(se(i)||n===He&&se(e.x2)||n===ct&&se(e.y2)){const r=se(i)?i.axis:void 0;t[n]=r&&Object.assign({},r)}return t},{})}initLegend(e){return Bie.reduce((t,n)=>{const i=ft(e[n]);if(i&&qie(n)){const r=i.legend;t[n]=r&&Object.assign({},r)}return t},{})}parseData(){this.component.data=wm(this)}parseLayoutSize(){mce(this)}parseSelections(){this.component.selection=sle(this,this.selection)}parseMarkGroup(){this.component.mark=ife(this)}parseAxesAndHeaders(){this.component.axes=Ace(this)}assembleSelectionTopLevelSignals(e){return Jse(this,e)}assembleSignals(){return[...yj(this),...Vse(this,[])]}assembleSelectionData(e){return Kse(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return M2(this)}assembleMarks(){var e;let t=(e=this.component.mark)!==null&&e!==void 0?e:[];return(!this.parent||!zl(this.parent))&&(t=cj(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return os(this.encoding,e)}fieldDef(e){const t=this.encoding[e];return fr(t)}typedFieldDef(e){const t=this.fieldDef(e);return Bn(t)?t:null}}class _3 extends J2{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((o,s)=>{if(Kg(o))return new _3(o,this,this.getName("layer_"+s),a,r);if(Mr(o))return new k3(o,this,this.getName("layer_"+s),a,r);throw new Error(Ox(o))})}parseData(){this.component.data=wm(this);for(const e of this.children)e.parseData()}parseLayoutSize(){pce(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){Oce(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),yj(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),M2(this))}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e;return}assembleLayout(){return null}assembleMarks(){return Qse(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),qj(this))}}function lE(e,t,n,i,r){if(zg(e))return new bm(e,t,n,r);if(Kg(e))return new _3(e,t,n,i,r);if(Mr(e))return new k3(e,t,n,i,r);if(koe(e))return new xce(e,t,n,r);throw new Error(Ox(e))}function cfe(e,t={}){t.logger&&Ure(t.logger),t.fieldTitle&&XI(t.fieldTitle);try{const n=SM(Kl(t.config,e.config)),i=jM(e,n),r=lE(i,null,"",void 0,n);r.parse(),$ue(r.component.data,r);const a=dfe(r,ffe(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:a,normalized:i}}finally{t.logger&&qre(),t.fieldTitle&&Xae()}}function ffe(e,t,n,i){const r=i.component.layoutSize.get("width"),a=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&a&&tse(t.type)){if(r==="step"&&a==="step")j(KN()),t.type="pad";else if(r==="step"||a==="step"){const o=r==="step"?"width":"height";j(KN($g(o)));const s=o==="width"?"height":"width";t.type=nse(s)}}return Object.assign(Object.assign(Object.assign({},z(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),PM(n)),PM(e))}function dfe(e,t,n={},i){const r=e.config?Ioe(e.config):void 0,a=[].concat(e.assembleSelectionData([]),cce(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}class hfe extends OM{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:a,aggregate:o,groupby:s,encoding:l}=i2(n,t),u=[...i||[],...r,...a,...o.length===0?[]:[{aggregate:o,groupby:s}]];return Object.assign(Object.assign(Object.assign({},e),u.length>0?{transform:u}:{}),{encoding:l})}else return e}}const pfe=new hfe();function gfe(e,t){return pfe.map(e,{config:t})}const mfe=Xne.version;var vfe=Object.freeze({__proto__:null,normalize:jM,version:mfe,compile:cfe,extractTransforms:gfe}),yfe=Tm(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function n(i){var r=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g,a=r.exec(i).slice(1,3),o=a[0],s=a[1];return{library:o,version:s}}t.default=n}),A3=P3(yfe);const bfe="vega-themes",wfe="2.8.3",xfe="Themes for stylized Vega and Vega-Lite visualizations.",Efe=["vega","vega-lite","themes","style"],kfe="BSD-3-Clause",_fe={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},Afe=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],Sfe="build/vega-themes.js",Ofe="build/src/index.js",Tfe="build/vega-themes.min.js",Cfe="build/vega-themes.min.js",$fe="build/src/index.d.ts",Dfe={type:"git",url:"https://github.com/vega/vega-themes.git"},Rfe={prepare:"beemo create-config --silent",clean:"rm -rf build examples/build",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint 'src/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",prebuild:"mkdir -p build",build:"tsc && rollup -c",postbuild:"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'yarn serve' 'tsc -w' 'rollup -c -w'"},Ffe={"@rollup/plugin-json":"^4.0.2","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",rollup:"^2.1.0",terser:"^4.6.7",typescript:"^3.8.3",vega:"^5.10.0","vega-lite":"^4.8.1","vega-lite-dev-config":"^0.5.0"},Nfe={vega:"*","vega-lite":"*"},Ife={module:"vega-lite-dev-config",drivers:["prettier","eslint"]};var Mfe={name:bfe,version:wfe,description:xfe,keywords:Efe,license:kfe,author:_fe,contributors:Afe,main:Sfe,module:Ofe,unpkg:Tfe,jsdelivr:Cfe,typings:$fe,repository:Dfe,scripts:Rfe,devDependencies:Ffe,peerDependencies:Nfe,beemo:Ife};const Ef="#fff",jfe="#888",Lfe={background:"#333",title:{color:Ef},style:{"guide-label":{fill:Ef},"guide-title":{fill:Ef}},axis:{domainColor:Ef,gridColor:jfe,tickColor:Ef}},ds="#4572a7",Pfe={background:"#fff",arc:{fill:ds},area:{fill:ds},line:{stroke:ds,strokeWidth:2},path:{stroke:ds},rect:{fill:ds},shape:{stroke:ds},symbol:{fill:ds,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},hs="#30a2da",uE="#cbcbcb",zfe="#999",Bfe="#333",S3="#f0f0f0",O3="#333",Ufe={arc:{fill:hs},area:{fill:hs},axis:{domainColor:uE,grid:!0,gridColor:uE,gridWidth:1,labelColor:zfe,labelFontSize:10,titleColor:Bfe,tickColor:uE,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:S3,group:{fill:S3},legend:{labelColor:O3,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:O3,titleFontSize:14,titlePadding:10},line:{stroke:hs,strokeWidth:2},path:{stroke:hs,strokeWidth:.5},rect:{fill:hs},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:hs},bar:{binSpacing:2,fill:hs,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},ps="#000",qfe={group:{fill:"#e5e5e5"},arc:{fill:ps},area:{fill:ps},line:{stroke:ps},path:{stroke:ps},rect:{fill:ps},shape:{stroke:ps},symbol:{fill:ps,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Wfe=22,Gfe="normal",T3="Benton Gothic, sans-serif",C3=11.5,Hfe="normal",gs="#82c6df",cE="Benton Gothic Bold, sans-serif",$3="normal",D3=13,kf={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Yfe={background:"#ffffff",title:{anchor:"start",color:"#000000",font:cE,fontSize:Wfe,fontWeight:Gfe},arc:{fill:gs},area:{fill:gs},line:{stroke:gs,strokeWidth:2},path:{stroke:gs},rect:{fill:gs},shape:{stroke:gs},symbol:{fill:gs,size:30},axis:{labelFont:T3,labelFontSize:C3,labelFontWeight:Hfe,titleFont:cE,titleFontSize:D3,titleFontWeight:$3},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:T3,labelFontSize:C3,symbolType:"square",titleFont:cE,titleFontSize:D3,titleFontWeight:$3},range:{category:kf["category-6"],diverging:kf["fireandice-6"],heatmap:kf["fire-7"],ordinal:kf["fire-7"],ramp:kf["fire-7"]}},ms="#ab5787",km="#979797",Vfe={background:"#f9f9f9",arc:{fill:ms},area:{fill:ms},line:{stroke:ms},path:{stroke:ms},rect:{fill:ms},shape:{stroke:ms},symbol:{fill:ms,size:30},axis:{domainColor:km,domainWidth:.5,gridWidth:.2,labelColor:km,tickColor:km,tickWidth:.2,titleColor:km},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},vs="#3e5c69",Xfe={background:"#fff",arc:{fill:vs},area:{fill:vs},line:{stroke:vs},path:{stroke:vs},rect:{fill:vs},shape:{stroke:vs},symbol:{fill:vs},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},li="#1696d2",R3="#000000",Jfe="#FFFFFF",_m="Lato",fE="Lato",Kfe="Lato",Qfe="#DEDDDD",Zfe=18,_f={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},ede={background:Jfe,title:{anchor:"start",fontSize:Zfe,font:_m},axisX:{domain:!0,domainColor:R3,domainWidth:1,grid:!1,labelFontSize:12,labelFont:fE,labelAngle:0,tickColor:R3,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:_m},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Qfe,gridWidth:1,labelFontSize:12,labelFont:fE,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:_m,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:fE,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:_m,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:_f["six-groups-cat-1"],diverging:_f["diverging-colors"],heatmap:_f["diverging-colors"],ordinal:_f["six-groups-seq"],ramp:_f["shades-blue"]},area:{fill:li},rect:{fill:li},line:{color:li,stroke:li,strokeWidth:5},trail:{color:li,stroke:li,strokeWidth:0,size:1},path:{stroke:li,strokeWidth:.5},point:{filled:!0},text:{font:Kfe,color:li,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:li,stroke:null}},arc:{fill:li},shape:{stroke:li},symbol:{fill:li,size:30}},ys="#3366CC",F3="#ccc",Am="Arial, sans-serif",tde={arc:{fill:ys},area:{fill:ys},path:{stroke:ys},rect:{fill:ys},shape:{stroke:ys},symbol:{stroke:ys},circle:{fill:ys},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Am,fontSize:12},"guide-title":{font:Am,fontSize:12},"group-title":{font:Am,fontSize:12}},title:{font:Am,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:F3,tickColor:F3,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},nde=Mfe.version;var ide=Object.freeze({__proto__:null,version:nde,dark:Lfe,excel:Pfe,fivethirtyeight:Ufe,ggplot2:qfe,latimes:Yfe,quartz:Vfe,vox:Xfe,urbaninstitute:ede,googlecharts:tde}),rde=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const N3="vg-tooltip-element",ade={offsetX:10,offsetY:10,id:N3,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:ode,maxDepth:2};function ode(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function sde(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return rde.toString().replace(N3,e)}var lde=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ude(e,t,n){if(I(e))return`[${e.map(i=>t(Y(i)?i:I3(i,n))).join(", ")}]`;if(K(e)){let i="";const r=e,{title:a,image:o}=r,s=lde(r,["title","image"]);a&&(i+=`<h2>${t(a)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){i+="<table>";for(const u of l){let c=s[u];if(c===void 0)continue;K(c)&&(c=I3(c,n)),i+=`<tr><td class="key">${t(u)}:</td><td class="value">${t(c)}</td></tr>`}i+="</table>"}return i||"{}"}return t(e)}function cde(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function I3(e,t){return JSON.stringify(e,cde(t))}function fde(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let a=e.clientY+i;return a+t.height>window.innerHeight&&(a=+e.clientY-i-t.height),{x:r,y:a}}class dde{constructor(e){this.options=Object.assign(Object.assign({},ade),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=sde(t);const i=document.head;i.childNodes.length>0?i.insertBefore(n,i.childNodes[0]):i.appendChild(n)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,i){if(i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=ude(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:a}=fde(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${r}px`)}}function hde(e,t,n){const i=e.open(t),r=1e4,a=250,{origin:o}=new URL(t);let s=~~(r/a);function l(c){c.source===i&&(s=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function u(){if(s<=0)return;i.postMessage(n,o),setTimeout(u,a),s-=1}setTimeout(u,a)}var pde=`.vega-embed {
  position: relative;
  display: inline-block; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: scroll;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function M3(e,...t){for(const n of t)gde(e,n);return e}function gde(e,t){for(const n of Object.keys(t))qf(e,n,t[n],!0)}var dE;const bs=One;let Af=vfe;const Sm=typeof window!="undefined"?window:void 0;Af===void 0&&((dE=Sm==null?void 0:Sm.vl)===null||dE===void 0?void 0:dE.compile)&&(Af=Sm.vl);const mde={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},vde={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Sf={vega:"Vega","vega-lite":"Vega-Lite"},Om={vega:bs.version,"vega-lite":Af?Af.version:"not available"},yde={vega:e=>e,"vega-lite":(e,t)=>Af.compile(e,{config:t}).spec},bde=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`;function wde(e){return typeof e=="function"}function j3(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+e+a),o.document.title=`${Sf[i]} JSON Source`}function xde(e,t){var n;if(e.$schema){const i=A3(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${Sf[i.library]}, but mode argument sets ${(n=Sf[t])!==null&&n!==void 0?n:t}.`);const r=i.library;return RE.satisfies(Om[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${Sf[r]} ${i.version}, but the current version of ${Sf[r]} is v${Om[r]}.`),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function Ede(e){return!!(e&&"load"in e)}function kde(e,t,n={}){var i,r,a;return Of(this,void 0,void 0,function*(){const o=Ede(n.loader)?n.loader:bs.loader(n.loader),s=Y(t)?JSON.parse(yield o.load(t)):t,l=yield L3((i=s.usermeta&&s.usermeta.embedOptions)!==null&&i!==void 0?i:{},o),u=yield L3(n,o),c=Object.assign(Object.assign({},M3(u,l)),{config:Kl((r=u.config)!==null&&r!==void 0?r:{},(a=l.config)!==null&&a!==void 0?a:{})});return yield _de(e,s,c,o)})}function L3(e,t){var n;return Of(this,void 0,void 0,function*(){const i=Y(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},r=Y(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),r?{patch:r}:{}),i?{config:i}:{})})}function _de(e,t,n={},i){var r,a,o,s,l,u;return Of(this,void 0,void 0,function*(){const c=n.theme?Kl(ide[n.theme],(r=n.config)!==null&&r!==void 0?r:{}):n.config,f=io(n.actions)?n.actions:M3({},mde,(a=n.actions)!==null&&a!==void 0?a:{}),d=Object.assign(Object.assign({},vde),n.i18n),h=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(s=n.logLevel)!==null&&s!==void 0?s:bs.Warn,g=(l=n.downloadFileName)!==null&&l!==void 0?l:"visualization";if(n.defaultStyle!==!1){const _="vega-embed-style";if(!document.getElementById(_)){const O=document.createElement("style");O.id=_,O.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?pde.toString():n.defaultStyle,document.head.appendChild(O)}}const m=xde(t,n.mode);let v=yde[m](t,c);if(m==="vega-lite"&&v.$schema){const _=A3(v.$schema);RE.satisfies(Om.vega,`^${_.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${_.version}, but current version is v${Om.vega}.`)}const y=typeof e=="string"?document.querySelector(e):e;if(!y)throw Error(`${e} does not exist`);y.classList.add("vega-embed"),f&&y.classList.add("has-actions"),y.innerHTML="";const b=n.patch;b&&(b instanceof Function?v=b(v):v=Cf(v,b,!0,!1).newDocument),n.formatLocale&&bs.formatLocale(n.formatLocale),n.timeFormatLocale&&bs.timeFormatLocale(n.timeFormatLocale);const E=bs.parse(v,m==="vega-lite"?{}:c),x=new bs.View(E,{loader:i,logLevel:p,renderer:h});if(n.tooltip!==!1){let _;wde(n.tooltip)?_=n.tooltip:_=new dde(n.tooltip===!0?{}:n.tooltip).call,x.tooltip(_)}let{hover:k}=n;if(k===void 0&&(k=m==="vega"),k){const{hoverSet:_,updateSet:O}=typeof k=="boolean"?{}:k;x.hover(_,O)}n&&(n.width!=null&&x.width(n.width),n.height!=null&&x.height(n.height),n.padding!=null&&x.padding(n.padding)),yield x.initialize(e).runAsync();let w;if(f!==!1){let _=y;if(n.defaultStyle!==!1){const S=document.createElement("details");S.title=d.CLICK_TO_VIEW_ACTIONS,y.append(S),_=S;const T=document.createElement("summary");T.innerHTML=bde,S.append(T),w=D=>{S.contains(D.target)||S.removeAttribute("open")},document.addEventListener("click",w)}const O=document.createElement("div");if(_.append(O),O.classList.add("vega-actions"),f===!0||f.export!==!1){for(const S of["svg","png"])if(f===!0||f.export===!0||f.export[S]){const T=d[`${S.toUpperCase()}_ACTION`],D=document.createElement("a");D.text=T,D.href="#",D.target="_blank",D.download=`${g}.${S}`,D.addEventListener("mousedown",function(M){return Of(this,void 0,void 0,function*(){M.preventDefault();const C=yield x.toImageURL(S,n.scaleFactor);this.href=C})}),O.append(D)}}if(f===!0||f.source!==!1){const S=document.createElement("a");S.text=d.SOURCE_ACTION,S.href="#",S.addEventListener("click",function(T){var D,M;j3(Mm(t),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(M=n.sourceFooter)!==null&&M!==void 0?M:"",m),T.preventDefault()}),O.append(S)}if(m==="vega-lite"&&(f===!0||f.compiled!==!1)){const S=document.createElement("a");S.text=d.COMPILED_ACTION,S.href="#",S.addEventListener("click",function(T){var D,M;j3(Mm(v),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(M=n.sourceFooter)!==null&&M!==void 0?M:"","vega"),T.preventDefault()}),O.append(S)}if(f===!0||f.editor!==!1){const S=(u=n.editorUrl)!==null&&u!==void 0?u:"https://vega.github.io/editor/",T=document.createElement("a");T.text=d.EDITOR_ACTION,T.href="#",T.addEventListener("click",function(D){hde(window,S,{config:c,mode:m,renderer:h,spec:Mm(t)}),D.preventDefault()}),O.append(T)}}function A(){w&&document.removeEventListener("click",w),x.finalize()}return{view:x,spec:t,vgSpec:v,finalize:A}})}export default kde;
