import{c as Mm,g as Q3}from"./common/_commonjsHelpers-be8ed69f.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Z(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Ff(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function s(c){try{u(i.next(c))}catch(f){o(f)}}function l(c){try{u(i.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):r(c.value).then(s,l)}u((i=i.apply(e,t||[])).next())})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Z3=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i())}}(),eL=Object.prototype.hasOwnProperty;function jm(e,t){return eL.call(e,t)}function Lm(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var i in e)jm(e,i)&&t.push(i);return t}function $n(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Pm(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Za(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function EE(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function zm(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(zm(e[t]))return!0}else if(typeof e=="object"){for(var i=Lm(e),r=i.length,t=0;t<r;t++)if(zm(e[i[t]]))return!0}}return!1}function kE(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var _E=function(e){Z3(t,e);function t(n,i,r,a,o){var s=this.constructor,l=e.call(this,kE(n,{name:i,index:r,operation:a,tree:o}))||this;return l.name=i,l.index=r,l.operation=a,l.tree=o,Object.setPrototypeOf(l,s.prototype),l.message=kE(n,{name:i,index:r,operation:a,tree:o}),l}return t}(Error),Qe=_E,tL=$n,As={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=If(n,this.path);i&&(i=$n(i));var r=eo(n,{op:"remove",path:this.from}).removed;return eo(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=If(n,this.from);return eo(n,{op:"add",path:this.path,value:$n(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Xl(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},nL={add:function(e,t,n){return Pm(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:As.move,copy:As.copy,test:As.test,_get:As._get};function If(e,t){if(t=="")return e;var n={op:"_get",path:t};return eo(e,n),n.value}function eo(e,t,n,i,r,a){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),a===void 0&&(a=0),n&&(typeof n=="function"?n(t,0,e,t.path):jf(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=If(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Xl(e,t.value),o.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}}else{i||(e=$n(e));var s=t.path||"",l=s.split("/"),u=e,c=1,f=l.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=jf;;){if(h=l[c],r&&h=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&(d===void 0&&(u[h]===void 0?d=l.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d))),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(n&&!Pm(h))throw new Qe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Pm(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>u.length)throw new Qe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var o=nL[t.op].call(t,u,h,e);if(o.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&h.indexOf("~")!=-1&&(h=EE(h)),c>=f){var o=As[t.op].call(t,u,h,e);if(o.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}u=u[h]}}}function Mf(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new Qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=$n(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=eo(e,t[o],n,!0,r,o),e=a[o].newDocument;return a.newDocument=e,a}function iL(e,t,n){var i=eo(e,t);if(i.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function jf(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new Qe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(As[e.op]){if(typeof e.path!="string")throw new Qe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Qe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Qe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&zm(e.value))throw new Qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,a=i.split("/").length;if(r!==a+1&&r!==a)throw new Qe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new Qe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},s=AE([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new Qe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function AE(e,t,n){try{if(!Array.isArray(e))throw new Qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Mf($n(t),$n(e),n||!0);else{n=n||jf;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof Qe)return r;throw r}}function Xl(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,a,o;if(n&&i){if(a=e.length,a!=t.length)return!1;for(r=a;r--!==0;)if(!Xl(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var s=Object.keys(e);if(a=s.length,a!==Object.keys(t).length)return!1;for(r=a;r--!==0;)if(!t.hasOwnProperty(s[r]))return!1;for(r=a;r--!==0;)if(o=s[r],!Xl(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var rL=Object.freeze({__proto__:null,JsonPatchError:Qe,deepClone:tL,getValueByPointer:If,applyOperation:eo,applyPatch:Mf,applyReducer:iL,validator:jf,validate:AE,_areEquals:Xl});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Bm=new WeakMap(),aL=function(){function e(t){this.observers=new Map(),this.obj=t}return e}(),oL=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function sL(e){return Bm.get(e)}function lL(e,t){return e.observers.get(t)}function uL(e,t){e.observers.delete(t.callback)}function cL(e,t){t.unobserve()}function fL(e,t){var n=[],i,r=sL(e);if(!r)r=new aL(e),Bm.set(e,r);else{var a=lL(r,t);i=a&&a.observer}if(i)return i;if(i={},r.value=$n(e),t){i.callback=t,i.next=null;var o=function(){Um(i)},s=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return i.patches=n,i.object=e,i.unobserve=function(){Um(i),clearTimeout(i.next),uL(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new oL(t,i)),i}function Um(e,t){t===void 0&&(t=!1);var n=Bm.get(e.object);qm(n.value,e.object,e.patches,"",t),e.patches.length&&Mf(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function qm(e,t,n,i,r){if(t===e)return;typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=Lm(t),o=Lm(e),s=!1,l=o.length-1;l>=0;l--){var u=o[l],c=e[u];if(jm(t,u)&&!(t[u]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[u];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null?qm(c,f,n,i+"/"+Za(u),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Za(u),value:$n(c)}),n.push({op:"replace",path:i+"/"+Za(u),value:$n(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Za(u),value:$n(c)}),n.push({op:"remove",path:i+"/"+Za(u)}),s=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!s&&a.length==o.length)return;for(var l=0;l<a.length;l++){var u=a[l];!jm(e,u)&&t[u]!==void 0&&n.push({op:"add",path:i+"/"+Za(u),value:$n(t[u])})}}function dL(e,t,n){n===void 0&&(n=!1);var i=[];return qm(e,t,i,"",n),i}var hL=Object.freeze({__proto__:null,unobserve:cL,observe:fL,generate:Um,compare:dL});Object.assign({},rL,hL,{JsonPatchError:_E,deepClone:$n,escapePathComponent:Za,unescapePathComponent:EE});var pL=/("(?:[^\\"]|\\.)*")|[:,]/g,Wm=function(t,n){var i,r,a;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?Infinity:n.maxLength===void 0?80:n.maxLength,a=n.replacer,function o(s,l,u){var c,f,d,h,p,g,m,v,y,b,E,x;if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),E=JSON.stringify(s,a),E===void 0)return E;if(m=r-l.length-u,E.length<=m&&(y=E.replace(pL,function(k,w){return w||k+" "}),y.length<=m))return y;if(a!=null&&(s=JSON.parse(E),a=void 0),typeof s=="object"&&s!==null){if(v=l+i,d=[],f=0,Array.isArray(s))for(b="[",c="]",m=s.length;f<m;f++)d.push(o(s[f],v,f===m-1?0:1)||"null");else for(b="{",c="}",g=Object.keys(s),m=g.length;f<m;f++)h=g[f],p=JSON.stringify(h)+": ",x=o(s[h],v,p.length+(f===m-1?0:1)),x!==void 0&&d.push(p+x);if(d.length>0)return[b,i+d.join(`,
`+v),c].join(`
`+l)}return E}(t,"",0)};const gL="2.0.0",mL=256,vL=Number.MAX_SAFE_INTEGER||9007199254740991,yL=16;var Lf={SEMVER_SPEC_VERSION:gL,MAX_LENGTH:mL,MAX_SAFE_INTEGER:vL,MAX_SAFE_COMPONENT_LENGTH:yL};function SE(){throw new Error("setTimeout has not been defined")}function OE(){throw new Error("clearTimeout has not been defined")}var Kr=SE,Qr=OE;typeof window.setTimeout=="function"&&(Kr=setTimeout),typeof window.clearTimeout=="function"&&(Qr=clearTimeout);function TE(e){if(Kr===setTimeout)return setTimeout(e,0);if((Kr===SE||!Kr)&&setTimeout)return Kr=setTimeout,setTimeout(e,0);try{return Kr(e,0)}catch(t){try{return Kr.call(null,e,0)}catch(n){return Kr.call(this,e,0)}}}function bL(e){if(Qr===clearTimeout)return clearTimeout(e);if((Qr===OE||!Qr)&&clearTimeout)return Qr=clearTimeout,clearTimeout(e);try{return Qr(e)}catch(t){try{return Qr.call(null,e)}catch(n){return Qr.call(this,e)}}}var gr=[],Ss=!1,to,Pf=-1;function wL(){if(!Ss||!to)return;Ss=!1,to.length?gr=to.concat(gr):Pf=-1,gr.length&&CE()}function CE(){if(Ss)return;var e=TE(wL);Ss=!0;for(var t=gr.length;t;){for(to=gr,gr=[];++Pf<t;)to&&to[Pf].run();Pf=-1,t=gr.length}to=null,Ss=!1,bL(e)}function xL(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];gr.push(new $E(e,t)),gr.length===1&&!Ss&&TE(CE)}function $E(e,t){this.fun=e,this.array=t}$E.prototype.run=function(){this.fun.apply(null,this.array)};var EL="browser",kL="browser",_L=!0,AL=[],SL="",OL={},TL={},CL={};function no(){}var $L=no,DL=no,RL=no,NL=no,FL=no,IL=no,ML=no;function jL(e){throw new Error("process.binding is not supported")}function LL(){return"/"}function PL(e){throw new Error("process.chdir is not supported")}function zL(){return 0}var Os=window.performance||{},BL=Os.now||Os.mozNow||Os.msNow||Os.oNow||Os.webkitNow||function(){return new Date().getTime()};function UL(e){var t=BL.call(Os)*.001,n=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(n=n-e[0],i=i-e[1],i<0&&(n--,i+=1e9)),[n,i]}var qL=new Date();function WL(){var e=new Date(),t=e-qL;return t/1e3}var zf={nextTick:xL,title:EL,browser:_L,env:{NODE_ENV:"production"},argv:AL,version:SL,versions:OL,on:$L,addListener:DL,once:RL,off:NL,removeListener:FL,removeAllListeners:IL,emit:ML,binding:jL,cwd:LL,chdir:PL,umask:zL,hrtime:UL,platform:kL,release:TL,config:CL,uptime:WL};const GL=typeof zf=="object"&&zf.env&&zf.env.NODE_DEBUG&&/\bsemver\b/i.test(zf.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Oe=GL,Zr=Mm(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Lf;t=e.exports={};const i=t.re=[],r=t.src=[],a=t.t={};let o=0;const s=(l,u,c)=>{const f=o++;Oe(f,u),a[l]=f,r[f]=u,i[f]=new RegExp(u,c?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${r[a.NUMERICIDENTIFIER]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${r[a.NUMERICIDENTIFIERLOOSE]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${r[a.PRERELEASEIDENTIFIER]}(?:\\.${r[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${r[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${r[a.BUILDIDENTIFIER]}(?:\\.${r[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${r[a.MAINVERSION]}${r[a.PRERELEASE]}?${r[a.BUILD]}?`),s("FULL",`^${r[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${r[a.MAINVERSIONLOOSE]}${r[a.PRERELEASELOOSE]}?${r[a.BUILD]}?`),s("LOOSE",`^${r[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${r[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${r[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:${r[a.PRERELEASE]})?${r[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:${r[a.PRERELEASELOOSE]})?${r[a.BUILD]}?)?)?`),s("XRANGE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",r[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${r[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${r[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${r[a.LONECARET]}${r[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${r[a.LONECARET]}${r[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${r[a.GTLT]}\\s*(${r[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]}|${r[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${r[a.XRANGEPLAIN]})\\s+-\\s+(${r[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${r[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${r[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});const DE=/^[0-9]+$/,RE=(e,t)=>{const n=DE.test(e),i=DE.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},HL=(e,t)=>RE(t,e);var Gm={compareIdentifiers:RE,rcompareIdentifiers:HL};const{MAX_LENGTH:NE,MAX_SAFE_INTEGER:Bf}=Lf,{re:FE,t:IE}=Zr,{compareIdentifiers:Jl}=Gm;class Ri{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ri){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>NE)throw new TypeError(`version is longer than ${NE} characters`);Oe("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?FE[IE.LOOSE]:FE[IE.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Bf||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Bf||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Bf||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const r=+i;if(r>=0&&r<Bf)return r}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Oe("SemVer.compare",this.version,this.options,e),!(e instanceof Ri)){if(typeof e=="string"&&e===this.version)return 0;e=new Ri(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ri||(e=new Ri(e,this.options)),Jl(this.major,e.major)||Jl(this.minor,e.minor)||Jl(this.patch,e.patch)}comparePre(e){if(e instanceof Ri||(e=new Ri(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(Oe("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Jl(n,i)}while(++t)}compareBuild(e){e instanceof Ri||(e=new Ri(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(Oe("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Jl(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Ze=Ri;const{MAX_LENGTH:YL}=Lf,{re:ME,t:jE}=Zr,VL=(e,t)=>{if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ze)return e;if(typeof e!="string")return null;if(e.length>YL)return null;const n=t.loose?ME[jE.LOOSE]:ME[jE.FULL];if(!n.test(e))return null;try{return new Ze(e,t)}catch(i){return null}};var io=VL;const XL=(e,t)=>{const n=io(e,t);return n?n.version:null};var JL=XL;const KL=(e,t)=>{const n=io(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var QL=KL;const ZL=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new Ze(e,n).inc(t,i).version}catch(r){return null}};var eP=ZL;const tP=(e,t,n)=>new Ze(e,n).compare(new Ze(t,n));var Dn=tP;const nP=(e,t,n)=>Dn(e,t,n)===0;var Hm=nP;const iP=(e,t)=>{if(Hm(e,t))return null;{const n=io(e),i=io(t),r=n.prerelease.length||i.prerelease.length,a=r?"pre":"",o=r?"prerelease":"";for(const s in n)if((s==="major"||s==="minor"||s==="patch")&&n[s]!==i[s])return a+s;return o}};var rP=iP;const aP=(e,t)=>new Ze(e,t).major;var oP=aP;const sP=(e,t)=>new Ze(e,t).minor;var lP=sP;const uP=(e,t)=>new Ze(e,t).patch;var cP=uP;const fP=(e,t)=>{const n=io(e,t);return n&&n.prerelease.length?n.prerelease:null};var dP=fP;const hP=(e,t,n)=>Dn(t,e,n);var pP=hP;const gP=(e,t)=>Dn(e,t,!0);var mP=gP;const vP=(e,t,n)=>{const i=new Ze(e,n),r=new Ze(t,n);return i.compare(r)||i.compareBuild(r)};var Ym=vP;const yP=(e,t)=>e.sort((n,i)=>Ym(n,i,t));var bP=yP;const wP=(e,t)=>e.sort((n,i)=>Ym(i,n,t));var xP=wP;const EP=(e,t,n)=>Dn(e,t,n)>0;var Kl=EP;const kP=(e,t,n)=>Dn(e,t,n)<0;var Uf=kP;const _P=(e,t,n)=>Dn(e,t,n)!==0;var LE=_P;const AP=(e,t,n)=>Dn(e,t,n)>=0;var Vm=AP;const SP=(e,t,n)=>Dn(e,t,n)<=0;var Xm=SP;const OP=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return Hm(e,n,i);case"!=":return LE(e,n,i);case">":return Kl(e,n,i);case">=":return Vm(e,n,i);case"<":return Uf(e,n,i);case"<=":return Xm(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var qf=OP;const{re:Wf,t:Gf}=Zr,TP=(e,t)=>{if(e instanceof Ze)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(Wf[Gf.COERCE]);else{let i;for(;(i=Wf[Gf.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),Wf[Gf.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;Wf[Gf.COERCERTL].lastIndex=-1}return n===null?null:io(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var CP=TP;class Hf{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Hf)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Hf(e.raw,t);if(e instanceof ro)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=this.options.loose;e=e.trim();const n=t?Nt[Et.HYPHENRANGELOOSE]:Nt[Et.HYPHENRANGE];e=e.replace(n,UP(this.options.includePrerelease)),Oe("hyphen replace",e),e=e.replace(Nt[Et.COMPARATORTRIM],$P),Oe("comparator trim",e,Nt[Et.COMPARATORTRIM]),e=e.replace(Nt[Et.TILDETRIM],DP),e=e.replace(Nt[Et.CARETTRIM],RP),e=e.split(/\s+/).join(" ");const i=t?Nt[Et.COMPARATORLOOSE]:Nt[Et.COMPARATOR];return e.split(" ").map(r=>NP(r,this.options)).join(" ").split(/\s+/).map(r=>BP(r,this.options)).filter(this.options.loose?r=>!!r.match(i):()=>!0).map(r=>new ro(r,this.options))}intersects(e,t){if(!(e instanceof Hf))throw new TypeError("a Range is required");return this.set.some(n=>PE(n,t)&&e.set.some(i=>PE(i,t)&&n.every(r=>i.every(a=>r.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Ze(e,this.options)}catch(t){return!1}for(let t=0;t<this.set.length;t++)if(qP(this.set[t],e,this.options))return!0;return!1}}var cn=Hf;const{re:Nt,t:Et,comparatorTrimReplace:$P,tildeTrimReplace:DP,caretTrimReplace:RP}=Zr,PE=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every(a=>r.intersects(a,t)),r=i.pop();return n},NP=(e,t)=>(Oe("comp",e,t),e=MP(e,t),Oe("caret",e),e=FP(e,t),Oe("tildes",e),e=LP(e,t),Oe("xrange",e),e=zP(e,t),Oe("stars",e),e),Gt=e=>!e||e.toLowerCase()==="x"||e==="*",FP=(e,t)=>e.trim().split(/\s+/).map(n=>IP(n,t)).join(" "),IP=(e,t)=>{const n=t.loose?Nt[Et.TILDELOOSE]:Nt[Et.TILDE];return e.replace(n,(i,r,a,o,s)=>{Oe("tilde",e,i,r,a,o,s);let l;return Gt(r)?l="":Gt(a)?l=`>=${r}.0.0 <${+r+1}.0.0-0`:Gt(o)?l=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:s?(Oe("replaceTilde pr",s),l=`>=${r}.${a}.${o}-${s} <${r}.${+a+1}.0-0`):l=`>=${r}.${a}.${o} <${r}.${+a+1}.0-0`,Oe("tilde return",l),l})},MP=(e,t)=>e.trim().split(/\s+/).map(n=>jP(n,t)).join(" "),jP=(e,t)=>{Oe("caret",e,t);const n=t.loose?Nt[Et.CARETLOOSE]:Nt[Et.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,(r,a,o,s,l)=>{Oe("caret",e,r,a,o,s,l);let u;return Gt(a)?u="":Gt(o)?u=`>=${a}.0.0${i} <${+a+1}.0.0-0`:Gt(s)?a==="0"?u=`>=${a}.${o}.0${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.0${i} <${+a+1}.0.0-0`:l?(Oe("replaceCaret pr",l),a==="0"?o==="0"?u=`>=${a}.${o}.${s}-${l} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}-${l} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s}-${l} <${+a+1}.0.0-0`):(Oe("no pr"),a==="0"?o==="0"?u=`>=${a}.${o}.${s}${i} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s} <${+a+1}.0.0-0`),Oe("caret return",u),u})},LP=(e,t)=>(Oe("replaceXRanges",e,t),e.split(/\s+/).map(n=>PP(n,t)).join(" ")),PP=(e,t)=>{e=e.trim();const n=t.loose?Nt[Et.XRANGELOOSE]:Nt[Et.XRANGE];return e.replace(n,(i,r,a,o,s,l)=>{Oe("xRange",e,i,r,a,o,s,l);const u=Gt(a),c=u||Gt(o),f=c||Gt(s),d=f;return r==="="&&d&&(r=""),l=t.includePrerelease?"-0":"",u?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&d?(c&&(o=0),s=0,r===">"?(r=">=",c?(a=+a+1,o=0,s=0):(o=+o+1,s=0)):r==="<="&&(r="<",c?a=+a+1:o=+o+1),r==="<"&&(l="-0"),i=`${r+a}.${o}.${s}${l}`):c?i=`>=${a}.0.0${l} <${+a+1}.0.0-0`:f&&(i=`>=${a}.${o}.0${l} <${a}.${+o+1}.0-0`),Oe("xRange return",i),i})},zP=(e,t)=>(Oe("replaceStars",e,t),e.trim().replace(Nt[Et.STAR],"")),BP=(e,t)=>(Oe("replaceGTE0",e,t),e.trim().replace(Nt[t.includePrerelease?Et.GTE0PRE:Et.GTE0],"")),UP=e=>(t,n,i,r,a,o,s,l,u,c,f,d,h)=>(Gt(i)?n="":Gt(r)?n=`>=${i}.0.0${e?"-0":""}`:Gt(a)?n=`>=${i}.${r}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,Gt(u)?l="":Gt(c)?l=`<${+u+1}.0.0-0`:Gt(f)?l=`<${u}.${+c+1}.0-0`:d?l=`<=${u}.${c}.${f}-${d}`:e?l=`<${u}.${c}.${+f+1}-0`:l=`<=${l}`,`${n} ${l}`.trim()),qP=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let i=0;i<e.length;i++){if(Oe(e[i].semver),e[i].semver===ro.ANY)continue;if(e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}}return!1}return!0},Ql=Symbol("SemVer ANY");class Jm{static get ANY(){return Ql}constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Jm){if(e.loose===!!t.loose)return e;e=e.value}Oe("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ql?this.value="":this.value=this.operator+this.semver.version,Oe("comp",this)}parse(e){const t=this.options.loose?zE[BE.COMPARATORLOOSE]:zE[BE.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ze(n[2],this.options.loose):this.semver=Ql}toString(){return this.value}test(e){if(Oe("Comparator.test",e,this.options.loose),this.semver===Ql||e===Ql)return!0;if(typeof e=="string")try{e=new Ze(e,this.options)}catch(t){return!1}return qf(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Jm))throw new TypeError("a Comparator is required");if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new cn(e.value,t).test(this.value);if(e.operator==="")return e.value===""?!0:new cn(this.value,t).test(e.semver);const n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),r=this.semver.version===e.semver.version,a=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),o=qf(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),s=qf(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||i||r&&a||o||s}}var ro=Jm;const{re:zE,t:BE}=Zr,WP=(e,t,n)=>{try{t=new cn(t,n)}catch(i){return!1}return t.test(e)};var ea=WP;const GP=(e,t)=>new cn(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var HP=GP;const YP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new cn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===-1)&&(i=o,r=new Ze(i,n)))}),i};var VP=YP;const XP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new cn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===1)&&(i=o,r=new Ze(i,n)))}),i};var JP=XP;const KP=(e,t)=>{e=new cn(e,t);let n=new Ze("0.0.0");if(e.test(n))return n;if(n=new Ze("0.0.0-0"),e.test(n))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];r.forEach(a=>{const o=new Ze(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!n||Kl(n,o))&&(n=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}})}return n&&e.test(n)?n:null};var QP=KP;const ZP=(e,t)=>{try{return new cn(e,t).range||"*"}catch(n){return null}};var ez=ZP;const{ANY:tz}=ro,nz=(e,t,n,i)=>{e=new Ze(e,i),t=new cn(t,i);let r,a,o,s,l;switch(n){case">":r=Kl,a=Xm,o=Uf,s=">",l=">=";break;case"<":r=Uf,a=Vm,o=Kl,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ea(e,t,i))return!1;for(let u=0;u<t.set.length;++u){const c=t.set[u];let f=null,d=null;if(c.forEach(h=>{h.semver===tz&&(h=new ro(">=0.0.0")),f=f||h,d=d||h,r(h.semver,f.semver,i)?f=h:o(h.semver,d.semver,i)&&(d=h)}),f.operator===s||f.operator===l)return!1;if((!d.operator||d.operator===s)&&a(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};var Km=nz;const iz=(e,t,n)=>Km(e,t,">",n);var rz=iz;const az=(e,t,n)=>Km(e,t,"<",n);var oz=az;const sz=(e,t,n)=>(e=new cn(e,n),t=new cn(t,n),e.intersects(t));var lz=sz,uz=(e,t,n)=>{const i=[];let r=null,a=null;const o=e.sort((c,f)=>Dn(c,f,n));for(const c of o){const f=ea(c,t,n);f?(a=c,r||(r=c)):(a&&i.push([r,a]),a=null,r=null)}r&&i.push([r,null]);const s=[];for(const[c,f]of i)c===f?s.push(c):!f&&c===o[0]?s.push("*"):f?c===o[0]?s.push(`<=${f}`):s.push(`${c} - ${f}`):s.push(`>=${c}`);const l=s.join(" || "),u=typeof t.raw=="string"?t.raw:String(t);return l.length<u.length?l:t};const{ANY:UE}=ro,cz=(e,t,n)=>{e=new cn(e,n),t=new cn(t,n);let i=!1;e:for(const r of e.set){for(const a of t.set){const o=fz(r,a,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},fz=(e,t,n)=>{if(e.length===1&&e[0].semver===UE)return t.length===1&&t[0].semver===UE;const i=new Set();let r,a;for(const f of e)f.operator===">"||f.operator===">="?r=qE(r,f,n):f.operator==="<"||f.operator==="<="?a=WE(a,f,n):i.add(f.semver);if(i.size>1)return null;let o;if(r&&a){if(o=Dn(r.semver,a.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||a.operator!=="<="))return null}for(const f of i){if(r&&!ea(f,String(r),n))return null;if(a&&!ea(f,String(a),n))return null;for(const d of t)if(!ea(f,String(d),n))return!1;return!0}let s,l,u,c;for(const f of t){if(c=c||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",r){if(f.operator===">"||f.operator===">="){if(s=qE(r,f,n),s===f)return!1}else if(r.operator===">="&&!ea(r.semver,String(f),n))return!1}if(a){if(f.operator==="<"||f.operator==="<="){if(l=WE(a,f,n),l===f)return!1}else if(a.operator==="<="&&!ea(a.semver,String(f),n))return!1}if(!f.operator&&(a||r)&&o!==0)return!1}return r&&u&&!a&&o!==0?!1:!(a&&c&&!r&&o!==0)},qE=(e,t,n)=>{if(!e)return t;const i=Dn(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},WE=(e,t,n)=>{if(!e)return t;const i=Dn(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var dz=cz,GE={re:Zr.re,src:Zr.src,tokens:Zr.t,SEMVER_SPEC_VERSION:Lf.SEMVER_SPEC_VERSION,SemVer:Ze,compareIdentifiers:Gm.compareIdentifiers,rcompareIdentifiers:Gm.rcompareIdentifiers,parse:io,valid:JL,clean:QL,inc:eP,diff:rP,major:oP,minor:lP,patch:cP,prerelease:dP,compare:Dn,rcompare:pP,compareLoose:mP,compareBuild:Ym,sort:bP,rsort:xP,gt:Kl,lt:Uf,eq:Hm,neq:LE,gte:Vm,lte:Xm,cmp:qf,coerce:CP,Comparator:ro,Range:cn,satisfies:ea,toComparators:HP,maxSatisfying:VP,minSatisfying:JP,minVersion:QP,validRange:ez,outside:Km,gtr:rz,ltr:oz,intersects:lz,simplifyRange:uz,subset:dz};function mr(e,t,n){return e.fields=t||[],e.fname=n,e}function hz(e){return e==null?null:e.fname}function HE(e){return e==null?null:e.fields}function YE(e){return e.length===1?pz(e[0]):gz(e)}const pz=e=>function(t){return t[e]},gz=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function Yf(e){throw Error(e)}function Qm(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||Yf("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&Yf("Access path missing closing bracket: "+e),n&&Yf("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Zm(e,t,n){const i=Qm(e);return e=i.length===1?i[0]:e,mr((n&&n.get||YE)(i),[e],t||e)}var Zl=[],mz=Zm("id"),e0=mr(function(e){return e},Zl,"identity"),vz=mr(function(){return 0},Zl,"zero"),yz=mr(function(){return 1},Zl,"one"),bz=mr(function(){return!0},Zl,"true"),wz=mr(function(){return!1},Zl,"false");function Vf(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var VE=0,XE=1,JE=2,KE=3,QE=4;function xz(e,t){var n=e||VE;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=XE&&Vf(t||"error","ERROR",arguments),this},warn:function(){return n>=JE&&Vf(t||"warn","WARN",arguments),this},info:function(){return n>=KE&&Vf(t||"log","INFO",arguments),this},debug:function(){return n>=QE&&Vf(t||"log","DEBUG",arguments),this}}}var Xf=Array.isArray;function Jf(e){return e===Object(e)}const ZE=e=>e!=="__proto__";function Ez(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=kz(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;Kf(t,i,n[i],r)}return t},{})}function Kf(e,t,n,i){if(!ZE(t))return;var r,a;if(Jf(n)&&!Xf(n)){a=Jf(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?Kf(a,r,n[r]):ZE(r)&&(a[r]=n[r])}else e[t]=n}function kz(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function Ts(e){return e[e.length-1]}function t0(e){return e==null||e===""?null:+e}function ek(e){return function(t){return e*Math.exp(t)}}function tk(e){return function(t){return Math.log(e*t)}}function nk(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function ik(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Qf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Zf(e,t,n,i){var r=n(e[0]),a=n(Ts(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function _z(e,t){return Zf(e,t,t0,e0)}function Az(e,t){var n=Math.sign(e[0]);return Zf(e,t,tk(n),ek(n))}function Sz(e,t,n){return Zf(e,t,Qf(n),Qf(1/n))}function Oz(e,t,n){return Zf(e,t,nk(n),ik(n))}function ed(e,t,n,i,r){var a=i(e[0]),o=i(Ts(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function Tz(e,t,n){return ed(e,t,n,t0,e0)}function Cz(e,t,n){var i=Math.sign(e[0]);return ed(e,t,n,tk(i),ek(i))}function $z(e,t,n,i){return ed(e,t,n,Qf(i),Qf(1/i))}function Dz(e,t,n,i){return ed(e,t,n,nk(i),ik(i))}function Rz(e){return 1+~~(new Date(e).getMonth()/3)}function Nz(e){return 1+~~(new Date(e).getUTCMonth()/3)}function eu(e){return e!=null?Xf(e)?e:[e]:[]}function Fz(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function n0(e){return typeof e=="function"}const Iz="descending";function Mz(e,t,n){n=n||{},t=eu(t)||[];const i=[],r=[],a={},o=n.comparator||jz;return eu(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===Iz?-1:1),r.push(s=n0(s)?s:Zm(s,null,n)),(HE(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:mr(o(r,i),Object.keys(a))}const rk=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,jz=(e,t)=>e.length===1?Lz(e[0],t[0]):Pz(e,t,e.length),Lz=(e,t)=>function(n,i){return rk(e(n),e(i))*t},Pz=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=rk(a(i),a(r));return o*t[s]});function zz(e){return n0(e)?e:function(){return e}}function Bz(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function ak(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function Uz(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function qz(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const Wz=Object.prototype.hasOwnProperty;function ao(e,t){return Wz.call(e,t)}var td={};function Gz(e){var t={},n,i;function r(a){return ao(t,a)&&t[a]!==td}return n={size:0,empty:0,object:t,has:r,get(a){return r(a)?t[a]:void 0},set(a,o){return r(a)||(++n.size,t[a]===td&&--n.empty),t[a]=o,this},delete(a){return r(a)&&(--n.size,++n.empty,t[a]=td),this},clear(){n.size=n.empty=0,n.object=t={}},test(a){return arguments.length?(i=a,n):i},clean(){var a={},o=0,s,l;for(s in t)l=t[s],l!==td&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function Hz(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=Ts(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function Yz(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function Vz(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function Xz(e){return typeof e=="boolean"}function ok(e){return Object.prototype.toString.call(e)==="[object Date]"}function sk(e){return typeof e=="number"}function Jz(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function lk(e){return typeof e=="string"}function Kz(e,t,n){e&&(e=t?eu(e).map(s=>s.replace(/\\(.)/g,"$1")):eu(e));const i=e&&e.length,r=n&&n.get||YE,a=s=>r(t?[s]:Qm(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return mr(o,e,"key")}function Qz(e,t){const n=e[0],i=Ts(e),r=+t;return r?r===1?i:n+r*(i-n):n}const Zz=1e4;function e5(e){e=+e||Zz;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>ao(t,o)||ao(n,o),get:o=>ao(t,o)?t[o]:ao(n,o)?a(o,n[o]):void 0,set:(o,s)=>ao(t,o)?t[o]=s:a(o,s)}}function t5(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function tu(e,t){for(var n="";--t>=0;)n+=e;return n}function n5(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?tu(r,o)+a:i==="center"?tu(r,~~(o/2))+a+tu(r,Math.ceil(o/2)):a+tu(r,o)}function i5(e){return e&&Ts(e)-e[0]||0}function uk(e){return Xf(e)?"["+e.map(uk)+"]":Jf(e)||lk(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function r5(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function a5(e){return sk(e)||ok(e)?e:Date.parse(e)}function o5(e,t){return t=t||a5,e==null||e===""?null:t(e)}function s5(e){return e==null||e===""?null:e+""}function l5(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function u5(e,t,n,i){var r=i??"â€¦",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function c5(e,t,n){if(e)if(t)for(var i=0,r=e.length,a;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}function Rn(e,t,n){return e.fields=t||[],e.fname=n,e}function et(e){return e==null?null:e.fname}function Ht(e){return e==null?null:e.fields}function ck(e){return e.length===1?f5(e[0]):d5(e)}const f5=e=>function(t){return t[e]},d5=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function N(e){throw Error(e)}function vr(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||N("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&N("Access path missing closing bracket: "+e),n&&N("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Ni(e,t,n){const i=vr(e);return e=i.length===1?i[0]:e,Rn((n&&n.get||ck)(i),[e],t||e)}var nu=[],nd=Ni("id"),Yt=Rn(function(e){return e},nu,"identity"),oo=Rn(function(){return 0},nu,"zero"),iu=Rn(function(){return 1},nu,"one"),Fi=Rn(function(){return!0},nu,"true"),so=Rn(function(){return!1},nu,"false");function id(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var h5=0,fk=1,dk=2,p5=3,g5=4;function hk(e,t){var n=e||h5;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=fk&&id(t||"error","ERROR",arguments),this},warn:function(){return n>=dk&&id(t||"warn","WARN",arguments),this},info:function(){return n>=p5&&id(t||"log","INFO",arguments),this},debug:function(){return n>=g5&&id(t||"log","DEBUG",arguments),this}}}var I=Array.isArray;function K(e){return e===Object(e)}const pk=e=>e!=="__proto__";function ru(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=m5(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;i0(t,i,n[i],r)}return t},{})}function i0(e,t,n,i){if(!pk(t))return;var r,a;if(K(n)&&!I(n)){a=K(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?i0(a,r,n[r]):pk(r)&&(a[r]=n[r])}else e[t]=n}function m5(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function ve(e){return e[e.length-1]}function fn(e){return e==null||e===""?null:+e}function gk(e){return function(t){return e*Math.exp(t)}}function mk(e){return function(t){return Math.log(e*t)}}function vk(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function yk(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function rd(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ad(e,t,n,i){var r=n(e[0]),a=n(ve(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function v5(e,t){return ad(e,t,fn,Yt)}function y5(e,t){var n=Math.sign(e[0]);return ad(e,t,mk(n),gk(n))}function b5(e,t,n){return ad(e,t,rd(n),rd(1/n))}function w5(e,t,n){return ad(e,t,vk(n),yk(n))}function od(e,t,n,i,r){var a=i(e[0]),o=i(ve(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function bk(e,t,n){return od(e,t,n,fn,Yt)}function wk(e,t,n){var i=Math.sign(e[0]);return od(e,t,n,mk(i),gk(i))}function r0(e,t,n,i){return od(e,t,n,rd(i),rd(1/i))}function xk(e,t,n,i){return od(e,t,n,vk(i),yk(i))}function x5(e){return 1+~~(new Date(e).getMonth()/3)}function E5(e){return 1+~~(new Date(e).getUTCMonth()/3)}function G(e){return e!=null?I(e)?e:[e]:[]}function k5(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function ge(e){return typeof e=="function"}const _5="descending";function Ek(e,t,n){n=n||{},t=G(t)||[];const i=[],r=[],a={},o=n.comparator||A5;return G(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===_5?-1:1),r.push(s=ge(s)?s:Ni(s,null,n)),(Ht(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:Rn(o(r,i),Object.keys(a))}const kk=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,A5=(e,t)=>e.length===1?S5(e[0],t[0]):O5(e,t,e.length),S5=(e,t)=>function(n,i){return kk(e(n),e(i))*t},O5=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=kk(a(i),a(r));return o*t[s]});function Vt(e){return ge(e)?e:function(){return e}}function _k(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function fe(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function yr(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function T5(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const C5=Object.prototype.hasOwnProperty;function Q(e,t){return C5.call(e,t)}var sd={};function au(e){var t={},n,i;function r(a){return Q(t,a)&&t[a]!==sd}return n={size:0,empty:0,object:t,has:r,get:function(a){return r(a)?t[a]:void 0},set:function(a,o){return r(a)||(++n.size,t[a]===sd&&--n.empty),t[a]=o,this},delete:function(a){return r(a)&&(--n.size,++n.empty,t[a]=sd),this},clear:function(){n.size=n.empty=0,n.object=t={}},test:function(a){return arguments.length?(i=a,n):i},clean:function(){var a={},o=0,s,l;for(s in t)l=t[s],l!==sd&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function $5(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=ve(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function P(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function ou(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function lo(e){return typeof e=="boolean"}function uo(e){return Object.prototype.toString.call(e)==="[object Date]"}function Re(e){return typeof e=="number"}function D5(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function Ak(e,t,n){e&&(e=t?G(e).map(s=>s.replace(/\\(.)/g,"$1")):G(e));const i=e&&e.length,r=n&&n.get||ck,a=s=>r(t?[s]:vr(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return Rn(o,e,"key")}function R5(e,t){const n=e[0],i=ve(e),r=+t;return r?r===1?i:n+r*(i-n):n}const N5=1e4;function F5(e){e=+e||N5;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>Q(t,o)||Q(n,o),get:o=>Q(t,o)?t[o]:Q(n,o)?a(o,n[o]):void 0,set:(o,s)=>Q(t,o)?t[o]=s:a(o,s)}}function I5(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function ld(e,t){for(var n="";--t>=0;)n+=e;return n}function M5(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?ld(r,o)+a:i==="center"?ld(r,~~(o/2))+a+ld(r,Math.ceil(o/2)):a+ld(r,o)}function ud(e){return e&&ve(e)-e[0]||0}function B(e){return I(e)?"["+e.map(B)+"]":K(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Sk(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function j5(e){return Re(e)||uo(e)?e:Date.parse(e)}function Ok(e,t){return t=t||j5,e==null||e===""?null:t(e)}function Tk(e){return e==null||e===""?null:e+""}function kt(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function L5(e,t,n,i){var r=i??"â€¦",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function co(e,t,n){if(e){var i=0,r=e.length,a;if(t)for(;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}}function cd(e){var t=e||Yt,n=[],i={};return n.add=function(r){var a=t(r);return i[a]||(i[a]=1,n.push(r)),n},n.remove=function(r){var a=t(r),o;return i[a]&&(i[a]=0,(o=n.indexOf(r))>=0&&n.splice(o,1)),n},n}async function fd(e,t){try{await t(e)}catch(n){e.error(n)}}var Ck=Symbol("vega_id"),P5=1;function dd(e){return!!(e&&ee(e))}function ee(e){return e[Ck]}function $k(e,t){return e[Ck]=t,e}function ke(e){var t=e===Object(e)?e:{data:e};return ee(t)?t:$k(t,P5++)}function a0(e){return o0(e,ke({}))}function o0(e,t){for(var n in e)t[n]=e[n];return t}function Dk(e,t){return $k(t,ee(e))}function fo(e,t){return e?t?(n,i)=>e(n,i)||ee(t(n))-ee(t(i)):(n,i)=>e(n,i)||ee(n)-ee(i):null}function Rk(e){return e&&e.constructor===ho}function ho(){var e=[],t=[],n=[],i=[],r=[],a=null,o=!1;return{constructor:ho,insert:function(s){for(var l=G(s),u=0,c=l.length;u<c;++u)e.push(l[u]);return this},remove:function(s){for(var l=ge(s)?i:t,u=G(s),c=0,f=u.length;c<f;++c)l.push(u[c]);return this},modify:function(s,l,u){var c={field:l,value:Vt(u)};return ge(s)?(c.filter=s,r.push(c)):(c.tuple=s,n.push(c)),this},encode:function(s,l){return ge(s)?r.push({filter:s,field:l}):n.push({tuple:s,field:l}),this},clean:function(s){return a=s,this},reflow:function(){return o=!0,this},pulse:function(s,l){var u={},c={},f,d,h,p,g,m;for(f=0,d=l.length;f<d;++f)u[ee(l[f])]=1;for(f=0,d=t.length;f<d;++f)g=t[f],u[ee(g)]=-1;for(f=0,d=i.length;f<d;++f)p=i[f],l.forEach(function(y){p(y)&&(u[ee(y)]=-1)});for(f=0,d=e.length;f<d;++f)g=e[f],m=ee(g),u[m]?u[m]=1:s.add.push(ke(e[f]));for(f=0,d=l.length;f<d;++f)g=l[f],u[ee(g)]<0&&s.rem.push(g);function v(y,b,E){E?y[b]=E(y):s.encode=b,o||(c[ee(y)]=y)}for(f=0,d=n.length;f<d;++f)h=n[f],g=h.tuple,p=h.field,m=u[ee(g)],m>0&&(v(g,p,h.value),s.modifies(p));for(f=0,d=r.length;f<d;++f)h=r[f],p=h.filter,l.forEach(function(y){p(y)&&u[ee(y)]>0&&v(y,h.field,h.value)}),s.modifies(h.field);if(o)s.mod=t.length||i.length?l.filter(function(y){return u[ee(y)]>0}):l.slice();else for(m in c)s.mod.push(c[m]);return(a||a==null&&(t.length||i.length))&&s.clean(!0),s}}}var hd="_:mod:_";function pd(){Object.defineProperty(this,hd,{writable:!0,value:{}})}var s0=pd.prototype;s0.set=function(e,t,n,i){var r=this,a=r[e],o=r[hd];return t!=null&&t>=0?(a[t]!==n||i)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||i)&&(r[e]=n,o[e]=I(n)?1+n.length:-1),r},s0.modified=function(e,t){var n=this[hd],i;if(arguments.length){if(I(e)){for(i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},s0.clear=function(){return this[hd]={},this};var z5=0,B5="pulse",U5=new pd(),q5=1,W5=2;function Ne(e,t,n,i){this.id=++z5,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}var br=Ne.prototype;br.targets=function(){return this._targets||(this._targets=cd(nd))},br.set=function(e){return this.value!==e?(this.value=e,1):0};function Nk(e){return function(t){var n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}br.skip=Nk(q5),br.modified=Nk(W5),br.parameters=function(e,t,n){t=t!==!1;var i=this,r=i._argval=i._argval||new pd(),a=i._argops=i._argops||[],o=[],s,l,u,c;function f(d,h,p){p instanceof Ne?(p!==i&&(t&&p.targets().add(i),o.push(p)),a.push({op:p,name:d,index:h})):r.set(d,h,p)}for(s in e)if(l=e[s],s===B5)G(l).forEach(function(d){d instanceof Ne?d!==i&&(d.targets().add(i),o.push(d)):N("Pulse parameters must be operator instances.")}),i.source=l;else if(I(l))for(r.set(s,-1,Array(u=l.length)),c=0;c<u;++c)f(s,c,l[c]);else f(s,-1,l);return this.marshall().clear(),n&&(a.initonly=!0),o},br.marshall=function(e){var t=this._argval||U5,n=this._argops,i,r,a,o,s;if(n){for(r=0,a=n.length;r<a;++r)i=n[r],o=i.op,s=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,s);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},br.detach=function(){var e=this._argops,t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this)},br.evaluate=function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},br.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e};function G5(e,t,n,i){var r=1,a;return e instanceof Ne?a=e:e&&e.prototype instanceof Ne?a=new e():ge(e)?a=new Ne(null,e):(r=0,a=new Ne(e,t)),this.rank(a),r&&(i=n,n=t),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a}function H5(e,t){var n=e.rank,i,r;for(i=0,r=t.length;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}var Y5=0;function gd(e,t,n){this.id=++Y5,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function ta(e,t,n){return new gd(e,t,n)}var ci=gd.prototype;ci._filter=Fi,ci._apply=Yt,ci.targets=function(){return this._targets||(this._targets=cd(nd))},ci.consume=function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},ci.receive=function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,i=n?n.length:0,r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},ci.filter=function(e){var t=ta(e);return this.targets().add(t),t},ci.apply=function(e){var t=ta(null,e);return this.targets().add(t),t},ci.merge=function(){var e=ta();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},ci.throttle=function(e){var t=-1;return this.filter(function(){var n=Date.now();return n-t>e?(t=n,1):0})},ci.debounce=function(e){var t=ta();return this.targets().add(ta(null,null,_k(e,function(n){var i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},ci.between=function(e,t){var n=!1;return e.targets().add(ta(null,null,function(){n=!0})),t.targets().add(ta(null,null,function(){n=!1})),this.filter(function(){return n})};function V5(e,t,n,i){var r=this,a=ta(n,i),o=function(c){c.dataflow=r;try{a.receive(c)}catch(f){r.error(f)}finally{r.run()}},s;typeof e=="string"&&typeof document!="undefined"?s=document.querySelectorAll(e):s=G(e);for(var l=0,u=s.length;l<u;++l)s[l].addEventListener(t,o);return a}const X5=/^([A-Za-z]+:)?\/\//,J5=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,K5=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Fk="file://";function Q5(e,t){return function(n){return{options:n||{},sanitize:e6,load:Z5,fileAccess:!!t,file:t6(t),http:i6(e)}}}async function Z5(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function e6(e,t){t=fe({},this.options,t);const n=this.fileAccess,i={href:null};let r,a,o;const s=J5.test(e.replace(K5,""));(e==null||typeof e!="string"||!s)&&N("Sanitize failure, invalid URI: "+B(e));const l=X5.test(e);return(o=t.baseURL)&&!l&&(!e.startsWith("/")&&o[o.length-1]!=="/"&&(e="/"+e),e=o+e),a=(r=e.startsWith(Fk))||t.mode==="file"||t.mode!=="http"&&!l&&n,r?e=e.slice(Fk.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!a}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function t6(e){return e?function(t){return new Promise(function(n,i){e.readFile(t,function(r,a){r?i(r):n(a)})})}:n6}async function n6(){N("No file system access.")}function i6(e){return e?async function(t,n){const i=fe({},this.options.http,n),r=n&&n.response,a=await e(t,i);return a.ok?ge(a[r])?a[r]():a.text():N(a.status+""+a.statusText)}:r6}async function r6(){N("No HTTP fetch method available.")}var l0={boolean:Sk,integer:fn,number:fn,date:Ok,string:Tk,unknown:Yt},md=[s6,u6,jk,l6],a6=["boolean","integer","number","date"];function Ik(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=md.length,r=md.map((a,o)=>o+1);for(let a=0,o=0,s,l;a<n;++a)for(l=t?e[a][t]:e[a],s=0;s<i;++s)if(r[s]&&o6(l)&&!md[s](l)&&(r[s]=0,++o,o===md.length))return"string";return a6[r.reduce((a,o)=>a===0?o:a,0)-1]}function Mk(e,t){return t.reduce(function(n,i){return n[i]=Ik(e,i),n},{})}function o6(e){return e!=null&&e===e}function s6(e){return e==="true"||e==="false"||e===!0||e===!1}function l6(e){return!Number.isNaN(Date.parse(e))}function jk(e){return!Number.isNaN(+e)&&!(e instanceof Date)}function u6(e){return jk(e)&&Number.isInteger(+e)}var Lk={},u0={},c0=34,su=10,f0=13;function Pk(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function c6(e,t){var n=Pk(e);return function(i,r){return t(n(i),r,e)}}function zk(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function dn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function f6(e){return e<0?"-"+dn(-e,6):e>9999?"+"+dn(e,6):dn(e,4)}function d6(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":f6(e.getUTCFullYear())+"-"+dn(e.getUTCMonth()+1,2)+"-"+dn(e.getUTCDate(),2)+(r?"T"+dn(t,2)+":"+dn(n,2)+":"+dn(i,2)+"."+dn(r,3)+"Z":i?"T"+dn(t,2)+":"+dn(n,2)+":"+dn(i,2)+"Z":n||t?"T"+dn(t,2)+":"+dn(n,2)+"Z":"")}function h6(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,p,g=r(f,function(m,v){if(h)return h(m,v-1);p=m,h=d?c6(m,d):Pk(m)});return g.columns=p||[],g}function r(f,d){var h=[],p=f.length,g=0,m=0,v,y=p<=0,b=!1;f.charCodeAt(p-1)===su&&--p,f.charCodeAt(p-1)===f0&&--p;function E(){if(y)return u0;if(b)return b=!1,Lk;var k,w=g,A;if(f.charCodeAt(w)===c0){for(;g++<p&&f.charCodeAt(g)!==c0||f.charCodeAt(++g)===c0;);return(k=g)>=p?y=!0:(A=f.charCodeAt(g++))===su?b=!0:A===f0&&(b=!0,f.charCodeAt(g)===su&&++g),f.slice(w+1,k-1).replace(/""/g,'"')}for(;g<p;){if((A=f.charCodeAt(k=g++))===su)b=!0;else if(A===f0)b=!0,f.charCodeAt(g)===su&&++g;else if(A!==n)continue;return f.slice(w,k)}return y=!0,f.slice(w,p)}for(;(v=E())!==u0;){for(var x=[];v!==Lk&&v!==u0;)x.push(v),v=E();if(d&&(x=d(x,m++))==null)continue;h.push(x)}return h}function a(f,d){return f.map(function(h){return d.map(function(p){return c(h[p])}).join(e)})}function o(f,d){return d==null&&(d=zk(f)),[d.map(c).join(e)].concat(a(f,d)).join(`
`)}function s(f,d){return d==null&&(d=zk(f)),a(f,d).join(`
`)}function l(f){return f.map(u).join(`
`)}function u(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?d6(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:o,formatBody:s,formatRows:l,formatRow:u,formatValue:c}}function Bk(e){const t=function(n,i){const r={delimiter:e};return d0(n,i?fe(i,r):r)};return t.responseType="text",t}function d0(e,t){return t.header&&(e=t.header.map(B).join(t.delimiter)+`
`+e),h6(t.delimiter).parse(e+"")}d0.responseType="text";function p6(e){return typeof Buffer=="function"&&ge(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function h0(e,t){const n=t&&t.property?Ni(t.property):Yt;return K(e)&&!p6(e)?g6(n(e)):n(JSON.parse(e))}h0.responseType="json";function g6(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}function m6(e){return e}function v6(e){if(e==null)return m6;var t,n,i=e.scale[0],r=e.scale[1],a=e.translate[0],o=e.translate[1];return function(s,l){l||(t=n=0);var u=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*i+a,f[1]=(n+=s[1])*r+o;u<c;)f[u]=s[u],++u;return f}}function y6(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function b6(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return Uk(e,n)})}:Uk(e,t)}function Uk(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,a=qk(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:a}:i==null?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function qk(e,t){var n=v6(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));c<0&&y6(f,p)}function a(c){return n(c)}function o(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(s)}function u(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":d=a(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(a);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:f,coordinates:d}}return u(t)}function w6(e,t){var n={},i={},r={},a=[],o=-1;t.forEach(function(u,c){var f=e.arcs[u<0?~u:u],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++o],t[o]=u,t[c]=d)}),t.forEach(function(u){var c=s(u),f=c[0],d=c[1],h,p;if(h=r[f])if(delete r[h.end],h.push(u),h.end=d,p=i[d]){delete i[p.start];var g=p===h?h:h.concat(p);i[g.start=h.start]=r[g.end=p.end]=g}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(u),h.start=f,p=r[f]){delete r[p.end];var m=p===h?h:p.concat(h);i[m.start=p.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[u],i[h.start=f]=r[h.end=d]=h});function s(u){var c=e.arcs[u<0?~u:u],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],u<0?[d,f]:[f,d]}function l(u,c){for(var f in u){var d=u[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),a.push(d)}}return l(r,i),l(i,r),t.forEach(function(u){n[u<0?~u:u]||a.push([u])}),a}function x6(e){return qk(e,E6.apply(this,arguments))}function E6(e,t,n){var i,r,a;if(arguments.length>1)i=k6(e,t,n);else for(r=0,i=new Array(a=e.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:w6(e,i)}}function k6(e,t,n){var i=[],r=[],a;function o(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:a})}function s(f){f.forEach(o)}function l(f){f.forEach(s)}function u(f){f.forEach(l)}function c(f){switch(a=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":s(f.arcs);break;case"MultiLineString":case"Polygon":l(f.arcs);break;case"MultiPolygon":u(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}const _6={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Wk(e,t){let n,i,r,a;return e=h0(e,t),t&&t.feature?(n=b6,r=t.feature):t&&t.mesh?(n=x6,r=t.mesh,a=_6[t.filter]):N("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,a):N("Invalid TopoJSON object: "+r),i&&i.features||[i]}Wk.responseType="json";const vd={dsv:d0,csv:Bk(","),tsv:Bk("	"),json:h0,topojson:Wk};function p0(e,t){return arguments.length>1?(vd[e]=t,this):Q(vd,e)?vd[e]:null}function Gk(e){const t=p0(e);return t&&t.responseType||"text"}function lu(e){const t={};return n=>t[n]||(t[n]=e(n))}function Cs(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function yd(e){return e.length===1&&(e=A6(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function A6(e){return function(t,n){return Cs(e(t),n)}}var Hk=yd(Cs),na=Hk.right,S6=Hk.left;function O6(e,t){let n=0,i,r=0,a=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,a+=i*(o-r));else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,a+=i*(s-r))}if(n>1)return a/(n-1)}function T6(e,t){const n=O6(e,t);return n&&Math.sqrt(n)}function po(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}var g0=Math.sqrt(50),m0=Math.sqrt(10),v0=Math.sqrt(2);function y0(e,t,n){var i,r=-1,a,o,s;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(a=e,e=t,t=a),(s=bd(e,t,n))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++r<a;)o[r]=(e+r)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++r<a;)o[r]=(e-r)/s;return i&&o.reverse(),o}function bd(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=g0?10:a>=m0?5:a>=v0?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=g0?10:a>=m0?5:a>=v0?2:1)}function ia(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=g0?r*=10:a>=m0?r*=5:a>=v0&&(r*=2),t<e?-r:r}function go(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function b0(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function Yk(e,t,n=0,i=e.length-1,r=Cs){for(;i>n;){if(i-n>600){const l=i-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),h=Math.max(n,Math.floor(t-u*f/l+d)),p=Math.min(i,Math.floor(t+(l-u)*f/l+d));Yk(e,t,h,p,r)}const a=e[t];let o=n,s=i;for(uu(e,n,t),r(e[i],a)>0&&uu(e,n,i);o<s;){for(uu(e,o,s),++o,--s;r(e[o],a)<0;)++o;for(;r(e[s],a)>0;)--s}r(e[n],a)===0?uu(e,n,s):(++s,uu(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}return e}function uu(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function C6(e){return e===null?NaN:+e}function*$6(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}function wd(e,t,n){if(e=Float64Array.from($6(e,n)),!(i=e.length))return;if((t=+t)<=0||i<2)return b0(e);if(t>=1)return go(e);var i,r=(i-1)*t,a=Math.floor(r),o=go(Yk(e,a).subarray(0,a+1)),s=b0(e.subarray(a+1));return o+(s-o)*(r-a)}function D6(e,t,n=C6){if(!(i=e.length))return;if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,a=Math.floor(r),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(r-a)}function R6(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let a of e)(a=t(a,++r,e))!=null&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n}function Vk(e,t){return wd(e,.5,t)}function N6(e,t){return Array.from(t,n=>e[n])}function Xk(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function xd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function $s(e){return e=xd(Math.abs(e)),e?e[1]:NaN}function F6(e,t){return function(n,i){for(var r=n.length,a=[],o=0,s=e[0],l=0;r>0&&s>0&&!(l+s+1>i&&(s=Math.max(1,i-l)),a.push(n.substring(r-=s,r+s)),(l+=s+1)>i);)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function I6(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var M6=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ds(e){if(!(t=M6.exec(e)))throw new Error("invalid format: "+e);var t;return new w0({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ds.prototype=w0.prototype;function w0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}w0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function j6(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Jk;function L6(e,t){var n=xd(e,t);if(!n)return e+"";var i=n[0],r=n[1],a=r-(Jk=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+xd(e,Math.max(0,t+a-1))[0]}function Kk(e,t){var n=xd(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var Qk={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Kk(e*100,t)},r:Kk,s:L6,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Zk(e){return e}var e_=Array.prototype.map,t_=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function n_(e){var t=e.grouping===void 0||e.thousands===void 0?Zk:F6(e_.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Zk:I6(e_.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=Ds(f);var d=f.fill,h=f.align,p=f.sign,g=f.symbol,m=f.zero,v=f.width,y=f.comma,b=f.precision,E=f.trim,x=f.type;x==="n"?(y=!0,x="g"):Qk[x]||(b===void 0&&(b=12),E=!0,x="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var k=g==="$"?n:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=g==="$"?i:/[%p]/.test(x)?o:"",A=Qk[x],_=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function O(S){var T=k,D=w,M,C,F;if(x==="c")D=A(S)+D,S="";else{S=+S;var W=S<0||1/S<0;if(S=isNaN(S)?l:A(Math.abs(S),b),E&&(S=j6(S)),W&&+S===0&&p!=="+"&&(W=!1),T=(W?p==="("?p:s:p==="-"||p==="("?"":p)+T,D=(x==="s"?t_[8+Jk/3]:"")+D+(W&&p==="("?")":""),_){for(M=-1,C=S.length;++M<C;)if(F=S.charCodeAt(M),48>F||F>57){D=(F===46?r+S.slice(M+1):S.slice(M))+D,S=S.slice(0,M);break}}}y&&!m&&(S=t(S,Infinity));var X=T.length+S.length+D.length,J=X<v?new Array(v-X+1).join(d):"";y&&m&&(S=t(J+S,J.length?v-D.length:Infinity),J="");switch(h){case"<":S=T+S+D+J;break;case"=":S=T+J+S+D;break;case"^":S=J.slice(0,X=J.length>>1)+T+S+D+J.slice(X);break;default:S=J+T+S+D;break}return a(S)}return O.toString=function(){return f+""},O}function c(f,d){var h=u((f=Ds(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor($s(d)/3)))*3,g=Math.pow(10,-p),m=t_[8+p/3];return function(v){return h(g*v)+m}}return{format:u,formatPrefix:c}}var Ed,kd,x0;P6({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function P6(e){return Ed=n_(e),kd=Ed.format,x0=Ed.formatPrefix,Ed}function i_(e){return Math.max(0,-$s(Math.abs(e)))}function r_(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor($s(t)/3)))*3-$s(Math.abs(e)))}function a_(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,$s(t)-$s(e))+1}function z6(e,t){return n=>{var i=e(n),r=i.indexOf(t),a,o;if(r<0)return i;for(a=B6(i,r),o=a<i.length?i.slice(a):"";--a>r;)if(i[a]!=="0"){++a;break}return i.slice(0,a)+o}}function B6(e,t){var n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function o_(e){const t=lu(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){var r=Ds(i||",");if(r.precision==null){r.precision=12;switch(r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return z6(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,a,o){o=Ds(o??",f");const s=ia(i,r,a),l=Math.max(Math.abs(i),Math.abs(r));let u;if(o.precision==null)switch(o.type){case"s":return isNaN(u=r_(s,l))||(o.precision=u),n(o,l);case"":case"e":case"g":case"p":case"r":{isNaN(u=a_(s,l))||(o.precision=u-(o.type==="e"));break}case"f":case"%":{isNaN(u=i_(s))||(o.precision=u-(o.type==="%")*2);break}}return t(o)}}}let E0;s_();function s_(){return E0=o_({format:kd,formatPrefix:x0})}function l_(e){return o_(n_(e))}function _d(e){return arguments.length?E0=l_(e):E0}const _t="year",hn="quarter",Ft="month",ot="week",pn="date",It="day",Ii="dayofyear",Nn="hours",Fn="minutes",qn="seconds",fi="milliseconds",k0=[_t,hn,Ft,ot,pn,It,Ii,Nn,Fn,qn,fi],_0=k0.reduce((e,t,n)=>(e[t]=1+n,e),{});function A0(e){const t=G(e).slice(),n={};t.length||N("Missing time unit."),t.forEach(r=>{Q(_0,r)?n[r]=1:N(`Invalid time unit: ${r}.`)});const i=(n[ot]||n[It]?1:0)+(n[hn]||n[Ft]||n[pn]?1:0)+(n[Ii]?1:0);return i>1&&N(`Incompatible time units: ${e}`),t.sort((r,a)=>_0[r]-_0[a]),t}const U6={[_t]:"%Y ",[hn]:"Q%q ",[Ft]:"%b ",[pn]:"%d ",[ot]:"W%U ",[It]:"%a ",[Ii]:"%j ",[Nn]:"%H:00",[Fn]:"00:%M",[qn]:":%S",[fi]:".%L",[`${_t}-${Ft}`]:"%Y-%m ",[`${_t}-${Ft}-${pn}`]:"%Y-%m-%d ",[`${Nn}-${Fn}`]:"%H:%M"};function u_(e,t){const n=fe({},U6,t),i=A0(e),r=i.length;let a="",o=0,s,l;for(o=0;o<r;)for(s=i.length;s>o;--s)if(l=i.slice(o,s).join("-"),n[l]!=null){a+=n[l],o=s;break}return a.trim()}var S0=new Date(),O0=new Date();function pt(e,t,n,i){function r(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return r.floor=function(a){return e(a=new Date(+a)),a},r.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},r.round=function(a){var o=r(a),s=r.ceil(a);return a-o<s-a?o:s},r.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},r.range=function(a,o,s){var l=[],u;if(a=r.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},r.filter=function(a){return pt(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(r.count=function(a,o){return S0.setTime(+a),O0.setTime(+o),e(S0),e(O0),Math.floor(n(S0,O0))},r.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?r.filter(i?function(o){return i(o)%a===0}:function(o){return r.count(0,o)%a===0}):r}),r}var Rs=pt(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});Rs.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?pt(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):Rs};var Ad=1e3,mo=6e4,Sd=36e5,c_=864e5,f_=6048e5,Od=pt(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Ad)},function(e,t){return(t-e)/Ad},function(e){return e.getUTCSeconds()}),d_=pt(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ad)},function(e,t){e.setTime(+e+t*mo)},function(e,t){return(t-e)/mo},function(e){return e.getMinutes()}),h_=pt(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ad-e.getMinutes()*mo)},function(e,t){e.setTime(+e+t*Sd)},function(e,t){return(t-e)/Sd},function(e){return e.getHours()}),vo=pt(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*mo)/c_},function(e){return e.getDate()-1});function yo(e){return pt(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*mo)/f_})}var Td=yo(0),T0=yo(1),dhe=yo(2),hhe=yo(3),C0=yo(4),phe=yo(5),ghe=yo(6),$0=pt(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),ra=pt(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});ra.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:pt(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var p_=pt(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*mo)},function(e,t){return(t-e)/mo},function(e){return e.getUTCMinutes()}),g_=pt(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Sd)},function(e,t){return(t-e)/Sd},function(e){return e.getUTCHours()}),bo=pt(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/c_},function(e){return e.getUTCDate()-1});function wo(e){return pt(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/f_})}var Cd=wo(0),D0=wo(1),mhe=wo(2),vhe=wo(3),R0=wo(4),yhe=wo(5),bhe=wo(6),N0=pt(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),aa=pt(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});aa.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:pt(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const xo=new Date();function F0(e){return xo.setFullYear(e),xo.setMonth(0),xo.setDate(1),xo.setHours(0,0,0,0),xo}function m_(e){return y_(new Date(e))}function v_(e){return I0(new Date(e))}function y_(e){return vo.count(F0(e.getFullYear())-1,e)}function I0(e){return Td.count(F0(e.getFullYear())-1,e)}function M0(e){return F0(e).getDay()}function q6(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,i,r,a,o);return s.setFullYear(e),s}return new Date(e,t,n,i,r,a,o)}function b_(e){return x_(new Date(e))}function w_(e){return j0(new Date(e))}function x_(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return bo.count(t-1,e)}function j0(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Cd.count(t-1,e)}function L0(e){return xo.setTime(Date.UTC(e,0,1)),xo.getUTCDay()}function W6(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,i,r,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,i,r,a,o))}function E_(e,t,n,i,r){const a=t||1,o=ve(e),s=(v,y,b)=>(b=b||v,G6(n[b],i[b],v===o&&a,y)),l=new Date(),u=kt(e),c=u[_t]?s(_t):Vt(2012),f=u[Ft]?s(Ft):u[hn]?s(hn):oo,d=u[ot]&&u[It]?s(It,1,ot+It):u[ot]?s(ot,1):u[It]?s(It,1):u[pn]?s(pn,1):u[Ii]?s(Ii,1):iu,h=u[Nn]?s(Nn):oo,p=u[Fn]?s(Fn):oo,g=u[qn]?s(qn):oo,m=u[fi]?s(fi):oo;return function(v){l.setTime(+v);const y=c(l);return r(y,f(l),d(l,y),h(l),p(l),g(l),m(l))}}function G6(e,t,n,i){const r=n<=1?e:i?(a,o)=>i+n*Math.floor((e(a,o)-i)/n):(a,o)=>n*Math.floor(e(a,o)/n);return t?(a,o)=>t(r(a,o),o):r}function Ns(e,t,n){return t+e*7-(n+6)%7}const H6={[_t]:e=>e.getFullYear(),[hn]:e=>Math.floor(e.getMonth()/3),[Ft]:e=>e.getMonth(),[pn]:e=>e.getDate(),[Nn]:e=>e.getHours(),[Fn]:e=>e.getMinutes(),[qn]:e=>e.getSeconds(),[fi]:e=>e.getMilliseconds(),[Ii]:e=>y_(e),[ot]:e=>I0(e),[ot+It]:(e,t)=>Ns(I0(e),e.getDay(),M0(t)),[It]:(e,t)=>Ns(1,e.getDay(),M0(t))},Y6={[hn]:e=>3*e,[ot]:(e,t)=>Ns(e,0,M0(t))};function k_(e,t){return E_(e,t||1,H6,Y6,q6)}const V6={[_t]:e=>e.getUTCFullYear(),[hn]:e=>Math.floor(e.getUTCMonth()/3),[Ft]:e=>e.getUTCMonth(),[pn]:e=>e.getUTCDate(),[Nn]:e=>e.getUTCHours(),[Fn]:e=>e.getUTCMinutes(),[qn]:e=>e.getUTCSeconds(),[fi]:e=>e.getUTCMilliseconds(),[Ii]:e=>x_(e),[ot]:e=>j0(e),[It]:(e,t)=>Ns(1,e.getUTCDay(),L0(t)),[ot+It]:(e,t)=>Ns(j0(e),e.getUTCDay(),L0(t))},X6={[hn]:e=>3*e,[ot]:(e,t)=>Ns(e,0,L0(t))};function __(e,t){return E_(e,t||1,V6,X6,W6)}const J6={[_t]:ra,[hn]:$0.every(3),[Ft]:$0,[ot]:Td,[pn]:vo,[It]:vo,[Ii]:vo,[Nn]:h_,[Fn]:d_,[qn]:Od,[fi]:Rs},K6={[_t]:aa,[hn]:N0.every(3),[Ft]:N0,[ot]:Cd,[pn]:bo,[It]:bo,[Ii]:bo,[Nn]:g_,[Fn]:p_,[qn]:Od,[fi]:Rs};function Fs(e){return J6[e]}function Is(e){return K6[e]}function A_(e,t,n){return e?e.offset(t,n):void 0}function S_(e,t,n){return A_(Fs(e),t,n)}function O_(e,t,n){return A_(Is(e),t,n)}function T_(e,t,n,i){return e?e.range(t,n,i):void 0}function C_(e,t,n,i){return T_(Fs(e),t,n,i)}function $_(e,t,n,i){return T_(Is(e),t,n,i)}const cu=1e3,fu=cu*60,du=fu*60,$d=du*24,Q6=$d*7,D_=$d*30,P0=$d*365,R_=[_t,Ft,pn,Nn,Fn,qn,fi],hu=R_.slice(0,-1),pu=hu.slice(0,-1),gu=pu.slice(0,-1),Z6=gu.slice(0,-1),e4=[_t,ot],N_=[_t,Ft],F_=[_t],mu=[[hu,1,cu],[hu,5,5*cu],[hu,15,15*cu],[hu,30,30*cu],[pu,1,fu],[pu,5,5*fu],[pu,15,15*fu],[pu,30,30*fu],[gu,1,du],[gu,3,3*du],[gu,6,6*du],[gu,12,12*du],[Z6,1,$d],[e4,1,Q6],[N_,1,D_],[N_,3,3*D_],[F_,1,P0]];function I_(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(ud(t))/n;let r=yd(s=>s[2]).right(mu,i),a,o;return r===mu.length?(a=F_,o=ia(t[0]/P0,t[1]/P0,n)):r?(r=mu[i/mu[r-1][2]<mu[r][2]/i?r-1:r],a=r[0],o=r[1]):(a=R_,o=Math.max(ia(t[0],t[1],n),1)),{units:a,step:o}}function z0(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function B0(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vu(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function M_(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=yu(r),c=bu(r),f=yu(a),d=bu(a),h=yu(o),p=bu(o),g=yu(s),m=bu(s),v=yu(l),y=bu(l),b={a:W,A:X,b:J,B:xe,c:null,d:z_,e:z_,f:A4,H:E4,I:k4,j:_4,L:B_,m:S4,M:O4,p:Pe,q:dt,Q:G_,s:H_,S:T4,u:C4,U:$4,V:D4,w:R4,W:N4,x:null,X:null,y:F4,Y:I4,Z:M4,"%":W_},E={a:ht,A:Ke,b:Rt,B:ui,c:null,d:U_,e:U_,f:z4,H:j4,I:L4,j:P4,L:q_,m:B4,M:U4,p:Ka,q:Jr,Q:G_,s:H_,S:q4,u:W4,U:G4,V:H4,w:Y4,W:V4,x:null,X:null,y:X4,Y:J4,Z:K4,"%":W_},x={a:O,A:S,b:T,B:D,c:M,d:L_,e:L_,f:y4,H:P_,I:P_,j:p4,L:v4,m:h4,M:g4,p:_,q:d4,Q:w4,s:x4,S:m4,u:a4,U:o4,V:s4,w:r4,W:l4,x:C,X:F,y:c4,Y:u4,Z:f4,"%":b4};b.x=k(n,b),b.X=k(i,b),b.c=k(t,b),E.x=k(n,E),E.X=k(i,E),E.c=k(t,E);function k(H,ue){return function(me){var L=[],un=-1,Ie=0,Tn=H.length,Cn,Qa,xE;for(me instanceof Date||(me=new Date(+me));++un<Tn;)H.charCodeAt(un)===37&&(L.push(H.slice(Ie,un)),(Qa=j_[Cn=H.charAt(++un)])!=null?Cn=H.charAt(++un):Qa=Cn==="e"?" ":"0",(xE=ue[Cn])&&(Cn=xE(me,Qa)),L.push(Cn),Ie=un+1);return L.push(H.slice(Ie,un)),L.join("")}}function w(H,ue){return function(me){var L=vu(1900,void 0,1),un=A(L,H,me+="",0),Ie,Tn;if(un!=me.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(ue&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(Ie=B0(vu(L.y,0,1)),Tn=Ie.getUTCDay(),Ie=Tn>4||Tn===0?D0.ceil(Ie):D0(Ie),Ie=bo.offset(Ie,(L.V-1)*7),L.y=Ie.getUTCFullYear(),L.m=Ie.getUTCMonth(),L.d=Ie.getUTCDate()+(L.w+6)%7):(Ie=z0(vu(L.y,0,1)),Tn=Ie.getDay(),Ie=Tn>4||Tn===0?T0.ceil(Ie):T0(Ie),Ie=vo.offset(Ie,(L.V-1)*7),L.y=Ie.getFullYear(),L.m=Ie.getMonth(),L.d=Ie.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),Tn="Z"in L?B0(vu(L.y,0,1)).getUTCDay():z0(vu(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(Tn+5)%7:L.w+L.U*7-(Tn+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,B0(L)):z0(L)}}function A(H,ue,me,L){for(var un=0,Ie=ue.length,Tn=me.length,Cn,Qa;un<Ie;){if(L>=Tn)return-1;if(Cn=ue.charCodeAt(un++),Cn===37){if(Cn=ue.charAt(un++),Qa=x[Cn in j_?ue.charAt(un++):Cn],!Qa||(L=Qa(H,me,L))<0)return-1}else if(Cn!=me.charCodeAt(L++))return-1}return L}function _(H,ue,me){var L=u.exec(ue.slice(me));return L?(H.p=c[L[0].toLowerCase()],me+L[0].length):-1}function O(H,ue,me){var L=h.exec(ue.slice(me));return L?(H.w=p[L[0].toLowerCase()],me+L[0].length):-1}function S(H,ue,me){var L=f.exec(ue.slice(me));return L?(H.w=d[L[0].toLowerCase()],me+L[0].length):-1}function T(H,ue,me){var L=v.exec(ue.slice(me));return L?(H.m=y[L[0].toLowerCase()],me+L[0].length):-1}function D(H,ue,me){var L=g.exec(ue.slice(me));return L?(H.m=m[L[0].toLowerCase()],me+L[0].length):-1}function M(H,ue,me){return A(H,t,ue,me)}function C(H,ue,me){return A(H,n,ue,me)}function F(H,ue,me){return A(H,i,ue,me)}function W(H){return o[H.getDay()]}function X(H){return a[H.getDay()]}function J(H){return l[H.getMonth()]}function xe(H){return s[H.getMonth()]}function Pe(H){return r[+(H.getHours()>=12)]}function dt(H){return 1+~~(H.getMonth()/3)}function ht(H){return o[H.getUTCDay()]}function Ke(H){return a[H.getUTCDay()]}function Rt(H){return l[H.getUTCMonth()]}function ui(H){return s[H.getUTCMonth()]}function Ka(H){return r[+(H.getUTCHours()>=12)]}function Jr(H){return 1+~~(H.getUTCMonth()/3)}return{format:function(H){var ue=k(H+="",b);return ue.toString=function(){return H},ue},parse:function(H){var ue=w(H+="",!1);return ue.toString=function(){return H},ue},utcFormat:function(H){var ue=k(H+="",E);return ue.toString=function(){return H},ue},utcParse:function(H){var ue=w(H+="",!0);return ue.toString=function(){return H},ue}}}var j_={"-":"",_:" ","0":"0"},gt=/^\s*\d+/,t4=/^%/,n4=/[\\^$*+?|[\]().{}]/g;function Ce(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function i4(e){return e.replace(n4,"\\$&")}function yu(e){return new RegExp("^(?:"+e.map(i4).join("|")+")","i")}function bu(e){for(var t={},n=-1,i=e.length;++n<i;)t[e[n].toLowerCase()]=n;return t}function r4(e,t,n){var i=gt.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function a4(e,t,n){var i=gt.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function o4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function s4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function l4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function u4(e,t,n){var i=gt.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function c4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function f4(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function d4(e,t,n){var i=gt.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function h4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function L_(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function p4(e,t,n){var i=gt.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function P_(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function g4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function m4(e,t,n){var i=gt.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function v4(e,t,n){var i=gt.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function y4(e,t,n){var i=gt.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function b4(e,t,n){var i=t4.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function w4(e,t,n){var i=gt.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function x4(e,t,n){var i=gt.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function z_(e,t){return Ce(e.getDate(),t,2)}function E4(e,t){return Ce(e.getHours(),t,2)}function k4(e,t){return Ce(e.getHours()%12||12,t,2)}function _4(e,t){return Ce(1+vo.count(ra(e),e),t,3)}function B_(e,t){return Ce(e.getMilliseconds(),t,3)}function A4(e,t){return B_(e,t)+"000"}function S4(e,t){return Ce(e.getMonth()+1,t,2)}function O4(e,t){return Ce(e.getMinutes(),t,2)}function T4(e,t){return Ce(e.getSeconds(),t,2)}function C4(e){var t=e.getDay();return t===0?7:t}function $4(e,t){return Ce(Td.count(ra(e)-1,e),t,2)}function D4(e,t){var n=e.getDay();return e=n>=4||n===0?C0(e):C0.ceil(e),Ce(C0.count(ra(e),e)+(ra(e).getDay()===4),t,2)}function R4(e){return e.getDay()}function N4(e,t){return Ce(T0.count(ra(e)-1,e),t,2)}function F4(e,t){return Ce(e.getFullYear()%100,t,2)}function I4(e,t){return Ce(e.getFullYear()%1e4,t,4)}function M4(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ce(t/60|0,"0",2)+Ce(t%60,"0",2)}function U_(e,t){return Ce(e.getUTCDate(),t,2)}function j4(e,t){return Ce(e.getUTCHours(),t,2)}function L4(e,t){return Ce(e.getUTCHours()%12||12,t,2)}function P4(e,t){return Ce(1+bo.count(aa(e),e),t,3)}function q_(e,t){return Ce(e.getUTCMilliseconds(),t,3)}function z4(e,t){return q_(e,t)+"000"}function B4(e,t){return Ce(e.getUTCMonth()+1,t,2)}function U4(e,t){return Ce(e.getUTCMinutes(),t,2)}function q4(e,t){return Ce(e.getUTCSeconds(),t,2)}function W4(e){var t=e.getUTCDay();return t===0?7:t}function G4(e,t){return Ce(Cd.count(aa(e)-1,e),t,2)}function H4(e,t){var n=e.getUTCDay();return e=n>=4||n===0?R0(e):R0.ceil(e),Ce(R0.count(aa(e),e)+(aa(e).getUTCDay()===4),t,2)}function Y4(e){return e.getUTCDay()}function V4(e,t){return Ce(D0.count(aa(e)-1,e),t,2)}function X4(e,t){return Ce(e.getUTCFullYear()%100,t,2)}function J4(e,t){return Ce(e.getUTCFullYear()%1e4,t,4)}function K4(){return"+0000"}function W_(){return"%"}function G_(e){return+e}function H_(e){return Math.floor(+e/1e3)}var Ms,U0,Y_,q0,V_;Q4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Q4(e){return Ms=M_(e),U0=Ms.format,Y_=Ms.parse,q0=Ms.utcFormat,V_=Ms.utcParse,Ms}function X_(e,t,n){n=n||{},K(n)||N(`Invalid time multi-format specifier: ${n}`);const i=t(qn),r=t(Fn),a=t(Nn),o=t(pn),s=t(ot),l=t(Ft),u=t(hn),c=t(_t),f=e(n[fi]||".%L"),d=e(n[qn]||":%S"),h=e(n[Fn]||"%I:%M"),p=e(n[Nn]||"%I %p"),g=e(n[pn]||n[It]||"%a %d"),m=e(n[ot]||"%b %d"),v=e(n[Ft]||"%B"),y=e(n[hn]||"%B"),b=e(n[_t]||"%Y");return E=>(i(E)<E?f:r(E)<E?d:a(E)<E?h:o(E)<E?p:l(E)<E?s(E)<E?g:m:c(E)<E?u(E)<E?v:y:b)(E)}function J_(e){const t=lu(e.format),n=lu(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):X_(t,Fs,i),utcFormat:i=>Y(i)?n(i):X_(n,Is,i),timeParse:lu(e.parse),utcParse:lu(e.utcParse)}}let W0;K_();function K_(){return W0=J_({format:U0,parse:Y_,utcFormat:q0,utcParse:V_})}function Q_(e){return J_(M_(e))}function wu(e){return arguments.length?W0=Q_(e):W0}const G0=(e,t)=>fe({},e,t);function Z_(e,t){const n=e?l_(e):_d(),i=t?Q_(t):wu();return G0(n,i)}function H0(e,t){const n=arguments.length;return n&&n!==2&&N("defaultLocale expects either zero or two arguments."),n?G0(_d(e),wu(t)):G0(_d(),wu())}function Z4(){return s_(),K_(),H0()}function eA(e,t,n,i){t=t||{};const r=p0(t.type||"json");return r||N("Unknown data format type: "+t.type),e=r(e,t),t.parse&&e8(e,t.parse,n,i),Q(e,"columns")&&delete e.columns,e}function e8(e,t,n,i){if(!e.length)return;const r=wu();n=n||r.timeParse,i=i||r.utcParse;var a=e.columns||Object.keys(e[0]),o,s,l,u,c,f,d;for(t==="auto"&&(t=Mk(e,a)),a=Object.keys(t),o=a.map(function(h){var p=t[h],g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:"))){g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1));const v=g[0]==="utc"?i:n;return v(m)}if(!l0[p])throw Error("Illegal format pattern: "+h+":"+p);return l0[p]}),u=0,f=e.length,d=a.length;u<f;++u)for(s=e[u],c=0;c<d;++c)l=a[c],s[l]=o[c](s[l])}var Dd=Q5(typeof fetch!="undefined"&&fetch,null);function t8(e,t){const n=this.locale();return eA(e,t,n.timeParse,n.utcParse)}function n8(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function i8(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:Gk(t&&t.type)});try{r=n.parse(r,t)}catch(a){i=-2,n.warn("Data ingestion failed",e,a)}}catch(a){i=-1,n.warn("Loading failed",e,a)}return{data:r,status:i}}async function r8(e,t,n){const i=this,r=i._pending||a8(i);r.requests+=1;const a=await i.request(t,n);return i.pulse(e,i.changeset().remove(Fi).insert(a.data||[])),r.done(),a}function a8(e){var t=new Promise(function(i){n=i}),n;return t.requests=0,t.done=function(){--t.requests===0&&(e._pending=null,n(e))},e._pending=t}var o8={skip:!0};function s8(e,t,n,i,r){var a=e instanceof Ne?u8:l8;return a(this,e,t,n,i,r),this}function l8(e,t,n,i,r,a){var o=fe({},a,o8),s,l;ge(n)||(n=Vt(n)),i===void 0?s=u=>e.touch(n(u)):ge(i)?(l=new Ne(null,i,r,!1),s=u=>{l.evaluate(u);const c=n(u),f=l.value;Rk(f)?e.pulse(c,f,a):e.update(c,f,o)}):s=u=>e.update(n(u),i,o),t.apply(s)}function u8(e,t,n,i,r,a){if(i===void 0)t.targets().add(n);else{const o=a||{},s=new Ne(null,c8(n,i),r,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function c8(e,t){return t=ge(t)?t:Vt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function f8(e){e.rank=++this._rank}function d8(e){for(var t=[e],n,i,r;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&N("Cycle detected in dataflow graph.")}const Rd={},Mi=1<<0,oa=1<<1,wr=1<<2,h8=Mi|oa,tA=Mi|wr,js=Mi|oa|wr,nA=1<<3,xu=1<<4,iA=1<<5,rA=1<<6;function sa(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}const ze=sa.prototype;ze.StopPropagation=Rd,ze.ADD=Mi,ze.REM=oa,ze.MOD=wr,ze.ADD_REM=h8,ze.ADD_MOD=tA,ze.ALL=js,ze.REFLOW=nA,ze.SOURCE=xu,ze.NO_SOURCE=iA,ze.NO_FIELDS=rA,ze.fork=function(e){return new sa(this.dataflow).init(this,e)},ze.clone=function(){const e=this.fork(js);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(js|xu)},ze.addAll=function(){let e=this;return!e.source||e.source.length===e.add.length||(e=new sa(this.dataflow).init(this),e.add=e.source),e},ze.init=function(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&rA)&&(n.fields=e.fields),t&Mi?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&oa?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&wr?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&iA?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},ze.runAfter=function(e){this.dataflow.runAfter(e)},ze.changed=function(e){var t=e||js;return t&Mi&&this.add.length||t&oa&&this.rem.length||t&wr&&this.mod.length},ze.reflow=function(e){if(e)return this.fork(js).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(wr,aA(this,Mi))),this},ze.clean=function(e){return arguments.length?(this.cleans=!!e,this):this.cleans},ze.modifies=function(e){var t=this.fields||(this.fields={});return I(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},ze.modified=function(e,t){var n=this.fields;return(t||this.mod.length)&&n?arguments.length?I(e)?e.some(i=>n[i]):n[e]:!!n:!1},ze.filter=function(e,t){var n=this;return e&Mi&&(n.addF=Nd(n.addF,t)),e&oa&&(n.remF=Nd(n.remF,t)),e&wr&&(n.modF=Nd(n.modF,t)),e&xu&&(n.srcF=Nd(n.srcF,t)),n};function Nd(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}ze.materialize=function(e){e=e||js;var t=this;return e&Mi&&t.addF&&(t.add=Y0(t.add,t.addF),t.addF=null),e&oa&&t.remF&&(t.rem=Y0(t.rem,t.remF),t.remF=null),e&wr&&t.modF&&(t.mod=Y0(t.mod,t.modF),t.modF=null),e&xu&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t};function Y0(e,t){var n=[];return co(e,t,i=>n.push(i)),n}function aA(e,t){var n={};return e.visit(t,function(i){n[ee(i)]=1}),i=>n[ee(i)]?null:i}ze.visit=function(e,t){var n=this,i=t,r,a;return e&xu?(co(n.source,n.srcF,i),n):(e&Mi&&co(n.add,n.addF,i),e&oa&&co(n.rem,n.remF,i),e&wr&&co(n.mod,n.modF,i),e&nA&&(r=n.source)&&(a=n.add.length+n.mod.length,a===r.length||(a?co(r,aA(n,tA),i):co(r,n.srcF,i))),n)};function V0(e,t,n,i){var r=this,a=0,o,s,l,u,c;for(this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n,l=0,u=n.length;l<u;++l){if(o=n[l],o.stamp!==t)continue;if(o.fields){s=r.fields||(r.fields={});for(c in o.fields)s[c]=1}o.changed(r.ADD)&&(a|=r.ADD),o.changed(r.REM)&&(a|=r.REM),o.changed(r.MOD)&&(a|=r.MOD)}this.changes=a}var Ls=P(V0,sa);Ls.fork=function(e){var t=new sa(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,function(n){return t.add.push(n)}),e&t.REM&&this.visit(t.REM,function(n){return t.rem.push(n)}),e&t.MOD&&this.visit(t.MOD,function(n){return t.mod.push(n)})),t},Ls.changed=function(e){return this.changes&e},Ls.modified=function(e){var t=this,n=t.fields;return n&&t.changes&t.MOD?I(e)?e.some(function(i){return n[i]}):n[e]:0},Ls.filter=function(){N("MultiPulse does not support filtering.")},Ls.materialize=function(){N("MultiPulse does not support materialization.")},Ls.visit=function(e,t){var n=this,i=n.pulses,r=i.length,a=0;if(e&n.SOURCE)for(;a<r;++a)i[a].visit(e,t);else for(;a<r;++a)i[a].stamp===n.stamp&&i[a].visit(e,t);return n};async function p8(e,t,n){const i=this,r=[];if(i._pulse)return oA(i);if(i._pending&&await i._pending,t&&await fd(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const a=++i._clock;i._pulse=new sa(i,a,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=cd(nd);let o=0,s,l,u;try{for(;i._heap.size()>0;){if(s=i._heap.pop(),s.rank!==s.qrank){i._enqueue(s,!0);continue}l=s.run(i._getPulse(s,e)),l.then?l=await l:l.async&&(r.push(l.async),l=Rd),l!==Rd&&(s._targets&&s._targets.forEach(c=>i._enqueue(c))),++o}}catch(c){i._heap.clear(),u=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${a}: ${o} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await fd(i,c[f].callback)}return n&&await fd(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function g8(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function m8(e,t,n){return this._pulse?oA(this):(this.evaluate(e,t,n),this)}function v8(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function oA(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function y8(e,t){var n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function b8(e,t){var n=e.source,i=this._clock;return n&&I(n)?new V0(this,i,n.map(r=>r.pulse),t):this._input[e.id]||w8(this._pulse,n&&n.pulse)}function w8(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Rd&&(e.source=t.source),e)}var X0={skip:!1,force:!1};function x8(e,t){var n=t||X0;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function E8(e,t,n){var i=n||X0;return(e.set(t)||i.force)&&this.touch(e,i),this}function k8(e,t,n){this.touch(e,n||X0);var i=new sa(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function _8(e){var t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),sA(t,0,t.length-1,e)),pop:()=>{var n=t.pop(),i;return t.length?(i=t[0],t[0]=n,A8(t,0,e)):i=n,i}}}function sA(e,t,n,i){var r,a,o;for(r=e[n];n>t;){if(o=n-1>>1,a=e[o],i(r,a)<0){e[n]=a,n=o;continue}break}return e[n]=r}function A8(e,t,n){for(var i=t,r=e.length,a=e[t],o=(t<<1)+1,s;o<r;)s=o+1,s<r&&n(e[o],e[s])>=0&&(o=s),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=a,sA(e,i,t,n)}function Ps(){this.logger(hk()),this.logLevel(fk),this._clock=0,this._rank=0,this._locale=H0();try{this._loader=Dd()}catch(e){}this._touched=cd(nd),this._input={},this._pulse=null,this._heap=_8((e,t)=>e.qrank-t.qrank),this._postrun=[]}var Ae=Ps.prototype;Ae.stamp=function(){return this._clock},Ae.loader=function(e){return arguments.length?(this._loader=e,this):this._loader},Ae.locale=function(e){return arguments.length?(this._locale=e,this):this._locale},Ae.cleanThreshold=1e4,Ae.add=G5,Ae.connect=H5,Ae.rank=f8,Ae.rerank=d8,Ae.pulse=k8,Ae.touch=x8,Ae.update=E8,Ae.changeset=ho,Ae.ingest=n8,Ae.parse=t8,Ae.preload=r8,Ae.request=i8,Ae.events=V5,Ae.on=s8,Ae.evaluate=p8,Ae.run=m8,Ae.runAsync=g8,Ae.runAfter=v8,Ae._enqueue=y8,Ae._getPulse=b8;function Eu(e){return function(){return this._log[e].apply(this,arguments)}}Ae.logger=function(e){return arguments.length?(this._log=e,this):this._log},Ae.error=Eu("error"),Ae.warn=Eu("warn"),Ae.info=Eu("info"),Ae.debug=Eu("debug"),Ae.logLevel=Eu("level");function $(e,t){Ne.call(this,e,null,t)}var J0=P($,Ne);J0.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},J0.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},J0.transform=function(){};var zs={};function lA(e){var t=uA(e);return t&&t.Definition||null}function uA(e){return e=e&&e.toLowerCase(),Q(zs,e)?zs[e]:null}function S8(e){return function(t){for(var n=e.length,i=1,r=String(e[0](t));i<n;++i)r+="|"+e[i](t);return r}}function K0(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:S8(e)}function cA(e,t,n){return n||e+(t?"_"+t:"")}const Q0=()=>{},O8={init:Q0,add:Q0,rem:Q0,idx:0},ku={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},_u=Object.keys(ku);function T8(e,t){return n=>fe({name:e,out:n||e},O8,t)}_u.forEach(e=>{ku[e]=T8(e,ku[e])});function fA(e,t){return ku[e](t)}function dA(e,t){return e.idx-t.idx}function C8(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{if(!i.req)return;i.req.forEach(r=>{t[r]||n(t[r]=ku[r]())})};return e.forEach(n),Object.values(t).sort(dA)}function $8(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function D8(e,t){if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid,this._ops.forEach(n=>n.add(this,e,t))}function R8(e,t){if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid,this._ops.forEach(n=>n.rem(this,e,t))}function N8(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function hA(e,t){var n=t||Yt,i=C8(e),r=e.slice().sort(dA);function a(o){this._ops=i,this._out=r,this.cell=o,this.init()}return a.prototype.init=$8,a.prototype.add=D8,a.prototype.rem=R8,a.prototype.set=N8,a.prototype.get=n,a.fields=e.map(o=>o.out),a}function*pA(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function Z0(e,t,n){var i=Float64Array.from(pA(e,n));return i.sort(Cs),t.map(r=>D6(i,r))}function ev(e,t){return Z0(e,[.25,.5,.75],t)}function tv(e,t){var n=e.length,i=T6(e,t),r=ev(e,t),a=(r[2]-r[0])/1.34;return i=Math.min(i,a)||i||Math.abs(r[0])||1,1.06*i*Math.pow(n,-.2)}function gA(e){var t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2],a=e.extent[0],o=e.extent[1],s=e.span||o-a||Math.abs(a)||1,l,u,c,f,d,h,p,g;if(e.step)l=e.step;else if(e.steps){for(d=s/t,h=0,p=e.steps.length;h<p&&e.steps[h]<d;++h);l=e.steps[Math.max(0,h-1)]}else{for(u=Math.ceil(Math.log(t)/i),c=e.minstep||0,l=Math.max(c,Math.pow(n,Math.round(Math.log(s)/i)-u));Math.ceil(s/l)>t;)l*=n;for(h=0,p=r.length;h<p;++h)d=l/r[h],d>=c&&s/d<=t&&(l=d)}return d=Math.log(l),f=d>=0?0:~~(-d/i)+1,g=Math.pow(n,-f-1),(e.nice||e.nice===void 0)&&(d=Math.floor(a/l+g)*l,a=a<d?d-l:d,o=Math.ceil(o/l)*l),{start:a,stop:o===a?a+l:o,step:l}}var Wn=Math.random;function F8(e){Wn=e}function mA(e,t,n,i){if(!e.length)return[void 0,void 0];var r=Float64Array.from(pA(e,i)),a=r.length,o=t,s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=r[~~(Wn()*a)];c[u]=s/a}return c.sort(Cs),[wd(c,n/2),wd(c,1-n/2)]}function vA(e,t,n,i){i=i||(d=>d);let r=0,a=1,o=e.length,s=new Float64Array(o),l=i(e[0]),u=l,c=l+t,f;for(;a<o;++a){if(f=i(e[a]),f>=c){for(u=(l+u)/2;r<a;++r)s[r]=u;c=f+t,l=f}u=f}for(u=(l+u)/2;r<a;++r)s[r]=u;return n?I8(s,t+t/4):s}function I8(e,t){let n=e.length,i=0,r=1,a,o;for(;e[i]===e[r];)++r;for(;r<n;){for(a=r+1;e[r]===e[a];)++a;if(e[r]-e[r-1]<t){for(o=r+(i+a-r-r>>1);o<r;)e[o++]=e[r];for(;o>r;)e[o--]=e[i]}i=r,r=a}return e}function M8(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function j8(e,t){t==null&&(t=e,e=0);var n={},i,r,a;return n.min=function(o){return arguments.length?(i=o||0,a=r-i,n):i},n.max=function(o){return arguments.length?(r=o||0,a=r-i,n):r},n.sample=function(){return i+Math.floor(a*Wn())},n.pdf=function(o){return o===Math.floor(o)&&o>=i&&o<r?1/a:0},n.cdf=function(o){var s=Math.floor(o);return s<i?0:s>=r?1:(s-i+1)/a},n.icdf=function(o){return o>=0&&o<=1?i-1+Math.floor(o*a):NaN},n.min(e).max(t)}const yA=Math.sqrt(2*Math.PI),L8=Math.SQRT2;let Au=NaN;function Fd(e,t){e=e||0,t=t??1;let n=0,i=0,r,a;if(Au===Au)n=Au,Au=NaN;else{do n=Wn()*2-1,i=Wn()*2-1,r=n*n+i*i;while(r===0||r>1);a=Math.sqrt(-2*Math.log(r)/r),n*=a,Au=i*a}return e+n*t}function nv(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*yA)}function Id(e,t,n){t=t||0,n=n??1;let i,r=(e-t)/n,a=Math.abs(r);if(a>37)i=0;else{let o,s=Math.exp(-a*a/2);a<7.07106781186547?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,i=s*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,i=i/o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,i=s/o/2.506628274631)}return r>0?1-i:i}function Md(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*L8*P8(2*e-1)}function P8(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=Infinity,n*e}function iv(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>Fd(n,i),pdf:a=>nv(a,n,i),cdf:a=>Id(a,n,i),icdf:a=>Md(a,n,i)};return r.mean(e).stdev(t)}function rv(e,t){var n=iv(),i={},r=0;return i.data=function(a){return arguments.length?(e=a,r=a?a.length:0,i.bandwidth(t)):e},i.bandwidth=function(a){return arguments.length?(t=a,!t&&e&&(t=tv(e)),i):t},i.sample=function(){return e[~~(Wn()*r)]+t*n.sample()},i.pdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.pdf((a-e[s])/t);return o/t/r},i.cdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.cdf((a-e[s])/t);return o/r},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)}function av(e,t){return e=e||0,t=t??1,Math.exp(e+Fd()*t)}function ov(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*yA*e)}function sv(e,t,n){return Id(Math.log(e),t,n)}function lv(e,t,n){return Math.exp(Md(e,t,n))}function bA(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>av(n,i),pdf:a=>ov(a,n,i),cdf:a=>sv(a,n,i),icdf:a=>lv(a,n,i)};return r.mean(e).stdev(t)}function wA(e,t){var n={},i=0,r;function a(o){var s=[],l=0,u;for(u=0;u<i;++u)l+=s[u]=o[u]==null?1:+o[u];for(u=0;u<i;++u)s[u]/=l;return s}return n.weights=function(o){return arguments.length?(r=a(t=o||[]),n):t},n.distributions=function(o){return arguments.length?(o?(i=o.length,e=o):(i=0,e=[]),n.weights(t)):e},n.sample=function(){for(var o=Wn(),s=e[i-1],l=r[0],u=0;u<i-1;l+=r[++u])if(o<l){s=e[u];break}return s.sample()},n.pdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].pdf(o);return s},n.cdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].cdf(o);return s},n.icdf=function(){throw Error("Mixture icdf not supported.")},n.distributions(e).weights(t)}function uv(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Wn()}function cv(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function fv(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function dv(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function xA(e,t){var n,i,r={min:function(a){return arguments.length?(n=a||0,r):n},max:function(a){return arguments.length?(i=a??1,r):i},sample:()=>uv(n,i),pdf:a=>cv(a,n,i),cdf:a=>fv(a,n,i),icdf:a=>dv(a,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function Su(e,t,n,i){const r=i-e*e,a=Math.abs(r)<1e-24?0:(n-e*t)/r,o=t-a*e;return[o,a]}function jd(e,t,n,i){e=e.filter(h=>{let p=t(h),g=n(h);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),i&&e.sort((h,p)=>t(h)-t(p));const r=e.length,a=new Float64Array(r),o=new Float64Array(r);let s=0,l=0,u=0,c,f,d;for(d of e)a[s]=c=+t(d),o[s]=f=+n(d),++s,l+=(c-l)/s,u+=(f-u)/s;for(s=0;s<r;++s)a[s]-=l,o[s]-=u;return[a,o,l,u]}function Ou(e,t,n,i){let r=-1,a,o;for(let s of e)a=t(s),o=n(s),a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o&&i(a,o,++r)}function Bs(e,t,n,i,r){let a=0,o=0;return Ou(e,t,n,(s,l)=>{const u=l-r(s),c=l-i;a+=u*u,o+=c*c}),1-a/o}function hv(e,t,n){let i=0,r=0,a=0,o=0,s=0;Ou(e,t,n,(c,f)=>{++s,i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=Su(i,r,a,o),u=c=>l[0]+l[1]*c;return{coef:l,predict:u,rSquared:Bs(e,t,n,r,u)}}function EA(e,t,n){let i=0,r=0,a=0,o=0,s=0;Ou(e,t,n,(c,f)=>{++s,c=Math.log(c),i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=Su(i,r,a,o),u=c=>l[0]+l[1]*Math.log(c);return{coef:l,predict:u,rSquared:Bs(e,t,n,r,u)}}function kA(e,t,n){const[i,r,a,o]=jd(e,t,n);let s=0,l=0,u=0,c=0,f=0,d,h,p;Ou(e,t,n,(y,b)=>{d=i[f++],h=Math.log(b),p=d*b,s+=(b*h-s)/f,l+=(p-l)/f,u+=(p*h-u)/f,c+=(d*p-c)/f});const[g,m]=Su(l/o,s/o,u/o,c/o),v=y=>Math.exp(g+m*(y-a));return{coef:[Math.exp(g-m*a),m],predict:v,rSquared:Bs(e,t,n,o,v)}}function _A(e,t,n){let i=0,r=0,a=0,o=0,s=0,l=0;Ou(e,t,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++l,i+=(h-i)/l,r+=(p-r)/l,a+=(h*p-a)/l,o+=(h*h-o)/l,s+=(d-s)/l});const u=Su(i,r,a,o),c=f=>u[0]*Math.pow(f,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:Bs(e,t,n,s,c)}}function pv(e,t,n){const[i,r,a,o]=jd(e,t,n),s=i.length;let l=0,u=0,c=0,f=0,d=0,h,p,g,m;for(h=0;h<s;)p=i[h],g=r[h++],m=p*p,l+=(m-l)/h,u+=(m*p-u)/h,c+=(m*m-c)/h,f+=(p*g-f)/h,d+=(m*g-d)/h;const v=c-l*l,y=l*v-u*u,b=(d*l-f*u)/y,E=(f*v-d*u)/y,x=-b*l,k=w=>(w=w-a,b*w*w+E*w+x+o);return{coef:[x-E*a+b*a*a+o,E-2*b*a,b],predict:k,rSquared:Bs(e,t,n,o,k)}}function AA(e,t,n,i){if(i===1)return hv(e,t,n);if(i===2)return pv(e,t,n);const[r,a,o,s]=jd(e,t,n),l=r.length,u=[],c=[],f=i+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d)*a[p];for(u.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d+h);m[h]=g}c.push(m)}c.push(u);const v=B8(c),y=b=>{b-=o;let E=s+v[0]+v[1]*b+v[2]*b*b;for(d=3;d<f;++d)E+=v[d]*Math.pow(b,d);return E};return{coef:z8(f,v,-o,s),predict:y,rSquared:Bs(e,t,n,s,y)}}function z8(e,t,n,i){const r=Array(e);let a,o,s,l;for(a=0;a<e;++a)r[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,r[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,r[a-o]+=s*Math.pow(n,o)*l;return r[0]+=i,r}function B8(e){const t=e.length-1,n=[];let i,r,a,o,s;for(i=0;i<t;++i){for(o=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][o])&&(o=r);for(a=i;a<t+1;++a)s=e[a][i],e[a][i]=e[a][o],e[a][o]=s;for(r=i+1;r<t;++r)for(a=t;a>=i;a--)e[a][r]-=e[a][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(s=0,a=r+1;a<t;++a)s+=e[a][r]*n[a];n[r]=(e[t][r]-s)/e[r][r]}return n}const SA=2,OA=1e-12;function TA(e,t,n,i){const[r,a,o,s]=jd(e,t,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let h=-1;++h<=SA;){const p=[0,u-1];for(let m=0;m<l;++m){const v=r[m],y=p[0],b=p[1],E=v-r[y]>r[b]-v?y:b;let x=0,k=0,w=0,A=0,_=0,O=1/Math.abs(r[E]-v||1);for(let D=y;D<=b;++D){const M=r[D],C=a[D],F=U8(Math.abs(v-M)*O)*d[D],W=M*F;x+=F,k+=W,w+=C*F,A+=C*W,_+=M*W}const[S,T]=Su(k/x,w/x,A/x,_/x);c[m]=S+T*v,f[m]=Math.abs(a[m]-c[m]),q8(r,m+1,p)}if(h===SA)break;const g=Vk(f);if(Math.abs(g)<OA)break;for(let m=0,v,y;m<l;++m)v=f[m]/(6*g),d[m]=v>=1?OA:(y=1-v*v)*y}return W8(r,c,o,s)}function U8(e){return(e=1-e*e*e)*e*e}function q8(e,t,n){let i=e[t],r=n[0],a=n[1]+1;if(a>=e.length)return;for(;t>r&&e[a]-i<=i-e[r];)n[0]=++r,n[1]=a,++a}function W8(e,t,n,i){const r=e.length,a=[];let o=0,s=0,l=[],u;for(;o<r;++o)u=e[o]+n,l[0]===u?l[1]+=(t[o]-l[1])/++s:(s=0,l[1]+=i,l=[u,t[o]],a.push(l));return l[1]+=i,a}const G8=.1*Math.PI/180;function Ld(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=h=>[h,e(h)],a=t[0],o=t[1],s=o-a,l=s/i,u=[r(a)],c=[];if(n===i){for(let h=1;h<i;++h)u.push(r(a+h/n*s));return u.push(r(o)),u}else{c.push(r(o));for(let h=n;--h>0;)c.push(r(a+h/n*s))}let f=u[0],d=c[c.length-1];for(;d;){const h=r((f[0]+d[0])/2);h[0]-f[0]>=l&&H8(f,h,d)>G8?c.push(h):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function H8(e,t,n){const i=Math.atan2(n[1]-e[1],n[0]-e[0]),r=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(i-r)}function gv(e){this._key=e?Ni(e):ee,this.reset()}var At=gv.prototype;At.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},At.add=function(e){this._add.push(e)},At.rem=function(e){this._rem.push(e)},At.values=function(){if(this._get=null,this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,a=Array(i-r),o={},s,l,u;for(s=0;s<r;++s)o[n(t[s])]=1;for(s=0,l=0;s<i;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},At.distinct=function(e){for(var t=this.values(),n=t.length,i={},r=0,a;--n>=0;)a=e(t[n])+"",Q(i,a)||(i[a]=1,++r);return r},At.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=T5(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},At.argmin=function(e){return this.extent(e)[0]||{}},At.argmax=function(e){return this.extent(e)[1]||{}},At.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):void 0},At.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):void 0},At.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=ev(this.values(),e),this._get=e),this._q},At.q1=function(e){return this.quartile(e)[0]},At.q2=function(e){return this.quartile(e)[1]},At.q3=function(e){return this.quartile(e)[2]},At.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=mA(this.values(),1e3,.05,e),this._get=e),this._ci},At.ci0=function(e){return this.ci(e)[0]},At.ci1=function(e){return this.ci(e)[1]};function Eo(e){$.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Eo.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:_u},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Gn=P(Eo,$);Gn.transform=function(e,t){var n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(n.value=n.value||n.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},Gn.cross=function(){var e=this,t=e.value,n=e._dnames,i=n.map(function(){return{}}),r=n.length;function a(s){var l,u,c,f;for(l in s)for(c=s[l].tuple,u=0;u<r;++u)i[u][f=c[n[u]]]=f}a(e._prev),a(t);function o(s,l,u){var c=n[u],f=i[u++],d,h;for(d in f)l[c]=f[d],h=s?s+"|"+d:d,u<r?o(h,l,u):t[h]||e.cell(h,l)}o("",{},0)},Gn.init=function(e){var t=this._inputs=[],n=this._outputs=[],i={};function r(m){for(var v=G(Ht(m)),y=0,b=v.length,E;y<b;++y)i[E=v[y]]||(i[E]=1,t.push(E))}this._dims=G(e.groupby),this._dnames=this._dims.map(function(m){var v=et(m);return r(m),n.push(v),v}),this.cellkey=e.key?e.key:K0(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={},c,f,d,h,p,g;for(l!==o.length&&N("Unmatched number of fields and aggregate ops."),g=0;g<l;++g){if(c=a[g],f=o[g],c==null&&f!=="count"&&N("Null aggregate field specified."),h=et(c),p=cA(f,h,s[g]),n.push(p),f==="count"){this._counts.push(p);continue}d=u[h],d||(r(c),d=u[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(fA(f,p))}return this._measures=this._measures.map(function(m){return hA(m,m.field)}),{}},Gn.cellkey=K0(),Gn.cell=function(e,t){var n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},Gn.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var i=this._measures,r=i.length,a;for(n.agg=Array(r),a=0;a<r;++a)n.agg[a]=new i[a](n)}return n.store&&(n.data=new gv()),n},Gn.newtuple=function(e,t){var n=this._dnames,i=this._dims,r={},a,o;for(a=0,o=i.length;a<o;++a)r[n[a]]=i[a](e);return t?Dk(t.tuple,r):ke(r)},Gn.clean=function(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},Gn.add=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num+=1,this._countOnly)return;for(n.store&&n.data.add(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].add(i[r].get(e),e)},Gn.rem=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num-=1,this._countOnly)return;for(n.store&&n.data.rem(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].rem(i[r].get(e),e)},Gn.celltuple=function(e){var t=e.tuple,n=this._counts,i,r,a;for(e.store&&e.data.values(),r=0,a=n.length;r<a;++r)t[n[r]]=e.num;if(!this._countOnly)for(i=e.agg,r=0,a=i.length;r<a;++r)i[r].set(t);return t},Gn.changes=function(e){var t=this._adds,n=this._mods,i=this._prev,r=this._drop,a=e.add,o=e.rem,s=e.mod,l,u,c,f;if(i)for(u in i)l=i[u],(!r||l.num)&&o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(l.num===0&&r?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e};const Y8=1e-14;function mv(e){$.call(this,null,e)}mv.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var CA=P(mv,$);CA.transform=function(e,t){var n=e.interval!==!1,i=this._bins(e),r=i.start,a=i.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1],u;return e.modified()?(t=t.reflow(!0),u=t.SOURCE):u=t.modified(Ht(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?function(c){var f=i(c);c[s]=f,c[l]=f==null?null:r+a*(1+(f-r)/a)}:function(c){c[s]=i(c)}),t.modifies(n?o:s)},CA._bins=function(e){if(this.value&&!e.modified())return this.value;var t=e.field,n=gA(e),i=n.step,r=n.start,a=r+Math.ceil((n.stop-r)/i)*i,o,s;(o=e.anchor)!=null&&(s=o-(r+i*Math.floor((o-r)/i)),r+=s,a+=s);var l=function(u){var c=fn(t(u));return c==null?null:c<r?-Infinity:c>a?Infinity:(c=Math.max(r,Math.min(c,a-i)),r+i*Math.floor(Y8+(c-r)/i))};return l.start=r,l.stop=n.stop,l.step=i,this.value=Rn(l,Ht(t),e.name||"bin_"+et(t))};function $A(e,t,n){var i=e,r=t||[],a=n||[],o={},s=0;return{add:function(l){a.push(l)},remove:function(l){o[i(l)]=++s},size:function(){return r.length},data:function(l,u){return s&&(r=r.filter(function(c){return!o[i(c)]}),o={},s=0),u&&l&&r.sort(l),a.length&&(r=l?I5(l,r,a.sort(l)):r.concat(a),a=[]),r}}}function vv(e){$.call(this,[],e)}vv.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};var V8=P(vv,$);V8.transform=function(e,t){var n=t.fork(t.ALL),i=$A(ee,this.value,n.materialize(n.ADD).add),r=e.sort,a=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(fo(r),a),t.source&&t.source.root&&(this.value.root=t.source.root),n};function DA(e){Ne.call(this,null,X8,e)}P(DA,Ne);function X8(e){return this.value&&!e.modified()?this.value:Ek(e.fields,e.orders)}function yv(e){$.call(this,null,e)}yv.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function J8(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}var bv=P(yv,$);bv.transform=function(e,t){function n(f){return function(d){for(var h=J8(s(d),e.case,a)||[],p,g=0,m=h.length;g<m;++g)o.test(p=h[g])||f(p)}}var i=this._parameterCheck(e,t),r=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(function(f){r[f]=1+(r[f]||0)}),c=n(function(f){r[f]-=1});return i?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},bv._parameterCheck=function(e,t){var n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},bv._finish=function(e,t){var n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS),s,l,u;for(s in n)l=i[s],u=n[s]||0,!l&&u?(i[s]=l=ke({}),l[r]=s,l[a]=u,o.add.push(l)):u===0?(l&&o.rem.push(l),n[s]=null,i[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)};function wv(e){$.call(this,null,e)}wv.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};var K8=P(wv,$);K8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=this.value,r=e.as||["a","b"],a=r[0],o=r[1],s=!i||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");return s?(i&&(n.rem=i),i=t.materialize(t.SOURCE).source,n.add=this.value=Q8(i,a,o,e.filter||Fi)):n.mod=i,n.source=this.value,n.modifies(r)};function Q8(e,t,n,i){for(var r=[],a={},o=e.length,s=0,l,u;s<o;++s)for(a[t]=u=e[s],l=0;l<o;++l)a[n]=e[l],i(a)&&(r.push(ke(a)),a={},a[t]=u);return r}var RA={kde:rv,mixture:wA,normal:iv,lognormal:bA,uniform:xA},Z8="distributions",NA="function",e9="field";function FA(e,t){var n=e[NA];Q(RA,n)||N("Unknown distribution function: "+n);var i=RA[n]();for(var r in e)r===e9?i.data((e.from||t()).map(e[r])):r===Z8?i[r](e[r].map(function(a){return FA(a,t)})):typeof i[r]===NA&&i[r](e[r]);return i}function xv(e){$.call(this,null,e)}var IA=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],t9={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:IA},{name:"weights",type:"number",array:!0}]};xv.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:IA.concat(t9)},{name:"as",type:"string",array:!0,default:["value","density"]}]};var n9=P(xv,$);n9.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var i=FA(e.distribution,i9(t)),r=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200,o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&N("Invalid density method: "+o),!e.extent&&!i.data&&N("Missing density extent parameter."),o=i[o];var s=e.as||["value","density"],l=e.extent||yr(i.data()),u=Ld(o,l,r,a).map(c=>{var f={};return f[s[0]]=c[0],f[s[1]]=c[1],ke(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function i9(e){return function(){return e.materialize(e.SOURCE).source}}function MA(e,t){return e?e.map(function(n,i){return t[i]||et(n)}):null}function Ev(e,t,n){var i=[],r=function(f){return f(l)},a,o,s,l,u,c;if(t==null)i.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(r),c=a[u],c||(a[u]=c=[],c.dims=u,i.push(c)),c.push(n(l));return i}const jA="bin";function kv(e){$.call(this,null,e)}kv.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:jA}]};const r9=P(kv,$);r9.transform=function(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=Ev(t.source,e.groupby,Yt),r=e.smooth||!1,a=e.field,o=e.step||a9(n,a),s=fo((p,g)=>a(p)-a(g)),l=e.as||jA,u=i.length;let c=Infinity,f=-Infinity,d=0,h;for(;d<u;++d){const p=i[d].sort(s);h=-1;for(const g of vA(p,o,r,a))g<c&&(c=g),g>f&&(f=g),p[++h][l]=g}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(l)};function a9(e,t){return ud(yr(e,t))/30}function LA(e){Ne.call(this,null,o9,e),this.modified(!0)}P(LA,Ne);function o9(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:Rn(n=>t(n,e),Ht(t),et(t))}function _v(e){$.call(this,[void 0,void 0],e)}_v.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};var s9=P(_v,$);s9.transform=function(e,t){var n=this.value,i=e.field,r=n[0],a=n[1],o;if(o=t.changed()||t.modified(i.fields)||e.modified("field"),(o||r==null)&&(r=Infinity,a=-Infinity),t.visit(o?t.SOURCE:t.ADD,function(s){var l=fn(i(s));l!=null&&(l<r&&(r=l),l>a&&(a=l))}),!Number.isFinite(r)||!Number.isFinite(a)){let s=et(i);s&&(s=` for field "${s}"`),t.dataflow.warn(`Infinite extent${s}: [${r}, ${a}]`),r=a=void 0}this.value=[r,a]};function Av(e,t){Ne.call(this,e),this.parent=t,this.count=0}var Us=P(Av,Ne);Us.connect=function(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},Us.add=function(e){this.count+=1,this.value.add.push(e)},Us.rem=function(e){this.count-=1,this.value.rem.push(e)},Us.mod=function(e){this.value.mod.push(e)},Us.init=function(e){this.value.init(e,e.NO_SOURCE)},Us.evaluate=function(){return this.value};function Pd(e){$.call(this,{},e),this._keys=au();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}const Tu=P(Pd,$);Tu.activate=function(e){this._targets[this._targets.active++]=e},Tu.subflow=function(e,t,n,i){let r=this.value,a=Q(r,e)&&r[e],o,s;return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=i||(s=this._group[e])&&s.tuple,o=n.dataflow,a=new Av(n.fork(n.NO_SOURCE),this),o.add(a).connect(t(o,e,s)),r[e]=a,this.activate(a)),a},Tu.clean=function(){const e=this.value;for(const t in e)if(e[t].count===0){const n=e[t].detachSubflow;n&&n(),delete e[t]}},Tu.initTargets=function(){const e=this._targets,t=e.length;for(let n=0;n<t&&e[n]!=null;++n)e[n]=null;e.active=0},Tu.transform=function(e,t){const n=t.dataflow,i=e.key,r=e.subflow,a=this._keys,o=e.modified("key"),s=l=>this.subflow(l,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,l=>{const u=ee(l),c=a.get(u);c!==void 0&&(a.delete(u),s(c).rem(l))}),t.visit(t.ADD,l=>{const u=i(l);a.set(ee(l),u),s(u).add(l)}),o||t.modified(i.fields)?t.visit(t.MOD,l=>{const u=ee(l),c=a.get(u),f=i(l);c===f?s(f).mod(l):(a.set(u,f),s(c).rem(l),s(f).add(l))}):t.changed(t.MOD)&&t.visit(t.MOD,l=>{s(a.get(ee(l))).mod(l)}),o&&t.visit(t.REFLOW,l=>{const u=ee(l),c=a.get(u),f=i(l);c!==f&&(a.set(u,f),s(c).rem(l),s(f).add(l))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t};function PA(e){Ne.call(this,null,l9,e)}P(PA,Ne);function l9(e){return this.value&&!e.modified()?this.value:I(e.name)?G(e.name).map(function(t){return Ni(t)}):Ni(e.name,e.as)}function Sv(e){$.call(this,au(),e)}Sv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};var u9=P(Sv,$);u9.transform=function(e,t){var n=t.dataflow,i=this.value,r=t.fork(),a=r.add,o=r.rem,s=r.mod,l=e.expr,u=!0;t.visit(t.REM,function(f){var d=ee(f);i.has(d)?i.delete(d):o.push(f)}),t.visit(t.ADD,function(f){l(f,e)?a.push(f):i.set(ee(f),1)});function c(f){var d=ee(f),h=l(f,e),p=i.get(d);h&&p?(i.delete(d),a.push(f)):!h&&!p?(i.set(d,1),o.push(f)):u&&h&&!p&&s.push(f)}return t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r};function Ov(e){$.call(this,[],e)}Ov.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};var c9=P(Ov,$);c9.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=MA(i,e.as||[]),a=e.index||null,o=r.length;return n.rem=this.value,t.visit(t.SOURCE,function(s){for(var l=i.map(p=>p(s)),u=l.reduce((p,g)=>Math.max(p,g.length),0),c=0,f,d,h;c<u;++c){for(d=a0(s),f=0;f<o;++f)d[r[f]]=(h=l[f][c])==null?null:h;a&&(d[a]=c),n.add.push(d)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)};function Tv(e){$.call(this,[],e)}Tv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};var f9=P(Tv,$);f9.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(et),a=e.as||["key","value"],o=a[0],s=a[1],l=i.length;return n.rem=this.value,t.visit(t.SOURCE,function(u){for(var c=0,f;c<l;++c)f=a0(u),f[o]=r[c],f[s]=i[c](u),n.add.push(f)}),this.value=n.source=n.add,n.modifies(a)};function Cv(e){$.call(this,null,e)}Cv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};var d9=P(Cv,$);d9.transform=function(e,t){var n=e.expr,i=e.as,r=e.modified(),a=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(a,o=>o[i]=n(o,e))};function zA(e){$.call(this,[],e)}var h9=P(zA,$);h9.transform=function(e,t){var n=this.value,i=t.fork(t.ALL),r=e.size-n.length,a=e.generator,o,s,l;if(r>0){for(o=[];--r>=0;)o.push(l=ke(a(e))),n.push(l);i.add=i.add.length?i.materialize(i.ADD).add.concat(o):o}else s=n.slice(0,-r),i.rem=i.rem.length?i.materialize(i.REM).rem.concat(s):s,n=n.slice(-r);return i.source=this.value=n,i};var zd={value:"value",median:Vk,mean:R6,min:b0,max:go},p9=[];function $v(e){$.call(this,[],e)}$v.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var g9=P($v,$);function m9(e){var t=e.method||zd.value,n;if(zd[t]==null)N("Unrecognized imputation method: "+t);else return t===zd.value?(n=e.value!==void 0?e.value:0,function(){return n}):zd[t]}function v9(e){var t=e.field;return function(n){return n?t(n):NaN}}g9.transform=function(e,t){var n=t.fork(t.ALL),i=m9(e),r=v9(e),a=et(e.field),o=et(e.key),s=(e.groupby||[]).map(et),l=y9(t.source,e.groupby,e.key,e.keyvals),u=[],c=this.value,f=l.domain.length,d,h,p,g,m,v,y,b,E,x;for(m=0,b=l.length;m<b;++m)for(d=l[m],p=d.values,h=NaN,y=0;y<f;++y){if(d[y]!=null)continue;for(g=l.domain[y],x={_impute:!0},v=0,E=p.length;v<E;++v)x[s[v]]=p[v];x[o]=g,x[a]=Number.isNaN(h)?h=i(d,r):h,u.push(ke(x))}return u.length&&(n.add=n.materialize(n.ADD).add.concat(u)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=u,n};function y9(e,t,n,i){var r=function(v){return v(m)},a=[],o=i?i.slice():[],s={},l={},u,c,f,d,h,p,g,m;for(o.forEach(function(v,y){s[v]=y+1}),d=0,g=e.length;d<g;++d)m=e[d],p=n(m),h=s[p]||(s[p]=o.push(p)),c=(u=t?t.map(r):p9)+"",(f=l[c])||(f=l[c]=[],a.push(f),f.values=u),f[h-1]=m;return a.domain=o,a}function Dv(e){Eo.call(this,e)}Dv.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:_u},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var BA=P(Dv,Eo);BA.transform=function(e,t){var n=this,i=e.modified(),r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,function(a){n.add(a)})):(r=n.value=n.value||this.init(e),t.visit(t.REM,function(a){n.rem(a)}),t.visit(t.ADD,function(a){n.add(a)})),n.changes(),t.visit(t.SOURCE,function(a){fe(a,r[n.cellkey(a)].tuple)}),t.reflow(i).modifies(this._outputs)},BA.changes=function(){var e=this._adds,t=this._mods,n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0};function Rv(e){$.call(this,null,e)}Rv.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};var b9=P(Rv,$);b9.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Ev(i,e.groupby,e.field),a=(e.groupby||[]).map(et),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;s!=="pdf"&&s!=="cdf"&&N("Invalid density method: "+s),e.resolve==="shared"&&(c||(c=yr(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const p=rv(h,o)[s],g=e.counts?h.length:1,m=c||yr(h);Ld(p,m,f,d).forEach(v=>{const y={};for(let b=0;b<a.length;++b)y[a[b]]=h.dims[b];y[l[0]]=v[0],y[l[1]]=v[1]*g,u.push(ke(y))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function UA(e){Ne.call(this,null,w9,e)}P(UA,Ne);function w9(e){return this.value&&!e.modified()?this.value:Ak(e.fields,e.flat)}function qA(e){$.call(this,[],e),this._pending=null}var x9=P(qA,$);x9.transform=function(e,t){const n=t.dataflow;if(this._pending)return Nv(this,t,this._pending);if(E9(e))return t.StopPropagation;if(e.values)return Nv(this,t,n.parse(e.values,e.format));if(e.async){const i=n.request(e.url,e.format).then(r=>(this._pending=G(r.data),a=>a.touch(this)));return{async:i}}else return n.request(e.url,e.format).then(i=>Nv(this,t,G(i.data)))};function E9(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Nv(e,t,n){n.forEach(ke);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Fv(e){$.call(this,{},e)}Fv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};var k9=P(Fv,$);k9.transform=function(e,t){var n=t,i=e.as,r=e.fields,a=e.index,o=e.values,s=e.default==null?null:e.default,l=e.modified(),u=l?t.SOURCE:t.ADD,c=r.length,f,d,h;return o?(d=o.length,c>1&&!i&&N('Multi-field lookup requires explicit "as" parameter.'),i&&i.length!==c*d&&N('The "as" parameter has too few output field names.'),i=i||o.map(et),f=function(p){for(var g=0,m=0,v,y;g<c;++g)if(y=a.get(r[g](p)),y==null)for(v=0;v<d;++v,++m)p[i[m]]=s;else for(v=0;v<d;++v,++m)p[i[m]]=o[v](y)}):(i||N("Missing output field names."),f=function(p){for(var g=0,m;g<c;++g)m=a.get(r[g](p)),p[i[g]]=m??s}),l?n=t.reflow(!0):(h=r.some(function(p){return t.modified(p.fields)}),u|=h?t.MOD:0),t.visit(u,f),n.modifies(i)};function WA(e){Ne.call(this,null,_9,e)}P(WA,Ne);function _9(e){if(this.value&&!e.modified())return this.value;var t=Infinity,n=-Infinity,i=e.extents,r,a,o;for(r=0,a=i.length;r<a;++r)o=i[r],o[0]<t&&(t=o[0]),o[1]>n&&(n=o[1]);return[t,n]}function GA(e){Ne.call(this,null,A9,e)}P(GA,Ne);function A9(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(t,n){return t.concat(n)},[])}function Iv(e){$.call(this,null,e)}P(Iv,$),Iv.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)};function Mv(e){Eo.call(this,e)}Mv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:_u,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var jv=P(Mv,Eo);jv._transform=jv.transform,jv.transform=function(e,t){return this._transform(S9(e,t),t)};function S9(e,t){var n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",a=Ht(n).concat(Ht(i)),o=T9(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(function(){return r}),fields:o.map(function(s){return O9(s,n,i,a)}),as:o.map(function(s){return s+""}),modified:e.modified.bind(e)}}function O9(e,t,n,i){return Rn(function(r){return t(r)===e?n(r):NaN},i,e+"")}function T9(e,t,n){var i={},r=[];return n.visit(n.SOURCE,function(a){var o=e(a);i[o]||(i[o]=1,r.push(o))}),r.sort(function(a,o){return(a<o||a==null)&&o!=null?-1:(a>o||o==null)&&a!=null?1:(o=o instanceof Date?+o:o,a=a instanceof Date?+a:a)!==a&&o===o?-1:o!==o&&a===a?1:0}),t?r.slice(0,t):r}function HA(e){Pd.call(this,e)}const C9=P(HA,Pd);C9.transform=function(e,t){const n=e.subflow,i=e.field,r=a=>this.subflow(ee(a),n,t,a);return(e.modified("field")||i&&t.modified(Ht(i)))&&N("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,a=>{const o=r(a);i(a).forEach(s=>o.mod(s))}),t.visit(t.ADD,a=>{const o=r(a);i(a).forEach(s=>o.add(ke(s)))}),t.visit(t.REM,a=>{const o=r(a);i(a).forEach(s=>o.rem(s))})):(t.visit(t.MOD,a=>r(a).mod(a)),t.visit(t.ADD,a=>r(a).add(a)),t.visit(t.REM,a=>r(a).rem(a))),t.clean()&&t.runAfter(()=>this.clean()),t};function Lv(e){$.call(this,null,e)}Lv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};var $9=P(Lv,$);$9.transform=function(e,t){var n=e.fields,i=MA(e.fields,e.as||[]),r=n?function(s,l){return D9(s,l,n,i)}:o0,a,o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),a=t.fork(t.NO_SOURCE),t.visit(t.REM,function(s){var l=ee(s);a.rem.push(o[l]),o[l]=null}),t.visit(t.ADD,function(s){var l=r(s,ke({}));o[ee(s)]=l,a.add.push(l)}),t.visit(t.MOD,function(s){a.mod.push(r(s,o[ee(s)]))}),a};function D9(e,t,n,i){for(var r=0,a=n.length;r<a;++r)t[i[r]]=n[r](e);return t}function YA(e){$.call(this,null,e)}var R9=P(YA,$);R9.transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Pv(e){$.call(this,null,e)}Pv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var N9=P(Pv,$),F9=1e-14;N9.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,a=Ev(r,e.groupby,e.field),o=(e.groupby||[]).map(et),s=[],l=e.step||.01,u=e.probs||po(l/2,1-F9,l),c=u.length;return a.forEach(f=>{const d=Z0(f,u);for(let h=0;h<c;++h){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[i[0]]=u[h],p[i[1]]=d[h],s.push(ke(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n};function VA(e){$.call(this,null,e)}var I9=P(VA,$);I9.transform=function(e,t){var n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{var a=ee(r);n.rem.push(i[a]),i[a]=null}),t.visit(t.ADD,r=>{var a=a0(r);i[ee(r)]=a,n.add.push(a)}),t.visit(t.MOD,r=>{var a=i[ee(r)],o;for(o in r)a[o]=r[o],n.modifies(o);n.mod.push(a)})),n};function zv(e){$.call(this,[],e),this.count=0}zv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var M9=P(zv,$);M9.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,a=this.value,o=this.count,s=0,l=a.reduce(function(d,h){return d[ee(h)]=1,d},{});function u(d){var h,p;a.length<r?a.push(d):(p=~~((o+1)*Wn()),p<a.length&&p>=s&&(h=a[p],l[ee(h)]&&n.rem.push(h),a[p]=d)),++o}if(t.rem.length&&(t.visit(t.REM,function(d){var h=ee(d);l[h]&&(l[h]=-1,n.rem.push(d)),--o}),a=a.filter(function(d){return l[ee(d)]!==-1})),(t.rem.length||i)&&a.length<r&&t.source&&(s=o=a.length,t.visit(t.SOURCE,function(d){l[ee(d)]||u(d)}),s=-1),i&&a.length>r){for(var c=0,f=a.length-r;c<f;++c)l[ee(a[c])]=-1,n.rem.push(a[c]);a=a.slice(f)}return t.mod.length&&t.visit(t.MOD,function(d){l[ee(d)]&&n.mod.push(d)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||s<0)&&(n.add=a.filter(function(d){return!l[ee(d)]})),this.count=o,this.value=n.source=a,n};function Bv(e){$.call(this,null,e)}Bv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var j9=P(Bv,$);j9.transform=function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=po(e.start,e.stop,e.step||1).map(function(r){var a={};return a[i]=r,ke(a)}),n.add=t.add.concat(this.value),n};function XA(e){$.call(this,null,e),this.modified(!0)}var L9=P(XA,$);L9.transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Uv(e){$.call(this,null,e)}const JA=["unit0","unit1"];Uv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:k0,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:JA}]};var KA=P(Uv,$);KA.transform=function(e,t){var n=e.field,i=e.interval!==!1,r=e.timezone==="utc",a=this._floor(e,t),o=(r?Is:Fs)(a.unit).offset,s=e.as||JA,l=s[0],u=s[1],c=a.start||Infinity,f=a.stop||-Infinity,d=a.step,h=t.ADD;return(e.modified()||t.modified(Ht(n)))&&(t=t.reflow(!0),h=t.SOURCE,c=Infinity,f=-Infinity),t.visit(h,function(p){var g=n(p),m,v;g==null?(p[l]=null,i&&(p[u]=null)):(p[l]=m=v=a(g),i&&(p[u]=v=o(m,d)),m<c&&(c=m),v>f&&(f=v))}),a.start=c,a.stop=f,t.modifies(i?s:l)},KA._floor=function(e,t){const n=e.timezone==="utc";let{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:I_({extent:e.extent||yr(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins});i=A0(i);const a=this.value||{},o=(n?__:k_)(i,r);return o.unit=ve(i),o.units=i,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o};function QA(e){$.call(this,au(),e)}var P9=P(QA,$);P9.transform=function(e,t){var n=t.dataflow,i=e.field,r=this.value,a=!0;function o(s){r.set(i(s),s)}return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,function(s){r.delete(i(s))}),t.visit(t.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()};function ZA(e){$.call(this,null,e)}var z9=P(ZA,$);z9.transform=function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);n&&(this.value=(e.sort?t.source.slice().sort(fo(e.sort)):t.source).map(e.field))};function B9(e,t,n,i){let r=Cu[e](t,n);return{init:r.init||oo,update:function(a,o){o[i]=r.next(a)}}}const Cu={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){let e=Cu.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{let n=t.index,i=t.data,r=t.compare;if(e<n){for(;n+1<i.length&&!r(i[n],i[n+1]);)++n;e=n}return(1+e)/i.length}}},ntile:function(e,t){t=+t,t>0||N("ntile num must be greater than zero.");let n=Cu.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{let i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{let i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||N("nth_value nth must be greater than zero."),{next:n=>{let i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{let i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{let r=i.data;return i.index<=n?t:(n=U9(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function U9(e,t,n){for(let i=t.length;n<i;++n){let r=e(t[n]);if(r!=null)return n}return-1}var q9=Object.keys(Cu);function eS(e){let t=this,n=G(e.ops),i=G(e.fields),r=G(e.params),a=G(e.as),o=t.outputs=[],s=t.windows=[],l={},u={},c=!0,f=[],d=[];function h(p){G(Ht(p)).forEach(g=>l[g]=1)}h(e.sort),n.forEach(function(p,g){let m=i[g],v=et(m),y=cA(p,v,a[g]);if(h(m),o.push(y),Q(Cu,p))s.push(B9(p,i[g],r[g],y));else{if(m==null&&p!=="count"&&N("Null aggregate field specified."),p==="count"){f.push(y);return}c=!1;let b=u[v];b||(b=u[v]=[],b.field=m,d.push(b)),b.push(fA(p,y))}}),(f.length||d.length)&&(t.cell=W9(d,f,c)),t.inputs=Object.keys(l)}const tS=eS.prototype;tS.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},tS.update=function(e,t){let n=this,i=n.cell,r=n.windows,a=e.data,o=r&&r.length,s;if(i){for(s=e.p0;s<e.i0;++s)i.rem(a[s]);for(s=e.p1;s<e.i1;++s)i.add(a[s]);i.set(t)}for(s=0;s<o;++s)r[s].update(e,t)};function W9(e,t,n){e=e.map(l=>hA(l,l.field));let i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,a=i.agg=Array(r),o=0;o<r;++o)a[o]=new e[o](i);if(i.store)var s=i.data=new gv();return i.add=function(l){if(i.num+=1,n)return;s&&s.add(l);for(let u=0;u<r;++u)a[u].add(a[u].get(l),l)},i.rem=function(l){if(i.num-=1,n)return;s&&s.rem(l);for(let u=0;u<r;++u)a[u].rem(a[u].get(l),l)},i.set=function(l){let u,c;for(s&&s.values(),u=0,c=t.length;u<c;++u)l[t[u]]=i.num;if(!n)for(u=0,c=a.length;u<c;++u)a[u].set(l)},i.init=function(){i.num=0,s&&s.reset();for(let l=0;l<r;++l)a[l].init()},i}function qv(e){$.call(this,{},e),this._mlen=0,this._mods=[]}qv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:q9.concat(_u)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var nS=P(qv,$);nS.transform=function(e,t){var n=this,i=n.state,r=e.modified(),a=fo(e.sort),o,s;this.stamp=t.stamp,(!i||r)&&(i=n.state=new eS(e));var l=K0(e.groupby);function u(c){return n.group(l(c))}for(r||t.modified(i.inputs)?(n.value={},t.visit(t.SOURCE,function(c){u(c).add(c)})):(t.visit(t.REM,function(c){u(c).remove(c)}),t.visit(t.ADD,function(c){u(c).add(c)})),o=0,s=n._mlen;o<s;++o)G9(n._mods[o],i,a,e);return n._mlen=0,n._mods=[],t.reflow(r).modifies(i.outputs)},nS.group=function(e){var t=this,n=t.value[e];return n||(n=t.value[e]=$A(ee),n.stamp=-1),n.stamp<t.stamp&&(n.stamp=t.stamp,t._mods[t._mlen++]=n),n};function G9(e,t,n,i){var r=i.sort,a=r&&!i.ignorePeers,o=i.frame||[null,0],s=e.data(n),l=s.length,u=0,c=a?yd(r):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Vt(-1)};for(t.init();u<l;++u)H9(f,o,u,l),a&&Y9(f,c),t.update(f,s[u])}function H9(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function Y9(e,t){var n=e.i0,i=e.i1-1,r=e.compare,a=e.data,o=a.length-1;n>0&&!r(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),i<o&&!r(a[i],a[i+1])&&(e.i1=t.right(a,a[i]))}var V9=Object.freeze({__proto__:null,aggregate:Eo,bin:mv,collect:vv,compare:DA,countpattern:yv,cross:wv,density:xv,dotbin:kv,expression:LA,extent:_v,facet:Pd,field:PA,filter:Sv,flatten:Ov,fold:Tv,formula:Cv,generate:zA,impute:$v,joinaggregate:Dv,kde:Rv,key:UA,load:qA,lookup:Fv,multiextent:WA,multivalues:GA,params:Iv,pivot:Mv,prefacet:HA,project:Lv,proxy:YA,quantile:Pv,relay:VA,sample:zv,sequence:Bv,sieve:XA,subflow:Av,timeunit:Uv,tupleindex:QA,values:ZA,window:qv});const qs="top",di="left",hi="right",la="bottom",X9="top-left",J9="top-right",K9="bottom-left",Q9="bottom-right",Wv="start",Gv="middle",Xt="end",Z9="x",e7="y",Bd="group",Hv="axis",Yv="title",t7="frame",n7="scope",Vv="legend",iS="row-header",rS="row-footer",aS="row-title",oS="column-header",sS="column-footer",lS="column-title",i7="padding",r7="symbol",uS="fit",a7="fit-x",o7="fit-y",s7="pad",Xv="none",Ud="all",Jv="each",Kv="flush",ua="column",ca="row";var cS=0;function l7(){cS=0}const qd="p_";function Qv(e){return e&&e.gradient}function fS(e,t,n){let i=e.id,r=e.gradient,a=r==="radial"?qd:"";return i||(i=e.id="gradient_"+cS++,r==="radial"?(e.x1=ji(e.x1,.5),e.y1=ji(e.y1,.5),e.r1=ji(e.r1,0),e.x2=ji(e.x2,.5),e.y2=ji(e.y2,.5),e.r2=ji(e.r2,.5),a=qd):(e.x1=ji(e.x1,0),e.y1=ji(e.y1,0),e.x2=ji(e.x2,1),e.y2=ji(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function ji(e,t){return e??t}function dS(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,a){return n.push({offset:r,color:a}),i}}}var Zv=Math.PI,ey=2*Zv,ko=1e-6,u7=ey-ko;function ty(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function _o(){return new ty()}ty.prototype=_o.prototype={constructor:ty,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var a=this._x1,o=this._y1,s=n-e,l=i-t,u=a-e,c=o-t,f=u*u+c*c;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>ko)if(!(Math.abs(c*s-l*u)>ko)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-a,h=i-o,p=s*s+l*l,g=d*d+h*h,m=Math.sqrt(p),v=Math.sqrt(f),y=r*Math.tan((Zv-Math.acos((p+f-g)/(2*m*v)))/2),b=y/v,E=y/m;Math.abs(b-1)>ko&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+E*s)+","+(this._y1=t+E*l)}},arc:function(e,t,n,i,r,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(i),s=n*Math.sin(i),l=e+o,u=t+s,c=1^a,f=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null?this._+="M"+l+","+u:(Math.abs(this._x1-l)>ko||Math.abs(this._y1-u)>ko)&&(this._+="L"+l+","+u),!n)return;f<0&&(f=f%ey+ey),f>u7?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>ko&&(this._+="A"+n+","+n+",0,"+ +(f>=Zv)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r)))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function je(e){return function(){return e}}var hS=Math.abs,Mt=Math.atan2,Ao=Math.cos,c7=Math.max,ny=Math.min,Li=Math.sin,Ws=Math.sqrt,jt=1e-12,Gs=Math.PI,Wd=Gs/2,pS=2*Gs;function f7(e){return e>1?0:e<-1?Gs:Math.acos(e)}function gS(e){return e>=1?Wd:e<=-1?-Wd:Math.asin(e)}function d7(e){return e.innerRadius}function h7(e){return e.outerRadius}function p7(e){return e.startAngle}function g7(e){return e.endAngle}function m7(e){return e&&e.padAngle}function v7(e,t,n,i,r,a,o,s){var l=n-e,u=i-t,c=o-r,f=s-a,d=f*l-c*u;return d*d<jt?void 0:(d=(c*(t-a)-f*(e-r))/d,[e+d*l,t+d*u])}function Gd(e,t,n,i,r,a,o){var s=e-n,l=t-i,u=(o?a:-a)/Ws(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,g=i+f,m=(d+p)/2,v=(h+g)/2,y=p-d,b=g-h,E=y*y+b*b,x=r-a,k=d*g-p*h,w=(b<0?-1:1)*Ws(c7(0,x*x*E-k*k)),A=(k*b-y*w)/E,_=(-k*y-b*w)/E,O=(k*b+y*w)/E,S=(-k*y+b*w)/E,T=A-m,D=_-v,M=O-m,C=S-v;return T*T+D*D>M*M+C*C&&(A=O,_=S),{cx:A,cy:_,x01:-c,y01:-f,x11:A*(r/x-1),y11:_*(r/x-1)}}function y7(){var e=d7,t=h7,n=je(0),i=null,r=p7,a=g7,o=m7,s=null;function l(){var u,c,f=+e.apply(this,arguments),d=+t.apply(this,arguments),h=r.apply(this,arguments)-Wd,p=a.apply(this,arguments)-Wd,g=hS(p-h),m=p>h;if(s||(s=u=_o()),d<f&&(c=d,d=f,f=c),!(d>jt))s.moveTo(0,0);else if(g>pS-jt)s.moveTo(d*Ao(h),d*Li(h)),s.arc(0,0,d,h,p,!m),f>jt&&(s.moveTo(f*Ao(p),f*Li(p)),s.arc(0,0,f,p,h,m));else{var v=h,y=p,b=h,E=p,x=g,k=g,w=o.apply(this,arguments)/2,A=w>jt&&(i?+i.apply(this,arguments):Ws(f*f+d*d)),_=ny(hS(d-f)/2,+n.apply(this,arguments)),O=_,S=_,T,D;if(A>jt){var M=gS(A/f*Li(w)),C=gS(A/d*Li(w));(x-=M*2)>jt?(M*=m?1:-1,b+=M,E-=M):(x=0,b=E=(h+p)/2),(k-=C*2)>jt?(C*=m?1:-1,v+=C,y-=C):(k=0,v=y=(h+p)/2)}var F=d*Ao(v),W=d*Li(v),X=f*Ao(E),J=f*Li(E);if(_>jt){var xe=d*Ao(y),Pe=d*Li(y),dt=f*Ao(b),ht=f*Li(b),Ke;if(g<Gs&&(Ke=v7(F,W,dt,ht,xe,Pe,X,J))){var Rt=F-Ke[0],ui=W-Ke[1],Ka=xe-Ke[0],Jr=Pe-Ke[1],H=1/Li(f7((Rt*Ka+ui*Jr)/(Ws(Rt*Rt+ui*ui)*Ws(Ka*Ka+Jr*Jr)))/2),ue=Ws(Ke[0]*Ke[0]+Ke[1]*Ke[1]);O=ny(_,(f-ue)/(H-1)),S=ny(_,(d-ue)/(H+1))}}k>jt?S>jt?(T=Gd(dt,ht,F,W,d,S,m),D=Gd(xe,Pe,X,J,d,S,m),s.moveTo(T.cx+T.x01,T.cy+T.y01),S<_?s.arc(T.cx,T.cy,S,Mt(T.y01,T.x01),Mt(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,S,Mt(T.y01,T.x01),Mt(T.y11,T.x11),!m),s.arc(0,0,d,Mt(T.cy+T.y11,T.cx+T.x11),Mt(D.cy+D.y11,D.cx+D.x11),!m),s.arc(D.cx,D.cy,S,Mt(D.y11,D.x11),Mt(D.y01,D.x01),!m))):(s.moveTo(F,W),s.arc(0,0,d,v,y,!m)):s.moveTo(F,W),!(f>jt)||!(x>jt)?s.lineTo(X,J):O>jt?(T=Gd(X,J,xe,Pe,f,-O,m),D=Gd(F,W,dt,ht,f,-O,m),s.lineTo(T.cx+T.x01,T.cy+T.y01),O<_?s.arc(T.cx,T.cy,O,Mt(T.y01,T.x01),Mt(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,O,Mt(T.y01,T.x01),Mt(T.y11,T.x11),!m),s.arc(0,0,f,Mt(T.cy+T.y11,T.cx+T.x11),Mt(D.cy+D.y11,D.cx+D.x11),m),s.arc(D.cx,D.cy,O,Mt(D.y11,D.x11),Mt(D.y01,D.x01),!m))):s.arc(0,0,f,E,b,m)}if(s.closePath(),u)return s=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-Gs/2;return[Ao(c)*u,Li(c)*u]},l.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:je(+u),l):e},l.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:je(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:je(+u),l):n},l.padRadius=function(u){return arguments.length?(i=u==null?null:typeof u=="function"?u:je(+u),l):i},l.startAngle=function(u){return arguments.length?(r=typeof u=="function"?u:je(+u),l):r},l.endAngle=function(u){return arguments.length?(a=typeof u=="function"?u:je(+u),l):a},l.padAngle=function(u){return arguments.length?(o=typeof u=="function"?u:je(+u),l):o},l.context=function(u){return arguments.length?(s=u??null,l):s},l}function mS(e){this._context=e}mS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function iy(e){return new mS(e)}function vS(e){return e[0]}function yS(e){return e[1]}function bS(){var e=vS,t=yS,n=je(!0),i=null,r=iy,a=null;function o(s){var l,u=s.length,c,f=!1,d;for(i==null&&(a=r(d=_o())),l=0;l<=u;++l)!(l<u&&n(c=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(c,l,s),+t(c,l,s));if(d)return a=null,d+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:je(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:je(+s),o):t},o.defined=function(s){return arguments.length?(n=typeof s=="function"?s:je(!!s),o):n},o.curve=function(s){return arguments.length?(r=s,i!=null&&(a=r(i)),o):r},o.context=function(s){return arguments.length?(s==null?i=a=null:a=r(i=s),o):i},o}function wS(){var e=vS,t=null,n=je(0),i=yS,r=je(!0),a=null,o=iy,s=null;function l(c){var f,d,h,p=c.length,g,m=!1,v,y=new Array(p),b=new Array(p);for(a==null&&(s=o(v=_o())),f=0;f<=p;++f){if(!(f<p&&r(g=c[f],f,c))===m)if(m=!m)d=f,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=f-1;h>=d;--h)s.point(y[h],b[h]);s.lineEnd(),s.areaEnd()}m&&(y[f]=+e(g,f,c),b[f]=+n(g,f,c),s.point(t?+t(g,f,c):y[f],i?+i(g,f,c):b[f]))}if(v)return s=null,v+""||null}function u(){return bS().defined(r).curve(o).context(a)}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),t=null,l):e},l.x0=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),l):e},l.x1=function(c){return arguments.length?(t=c==null?null:typeof c=="function"?c:je(+c),l):t},l.y=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),i=null,l):n},l.y0=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),l):n},l.y1=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:je(+c),l):i},l.lineX0=l.lineY0=function(){return u().x(e).y(n)},l.lineY1=function(){return u().x(e).y(i)},l.lineX1=function(){return u().x(t).y(n)},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:je(!!c),l):r},l.curve=function(c){return arguments.length?(o=c,a!=null&&(s=o(a)),l):o},l.context=function(c){return arguments.length?(c==null?a=s=null:s=o(a=c),l):a},l}var b7={draw:function(e,t){var n=Math.sqrt(t/Gs);e.moveTo(n,0),e.arc(0,0,n,0,pS)}};function w7(){var e=je(b7),t=je(64),n=null;function i(){var r;if(n||(n=r=_o()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(e=typeof r=="function"?r:je(r),i):e},i.size=function(r){return arguments.length?(t=typeof r=="function"?r:je(+r),i):t},i.context=function(r){return arguments.length?(n=r??null,i):n},i}function fa(){}function Hd(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Yd(e){this._context=e}Yd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Hd(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Hd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function x7(e){return new Yd(e)}function xS(e){this._context=e}xS.prototype={areaStart:fa,areaEnd:fa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Hd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function E7(e){return new xS(e)}function ES(e){this._context=e}ES.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Hd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function k7(e){return new ES(e)}function kS(e,t){this._basis=new Yd(e),this._beta=t}kS.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],a=e[n]-i,o=t[n]-r,s=-1,l;++s<=n;)l=s/n,this._basis.point(this._beta*e[s]+(1-this._beta)*(i+l*a),this._beta*t[s]+(1-this._beta)*(r+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var _7=function e(t){function n(i){return t===1?new Yd(i):new kS(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Vd(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function ry(e,t){this._context=e,this._k=(1-t)/6}ry.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Vd(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Vd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var A7=function e(t){function n(i){return new ry(i,t)}return n.tension=function(i){return e(+i)},n}(0);function ay(e,t){this._context=e,this._k=(1-t)/6}ay.prototype={areaStart:fa,areaEnd:fa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Vd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var S7=function e(t){function n(i){return new ay(i,t)}return n.tension=function(i){return e(+i)},n}(0);function oy(e,t){this._context=e,this._k=(1-t)/6}oy.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Vd(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var O7=function e(t){function n(i){return new oy(i,t)}return n.tension=function(i){return e(+i)},n}(0);function sy(e,t,n){var i=e._x1,r=e._y1,a=e._x2,o=e._y2;if(e._l01_a>jt){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>jt){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,a,o,e._x2,e._y2)}function _S(e,t){this._context=e,this._alpha=t}_S.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:sy(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var T7=function e(t){function n(i){return t?new _S(i,t):new ry(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function AS(e,t){this._context=e,this._alpha=t}AS.prototype={areaStart:fa,areaEnd:fa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:sy(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var C7=function e(t){function n(i){return t?new AS(i,t):new ay(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function SS(e,t){this._context=e,this._alpha=t}SS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:sy(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var $7=function e(t){function n(i){return t?new SS(i,t):new oy(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function OS(e){this._context=e}OS.prototype={areaStart:fa,areaEnd:fa,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function D7(e){return new OS(e)}function TS(e){return e<0?-1:1}function CS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,a=(e._y1-e._y0)/(i||r<0&&-0),o=(n-e._y1)/(r||i<0&&-0),s=(a*r+o*i)/(i+r);return(TS(a)+TS(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function $S(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function ly(e,t,n){var i=e._x0,r=e._y0,a=e._x1,o=e._y1,s=(a-i)/3;e._context.bezierCurveTo(i+s,r+s*t,a-s,o-s*n,a,o)}function Xd(e){this._context=e}Xd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ly(this,this._t0,$S(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ly(this,$S(this,n=CS(this,e,t)),n);break;default:ly(this,this._t0,n=CS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}};function DS(e){this._context=new RS(e)}(DS.prototype=Object.create(Xd.prototype)).point=function(e,t){Xd.prototype.point.call(this,t,e)};function RS(e){this._context=e}RS.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,a){this._context.bezierCurveTo(t,e,i,n,a,r)}};function R7(e){return new Xd(e)}function N7(e){return new DS(e)}function NS(e){this._context=e}NS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=FS(e),r=FS(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(i[0][a],r[0][a],i[1][a],r[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function FS(e){var t,n=e.length-1,i,r=new Array(n),a=new Array(n),o=new Array(n);for(r[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/a[t-1],a[t]-=i,o[t]-=i*o[t-1];for(r[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)r[t]=(o[t]-r[t+1])/a[t];for(a[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-r[t+1];return[r,a]}function F7(e){return new NS(e)}function Jd(e,t){this._context=e,this._t=t}Jd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function I7(e){return new Jd(e,.5)}function M7(e){return new Jd(e,0)}function j7(e){return new Jd(e,1)}var IS={basis:{curve:x7},"basis-closed":{curve:E7},"basis-open":{curve:k7},bundle:{curve:_7,tension:"beta",value:.85},cardinal:{curve:A7,tension:"tension",value:0},"cardinal-open":{curve:O7,tension:"tension",value:0},"cardinal-closed":{curve:S7,tension:"tension",value:0},"catmull-rom":{curve:T7,tension:"alpha",value:.5},"catmull-rom-closed":{curve:C7,tension:"alpha",value:.5},"catmull-rom-open":{curve:$7,tension:"alpha",value:.5},linear:{curve:iy},"linear-closed":{curve:D7},monotone:{horizontal:N7,vertical:R7},natural:{curve:F7},step:{curve:I7},"step-after":{curve:j7},"step-before":{curve:M7}};function uy(e,t,n){var i=Q(IS,e)&&IS[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}var L7={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Kd=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function Hs(e){var t=[],n,i,r,a,o,s,l,u,c,f,d;for(n=e.slice().replace(Kd[0],"###$1").split(Kd[1]).slice(1),u=0,f=n.length;u<f;++u){for(i=n[u],r=i.slice(1).trim().replace(Kd[2],"$1###$2").split(Kd[3]),s=i.charAt(0),a=[s],c=0,d=r.length;c<d;++c)(o=+r[c])===o&&a.push(o);if(l=L7[s.toLowerCase()],a.length-1>l)for(c=1,d=a.length;c<d;c+=l)t.push([s].concat(a.slice(c,c+l)));else t.push(a)}return t}const xr=Math.PI/180,P7=1e-14,So=Math.PI/2,Pi=Math.PI*2,Ys=Math.sqrt(3)/2;var cy={},fy={},MS=[].join;function z7(e,t,n,i,r,a,o,s,l){var u=MS.call(arguments);if(cy[u])return cy[u];var c=o*xr,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);var h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5,g=h*h/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var m=d/n,v=f/n,y=-f/i,b=d/i,E=m*s+v*l,x=y*s+b*l,k=m*e+v*t,w=y*e+b*t,A=(k-E)*(k-E)+(w-x)*(w-x),_=1/A-.25;_<0&&(_=0);var O=Math.sqrt(_);a==r&&(O=-O);var S=.5*(E+k)-O*(w-x),T=.5*(x+w)+O*(k-E),D=Math.atan2(x-T,E-S),M=Math.atan2(w-T,k-S),C=M-D;C<0&&a===1?C+=Pi:C>0&&a===0&&(C-=Pi);for(var F=Math.ceil(Math.abs(C/(So+.001))),W=[],X=0;X<F;++X){var J=D+X*C/F,xe=D+(X+1)*C/F;W[X]=[S,T,J,xe,n,i,f,d]}return cy[u]=W}function B7(e){var t=MS.call(e);if(fy[t])return fy[t];var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(r),g=Math.sin(r),m=Math.cos(a),v=Math.sin(a),y=.5*(a-r),b=Math.sin(y*.5),E=8/3*b*b/Math.sin(y),x=n+p-E*g,k=i+g+E*p,w=n+m,A=i+v,_=w+E*v,O=A-E*m;return fy[t]=[c*x+f*k,d*x+h*k,c*_+f*O,d*_+h*O,c*w+f*A,d*w+h*A]}var Hn=["l",0,0,0,0,0,0,0];function U7(e,t,n){var i=Hn[0]=e[0];if(i==="a"||i==="A")Hn[1]=t*e[1],Hn[2]=n*e[2],Hn[3]=e[3],Hn[4]=e[4],Hn[5]=e[5],Hn[6]=t*e[6],Hn[7]=n*e[7];else if(i==="h"||i==="H")Hn[1]=t*e[1];else if(i==="v"||i==="V")Hn[1]=n*e[1];else for(var r=1,a=e.length;r<a;++r)Hn[r]=(r%2==1?t:n)*e[r];return Hn}function $u(e,t,n,i,r,a){var o,s=null,l=0,u=0,c=0,f=0,d,h,p,g;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),a==null&&(a=r),e.beginPath&&e.beginPath();for(var m=0,v=t.length;m<v;++m){o=t[m],(r!==1||a!==1)&&(o=U7(o,r,a));switch(o[0]){case"l":l+=o[1],u+=o[2],e.lineTo(l+n,u+i);break;case"L":l=o[1],u=o[2],e.lineTo(l+n,u+i);break;case"h":l+=o[1],e.lineTo(l+n,u+i);break;case"H":l=o[1],e.lineTo(l+n,u+i);break;case"v":u+=o[1],e.lineTo(l+n,u+i);break;case"V":u=o[1],e.lineTo(l+n,u+i);break;case"m":l+=o[1],u+=o[2],e.moveTo(l+n,u+i);break;case"M":l=o[1],u=o[2],e.moveTo(l+n,u+i);break;case"c":d=l+o[5],h=u+o[6],c=l+o[3],f=u+o[4],e.bezierCurveTo(l+o[1]+n,u+o[2]+i,c+n,f+i,d+n,h+i),l=d,u=h;break;case"C":l=o[5],u=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+i,c+n,f+i,l+n,u+i);break;case"s":d=l+o[3],h=u+o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,l+o[1]+n,u+o[2]+i,d+n,h+i),c=l+o[1],f=u+o[2],l=d,u=h;break;case"S":d=o[3],h=o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"q":d=l+o[3],h=u+o[4],c=l+o[1],f=u+o[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"Q":d=o[3],h=o[4],e.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"t":d=l+o[1],h=u+o[2],s[0].match(/[QqTt]/)===null?(c=l,f=u):s[0]==="t"?(c=2*l-p,f=2*u-g):s[0]==="q"&&(c=2*l-c,f=2*u-f),p=c,g=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h,c=l+o[1],f=u+o[2];break;case"T":d=o[1],h=o[2],c=2*l-c,f=2*u-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"a":jS(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+l+n,o[7]+u+i]),l+=o[6],u+=o[7];break;case"A":jS(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),l=o[6],u=o[7];break;case"z":case"Z":e.closePath();break}s=o}}function jS(e,t,n,i){for(var r=z7(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n),a=0;a<r.length;++a){var o=B7(r[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var LS=.5773502691896257,PS={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Pi)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,a=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-a),e.lineTo(r,-a),e.lineTo(0,-n),e.lineTo(-r,-a),e.lineTo(-i,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n,r=i-n*LS,a=n/4;e.moveTo(0,-i-r),e.lineTo(-a,i-r),e.lineTo(a,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n,r=i-n*LS;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function zS(e){return Q(PS,e)?PS[e]:q7(e)}var dy={};function q7(e){if(!Q(dy,e)){var t=Hs(e);dy[e]={draw:function(n,i){$u(n,t,0,0,Math.sqrt(i)/2)}}}return dy[e]}const da=.448084975506;function W7(e){return e.x}function G7(e){return e.y}function H7(e){return e.width}function Y7(e){return e.height}function Er(e){return typeof e=="function"?e:()=>+e}function Qd(e,t,n){return Math.max(t,Math.min(e,n))}function BS(){var e=W7,t=G7,n=H7,i=Y7,r=Er(0),a=r,o=r,s=r,l=null;function u(c,f,d){var h,p=f??+e.call(this,c),g=d??+t.call(this,c),m=+n.call(this,c),v=+i.call(this,c),y=Math.min(m,v)/2,b=Qd(+r.call(this,c),0,y),E=Qd(+a.call(this,c),0,y),x=Qd(+o.call(this,c),0,y),k=Qd(+s.call(this,c),0,y);if(l||(l=h=_o()),b<=0&&E<=0&&x<=0&&k<=0)l.rect(p,g,m,v);else{var w=p+m,A=g+v;l.moveTo(p+b,g),l.lineTo(w-E,g),l.bezierCurveTo(w-da*E,g,w,g+da*E,w,g+E),l.lineTo(w,A-k),l.bezierCurveTo(w,A-da*k,w-da*k,A,w-k,A),l.lineTo(p+x,A),l.bezierCurveTo(p+da*x,A,p,A-da*x,p,A-x),l.lineTo(p,g+b),l.bezierCurveTo(p,g+da*b,p+da*b,g,p+b,g),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(c){return arguments.length?(e=Er(c),u):e},u.y=function(c){return arguments.length?(t=Er(c),u):t},u.width=function(c){return arguments.length?(n=Er(c),u):n},u.height=function(c){return arguments.length?(i=Er(c),u):i},u.cornerRadius=function(c,f,d,h){return arguments.length?(r=Er(c),a=f!=null?Er(f):r,s=d!=null?Er(d):r,o=h!=null?Er(h):a,u):r},u.context=function(c){return arguments.length?(l=c??null,u):l},u}function US(){var e,t,n,i,r=null,a,o,s,l;function u(f,d,h){var p=h/2;if(a){var g=s-d,m=f-o;if(g||m){var v=Math.sqrt(g*g+m*m),y=(g/=v)*l,b=(m/=v)*l,E=Math.atan2(m,g);r.moveTo(o-y,s-b),r.lineTo(f-g*p,d-m*p),r.arc(f,d,p,E-Math.PI,E),r.lineTo(o+y,s+b),r.arc(o,s,l,E,E+Math.PI)}else r.arc(f,d,p,0,Pi);r.closePath()}else a=1;o=f,s=d,l=p}function c(f){var d,h=f.length,p,g=!1,m;for(r==null&&(r=m=_o()),d=0;d<=h;++d)!(d<h&&i(p=f[d],d,f))===g&&((g=!g)&&(a=0)),g&&u(+e(p,d,f),+t(p,d,f),+n(p,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function Du(e,t){return e??t}const Ru=e=>e.x||0,Nu=e=>e.y||0,V7=e=>e.width||0,X7=e=>e.height||0,J7=e=>(e.x||0)+(e.width||0),K7=e=>(e.y||0)+(e.height||0),Q7=e=>e.startAngle||0,Z7=e=>e.endAngle||0,eB=e=>e.padAngle||0,tB=e=>e.innerRadius||0,nB=e=>e.outerRadius||0,iB=e=>e.cornerRadius||0,rB=e=>Du(e.cornerRadiusTopLeft,e.cornerRadius)||0,aB=e=>Du(e.cornerRadiusTopRight,e.cornerRadius)||0,oB=e=>Du(e.cornerRadiusBottomRight,e.cornerRadius)||0,sB=e=>Du(e.cornerRadiusBottomLeft,e.cornerRadius)||0,lB=e=>Du(e.size,64),uB=e=>e.size||1,Zd=e=>!(e.defined===!1),cB=e=>zS(e.shape||"circle"),fB=y7().startAngle(Q7).endAngle(Z7).padAngle(eB).innerRadius(tB).outerRadius(nB).cornerRadius(iB),dB=wS().x(Ru).y1(Nu).y0(K7).defined(Zd),hB=wS().y(Nu).x1(Ru).x0(J7).defined(Zd),pB=bS().x(Ru).y(Nu).defined(Zd),gB=BS().x(Ru).y(Nu).width(V7).height(X7).cornerRadius(rB,aB,oB,sB),mB=w7().type(cB).size(lB),vB=US().x(Ru).y(Nu).defined(Zd).size(uB);function hy(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function yB(e,t){return fB.context(e)(t)}function bB(e,t){var n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?hB:dB).curve(uy(i,n.orient,n.tension)).context(e)(t)}function wB(e,t){var n=t[0],i=n.interpolate||"linear";return pB.curve(uy(i,n.orient,n.tension)).context(e)(t)}function Vs(e,t,n,i){return gB.context(e)(t,n,i)}function xB(e,t){return(t.mark.shape||t.shape).context(e)(t)}function EB(e,t){return mB.context(e)(t)}function kB(e,t){return vB.context(e)(t)}var qS=1;function WS(){qS=1}function py(e,t,n){var i=t.clip,r=e._defs,a=t.clip_id||(t.clip_id="clip"+qS++),o=r.clipping[a]||(r.clipping[a]={id:a});return ge(i)?o.path=i(null):hy(n)?o.path=Vs(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function st(e){this.clear(),e&&this.union(e)}var it=st.prototype;it.clone=function(){return new st(this)},it.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},it.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},it.equals=function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},it.set=function(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},it.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},it.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},it.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},it.scale=function(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},it.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},it.rotate=function(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},it.rotatedPoints=function(e,t,n){var{x1:i,y1:r,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*i-l*r+u,l*i+s*r+c,s*i-l*o+u,l*i+s*o+c,s*a-l*r+u,l*a+s*r+c,s*a-l*o+u,l*a+s*o+c]},it.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},it.intersect=function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},it.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1)&&this.y2>=e.y2},it.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},it.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},it.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},it.width=function(){return this.x2-this.x1},it.height=function(){return this.y2-this.y1};function eh(e){this.mark=e,this.bounds=this.bounds||new st()}function th(e){eh.call(this,e),this.items=this.items||[]}P(th,eh);function Fu(e,t){if(typeof document!="undefined"&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}function _B(){return typeof Image!="undefined"?Image:null}function gy(e){this._pending=0,this._loader=e||Dd()}var nh=gy.prototype;nh.pending=function(){return this._pending};function GS(e){e._pending+=1}function Iu(e){e._pending-=1}nh.sanitizeURL=function(e){var t=this;return GS(t),t._loader.sanitize(e,{context:"href"}).then(function(n){return Iu(t),n}).catch(function(){return Iu(t),null})},nh.loadImage=function(e){const t=this,n=_B();return GS(t),t._loader.sanitize(e,{context:"image"}).then(function(i){const r=i.href;if(!r||!n)throw{url:r};const a=new n(),o=Q(i,"crossOrigin")?i.crossOrigin:"anonymous";return o!=null&&(a.crossOrigin=o),a.onload=()=>Iu(t),a.onerror=()=>Iu(t),a.src=r,a}).catch(function(i){return Iu(t),{complete:!1,width:0,height:0,src:i&&i.url||""}})},nh.ready=function(){var e=this;return new Promise(function(t){function n(i){e.pending()?setTimeout(function(){n(!0)},10):t(i)}n(!1)})};function kr(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?AB(t,i):0))}return e}function AB(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}var ih,rh,ah,SB=Pi-1e-8;function gn(e){return ih=e,gn}function HS(){}function Oo(e,t){ih.add(e,t)}function Mu(e,t){Oo(rh=e,ah=t)}function YS(e){Oo(e,ih.y1)}function VS(e){Oo(ih.x1,e)}gn.beginPath=HS,gn.closePath=HS,gn.moveTo=Mu,gn.lineTo=Mu,gn.rect=function(e,t,n,i){Oo(e+n,t+i),Mu(e,t)},gn.quadraticCurveTo=function(e,t,n,i){XS(rh,e,n,YS),XS(ah,t,i,VS),Mu(n,i)};function XS(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}gn.bezierCurveTo=function(e,t,n,i,r,a){JS(rh,e,n,r,YS),JS(ah,t,i,a,VS),Mu(r,a)};function JS(e,t,n,i,r){const a=i-e+3*t-3*n,o=e+n-2*t,s=e-t;let l=0,u=0,c;Math.abs(a)>P7?(c=o*o+s*a,c>=0&&(c=Math.sqrt(c),l=(-o+c)/a,u=(-o-c)/a)):l=.5*s/o,0<l&&l<1&&r(KS(l,e,t,n,i)),0<u&&u<1&&r(KS(u,e,t,n,i))}function KS(e,t,n,i,r){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*i+s*e*r}gn.arc=function(e,t,n,i,r,a){if(rh=n*Math.cos(r)+e,ah=n*Math.sin(r)+t,Math.abs(r-i)>SB)Oo(e-n,t-n),Oo(e+n,t+n);else{const o=u=>Oo(n*Math.cos(u)+e,n*Math.sin(u)+t);let s,l;if(o(i),o(r),r!==i)if(i=i%Pi,i<0&&(i+=Pi),r=r%Pi,r<0&&(r+=Pi),r<i&&(a=!a,s=i,i=r,r=s),a)for(r-=Pi,s=i-i%So,l=0;l<4&&s>r;++l,s-=So)o(s);else for(s=i-i%So+So,l=0;l<4&&s<r;++l,s=s+So)o(s)}};var ha=(ha=Fu(1,1))?ha.getContext("2d"):null;const my=new st();function vy(e){return function(t,n){if(!ha)return!0;e(ha,t),my.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:a,y2:o}=my;for(let s=r;s<=o;++s)for(let l=i;l<=a;++l)if(ha.isPointInPath(l,s))return!0;return!1}}function yy(e,t){return t.contains(e.x||0,e.y||0)}function QS(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,a=e.height||0;return t.intersects(my.set(n,i,n+r,i+a))}function ZS(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:i;return Xs(t,n,i,r,a)}function Xs(e,t,n,i,r){const{x1:a,y1:o,x2:s,y2:l}=e,u=i-t,c=r-n;let f=0,d=1,h,p,g,m;for(m=0;m<4;++m){if(m===0&&(h=-u,p=-(a-t)),m===1&&(h=u,p=s-t),m===2&&(h=-c,p=-(o-n)),m===3&&(h=c,p=l-n),Math.abs(h)<1e-10&&p<0)return!1;if(g=p/h,h<0){if(g>d)return!1;g>f&&(f=g)}else if(h>0){if(g<f)return!1;g<d&&(d=g)}}return!0}function Js(e,t){e.globalCompositeOperation=t.blend||"source-over"}function pi(e,t){return e??t}function eO(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function OB(e,t,n){const i=n.width(),r=n.height();let a;if(t.gradient==="radial")a=e.createRadialGradient(n.x1+pi(t.x1,.5)*i,n.y1+pi(t.y1,.5)*r,Math.max(i,r)*pi(t.r1,0),n.x1+pi(t.x2,.5)*i,n.y1+pi(t.y2,.5)*r,Math.max(i,r)*pi(t.r2,.5));else{const o=pi(t.x1,0),s=pi(t.y1,0),l=pi(t.x2,1),u=pi(t.y2,0);if(o===l||s===u||i===r)a=e.createLinearGradient(n.x1+o*i,n.y1+s*r,n.x1+l*i,n.y1+u*r);else{const c=Fu(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=eO(f.createLinearGradient(o,s,l,u),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return eO(a,t.stops)}function tO(e,t,n){return Qv(n)?OB(e,n,t.bounds):n}function oh(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=tO(e,t,t.fill),!0):!1}var TB=[];function Ks(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=tO(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||TB),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function CB(e,t){return e.zindex-t.zindex||e.index-t.index}function by(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,a;for(r=0,a=t.length;r<a;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(CB)}function gi(e,t){var n=e.items,i,r;if(!n||!n.length)return;var a=by(e);if(a&&a.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=a}for(i=0,r=n.length;i<r;++i)t(n[i])}function sh(e,t){var n=e.items,i,r;if(!n||!n.length)return null;var a=by(e);for(a&&a.length&&(n=a),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===a){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function wy(e){return function(t,n,i){gi(n,function(r){(!i||i.intersects(r.bounds))&&nO(e,t,r,r)})}}function $B(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&nO(e,t,n.items[0],n.items)}}function nO(e,t,n,i){var r=n.opacity==null?1:n.opacity;if(r===0)return;if(e(t,i))return;Js(t,n),n.fill&&oh(t,n,r)&&t.fill(),n.stroke&&Ks(t,n,r)&&t.stroke()}function lh(e){return e=e||Fi,function(t,n,i,r,a,o){return i*=t.pixelRatio,r*=t.pixelRatio,sh(n,function(s){var l=s.bounds;if(l&&!l.contains(a,o)||!l)return;if(e(t,s,i,r,a,o))return s})}}function uh(e,t){return function(n,i,r,a){var o=Array.isArray(i)?i[0]:i,s=t??o.fill,l=o.stroke&&n.isPointInStroke,u,c;return l&&(u=o.strokeWidth,c=o.strokeCap,n.lineWidth=u??1,n.lineCap=c??"butt"),e(n,i)?!1:s&&n.isPointInPath(r,a)||l&&n.isPointInStroke(r,a)}}function xy(e){return lh(uh(e))}function Qs(e,t){return"translate("+e+","+t+")"}function iO(e){return"rotate("+e+")"}function DB(e,t){return"scale("+e+","+t+")"}function rO(e){return Qs(e.x||0,e.y||0)}function aO(e){return Qs(e.x||0,e.y||0)+(e.angle?" "+iO(e.angle):"")+(e.scaleX||e.scaleY?" "+DB(e.scaleX||1,e.scaleY||1):"")}function Ey(e,t,n){function i(o,s){o("transform",aO(s)),o("d",t(null,s))}function r(o,s){var l=s.x||0,u=s.y||0;return t(gn(o),s),kr(o,s).translate(l,u),s.angle&&o.rotate(s.angle*xr,l,u),o}function a(o,s){var l=s.x||0,u=s.y||0,c=s.angle||0;o.translate(l,u),c&&o.rotate(c*=xr),o.beginPath(),t(o,s),c&&o.rotate(-c),o.translate(-l,-u)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:wy(a),pick:xy(a),isect:n||vy(a)}}var RB=Ey("arc",yB);function NB(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,a=Infinity,o,s;--r>=0;){if(e[r].defined===!1)continue;s=Math.abs(e[r][i]-n),s<a&&(a=s,o=e[r])}return o}function FB(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,a,o;--i>=0;){if(e[i].defined===!1)continue;if(r=e[i].x-t[0],a=e[i].y-t[1],o=r*r+a*a,o<n)return e[i]}return null}function IB(e,t){for(var n=e.length,i,r,a;--n>=0;){if(e[n].defined===!1)continue;if(i=e[n].x-t[0],r=e[n].y-t[1],a=i*i+r*r,i=e[n].size||1,a<i*i)return e[n]}return null}function ky(e,t,n){function i(l,u){var c=u.mark.items;c.length&&l("d",t(null,c))}function r(l,u){var c=u.items;return c.length===0?l:(t(gn(l),c),kr(l,c[0]))}function a(l,u){l.beginPath(),t(l,u)}var o=uh(a);function s(l,u,c,f,d,h){var p=u.items,g=u.bounds;return!p||!p.length||g&&!g.contains(d,h)?null:(c*=l.pixelRatio,f*=l.pixelRatio,o(l,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:$B(a),pick:s,isect:yy,tip:n}}var MB=ky("area",bB,NB);function jB(e,t){var n=t.clip;e.save(),ge(n)?(e.beginPath(),n(e),e.clip()):oO(e,t.group)}function oO(e,t){e.beginPath(),hy(t)?Vs(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function sO(e){const t=pi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function LB(e,t){e("transform",rO(t))}function lO(e,t){const n=sO(t);e("d",Vs(null,t,n,n))}function PB(e,t){e("class","background"),e("aria-hidden",!0),lO(e,t)}function zB(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?lO(e,t):e("d","")}function BB(e,t,n){const i=t.clip?py(n,t,t):null;e("clip-path",i)}function UB(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),kr(e,t),e.translate(t.x||0,t.y||0)}function ch(e,t,n,i){const r=sO(t);e.beginPath(),Vs(e,t,(n||0)+r,(i||0)+r)}const uO=uh(ch),qB=uh(ch,!1);function WB(e,t,n){gi(t,i=>{const r=i.x||0,a=i.y||0,o=i.strokeForeground,s=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&s&&(ch(e,i,r,a),Js(e,i),i.fill&&oh(e,i,s)&&e.fill(),i.stroke&&!o&&Ks(e,i,s)&&e.stroke()),e.save(),e.translate(r,a),i.clip&&oO(e,i),n&&n.translate(-r,-a),gi(i,l=>{this.draw(e,l,n)}),n&&n.translate(r,a),e.restore(),o&&i.stroke&&s&&(ch(e,i,r,a),Js(e,i),Ks(e,i,s)&&e.stroke())})}function GB(e,t,n,i,r,a){if(t.bounds&&!t.bounds.contains(r,a)||!t.items)return null;const o=n*e.pixelRatio,s=i*e.pixelRatio;return sh(t,l=>{let u,c,f,d,h,p,g,m,v;return m=l.bounds,m&&!m.contains(r,a)?void 0:(d=l.x||0,h=l.y||0,p=d+(l.width||0),g=h+(l.height||0),v=l.clip,v&&(r<d||r>p||a<h||a>g)?void 0:(e.save(),e.translate(d,h),d=r-d,h=a-h,v&&hy(l)&&!uO(e,l,o,s)?(e.restore(),null):(c=l.strokeForeground,f=t.interactive!==!1,f&&c&&l.stroke&&qB(e,l,o,s)?(e.restore(),l):(u=sh(l,y=>HB(y,d,h)?this.pick(y,n,i,d,h):null),!u&&f&&(l.fill||!c&&l.stroke)&&uO(e,l,o,s)&&(u=l),e.restore(),u||null))))})}function HB(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var YB={type:"group",tag:"g",nested:!1,attr:LB,bound:UB,draw:WB,pick:GB,isect:QS,content:BB,background:PB,foreground:zB},Zs={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function _y(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function Ay(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function Sy(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function fh(e,t){return e==="center"?t/2:e==="right"?t:0}function dh(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function VB(e,t,n){const i=_y(t,n),r=Ay(t,i),a=Sy(t,i),o=(t.x||0)-fh(t.align,r),s=(t.y||0)-dh(t.baseline,a),l=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",l,Zs["xmlns:xlink"],"xlink:href"),e("transform",Qs(o,s)),e("width",r),e("height",a),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function XB(e,t){const n=t.image,i=Ay(t,n),r=Sy(t,n),a=(t.x||0)-fh(t.align,i),o=(t.y||0)-dh(t.baseline,r);return e.set(a,o,a+i,o+r)}function JB(e,t,n){gi(t,i=>{if(n&&!n.intersects(i.bounds))return;let r=_y(i,this),a=Ay(i,r),o=Sy(i,r),s=(i.x||0)-fh(i.align,a),l=(i.y||0)-dh(i.baseline,o),u,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=a/c,l+=(o-d)/2,o=d):(d=o*c,s+=(a-d)/2,a=d))),(r.complete||r.toDataURL)&&(Js(e,i),e.globalAlpha=(u=i.opacity)!=null?u:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,s,l,a,o))})}var KB={type:"image",tag:"image",nested:!1,attr:VB,bound:XB,draw:JB,pick:lh(),isect:Fi,get:_y,xOffset:fh,yOffset:dh},QB=ky("line",wB,FB);function ZB(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",aO(t)),e("d",t.path)}function hh(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*xr,l=t.pathCache;(!l||l.path!==n)&&((t.pathCache=l=Hs(n)).path=n),s&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(s),$u(e,l,0,0,a,o),e.rotate(-s),e.translate(-i,-r)):$u(e,l,i,r,a,o)}function eU(e,t){return hh(gn(e),t)?e.set(0,0,0,0):kr(e,t,!0),t.angle&&e.rotate(t.angle*xr,t.x||0,t.y||0),e}var tU={type:"path",tag:"path",nested:!1,attr:ZB,bound:eU,draw:wy(hh),pick:xy(hh),isect:vy(hh)};function nU(e,t){e("d",Vs(null,t))}function iU(e,t){var n,i;return kr(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function cO(e,t){e.beginPath(),Vs(e,t)}var rU={type:"rect",tag:"path",nested:!1,attr:nU,bound:iU,draw:wy(cO),pick:xy(cO),isect:QS};function aU(e,t){e("transform",rO(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function oU(e,t){var n,i;return kr(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function fO(e,t,n){var i,r,a,o;return t.stroke&&Ks(e,t,n)?(i=t.x||0,r=t.y||0,a=t.x2!=null?t.x2:i,o=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(a,o),!0):!1}function sU(e,t,n){gi(t,function(i){if(n&&!n.intersects(i.bounds))return;var r=i.opacity==null?1:i.opacity;r&&fO(e,i,r)&&(Js(e,i),e.stroke())})}function lU(e,t,n,i){return e.isPointInStroke?fO(e,t,1)&&e.isPointInStroke(n,i):!1}var uU={type:"rule",tag:"line",nested:!1,attr:aU,bound:oU,draw:sU,pick:lh(lU),isect:ZS},cU=Ey("shape",xB),fU=Ey("symbol",EB,yy);const dO=F5();var el={height:zi,measureWidth:Ty,estimateWidth:Oy,width:Oy,canvas:hO};hO(!0);function hO(e){el.width=e&&ha?Ty:Oy}function Oy(e,t){return pO(ga(e,t),zi(e))}function pO(e,t){return~~(.8*e.length*t)}function Ty(e,t){return zi(e)<=0||!(t=ga(e,t))?0:gO(t,ph(e))}function gO(e,t){const n=`(${t}) ${e}`;let i=dO.get(n);return i===void 0&&(ha.font=t,i=ha.measureText(e).width,dO.set(n,i)),i}function zi(e){return e.fontSize!=null?+e.fontSize||0:11}function pa(e){return e.lineHeight!=null?e.lineHeight:zi(e)+2}function dU(e){return I(e)?e.length>1?e:e[0]:e}function ju(e){return dU(e.lineBreak&&e.text&&!I(e.text)?e.text.split(e.lineBreak):e.text)}function Cy(e){const t=ju(e);return(I(t)?t.length-1:0)*pa(e)}function ga(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?pU(e,n):n}function hU(e){if(el.width===Ty){const t=ph(e);return n=>gO(n,t)}else{const t=zi(e);return n=>pO(n,t)}}function pU(e,t){var n=+e.limit,i=hU(e);if(i(t)<n)return t;var r=e.ellipsis||"â€¦",a=e.dir==="rtl",o=0,s=t.length,l;if(n-=i(r),a){for(;o<s;)l=o+s>>>1,i(t.slice(l))>n?o=l+1:s=l;return r+t.slice(o)}else{for(;o<s;)l=1+(o+s>>>1),i(t.slice(0,l))<n?o=l:s=l-1;return t.slice(0,o)+r}}function Lu(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function ph(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+zi(e)+"px "+Lu(e,t)}function $y(e){var t=e.baseline,n=zi(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*pa(e):t==="line-bottom"?.29*n-.5*pa(e):0)}var gU={left:"start",center:"middle",right:"end"},Pu=new st();function gh(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-So,t+=i*Math.cos(r),n+=i*Math.sin(r)),Pu.x1=t,Pu.y1=n,Pu}function mU(e,t){var n=t.dx||0,i=(t.dy||0)+$y(t),r=gh(t),a=r.x1,o=r.y1,s=t.angle||0,l;e("text-anchor",gU[t.align]||"start"),s?(l=Qs(a,o)+" "+iO(s),(n||i)&&(l+=" "+Qs(n,i))):l=Qs(a+n,o+i),e("transform",l)}function Dy(e,t,n){var i=el.height(t),r=t.align,a=gh(t),o=a.x1,s=a.y1,l=t.dx||0,u=(t.dy||0)+$y(t)-Math.round(.8*i),c=ju(t),f;if(I(c)?(i+=pa(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,el.width(t,h)),0)):f=el.width(t,c),r==="center"?l-=f/2:r==="right"&&(l-=f),e.set(l+=o,u+=s,l+f,u+i),t.angle&&!n)e.rotate(t.angle*xr,o,s);else if(n===2)return e.rotatedPoints(t.angle*xr,o,s);return e}function vU(e,t,n){gi(t,function(i){var r=i.opacity==null?1:i.opacity,a,o,s,l,u,c,f;if(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)return;if(e.font=ph(i),e.textAlign=i.align||"left",a=gh(i),o=a.x1,s=a.y1,i.angle&&(e.save(),e.translate(o,s),e.rotate(i.angle*xr),o=s=0),o+=i.dx||0,s+=(i.dy||0)+$y(i),c=ju(i),Js(e,i),I(c))for(u=pa(i),l=0;l<c.length;++l)f=ga(i,c[l]),i.fill&&oh(e,i,r)&&e.fillText(f,o,s),i.stroke&&Ks(e,i,r)&&e.strokeText(f,o,s),s+=u;else f=ga(i,c),i.fill&&oh(e,i,r)&&e.fillText(f,o,s),i.stroke&&Ks(e,i,r)&&e.strokeText(f,o,s);i.angle&&e.restore()})}function yU(e,t,n,i,r,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=gh(t),s=o.x1,l=o.y1,u=Dy(Pu,t,1),c=-t.angle*xr,f=Math.cos(c),d=Math.sin(c),h=f*r-d*a+(s-f*s+d*l),p=d*r+f*a+(l-d*s-f*l);return u.contains(h,p)}function bU(e,t){var n=Dy(Pu,e,2);return Xs(t,n[0],n[1],n[2],n[3])||Xs(t,n[0],n[1],n[4],n[5])||Xs(t,n[4],n[5],n[6],n[7])||Xs(t,n[2],n[3],n[6],n[7])}var wU={type:"text",tag:"text",nested:!1,attr:mU,bound:Dy,draw:vU,pick:lh(yU),isect:bU},xU=ky("trail",kB,IB),Yn={arc:RB,area:MB,group:YB,image:KB,line:QB,path:tU,rect:rU,rule:uU,shape:cU,symbol:fU,text:wU,trail:xU};function Ry(e,t,n){var i=Yn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new st()),e,n)}var mO={mark:null};function vO(e,t,n){var i=Yn[e.marktype],r=i.bound,a=e.items,o=a&&a.length,s,l,u,c;if(i.nested)return o?u=a[0]:(mO.mark=e,u=mO),c=Ry(u,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new st(),o)for(s=0,l=a.length;s<l;++s)t.union(Ry(a[s],r,n));return e.bounds=t}var EU=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function yO(e,t){return JSON.stringify(e,EU,t)}function bO(e){var t=typeof e=="string"?JSON.parse(e):e;return wO(t)}function wO(e){var t=e.marktype,n=e.items,i,r,a;if(n)for(r=0,a=n.length;r<a;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&wO(n[r]);return t&&vO(e),e}function Ny(e){arguments.length?this.root=bO(e):(this.root=EO({marktype:"group",name:"root",role:"frame"}),this.root.items=[new th(this.root)])}var xO=Ny.prototype;xO.toJSON=function(e){return yO(this.root,e||0)},xO.mark=function(e,t,n){t=t||this.root.items[0];var i=EO(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};function EO(e,t){const n={bounds:new st(),clip:!!e.clip,group:t,interactive:!(e.interactive===!1),items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function ma(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Fy(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function In(e,t,n,i){var r=e.childNodes[t],a;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(a=r||null,r=ma(e.ownerDocument,n,i),e.insertBefore(r,a)),r}function mi(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function kO(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function mh(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function kU(e,t,n,i){var r=e&&e.mark,a,o;if(r&&(a=Yn[r.marktype]).tip){for(o=mh(t,n),o[0]-=i[0],o[1]-=i[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=a.tip(r.items,o)}return e}function va(e,t){this._active=null,this._handlers={},this._loader=e||Dd(),this._tooltip=t||_U}function _U(e,t,n,i){e.element().setAttribute("title",i||"")}const Mn=va.prototype;Mn.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},Mn.element=function(){return this._el},Mn.canvas=function(){return this._el&&this._el.firstChild},Mn.origin=function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},Mn.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},Mn.on=function(){},Mn.off=function(){},Mn._handlerIndex=function(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},Mn.handlers=function(e){const t=this._handlers,n=[];if(e)n.push.apply(n,t[this.eventName(e)]);else for(const i in t)n.push.apply(n,t[i]);return n},Mn.eventName=function(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},Mn.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),a=ma(null,"a");for(const o in i)a.setAttribute(o,i[o]);a.dispatchEvent(r)}).catch(function(){})},Mn.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=kU(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},Mn.getItemBoundingClientRect=function(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,a=r.width(),o=r.height();let s=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}};function vi(e){this._el=null,this._bgcolor=null,this._loader=new gy(e)}var Vn=vi.prototype;Vn.initialize=function(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},Vn.element=function(){return this._el},Vn.canvas=function(){return this._el&&this._el.firstChild},Vn.background=function(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},Vn.resize=function(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},Vn.dirty=function(){},Vn.render=function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},Vn._render=function(){},Vn.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)},Vn._load=function(e,t){var n=this,i=n._loader[e](t);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then(function(a){a&&r(),n._ready=null})}return i},Vn.sanitizeURL=function(e){return this._load("sanitizeURL",e)},Vn.loadImage=function(e){return this._load("loadImage",e)};const AU="keydown",SU="keypress",OU="keyup",_O="dragenter",vh="dragleave",AO="dragover",Iy="mousedown",TU="mouseup",yh="mousemove",zu="mouseout",SO="mouseover",bh="click",CU="dblclick",$U="wheel",OO="mousewheel",wh="touchstart",xh="touchmove",Eh="touchend",DU=[AU,SU,OU,_O,vh,AO,Iy,TU,yh,zu,SO,bh,CU,$U,OO,wh,xh,Eh],My=yh,Bu=zu,jy=bh;function Uu(e,t){va.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const lt=P(Uu,va);lt.initialize=function(e,t,n){return this._canvas=e&&Fy(e,"canvas"),[bh,Iy,yh,zu,vh].forEach(i=>TO(this,i)),va.prototype.initialize.call(this,e,t,n)};const RU=e=>e===wh||e===xh||e===Eh?[wh,xh,Eh]:[e];function TO(e,t){RU(t).forEach(n=>NU(e,n))}function NU(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}lt.canvas=function(){return this._canvas},lt.context=function(){return this._canvas.getContext("2d")},lt.events=DU;function CO(e,t,n){return function(i){const r=this._active,a=this.pickEvent(i);a===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=a,this.fire(t,i),this.fire(e,i))}}function $O(e){return function(t){this.fire(e,t),this._active=null}}lt.DOMMouseScroll=function(e){this.fire(OO,e)},lt.mousemove=CO(yh,SO,zu),lt.dragover=CO(AO,_O,vh),lt.mouseout=$O(zu),lt.dragleave=$O(vh),lt.mousedown=function(e){this._down=this._active,this.fire(Iy,e)},lt.click=function(e){this._down===this._active&&(this.fire(bh,e),this._down=null)},lt.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(wh,e,!0)},lt.touchmove=function(e){this.fire(xh,e,!0)},lt.touchend=function(e){this.fire(Eh,e,!0),this._touch=null},lt.fire=function(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===jy&&i&&i.href?this.handleHref(t,i,i.href):(e===My||e===Bu)&&this.handleTooltip(t,i,e!==Bu),r)for(let a=0,o=r.length;a<o;++a)r[a].handler.call(this._obj,t,i)},lt.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);return r<0&&(TO(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},lt.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},lt.pickEvent=function(e){const t=mh(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},lt.pick=function(e,t,n,i,r){const a=this.context(),o=Yn[e.marktype];return o.pick.call(this,a,e,t,n,i,r)};function FU(){return typeof window!="undefined"&&window.devicePixelRatio||1}var IU=FU();function MU(e,t,n,i,r,a){const o=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),l=o?IU:r;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];return o&&l!==1&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*i[0],l*i[1]),e}function kh(e){vi.call(this,e),this._options={},this._redraw=!1,this._dirty=new st(),this._tempb=new st()}const ya=P(kh,vi),DO=vi.prototype;ya.initialize=function(e,t,n,i,r,a){return this._options=a||{},this._canvas=this._options.externalContext?null:Fu(1,1,this._options.type),e&&this._canvas&&(mi(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),DO.initialize.call(this,e,t,n,i,r)},ya.resize=function(e,t,n,i){if(DO.resize.call(this,e,t,n,i),this._canvas)MU(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||N("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},ya.canvas=function(){return this._canvas},ya.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},ya.dirty=function(e){let t=this._tempb.clear().union(e.bounds),n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)};function jU(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}const LU=(e,t,n)=>new st().set(0,0,t,n).translate(-e[0],-e[1]);ya._render=function(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,a=this._dirty,o=LU(n,i,r);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):jU(t,o.intersect(a),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,s),t.restore(),a.clear(),this},ya.draw=function(e,t,n){const i=Yn[t.marktype];t.clip&&jB(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},ya.clear=function(e,t,n,i){const r=this._options,a=this.context();r.type!=="pdf"&&!r.externalContext&&a.clearRect(e,t,n,i),this._bgcolor!=null&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,i))};function Ly(e,t){va.call(this,e,t);const n=this;n._hrefHandler=Py(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=Py(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Bu)})}const _h=P(Ly,va);_h.initialize=function(e,t,n){let i=this._svg;return i&&(i.removeEventListener(jy,this._hrefHandler),i.removeEventListener(My,this._tooltipHandler),i.removeEventListener(Bu,this._tooltipHandler)),this._svg=i=e&&Fy(e,"svg"),i&&(i.addEventListener(jy,this._hrefHandler),i.addEventListener(My,this._tooltipHandler),i.addEventListener(Bu,this._tooltipHandler)),va.prototype.initialize.call(this,e,t,n)},_h.canvas=function(){return this._svg};const Py=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};_h.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);if(r<0){const a={type:e,handler:t,listener:Py(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},_h.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this};function zy(e,t,n){var i=e-t+n*2;return e?i>0?i:1:0}const PU="identity",tl="linear",_r="log",qu="pow",Wu="sqrt",Ah="symlog",To="time",Co="utc",Bi="sequential",nl="diverging",il="quantile",Sh="quantize",Oh="threshold",By="ordinal",Uy="point",RO="band",qy="bin-ordinal",ut="continuous",Gu="discrete",Hu="discretizing",Xn="interpolating",Wy="temporal";function zU(e){return function(t){var n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function BU(e){return function(t){var n=e.range(),i=t[0],r=t[1],a=-1,o,s,l,u;for(r<i&&(s=i,i=r,r=s),l=0,u=n.length;l<u;++l)n[l]>=i&&n[l]<=r&&(a<0&&(a=l),o=l);return a<0?void 0:(i=e.invertExtent(n[a]),r=e.invertExtent(n[o]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]])}}function Ui(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ba(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const Gy=Symbol("implicit");function Hy(){var e=new Map(),t=[],n=[],i=Gy;function r(a){var o=a+"",s=e.get(o);if(!s){if(i!==Gy)return i;e.set(o,s=t.push(a))}return n[(s-1)%n.length]}return r.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new Map();for(const o of a){const s=o+"";if(e.has(s))continue;e.set(s,t.push(o))}return r},r.range=function(a){return arguments.length?(n=Array.from(a),r):n.slice()},r.unknown=function(a){return arguments.length?(i=a,r):i},r.copy=function(){return Hy(t,n).unknown(i)},Ui.apply(r,arguments),r}function rl(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Yu(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function wa(){}var $o=.7,al=1/$o,ol="\\s*([+-]?\\d+)\\s*",Vu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",qi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",UU=/^#([0-9a-f]{3,8})$/,qU=new RegExp("^rgb\\("+[ol,ol,ol]+"\\)$"),WU=new RegExp("^rgb\\("+[qi,qi,qi]+"\\)$"),GU=new RegExp("^rgba\\("+[ol,ol,ol,Vu]+"\\)$"),HU=new RegExp("^rgba\\("+[qi,qi,qi,Vu]+"\\)$"),YU=new RegExp("^hsl\\("+[Vu,qi,qi]+"\\)$"),VU=new RegExp("^hsla\\("+[Vu,qi,qi,Vu]+"\\)$"),NO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};rl(wa,Xu,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:FO,formatHex:FO,formatHsl:XU,formatRgb:IO,toString:IO});function FO(){return this.rgb().formatHex()}function XU(){return zO(this).formatHsl()}function IO(){return this.rgb().formatRgb()}function Xu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=UU.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?MO(t):n===3?new St(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Th(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Th(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=qU.exec(e))?new St(t[1],t[2],t[3],1):(t=WU.exec(e))?new St(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=GU.exec(e))?Th(t[1],t[2],t[3],t[4]):(t=HU.exec(e))?Th(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=YU.exec(e))?PO(t[1],t[2]/100,t[3]/100,1):(t=VU.exec(e))?PO(t[1],t[2]/100,t[3]/100,t[4]):NO.hasOwnProperty(e)?MO(NO[e]):e==="transparent"?new St(NaN,NaN,NaN,0):null}function MO(e){return new St(e>>16&255,e>>8&255,e&255,1)}function Th(e,t,n,i){return i<=0&&(e=t=n=NaN),new St(e,t,n,i)}function Yy(e){return e instanceof wa||(e=Xu(e)),e?(e=e.rgb(),new St(e.r,e.g,e.b,e.opacity)):new St()}function xa(e,t,n,i){return arguments.length===1?Yy(e):new St(e,t,n,i??1)}function St(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}rl(St,xa,Yu(wa,{brighter:function(e){return e=e==null?al:Math.pow(al,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?$o:Math.pow($o,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jO,formatHex:jO,formatRgb:LO,toString:LO}));function jO(){return"#"+Vy(this.r)+Vy(this.g)+Vy(this.b)}function LO(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Vy(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function PO(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Wi(e,t,n,i)}function zO(e){if(e instanceof Wi)return new Wi(e.h,e.s,e.l,e.opacity);if(e instanceof wa||(e=Xu(e)),!e)return new Wi();if(e instanceof Wi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(t===a?o=(n-i)/s+(n<i)*6:n===a?o=(i-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new Wi(o,s,l,e.opacity)}function Ch(e,t,n,i){return arguments.length===1?zO(e):new Wi(e,t,n,i??1)}function Wi(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}rl(Wi,Ch,Yu(wa,{brighter:function(e){return e=e==null?al:Math.pow(al,e),new Wi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?$o:Math.pow($o,e),new Wi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new St(Xy(e>=240?e-240:e+120,r,i),Xy(e,r,i),Xy(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Xy(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var BO=Math.PI/180,UO=180/Math.PI,$h=18,qO=.96422,WO=1,GO=.82521,HO=4/29,sl=6/29,YO=3*sl*sl,JU=sl*sl*sl;function VO(e){if(e instanceof Gi)return new Gi(e.l,e.a,e.b,e.opacity);if(e instanceof Ar)return XO(e);e instanceof St||(e=Yy(e));var t=Zy(e.r),n=Zy(e.g),i=Zy(e.b),r=Jy((.2225045*t+.7168786*n+.0606169*i)/WO),a,o;return t===n&&n===i?a=o=r:(a=Jy((.4360747*t+.3850649*n+.1430804*i)/qO),o=Jy((.0139322*t+.0971045*n+.7141733*i)/GO)),new Gi(116*r-16,500*(a-r),200*(r-o),e.opacity)}function Dh(e,t,n,i){return arguments.length===1?VO(e):new Gi(e,t,n,i??1)}function Gi(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}rl(Gi,Dh,Yu(wa,{brighter:function(e){return new Gi(this.l+$h*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Gi(this.l-$h*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=qO*Ky(t),e=WO*Ky(e),n=GO*Ky(n),new St(Qy(3.1338561*t-1.6168667*e-.4906146*n),Qy(-.9787684*t+1.9161415*e+.033454*n),Qy(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Jy(e){return e>JU?Math.pow(e,1/3):e/YO+HO}function Ky(e){return e>sl?e*e*e:YO*(e-HO)}function Qy(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Zy(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function KU(e){if(e instanceof Ar)return new Ar(e.h,e.c,e.l,e.opacity);if(e instanceof Gi||(e=VO(e)),e.a===0&&e.b===0)return new Ar(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*UO;return new Ar(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Rh(e,t,n,i){return arguments.length===1?KU(e):new Ar(e,t,n,i??1)}function Ar(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function XO(e){if(isNaN(e.h))return new Gi(e.l,0,0,e.opacity);var t=e.h*BO;return new Gi(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}rl(Ar,Rh,Yu(wa,{brighter:function(e){return new Ar(this.h,this.c,this.l+$h*(e??1),this.opacity)},darker:function(e){return new Ar(this.h,this.c,this.l-$h*(e??1),this.opacity)},rgb:function(){return XO(this).rgb()}}));var JO=-.14861,eb=1.78277,tb=-.29227,Nh=-.90649,Ju=1.97294,KO=Ju*Nh,QO=Ju*eb,ZO=eb*tb-Nh*JO;function QU(e){if(e instanceof Do)return new Do(e.h,e.s,e.l,e.opacity);e instanceof St||(e=Yy(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(ZO*i+KO*t-QO*n)/(ZO+KO-QO),a=i-r,o=(Ju*(n-r)-tb*a)/Nh,s=Math.sqrt(o*o+a*a)/(Ju*r*(1-r)),l=s?Math.atan2(o,a)*UO-120:NaN;return new Do(l<0?l+360:l,s,r,e.opacity)}function nb(e,t,n,i){return arguments.length===1?QU(e):new Do(e,t,n,i??1)}function Do(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}rl(Do,nb,Yu(wa,{brighter:function(e){return e=e==null?al:Math.pow(al,e),new Do(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?$o:Math.pow($o,e),new Do(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*BO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new St(255*(t+n*(JO*i+eb*r)),255*(t+n*(tb*i+Nh*r)),255*(t+n*(Ju*i)),this.opacity)}}));function eT(e,t,n,i,r){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*i+o*r)/6}function tT(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1],o=i>0?e[i-1]:2*r-a,s=i<t-1?e[i+2]:2*a-r;return eT((n-i/t)*t,o,r,a,s)}}function nT(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],a=e[i%t],o=e[(i+1)%t],s=e[(i+2)%t];return eT((n-i/t)*t,r,a,o,s)}}function Fh(e){return function(){return e}}function iT(e,t){return function(n){return e+n*t}}function ZU(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Ih(e,t){var n=t-e;return n?iT(e,n>180||n<-180?n-360*Math.round(n/360):n):Fh(isNaN(e)?t:e)}function eq(e){return(e=+e)===1?mt:function(t,n){return n-t?ZU(t,n,e):Fh(isNaN(t)?n:t)}}function mt(e,t){var n=t-e;return n?iT(e,n):Fh(isNaN(e)?t:e)}var ib=function e(t){var n=eq(t);function i(r,a){var o=n((r=xa(r)).r,(a=xa(a)).r),s=n(r.g,a.g),l=n(r.b,a.b),u=mt(r.opacity,a.opacity);return function(c){return r.r=o(c),r.g=s(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=e,i}(1);function rT(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o)s=xa(t[o]),i[o]=s.r||0,r[o]=s.g||0,a[o]=s.b||0;return i=e(i),r=e(r),a=e(a),s.opacity=1,function(l){return s.r=i(l),s.g=r(l),s.b=a(l),s+""}}}var tq=rT(tT),nq=rT(nT);function rb(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function aT(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function iq(e,t){return(aT(t)?rb:oT)(e,t)}function oT(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),a=new Array(n),o;for(o=0;o<i;++o)r[o]=Ro(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=r[o](s);return a}}function sT(e,t){var n=new Date();return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function yi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function lT(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ro(e[r],t[r]):i[r]=t[r];return function(a){for(r in n)i[r]=n[r](a);return i}}var ab=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ob=new RegExp(ab.source,"g");function rq(e){return function(){return e}}function aq(e){return function(t){return e(t)+""}}function uT(e,t){var n=ab.lastIndex=ob.lastIndex=0,i,r,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(i=ab.exec(e))&&(r=ob.exec(t));)(a=r.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:yi(i,r)})),n=ob.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?aq(l[0].x):rq(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function Ro(e,t){var n=typeof t,i;return t==null||n==="boolean"?Fh(t):(n==="number"?yi:n==="string"?(i=Xu(t))?(t=i,ib):uT:t instanceof Xu?ib:t instanceof Date?sT:aT(t)?rb:Array.isArray(t)?oT:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?lT:yi)(e,t)}function oq(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function sq(e,t){var n=Ih(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function Ku(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var cT=180/Math.PI,sb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function fT(e,t,n,i,r,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*cT,skewX:Math.atan(l)*cT,scaleX:o,scaleY:s}}var Qu,lb,dT,Mh;function lq(e){return e==="none"?sb:(Qu||(Qu=document.createElement("DIV"),lb=document.documentElement,dT=document.defaultView),Qu.style.transform=e,e=dT.getComputedStyle(lb.appendChild(Qu),null).getPropertyValue("transform"),lb.removeChild(Qu),e=e.slice(7,-1).split(","),fT(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function uq(e){return e==null?sb:(Mh||(Mh=document.createElementNS("http://www.w3.org/2000/svg","g")),Mh.setAttribute("transform",e),(e=Mh.transform.baseVal.consolidate())?(e=e.matrix,fT(e.a,e.b,e.c,e.d,e.e,e.f)):sb)}function hT(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function a(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push("translate(",null,t,null,n);p.push({i:g-4,x:yi(u,f)},{i:g-2,x:yi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function o(u,c,f,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:yi(u,c)})):c&&f.push(r(f)+"rotate("+c+i)}function s(u,c,f,d){u!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:yi(u,c)}):c&&f.push(r(f)+"skewX("+c+i)}function l(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push(r(h)+"scale(",null,",",null,")");p.push({i:g-4,x:yi(u,f)},{i:g-2,x:yi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(u,c){var f=[],d=[];return u=e(u),c=e(c),a(u.translateX,u.translateY,c.translateX,c.translateY,f,d),o(u.rotate,c.rotate,f,d),s(u.skewX,c.skewX,f,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,d),u=c=null,function(h){for(var p=-1,g=d.length,m;++p<g;)f[(m=d[p]).i]=m.x(h);return f.join("")}}}var cq=hT(lq,"px, ","px)","deg)"),fq=hT(uq,", ",")",")"),Zu=Math.SQRT2,ub=2,pT=4,dq=1e-12;function gT(e){return((e=Math.exp(e))+1/e)/2}function hq(e){return((e=Math.exp(e))-1/e)/2}function pq(e){return((e=Math.exp(2*e))-1)/(e+1)}function gq(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],o=t[1],s=t[2],l=a-n,u=o-i,c=l*l+u*u,f,d;if(c<dq)d=Math.log(s/r)/Zu,f=function(y){return[n+y*l,i+y*u,r*Math.exp(Zu*y*d)]};else{var h=Math.sqrt(c),p=(s*s-r*r+pT*c)/(2*r*ub*h),g=(s*s-r*r-pT*c)/(2*s*ub*h),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);d=(v-m)/Zu,f=function(y){var b=y*d,E=gT(m),x=r/(ub*h)*(E*pq(Zu*b+m)-hq(m));return[n+x*l,i+x*u,r*E/gT(Zu*b+m)]}}return f.duration=d*1e3,f}function mT(e){return function(t,n){var i=e((t=Ch(t)).h,(n=Ch(n)).h),r=mt(t.s,n.s),a=mt(t.l,n.l),o=mt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.s=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var mq=mT(Ih),vq=mT(mt);function yq(e,t){var n=mt((e=Dh(e)).l,(t=Dh(t)).l),i=mt(e.a,t.a),r=mt(e.b,t.b),a=mt(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=i(o),e.b=r(o),e.opacity=a(o),e+""}}function vT(e){return function(t,n){var i=e((t=Rh(t)).h,(n=Rh(n)).h),r=mt(t.c,n.c),a=mt(t.l,n.l),o=mt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.c=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var bq=vT(Ih),wq=vT(mt);function yT(e){return function t(n){n=+n;function i(r,a){var o=e((r=nb(r)).h,(a=nb(a)).h),s=mt(r.s,a.s),l=mt(r.l,a.l),u=mt(r.opacity,a.opacity);return function(c){return r.h=o(c),r.s=s(c),r.l=l(Math.pow(c,n)),r.opacity=u(c),r+""}}return i.gamma=t,i}(1)}var xq=yT(Ih),Eq=yT(mt);function cb(e,t){for(var n=0,i=t.length-1,r=t[0],a=new Array(i<0?0:i);n<i;)a[n]=e(r,r=t[++n]);return function(o){var s=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return a[s](o-s)}}function kq(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}var _q=Object.freeze({__proto__:null,interpolate:Ro,interpolateArray:iq,interpolateBasis:tT,interpolateBasisClosed:nT,interpolateDate:sT,interpolateDiscrete:oq,interpolateHue:sq,interpolateNumber:yi,interpolateNumberArray:rb,interpolateObject:lT,interpolateRound:Ku,interpolateString:uT,interpolateTransformCss:cq,interpolateTransformSvg:fq,interpolateZoom:gq,interpolateRgb:ib,interpolateRgbBasis:tq,interpolateRgbBasisClosed:nq,interpolateHsl:mq,interpolateHslLong:vq,interpolateLab:yq,interpolateHcl:bq,interpolateHclLong:wq,interpolateCubehelix:xq,interpolateCubehelixLong:Eq,piecewise:cb,quantize:kq});function Aq(e){return function(){return e}}function fb(e){return+e}var bT=[0,1];function mn(e){return e}function db(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Aq(isNaN(t)?NaN:.5)}function Sq(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function Oq(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];return r<i?(i=db(r,i),a=n(o,a)):(i=db(i,r),a=n(a,o)),function(s){return a(i(s))}}function Tq(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=db(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(s){var l=na(e,s,1,i)-1;return a[l](r[l](s))}}function ec(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function jh(){var e=bT,t=bT,n=Ro,i,r,a,o=mn,s,l,u;function c(){var d=Math.min(e.length,t.length);return o!==mn&&(o=Sq(e[0],e[d-1])),s=d>2?Tq:Oq,l=u=null,f}function f(d){return isNaN(d=+d)?a:(l||(l=s(e.map(i),t,n)))(i(o(d)))}return f.invert=function(d){return o(r((u||(u=s(t,e.map(i),yi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,fb),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=Ku,c()},f.clamp=function(d){return arguments.length?(o=d?!0:mn,c()):o!==mn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(a=d,f):a},function(d,h){return i=d,r=h,c()}}function wT(){return jh()(mn,mn)}function xT(e,t,n,i){var r=ia(e,t,n),a;i=Ds(i??",f");switch(i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(a=r_(r,o))&&(i.precision=a),x0(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=a_(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=i_(r))&&(i.precision=a-(i.type==="%")*2);break}}return kd(i)}function No(e){var t=e.domain;return e.ticks=function(n){var i=t();return y0(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return xT(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,a=i.length-1,o=i[r],s=i[a],l;return s<o&&(l=o,o=s,s=l,l=r,r=a,a=l),l=bd(o,s,n),l>0?(o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l,l=bd(o,s,n)):l<0&&(o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l,l=bd(o,s,n)),l>0?(i[r]=Math.floor(o/l)*l,i[a]=Math.ceil(s/l)*l,t(i)):l<0&&(i[r]=Math.ceil(o*l)/l,i[a]=Math.floor(s*l)/l,t(i)),e},e}function ET(){var e=wT();return e.copy=function(){return ec(e,ET())},Ui.apply(e,arguments),No(e)}function kT(e){var t;function n(i){return isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,fb),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return kT(e).unknown(t)},e=arguments.length?Array.from(e,fb):[0,1],No(n)}function _T(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],a=e[i],o;return a<r&&(o=n,n=i,i=o,o=r,r=a,a=o),e[n]=t.floor(r),e[i]=t.ceil(a),e}function AT(e){return Math.log(e)}function ST(e){return Math.exp(e)}function Cq(e){return-Math.log(-e)}function $q(e){return-Math.exp(-e)}function Dq(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Rq(e){return e===10?Dq:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function Nq(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function OT(e){return function(t){return-e(-t)}}function hb(e){var t=e(AT,ST),n=t.domain,i=10,r,a;function o(){return r=Nq(i),a=Rq(i),n()[0]<0?(r=OT(r),a=OT(a),e(Cq,$q)):e(AT,ST),t}return t.base=function(s){return arguments.length?(i=+s,o()):i},t.domain=function(s){return arguments.length?(n(s),o()):n()},t.ticks=function(s){var l=n(),u=l[0],c=l[l.length-1],f;(f=c<u)&&(d=u,u=c,c=d);var d=r(u),h=r(c),p,g,m,v=s==null?10:+s,y=[];if(!(i%1)&&h-d<v){if(d=Math.floor(d),h=Math.ceil(h),u>0)for(;d<=h;++d)for(g=1,p=a(d);g<i;++g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}else for(;d<=h;++d)for(g=i-1,p=a(d);g>=1;--g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}y.length*2<v&&(y=y0(u,c,v))}else y=y0(d,h,Math.min(h-d,v)).map(a);return f?y.reverse():y},t.tickFormat=function(s,l){if(l==null&&(l=i===10?".0e":","),typeof l!="function"&&(l=kd(l)),s===Infinity)return l;s==null&&(s=10);var u=Math.max(1,i*s/t.ticks().length);return function(c){var f=c/a(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=u?l(c):""}},t.nice=function(){return n(_T(n(),{floor:function(s){return a(Math.floor(r(s)))},ceil:function(s){return a(Math.ceil(r(s)))}}))},t}function TT(){var e=hb(jh()).domain([1,10]);return e.copy=function(){return ec(e,TT()).base(e.base())},Ui.apply(e,arguments),e}function CT(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function $T(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function pb(e){var t=1,n=e(CT(t),$T(t));return n.constant=function(i){return arguments.length?e(CT(t=+i),$T(t)):t},No(n)}function DT(){var e=pb(jh());return e.copy=function(){return ec(e,DT()).constant(e.constant())},Ui.apply(e,arguments)}function RT(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Fq(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Iq(e){return e<0?-e*e:e*e}function gb(e){var t=e(mn,mn),n=1;function i(){return n===1?e(mn,mn):n===.5?e(Fq,Iq):e(RT(n),RT(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},No(t)}function mb(){var e=gb(jh());return e.copy=function(){return ec(e,mb()).exponent(e.exponent())},Ui.apply(e,arguments),e}function Mq(){return mb.apply(null,arguments).exponent(.5)}function NT(){var e=[],t=[],n=[],i;function r(){var o=0,s=Math.max(1,t.length);for(n=new Array(s-1);++o<s;)n[o-1]=wd(e,o/s);return a}function a(o){return isNaN(o=+o)?i:t[na(n,o)]}return a.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Cs),r()},a.range=function(o){return arguments.length?(t=Array.from(o),r()):t.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.quantiles=function(){return n.slice()},a.copy=function(){return NT().domain(e).range(t).unknown(i)},Ui.apply(a,arguments)}function FT(){var e=0,t=1,n=1,i=[.5],r=[0,1],a;function o(l){return l<=l?r[na(i,l,0,n)]:a}function s(){var l=-1;for(i=new Array(n);++l<n;)i[l]=((l+1)*t-(l-n)*e)/(n+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(n=(r=Array.from(l)).length-1,s()):r.slice()},o.invertExtent=function(l){var u=r.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,i[0]]:u>=n?[i[n-1],t]:[i[u-1],i[u]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return i.slice()},o.copy=function(){return FT().domain([e,t]).range(r).unknown(a)},Ui.apply(No(o),arguments)}function IT(){var e=[.5],t=[0,1],n,i=1;function r(a){return a<=a?t[na(e,a,0,i)]:n}return r.domain=function(a){return arguments.length?(e=Array.from(a),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(a){return arguments.length?(t=Array.from(a),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},r.unknown=function(a){return arguments.length?(n=a,r):n},r.copy=function(){return IT().domain(e).range(t).unknown(n)},Ui.apply(r,arguments)}var tc=1e3,nc=tc*60,ic=nc*60,rc=ic*24,jq=rc*7,MT=rc*30,vb=rc*365;function Lq(e){return new Date(e)}function Pq(e){return e instanceof Date?+e:+new Date(+e)}function yb(e,t,n,i,r,a,o,s,l){var u=wT(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),g=l("%I %p"),m=l("%a %d"),v=l("%b %d"),y=l("%B"),b=l("%Y"),E=[[o,1,tc],[o,5,5*tc],[o,15,15*tc],[o,30,30*tc],[a,1,nc],[a,5,5*nc],[a,15,15*nc],[a,30,30*nc],[r,1,ic],[r,3,3*ic],[r,6,6*ic],[r,12,12*ic],[i,1,rc],[i,2,2*rc],[n,1,jq],[t,1,MT],[t,3,3*MT],[e,1,vb]];function x(w){return(o(w)<w?d:a(w)<w?h:r(w)<w?p:i(w)<w?g:t(w)<w?n(w)<w?m:v:e(w)<w?y:b)(w)}function k(w,A,_){if(w==null&&(w=10),typeof w=="number"){var O=Math.abs(_-A)/w,S=yd(function(D){return D[2]}).right(E,O),T;return S===E.length?(T=ia(A/vb,_/vb,w),w=e):S?(S=E[O/E[S-1][2]<E[S][2]/O?S-1:S],T=S[1],w=S[0]):(T=Math.max(ia(A,_,w),1),w=s),w.every(T)}return w}return u.invert=function(w){return new Date(c(w))},u.domain=function(w){return arguments.length?f(Array.from(w,Pq)):f().map(Lq)},u.ticks=function(w){var A=f(),_=A[0],O=A[A.length-1],S=O<_,T;return S&&(T=_,_=O,O=T),T=k(w,_,O),T=T?T.range(_,O+1):[],S?T.reverse():T},u.tickFormat=function(w,A){return A==null?x:l(A)},u.nice=function(w){var A=f();return(w=k(w,A[0],A[A.length-1]))?f(_T(A,w)):u},u.copy=function(){return ec(u,yb(e,t,n,i,r,a,o,s,l))},u}function zq(){return Ui.apply(yb(ra,$0,Td,vo,h_,d_,Od,Rs,U0).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Bq(){return Ui.apply(yb(aa,N0,Cd,bo,g_,p_,Od,Rs,q0).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Lh(){var e=0,t=1,n,i,r,a,o=mn,s=!1,l;function u(f){return isNaN(f=+f)?l:o(r===0?.5:(f=(a(f)-n)*r,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,n=a(e=+e),i=a(t=+t),r=n===i?0:1/(i-n),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function c(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),u):[o(0),o(1)]}}return u.range=c(Ro),u.rangeRound=c(Ku),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return a=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),u}}function Ea(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function bb(){var e=No(Lh()(mn));return e.copy=function(){return Ea(e,bb())},ba.apply(e,arguments)}function jT(){var e=hb(Lh()).domain([1,10]);return e.copy=function(){return Ea(e,jT()).base(e.base())},ba.apply(e,arguments)}function LT(){var e=pb(Lh());return e.copy=function(){return Ea(e,LT()).constant(e.constant())},ba.apply(e,arguments)}function wb(){var e=gb(Lh());return e.copy=function(){return Ea(e,wb()).exponent(e.exponent())},ba.apply(e,arguments)}function Uq(){return wb.apply(null,arguments).exponent(.5)}function Ph(){var e=0,t=.5,n=1,i=1,r,a,o,s,l,u=mn,c,f=!1,d;function h(g){return isNaN(g=+g)?d:(g=.5+((g=+c(g))-a)*(i*g<i*a?s:l),u(f?Math.max(0,Math.min(1,g)):g))}h.domain=function(g){return arguments.length?([e,t,n]=g,r=c(e=+e),a=c(t=+t),o=c(n=+n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h):[e,t,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(u=g,h):u};function p(g){return function(m){var v,y,b;return arguments.length?([v,y,b]=m,u=cb(g,[v,y,b]),h):[u(0),u(.5),u(1)]}}return h.range=p(Ro),h.rangeRound=p(Ku),h.unknown=function(g){return arguments.length?(d=g,h):d},function(g){return c=g,r=g(e),a=g(t),o=g(n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h}}function PT(){var e=No(Ph()(mn));return e.copy=function(){return Ea(e,PT())},ba.apply(e,arguments)}function zT(){var e=hb(Ph()).domain([.1,1,10]);return e.copy=function(){return Ea(e,zT()).base(e.base())},ba.apply(e,arguments)}function BT(){var e=pb(Ph());return e.copy=function(){return Ea(e,BT()).constant(e.constant())},ba.apply(e,arguments)}function xb(){var e=gb(Ph());return e.copy=function(){return Ea(e,xb()).exponent(e.exponent())},ba.apply(e,arguments)}function qq(){return xb.apply(null,arguments).exponent(.5)}function Eb(){var e=Hy().unknown(void 0),t=e.domain,n=e.range,i=[0,1],r,a,o=!1,s=0,l=0,u=.5;delete e.unknown;function c(){var f=t().length,d=i[1]<i[0],h=i[d-0],p=i[1-d],g=zy(f,s,l);r=(p-h)/(g||1),o&&(r=Math.floor(r)),h+=(p-h-r*(f-s))*u,a=r*(1-s),o&&(h=Math.round(h),a=Math.round(a));var m=po(f).map(function(v){return h+r*v});return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return r},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),s=l,c()):s},e.paddingInner=function(f){return arguments.length?(s=Math.max(0,Math.min(1,f)),c()):s},e.paddingOuter=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;var d=+f[0],h=+f[1],p=i[1]<i[0],g=p?n().reverse():n(),m=g.length-1,v,y,b;return d!==d||h!==h?void 0:(h<d&&(b=d,d=h,h=b),h<g[0]||d>i[1-p]?void 0:(v=Math.max(0,na(g,d)-1),y=d===h?v:na(g,h)-1,d-g[v]>a+1e-10&&++v,p&&(b=v,v=m-y,y=m-b),v>y?void 0:t().slice(v,y+1)))},e.invert=function(f){var d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return Eb().domain(t()).range(i).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function UT(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return UT(t())},e}function Wq(){return UT(Eb().paddingInner(1))}var Gq=Array.prototype.map;function Hq(e){return Gq.call(e,function(t){return+t})}var Yq=Array.prototype.slice;function qT(){var e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(na(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=Hq(i),n):e.slice()},n.range=function(i){return arguments.length?(t=Yq.call(i),n):t.slice()},n.tickFormat=function(i,r){return xT(e[0],ve(e),i??10,r)},n.copy=function(){return qT().domain(n.domain()).range(n.range())},n}const zh={};function Vq(e,t,n){const i=function(){var a=t();return a.invertRange||(a.invertRange=a.invert?zU(a):a.invertExtent?BU(a):void 0),a.type=e,a};return i.metadata=kt(G(n)),i}function Ee(e,t,n){return arguments.length>1?(zh[e]=Vq(e,t,n),this):WT(e)?zh[e]:void 0}Ee(PU,kT),Ee(tl,ET,ut),Ee(_r,TT,[ut,_r]),Ee(qu,mb,ut),Ee(Wu,Mq,ut),Ee(Ah,DT,ut),Ee(To,zq,[ut,Wy]),Ee(Co,Bq,[ut,Wy]),Ee(Bi,bb,[ut,Xn]),Ee(`${Bi}-${tl}`,bb,[ut,Xn]),Ee(`${Bi}-${_r}`,jT,[ut,Xn,_r]),Ee(`${Bi}-${qu}`,wb,[ut,Xn]),Ee(`${Bi}-${Wu}`,Uq,[ut,Xn]),Ee(`${Bi}-${Ah}`,LT,[ut,Xn]),Ee(`${nl}-${tl}`,PT,[ut,Xn]),Ee(`${nl}-${_r}`,zT,[ut,Xn,_r]),Ee(`${nl}-${qu}`,xb,[ut,Xn]),Ee(`${nl}-${Wu}`,qq,[ut,Xn]),Ee(`${nl}-${Ah}`,BT,[ut,Xn]),Ee(il,NT,[Hu,il]),Ee(Sh,FT,Hu),Ee(Oh,IT,Hu),Ee(qy,qT,[Gu,Hu]),Ee(By,Hy,Gu),Ee(RO,Eb,Gu),Ee(Uy,Wq,Gu);function WT(e){return Q(zh,e)}function Fo(e,t){const n=zh[e];return n&&n.metadata[t]}function kb(e){return Fo(e,ut)}function ll(e){return Fo(e,Gu)}function _b(e){return Fo(e,Hu)}function GT(e){return Fo(e,_r)}function Xq(e){return Fo(e,Wy)}function HT(e){return Fo(e,Xn)}function YT(e){return Fo(e,il)}const Jq=["clamp","base","constant","exponent"];function VT(e,t){var n=t[0],i=ve(t)-n;return function(r){return e(n+r*i)}}function Bh(e,t,n){return cb(Ab(t||"rgb",n),e)}function XT(e,t){for(var n=new Array(t),i=t+1,r=0;r<t;)n[r]=e(++r/i);return n}function JT(e,t,n){var i=n-t,r,a,o;return!i||!Number.isFinite(i)?Vt(.5):(r=(a=e.type).indexOf("-"),a=r<0?a:a.slice(r+1),o=Ee(a)().domain([t,n]).range([0,1]),Jq.forEach(s=>e[s]?o[s](e[s]()):0),o)}function Ab(e,t){var n=_q[Kq(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Kq(e){return"interpolate"+e.toLowerCase().split("-").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("")}const Qq={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Zq={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function KT(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function QT(e,t){for(let n in e)Sb(n,t(e[n]))}const ZT={};QT(Zq,KT),QT(Qq,e=>Bh(KT(e)));function Sb(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(ZT[e]=t,this):ZT[e]}var Uh="symbol",eW="discrete",tW="gradient";const nW=e=>I(e)?e.map(t=>String(t)):String(e),iW=(e,t)=>e[1]-t[1],rW=(e,t)=>t[1]-e[1];function Ob(e,t,n){var i;return Re(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(ud(e.domain())/n||1)))),K(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===To?Fs(t):e.type==Co?Is(t):N("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function eC(e,t,n){let i=e.range(),r=i[0],a=ve(i),o=iW;if(r>a&&(i=a,a=r,r=i,o=rW),r=Math.floor(r),a=Math.ceil(a),t=t.map(s=>[s,e(s)]).filter(s=>r<=s[1]&&s[1]<=a).sort(o).map(s=>s[0]),n>0&&t.length>1){const s=[t[0],ve(t)];for(;t.length>n&&t.length>=3;)t=t.filter((l,u)=>!(u%2));t.length<3&&(t=s)}return t}function Tb(e,t){return e.bins?eC(e,e.bins):e.ticks?e.ticks(t):e.domain()}function tC(e,t,n,i,r,a){var o=t.type;let s=nW;if(o===To||r===To)s=e.timeFormat(i);else if(o===Co||r===Co)s=e.utcFormat(i);else if(GT(o)){const l=e.formatFloat(i);if(a||t.bins)s=l;else{const u=nC(t,n,!1);s=c=>u(c)?l(c):""}}else if(t.tickFormat){const l=t.domain();s=e.formatSpan(l[0],l[l.length-1],n,i)}else i&&(s=e.format(i));return s}function nC(e,t,n){const i=Tb(e,t),r=e.base(),a=Math.log(r),o=Math.max(1,r*t/i.length),s=l=>{let u=l/Math.pow(r,Math.round(Math.log(l)/a));return u*r<r-.5&&(u*=r),u<=o};return n?i.filter(s):s}const Cb={[il]:"quantiles",[Sh]:"thresholds",[Oh]:"domain"},iC={[il]:"quantiles",[Sh]:"domain"};function rC(e,t){return e.bins?sW(e.bins):e.type===_r?nC(e,t,!0):Cb[e.type]?oW(e[Cb[e.type]]()):Tb(e,t)}function aW(e,t,n){var i=t[iC[t.type]](),r=i.length,a=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)a=Math.min(a,i[o]-i[o-1]);return e.formatSpan(0,a,3*10,n)}function oW(e){const t=[-Infinity].concat(e);return t.max=Infinity,t}function sW(e){const t=e.slice(0,-1);return t.max=ve(e),t}function lW(e){return Cb[e.type]||e.bins}function aC(e,t,n,i,r,a,o){const s=iC[t.type]&&a!==To&&a!==Co?aW(e,t,r):tC(e,t,n,r,a,o);return i===Uh&&lW(t)?uW(s):i===eW?cW(s):fW(s)}function uW(e){return(t,n,i)=>{var r=oC(i[n+1],oC(i.max,Infinity)),a=sC(t,e),o=sC(r,e);return a&&o?a+" â€“ "+o:o?"< "+o:"â‰¥ "+a}}function oC(e,t){return e??t}function cW(e){return(t,n)=>n?e(t):null}function fW(e){return t=>e(t)}function sC(e,t){return Number.isFinite(e)?t(e):null}function dW(e){var t=e.domain(),n=t.length-1,i=+t[0],r=+ve(t),a=r-i;if(e.type===Oh){const o=n?a/n:.1;i-=o,r+=o,a=r-i}return o=>(o-i)/a}function hW(e,t,n,i){const r=i||t.type;return Y(n)&&Xq(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===To?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===Co?e.utcFormat("%A, %d %B %Y, %X UTC"):aC(e,t,5,null,n,i,!0)}function lC(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=hW(e,t,n.format,n.formatType);if(_b(t.type)){const a=rC(t).slice(1).map(r),o=a.length;return`${o} boundar${o===1?"y":"ies"}: ${a.join(", ")}`}else if(ll(t.type)){const a=t.domain(),o=a.length,s=o>i?a.slice(0,i-2).map(r).join(", ")+", ending with "+a.slice(-1).map(r):a.map(r).join(", ");return`${o} value${o===1?"":"s"}: ${s}`}else{const a=t.domain();return`values from ${r(a[0])} to ${r(ve(a))}`}}const uC="aria-hidden",$b="aria-label",Db="role",Rb="aria-roledescription",cC="graphics-object",Nb="graphics-symbol",fC=(e,t,n)=>({[Db]:e,[Rb]:t,[$b]:n||void 0}),pW=kt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),dC={axis:{desc:"axis",caption:vW},legend:{desc:"legend",caption:yW},"title-text":{desc:"title",caption:e=>`Title text '${mC(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${mC(e)}'`}},hC={ariaRole:Db,ariaRoleDescription:Rb,description:$b};function pC(e,t){const n=t.aria===!1;if(e(uC,n||void 0),n||t.description==null)for(const i in hC)e(hC[i],void 0);else{const i=t.mark.marktype;e($b,t.description),e(Db,t.ariaRole||(i==="group"?cC:Nb)),e(Rb,t.ariaRoleDescription||`${i} mark`)}}function gC(e){return e.aria===!1?{[uC]:!0}:pW[e.role]?null:dC[e.role]?mW(e,dC[e.role]):gW(e)}function gW(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return fC(n?cC:Nb,`${t} mark container`,e.description)}function mW(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return fC(t.role||Nb,t.desc,n.description||i(n))}catch(n){return null}}function mC(e){return G(e.text).join(" ")}function vW(e){const t=e.datum,n=e.orient,i=t.title?vC(e):null,r=e.context,a=r.scales[t.scale].value,o=r.dataflow.locale(),s=a.type,l=n==="left"||n==="right"?"Y":"X";return`${l}-axis`+(i?` titled '${i}'`:"")+` for a ${ll(s)?"discrete":s} scale with ${lC(o,a,e)}`}function yW(e){const t=e.datum,n=t.title?vC(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,a=Object.keys(r),o=e.context,s=o.scales[r[a[0]]].value,l=o.dataflow.locale();return wW(i)+(n?` titled '${n}'`:"")+` for ${bW(a)} with ${lC(l,s,e)}`}function vC(e){try{return G(ve(e.items).items[0].text).join(" ")}catch(t){return null}}function bW(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ve(e)}function wW(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const xW=e=>(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function We(e,t,n){var i="<"+e,r,a;if(t)for(r in t)a=t[r],a!=null&&(i+=" "+r+'="'+xW(a)+'"');return n&&(i+=" "+n),i+">"}function Ye(e){return"</"+e+">"}const qh={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Fb={fill:"none","stroke-miterlimit":10},Wh=0,Ot=Zs.xmlns;function Ib(e){vi.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var vn=P(Ib,vi),Mb=vi.prototype;vn.initialize=function(e,t,n,i){if(this._defs={gradient:{},clipping:{}},e){this._svg=In(e,0,"svg",Ot),this._svg.setAttribute("class","marks"),mi(e,1),this._root=In(this._svg,Wh,"g",Ot);for(const r in Fb)this._root.setAttribute(r,Fb[r]);mi(this._svg,Wh+1)}return this.background(this._bgcolor),Mb.initialize.call(this,e,t,n,i)},vn.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Mb.background.apply(this,arguments)},vn.resize=function(e,t,n,i){return Mb.resize.call(this,e,t,n,i),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},vn.canvas=function(){return this._svg},vn.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in Zs)e[t]=Zs[t];var n=this._bgcolor?We("rect",{width:this._width,height:this._height,fill:this._bgcolor})+Ye("rect"):"";return We("svg",e)+(this._defs.el?this._defs.el.outerHTML:"")+n+this._root.outerHTML+Ye("svg")},vn._render=function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e),mi(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},vn.updateDefs=function(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=In(e,Wh,"defs",Ot)),i=EW(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=In(e,Wh,"defs",Ot)),i=kW(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):mi(n,i))};function EW(e,t,n){var i,r,a;if(t.gradient==="radial"){var o=In(e,n++,"pattern",Ot);o.setAttribute("id",qd+t.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),o=In(o,0,"rect",Ot),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+wC()+"#"+t.id+")"),e=In(e,n++,"radialGradient",Ot),e.setAttribute("id",t.id),e.setAttribute("fx",t.x1),e.setAttribute("fy",t.y1),e.setAttribute("fr",t.r1),e.setAttribute("cx",t.x2),e.setAttribute("cy",t.y2),e.setAttribute("r",t.r2)}else e=In(e,n++,"linearGradient",Ot),e.setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2);for(i=0,r=t.stops.length;i<r;++i)a=In(e,i,"stop",Ot),a.setAttribute("offset",t.stops[i].offset),a.setAttribute("stop-color",t.stops[i].color);return mi(e,i),n}function kW(e,t,n){var i;return e=In(e,n,"clipPath",Ot),e.setAttribute("id",t.id),t.path?(i=In(e,0,"path",Ot),i.setAttribute("d",t.path)):(i=In(e,0,"rect",Ot),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",t.width),i.setAttribute("height",t.height)),mi(e,1),n+1}vn._resetDefs=function(){var e=this._defs;e.gradient={},e.clipping={}},vn.dirty=function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},vn.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},vn._dirtyCheck=function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length||!this._dirtyID)return!0;var t=++this._dirtyID,n,i,r,a,o,s,l;for(o=0,s=e.length;o<s;++o){if(n=e[o],i=n.mark,i.marktype!==r&&(r=i.marktype,a=Yn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,yC(n,t),i.items.forEach(function(u){u.dirty=t})),i.zdirty)continue;if(n.exit){a.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null;continue}if(n=a.nested?i.items[0]:n,n._update===t)continue;!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,yC(n,t)):this._update(a,n._svg,n),n._update=t}return!this._dirtyAll};function yC(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}vn.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var i=this._svg,r=Yn[t.marktype],a=t.interactive===!1?"none":null,o=r.tag==="g",s=null,l=0,u;u=bC(t,e,n,"g",i),u.setAttribute("class",kO(t));const c=gC(t);for(const d in c)yn(u,d,c[d]);o||yn(u,"pointer-events",a),yn(u,"clip-path",t.clip?py(this,t,t.group):null);const f=d=>{const h=this.isDirty(d),p=bC(d,u,s,r.tag,i);h&&(this._update(r,p,d),o&&_W(this,p,d)),s=p,++l};return r.nested?t.items.length&&f(t.items[0]):gi(t,f),mi(u,l),u};function _W(e,t,n){t=t.lastChild.previousSibling;let i,r=0;gi(n,a=>{i=e.draw(t,a,i),++r}),mi(t,1+r)}function bC(e,t,n,i,r){let a=e._svg,o;if(!a&&(o=t.ownerDocument,a=ma(o,i,Ot),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},i==="g"))){const s=ma(o,"path",Ot);a.appendChild(s),s.__data__=e;const l=ma(o,"g",Ot);a.appendChild(l),l.__data__=e;const u=ma(o,"path",Ot);a.appendChild(u),u.__data__=e,u.__values__={fill:"default"}}return(a.ownerSVGElement!==r||AW(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}function AW(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}var Sr=null,Lt=null,SW={group:function(e,t,n){const i=Sr=t.childNodes[2];Lt=i.__values__,e.foreground(ac,n,this),Lt=t.__values__,Sr=t.childNodes[1],e.content(ac,n,this);const r=Sr=t.childNodes[0];e.background(ac,n,this);const a=n.mark.interactive===!1?"none":null;if(a!==Lt.events&&(yn(i,"pointer-events",a),yn(r,"pointer-events",a),Lt.events=a),n.strokeForeground&&n.stroke){const o=n.fill;yn(i,"display",null),this.style(r,n),yn(r,"stroke",null),o&&(n.fill=null),Lt=i.__values__,this.style(i,n),o&&(n.fill=o),Sr=null}else yn(i,"display","none")},image:function(e,t,n){n.smooth===!1?(jb(t,"image-rendering","optimizeSpeed"),jb(t,"image-rendering","pixelated")):jb(t,"image-rendering",null)},text:function(e,t,n){let i=ju(n),r,a,o,s;I(i)?(a=i.map(l=>ga(n,l)),r=a.join(`
`),r!==Lt.text&&(mi(t,0),o=t.ownerDocument,s=pa(n),a.forEach((l,u)=>{const c=ma(o,"tspan",Ot);c.__data__=n,c.textContent=l,u&&(c.setAttribute("x",0),c.setAttribute("dy",s)),t.appendChild(c)}),Lt.text=r)):(a=ga(n,i),a!==Lt.text&&(t.textContent=a,Lt.text=a)),yn(t,"font-family",Lu(n)),yn(t,"font-size",zi(n)+"px"),yn(t,"font-style",n.fontStyle),yn(t,"font-variant",n.fontVariant),yn(t,"font-weight",n.fontWeight)}};function jb(e,t,n){n!==Lt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Lt[t]=n)}vn._update=function(e,t,n){Sr=t,Lt=t.__values__,pC(ac,n),e.attr(ac,n,this);const i=SW[e.type];i&&i.call(this,e,t,n),Sr&&this.style(Sr,n)};function ac(e,t,n){if(t===Lt[e])return;n?OW(Sr,e,t,n):yn(Sr,e,t),Lt[e]=t}function yn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function OW(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}vn.style=function(e,t){if(t==null)return;for(const n in qh){let i=n==="font"?Lu(t):t[n];if(i===Lt[n])continue;const r=qh[n];i==null?e.removeAttribute(r):(Qv(i)&&(i=fS(i,this._defs.gradient,wC())),e.setAttribute(r,i+"")),Lt[n]=i}};function wC(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Lb(e){vi.call(this,e),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}var Or=P(Lb,vi),xC=vi.prototype;Or.resize=function(e,t,n,i){xC.resize.call(this,e,t,n,i);var r=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var s in Zs)o[s]=Zs[s];a.head=We("svg",o);var l=this._bgcolor;return(l==="transparent"||l==="none")&&(l=null),l?a.bg=We("rect",{width:this._width,height:this._height,fill:l})+Ye("rect"):a.bg="",a.root=We("g",fe({},Fb,{transform:"translate("+r+")"})),a.foot=Ye("g")+Ye("svg"),this},Or.background=function(){var e=xC.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),e},Or.svg=function(){var e=this._text;return e.head+e.defs+e.bg+e.root+e.body+e.foot},Or._render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},Or.buildDefs=function(){let e="",t;for(const n in this._defs.gradient){const i=this._defs.gradient[n],r=i.stops;i.gradient==="radial"?(e+=We(t="pattern",{id:qd+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e+=We("rect",{width:"1",height:"1",fill:"url(#"+n+")"})+Ye("rect"),e+=Ye(t),e+=We(t="radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e+=We(t="linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let a=0;a<r.length;++a)e+=We("stop",{offset:r[a].offset,"stop-color":r[a].color})+Ye("stop");e+=Ye(t)}for(const n in this._defs.clipping){const i=this._defs.clipping[n];e+=We("clipPath",{id:n}),i.path?e+=We("path",{d:i.path})+Ye("path"):e+=We("rect",{x:0,y:0,width:i.width,height:i.height})+Ye("rect"),e+=Ye("clipPath")}return e?We("defs")+e+Ye("defs"):""},Or.attr=function(e,t,n,i){const r={},a=(o,s,l,u)=>{r[u||o]=s};return Array.isArray(n)?n.forEach(o=>o(a,t,this)):n(a,t,this),i&&TW(r,t,e,i,this._defs),r},Or.href=function(e){var t=this,n=e.href,i;if(n){if(i=t._hrefs&&t._hrefs[n])return i;t.sanitizeURL(n).then(r=>{r["xlink:href"]=r.href,r.href=null,(t._hrefs||(t._hrefs={}))[n]=r})}return null},Or.mark=function(e){const t=Yn[e.marktype],n=t.tag,i=[pC,t.attr];let r="";r+=We("g",fe({class:kO(e),"clip-path":e.clip?py(this,e,e.group):null},gC(e),{"pointer-events":n!=="g"&&e.interactive===!1?"none":null}));const a=o=>{const s=this.href(o);if(s&&(r+=We("a",s)),r+=We(n,this.attr(e,o,i,n!=="g"?n:null)),n==="text"){const l=ju(o);if(I(l)){const u={x:0,dy:pa(o)};for(let c=0;c<l.length;++c)r+=We("tspan",c?u:null)+EC(ga(o,l[c]))+Ye("tspan")}else r+=EC(ga(o,l))}else if(n==="g"){const l=o.strokeForeground,u=o.fill,c=o.stroke;l&&c&&(o.stroke=null),r+=We("path",this.attr(e,o,t.background,"bgrect"))+Ye("path"),r+=We("g",this.attr(e,o,t.content))+this.markGroup(o)+Ye("g"),l&&c?(u&&(o.fill=null),o.stroke=c,r+=We("path",this.attr(e,o,t.foreground,"bgrect"))+Ye("path"),u&&(o.fill=u)):r+=We("path",this.attr(e,o,t.foreground,"bgfore"))+Ye("path")}r+=Ye(n),s&&(r+=Ye("a"))};return t.nested?e.items&&e.items.length&&a(e.items[0]):gi(e,a),r+Ye("g")},Or.markGroup=function(e){let t="";return gi(e,n=>{t+=this.mark(n)}),t};function TW(e,t,n,i,r){if(t==null)return e;if(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null))return e;i==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),i==="text"&&(e["font-family"]=Lu(t),e["font-size"]=zi(t)+"px",t.fontStyle&&(e["font-style"]=t.fontStyle),t.fontVariant&&(e["font-variant"]=t.fontVariant),t.fontWeight&&(e["font-weight"]=t.fontWeight));for(const a in qh){let o=t[a];const s=qh[a];o==="transparent"&&(s==="fill"||s==="stroke")||o!=null&&(Qv(o)&&(o=fS(o,r.gradient,"")),e[s]=o)}return e}function EC(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var kC="canvas",_C="png",AC="svg",SC="none",ka={Canvas:kC,PNG:_C,SVG:AC,None:SC},ul={};ul[kC]=ul[_C]={renderer:kh,headless:kh,handler:Uu},ul[AC]={renderer:Ib,headless:Lb,handler:Ly},ul[SC]={};function Gh(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(ul[e]=t,this):ul[e]}function OC(e,t,n){const i=[],r=new st().union(t),a=e.marktype;return a?TC(e,r,n,i):a==="group"?CC(e,r,n,i):N("Intersect scene must be mark node or group item.")}function TC(e,t,n,i){if(CW(e,t,n)){const r=e.items,a=e.marktype,o=r.length;let s=0;if(a==="group")for(;s<o;++s)CC(r[s],t,n,i);else for(const l=Yn[a].isect;s<o;++s){let u=r[s];$C(u,t,l)&&i.push(u)}}return i}function CW(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function CC(e,t,n,i){n&&n(e.mark)&&$C(e,t,Yn.group.isect)&&i.push(e);const r=e.items,a=r&&r.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let l=0;l<a;++l)TC(r[l],t,n,i);t.translate(o,s)}return i}function $C(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}var Pb=new st();function DC(e){var t=e.clip;if(ge(t))t(gn(Pb.clear()));else if(t)Pb.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(Pb)}var $W=1e-9;function zb(e,t,n){return e===t?!0:n==="path"?RC(e,t):e instanceof Date&&t instanceof Date?+e===+t:Re(e)&&Re(t)?Math.abs(e-t)<=$W:!e||!t||!K(e)&&!K(t)?e==t:e==null||t==null?!1:DW(e,t)}function RC(e,t){return zb(Hs(e),Hs(t))}function DW(e,t){var n=Object.keys(e),i=Object.keys(t),r,a;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),a=n.length-1;a>=0;a--)if(n[a]!=i[a])return!1;for(a=n.length-1;a>=0;a--)if(r=n[a],!zb(e[r],t[r],r))return!1;return typeof e===typeof t}function RW(){WS(),l7()}function NC(e){$.call(this,null,e)}var NW=P(NC,$);NW.transform=function(e,t){var n=t.dataflow,i=e.mark,r=i.marktype,a=Yn[r],o=a.bound,s=i.bounds,l;if(a.nested)i.items.length&&n.dirty(i.items[0]),s=Hh(i,o),i.items.forEach(function(u){u.bounds.clear().union(s)});else if(r===Bd||e.modified()){t.visit(t.MOD,u=>n.dirty(u)),s.clear(),i.items.forEach(u=>s.union(Hh(u,o)));switch(i.role){case Hv:case Vv:case Yv:t.reflow()}}else l=t.changed(t.REM),t.visit(t.ADD,u=>{s.union(Hh(u,o))}),t.visit(t.MOD,u=>{l=l||s.alignsWith(u.bounds),n.dirty(u),s.union(Hh(u,o))}),l&&(s.clear(),i.items.forEach(u=>s.union(u.bounds)));return DC(i),t.modifies("bounds")};function Hh(e,t,n){return t(e.bounds.clear(),e,n)}var FC=":vega_identifier:";function Bb(e){$.call(this,0,e)}Bb.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};var FW=P(Bb,$);FW.transform=function(e,t){var n=IW(t.dataflow),i=n.value,r=e.as;return t.visit(t.ADD,a=>{a[r]||(a[r]=++i)}),n.set(this.value=i),t};function IW(e){var t=e._signals[FC];return t||(e._signals[FC]=t=e.add(0)),t}function IC(e){$.call(this,null,e)}var MW=P(IC,$);MW.transform=function(e,t){var n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,jW(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);var i=n.marktype===Bd?th:eh;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t};function jW(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function MC(e){$.call(this,null,e)}var LW=P(MC,$),jC={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{var n;return e.filter((i,r)=>!r||!LC(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}};function LC(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)}function PC(e,t){for(var n=1,i=e.length,r=e[0].bounds,a;n<i;r=a,++n)if(LC(r,a=e[n].bounds,t))return!0}function PW(e){var t=e.bounds;return t.width()>1&&t.height()>1}function zW(e,t,n){var i=e.range(),r=new st();return t===qs||t===la?r.set(i[0],-Infinity,i[1],Infinity):r.set(-Infinity,i[0],Infinity,i[1]),r.expand(n||1),a=>r.encloses(a.bounds)}function zC(e){return e.forEach(t=>t.opacity=1),e}function BC(e,t){return e.reflow(t.modified()).modifies("opacity")}LW.transform=function(e,t){var n=jC[e.method]||jC.parity,i=t.materialize(t.SOURCE).source,r=e.separation||0,a,o,s;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(zC(i),t=BC(t,e)),t;if(i=i.filter(PW),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),a=zC(i),t=BC(t,e),a.length>=3&&PC(a,r)){do a=n(a,r);while(a.length>=3&&PC(a,r));a.length<3&&!ve(i).opacity&&(a.length>1&&(ve(a).opacity=0),ve(i).opacity=1)}return e.boundScale&&e.boundTolerance>=0&&(o=zW(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(l=>{o(l)||(l.opacity=0)})),s=a[0].mark.bounds.clear(),i.forEach(l=>{l.opacity&&s.union(l.bounds)}),t};function UC(e){$.call(this,null,e)}var BW=P(UC,$);BW.transform=function(e,t){var n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){var i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}};const Pt=new st();function cl(e,t,n){return e[t]===n?0:(e[t]=n,1)}function UW(e){var t=e.items[0].orient;return t===di||t===hi}function qW(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function WW(e,t,n,i){var r=t.items[0],a=r.datum,o=r.translate!=null?r.translate:.5,s=r.orient,l=qW(a),u=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,p=a.title&&r.items[l[2]].items[0],g=r.titlePadding,m=r.bounds,v=p&&Cy(p),y=0,b=0,E,x;Pt.clear().union(m),m.clear(),(E=l[0])>-1&&m.union(r.items[E].bounds),(E=l[1])>-1&&m.union(r.items[E].bounds);switch(s){case qs:y=f||0,b=-c,x=Math.max(d,Math.min(h,-m.y1)),m.add(0,-x).add(u,0),p&&Yh(e,p,x,g,v,0,-1,m);break;case di:y=-c,b=f||0,x=Math.max(d,Math.min(h,-m.x1)),m.add(-x,0).add(0,u),p&&Yh(e,p,x,g,v,1,-1,m);break;case hi:y=n+c,b=f||0,x=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(x,u),p&&Yh(e,p,x,g,v,1,1,m);break;case la:y=f||0,b=i+c,x=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(u,x),p&&Yh(e,p,x,g,0,0,1,m);break;default:y=r.x,b=r.y}return kr(m.translate(y,b),r),cl(r,"x",y+o)|cl(r,"y",b+o)&&(r.bounds=Pt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Yh(e,t,n,i,r,a,o,s){const l=t.bounds;if(t.auto){const u=o*(n+r+i);let c=0,f=0;e.dirty(t),a?c=(t.x||0)-(t.x=u):f=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-c,-f)),e.dirty(t)}s.union(l)}const qC=(e,t)=>Math.floor(Math.min(e,t)),WC=(e,t)=>Math.ceil(Math.max(e,t));function GW(e){for(var t=e.items,n=t.length,i=0,r,a,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};i<n;++i)if(r=t[i],a=r.items,r.marktype===Bd)switch(r.role){case Hv:case Vv:case Yv:break;case iS:o.rowheaders.push(...a);break;case rS:o.rowfooters.push(...a);break;case oS:o.colheaders.push(...a);break;case sS:o.colfooters.push(...a);break;case aS:o.rowtitle=a[0];break;case lS:o.coltitle=a[0];break;default:o.marks.push(...a)}return o}function HW(e){return new st().set(0,0,e.width||0,e.height||0)}function YW(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Be(e,t,n){var i=K(e)?e[t]:e;return i??(n!==void 0?n:0)}function GC(e){return e<0?Math.ceil(-e):0}function HC(e,t,n){var i=!n.nodirty,r=n.bounds===Kv?HW:YW,a=Pt.set(0,0,0,0),o=Be(n.align,ua),s=Be(n.align,ca),l=Be(n.padding,ua),u=Be(n.padding,ca),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),p=Array(c),g=0,m=Array(d),v=Array(f),y=0,b=Array(d),E=Array(d),x=Array(d),k,w,A,_,O,S,T,D,M,C,F;for(w=0;w<c;++w)p[w]=0;for(w=0;w<f;++w)v[w]=0;for(w=0;w<d;++w)S=t[w],O=x[w]=r(S),S.x=S.x||0,b[w]=0,S.y=S.y||0,E[w]=0,A=w%c,_=~~(w/c),g=Math.max(g,T=Math.ceil(O.x2)),y=Math.max(y,D=Math.ceil(O.y2)),p[A]=Math.max(p[A],T),v[_]=Math.max(v[_],D),h[w]=l+GC(O.x1),m[w]=u+GC(O.y1),i&&e.dirty(t[w]);for(w=0;w<d;++w)w%c===0&&(h[w]=0),w<c&&(m[w]=0);if(o===Jv)for(A=1;A<c;++A){for(F=0,w=A;w<d;w+=c)F<h[w]&&(F=h[w]);for(w=A;w<d;w+=c)h[w]=F+p[A-1]}else if(o===Ud){for(F=0,w=0;w<d;++w)w%c&&F<h[w]&&(F=h[w]);for(w=0;w<d;++w)w%c&&(h[w]=F+g)}else for(o=!1,A=1;A<c;++A)for(w=A;w<d;w+=c)h[w]+=p[A-1];if(s===Jv)for(_=1;_<f;++_){for(F=0,w=_*c,k=w+c;w<k;++w)F<m[w]&&(F=m[w]);for(w=_*c;w<k;++w)m[w]=F+v[_-1]}else if(s===Ud){for(F=0,w=c;w<d;++w)F<m[w]&&(F=m[w]);for(w=c;w<d;++w)m[w]=F+y}else for(s=!1,_=1;_<f;++_)for(w=_*c,k=w+c;w<k;++w)m[w]+=v[_-1];for(M=0,w=0;w<d;++w)M=h[w]+(w%c?M:0),b[w]+=M-t[w].x;for(A=0;A<c;++A)for(C=0,w=A;w<d;w+=c)C+=m[w],E[w]+=C-t[w].y;if(o&&Be(n.center,ua)&&f>1)for(w=0;w<d;++w)O=o===Ud?g:p[w%c],M=O-x[w].x2-t[w].x-b[w],M>0&&(b[w]+=M/2);if(s&&Be(n.center,ca)&&c!==1)for(w=0;w<d;++w)O=s===Ud?y:v[~~(w/c)],C=O-x[w].y2-t[w].y-E[w],C>0&&(E[w]+=C/2);for(w=0;w<d;++w)a.union(x[w].translate(b[w],E[w]));M=Be(n.anchor,Z9),C=Be(n.anchor,e7);switch(Be(n.anchor,ua)){case Xt:M-=a.width();break;case Gv:M-=a.width()/2}switch(Be(n.anchor,ca)){case Xt:C-=a.height();break;case Gv:C-=a.height()/2}for(M=Math.round(M),C=Math.round(C),a.clear(),w=0;w<d;++w)t[w].mark.bounds.clear();for(w=0;w<d;++w)S=t[w],S.x+=b[w]+=M,S.y+=E[w]+=C,a.union(S.mark.bounds.union(S.bounds.translate(b[w],E[w]))),i&&e.dirty(S);return a}function VW(e,t,n){var i=GW(t),r=i.marks,a=n.bounds===Kv?XW:JW,o=n.offset,s=n.columns||r.length,l=s<=0?1:Math.ceil(r.length/s),u=l*s,c,f,d,h,p,g,m;const v=HC(e,r,n);v.empty()&&v.set(0,0,0,0),i.rowheaders&&(g=Be(n.headerBand,ca,null),c=Vh(e,i.rowheaders,r,s,l,-Be(o,"rowHeader"),qC,0,a,"x1",0,s,1,g)),i.colheaders&&(g=Be(n.headerBand,ua,null),f=Vh(e,i.colheaders,r,s,s,-Be(o,"columnHeader"),qC,1,a,"y1",0,1,s,g)),i.rowfooters&&(g=Be(n.footerBand,ca,null),d=Vh(e,i.rowfooters,r,s,l,Be(o,"rowFooter"),WC,0,a,"x2",s-1,s,1,g)),i.colfooters&&(g=Be(n.footerBand,ua,null),h=Vh(e,i.colfooters,r,s,s,Be(o,"columnFooter"),WC,1,a,"y2",u-s,1,s,g)),i.rowtitle&&(p=Be(n.titleAnchor,ca),m=Be(o,"rowTitle"),m=p===Xt?d+m:c-m,g=Be(n.titleBand,ca,.5),YC(e,i.rowtitle,m,0,v,g)),i.coltitle&&(p=Be(n.titleAnchor,ua),m=Be(o,"columnTitle"),m=p===Xt?h+m:f-m,g=Be(n.titleBand,ua,.5),YC(e,i.coltitle,m,1,v,g))}function XW(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function JW(e,t){return e.bounds[t]}function Vh(e,t,n,i,r,a,o,s,l,u,c,f,d,h){var p=n.length,g=0,m=0,v,y,b,E,x,k,w,A,_;if(!p)return g;for(v=c;v<p;v+=f)n[v]&&(g=o(g,l(n[v],u)));if(!t.length)return g;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),g+=a,y=0,E=t.length;y<E;++y)e.dirty(t[y]),t[y].mark.bounds.clear();for(v=c,y=0,E=t.length;y<E;++y,v+=f){for(k=t[y],x=k.mark.bounds,b=v;b>=0&&(w=n[b])==null;b-=d);s?(A=h==null?w.x:Math.round(w.bounds.x1+h*w.bounds.width()),_=g):(A=g,_=h==null?w.y:Math.round(w.bounds.y1+h*w.bounds.height())),x.union(k.bounds.translate(A-(k.x||0),_-(k.y||0))),k.x=A,k.y=_,e.dirty(k),m=o(m,x[u])}return m}function YC(e,t,n,i,r,a){if(!t)return;e.dirty(t);var o=n,s=n;i?o=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}function KW(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function QW(e,t){var n=-Infinity;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-Infinity?n:t}function ZW(e,t,n,i,r,a,o){const s=KW(n,t),l=QW(e,s("offset",0)),u=s("anchor",Wv),c=u===Xt?1:u===Gv?.5:0,f={align:Jv,bounds:s("bounds",Kv),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case di:f.anchor={x:Math.floor(i.x1)-l,column:Xt,y:c*(o||i.height()+2*i.y1),row:u};break;case hi:f.anchor={x:Math.ceil(i.x2)+l,y:c*(o||i.height()+2*i.y1),row:u};break;case qs:f.anchor={y:Math.floor(r.y1)-l,row:Xt,x:c*(a||r.width()+2*r.x1),column:u};break;case la:f.anchor={y:Math.ceil(r.y2)+l,x:c*(a||r.width()+2*r.x1),column:u};break;case X9:f.anchor={x:l,y:l};break;case J9:f.anchor={x:a-l,y:l,column:Xt};break;case K9:f.anchor={x:l,y:o-l,row:Xt};break;case Q9:f.anchor={x:a-l,y:o-l,column:Xt,row:Xt};break}return f}function eG(e,t){var n=t.items[0],i=n.datum,r=n.orient,a=n.bounds,o=n.x,s=n.y,l,u;return n._bounds?n._bounds.clear().union(a):n._bounds=a.clone(),a.clear(),nG(e,n,n.items[0].items[0]),a=tG(n,a),l=2*n.padding,u=2*n.padding,a.empty()||(l=Math.ceil(a.width()+l),u=Math.ceil(a.height()+u)),i.type===r7&&iG(n.items[0].items[0].items[0].items),r!==Xv&&(n.x=o=0,n.y=s=0),n.width=l,n.height=u,kr(a.set(o,s,o+l,s+u),n),n.mark.bounds.clear().union(a),n}function tG(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function nG(e,t,n){var i=t.padding,r=i-n.x,a=i-n.y;if(!t.datum.title)(r||a)&&oc(e,n,r,a);else{var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=i-o.x,c=i-o.y;switch(o.orient){case di:r+=Math.ceil(o.bounds.width())+l;break;case hi:case la:break;default:a+=o.bounds.height()+l}(r||a)&&oc(e,n,r,a);switch(o.orient){case di:c+=fl(t,n,o,s,1,1);break;case hi:u+=fl(t,n,o,Xt,0,0)+l,c+=fl(t,n,o,s,1,1);break;case la:u+=fl(t,n,o,s,0,0),c+=fl(t,n,o,Xt,-1,0,1)+l;break;default:u+=fl(t,n,o,s,0,0)}(u||c)&&oc(e,o,u,c),(u=Math.round(o.bounds.x1-i))<0&&(oc(e,n,-u,0),oc(e,o,-u,0))}}function fl(e,t,n,i,r,a,o){const s=e.datum.type!=="symbol",l=n.datum.vgrad,u=s&&(a||!l)&&!o?t.items[0]:t,c=u.bounds[r?"y2":"x2"]-e.padding,f=l&&a?c:0,d=l&&a?0:c,h=r<=0?0:Cy(n);return Math.round(i===Wv?f:i===Xt?d-h:.5*(c-h))}function oc(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function iG(e){var t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function rG(e,t,n,i,r){var a=t.items[0],o=a.frame,s=a.orient,l=a.anchor,u=a.offset,c=a.padding,f=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],h=s===di||s===hi?i:n,p=0,g=0,m=0,v=0,y=0,b;if(o!==Bd?s===di?(p=r.y2,h=r.y1):s===hi?(p=r.y1,h=r.y2):(p=r.x1,h=r.x2):s===di&&(p=i,h=0),b=l===Wv?p:l===Xt?h:(p+h)/2,d&&d.text){switch(s){case qs:case la:y=f.bounds.height()+c;break;case di:v=f.bounds.width()+c;break;case hi:v=-f.bounds.width()-c;break}Pt.clear().union(d.bounds),Pt.translate(v-(d.x||0),y-(d.y||0)),cl(d,"x",v)|cl(d,"y",y)&&(e.dirty(d),d.bounds.clear().union(Pt),d.mark.bounds.clear().union(Pt),e.dirty(d)),Pt.clear().union(d.bounds)}else Pt.clear();Pt.union(f.bounds);switch(s){case qs:g=b,m=r.y1-Pt.height()-u;break;case di:g=r.x1-Pt.width()-u,m=b;break;case hi:g=r.x2+Pt.width()+u,m=b;break;case la:g=b,m=r.y2+u;break;default:g=a.x,m=a.y}return cl(a,"x",g)|cl(a,"y",m)&&(Pt.translate(g,m),e.dirty(a),a.bounds.clear().union(Pt),t.bounds.clear().union(Pt),e.dirty(a)),a.bounds}function VC(e){$.call(this,null,e)}var aG=P(VC,$);aG.transform=function(e,t){var n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&VW(n,i,e.layout),sG(n,i,e)}),oG(e.mark.group)?t.reflow():t};function oG(e){return e&&e.mark.role!=="legend-entry"}function sG(e,t,n){var i=t.items,r=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=new st().set(0,0,r,a),s=o.clone(),l=o.clone(),u=[],c,f,d,h,p,g;for(p=0,g=i.length;p<g;++p){f=i[p];switch(f.role){case Hv:h=UW(f)?s:l,h.union(WW(e,f,r,a));break;case Yv:c=f;break;case Vv:u.push(eG(e,f));break;case t7:case n7:case iS:case rS:case aS:case oS:case sS:case lS:s.union(f.bounds),l.union(f.bounds);break;default:o.union(f.bounds)}}if(u.length){const m={};u.forEach(v=>{d=v.orient||hi,d!==Xv&&(m[d]||(m[d]=[])).push(v)});for(let v in m){const y=m[v];HC(e,y,ZW(y,v,n.legends,s,l,r,a))}u.forEach(v=>{const y=v.bounds;if(y.equals(v._bounds)||(v.bounds=v._bounds,e.dirty(v),v.bounds=y,e.dirty(v)),n.autosize&&n.autosize.type===uS)switch(v.orient){case di:case hi:o.add(y.x1,0).add(y.x2,0);break;case qs:case la:o.add(0,y.y1).add(0,y.y2)}else o.union(y)})}o.union(s).union(l),c&&o.union(rG(e,c,r,a,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),lG(e,t,o,n)}function lG(e,t,n,i){const r=i.autosize||{},a=r.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-l)),f=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1)),h=Math.max(0,Math.ceil(n.y2-f));if(r.contains===i7){const p=e.padding();o-=p.left+p.right,s-=p.top+p.bottom}a===Xv?(u=0,d=0,l=o,f=s):a===uS?(l=Math.max(0,o-u-c),f=Math.max(0,s-d-h)):a===a7?(l=Math.max(0,o-u-c),s=f+d+h):a===o7?(o=l+u+c,f=Math.max(0,s-d-h)):a===s7&&(o=l+u+c,s=f+d+h),e._resizeView(o,s,l,f,[u,d],r.resize)}var uG=Object.freeze({__proto__:null,bound:NC,identifier:Bb,mark:IC,overlap:MC,render:UC,viewlayout:VC});function XC(e){$.call(this,null,e)}var cG=P(XC,$);cG.transform=function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,s=Ob(a,o,e.minstep),l=e.format||tC(n,a,s,e.formatSpecifier,e.formatType,!!e.values),u=e.values?eC(a,e.values,s):Tb(a,s);return r&&(i.rem=r),r=u.map(function(c,f){return ke({index:f/(u.length-1||1),value:c,label:l(c)})}),e.extra&&r.length&&r.push(ke({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i};function JC(e){$.call(this,null,e)}var fG=P(JC,$);function dG(){return ke({})}function hG(e){const t=au().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}fG.transform=function(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||dG,a=e.key||ee,o=this.value;return I(i.encode)&&(i.encode=null),o&&(e.modified("key")||t.modified(a))&&N("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=hG(a)),t.visit(t.ADD,s=>{const l=a(s);let u=o.get(l);u?u.exit?(o.empty--,i.add.push(u)):i.mod.push(u):(u=r(s),o.set(l,u),i.add.push(u)),u.datum=s,u.exit=!1}),t.visit(t.MOD,s=>{const l=a(s),u=o.get(l);u&&(u.datum=s,i.mod.push(u))}),t.visit(t.REM,s=>{const l=a(s),u=o.get(l);s===u.datum&&!u.exit&&(i.rem.push(u),u.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i};function KC(e){$.call(this,null,e)}var pG=P(KC,$);pG.transform=function(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,a=t.encode;if(I(a))if(n.changed()||a.every(function(d){return r[d]}))a=a[0],n.encode=null;else return t.StopPropagation;var o=a==="enter",s=r.update||so,l=r.enter||so,u=r.exit||so,c=(a&&!o?r[a]:s)||so;if(t.changed(t.ADD)&&(t.visit(t.ADD,function(d){l(d,e),s(d,e)}),n.modifies(l.output),n.modifies(s.output),c!==so&&c!==s&&(t.visit(t.ADD,function(d){c(d,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==so&&(t.visit(t.REM,function(d){u(d,e)}),n.modifies(u.output)),o||c!==so){var f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,function(d){var h=l(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)):t.visit(f,function(d){(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation};function QC(e){$.call(this,[],e)}var gG=P(QC,$);gG.transform=function(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.type||Uh,o=e.scale,s=+e.limit,l=Ob(o,e.count==null?5:e.count,e.minstep),u=!!e.values||a===Uh,c=e.format||aC(n,o,l,a,e.formatSpecifier,e.formatType,u),f=e.values||rC(o,l),d,h,p,g,m;return r&&(i.rem=r),a===Uh?(s&&f.length>s?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,s-1),m=!0):r=f,ge(p=e.size)?(!e.values&&o(r[0])===0&&(r=r.slice(1)),g=r.reduce(function(v,y){return Math.max(v,p(y,e))},0)):p=Vt(g=p||8),r=r.map(function(v,y){return ke({index:y,label:c(v,y,r),value:v,offset:g,size:p(v,e)})}),m&&(m=f[r.length],r.push(ke({index:r.length,label:`â€¦${f.length-r.length} entries`,value:m,offset:g,size:p(m,e)})))):a===tW?(d=o.domain(),h=JT(o,d[0],ve(d)),f.length<3&&!e.values&&d[0]!==ve(d)&&(f=[d[0],ve(d)]),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:h(v)})})):(p=f.length-1,h=dW(o),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:y?h(v):0,perc2:y===p?1:h(f[y+1])})})),i.source=r,i.add=r,this.value=r,i};var ZC=au({line:e$,"line-radial":xG,arc:t$,"arc-radial":EG,curve:n$,"curve-radial":kG,"orthogonal-horizontal":_G,"orthogonal-vertical":AG,"orthogonal-radial":SG,"diagonal-horizontal":OG,"diagonal-vertical":TG,"diagonal-radial":CG});function mG(e){return e.source.x}function vG(e){return e.source.y}function yG(e){return e.target.x}function bG(e){return e.target.y}function Ub(e){$.call(this,{},e)}Ub.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var wG=P(Ub,$);wG.transform=function(e,t){var n=e.sourceX||mG,i=e.sourceY||vG,r=e.targetX||yG,a=e.targetY||bG,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=ZC.get(l+"-"+s)||ZC.get(l);return u||N("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,function(c){c[o]=u(n(c),i(c),r(c),a(c))}),t.reflow(e.modified()).modifies(o)};function e$(e,t,n,i){return"M"+e+","+t+"L"+n+","+i}function xG(e,t,n,i){return e$(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function t$(e,t,n,i){var r=n-e,a=i-t,o=Math.sqrt(r*r+a*a)/2,s=180*Math.atan2(a,r)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1 "+n+","+i}function EG(e,t,n,i){return t$(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function n$(e,t,n,i){var r=n-e,a=i-t,o=.2*(r+a),s=.2*(a-r);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(i-o)+" "+n+","+i}function kG(e,t,n,i){return n$(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function _G(e,t,n,i){return"M"+e+","+t+"V"+i+"H"+n}function AG(e,t,n,i){return"M"+e+","+t+"H"+n+"V"+i}function SG(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*a+"A"+t+","+t+" 0 0,"+(l?1:0)+" "+t*o+","+t*s+"L"+i*o+","+i*s}function OG(e,t,n,i){var r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i}function TG(e,t,n,i){var r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i}function CG(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+i)/2;return"M"+t*r+","+t*a+"C"+l*r+","+l*a+" "+l*o+","+l*s+" "+i*o+","+i*s}function qb(e){$.call(this,null,e)}qb.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};var $G=P(qb,$);$G.transform=function(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],a=e.field||iu,o=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,l=t.source,u=l.map(a),c=u.length,f=o,d=(s-o)/Xk(u),h=po(c),p,g,m;for(e.sort&&h.sort(function(v,y){return u[v]-u[y]}),p=0;p<c;++p)m=u[h[p]],g=l[h[p]],g[i]=f,g[r]=f+=m*d;return this.value=u,t.reflow(e.modified()).modifies(n)};var DG=5;function RG(e){const t=e.type;return!e.bins&&(t===tl||t===qu||t===Wu)}function i$(e){return kb(e)&&e!==Bi}var NG=kt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function r$(e){$.call(this,null,e),this.modified(!0)}var FG=P(r$,$);FG.transform=function(e,t){var n=t.dataflow,i=this.value,r=IG(e);(!i||r!==i.type)&&(this.value=i=Ee(r)());for(r in e)if(!NG[r]){if(r==="padding"&&i$(i.type))continue;ge(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return BG(i,e,zG(i,e,jG(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function IG(e){var t=e.type,n="",i;return t===Bi?Bi+"-"+tl:(MG(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?Bi+"-":i===3?nl+"-":""),(n+t||tl).toLowerCase())}function MG(e){const t=e.type;return kb(t)&&t!==To&&t!==Co&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function jG(e,t,n){var i=LG(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,a=e.type,o=t.zero||t.zero===void 0&&RG(e),s,l;if(!r)return 0;if(i$(a)&&t.padding&&r[0]!==ve(r)&&(r=PG(a,r,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(s=(r=r.slice()).length-1||1,o&&(r[0]>0&&(r[0]=0),r[s]<0&&(r[s]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[s]=t.domainMax),t.domainMid!=null)){l=t.domainMid;const u=l>r[s]?s+1:l<r[0]?0:s;u!==s&&n.warn("Scale domainMid exceeds domain min or max.",l),r.splice(u,0,l)}return e.domain(a$(a,r,n)),a===By&&e.unknown(t.domainImplicit?Gy:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&Ob(e,t.nice)||null),r.length}function LG(e,t,n){return t?(e.domain(a$(e.type,t,n)),t.length):-1}function PG(e,t,n,i,r,a){var o=Math.abs(ve(n)-n[0]),s=o/(o-2*i),l=e===_r?wk(t,null,s):e===Wu?r0(t,null,s,.5):e===qu?r0(t,null,s,r||1):e===Ah?xk(t,null,s,a||1):bk(t,null,s);return t=t.slice(),t[0]=l[0],t[t.length-1]=l[1],t}function a$(e,t,n){if(GT(e)){var i=Math.abs(t.reduce(function(r,a){return r+(a<0?-1:a>0?1:0)},0));i!==t.length&&n.warn("Log scale domain includes zero: "+B(t))}return t}function zG(e,t,n){let i=t.bins;if(i&&!I(i)){let r=e.domain(),a=r[0],o=ve(r),s=i.start==null?a:i.start,l=i.stop==null?o:i.stop,u=i.step;u||N("Scale bins parameter missing step property."),s<a&&(s=u*Math.ceil(a/u)),l>o&&(l=u*Math.floor(o/u)),i=po(s,l+u/2,u)}return i?e.bins=i:e.bins&&delete e.bins,e.type===qy&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function BG(e,t,n){var i=e.type,r=t.round||!1,a=t.range;if(t.rangeStep!=null)a=UG(i,t,n);else if(t.scheme&&(a=qG(i,t,n),ge(a))){if(e.interpolator)return e.interpolator(a);N(`Scale type ${i} does not support interpolating color schemes.`)}if(a&&HT(i))return e.interpolator(Bh(Wb(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Ab(t.interpolate,t.interpolateGamma)):ge(e.round)?e.round(r):ge(e.rangeRound)&&e.interpolate(r?Ku:Ro),a&&e.range(Wb(a,t.reverse))}function UG(e,t,n){e!==RO&&e!==Uy&&N("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===Uy?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*zy(n,r,i)]}function qG(e,t,n){var i=t.schemeExtent,r,a;return I(t.scheme)?a=Bh(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),a=Sb(r),a||N(`Unrecognized scheme name: ${t.scheme}`)),n=e===Oh?n+1:e===qy?n-1:e===il||e===Sh?+t.schemeCount||DG:n,HT(e)?o$(a,i,t.reverse):ge(a)?XT(o$(a,i),n):e===By?a:a.slice(0,n)}function o$(e,t,n){return ge(e)&&(t||n)?VT(e,Wb(t||[0,1],n)):e}function Wb(e,t){return t?e.slice().reverse():e}function s$(e){$.call(this,null,e)}var WG=P(s$,$);WG.transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(fo(e.sort)),this.modified(n),t};var l$="zero",u$="center",c$="normalize",f$=["y0","y1"];function Gb(e){$.call(this,null,e)}Gb.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:l$,values:[l$,u$,c$]},{name:"as",type:"string",array:!0,length:2,default:f$}]};var GG=P(Gb,$);GG.transform=function(e,t){var n=e.as||f$,i=n[0],r=n[1],a=fo(e.sort),o=e.field||iu,s=e.offset===u$?HG:e.offset===c$?YG:VG,l,u,c,f;for(l=XG(t.source,e.groupby,a,o),u=0,c=l.length,f=l.max;u<c;++u)s(l[u],f,o,i,r);return t.reflow(e.modified()).modifies(n)};function HG(e,t,n,i,r){for(var a=(t-e.sum)/2,o=e.length,s=0,l;s<o;++s)l=e[s],l[i]=a,l[r]=a+=Math.abs(n(l))}function YG(e,t,n,i,r){for(var a=1/e.sum,o=0,s=e.length,l=0,u=0,c;l<s;++l)c=e[l],c[i]=o,c[r]=o=a*(u+=Math.abs(n(c)))}function VG(e,t,n,i,r){for(var a=0,o=0,s=e.length,l=0,u,c;l<s;++l)c=e[l],u=+n(c),u<0?(c[i]=o,c[r]=o+=u):(c[i]=a,c[r]=a+=u)}function XG(e,t,n,i){var r=[],a=function(g){return g(c)},o,s,l,u,c,f,d,h,p;if(t==null)r.push(e.slice());else for(o={},s=0,l=e.length;s<l;++s)c=e[s],f=t.map(a),d=o[f],d||(o[f]=d=[],r.push(d)),d.push(c);for(f=0,p=0,u=r.length;f<u;++f){for(d=r[f],s=0,h=0,l=d.length;s<l;++s)h+=Math.abs(i(d[s]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return r.max=p,r}var JG=Object.freeze({__proto__:null,axisticks:XC,datajoin:JC,encode:KC,legendentries:QC,linkpath:Ub,pie:qb,scale:r$,sortitems:s$,stack:Gb});function KG(){}const Tr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function d$(){var e=1,t=1,n=s;function i(l,u){return u.map(c=>r(l,c))}function r(l,u){var c=[],f=[];return a(l,u,function(d){n(d,l,u),QG(d)>0?c.push([d]):f.push(d)}),f.forEach(function(d){for(var h=0,p=c.length,g;h<p;++h)if(ZG((g=c[h])[0],d)!==-1){g.push(d);return}}),{type:"MultiPolygon",value:u,coordinates:c}}function a(l,u,c){var f=new Array(),d=new Array(),h,p,g,m,v,y;for(h=p=-1,m=l[0]>=u,Tr[m<<1].forEach(b);++h<e-1;)g=m,m=l[h+1]>=u,Tr[g|m<<1].forEach(b);for(Tr[m<<0].forEach(b);++p<t-1;){for(h=-1,m=l[p*e+e]>=u,v=l[p*e]>=u,Tr[m<<1|v<<2].forEach(b);++h<e-1;)g=m,m=l[p*e+e+h+1]>=u,y=v,v=l[p*e+h+1]>=u,Tr[g|m<<1|v<<2|y<<3].forEach(b);Tr[m|v<<3].forEach(b)}for(h=-1,v=l[p*e]>=u,Tr[v<<2].forEach(b);++h<e-1;)y=v,v=l[p*e+h+1]>=u,Tr[v<<2|y<<3].forEach(b);Tr[v<<3].forEach(b);function b(E){var x=[E[0][0]+h,E[0][1]+p],k=[E[1][0]+h,E[1][1]+p],w=o(x),A=o(k),_,O;(_=d[w])?(O=f[A])?(delete d[_.end],delete f[O.start],_===O?(_.ring.push(k),c(_.ring)):f[_.start]=d[O.end]={start:_.start,end:O.end,ring:_.ring.concat(O.ring)}):(delete d[_.end],_.ring.push(k),d[_.end=A]=_):(_=f[A])?(O=d[w])?(delete f[_.start],delete d[O.end],_===O?(_.ring.push(k),c(_.ring)):f[O.start]=d[_.end]={start:O.start,end:_.end,ring:O.ring.concat(_.ring)}):(delete f[_.start],_.ring.unshift(x),f[_.start=w]=_):f[w]=d[A]={start:w,end:A,ring:[x,k]}}}function o(l){return l[0]*2+l[1]*(e+1)*4}function s(l,u,c){l.forEach(function(f){var d=f[0],h=f[1],p=d|0,g=h|0,m,v=u[g*e+p];d>0&&d<e&&p===d&&(m=u[g*e+p-1],f[0]=d+(c-m)/(v-m)-.5),h>0&&h<t&&g===h&&(m=u[(g-1)*e+p],f[1]=h+(c-m)/(v-m)-.5)})}return i.contour=r,i.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),c=Math.floor(l[1]);return u>=0&&c>=0||N("invalid size"),e=u,t=c,i},i.smooth=function(l){return arguments.length?(n=l?s:KG,i):n===s},i}function QG(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function ZG(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=eH(e,t[n]))return r;return 0}function eH(e,t){for(var n=t[0],i=t[1],r=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(tH(l,f,t))return 0;c>i!==h>i&&n<(d-u)*(i-c)/(h-c)+u&&(r=-r)}return r}function tH(e,t,n){var i;return nH(e,t,n)&&iH(e[i=+(e[0]===t[0])],n[i],t[i])}function nH(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function iH(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function h$(e,t,n){return function(i){var r=yr(i),a=n?Math.min(r[0],0):r[0],o=r[1],s=o-a,l=t?ia(a,o,e):s/(e+1);return po(l,o,l)}}function Hb(e){$.call(this,null,e)}Hb.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};var rH=P(Hb,$);rH.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||Yt,a=d$().smooth(e.smooth!==!1),o=e.thresholds||aH(i,r,e),s=e.as===null?null:e.as||"contour",l=[];return i.forEach(u=>{const c=r(u),f=a.size([c.width,c.height])(c.values,I(o)?o:o(c.values));oH(f,c,u,e),f.forEach(d=>{l.push(o0(u,ke(s!=null?{[s]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function aH(e,t,n){const i=h$(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>go(t(r).values)))}function oH(e,t,n,i){let r=i.scale||t.scale,a=i.translate||t.translate;if(ge(r)&&(r=r(n,i)),ge(a)&&(a=a(n,i)),(r===1||r==null)&&!a)return;const o=(Re(r)?r:r[0])||1,s=(Re(r)?r:r[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(p$(t,o,s,l,u))}function p$(e,t,n,i,r){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(f){f.forEach(u)}function u(f){s&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-a)*t+i,f[1]=(f[1]-o)*n+r}return function(f){return f.coordinates.forEach(l),f}}function g$(e,t,n){const i=e>=0?e:tv(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Yb(e){return ge(e)?e:Vt(+e)}function m$(){var e=l=>l[0],t=l=>l[1],n=iu,i=[-1,-1],r=960,a=500,o=2;function s(l,u){const c=g$(i[0],l,e)>>o,f=g$(i[1],l,t)>>o,d=c?c+2:0,h=f?f+2:0,p=2*d+(r>>o),g=2*h+(a>>o),m=new Float32Array(p*g),v=new Float32Array(p*g);let y=m;l.forEach(E=>{const x=d+(+e(E)>>o),k=h+(+t(E)>>o);x>=0&&x<p&&k>=0&&k<g&&(m[x+k*p]+=+n(E))}),c>0&&f>0?(dl(p,g,m,v,c),hl(p,g,v,m,f),dl(p,g,m,v,c),hl(p,g,v,m,f),dl(p,g,m,v,c),hl(p,g,v,m,f)):c>0?(dl(p,g,m,v,c),dl(p,g,v,m,c),dl(p,g,m,v,c),y=v):f>0&&(hl(p,g,m,v,f),hl(p,g,v,m,f),hl(p,g,m,v,f),y=v);let b=u?Math.pow(2,-2*o):1/Xk(y);for(let E=0,x=p*g;E<x;++E)y[E]*=b;return{values:y,scale:1<<o,width:p,height:g,x1:d,y1:h,x2:d+(r>>o),y2:h+(a>>o)}}return s.x=function(l){return arguments.length?(e=Yb(l),s):e},s.y=function(l){return arguments.length?(t=Yb(l),s):t},s.weight=function(l){return arguments.length?(n=Yb(l),s):n},s.size=function(l){if(!arguments.length)return[r,a];var u=+l[0],c=+l[1];return u>=0&&c>=0||N("invalid size"),r=u,a=c,s},s.cellSize=function(l){return arguments.length?((l=+l)>=1||N("invalid cell size"),o=Math.floor(Math.log(l)/Math.LN2),s):1<<o},s.bandwidth=function(l){return arguments.length?(l=G(l),l.length===1&&(l=[+l[0],+l[0]]),l.length!==2&&N("invalid bandwidth"),i=l,s):i},s}function dl(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<t;++o)for(let s=0,l=0;s<e+r;++s)s<e&&(l+=n[s+o*e]),s>=r&&(s>=a&&(l-=n[s-a+o*e]),i[s-r+o*e]=l/Math.min(s+1,e-1+a-s,a))}function hl(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<e;++o)for(let s=0,l=0;s<t+r;++s)s<t&&(l+=n[o+s*e]),s>=r&&(s>=a&&(l-=n[o+(s-a)*e]),i[o+(s-r)*e]=l/Math.min(s+1,t-1+a-s,a))}function Vb(e){$.call(this,null,e)}Vb.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var sH=P(Vb,$);const lH=["x","y","weight","size","cellSize","bandwidth"];function v$(e,t){return lH.forEach(n=>t[n]!=null?e[n](t[n]):0),e}sH.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=uH(i,e.groupby),a=(e.groupby||[]).map(et),o=v$(m$(),e),s=e.as||"grid",l=[];function u(c,f){for(let d=0;d<a.length;++d)c[a[d]]=f[d];return c}return l=r.map(c=>ke(u({[s]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function uH(e,t){var n=[],i=c=>c(s),r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function Xb(e){$.call(this,null,e)}Xb.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};var cH=P(Xb,$);cH.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=d$().smooth(e.smooth!==!1),r=e.values,a=e.thresholds||h$(e.count||10,e.nice,!!r),o=e.size,s,l;return r||(r=t.materialize(t.SOURCE).source,s=v$(m$(),e)(r,!0),l=p$(s,s.scale||1,s.scale||1,0,0),o=[s.width,s.height],r=s.values),a=I(a)?a:a(r),r=i.size(o)(r,a),l&&r.forEach(l),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(ke),n};var Jb="Feature",Kb="FeatureCollection",fH="MultiPoint";function Qb(e){$.call(this,null,e)}Qb.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};var dH=P(Qb,$);dH.transform=function(e,t){var n=this._features,i=this._points,r=e.fields,a=r&&r[0],o=r&&r[1],s=e.geojson||!r&&Yt,l=t.ADD,u;u=e.modified()||t.changed(t.REM)||t.modified(Ht(s))||a&&t.modified(Ht(a))||o&&t.modified(Ht(o)),(!this.value||u)&&(l=t.SOURCE,this._features=n=[],this._points=i=[]),s&&t.visit(l,function(c){n.push(s(c))}),a&&o&&(t.visit(l,function(c){var f=a(c),d=o(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:Jb,geometry:{type:fH,coordinates:i}})),this.value={type:Kb,features:n}};function Io(){return new Xh()}function Xh(){this.reset()}Xh.prototype={constructor:Xh,reset:function(){this.s=this.t=0},add:function(e){y$(Jh,e,this.t),y$(this,Jh.s,this.s),this.s?this.t+=Jh.t:this.s=Jh.t},valueOf:function(){return this.s}};var Jh=new Xh();function y$(e,t,n){var i=e.s=t+n,r=i-t,a=i-r;e.t=t-a+(n-r)}var ie=1e-6,Zb=1e-12,de=Math.PI,Ve=de/2,Kh=de/4,Jt=de*2,tt=180/de,he=de/180,ye=Math.abs,pl=Math.atan,Jn=Math.atan2,re=Math.cos,Qh=Math.ceil,b$=Math.exp,Zh=Math.log,e1=Math.pow,te=Math.sin,Kn=Math.sign||function(e){return e>0?1:e<0?-1:0},Tt=Math.sqrt,t1=Math.tan;function w$(e){return e>1?0:e<-1?de:Math.acos(e)}function bn(e){return e>1?Ve:e<-1?-Ve:Math.asin(e)}function Ct(){}function ep(e,t){e&&E$.hasOwnProperty(e.type)&&E$[e.type](e,t)}var x$={Feature:function(e,t){ep(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)ep(n[i].geometry,t)}},E$={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){n1(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)n1(n[i],t,0)},Polygon:function(e,t){k$(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)k$(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)ep(n[i],t)}};function n1(e,t,n){var i=-1,r=e.length-n,a;for(t.lineStart();++i<r;)a=e[i],t.point(a[0],a[1],a[2]);t.lineEnd()}function k$(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)n1(e[n],t,1);t.polygonEnd()}function Cr(e,t){e&&x$.hasOwnProperty(e.type)?x$[e.type](e,t):ep(e,t)}var tp=Io(),np=Io(),_$,A$,i1,r1,a1,Hi={point:Ct,lineStart:Ct,lineEnd:Ct,polygonStart:function(){tp.reset(),Hi.lineStart=hH,Hi.lineEnd=pH},polygonEnd:function(){var e=+tp;np.add(e<0?Jt+e:e),this.lineStart=this.lineEnd=this.point=Ct},sphere:function(){np.add(Jt)}};function hH(){Hi.point=gH}function pH(){S$(_$,A$)}function gH(e,t){Hi.point=S$,_$=e,A$=t,e*=he,t*=he,i1=e,r1=re(t=t/2+Kh),a1=te(t)}function S$(e,t){e*=he,t*=he,t=t/2+Kh;var n=e-i1,i=n>=0?1:-1,r=i*n,a=re(t),o=te(t),s=a1*o,l=r1*a+s*re(r),u=s*i*te(r);tp.add(Jn(u,l)),i1=e,r1=a,a1=o}function mH(e){return np.reset(),Cr(e,Hi),np*2}function ip(e){return[Jn(e[1],e[0]),bn(e[2])]}function Mo(e){var t=e[0],n=e[1],i=re(n);return[i*re(t),i*te(t),te(n)]}function rp(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gl(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function o1(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function ap(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function op(e){var t=Tt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ge,wn,Xe,jn,jo,O$,T$,ml,sc=Io(),_a,$r,Dr={point:s1,lineStart:$$,lineEnd:D$,polygonStart:function(){Dr.point=R$,Dr.lineStart=vH,Dr.lineEnd=yH,sc.reset(),Hi.polygonStart()},polygonEnd:function(){Hi.polygonEnd(),Dr.point=s1,Dr.lineStart=$$,Dr.lineEnd=D$,tp<0?(Ge=-(Xe=180),wn=-(jn=90)):sc>ie?jn=90:sc<-ie&&(wn=-90),$r[0]=Ge,$r[1]=Xe},sphere:function(){Ge=-(Xe=180),wn=-(jn=90)}};function s1(e,t){_a.push($r=[Ge=e,Xe=e]),t<wn&&(wn=t),t>jn&&(jn=t)}function C$(e,t){var n=Mo([e*he,t*he]);if(ml){var i=gl(ml,n),r=[i[1],-i[0],0],a=gl(r,i);op(a),a=ip(a);var o=e-jo,s=o>0?1:-1,l=a[0]*tt*s,u,c=ye(o)>180;c^(s*jo<l&&l<s*e)?(u=a[1]*tt,u>jn&&(jn=u)):(l=(l+360)%360-180,c^(s*jo<l&&l<s*e))?(u=-a[1]*tt,u<wn&&(wn=u)):(t<wn&&(wn=t),t>jn&&(jn=t)),c?e<jo?Ln(Ge,e)>Ln(Ge,Xe)&&(Xe=e):Ln(e,Xe)>Ln(Ge,Xe)&&(Ge=e):Xe>=Ge?(e<Ge&&(Ge=e),e>Xe&&(Xe=e)):e>jo?Ln(Ge,e)>Ln(Ge,Xe)&&(Xe=e):Ln(e,Xe)>Ln(Ge,Xe)&&(Ge=e)}else _a.push($r=[Ge=e,Xe=e]);t<wn&&(wn=t),t>jn&&(jn=t),ml=n,jo=e}function $$(){Dr.point=C$}function D$(){$r[0]=Ge,$r[1]=Xe,Dr.point=s1,ml=null}function R$(e,t){if(ml){var n=e-jo;sc.add(ye(n)>180?n+(n>0?360:-360):n)}else O$=e,T$=t;Hi.point(e,t),C$(e,t)}function vH(){Hi.lineStart()}function yH(){R$(O$,T$),Hi.lineEnd(),ye(sc)>ie&&(Ge=-(Xe=180)),$r[0]=Ge,$r[1]=Xe,ml=null}function Ln(e,t){return(t-=e)<0?t+360:t}function bH(e,t){return e[0]-t[0]}function N$(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function wH(e){var t,n,i,r,a,o,s;if(jn=Xe=-(Ge=wn=Infinity),_a=[],Cr(e,Dr),n=_a.length){for(_a.sort(bH),t=1,i=_a[0],a=[i];t<n;++t)r=_a[t],N$(i,r[0])||N$(i,r[1])?(Ln(i[0],r[1])>Ln(i[0],i[1])&&(i[1]=r[1]),Ln(r[0],i[1])>Ln(i[0],i[1])&&(i[0]=r[0])):a.push(i=r);for(o=-Infinity,n=a.length-1,t=0,i=a[n];t<=n;i=r,++t)r=a[t],(s=Ln(i[1],r[0]))>o&&(o=s,Ge=r[0],Xe=i[1])}return _a=$r=null,Ge===Infinity||wn===Infinity?[[NaN,NaN],[NaN,NaN]]:[[Ge,wn],[Xe,jn]]}var lc,sp,lp,up,cp,fp,dp,hp,l1,u1,c1,F$,I$,Kt,Qt,Zt,bi={sphere:Ct,point:f1,lineStart:M$,lineEnd:j$,polygonStart:function(){bi.lineStart=kH,bi.lineEnd=_H},polygonEnd:function(){bi.lineStart=M$,bi.lineEnd=j$}};function f1(e,t){e*=he,t*=he;var n=re(t);uc(n*re(e),n*te(e),te(t))}function uc(e,t,n){++lc,lp+=(e-lp)/lc,up+=(t-up)/lc,cp+=(n-cp)/lc}function M$(){bi.point=xH}function xH(e,t){e*=he,t*=he;var n=re(t);Kt=n*re(e),Qt=n*te(e),Zt=te(t),bi.point=EH,uc(Kt,Qt,Zt)}function EH(e,t){e*=he,t*=he;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Jn(Tt((o=Qt*a-Zt*r)*o+(o=Zt*i-Kt*a)*o+(o=Kt*r-Qt*i)*o),Kt*i+Qt*r+Zt*a);sp+=o,fp+=o*(Kt+(Kt=i)),dp+=o*(Qt+(Qt=r)),hp+=o*(Zt+(Zt=a)),uc(Kt,Qt,Zt)}function j$(){bi.point=f1}function kH(){bi.point=AH}function _H(){L$(F$,I$),bi.point=f1}function AH(e,t){F$=e,I$=t,e*=he,t*=he,bi.point=L$;var n=re(t);Kt=n*re(e),Qt=n*te(e),Zt=te(t),uc(Kt,Qt,Zt)}function L$(e,t){e*=he,t*=he;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Qt*a-Zt*r,s=Zt*i-Kt*a,l=Kt*r-Qt*i,u=Tt(o*o+s*s+l*l),c=bn(u),f=u&&-c/u;l1+=f*o,u1+=f*s,c1+=f*l,sp+=c,fp+=c*(Kt+(Kt=i)),dp+=c*(Qt+(Qt=r)),hp+=c*(Zt+(Zt=a)),uc(Kt,Qt,Zt)}function SH(e){lc=sp=lp=up=cp=fp=dp=hp=l1=u1=c1=0,Cr(e,bi);var t=l1,n=u1,i=c1,r=t*t+n*n+i*i;return r<Zb&&(t=fp,n=dp,i=hp,sp<ie&&(t=lp,n=up,i=cp),r=t*t+n*n+i*i,r<Zb)?[NaN,NaN]:[Jn(n,t)*tt,bn(i/Tt(r))*tt]}function d1(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function h1(e,t){return[ye(e)>de?e+Math.round(-e/Jt)*Jt:e,t]}h1.invert=h1;function P$(e,t,n){return(e%=Jt)?t||n?d1(B$(e),U$(t,n)):B$(e):t||n?U$(t,n):h1}function z$(e){return function(t,n){return t+=e,[t>de?t-Jt:t<-de?t+Jt:t,n]}}function B$(e){var t=z$(e);return t.invert=z$(-e),t}function U$(e,t){var n=re(e),i=te(e),r=re(t),a=te(t);function o(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*n+c*i;return[Jn(f*r-h*a,c*n-d*i),bn(h*r+f*a)]}return o.invert=function(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*r-f*a;return[Jn(f*r+d*a,c*n+h*i),bn(h*n-c*i)]},o}function OH(e){e=P$(e[0]*he,e[1]*he,e.length>2?e[2]*he:0);function t(n){return n=e(n[0]*he,n[1]*he),n[0]*=tt,n[1]*=tt,n}return t.invert=function(n){return n=e.invert(n[0]*he,n[1]*he),n[0]*=tt,n[1]*=tt,n},t}function TH(e,t,n,i,r,a){if(!n)return;var o=re(t),s=te(t),l=i*n;r==null?(r=t+i*Jt,a=t-l/2):(r=q$(o,r),a=q$(o,a),(i>0?r<a:r>a)&&(r+=i*Jt));for(var u,c=r;i>0?c>a:c<a;c-=l)u=ip([o,-s*re(c),-s*te(c)]),e.point(u[0],u[1])}function q$(e,t){t=Mo(t),t[0]-=e,op(t);var n=w$(-t[1]);return((-t[2]<0?-n:n)+Jt-ie)%Jt}function W$(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Ct,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function pp(e,t){return ye(e[0]-t[0])<ie&&ye(e[1]-t[1])<ie}function gp(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function G$(e,t,n,i,r){var a=[],o=[],s,l;if(e.forEach(function(p){if((g=p.length-1)<=0)return;var g,m=p[0],v=p[g],y;if(pp(m,v)){if(!m[2]&&!v[2]){for(r.lineStart(),s=0;s<g;++s)r.point((m=p[s])[0],m[1]);r.lineEnd();return}v[0]+=2*ie}a.push(y=new gp(m,p,null,!0)),o.push(y.o=new gp(m,null,y,!1)),a.push(y=new gp(v,p,null,!1)),o.push(y.o=new gp(v,null,y,!0))}),!a.length)return;for(o.sort(t),H$(a),H$(o),s=0,l=o.length;s<l;++s)o[s].e=n=!n;for(var u=a[0],c,f;;){for(var d=u,h=!0;d.v;)if((d=d.n)===u)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,l=c.length;s<l;++s)r.point((f=c[s])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)r.point((f=c[s])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}function H$(e){if(!(t=e.length))return;for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}var p1=Io();function g1(e){return ye(e[0])<=de?e[0]:Kn(e[0])*((ye(e[0])+de)%Jt-de)}function CH(e,t){var n=g1(t),i=t[1],r=te(i),a=[te(n),-re(n),0],o=0,s=0;p1.reset(),r===1?i=Ve+ie:r===-1&&(i=-Ve-ie);for(var l=0,u=e.length;l<u;++l){if(!(f=(c=e[l]).length))continue;for(var c,f,d=c[f-1],h=g1(d),p=d[1]/2+Kh,g=te(p),m=re(p),v=0;v<f;++v,h=b,g=x,m=k,d=y){var y=c[v],b=g1(y),E=y[1]/2+Kh,x=te(E),k=re(E),w=b-h,A=w>=0?1:-1,_=A*w,O=_>de,S=g*x;if(p1.add(Jn(S*A*te(_),m*k+S*re(_))),o+=O?w+A*Jt:w,O^h>=n^b>=n){var T=gl(Mo(d),Mo(y));op(T);var D=gl(a,T);op(D);var M=(O^w>=0?-1:1)*bn(D[2]);(i>M||i===M&&(T[0]||T[1]))&&(s+=O^w>=0?1:-1)}}}return(o<-ie||o<ie&&p1<-ie)^s&1}function Y$(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function $H(e){return e.length===1&&(e=DH(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function DH(e){return function(t,n){return Y$(e(t),n)}}var whe=$H(Y$);function vl(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}function V$(e){for(var t=e.length,n,i=-1,r=0,a,o;++i<t;)r+=e[i].length;for(a=new Array(r);--t>=0;)for(o=e[t],n=o.length;--n>=0;)a[--r]=o[n];return a}function X$(e,t,n,i){return function(r){var a=t(r),o=W$(),s=t(o),l=!1,u,c,f,d={point:h,lineStart:g,lineEnd:m,polygonStart:function(){d.point=v,d.lineStart=y,d.lineEnd=b,c=[],u=[]},polygonEnd:function(){d.point=h,d.lineStart=g,d.lineEnd=m,c=V$(c);var E=CH(u,i);c.length?(l||(r.polygonStart(),l=!0),G$(c,NH,E,n,r)):E&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),c=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(E,x){e(E,x)&&r.point(E,x)}function p(E,x){a.point(E,x)}function g(){d.point=p,a.lineStart()}function m(){d.point=h,a.lineEnd()}function v(E,x){f.push([E,x]),s.point(E,x)}function y(){s.lineStart(),f=[]}function b(){v(f[0][0],f[0][1]),s.lineEnd();var E=s.clean(),x=o.result(),k,w=x.length,A,_,O;if(f.pop(),u.push(f),f=null,!w)return;if(E&1){if(_=x[0],(A=_.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),k=0;k<A;++k)r.point((O=_[k])[0],O[1]);r.lineEnd()}return}w>1&&E&2&&x.push(x.pop().concat(x.shift())),c.push(x.filter(RH))}return d}}function RH(e){return e.length>1}function NH(e,t){return((e=e.x)[0]<0?e[1]-Ve-ie:Ve-e[1])-((t=t.x)[0]<0?t[1]-Ve-ie:Ve-t[1])}var J$=X$(function(){return!0},FH,MH,[-de,-Ve]);function FH(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(a,o){var s=a>0?de:-de,l=ye(a-t);ye(l-de)<ie?(e.point(t,n=(n+o)/2>0?Ve:-Ve),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),r=0):i!==s&&l>=de&&(ye(t-i)<ie&&(t-=i*ie),ye(a-s)<ie&&(a-=s*ie),n=IH(t,n,a,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),r=0),e.point(t=a,n=o),i=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function IH(e,t,n,i){var r,a,o=te(e-n);return ye(o)>ie?pl((te(t)*(a=re(i))*te(n)-te(i)*(r=re(t))*te(e))/(r*a*o)):(t+i)/2}function MH(e,t,n,i){var r;if(e==null)r=n*Ve,i.point(-de,r),i.point(0,r),i.point(de,r),i.point(de,0),i.point(de,-r),i.point(0,-r),i.point(-de,-r),i.point(-de,0),i.point(-de,r);else if(ye(e[0]-t[0])>ie){var a=e[0]<t[0]?de:-de;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function jH(e){var t=re(e),n=6*he,i=t>0,r=ye(t)>ie;function a(c,f,d,h){TH(h,e,n,d,c,f)}function o(c,f){return re(c)*re(f)>t}function s(c){var f,d,h,p,g;return{lineStart:function(){p=h=!1,g=1},point:function(m,v){var y=[m,v],b,E=o(m,v),x=i?E?0:u(m,v):E?u(m+(m<0?de:-de),v):0;if(!f&&(p=h=E)&&c.lineStart(),E!==h&&(b=l(f,y),(!b||pp(f,b)||pp(y,b))&&(y[2]=1)),E!==h)g=0,E?(c.lineStart(),b=l(y,f),c.point(b[0],b[1])):(b=l(f,y),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(r&&f&&i^E){var k;!(x&d)&&(k=l(y,f,!0))&&(g=0,i?(c.lineStart(),c.point(k[0][0],k[0][1]),c.point(k[1][0],k[1][1]),c.lineEnd()):(c.point(k[1][0],k[1][1]),c.lineEnd(),c.lineStart(),c.point(k[0][0],k[0][1],3)))}E&&(!f||!pp(f,y))&&c.point(y[0],y[1]),f=y,h=E,d=x},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return g|(p&&h)<<1}}}function l(c,f,d){var h=Mo(c),p=Mo(f),g=[1,0,0],m=gl(h,p),v=rp(m,m),y=m[0],b=v-y*y;if(!b)return!d&&c;var E=t*v/b,x=-t*y/b,k=gl(g,m),w=ap(g,E),A=ap(m,x);o1(w,A);var _=k,O=rp(w,_),S=rp(_,_),T=O*O-S*(rp(w,w)-1);if(T<0)return;var D=Tt(T),M=ap(_,(-O-D)/S);if(o1(M,w),M=ip(M),!d)return M;var C=c[0],F=f[0],W=c[1],X=f[1],J;F<C&&(J=C,C=F,F=J);var xe=F-C,Pe=ye(xe-de)<ie,dt=Pe||xe<ie;if(!Pe&&X<W&&(J=W,W=X,X=J),dt?Pe?W+X>0^M[1]<(ye(M[0]-C)<ie?W:X):W<=M[1]&&M[1]<=X:xe>de^(C<=M[0]&&M[0]<=F)){var ht=ap(_,(-O+D)/S);return o1(ht,w),[M,ip(ht)]}}function u(c,f){var d=i?e:de-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return X$(o,s,a,i?[0,-e]:[-de,e-de])}function LH(e,t,n,i,r,a){var o=e[0],s=e[1],l=t[0],u=t[1],c=0,f=1,d=l-o,h=u-s,p;if(p=n-o,!d&&p>0)return;if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=r-o,!d&&p<0)return;if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}if(p=i-s,!h&&p>0)return;if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=a-s,!h&&p<0)return;if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*d,e[1]=s+c*h),f<1&&(t[0]=o+f*d,t[1]=s+f*h),!0}var cc=1e9,mp=-cc;function K$(e,t,n,i){function r(u,c){return e<=u&&u<=n&&t<=c&&c<=i}function a(u,c,f,d){var h=0,p=0;if(u==null||(h=o(u,f))!==(p=o(c,f))||l(u,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==p);else d.point(c[0],c[1])}function o(u,c){return ye(u[0]-e)<ie?c>0?0:3:ye(u[0]-n)<ie?c>0?2:1:ye(u[1]-t)<ie?c>0?1:0:c>0?3:2}function s(u,c){return l(u.x,c.x)}function l(u,c){var f=o(u,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-u[1]:f===1?u[0]-c[0]:f===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,f=W$(),d,h,p,g,m,v,y,b,E,x,k,w={point:A,lineStart:T,lineEnd:D,polygonStart:O,polygonEnd:S};function A(C,F){r(C,F)&&c.point(C,F)}function _(){for(var C=0,F=0,W=h.length;F<W;++F)for(var X=h[F],J=1,xe=X.length,Pe=X[0],dt,ht,Ke=Pe[0],Rt=Pe[1];J<xe;++J)dt=Ke,ht=Rt,Pe=X[J],Ke=Pe[0],Rt=Pe[1],ht<=i?Rt>i&&(Ke-dt)*(i-ht)>(Rt-ht)*(e-dt)&&++C:Rt<=i&&(Ke-dt)*(i-ht)<(Rt-ht)*(e-dt)&&--C;return C}function O(){c=f,d=[],h=[],k=!0}function S(){var C=_(),F=k&&C,W=(d=V$(d)).length;(F||W)&&(u.polygonStart(),F&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),W&&G$(d,s,C,a,u),u.polygonEnd()),c=u,d=h=p=null}function T(){w.point=M,h&&h.push(p=[]),x=!0,E=!1,y=b=NaN}function D(){d&&(M(g,m),v&&E&&f.rejoin(),d.push(f.result())),w.point=A,E&&c.lineEnd()}function M(C,F){var W=r(C,F);if(h&&p.push([C,F]),x)g=C,m=F,v=W,x=!1,W&&(c.lineStart(),c.point(C,F));else if(W&&E)c.point(C,F);else{var X=[y=Math.max(mp,Math.min(cc,y)),b=Math.max(mp,Math.min(cc,b))],J=[C=Math.max(mp,Math.min(cc,C)),F=Math.max(mp,Math.min(cc,F))];LH(X,J,e,t,n,i)?(E||(c.lineStart(),c.point(X[0],X[1])),c.point(J[0],J[1]),W||c.lineEnd(),k=!1):W&&(c.lineStart(),c.point(C,F),k=!1)}y=C,b=F,E=W}return w}}function Q$(e,t,n){var i=vl(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[r,a]})}}function Z$(e,t,n){var i=vl(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[a,r]})}}function PH(){var e,t,n,i,r,a,o,s,l=10,u=l,c=90,f=360,d,h,p,g,m=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return vl(Qh(i/c)*c,n,c).map(p).concat(vl(Qh(s/f)*f,o,f).map(g)).concat(vl(Qh(t/l)*l,e,l).filter(function(b){return ye(b%c)>ie}).map(d)).concat(vl(Qh(a/u)*u,r,u).filter(function(b){return ye(b%f)>ie}).map(h))}return v.lines=function(){return y().map(function(b){return{type:"LineString",coordinates:b}})},v.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(g(o).slice(1),p(n).reverse().slice(1),g(s).reverse().slice(1))]}},v.extent=function(b){return arguments.length?v.extentMajor(b).extentMinor(b):v.extentMinor()},v.extentMajor=function(b){return arguments.length?(i=+b[0][0],n=+b[1][0],s=+b[0][1],o=+b[1][1],i>n&&(b=i,i=n,n=b),s>o&&(b=s,s=o,o=b),v.precision(m)):[[i,s],[n,o]]},v.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],a=+b[0][1],r=+b[1][1],t>e&&(b=t,t=e,e=b),a>r&&(b=a,a=r,r=b),v.precision(m)):[[t,a],[e,r]]},v.step=function(b){return arguments.length?v.stepMajor(b).stepMinor(b):v.stepMinor()},v.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],v):[c,f]},v.stepMinor=function(b){return arguments.length?(l=+b[0],u=+b[1],v):[l,u]},v.precision=function(b){return arguments.length?(m=+b,d=Q$(a,r,90),h=Z$(t,e,m),p=Q$(s,o,90),g=Z$(i,n,m),v):m},v.extentMajor([[-180,-90+ie],[180,90-ie]]).extentMinor([[-180,-80-ie],[180,80+ie]])}function fc(e){return e}var m1=Io(),v1=Io(),eD,tD,y1,b1,Rr={point:Ct,lineStart:Ct,lineEnd:Ct,polygonStart:function(){Rr.lineStart=zH,Rr.lineEnd=UH},polygonEnd:function(){Rr.lineStart=Rr.lineEnd=Rr.point=Ct,m1.add(ye(v1)),v1.reset()},result:function(){var e=m1/2;return m1.reset(),e}};function zH(){Rr.point=BH}function BH(e,t){Rr.point=nD,eD=y1=e,tD=b1=t}function nD(e,t){v1.add(b1*e-y1*t),y1=e,b1=t}function UH(){nD(eD,tD)}var yl=Infinity,vp=yl,dc=-yl,yp=dc,bp={point:qH,lineStart:Ct,lineEnd:Ct,polygonStart:Ct,polygonEnd:Ct,result:function(){var e=[[yl,vp],[dc,yp]];return dc=yp=-(vp=yl=Infinity),e}};function qH(e,t){e<yl&&(yl=e),e>dc&&(dc=e),t<vp&&(vp=t),t>yp&&(yp=t)}var w1=0,x1=0,hc=0,wp=0,xp=0,bl=0,E1=0,k1=0,pc=0,iD,rD,Yi,Vi,Qn={point:Lo,lineStart:aD,lineEnd:oD,polygonStart:function(){Qn.lineStart=HH,Qn.lineEnd=YH},polygonEnd:function(){Qn.point=Lo,Qn.lineStart=aD,Qn.lineEnd=oD},result:function(){var e=pc?[E1/pc,k1/pc]:bl?[wp/bl,xp/bl]:hc?[w1/hc,x1/hc]:[NaN,NaN];return w1=x1=hc=wp=xp=bl=E1=k1=pc=0,e}};function Lo(e,t){w1+=e,x1+=t,++hc}function aD(){Qn.point=WH}function WH(e,t){Qn.point=GH,Lo(Yi=e,Vi=t)}function GH(e,t){var n=e-Yi,i=t-Vi,r=Tt(n*n+i*i);wp+=r*(Yi+e)/2,xp+=r*(Vi+t)/2,bl+=r,Lo(Yi=e,Vi=t)}function oD(){Qn.point=Lo}function HH(){Qn.point=VH}function YH(){sD(iD,rD)}function VH(e,t){Qn.point=sD,Lo(iD=Yi=e,rD=Vi=t)}function sD(e,t){var n=e-Yi,i=t-Vi,r=Tt(n*n+i*i);wp+=r*(Yi+e)/2,xp+=r*(Vi+t)/2,bl+=r,r=Vi*e-Yi*t,E1+=r*(Yi+e),k1+=r*(Vi+t),pc+=r*3,Lo(Yi=e,Vi=t)}function lD(e){this._context=e}lD.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Jt);break}}},result:Ct};var _1=Io(),A1,uD,cD,gc,mc,vc={point:Ct,lineStart:function(){vc.point=XH},lineEnd:function(){A1&&fD(uD,cD),vc.point=Ct},polygonStart:function(){A1=!0},polygonEnd:function(){A1=null},result:function(){var e=+_1;return _1.reset(),e}};function XH(e,t){vc.point=fD,uD=gc=e,cD=mc=t}function fD(e,t){gc-=e,mc-=t,_1.add(Tt(gc*gc+mc*mc)),gc=e,mc=t}function dD(){this._string=[]}dD.prototype={_radius:4.5,_circle:hD(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=hD(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function hD(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function pD(e,t){var n=4.5,i,r;function a(o){return o&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Cr(o,i(r))),r.result()}return a.area=function(o){return Cr(o,i(Rr)),Rr.result()},a.measure=function(o){return Cr(o,i(vc)),vc.result()},a.bounds=function(o){return Cr(o,i(bp)),bp.result()},a.centroid=function(o){return Cr(o,i(Qn)),Qn.result()},a.projection=function(o){return arguments.length?(i=o==null?(e=null,fc):(e=o).stream,a):e},a.context=function(o){return arguments.length?(r=o==null?(t=null,new dD()):new lD(t=o),typeof n!="function"&&r.pointRadius(n),a):t},a.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(r.pointRadius(+o),+o),a):n},a.projection(e).context(t)}function Ep(e){return function(t){var n=new S1();for(var i in e)n[i]=e[i];return n.stream=t,n}}function S1(){}S1.prototype={constructor:S1,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function O1(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Cr(n,e.stream(bp)),t(bp.result()),i!=null&&e.clipExtent(i),e}function kp(e,t,n){return O1(e,function(i){var r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),a/(i[1][1]-i[0][1])),s=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(a-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([s,l])},n)}function T1(e,t,n){return kp(e,[[0,0],t],n)}function C1(e,t,n){return O1(e,function(i){var r=+t,a=r/(i[1][0]-i[0][0]),o=(r-a*(i[1][0]+i[0][0]))/2,s=-a*i[0][1];e.scale(150*a).translate([o,s])},n)}function $1(e,t,n){return O1(e,function(i){var r=+t,a=r/(i[1][1]-i[0][1]),o=-a*i[0][0],s=(r-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var gD=16,JH=re(30*he);function mD(e,t){return+t?QH(e,t):KH(e)}function KH(e){return Ep({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function QH(e,t){function n(i,r,a,o,s,l,u,c,f,d,h,p,g,m){var v=u-i,y=c-r,b=v*v+y*y;if(b>4*t&&g--){var E=o+d,x=s+h,k=l+p,w=Tt(E*E+x*x+k*k),A=bn(k/=w),_=ye(ye(k)-1)<ie||ye(a-f)<ie?(a+f)/2:Jn(x,E),O=e(_,A),S=O[0],T=O[1],D=S-i,M=T-r,C=y*D-v*M;(C*C/b>t||ye((v*D+y*M)/b-.5)>.3||o*d+s*h+l*p<JH)&&(n(i,r,a,o,s,l,S,T,_,E/=w,x/=w,k,g,m),m.point(S,T),n(S,T,_,E,x,k,u,c,f,d,h,p,g,m))}}return function(i){var r,a,o,s,l,u,c,f,d,h,p,g,m={point:v,lineStart:y,lineEnd:E,polygonStart:function(){i.polygonStart(),m.lineStart=x},polygonEnd:function(){i.polygonEnd(),m.lineStart=y}};function v(A,_){A=e(A,_),i.point(A[0],A[1])}function y(){f=NaN,m.point=b,i.lineStart()}function b(A,_){var O=Mo([A,_]),S=e(A,_);n(f,d,c,h,p,g,f=S[0],d=S[1],c=A,h=O[0],p=O[1],g=O[2],gD,i),i.point(f,d)}function E(){m.point=v,i.lineEnd()}function x(){y(),m.point=k,m.lineEnd=w}function k(A,_){b(r=A,_),a=f,o=d,s=h,l=p,u=g,m.point=b}function w(){n(f,d,c,h,p,g,a,o,r,s,l,u,gD,i),m.lineEnd=E,E()}return m}}var ZH=Ep({point:function(e,t){this.stream.point(e*he,t*he)}});function eY(e){return Ep({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function tY(e,t,n,i,r){function a(o,s){return o*=i,s*=r,[t+e*o,n-e*s]}return a.invert=function(o,s){return[(o-t)/e*i,(n-s)/e*r]},a}function vD(e,t,n,i,r,a){var o=re(a),s=te(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(g,m){return g*=i,m*=r,[l*g-u*m+t,n-u*g-l*m]}return p.invert=function(g,m){return[i*(c*g-f*m+d),r*(h-f*g-c*m)]},p}function Xi(e){return yD(function(){return e})()}function yD(e){var t,n=150,i=480,r=250,a=0,o=0,s=0,l=0,u=0,c,f=0,d=1,h=1,p=null,g=J$,m=null,v,y,b,E=fc,x=.5,k,w,A,_,O;function S(C){return A(C[0]*he,C[1]*he)}function T(C){return C=A.invert(C[0],C[1]),C&&[C[0]*tt,C[1]*tt]}S.stream=function(C){return _&&O===C?_:_=ZH(eY(c)(g(k(E(O=C)))))},S.preclip=function(C){return arguments.length?(g=C,p=void 0,M()):g},S.postclip=function(C){return arguments.length?(E=C,m=v=y=b=null,M()):E},S.clipAngle=function(C){return arguments.length?(g=+C?jH(p=C*he):(p=null,J$),M()):p*tt},S.clipExtent=function(C){return arguments.length?(E=C==null?(m=v=y=b=null,fc):K$(m=+C[0][0],v=+C[0][1],y=+C[1][0],b=+C[1][1]),M()):m==null?null:[[m,v],[y,b]]},S.scale=function(C){return arguments.length?(n=+C,D()):n},S.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],D()):[i,r]},S.center=function(C){return arguments.length?(a=C[0]%360*he,o=C[1]%360*he,D()):[a*tt,o*tt]},S.rotate=function(C){return arguments.length?(s=C[0]%360*he,l=C[1]%360*he,u=C.length>2?C[2]%360*he:0,D()):[s*tt,l*tt,u*tt]},S.angle=function(C){return arguments.length?(f=C%360*he,D()):f*tt},S.reflectX=function(C){return arguments.length?(d=C?-1:1,D()):d<0},S.reflectY=function(C){return arguments.length?(h=C?-1:1,D()):h<0},S.precision=function(C){return arguments.length?(k=mD(w,x=C*C),M()):Tt(x)},S.fitExtent=function(C,F){return kp(S,C,F)},S.fitSize=function(C,F){return T1(S,C,F)},S.fitWidth=function(C,F){return C1(S,C,F)},S.fitHeight=function(C,F){return $1(S,C,F)};function D(){var C=vD(n,0,0,d,h,f).apply(null,t(a,o)),F=(f?vD:tY)(n,i-C[0],r-C[1],d,h,f);return c=P$(s,l,u),w=d1(t,F),A=d1(c,w),k=mD(w,x),M()}function M(){return _=O=null,S}return function(){return t=e.apply(this,arguments),S.invert=t.invert&&T,D()}}function D1(e){var t=0,n=de/3,i=yD(e),r=i(t,n);return r.parallels=function(a){return arguments.length?i(t=a[0]*he,n=a[1]*he):[t*tt,n*tt]},r}function nY(e){var t=re(e);function n(i,r){return[i*t,te(r)/t]}return n.invert=function(i,r){return[i/t,bn(r*t)]},n}function iY(e,t){var n=te(e),i=(n+te(t))/2;if(ye(i)<ie)return nY(e);var r=1+n*(2*i-n),a=Tt(r)/i;function o(s,l){var u=Tt(r-2*i*te(l))/i;return[u*te(s*=i),a-u*re(s)]}return o.invert=function(s,l){var u=a-l,c=Jn(s,ye(u))*Kn(u);return u*i<0&&(c-=de*Kn(s)*Kn(u)),[c/i,bn((r-(s*s+u*u)*i*i)/(2*i))]},o}function _p(){return D1(iY).scale(155.424).center([0,33.6442])}function bD(){return _p().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function rY(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function aY(){var e,t,n=bD(),i,r=_p().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=_p().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,l,u={point:function(d,h){l=[d,h]}};function c(d){var h=d[0],p=d[1];return l=null,(i.point(h,p),l)||(a.point(h,p),l)||(s.point(h,p),l)}c.invert=function(d){var h=n.scale(),p=n.translate(),g=(d[0]-p[0])/h,m=(d[1]-p[1])/h;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=rY([n.stream(t=d),r.stream(d),o.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),o.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),o.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],g=+d[1];return i=n.translate(d).clipExtent([[p-.455*h,g-.238*h],[p+.455*h,g+.238*h]]).stream(u),a=r.translate([p-.307*h,g+.201*h]).clipExtent([[p-.425*h+ie,g+.12*h+ie],[p-.214*h-ie,g+.234*h-ie]]).stream(u),s=o.translate([p-.205*h,g+.212*h]).clipExtent([[p-.214*h+ie,g+.166*h+ie],[p-.115*h-ie,g+.234*h-ie]]).stream(u),f()},c.fitExtent=function(d,h){return kp(c,d,h)},c.fitSize=function(d,h){return T1(c,d,h)},c.fitWidth=function(d,h){return C1(c,d,h)},c.fitHeight=function(d,h){return $1(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function wD(e){return function(t,n){var i=re(t),r=re(n),a=e(i*r);return[a*r*te(t),a*te(n)]}}function yc(e){return function(t,n){var i=Tt(t*t+n*n),r=e(i),a=te(r),o=re(r);return[Jn(t*a,i*o),bn(i&&n*a/i)]}}var xD=wD(function(e){return Tt(2/(1+e))});xD.invert=yc(function(e){return 2*bn(e/2)});function oY(){return Xi(xD).scale(124.75).clipAngle(180-.001)}var ED=wD(function(e){return(e=w$(e))&&e/te(e)});ED.invert=yc(function(e){return e});function sY(){return Xi(ED).scale(79.4188).clipAngle(180-.001)}function Ap(e,t){return[e,Zh(t1((Ve+t)/2))]}Ap.invert=function(e,t){return[e,2*pl(b$(t))-Ve]};function lY(){return kD(Ap).scale(961/Jt)}function kD(e){var t=Xi(e),n=t.center,i=t.scale,r=t.translate,a=t.clipExtent,o=null,s,l,u;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=s=l=u=null:(o=+f[0][0],s=+f[0][1],l=+f[1][0],u=+f[1][1]),c()):o==null?null:[[o,s],[l,u]]};function c(){var f=de*i(),d=t(OH(t.rotate()).invert([0,0]));return a(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===Ap?[[Math.max(d[0]-f,o),s],[Math.min(d[0]+f,l),u]]:[[o,Math.max(d[1]-f,s)],[l,Math.min(d[1]+f,u)]])}return c()}function Sp(e){return t1((Ve+e)/2)}function uY(e,t){var n=re(e),i=e===t?te(e):Zh(n/re(t))/Zh(Sp(t)/Sp(e)),r=n*e1(Sp(e),i)/i;if(!i)return Ap;function a(o,s){r>0?s<-Ve+ie&&(s=-Ve+ie):s>Ve-ie&&(s=Ve-ie);var l=r/e1(Sp(s),i);return[l*te(i*o),r-l*re(i*o)]}return a.invert=function(o,s){var l=r-s,u=Kn(i)*Tt(o*o+l*l),c=Jn(o,ye(l))*Kn(l);return l*i<0&&(c-=de*Kn(o)*Kn(l)),[c/i,2*pl(e1(r/u,1/i))-Ve]},a}function cY(){return D1(uY).scale(109.5).parallels([30,30])}function Op(e,t){return[e,t]}Op.invert=Op;function fY(){return Xi(Op).scale(152.63)}function dY(e,t){var n=re(e),i=e===t?te(e):(n-re(t))/(t-e),r=n/i+e;if(ye(i)<ie)return Op;function a(o,s){var l=r-s,u=i*o;return[l*te(u),r-l*re(u)]}return a.invert=function(o,s){var l=r-s,u=Jn(o,ye(l))*Kn(l);return l*i<0&&(u-=de*Kn(o)*Kn(l)),[u/i,r-Kn(i)*Tt(o*o+l*l)]},a}function hY(){return D1(dY).scale(131.154).center([0,13.9389])}var bc=1.340264,wc=-.081106,xc=893e-6,Ec=.003796,Tp=Tt(3)/2,pY=12;function _D(e,t){var n=bn(Tp*te(t)),i=n*n,r=i*i*i;return[e*re(n)/(Tp*(bc+3*wc*i+r*(7*xc+9*Ec*i))),n*(bc+wc*i+r*(xc+Ec*i))]}_D.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,a=0,o,s,l;a<pY&&!(s=n*(bc+wc*i+r*(xc+Ec*i))-t,l=bc+3*wc*i+r*(7*xc+9*Ec*i),n-=o=s/l,i=n*n,r=i*i*i,ye(o)<Zb);++a);return[Tp*e*(bc+3*wc*i+r*(7*xc+9*Ec*i))/re(n),bn(te(n)/Tp)]};function gY(){return Xi(_D).scale(177.158)}function AD(e,t){var n=re(t),i=re(e)*n;return[n*te(e)/i,te(t)/i]}AD.invert=yc(pl);function mY(){return Xi(AD).scale(144.049).clipAngle(60)}function vY(){var e=1,t=0,n=0,i=1,r=1,a=0,o,s,l=null,u,c,f,d=1,h=1,p=Ep({point:function(E,x){var k=b([E,x]);this.stream.point(k[0],k[1])}}),g=fc,m,v;function y(){return d=e*i,h=e*r,m=v=null,b}function b(E){var x=E[0]*d,k=E[1]*h;if(a){var w=k*o-x*s;x=x*o+k*s,k=w}return[x+t,k+n]}return b.invert=function(E){var x=E[0]-t,k=E[1]-n;if(a){var w=k*o+x*s;x=x*o-k*s,k=w}return[x/d,k/h]},b.stream=function(E){return m&&v===E?m:m=p(g(v=E))},b.postclip=function(E){return arguments.length?(g=E,l=u=c=f=null,y()):g},b.clipExtent=function(E){return arguments.length?(g=E==null?(l=u=c=f=null,fc):K$(l=+E[0][0],u=+E[0][1],c=+E[1][0],f=+E[1][1]),y()):l==null?null:[[l,u],[c,f]]},b.scale=function(E){return arguments.length?(e=+E,y()):e},b.translate=function(E){return arguments.length?(t=+E[0],n=+E[1],y()):[t,n]},b.angle=function(E){return arguments.length?(a=E%360*he,s=te(a),o=re(a),y()):a*tt},b.reflectX=function(E){return arguments.length?(i=E?-1:1,y()):i<0},b.reflectY=function(E){return arguments.length?(r=E?-1:1,y()):r<0},b.fitExtent=function(E,x){return kp(b,E,x)},b.fitSize=function(E,x){return T1(b,E,x)},b.fitWidth=function(E,x){return C1(b,E,x)},b.fitHeight=function(E,x){return $1(b,E,x)},b}function SD(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}SD.invert=function(e,t){var n=t,i=25,r;do{var a=n*n,o=a*a;n-=r=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(ye(r)>ie&&--i>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function yY(){return Xi(SD).scale(175.295)}function OD(e,t){return[re(t)*te(e),te(t)]}OD.invert=yc(bn);function bY(){return Xi(OD).scale(249.5).clipAngle(90+ie)}function TD(e,t){var n=re(t),i=1+re(e)*n;return[n*te(e)/i,te(t)/i]}TD.invert=yc(function(e){return 2*pl(e)});function wY(){return Xi(TD).scale(250).clipAngle(142)}function CD(e,t){return[Zh(t1((Ve+t)/2)),-e]}CD.invert=function(e,t){return[-t,2*pl(b$(e))-Ve]};function xY(){var e=kD(CD),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var EY=Math.abs,R1=Math.cos,Cp=Math.sin,kY=1e-6,$D=Math.PI,N1=$D/2,DD=_Y(2);function RD(e){return e>1?N1:e<-1?-N1:Math.asin(e)}function _Y(e){return e>0?Math.sqrt(e):0}function AY(e,t){var n=e*Cp(t),i=30,r;do t-=r=(t+Cp(t)-n)/(1+R1(t));while(EY(r)>kY&&--i>0);return t/2}function SY(e,t,n){function i(r,a){return[e*r*R1(a=AY(n,a)),t*Cp(a)]}return i.invert=function(r,a){return a=RD(a/t),[r/(e*R1(a)),RD((2*a+Cp(2*a))/n)]},i}var OY=SY(DD/N1,DD,$D);function TY(){return Xi(OY).scale(169.529)}var CY=pD(),F1=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function $Y(e,t){return function n(){var i=t();return i.type=e,i.path=pD().projection(i),i.copy=i.copy||function(){var r=n();return F1.forEach(function(a){i[a]&&r[a](i[a]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function I1(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?($p[e]=$Y(e,t),this):$p[e]||null}function ND(e){return e&&e.path||CY}var $p={albers:bD,albersusa:aY,azimuthalequalarea:oY,azimuthalequidistant:sY,conicconformal:cY,conicequalarea:_p,conicequidistant:hY,equalEarth:gY,equirectangular:fY,gnomonic:mY,identity:vY,mercator:lY,mollweide:TY,naturalEarth1:yY,orthographic:bY,stereographic:wY,transversemercator:xY};for(var FD in $p)I1(FD,$p[FD]);function M1(e){$.call(this,null,e)}M1.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};var DY=P(M1,$);DY.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||Yt,a=e.as||"path",o=n.SOURCE;function s(u){u[a]=i(r(u))}!i||e.modified()?(this.value=i=ND(e.projection),n.materialize().reflow()):o=r===Yt||t.modified(r.fields)?n.ADD_MOD:n.ADD;var l=RY(i,e.pointRadius);return n.visit(o,s),i.pointRadius(l),n.modifies(a)};function RY(e,t){var n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function j1(e){$.call(this,null,e)}j1.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};var NY=P(j1,$);NY.transform=function(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],a=e.as||["x","y"],o=a[0],s=a[1],l;function u(c){var f=n([i(c),r(c)]);f?(c[o]=f[0],c[s]=f[1]):(c[o]=void 0,c[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(l=t.modified(i.fields)||t.modified(r.fields),t.visit(l?t.ADD_MOD:t.ADD,u)),t.modifies(a)};function L1(e){$.call(this,null,e)}L1.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};var FY=P(L1,$);FY.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",a=n.ADD;return(!i||e.modified())&&(this.value=i=IY(ND(e.projection),e.field||Ni("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,function(o){o[r]=i}),n.modifies(r)};function IY(e,t,n){var i=n==null?function(r){return e(t(r))}:function(r){var a=e.pointRadius(),o=e.pointRadius(n)(t(r));return e.pointRadius(a),o};return i.context=function(r){return e.context(r),i},i}function P1(e){$.call(this,[],e),this.generator=PH()}P1.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var MY=P(P1,$);MY.transform=function(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(var a in e)ge(i[a])&&i[a](e[a]);return r=i(),n.length?t.mod.push(Dk(n[0],r)):t.add.push(ke(r)),n[0]=r,t};function z1(e){$.call(this,null,e)}z1.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};var jY=P(z1,$);jY.transform=function(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||Yt,a=PY(e.opacity,e),o=LY(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:i?go(n.map(u=>go(r(u).values))):0};return n.forEach(u=>{const c=r(u),f=fe({},u,l);i||(f.$max=go(c.values||[])),u[s]=zY(c,f,o.dep?o:Vt(o(f)),a.dep?a:Vt(a(f)))}),t.reflow(!0).modifies(s)};function LY(e,t){let n;return ge(e)?(n=i=>xa(e(i,t)),n.dep=ID(e)):n=Vt(xa(e||"#888")),n}function PY(e,t){let n;return ge(e)?(n=i=>e(i,t),n.dep=ID(e)):e?n=Vt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function ID(e){if(!ge(e))return!1;const t=kt(Ht(e));return t.$x||t.$y||t.$value||t.$max}function zY(e,t,n,i){const r=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||r,u=e.y2||a,c=e.values,f=c?m=>c[m]:oo,d=Fu(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),g=p.data;for(let m=s,v=0;m<u;++m){t.$y=m-s;for(let y=o,b=m*r;y<l;++y,v+=4){t.$x=y-o,t.$value=f(y+b);const E=n(t);g[v+0]=E.r,g[v+1]=E.g,g[v+2]=E.b,g[v+3]=~~(255*i(t))}}return h.putImageData(p,0,0),d}function MD(e){$.call(this,null,e),this.modified(!0)}var BY=P(MD,$);BY.transform=function(e,t){var n=this.value;return!n||e.modified("type")?(this.value=n=qY(e.type),F1.forEach(function(i){e[i]!=null&&jD(n,i,e[i])})):F1.forEach(function(i){e.modified(i)&&jD(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&UY(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function UY(e,t){var n=WY(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function qY(e){var t=I1((e||"mercator").toLowerCase());return t||N("Unrecognized projection type: "+e),t()}function jD(e,t,n){ge(e[t])&&e[t](n)}function WY(e){return e=G(e),e.length===1?e[0]:{type:Kb,features:e.reduce((t,n)=>t.concat(GY(n)),[])}}function GY(e){return e.type===Kb?e.features:G(e).filter(t=>t!=null).map(t=>t.type===Jb?t:{type:Jb,geometry:t})}var HY=Object.freeze({__proto__:null,contour:Xb,geojson:Qb,geopath:M1,geopoint:j1,geoshape:L1,graticule:P1,heatmap:z1,isocontour:Hb,kde2d:Vb,projection:MD});function YY(e,t){var n;e==null&&(e=0),t==null&&(t=0);function i(){var r,a=n.length,o,s=0,l=0;for(r=0;r<a;++r)o=n[r],s+=o.x,l+=o.y;for(s=s/a-e,l=l/a-t,r=0;r<a;++r)o=n[r],o.x-=s,o.y-=l}return i.initialize=function(r){n=r},i.x=function(r){return arguments.length?(e=+r,i):e},i.y=function(r){return arguments.length?(t=+r,i):t},i}function VY(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return LD(this.cover(t,n),t,n,e)}function LD(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,a=e._root,o={data:i},s=e._x0,l=e._y0,u=e._x1,c=e._y1,f,d,h,p,g,m,v,y;if(!a)return e._root=o,e;for(;a.length;)if((g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d,r=a,!(a=a[v=m<<1|g]))return r[v]=o,e;if(h=+e._x.call(null,a.data),p=+e._y.call(null,a.data),t===h&&n===p)return o.next=a,r?r[v]=o:e._root=o,e;do r=r?r[v]=new Array(4):e._root=new Array(4),(g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d;while((v=m<<1|g)===(y=(p>=d)<<1|h>=f));return r[y]=a,r[v]=o,e}function XY(e){var t,n,i=e.length,r,a,o=new Array(i),s=new Array(i),l=Infinity,u=Infinity,c=-Infinity,f=-Infinity;for(n=0;n<i;++n){if(isNaN(r=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=r,s[n]=a,r<l&&(l=r),r>c&&(c=r),a<u&&(u=a),a>f&&(f=a)}if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<i;++n)LD(this,o[n],s[n],e[n]);return this}function JY(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,a=(i=Math.floor(t))+1;else{for(var o=r-n,s=this._root,l,u;n>e||e>=r||i>t||t>=a;){u=(t<i)<<1|e<n,l=new Array(4),l[u]=s,s=l,o*=2;switch(u){case 0:r=n+o,a=i+o;break;case 1:n=r-o,a=i+o;break;case 2:r=n+o,i=a-o;break;case 3:n=r-o,i=a-o;break}}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this}function KY(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function QY(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function en(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function ZY(e,t,n){var i,r=this._x0,a=this._y0,o,s,l,u,c=this._x1,f=this._y1,d=[],h=this._root,p,g;for(h&&d.push(new en(h,r,a,c,f)),n==null?n=Infinity:(r=e-n,a=t-n,c=e+n,f=t+n,n*=n);p=d.pop();){if(!(h=p.node)||(o=p.x0)>c||(s=p.y0)>f||(l=p.x1)<r||(u=p.y1)<a)continue;if(h.length){var m=(o+l)/2,v=(s+u)/2;d.push(new en(h[3],m,v,l,u),new en(h[2],o,v,m,u),new en(h[1],m,s,l,v),new en(h[0],o,s,m,v)),(g=(t>=v)<<1|e>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var y=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),E=y*y+b*b;if(E<n){var x=Math.sqrt(n=E);r=e-x,a=t-x,c=e+x,f=t+x,i=h.data}}}return i}function eV(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,a,o=this._x0,s=this._y0,l=this._x1,u=this._y1,c,f,d,h,p,g,m,v;if(!n)return this;if(n.length)for(;;){if((p=c>=(d=(o+l)/2))?o=d:l=d,(g=f>=(h=(s+u)/2))?s=h:u=h,!(t=n,n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,v=m)}for(;n.data!==e;)if(!(r=n,n=n.next))return this;return(a=n.next)&&delete n.next,r?(a?r.next=a:delete r.next,this):t?(a?t[m]=a:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[v]=n:this._root=n),this):(this._root=a,this)}function tV(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function nV(){return this._root}function iV(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function rV(e){var t=[],n,i=this._root,r,a,o,s,l;for(i&&t.push(new en(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,a=n.x0,o=n.y0,s=n.x1,l=n.y1)&&i.length){var u=(a+s)/2,c=(o+l)/2;(r=i[3])&&t.push(new en(r,u,c,s,l)),(r=i[2])&&t.push(new en(r,a,c,u,l)),(r=i[1])&&t.push(new en(r,u,o,s,c)),(r=i[0])&&t.push(new en(r,a,o,u,c))}return this}function aV(e){var t=[],n=[],i;for(this._root&&t.push(new en(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var a,o=i.x0,s=i.y0,l=i.x1,u=i.y1,c=(o+l)/2,f=(s+u)/2;(a=r[0])&&t.push(new en(a,o,s,c,f)),(a=r[1])&&t.push(new en(a,c,s,l,f)),(a=r[2])&&t.push(new en(a,o,f,c,u)),(a=r[3])&&t.push(new en(a,c,f,l,u))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function oV(e){return e[0]}function sV(e){return arguments.length?(this._x=e,this):this._x}function lV(e){return e[1]}function uV(e){return arguments.length?(this._y=e,this):this._y}function B1(e,t,n){var i=new U1(t??oV,n??lV,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function U1(e,t,n,i,r,a){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function PD(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var tn=B1.prototype=U1.prototype;tn.copy=function(){var e=new U1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=PD(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=PD(i));return e},tn.add=VY,tn.addAll=XY,tn.cover=JY,tn.data=KY,tn.extent=QY,tn.find=ZY,tn.remove=eV,tn.removeAll=tV,tn.root=nV,tn.size=iV,tn.visit=rV,tn.visitAfter=aV,tn.x=sV,tn.y=uV;function nn(e){return function(){return e}}function Aa(){return(Math.random()-.5)*1e-6}function cV(e){return e.x+e.vx}function fV(e){return e.y+e.vy}function dV(e){var t,n,i=1,r=1;typeof e!="function"&&(e=nn(e==null?1:+e));function a(){for(var l,u=t.length,c,f,d,h,p,g,m=0;m<r;++m)for(c=B1(t,cV,fV).visitAfter(o),l=0;l<u;++l)f=t[l],p=n[f.index],g=p*p,d=f.x+f.vx,h=f.y+f.vy,c.visit(v);function v(y,b,E,x,k){var w=y.data,A=y.r,_=p+A;if(w){if(w.index>f.index){var O=d-w.x-w.vx,S=h-w.y-w.vy,T=O*O+S*S;T<_*_&&(O===0&&(O=Aa(),T+=O*O),S===0&&(S=Aa(),T+=S*S),T=(_-(T=Math.sqrt(T)))/T*i,f.vx+=(O*=T)*(_=(A*=A)/(g+A)),f.vy+=(S*=T)*_,w.vx-=O*(_=1-_),w.vy-=S*_)}return}return b>d+_||x<d-_||E>h+_||k<h-_}}function o(l){if(l.data)return l.r=n[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function s(){if(!t)return;var l,u=t.length,c;for(n=new Array(u),l=0;l<u;++l)c=t[l],n[c.index]=+e(c,l,t)}return a.initialize=function(l){t=l,s()},a.iterations=function(l){return arguments.length?(r=+l,a):r},a.strength=function(l){return arguments.length?(i=+l,a):i},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:nn(+l),s(),a):e},a}function hV(e){return e.index}function zD(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function pV(e){var t=hV,n=c,i,r=nn(30),a,o,s,l,u=1;e==null&&(e=[]);function c(g){return 1/Math.min(s[g.source.index],s[g.target.index])}function f(g){for(var m=0,v=e.length;m<u;++m)for(var y=0,b,E,x,k,w,A,_;y<v;++y)b=e[y],E=b.source,x=b.target,k=x.x+x.vx-E.x-E.vx||Aa(),w=x.y+x.vy-E.y-E.vy||Aa(),A=Math.sqrt(k*k+w*w),A=(A-a[y])/A*g*i[y],k*=A,w*=A,x.vx-=k*(_=l[y]),x.vy-=w*_,E.vx+=k*(_=1-_),E.vy+=w*_}function d(){if(!o)return;var g,m=o.length,v=e.length,y=new Map(o.map((E,x)=>[t(E,x,o),E])),b;for(g=0,s=new Array(m);g<v;++g)b=e[g],b.index=g,typeof b.source!="object"&&(b.source=zD(y,b.source)),typeof b.target!="object"&&(b.target=zD(y,b.target)),s[b.source.index]=(s[b.source.index]||0)+1,s[b.target.index]=(s[b.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)b=e[g],l[g]=s[b.source.index]/(s[b.source.index]+s[b.target.index]);i=new Array(v),h(),a=new Array(v),p()}function h(){if(!o)return;for(var g=0,m=e.length;g<m;++g)i[g]=+n(e[g],g,e)}function p(){if(!o)return;for(var g=0,m=e.length;g<m;++g)a[g]=+r(e[g],g,e)}return f.initialize=function(g){o=g,d()},f.links=function(g){return arguments.length?(e=g,d(),f):e},f.id=function(g){return arguments.length?(t=g,f):t},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:nn(+g),h(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:nn(+g),p(),f):r},f}var gV={value:function(){}};function BD(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Dp(n)}function Dp(e){this._=e}function mV(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Dp.prototype=BD.prototype={constructor:Dp,on:function(e,t){var n=this._,i=mV(e+"",n),r,a=-1,o=i.length;if(arguments.length<2){for(;++a<o;)if((r=(e=i[a]).type)&&(r=vV(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(r=(e=i[a]).type)n[r]=UD(n[r],e.name,t);else if(t==null)for(r in n)n[r]=UD(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Dp(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,a;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],i=0,r=a.length;i<r;++i)a[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};function vV(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function UD(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=gV,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var wl=0,kc=0,_c=0,qD=1e3,Rp,Ac,Np=0,Po=0,Fp=0,Sc=typeof performance=="object"&&performance.now?performance:Date,WD=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function q1(){return Po||(WD(yV),Po=Sc.now()+Fp)}function yV(){Po=0}function Ip(){this._call=this._time=this._next=null}Ip.prototype=GD.prototype={constructor:Ip,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?q1():+n)+(t==null?0:+t),!this._next&&Ac!==this&&(Ac?Ac._next=this:Rp=this,Ac=this),this._call=e,this._time=n,W1()},stop:function(){this._call&&(this._call=null,this._time=Infinity,W1())}};function GD(e,t,n){var i=new Ip();return i.restart(e,t,n),i}function bV(){q1(),++wl;for(var e=Rp,t;e;)(t=Po-e._time)>=0&&e._call.call(null,t),e=e._next;--wl}function HD(){Po=(Np=Sc.now())+Fp,wl=kc=0;try{bV()}finally{wl=0,xV(),Po=0}}function wV(){var e=Sc.now(),t=e-Np;t>qD&&(Fp-=t,Np=e)}function xV(){for(var e,t=Rp,n,i=Infinity;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Rp=n);Ac=e,W1(i)}function W1(e){if(wl)return;kc&&(kc=clearTimeout(kc));var t=e-Po;t>24?(e<Infinity&&(kc=setTimeout(HD,e-Sc.now()-Fp)),_c&&(_c=clearInterval(_c))):(_c||(Np=Sc.now(),_c=setInterval(wV,qD)),wl=1,WD(HD))}function EV(e,t,n){var i=new Ip(),r=t;return t==null?(i.restart(e,t,n),i):(t=+t,n=n==null?q1():+n,i.restart(function a(o){o+=r,i.restart(a,r+=t,n),e(o)},t,n),i)}function kV(e){return e.x}function _V(e){return e.y}var AV=10,SV=Math.PI*(3-Math.sqrt(5));function OV(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,o=.6,s=new Map(),l=GD(c),u=BD("tick","end");e==null&&(e=[]);function c(){f(),u.call("tick",t),n<i&&(l.stop(),u.call("end",t))}function f(p){var g,m=e.length,v;p===void 0&&(p=1);for(var y=0;y<p;++y)for(n+=(a-n)*r,s.forEach(function(b){b(n)}),g=0;g<m;++g)v=e[g],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return t}function d(){for(var p=0,g=e.length,m;p<g;++p){if(m=e[p],m.index=p,m.fx!=null&&(m.x=m.fx),m.fy!=null&&(m.y=m.fy),isNaN(m.x)||isNaN(m.y)){var v=AV*Math.sqrt(p),y=p*SV;m.x=v*Math.cos(y),m.y=v*Math.sin(y)}(isNaN(m.vx)||isNaN(m.vy))&&(m.vx=m.vy=0)}}function h(p){return p.initialize&&p.initialize(e),p}return d(),t={tick:f,restart:function(){return l.restart(c),t},stop:function(){return l.stop(),t},nodes:function(p){return arguments.length?(e=p,d(),s.forEach(h),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(a=+p,t):a},velocityDecay:function(p){return arguments.length?(o=1-p,t):1-o},force:function(p,g){return arguments.length>1?(g==null?s.delete(p):s.set(p,h(g)),t):s.get(p)},find:function(p,g,m){var v=0,y=e.length,b,E,x,k,w;for(m==null?m=Infinity:m*=m,v=0;v<y;++v)k=e[v],b=p-k.x,E=g-k.y,x=b*b+E*E,x<m&&(w=k,m=x);return w},on:function(p,g){return arguments.length>1?(u.on(p,g),t):u.on(p)}}}function TV(){var e,t,n,i=nn(-30),r,a=1,o=Infinity,s=.81;function l(d){var h,p=e.length,g=B1(e,kV,_V).visitAfter(c);for(n=d,h=0;h<p;++h)t=e[h],g.visit(f)}function u(){if(!e)return;var d,h=e.length,p;for(r=new Array(h),d=0;d<h;++d)p=e[d],r[p.index]=+i(p,d,e)}function c(d){var h=0,p,g,m=0,v,y,b;if(d.length){for(v=y=b=0;b<4;++b)(p=d[b])&&(g=Math.abs(p.value))&&(h+=p.value,m+=g,v+=g*p.x,y+=g*p.y);d.x=v/m,d.y=y/m}else{p=d,p.x=p.data.x,p.y=p.data.y;do h+=r[p.data.index];while(p=p.next)}d.value=h}function f(d,h,p,g){if(!d.value)return!0;var m=d.x-t.x,v=d.y-t.y,y=g-h,b=m*m+v*v;if(y*y/s<b)return b<o&&(m===0&&(m=Aa(),b+=m*m),v===0&&(v=Aa(),b+=v*v),b<a&&(b=Math.sqrt(a*b)),t.vx+=m*d.value*n/b,t.vy+=v*d.value*n/b),!0;if(d.length||b>=o)return;(d.data!==t||d.next)&&(m===0&&(m=Aa(),b+=m*m),v===0&&(v=Aa(),b+=v*v),b<a&&(b=Math.sqrt(a*b)));do d.data!==t&&(y=r[d.data.index]*n/b,t.vx+=m*y,t.vy+=v*y);while(d=d.next)}return l.initialize=function(d){e=d,u()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:nn(+d),u(),l):i},l.distanceMin=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.distanceMax=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.theta=function(d){return arguments.length?(s=d*d,l):Math.sqrt(s)},l}function CV(e){var t=nn(.1),n,i,r;typeof e!="function"&&(e=nn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vx+=(r[l]-c.x)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:nn(+s),o(),a):t},a.x=function(s){return arguments.length?(e=typeof s=="function"?s:nn(+s),o(),a):e},a}function $V(e){var t=nn(.1),n,i,r;typeof e!="function"&&(e=nn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vy+=(r[l]-c.y)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:nn(+s),o(),a):t},a.y=function(s){return arguments.length?(e=typeof s=="function"?s:nn(+s),o(),a):e},a}var YD={center:YY,collide:dV,nbody:TV,link:pV,x:CV,y:$V},Oc="forces",G1=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],DV=["static","iterations"],VD=["x","y","vx","vy"];function H1(e){$.call(this,null,e)}H1.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:VD}]};var XD=P(H1,$);XD.transform=function(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(G1),a=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&JD(n,e,0,t)):(this.value=n=NV(t.source,e),n.on("tick",RV(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(DV)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},XD.finish=function(e,t){for(var n=t.dataflow,i=this._argops,r=0,a=i.length,o;r<a;++r){if(o=i[r],o.name!==Oc||o.op._argval.force!=="link")continue;for(var s=o.op._argops,l=0,u=s.length,c;l<u;++l)if(s[l].name==="links"&&(c=s[l].op.source)){n.pulse(c,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(VD)};function RV(e,t){return function(){e.touch(t).run()}}function NV(e,t){var n=OV(e),i=!1,r=n.stop,a=n.restart;return n.stopped=function(){return i},n.restart=function(){return i=!1,a()},n.stop=function(){return i=!0,r()},JD(n,t,!0).on("end",function(){i=!0})}function JD(e,t,n,i){var r=G(t.forces),a,o,s,l;for(a=0,o=G1.length;a<o;++a)s=G1[a],s!==Oc&&t.modified(s)&&e[s](t[s]);for(a=0,o=r.length;a<o;++a)l=Oc+a,s=n||t.modified(Oc,a)?IV(r[a]):i&&FV(r[a],i)?e.force(l):null,s&&e.force(l,s);for(o=e.numForces||0;a<o;++a)e.force(Oc+a,null);return e.numForces=r.length,e}function FV(e,t){var n,i;for(n in e)if(ge(i=e[n])&&t.modified(Ht(i)))return 1;return 0}function IV(e){var t,n;Q(YD,e.force)||N("Unrecognized force: "+e.force),t=YD[e.force]();for(n in e)ge(t[n])&&MV(t[n],e[n],e);return t}function MV(e,t,n){e(ge(t)?function(i){return t(i,n)}:t)}var jV=Object.freeze({__proto__:null,force:H1});function Y1(e,t,n){var i={};return e.each(function(r){var a=r.data;n(a)&&(i[t(a)]=r)}),e.lookup=i,e}function LV(e,t){return e.parent===t.parent?1:2}function PV(e){return e.reduce(zV,0)/e.length}function zV(e,t){return e+t.x}function BV(e){return 1+e.reduce(UV,0)}function UV(e,t){return Math.max(e,t.y)}function qV(e){for(var t;t=e.children;)e=t[0];return e}function WV(e){for(var t;t=e.children;)e=t[t.length-1];return e}function GV(){var e=LV,t=1,n=1,i=!1;function r(a){var o,s=0;a.eachAfter(function(d){var h=d.children;h?(d.x=PV(h),d.y=BV(h)):(d.x=o?s+=e(d,o):0,d.y=0,o=d)});var l=qV(a),u=WV(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(i?function(d){d.x=(d.x-a.x)*t,d.y=(a.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(a.y?d.y/a.y:1))*n})}return r.separation=function(a){return arguments.length?(e=a,r):e},r.size=function(a){return arguments.length?(i=!1,t=+a[0],n=+a[1],r):i?null:[t,n]},r.nodeSize=function(a){return arguments.length?(i=!0,t=+a[0],n=+a[1],r):i?[t,n]:null},r}function HV(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function YV(){return this.eachAfter(HV)}function VV(e){var t=this,n,i=[t],r,a,o;do for(n=i.reverse(),i=[];t=n.pop();)if(e(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)i.push(r[a]);while(i.length);return this}function XV(e){for(var t=this,n=[t],i,r;t=n.pop();)if(e(t),i=t.children,i)for(r=i.length-1;r>=0;--r)n.push(i[r]);return this}function JV(e){for(var t=this,n=[t],i=[],r,a,o;t=n.pop();)if(i.push(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)n.push(r[a]);for(;t=i.pop();)e(t);return this}function KV(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function QV(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function ZV(e){for(var t=this,n=eX(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function eX(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function tX(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function nX(){var e=[];return this.each(function(t){e.push(t)}),e}function iX(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function rX(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function V1(e,t){var n=new xl(e),i=+e.value&&(n.value=e.value),r,a=[n],o,s,l,u;for(t==null&&(t=oX);r=a.pop();)if(i&&(r.value=+r.data.value),(s=t(r.data))&&(u=s.length))for(r.children=new Array(u),l=u-1;l>=0;--l)a.push(o=r.children[l]=new xl(s[l])),o.parent=r,o.depth=r.depth+1;return n.eachBefore(KD)}function aX(){return V1(this).eachBefore(sX)}function oX(e){return e.children}function sX(e){e.data=e.data.data}function KD(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function xl(e){this.data=e,this.depth=this.height=0,this.parent=null}xl.prototype=V1.prototype={constructor:xl,count:YV,each:VV,eachAfter:JV,eachBefore:XV,sum:KV,sort:QV,path:ZV,ancestors:tX,descendants:nX,leaves:iX,links:rX,copy:aX};var lX=Array.prototype.slice;function uX(e){for(var t=e.length,n,i;t;)i=Math.random()*t--|0,n=e[t],e[t]=e[i],e[i]=n;return e}function cX(e){for(var t=0,n=(e=uX(lX.call(e))).length,i=[],r,a;t<n;)r=e[t],a&&QD(a,r)?++t:(a=dX(i=fX(i,r)),t=0);return a}function fX(e,t){var n,i;if(X1(t,e))return[t];for(n=0;n<e.length;++n)if(Mp(t,e[n])&&X1(Tc(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(Mp(Tc(e[n],e[i]),t)&&Mp(Tc(e[n],t),e[i])&&Mp(Tc(e[i],t),e[n])&&X1(ZD(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error()}function Mp(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function QD(e,t){var n=e.r-t.r+1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function X1(e,t){for(var n=0;n<t.length;++n)if(!QD(e,t[n]))return!1;return!0}function dX(e){switch(e.length){case 1:return hX(e[0]);case 2:return Tc(e[0],e[1]);case 3:return ZD(e[0],e[1],e[2])}}function hX(e){return{x:e.x,y:e.y,r:e.r}}function Tc(e,t){var n=e.x,i=e.y,r=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-i,c=s-r,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(i+o+u/f*c)/2,r:(f+r+s)/2}}function ZD(e,t,n){var i=e.x,r=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=i-o,h=i-u,p=r-s,g=r-c,m=l-a,v=f-a,y=i*i+r*r-a*a,b=y-o*o-s*s+l*l,E=y-u*u-c*c+f*f,x=h*p-d*g,k=(p*E-g*b)/(x*2)-i,w=(g*m-p*v)/x,A=(h*b-d*E)/(x*2)-r,_=(d*v-h*m)/x,O=w*w+_*_-1,S=2*(a+k*w+A*_),T=k*k+A*A-a*a,D=-(O?(S+Math.sqrt(S*S-4*O*T))/(2*O):T/S);return{x:i+k+w*D,y:r+A+_*D,r:D}}function eR(e,t,n){var i=e.x-t.x,r,a,o=e.y-t.y,s,l,u=i*i+o*o;u?(a=t.r+n.r,a*=a,l=e.r+n.r,l*=l,a>l?(r=(u+l-a)/(2*u),s=Math.sqrt(Math.max(0,l/u-r*r)),n.x=e.x-r*i-s*o,n.y=e.y-r*o+s*i):(r=(u+a-l)/(2*u),s=Math.sqrt(Math.max(0,a/u-r*r)),n.x=t.x+r*i-s*o,n.y=t.y+r*o+s*i)):(n.x=t.x+n.r,n.y=t.y)}function tR(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function nR(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,a=(t.y*n.r+n.y*t.r)/i;return r*r+a*a}function jp(e){this._=e,this.next=null,this.previous=null}function pX(e){if(!(r=e.length))return 0;var t,n,i,r,a,o,s,l,u,c,f;if(t=e[0],t.x=0,t.y=0,!(r>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;eR(n,t,i=e[2]),t=new jp(t),n=new jp(n),i=new jp(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(s=3;s<r;++s){eR(t._,n._,i=e[s]),i=new jp(i),l=n.next,u=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(tR(l._,i._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(tR(u._,i._)){t=u,t.next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}while(l!==u.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,a=nR(t);(i=i.next)!==n;)(o=nR(i))<a&&(t=i,a=o);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=cX(t),s=0;s<r;++s)t=e[s],t.x-=i.x,t.y-=i.y;return i.r}function gX(e){return e==null?null:Lp(e)}function Lp(e){if(typeof e!="function")throw new Error();return e}function zo(){return 0}function El(e){return function(){return e}}function mX(e){return Math.sqrt(e.value)}function vX(){var e=null,t=1,n=1,i=zo;function r(a){return a.x=t/2,a.y=n/2,e?a.eachBefore(iR(e)).eachAfter(J1(i,.5)).eachBefore(rR(1)):a.eachBefore(iR(mX)).eachAfter(J1(zo,1)).eachAfter(J1(i,a.r/Math.min(t,n))).eachBefore(rR(Math.min(t,n)/(2*a.r))),a}return r.radius=function(a){return arguments.length?(e=gX(a),r):e},r.size=function(a){return arguments.length?(t=+a[0],n=+a[1],r):[t,n]},r.padding=function(a){return arguments.length?(i=typeof a=="function"?a:El(+a),r):i},r}function iR(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function J1(e,t){return function(n){if(i=n.children){var i,r,a=i.length,o=e(n)*t||0,s;if(o)for(r=0;r<a;++r)i[r].r+=o;if(s=pX(i),o)for(r=0;r<a;++r)i[r].r-=o;n.r=s+o}}}function rR(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function aR(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Cc(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(i-t)/e.value;++s<l;)o=a[s],o.y0=n,o.y1=r,o.x0=t,o.x1=t+=o.value*u}function yX(){var e=1,t=1,n=0,i=!1;function r(o){var s=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/s,o.eachBefore(a(t,s)),i&&o.eachBefore(aR),o}function a(o,s){return function(l){l.children&&Cc(l,l.x0,o*(l.depth+1)/s,l.x1,o*(l.depth+2)/s);var u=l.x0,c=l.y0,f=l.x1-n,d=l.y1-n;f<u&&(u=f=(u+f)/2),d<c&&(c=d=(c+d)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=d}}return r.round=function(o){return arguments.length?(i=!!o,r):i},r.size=function(o){return arguments.length?(e=+o[0],t=+o[1],r):[e,t]},r.padding=function(o){return arguments.length?(n=+o,r):n},r}var oR="$",bX={depth:-1},sR={};function wX(e){return e.id}function xX(e){return e.parentId}function lR(){var e=wX,t=xX;function n(i){var r,a,o=i.length,s,l,u,c=new Array(o),f,d,h={};for(a=0;a<o;++a)r=i[a],u=c[a]=new xl(r),(f=e(r,a,i))!=null&&(f+="")&&(d=oR+(u.id=f),h[d]=d in h?sR:u);for(a=0;a<o;++a)if(u=c[a],f=t(i[a],a,i),f==null||!(f+="")){if(s)throw new Error("multiple roots");s=u}else{if(l=h[oR+f],!l)throw new Error("missing: "+f);if(l===sR)throw new Error("ambiguous: "+f);l.children?l.children.push(u):l.children=[u],u.parent=l}if(!s)throw new Error("no root");if(s.parent=bX,s.eachBefore(function(p){p.depth=p.parent.depth+1,--o}).eachBefore(KD),s.parent=null,o>0)throw new Error("cycle");return s}return n.id=function(i){return arguments.length?(e=Lp(i),n):e},n.parentId=function(i){return arguments.length?(t=Lp(i),n):t},n}function EX(e,t){return e.parent===t.parent?1:2}function K1(e){var t=e.children;return t?t[0]:e.t}function Q1(e){var t=e.children;return t?t[t.length-1]:e.t}function kX(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function _X(e){for(var t=0,n=0,i=e.children,r=i.length,a;--r>=0;)a=i[r],a.z+=t,a.m+=t,t+=a.s+(n+=a.c)}function AX(e,t,n){return e.a.parent===t.parent?e.a:n}function Pp(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Pp.prototype=Object.create(xl.prototype);function SX(e){for(var t=new Pp(e,0),n,i=[t],r,a,o,s;n=i.pop();)if(a=n._.children)for(n.children=new Array(s=a.length),o=s-1;o>=0;--o)i.push(r=n.children[o]=new Pp(a[o],o)),r.parent=n;return(t.parent=new Pp(null,0)).children=[t],t}function OX(){var e=EX,t=1,n=1,i=null;function r(u){var c=SX(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(o),i)u.eachBefore(l);else{var f=u,d=u,h=u;u.eachBefore(function(y){y.x<f.x&&(f=y),y.x>d.x&&(d=y),y.depth>h.depth&&(h=y)});var p=f===d?1:e(f,d)/2,g=p-f.x,m=t/(d.x+p+g),v=n/(h.depth||1);u.eachBefore(function(y){y.x=(y.x+g)*m,y.y=y.depth*v})}return u}function a(u){var c=u.children,f=u.parent.children,d=u.i?f[u.i-1]:null;if(c){_X(u);var h=(c[0].z+c[c.length-1].z)/2;d?(u.z=d.z+e(u._,d._),u.m=u.z-h):u.z=h}else d&&(u.z=d.z+e(u._,d._));u.parent.A=s(u,d,u.parent.A||f[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function s(u,c,f){if(c){for(var d=u,h=u,p=c,g=d.parent.children[0],m=d.m,v=h.m,y=p.m,b=g.m,E;p=Q1(p),d=K1(d),p&&d;)g=K1(g),h=Q1(h),h.a=u,E=p.z+y-d.z-m+e(p._,d._),E>0&&(kX(AX(p,u,f),u,E),m+=E,v+=E),y+=p.m,m+=d.m,b+=g.m,v+=h.m;p&&!Q1(h)&&(h.t=p,h.m+=y-v),d&&!K1(g)&&(g.t=d,g.m+=m-b,f=u)}return f}function l(u){u.x*=t,u.y=u.depth*n}return r.separation=function(u){return arguments.length?(e=u,r):e},r.size=function(u){return arguments.length?(i=!1,t=+u[0],n=+u[1],r):i?null:[t,n]},r.nodeSize=function(u){return arguments.length?(i=!0,t=+u[0],n=+u[1],r):i?[t,n]:null},r}function zp(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(r-n)/e.value;++s<l;)o=a[s],o.x0=t,o.x1=i,o.y0=n,o.y1=n+=o.value*u}var uR=(1+Math.sqrt(5))/2;function cR(e,t,n,i,r,a){for(var o=[],s=t.children,l,u,c=0,f=0,d=s.length,h,p,g=t.value,m,v,y,b,E,x,k;c<d;){h=r-n,p=a-i;do m=s[f++].value;while(!m&&f<d);for(v=y=m,x=Math.max(p/h,h/p)/(g*e),k=m*m*x,E=Math.max(y/k,k/v);f<d;++f){if(m+=u=s[f].value,u<v&&(v=u),u>y&&(y=u),k=m*m*x,b=Math.max(y/k,k/v),b>E){m-=u;break}E=b}o.push(l={value:m,dice:h<p,children:s.slice(c,f)}),l.dice?Cc(l,n,i,r,g?i+=p*m/g:a):zp(l,n,i,g?n+=h*m/g:r,a),g-=m,c=f}return o}var fR=function e(t){function n(i,r,a,o,s){cR(t,i,r,a,o,s)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(uR);function TX(){var e=fR,t=!1,n=1,i=1,r=[0],a=zo,o=zo,s=zo,l=zo,u=zo;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(aR),d}function f(d){var h=r[d.depth],p=d.x0+h,g=d.y0+h,m=d.x1-h,v=d.y1-h;m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),d.x0=p,d.y0=g,d.x1=m,d.y1=v,d.children&&(h=r[d.depth+1]=a(d)/2,p+=u(d)-h,g+=o(d)-h,m-=s(d)-h,v-=l(d)-h,m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),e(d,p,g,m,v))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=Lp(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(a=typeof d=="function"?d:El(+d),c):a},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:El(+d),c):o},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:El(+d),c):s},c.paddingBottom=function(d){return arguments.length?(l=typeof d=="function"?d:El(+d),c):l},c.paddingLeft=function(d){return arguments.length?(u=typeof d=="function"?d:El(+d),c):u},c}function CX(e,t,n,i,r){var a=e.children,o,s=a.length,l,u=new Array(s+1);for(u[0]=l=o=0;o<s;++o)u[o+1]=l+=a[o].value;c(0,s,e.value,t,n,i,r);function c(f,d,h,p,g,m,v){if(f>=d-1){var y=a[f];y.x0=p,y.y0=g,y.x1=m,y.y1=v;return}for(var b=u[f],E=h/2+b,x=f+1,k=d-1;x<k;){var w=x+k>>>1;u[w]<E?x=w+1:k=w}E-u[x-1]<u[x]-E&&f+1<x&&--x;var A=u[x]-b,_=h-A;if(m-p>v-g){var O=(p*_+m*A)/h;c(f,x,A,p,g,O,v),c(x,d,_,O,g,m,v)}else{var S=(g*_+v*A)/h;c(f,x,A,p,g,m,S),c(x,d,_,p,S,m,v)}}}function $X(e,t,n,i,r){(e.depth&1?zp:Cc)(e,t,n,i,r)}var DX=function e(t){function n(i,r,a,o,s){if((l=i._squarify)&&l.ratio===t)for(var l,u,c,f,d=-1,h,p=l.length,g=i.value;++d<p;){for(u=l[d],c=u.children,f=u.value=0,h=c.length;f<h;++f)u.value+=c[f].value;u.dice?Cc(u,r,a,o,a+=(s-a)*u.value/g):zp(u,r,a,r+=(o-r)*u.value/g,s),g-=u.value}else i._squarify=l=cR(t,i,r,a,o,s),l.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(uR);function Z1(e){$.call(this,null,e)}Z1.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var RX=P(Z1,$);function NX(e){return e.values}RX.transform=function(e,t){t.source||N("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),a=this.value;return(!a||i||t.changed())&&(a&&a.each(o=>{o.children&&dd(o.data)&&r.rem.push(o.data)}),this.value=a=V1({values:G(e.keys).reduce((o,s)=>(o.key(s),o),FX()).entries(r.source)},NX),n&&a.each(o=>{o.children&&(o=ke(o.data),r.add.push(o),r.source.push(o))}),Y1(a,ee,ee)),r.source.root=a,r};function FX(){var e=[],t;function n(r,a){if(a>=e.length)return r;for(var o=-1,s=r.length,l=e[a++],u,c,f={},d,h={};++o<s;)u=l(c=r[o])+"",(d=f[u])?d.push(c):f[u]=[c];for(u in f)h[u]=n(f[u],a);return h}function i(r,a){if(++a>e.length)return r;var o=[],s;for(s in r)o.push({key:s,values:i(r[s],a)});return o}return t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)}}function Nr(e){$.call(this,null,e)}var IX=P(Nr,$);IX.transform=function(e,t){(!t.source||!t.source.root)&&N(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),i=this.fields,r=t.source.root,a=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(fo(e.sort,o=>o.data)),MX(n,this.params,e),n.separation&&n.separation(e.separation!==!1?LX:iu);try{this.value=n(r)}catch(o){N(o)}return r.each(function(o){jX(o,i,a)}),t.reflow(e.modified()).modifies(a).modifies("leaf")};function MX(e,t,n){for(var i,r=0,a=t.length;r<a;++r)i=t[r],i in n&&e[i](n[i])}function jX(e,t,n){for(var i=e.data,r=0,a=t.length-1;r<a;++r)i[n[r]]=e[t[r]];i[n[a]]=e.children?e.children.length:0}function LX(e,t){return e.parent===t.parent?1:2}var ew=["x","y","r","depth","children"];function tw(e){Nr.call(this,e)}tw.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:ew.length,default:ew}]};var nw=P(tw,Nr);nw.layout=vX,nw.params=["radius","size","padding"],nw.fields=ew;var iw=["x0","y0","x1","y1","depth","children"];function rw(e){Nr.call(this,e)}rw.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:iw.length,default:iw}]};var aw=P(rw,Nr);aw.layout=yX,aw.params=["size","round","padding"],aw.fields=iw;function ow(e){$.call(this,null,e)}ow.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};var PX=P(ow,$);PX.transform=function(e,t){t.source||N("Stratify transform requires an upstream data source.");var n=this.value,i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),a=!this.value||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),a&&(r.source.length?n=Y1(lR().id(e.key).parentId(e.parentKey)(r.source),e.key,Fi):n=Y1(lR()([{}]),e.key,e.key)),r.source.root=this.value=n,r};var dR={tidy:OX,cluster:GV},sw=["x","y","depth","children"];function lw(e){Nr.call(this,e)}lw.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:sw.length,default:sw}]};var uw=P(lw,Nr);uw.layout=function(e){var t=e||"tidy";if(Q(dR,t))return dR[t]();N("Unrecognized Tree layout method: "+t)},uw.params=["size","nodeSize"],uw.fields=sw;function cw(e){$.call(this,[],e)}cw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};var zX=P(cw,$);zX.transform=function(e,t){var n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),a={};return i||N("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,function(o){a[ee(o)]=1}),i.each(function(o){var s=o.data,l=o.parent&&o.parent.data;l&&a[ee(s)]&&a[ee(l)]&&r.add.push(ke({source:l,target:s}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,function(o){a[ee(o)]=1}),n.forEach(function(o){(a[ee(o.source)]||a[ee(o.target)])&&r.mod.push(o)})),r};var hR={binary:CX,dice:Cc,slice:zp,slicedice:$X,squarify:fR,resquarify:DX},fw=["x0","y0","x1","y1","depth","children"];function dw(e){Nr.call(this,e)}dw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:fw.length,default:fw}]};var hw=P(dw,Nr);hw.layout=function(){var e=TX();return e.ratio=function(t){var n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=function(t){Q(hR,t)?e.tile(hR[t]):N("Unrecognized Treemap layout method: "+t)},e},hw.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],hw.fields=fw;var BX=Object.freeze({__proto__:null,nest:Z1,pack:tw,partition:rw,stratify:ow,tree:lw,treelinks:cw,treemap:dw});function pR(e,t){var n=[],i=function(c){return c(s)},r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function pw(e){$.call(this,null,e)}pw.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};var UX=P(pw,$);UX.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=pR(i,e.groupby),a=(e.groupby||[]).map(et),o=a.length,s=e.as||[et(e.x),et(e.y)],l=[];r.forEach(u=>{TA(u,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<o;++d)f[a[d]]=u.dims[d];f[s[0]]=c[0],f[s[1]]=c[1],l.push(ke(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};const gw={linear:hv,log:EA,exp:kA,pow:_A,quad:pv,poly:AA};function qX(e,t){return e==="poly"?t:e==="quad"?2:1}function mw(e){$.call(this,null,e)}mw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(gw)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};var WX=P(mw,$);WX.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=pR(i,e.groupby),a=(e.groupby||[]).map(et),o=e.method||"linear",s=e.order||3,l=qX(o,s),u=e.as||[et(e.x),et(e.y)],c=gw[o],f=[];let d=e.extent;Q(gw,o)||N("Invalid regression method: "+o),d!=null&&(o==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null)),r.forEach(h=>{const p=h.length;if(p<=l){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(h,e.x,e.y,s);if(e.params){f.push(ke({keys:h.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=d||yr(h,e.x),v=y=>{const b={};for(let E=0;E<a.length;++E)b[a[E]]=h.dims[E];b[u[0]]=y[0],b[u[1]]=y[1],f.push(ke(b))};o==="linear"?m.forEach(y=>v([y,g.predict(y)])):Ld(g.predict,m,25,200).forEach(v)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n};var GX=Object.freeze({__proto__:null,loess:pw,regression:mw});const gR=Math.pow(2,-52),Bp=new Uint32Array(512);class vw{static from(e,t=JX,n=KX){const i=e.length,r=new Float64Array(i*2);for(let a=0;a<i;a++){const o=e[a];r[2*a]=t(o),r[2*a+1]=n(o)}return new vw(r)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,a=e.length>>1;let o=Infinity,s=Infinity,l=-Infinity,u=-Infinity;for(let _=0;_<a;_++){const O=e[2*_],S=e[2*_+1];O<o&&(o=O),S<s&&(s=S),O>l&&(l=O),S>u&&(u=S),this._ids[_]=_}const c=(o+l)/2,f=(s+u)/2;let d=Infinity,h,p,g;for(let _=0;_<a;_++){const O=yw(c,f,e[2*_],e[2*_+1]);O<d&&(h=_,d=O)}const m=e[2*h],v=e[2*h+1];d=Infinity;for(let _=0;_<a;_++){if(_===h)continue;const O=yw(m,v,e[2*_],e[2*_+1]);O<d&&O>0&&(p=_,d=O)}let y=e[2*p],b=e[2*p+1],E=Infinity;for(let _=0;_<a;_++){if(_===h||_===p)continue;const O=VX(m,v,y,b,e[2*_],e[2*_+1]);O<E&&(g=_,E=O)}let x=e[2*g],k=e[2*g+1];if(E===Infinity){for(let S=0;S<a;S++)this._dists[S]=e[2*S]-e[0]||e[2*S+1]-e[1];kl(this._ids,this._dists,0,a-1);const _=new Uint32Array(a);let O=0;for(let S=0,T=-Infinity;S<a;S++){const D=this._ids[S];this._dists[D]>T&&(_[O++]=D,T=this._dists[D])}this.hull=_.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Up(m,v,y,b,x,k)){const _=p,O=y,S=b;p=g,y=x,b=k,g=_,x=O,k=S}const w=XX(m,v,y,b,x,k);this._cx=w.x,this._cy=w.y;for(let _=0;_<a;_++)this._dists[_]=yw(e[2*_],e[2*_+1],w.x,w.y);kl(this._ids,this._dists,0,a-1),this._hullStart=h;let A=3;n[h]=t[g]=p,n[p]=t[h]=g,n[g]=t[p]=h,i[h]=0,i[p]=1,i[g]=2,r.fill(-1),r[this._hashKey(m,v)]=h,r[this._hashKey(y,b)]=p,r[this._hashKey(x,k)]=g,this.trianglesLen=0,this._addTriangle(h,p,g,-1,-1,-1);for(let _=0,O,S;_<this._ids.length;_++){const T=this._ids[_],D=e[2*T],M=e[2*T+1];if(_>0&&Math.abs(D-O)<=gR&&Math.abs(M-S)<=gR)continue;if(O=D,S=M,T===h||T===p||T===g)continue;let C=0;for(let xe=0,Pe=this._hashKey(D,M);xe<this._hashSize&&!(C=r[(Pe+xe)%this._hashSize],C!==-1&&C!==n[C]);xe++);C=t[C];let F=C,W;for(;W=n[F],!Up(D,M,e[2*F],e[2*F+1],e[2*W],e[2*W+1]);)if(F=W,F===C){F=-1;break}if(F===-1)continue;let X=this._addTriangle(F,T,n[F],-1,-1,i[F]);i[T]=this._legalize(X+2),i[F]=X,A++;let J=n[F];for(;W=n[J],Up(D,M,e[2*J],e[2*J+1],e[2*W],e[2*W+1]);)X=this._addTriangle(J,T,W,i[T],-1,i[J]),i[T]=this._legalize(X+2),n[J]=J,A--,J=W;if(F===C)for(;W=t[F],Up(D,M,e[2*W],e[2*W+1],e[2*F],e[2*F+1]);)X=this._addTriangle(W,T,F,-1,i[F],i[W]),this._legalize(X+2),i[W]=X,n[F]=F,A--,F=W;this._hullStart=t[T]=F,n[F]=t[J]=T,n[T]=J,r[this._hashKey(D,M)]=T,r[this._hashKey(e[2*F],e[2*F+1])]=F}this.hull=new Uint32Array(A);for(let _=0,O=this._hullStart;_<A;_++)this.hull[_]=O,O=n[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(HX(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,o===-1){if(r===0)break;e=Bp[--r];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c],g=YX(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1]);if(g){t[e]=p,t[o]=f;const m=n[c];if(m===-1){let y=this._hullStart;do{if(this._hullTri[y]===c){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,m),this._link(o,n[a]),this._link(a,c);const v=l+(o+1)%3;r<Bp.length&&(Bp[r++]=v)}else{if(r===0)break;e=Bp[--r]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,a),this.trianglesLen+=3,o}}function HX(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function yw(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}function bw(e,t,n,i,r,a){const o=(i-t)*(r-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function Up(e,t,n,i,r,a){const o=bw(r,a,e,t,n,i)||bw(e,t,n,i,r,a)||bw(n,i,r,a,e,t);return o<0}function YX(e,t,n,i,r,a,o,s){const l=e-o,u=t-s,c=n-o,f=i-s,d=r-o,h=a-s,p=l*l+u*u,g=c*c+f*f,m=d*d+h*h;return l*(f*m-g*h)-u*(c*m-g*d)+p*(c*h-f*d)<0}function VX(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function XX(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=e+(u*c-s*f)*d,p=t+(o*f-l*c)*d;return{x:h,y:p}}function kl(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const a=e[r],o=t[a];let s=r-1;for(;s>=n&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=a}else{const r=n+i>>1;let a=n+1,o=i;$c(e,r,a),t[e[n]]>t[e[i]]&&$c(e,n,i),t[e[a]]>t[e[i]]&&$c(e,a,i),t[e[n]]>t[e[a]]&&$c(e,n,a);const s=e[a],l=t[s];for(;;){do a++;while(t[e[a]]<l);do o--;while(t[e[o]]>l);if(o<a)break;$c(e,a,o)}e[n+1]=e[o],e[o]=s,i-a+1>=o-n?(kl(e,t,a,i),kl(e,t,n,o-1)):(kl(e,t,n,o-1),kl(e,t,a,i))}}function $c(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function JX(e){return e[0]}function KX(e){return e[1]}const mR=1e-6;class Bo{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const i=e+n,r=t;if(n<0)throw new Error("negative radius");if(this._x1===null?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>mR||Math.abs(this._y1-r)>mR)&&(this._+="L"+i+","+r),!n)return;this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class ww{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class QX{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d=0,h=0,p=n.length,g,m;d<p;d+=3,h+=2){const v=n[d]*2,y=n[d+1]*2,b=n[d+2]*2,E=e[v],x=e[v+1],k=e[y],w=e[y+1],A=e[b],_=e[b+1],O=k-E,S=w-x,T=A-E,D=_-x,M=O*O+S*S,C=T*T+D*D,F=(O*D-S*T)*2;if(!F)g=(E+A)/2-1e8*D,m=(x+_)/2+1e8*T;else if(Math.abs(F)<1e-8)g=(E+A)/2,m=(x+_)/2;else{const W=1/F;g=E+(D*M-S*C)*W,m=x+(O*C-T*M)*W}r[h]=g,r[h+1]=m}let a=t[t.length-1],o,s=a*4,l,u=e[2*a],c,f=e[2*a+1];i.fill(0);for(let d=0;d<t.length;++d)a=t[d],o=s,l=u,c=f,s=a*4,u=e[2*a],f=e[2*a+1],i[o+2]=i[s]=c-f,i[o+3]=i[s+1]=u-l}render(e){const t=e==null?e=new Bo():void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:a,vectors:o}=this;if(r.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const f=n[u];if(f<u)continue;const d=Math.floor(u/3)*2,h=Math.floor(f/3)*2,p=a[d],g=a[d+1],m=a[h],v=a[h+1];this._renderSegment(p,g,m,v,e)}let s,l=r[r.length-1];for(let u=0;u<r.length;++u){s=l,l=r[u];const c=Math.floor(i[l]/3)*2,f=a[c],d=a[c+1],h=s*4,p=this._project(f,d,o[h+2],o[h+3]);p&&this._renderSegment(f,d,p[0],p[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new Bo():void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=t==null?t=new Bo():void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let a=2;a<r;a+=2)(i[a]!==i[a-2]||i[a+1]!==i[a-1])&&t.lineTo(i[a],i[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new ww();return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let a;const o=this._regioncode(e,t),s=this._regioncode(n,i);o===0&&s===0?(r.moveTo(e,t),r.lineTo(n,i)):(a=this._clipSegment(e,t,n,i,o,s))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t,t!==t)||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const i=this._clip(n);if(i)e:for(let r=0,a=t.length;r<a;r+=2)for(let o=0,s=i.length;o<s;o+=2)if(t[r]==i[o]&&t[r+1]==i[o+1]&&t[(r+2)%a]==i[(o+s-2)%s]&&t[(r+3)%a]==i[(o+s-1)%s]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,a=n[e];if(a===-1)return null;const o=[];let s=a;do{const l=Math.floor(s/3);if(o.push(t[l*2],t[l*2+1]),s=s%3===2?s-2:s+1,r[s]!==e)break;s=i[s]}while(s!==a&&s!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:n}=this,i=e*4;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let i=null,r,a,o=t[n-2],s=t[n-1],l,u=this._regioncode(o,s),c,f;for(let d=0;d<n;d+=2)if(r=o,a=s,o=t[d],s=t[d+1],l=u,u=this._regioncode(o,s),l===0&&u===0)c=f,f=0,i?i.push(o,s):i=[o,s];else{let h,p,g,m,v;if(l===0){if((h=this._clipSegment(r,a,o,s,l,u))===null)continue;[p,g,m,v]=h}else{if((h=this._clipSegment(o,s,r,a,u,l))===null)continue;[m,v,p,g]=h,c=f,f=this._edgecode(p,g),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(p,g):i=[p,g]}c=f,f=this._edgecode(m,v),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(m,v):i=[m,v]}if(i)c=f,f=this._edgecode(i[0],i[1]),c&&f&&this._edge(e,c,f,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,n,i,r,a){for(;;){if(r===0&&a===0)return[e,t,n,i];if(r&a)return null;let o,s,l=r||a;l&8?(o=e+(n-e)*(this.ymax-t)/(i-t),s=this.ymax):l&4?(o=e+(n-e)*(this.ymin-t)/(i-t),s=this.ymin):l&2?(s=t+(i-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(i-t)*(this.xmin-e)/(n-e),o=this.xmin),r?(e=o,t=s,r=this._regioncode(e,t)):(n=o,i=s,a=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,a){let o=Array.from(t),s;if((s=this._project(o[0],o[1],n,i))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],r,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let l=0,u=o.length,c,f=this._edgecode(o[u-2],o[u-1]);l<u;l+=2)c=f,f=this._edgecode(o[l],o[l+1]),c&&f&&(l=this._edge(e,c,f,o,l),u=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,i,r){for(;t!==n;){let a,o;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}(i[r]!==a||i[r+1]!==o)&&this.contains(e,a,o)&&(i.splice(r,0,a,o),r+=2)}if(i.length>4)for(let a=0;a<i.length;a+=2){const o=(a+2)%i.length,s=(a+4)%i.length;(i[a]===i[o]&&i[o]===i[s]||i[a+1]===i[o+1]&&i[o+1]===i[s+1])&&(i.splice(o,2),a-=2)}return r}_project(e,t,n,i){let r=Infinity,a,o,s;if(i<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/i)<r&&(s=this.ymin,o=e+(r=a)*n)}else if(i>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/i)<r&&(s=this.ymax,o=e+(r=a)*n)}if(n>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/n)<r&&(o=this.xmax,s=t+(r=a)*i)}else if(n<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/n)<r&&(o=this.xmin,s=t+(r=a)*i)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const ZX=2*Math.PI,_l=Math.pow;function eJ(e){return e[0]}function tJ(e){return e[1]}function nJ(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],a=2*t[i+1],o=2*t[i+2],s=(n[o]-n[r])*(n[a+1]-n[r+1])-(n[a]-n[r])*(n[o+1]-n[r+1]);if(s>1e-10)return!1}return!0}function iJ(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class vR{static from(e,t=eJ,n=tJ,i){return new vR("length"in e?rJ(e,t,n,i):Float64Array.from(aJ(e,t,n,i)))}constructor(e){this._delaunator=new vw(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&nJ(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const s=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[t[2*s],t[2*s+1],t[2*l],t[2*l+1]],c=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let f=0,d=t.length/2;f<d;++f){const h=iJ(t[2*f],t[2*f+1],c);t[2*f]=h[0],t[2*f+1]=h[1]}this._delaunator=new vw(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const u=r[s%3===2?s-2:s+1];(n[s]===-1||a[u]===-1)&&(a[u]=s)}for(let s=0,l=i.length;s<l;++s)o[i[s]]=s;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],a[i[0]]=1,i.length===2&&(a[i[1]]=0))}voronoi(e){return new QX(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:a,collinear:o}=this;if(o){const c=o.indexOf(e);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const s=t[e];if(s===-1)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3===2?l-2:l+1,a[l]!==e)return;if(l=r[l],l===-1){const c=n[(i[e]+1)%n.length];c!==u&&(yield c);return}}while(l!==s)}find(e,t,n=0){if((e=+e,e!==e)||(t=+t,t!==t))return-1;const i=n;let r;for(;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}_step(e,t,n){const{inedges:i,hull:r,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);let u=e,c=_l(t-l[e*2],2)+_l(n-l[e*2+1],2);const f=i[e];let d=f;do{let h=s[d];const p=_l(t-l[h*2],2)+_l(n-l[h*2+1],2);if(p<c&&(c=p,u=h),d=d%3===2?d-2:d+1,s[d]!==e)break;if(d=o[d],d===-1){if(d=r[(a[e]+1)%r.length],d!==h&&_l(t-l[d*2],2)+_l(n-l[d*2+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=e==null?e=new Bo():void 0,{points:n,halfedges:i,triangles:r}=this;for(let a=0,o=i.length;a<o;++a){const s=i[a];if(s<a)continue;const l=r[a]*2,u=r[s]*2;e.moveTo(n[l],n[l+1]),e.lineTo(n[u],n[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=e==null?e=new Bo():void 0,{points:i}=this;for(let r=0,a=i.length;r<a;r+=2){const o=i[r],s=i[r+1];e.moveTo(o+t,s),e.arc(o,s,t,0,ZX)}return n&&n.value()}renderHull(e){const t=e==null?e=new Bo():void 0,{hull:n,points:i}=this,r=n[0]*2,a=n.length;e.moveTo(i[r],i[r+1]);for(let o=1;o<a;++o){const s=2*n[o];e.lineTo(i[s],i[s+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new ww();return this.renderHull(e),e.value()}renderTriangle(e,t){const n=t==null?t=new Bo():void 0,{points:i,triangles:r}=this,a=r[e*=3]*2,o=r[e+1]*2,s=r[e+2]*2;return t.moveTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.lineTo(i[s],i[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new ww();return this.renderTriangle(e,t),t.value()}}function rJ(e,t,n,i){const r=e.length,a=new Float64Array(r*2);for(let o=0;o<r;++o){const s=e[o];a[o*2]=t.call(i,s,o,e),a[o*2+1]=n.call(i,s,o,e)}return a}function*aJ(e,t,n,i){let r=0;for(const a of e)yield t.call(i,a,r,e),yield n.call(i,a,r,e),++r}function xw(e){$.call(this,null,e)}xw.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const oJ=P(xw,$),sJ=[-1e5,-1e5,1e5,1e5];oJ.transform=function(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:sJ;const a=this.value=vR.from(i,e.x,e.y).voronoi(r);for(let o=0,s=i.length;o<s;++o){const l=a.cellPolygon(o);i[o][n]=l?lJ(l):null}return t.reflow(e.modified()).modifies(n)};function lJ(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}var uJ=Object.freeze({__proto__:null,voronoi:xw}),Ew=Math.PI/180,Dc=1<<11>>5,qp=1<<11;function cJ(){var e=[256,256],t,n,i,r,a,o,s,l=yR,u=[],c=Math.random,f={};f.layout=function(){for(var p=d(Fu()),g=mJ((e[0]>>5)*e[1]),m=null,v=u.length,y=-1,b=[],E=u.map(function(k){return{text:t(k),font:n(k),style:r(k),weight:a(k),rotate:o(k),size:~~(i(k)+1e-14),padding:s(k),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:k}}).sort(function(k,w){return w.size-k.size});++y<v;){var x=E[y];x.x=e[0]*(c()+.5)>>1,x.y=e[1]*(c()+.5)>>1,fJ(p,x,E,y),x.hasText&&h(g,x,m)&&(b.push(x),m?hJ(m,x):m=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return b};function d(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(Dc<<5)/g,p.height=qp/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function h(p,g,m){for(var v=g.x,y=g.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),E=l(e),x=c()<.5?1:-1,k=-x,w,A,_;(w=E(k+=x))&&!(A=~~w[0],_=~~w[1],Math.min(Math.abs(A),Math.abs(_))>=b);){if(g.x=v+A,g.y=y+_,g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])continue;if((!m||!dJ(g,p,e[0]))&&(!m||pJ(g,m))){for(var O=g.sprite,S=g.width>>5,T=e[0]>>5,D=g.x-(S<<4),M=D&127,C=32-M,F=g.y1-g.y0,W=(g.y+g.y0)*T+(D>>5),X,J=0;J<F;J++){X=0;for(var xe=0;xe<=S;xe++)p[W+xe]|=X<<C|(xe<S?(X=O[J*S+xe])>>>M:0);W+=T}return g.sprite=null,!0}}return!1}return f.words=function(p){return arguments.length?(u=p,f):u},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=Uo(p),f):n},f.fontStyle=function(p){return arguments.length?(r=Uo(p),f):r},f.fontWeight=function(p){return arguments.length?(a=Uo(p),f):a},f.rotate=function(p){return arguments.length?(o=Uo(p),f):o},f.text=function(p){return arguments.length?(t=Uo(p),f):t},f.spiral=function(p){return arguments.length?(l=vJ[p]||p,f):l},f.fontSize=function(p){return arguments.length?(i=Uo(p),f):i},f.padding=function(p){return arguments.length?(s=Uo(p),f):s},f.random=function(p){return arguments.length?(c=p,f):c},f}function fJ(e,t,n,i){if(t.sprite)return;var r=e.context,a=e.ratio;r.clearRect(0,0,(Dc<<5)/a,qp/a);var o=0,s=0,l=0,u=n.length,c,f,d,h,p;for(--i;++i<u;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,c=r.measureText(t.text+"m").width*a,d=t.size<<1,t.rotate){var g=Math.sin(t.rotate*Ew),m=Math.cos(t.rotate*Ew),v=c*m,y=c*g,b=d*m,E=d*g;c=Math.max(Math.abs(v+E),Math.abs(v-E))+31>>5<<5,d=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else c=c+31>>5<<5;if(d>l&&(l=d),o+c>=Dc<<5&&(o=0,s+=l,l=0),s+d>=qp)break;r.translate((o+(c>>1))/a,(s+(d>>1))/a),t.rotate&&r.rotate(t.rotate*Ew),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var x=r.getImageData(0,0,(Dc<<5)/a,qp/a).data,k=[];--i>=0;){if(t=n[i],!t.hasText)continue;for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)k[h]=0;if(o=t.xoff,o==null)return;s=t.yoff;var w=0,A=-1;for(p=0;p<d;p++){for(h=0;h<c;h++){var _=f*p+(h>>5),O=x[(s+p)*(Dc<<5)+(o+h)<<2]?1<<31-h%32:0;k[_]|=O,w|=O}w?A=p:(t.y0++,d--,p--,s++)}t.y1=t.y0+A,t.sprite=k.slice(0,(t.y1-t.y0)*f)}}function dJ(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,a=e.x-(r<<4),o=a&127,s=32-o,l=e.y1-e.y0,u=(e.y+e.y0)*n+(a>>5),c,f=0;f<l;f++){c=0;for(var d=0;d<=r;d++)if((c<<s|(d<r?(c=i[f*r+d])>>>o:0))&t[u+d])return!0;u+=n}return!1}function hJ(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function pJ(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function yR(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function gJ(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function mJ(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function Uo(e){return typeof e=="function"?e:function(){return e}}var vJ={archimedean:yR,rectangular:gJ},bR=["x","y","font","fontSize","fontStyle","fontWeight","angle"],yJ=["text","font","rotate","fontSize","fontStyle","fontWeight"];function kw(e){$.call(this,cJ(),e)}kw.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:bR}]};var bJ=P(kw,$);bJ.transform=function(e,t){e.size&&!(e.size[0]&&e.size[1])&&N("Wordcloud size dimensions must be non-zero.");function n(b){var E=e[b];return ge(E)&&t.modified(E.fields)}var i=e.modified();if(!(i||t.changed(t.ADD_REM)||yJ.some(n)))return;var r=t.materialize(t.SOURCE).source,a=this.value,o=e.as||bR,s=e.fontSize||14,l;if(ge(s)?l=e.fontSizeRange:s=Vt(s),l){var u=s,c=Ee("sqrt")().domain(yr(r,u)).range(l);s=function(b){return c(u(b))}}r.forEach(function(b){b[o[0]]=NaN,b[o[1]]=NaN,b[o[3]]=0});for(var f=a.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(Wn).layout(),d=a.size(),h=d[0]>>1,p=d[1]>>1,g=0,m=f.length,v,y;g<m;++g)v=f[g],y=v.datum,y[o[0]]=v.x+h,y[o[1]]=v.y+p,y[o[2]]=v.font,y[o[3]]=v.size,y[o[4]]=v.style,y[o[5]]=v.weight,y[o[6]]=v.rotate;return t.reflow(i).modifies(o)};var wJ=Object.freeze({__proto__:null,wordcloud:kw});function xJ(e){return new Uint8Array(e)}function EJ(e){return new Uint16Array(e)}function Rc(e){return new Uint32Array(e)}function kJ(){var e=8,t=[],n=Rc(0),i=Wp(0,e),r=Wp(0,e);return{data:function(){return t},seen:function(){return n=_J(n,t.length)},add:function(a){for(var o=0,s=t.length,l=a.length,u;o<l;++o)u=a[o],u._index=s++,t.push(u)},remove:function(a,o){var s=t.length,l=Array(s-a),u=t,c,f,d;for(f=0;!o[f]&&f<s;++f)l[f]=t[f],u[f]=f;for(d=f;f<s;++f)c=t[f],o[f]?u[f]=-1:(u[f]=d,i[d]=i[f],r[d]=r[f],l[d]=c,c._index=d++),i[f]=0;return t=l,u},size:function(){return t.length},curr:function(){return i},prev:function(){return r},reset:function(a){r[a]=i[a]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(a,o){i[a]|=o},clear:function(a,o){i[a]&=~o},resize:function(a,o){var s=i.length;(a>s||o>e)&&(e=Math.max(o,e),i=Wp(a,e,i),r=Wp(a,e))}}}function _J(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function Wp(e,t,n){var i=(t<257?xJ:t<65537?EJ:Rc)(e);return n&&i.set(n),i}function wR(e,t,n){var i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(r,a){var o=this,s=o.bisect(o.range,r.value),l=r.index,u=s[0],c=s[1],f=l.length,d;for(d=0;d<u;++d)a[l[d]]|=i;for(d=c;d<f;++d)a[l[d]]|=i;return o}}}function xR(){var e=Rc(0),t=[],n=0;function i(s,l,u){if(!l.length)return[];var c=n,f=l.length,d=Array(f),h=Rc(f),p,g,m;for(m=0;m<f;++m)d[m]=s(l[m]),h[m]=m;if(d=AJ(d,h),c)p=t,g=e,t=Array(c+f),e=Rc(c+f),SJ(u,p,g,c,d,h,f,t,e);else{if(u>0)for(m=0;m<f;++m)h[m]+=u;t=d,e=h}return n=c+f,{index:h,value:d}}function r(s,l){var u=n,c,f,d;for(f=0;!l[e[f]]&&f<u;++f);for(d=f;f<u;++f)l[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=u-s}function a(s){for(var l=0,u=n;l<u;++l)e[l]=s[e[l]]}function o(s,l){var u;return l?u=l.length:(l=t,u=n),[S6(l,s[0],0,u),na(l,s[1],0,u)]}return{insert:i,remove:r,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function AJ(e,t){return e.sort.call(t,function(n,i){var r=e[n],a=e[i];return r<a?-1:r>a?1:0}),N6(e,t)}function SJ(e,t,n,i,r,a,o,s,l){var u=0,c=0,f;for(f=0;u<i&&c<o;++f)t[u]<r[c]?(s[f]=t[u],l[f]=n[u++]):(s[f]=r[c],l[f]=a[c++]+e);for(;u<i;++u,++f)s[f]=t[u],l[f]=n[u];for(;c<o;++c,++f)s[f]=r[c],l[f]=a[c]+e}function _w(e){$.call(this,kJ(),e),this._indices=null,this._dims=null}_w.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var wi=P(_w,$);wi.transform=function(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(function(i){return t.modified(i.fields)});return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},wi.init=function(e,t){for(var n=e.fields,i=e.query,r=this._indices={},a=this._dims=[],o=i.length,s=0,l,u;s<o;++s)l=n[s].fname,u=r[l]||(r[l]=xR()),a.push(wR(u,s,i[s]));return this.eval(e,t)},wi.reinit=function(e,t){var n=t.materialize().fork(),i=e.fields,r=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=r.length,p={},g,m,v,y,b,E,x,k,w;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(E={},y=t.mod,x=0,k=y.length;x<k;++x)E[y[x]._index]=1;for(x=0;x<h;++x)w=i[x],(!o[x]||e.modified("fields",x)||t.modified(w.fields))&&(v=w.fname,(g=p[v])||(a[v]=m=xR(),p[v]=g=m.insert(w,t.source,0)),o[x]=wR(m,x,r[x]).onAdd(g,l));for(x=0,k=s.data().length;x<k;++x){if(b[x])continue;u[x]!==l[x]?f.push(x):E[x]&&l[x]!==c&&d.push(x)}return s.mask=(1<<h)-1,n},wi.eval=function(e,t){var n=t.materialize().fork(),i=this._dims.length,r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},wi.insert=function(e,t,n){var i=t.add,r=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=r.size(),f=c+i.length,d=a.length,h,p,g;r.resize(f,d),r.add(i);var m=r.curr(),v=r.prev(),y=r.all();for(h=0;h<d;++h)p=s[h].fname,g=l[p]||(l[p]=o[p].insert(s[h],i,c)),a[h].onAdd(g,m);for(;c<f;++c)v[c]=y,m[c]!==y&&u.push(c)},wi.modify=function(e,t){var n=t.mod,i=this.value,r=i.curr(),a=i.all(),o=e.mod,s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,r[u]!==a&&n.push(u)},wi.remove=function(e,t,n){var i=this._indices,r=this.value,a=r.curr(),o=r.prev(),s=r.all(),l={},u=n.rem,c=t.rem,f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in i)i[h].remove(d,l);return this.reindex(t,d,l),l},wi.reindex=function(e,t,n){var i=this._indices,r=this.value;e.runAfter(function(){var a=r.remove(t,n);for(var o in i)i[o].reindex(a)})},wi.update=function(e,t,n){var i=this._dims,r=e.query,a=t.stamp,o=i.length,s=0,l,u;for(n.filters=0,u=0;u<o;++u)e.modified("query",u)&&(l=u,++s);if(s===1)s=i[l].one,this.incrementOne(i[l],r[l],n.add,n.rem);else for(u=0,s=0;u<o;++u){if(!e.modified("query",u))continue;s|=i[u].one,this.incrementAll(i[u],r[u],a,n.add),n.rem=n.add}return s},wi.incrementAll=function(e,t,n,i){var r=this.value,a=r.seen(),o=r.curr(),s=r.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],g=e.one,m,v,y;if(f<h)for(m=f,v=Math.min(h,d);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(f>h)for(m=h,v=Math.min(f,p);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;if(d>p)for(m=Math.max(f,p),v=d;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(d<p)for(m=Math.max(h,d),v=p;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;e.range=t.slice()},wi.incrementOne=function(e,t,n,i){var r=this.value,a=r.curr(),o=e.index(),s=e.bisect(e.range),l=e.bisect(t),u=l[0],c=l[1],f=s[0],d=s[1],h=e.one,p,g,m;if(u<f)for(p=u,g=Math.min(f,c);p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(u>f)for(p=f,g=Math.min(u,d);p<g;++p)m=o[p],a[m]^=h,i.push(m);if(c>d)for(p=Math.max(u,d),g=c;p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(c<d)for(p=Math.max(f,c),g=d;p<g;++p)m=o[p],a[m]^=h,i.push(m);e.range=t.slice()};function Aw(e){$.call(this,null,e)}Aw.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var OJ=P(Aw,$);OJ.transform=function(e,t){var n=~(e.ignore||0),i=e.filter,r=i.mask;if((r&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=i.data(),s=i.curr(),l=i.prev(),u=function(c){return s[c]&n?null:o[c]};return a.filter(a.MOD,u),r&r-1?(a.filter(a.ADD,function(c){var f=s[c]&n,d=!f&&f^l[c]&n;return d?o[c]:null}),a.filter(a.REM,function(c){var f=s[c]&n,d=f&&!(f^(f^l[c]&n));return d?o[c]:null})):(a.filter(a.ADD,u),a.filter(a.REM,function(c){return(s[c]&n)===r?o[c]:null})),a.filter(a.SOURCE,function(c){return u(c._index)})};var TJ=Object.freeze({__proto__:null,crossfilter:_w,resolvefilter:Aw});const CJ="5.13.0";function $J(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),ER(t,e.description()))}function ER(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function DJ(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const Sw="default";function RJ(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:Sw,item:null}));e.on(e.events("view","mousemove"),t,function(n,i){const r=t.value,a=r?Y(r)?r:r.user:Sw,o=i.item&&i.item.cursor||null;return r&&a===r.user&&o==r.item?r:{user:a,item:o}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),Ow(e,i&&i!==Sw?i:r||i),r},{cursor:t})}function Ow(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function Gp(e,t){var n=e._runtime.data;return Q(n,t)||N("Unrecognized data set: "+t),n[t]}function NJ(e,t){return arguments.length<2?Gp(this,e).values.value:Hp.call(this,e,ho().remove(Fi).insert(t))}function Hp(e,t){Rk(t)||N("Second argument to changes must be a changeset.");var n=Gp(this,e);return n.modified=!0,this.pulse(n.input,t)}function FJ(e,t){return Hp.call(this,e,ho().insert(t))}function IJ(e,t){return Hp.call(this,e,ho().remove(t))}function kR(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function _R(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Yp(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function MJ(e){var t=Yp(e),n=kR(e),i=_R(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(function(r){try{r(n,i)}catch(a){e.error(a)}})}function jJ(e,t,n){var i=e._renderer,r=i&&i.canvas(),a,o,s;return r&&(s=Yp(e),o=t.changedTouches?t.changedTouches[0]:t,a=mh(o,r),a[0]-=s[0],a[1]-=s[1]),t.dataflow=e,t.item=n,t.vega=LJ(e,n,a),t}function LJ(e,t,n){var i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(o){var s=i,l;if(o){for(l=t;l;l=l.mark.group)if(l.mark.name===o){s=l;break}}return s&&s.mark&&s.mark.interactive?s:{}}function a(o){if(!o)return n;Y(o)&&(o=r(o));for(var s=n.slice();o;)s[0]-=o.x||0,s[1]-=o.y||0,o=o.mark&&o.mark.group;return s}return{view:Vt(e),item:Vt(t||{}),group:r,xy:a,x:function(o){return a(o)[0]},y:function(o){return a(o)[1]}}}const AR="view",PJ="timer",zJ="window",BJ={trap:!1};function UJ(e){const t=fe({defaults:{}},e),n=(i,r)=>{r.forEach(a=>{I(i[a])&&(i[a]=kt(i[a]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function qJ(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function Vp(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||K(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function WJ(e,t,n){var i=this,r=new gd(n),a=function(u,c){i.runAsync(null,()=>{e===AR&&qJ(i,t)&&u.preventDefault(),r.receive(jJ(i,u,c))})},o;if(e===PJ)Vp(i,"timer",t)&&i.timer(a,t);else if(e===AR)Vp(i,"view",t)&&i.addEventListener(t,a,BJ);else if(e===zJ?Vp(i,"window",t)&&typeof window!="undefined"&&(o=[window]):typeof document!="undefined"&&(Vp(i,"selector",t)&&(o=document.querySelectorAll(e))),!o)i.warn("Can not resolve event source: "+e);else{for(var s=0,l=o.length;s<l;++s)o[s].addEventListener(t,a);i._eventListeners.push({type:t,sources:o,handler:a})}return r}function SR(e){return e.item}function OR(e){return e.item.mark.source}function TR(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function GJ(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",SR),OR,TR(e)),this.on(this.events("view","mouseout",SR),OR,TR(t)),this}function HJ(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,a;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(a=n[i],r=a.sources.length;--r>=0;)a.sources[r].removeEventListener(a.type,a.handler);return e&&e.call(this,this._handler,null,null,null),this}function Pn(e,t,n){var i=document.createElement(e);for(var r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const YJ="vega-bind",VJ="vega-bind-name",XJ="vega-bind-radio";function JJ(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:a=>{a!==e.signal(i.signal)&&e.runAsync(null,function(){r.source=!0,e.signal(i.signal,a)})}},i.debounce&&(r.update=_k(i.debounce,r.update))),KJ(r,t,i,e.signal(i.signal)),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function KJ(e,t,n,i){const r=Pn("div",{class:YJ}),a=n.input==="radio"?r:r.appendChild(Pn("label"));a.appendChild(Pn("span",{class:VJ},n.name||n.signal)),t.appendChild(r);let o=QJ;switch(n.input){case"checkbox":o=ZJ;break;case"select":o=eK;break;case"radio":o=tK;break;case"range":o=nK;break}o(e,a,n,i)}function QJ(e,t,n,i){const r=Pn("input");for(const a in n)a!=="signal"&&a!=="element"&&r.setAttribute(a==="input"?"type":a,n[a]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=a=>r.value=a}function ZJ(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const a=Pn("input",r);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=o=>a.checked=!!o||null}function eK(e,t,n,i){const r=Pn("select",{name:n.signal}),a=n.labels||[];n.options.forEach((o,s)=>{const l={value:o};Xp(o,i)&&(l.selected=!0),r.appendChild(Pn("option",l,(a[s]||o)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=o=>{for(let s=0,l=n.options.length;s<l;++s)if(Xp(n.options[s],o)){r.selectedIndex=s;return}}}function tK(e,t,n,i){const r=Pn("span",{class:XJ}),a=n.labels||[];t.appendChild(r),e.elements=n.options.map((o,s)=>{const l={type:"radio",name:n.signal,value:o};Xp(o,i)&&(l.checked=!0);const u=Pn("input",l);u.addEventListener("change",()=>e.update(o));const c=Pn("label",{},(a[s]||o)+"");return c.prepend(u),r.appendChild(c),u}),e.set=o=>{const s=e.elements,l=s.length;for(let u=0;u<l;++u)Xp(s[u].value,o)&&(s[u].checked=!0)}}function nK(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,o=n.step||ia(a,r,100),s=Pn("input",{type:"range",name:n.signal,min:a,max:r,step:o});s.value=i;const l=Pn("span",{},+i);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=c=>{s.value=c,l.textContent=c}}function Xp(e,t){return e===t||e+""===t+""}function CR(e,t,n,i,r,a){return t=t||new i(e.loader()),t.initialize(n,kR(e),_R(e),Yp(e),r,a).background(e.background())}function Tw(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function iK(e,t,n,i){var r=new i(e.loader(),Tw(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Yp(e),e);return t&&t.handlers().forEach(function(a){r.on(a.type,a.handler)}),r}function rK(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,a=Gh(i);e=n._el=e?Cw(n,e):null,$J(n),a||n.error("Unrecognized renderer type: "+i);const o=a.handler||Uu,s=e?a.renderer:a.headless;return n._renderer=s?CR(n,n._renderer,e,s):null,n._handler=iK(n,n._handler,e,o),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=Cw(n,t):e.appendChild(Pn("form",{class:"vega-bindings"})),n._bind.forEach(function(l){l.param.element&&r!=="container"&&(l.element=Cw(n,l.param.element))}),n._bind.forEach(function(l){JJ(n,l.element||t,l)})),n}function Cw(e,t){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const Nc=e=>+e||0,aK=e=>({top:e,bottom:e,left:e,right:e});function $R(e){return K(e)?{top:Nc(e.top),bottom:Nc(e.bottom),left:Nc(e.left),right:Nc(e.right)}:aK(Nc(e))}async function $w(e,t,n,i){const r=Gh(t),a=r&&r.headless;return a||N("Unrecognized renderer type: "+t),await e.runAsync(),CR(e,null,null,a,n,i).renderAsync(e._scenegraph.root)}async function oK(e,t){e!==ka.Canvas&&e!==ka.SVG&&e!==ka.PNG&&N("Unrecognized image type: "+e);const n=await $w(this,e,t);return e===ka.SVG?sK(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function sK(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function lK(e,t){const n=await $w(this,ka.Canvas,e,t);return n.canvas()}async function uK(e){const t=await $w(this,ka.SVG,e);return t.svg()}function DR(e){const t=this.context.data[e];return t?t.values.value:[]}function cK(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function fK(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Fi).insert(t)),1}function dK(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const Fc=e=>function(t,n){const i=this.context.dataflow.locale();return i[e](n)(t)},hK=Fc("format"),RR=Fc("timeFormat"),pK=Fc("utcFormat"),gK=Fc("timeParse"),mK=Fc("utcParse");var Jp=new Date(2e3,0,1);function Kp(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Jp.setYear(2e3),Jp.setMonth(e),Jp.setDate(t),RR.call(this,Jp,n))}function vK(e){return Kp.call(this,e,1,"%B")}function yK(e){return Kp.call(this,e,1,"%b")}function bK(e){return Kp.call(this,0,2+e,"%A")}function wK(e){return Kp.call(this,0,2+e,"%a")}const xK=":",EK="@",Dw="%",NR="$";var kK="RawCode",qo="Literal",_K="Property",AK="Identifier",SK="ArrayExpression",OK="BinaryExpression",FR="CallExpression",TK="ConditionalExpression",CK="LogicalExpression",$K="MemberExpression",DK="ObjectExpression",RK="UnaryExpression";function xi(e){this.type=e}xi.prototype.visit=function(e){var t=this,n,i,r;if(e(t))return 1;for(n=NK(t),i=0,r=n.length;i<r;++i)if(n[i].visit(e))return 1};function NK(e){switch(e.type){case SK:return e.elements;case OK:case CK:return[e.left,e.right];case FR:var t=e.arguments.slice();return t.unshift(e.callee),t;case TK:return[e.test,e.consequent,e.alternate];case $K:return[e.object,e.property];case DK:return e.properties;case _K:return[e.key,e.value];case RK:return[e.argument];case AK:case qo:case kK:default:return[]}}var Ji,V,R,zt,Te,Qp=1,Ic=2,Wo=3,Sa=4,Zp=5,Go=6,xn=7,Mc=8,FK=9;Ji={},Ji[Qp]="Boolean",Ji[Ic]="<end>",Ji[Wo]="Identifier",Ji[Sa]="Keyword",Ji[Zp]="Null",Ji[Go]="Numeric",Ji[xn]="Punctuator",Ji[Mc]="String",Ji[FK]="RegularExpression";var IK="ArrayExpression",MK="BinaryExpression",jK="CallExpression",LK="ConditionalExpression",IR="Identifier",PK="Literal",zK="LogicalExpression",BK="MemberExpression",UK="ObjectExpression",qK="Property",WK="UnaryExpression",$t="Unexpected token %0",GK="Unexpected number",HK="Unexpected string",YK="Unexpected identifier",VK="Unexpected reserved word",XK="Unexpected end of input",Rw="Invalid regular expression",Nw="Invalid regular expression: missing /",MR="Octal literals are not allowed in strict mode.",JK="Duplicate data property in object literal not allowed in strict mode",Bt="ILLEGAL",jc="Disabled.",KK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),QK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function eg(e,t){if(!e)throw new Error("ASSERT: "+t)}function Fr(e){return e>=48&&e<=57}function Fw(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Lc(e){return"01234567".indexOf(e)>=0}function ZK(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Pc(e){return e===10||e===13||e===8232||e===8233}function zc(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&KK.test(String.fromCharCode(e))}function tg(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&QK.test(String.fromCharCode(e))}var eQ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function jR(){for(var e;R<zt&&(e=V.charCodeAt(R),ZK(e)||Pc(e));)++R}function Iw(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)R<zt&&Fw(V[R])?(i=V[R++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):_e({},$t,Bt);return String.fromCharCode(r)}function tQ(){var e,t,n,i;for(e=V[R],t=0,e==="}"&&_e({},$t,Bt);R<zt&&!(e=V[R++],!Fw(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&_e({},$t,Bt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function LR(){var e,t;for(e=V.charCodeAt(R++),t=String.fromCharCode(e),e===92&&(V.charCodeAt(R)!==117&&_e({},$t,Bt),++R,e=Iw("u"),(!e||e==="\\"||!zc(e.charCodeAt(0)))&&_e({},$t,Bt),t=e);R<zt&&!(e=V.charCodeAt(R),!tg(e));)++R,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),V.charCodeAt(R)!==117&&_e({},$t,Bt),++R,e=Iw("u"),(!e||e==="\\"||!tg(e.charCodeAt(0)))&&_e({},$t,Bt),t+=e);return t}function nQ(){var e,t;for(e=R++;R<zt;){if(t=V.charCodeAt(R),t===92)return R=e,LR();if(tg(t))++R;else break}return V.slice(e,R)}function iQ(){var e,t,n;return e=R,t=V.charCodeAt(R)===92?LR():nQ(),t.length===1?n=Wo:eQ.hasOwnProperty(t)?n=Sa:t==="null"?n=Zp:t==="true"||t==="false"?n=Qp:n=Wo,{type:n,value:t,start:e,end:R}}function Mw(){var e=R,t=V.charCodeAt(R),n,i=V[R],r,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++R,{type:xn,value:String.fromCharCode(t),start:e,end:R};default:if(n=V.charCodeAt(R+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return R+=2,{type:xn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:R};case 33:case 61:return R+=2,V.charCodeAt(R)===61&&++R,{type:xn,value:V.slice(e,R),start:e,end:R}}}if(o=V.substr(R,4),o===">>>=")return R+=4,{type:xn,value:o,start:e,end:R};if(a=o.substr(0,3),a===">>>"||a==="<<="||a===">>=")return R+=3,{type:xn,value:a,start:e,end:R};if(r=a.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return R+=2,{type:xn,value:r,start:e,end:R};if("<>=!+-*%&|^/".indexOf(i)>=0)return++R,{type:xn,value:i,start:e,end:R};_e({},$t,Bt)}function rQ(e){for(var t="";R<zt&&Fw(V[R]);)t+=V[R++];return t.length===0&&_e({},$t,Bt),zc(V.charCodeAt(R))&&_e({},$t,Bt),{type:Go,value:parseInt("0x"+t,16),start:e,end:R}}function aQ(e){for(var t="0"+V[R++];R<zt&&Lc(V[R]);)t+=V[R++];return(zc(V.charCodeAt(R))||Fr(V.charCodeAt(R)))&&_e({},$t,Bt),{type:Go,value:parseInt(t,8),octal:!0,start:e,end:R}}function PR(){var e,t,n;if(n=V[R],eg(Fr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=R,e="",n!=="."){if(e=V[R++],n=V[R],e==="0"){if(n==="x"||n==="X")return++R,rQ(t);if(Lc(n))return aQ(t);n&&Fr(n.charCodeAt(0))&&_e({},$t,Bt)}for(;Fr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="."){for(e+=V[R++];Fr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="e"||n==="E")if(e+=V[R++],n=V[R],(n==="+"||n==="-")&&(e+=V[R++]),Fr(V.charCodeAt(R)))for(;Fr(V.charCodeAt(R));)e+=V[R++];else _e({},$t,Bt);return zc(V.charCodeAt(R))&&_e({},$t,Bt),{type:Go,value:parseFloat(e),start:t,end:R}}function oQ(){var e="",t,n,i,r,a=!1;for(t=V[R],eg(t==="'"||t==='"',"String literal must starts with a quote"),n=R,++R;R<zt;)if(i=V[R++],i===t){t="";break}else if(i==="\\")if(i=V[R++],!i||!Pc(i.charCodeAt(0)))switch(i){case"u":case"x":V[R]==="{"?(++R,e+=tQ()):e+=Iw(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Lc(i)?(r="01234567".indexOf(i),r!==0&&(a=!0),R<zt&&Lc(V[R])&&(a=!0,r=r*8+"01234567".indexOf(V[R++]),"0123".indexOf(i)>=0&&R<zt&&Lc(V[R])&&(r=r*8+"01234567".indexOf(V[R++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&V[R]===`
`&&++R;else{if(Pc(i.charCodeAt(0)))break;e+=i}return t!==""&&_e({},$t,Bt),{type:Mc,value:e,octal:a,start:n,end:R}}function sQ(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(i,r){if(parseInt(r,16)<=1114111)return"x";_e({},Rw)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){_e({},Rw)}try{return new RegExp(e,t)}catch(i){return null}}function lQ(){var e,t,n,i,r;for(e=V[R],eg(e==="/","Regular expression literal must start with a slash"),t=V[R++],n=!1,i=!1;R<zt;)if(e=V[R++],t+=e,e==="\\")e=V[R++],Pc(e.charCodeAt(0))&&_e({},Nw),t+=e;else if(Pc(e.charCodeAt(0)))_e({},Nw);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||_e({},Nw),r=t.substr(1,t.length-2),{value:r,literal:t}}function uQ(){var e,t,n;for(t="",n="";R<zt&&!(e=V[R],!tg(e.charCodeAt(0)));)++R,e==="\\"&&R<zt?_e({},$t,Bt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_e({},Rw,n),{value:n,literal:t}}function cQ(){var e,t,n,i;return Te=null,jR(),e=R,t=lQ(),n=uQ(),i=sQ(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:R}}function fQ(e){return e.type===Wo||e.type===Sa||e.type===Qp||e.type===Zp}function zR(){var e;return jR(),R>=zt?{type:Ic,start:R,end:R}:(e=V.charCodeAt(R),zc(e)?iQ():e===40||e===41||e===59?Mw():e===39||e===34?oQ():e===46?Fr(V.charCodeAt(R+1))?PR():Mw():Fr(e)?PR():Mw())}function En(){var e;return e=Te,R=e.end,Te=zR(),R=e.end,e}function BR(){var e;e=R,Te=zR(),R=e}function dQ(e){var t=new xi(IK);return t.elements=e,t}function UR(e,t,n){var i=new xi(e==="||"||e==="&&"?zK:MK);return i.operator=e,i.left=t,i.right=n,i}function hQ(e,t){var n=new xi(jK);return n.callee=e,n.arguments=t,n}function pQ(e,t,n){var i=new xi(LK);return i.test=e,i.consequent=t,i.alternate=n,i}function jw(e){var t=new xi(IR);return t.name=e,t}function Bc(e){var t=new xi(PK);return t.value=e.value,t.raw=V.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function qR(e,t,n){var i=new xi(BK);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function gQ(e){var t=new xi(UK);return t.properties=e,t}function WR(e,t,n){var i=new xi(qK);return i.key=t,i.value=n,i.kind=e,i}function mQ(e,t){var n=new xi(WK);return n.operator=e,n.argument=t,n.prefix=!0,n}function _e(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,function(a,o){return eg(o<i.length,"Message reference must be in range"),i[o]});throw n=new Error(r),n.index=R,n.description=r,n}function ng(e){e.type===Ic&&_e(e,XK),e.type===Go&&_e(e,GK),e.type===Mc&&_e(e,HK),e.type===Wo&&_e(e,YK),e.type===Sa&&_e(e,VK),_e(e,$t,e.value)}function Ut(e){var t=En();(t.type!==xn||t.value!==e)&&ng(t)}function Le(e){return Te.type===xn&&Te.value===e}function Lw(e){return Te.type===Sa&&Te.value===e}function vQ(){var e=[];for(R=Te.start,Ut("[");!Le("]");)Le(",")?(En(),e.push(null)):(e.push(Ho()),Le("]")||Ut(","));return En(),dQ(e)}function GR(){var e;return R=Te.start,e=En(),e.type===Mc||e.type===Go?(e.octal&&_e(e,MR),Bc(e)):jw(e.value)}function yQ(){var e,t,n,i;if(R=Te.start,e=Te,e.type===Wo)return n=GR(),Ut(":"),i=Ho(),WR("init",n,i);if(e.type===Ic||e.type===xn)ng(e);else return t=GR(),Ut(":"),i=Ho(),WR("init",t,i)}function bQ(){var e=[],t,n,i,r={},a=String;for(R=Te.start,Ut("{");!Le("}");)t=yQ(),t.key.type===IR?n=t.key.name:n=a(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?_e({},JK):r[i]=!0,e.push(t),Le("}")||Ut(",");return Ut("}"),gQ(e)}function wQ(){var e;return Ut("("),e=Pw(),Ut(")"),e}var xQ={if:1};function EQ(){var e,t,n;if(Le("("))return wQ();if(Le("["))return vQ();if(Le("{"))return bQ();if(e=Te.type,R=Te.start,e===Wo||xQ[Te.value])n=jw(En().value);else if(e===Mc||e===Go)Te.octal&&_e(Te,MR),n=Bc(En());else{if(e===Sa)throw new Error(jc);e===Qp?(t=En(),t.value=t.value==="true",n=Bc(t)):e===Zp?(t=En(),t.value=null,n=Bc(t)):Le("/")||Le("/=")?(n=Bc(cQ()),BR()):ng(En())}return n}function kQ(){var e=[];if(Ut("("),!Le(")"))for(;R<zt&&!(e.push(Ho()),Le(")"));)Ut(",");return Ut(")"),e}function _Q(){var e;return R=Te.start,e=En(),fQ(e)||ng(e),jw(e.value)}function AQ(){return Ut("."),_Q()}function SQ(){var e;return Ut("["),e=Pw(),Ut("]"),e}function OQ(){var e,t,n;for(e=EQ();;)if(Le("."))n=AQ(),e=qR(".",e,n);else if(Le("("))t=kQ(),e=hQ(e,t);else if(Le("["))n=SQ(),e=qR("[",e,n);else break;return e}function HR(){var e=OQ();if(Te.type===xn&&(Le("++")||Le("--")))throw new Error(jc);return e}function ig(){var e,t;if(Te.type!==xn&&Te.type!==Sa)t=HR();else{if(Le("++")||Le("--"))throw new Error(jc);if(Le("+")||Le("-")||Le("~")||Le("!"))e=En(),t=ig(),t=mQ(e.value,t);else{if(Lw("delete")||Lw("void")||Lw("typeof"))throw new Error(jc);t=HR()}}return t}function YR(e){var t=0;if(e.type!==xn&&e.type!==Sa)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function TQ(){var e,t,n,i,r,a,o,s,l,u;if(e=Te,l=ig(),i=Te,r=YR(i),r===0)return l;for(i.prec=r,En(),t=[e,Te],o=ig(),a=[l,i,o];(r=YR(Te))>0;){for(;a.length>2&&r<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=UR(s,l,o),a.push(n);i=En(),i.prec=r,a.push(i),t.push(Te),n=ig(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)t.pop(),n=UR(a[u-1].value,a[u-2],n),u-=2;return n}function Ho(){var e,t,n;return e=TQ(),Le("?")&&(En(),t=Ho(),Ut(":"),n=Ho(),e=pQ(e,t,n)),e}function Pw(){var e=Ho();if(Le(","))throw new Error(jc);return e}function VR(e){V=e,R=0,zt=V.length,Te=null,BR();var t=Pw();if(Te.type!==Ic)throw new Error("Unexpect token after expression.");return t}var XR={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function JR(e){function t(o,s,l,u){var c=e(s[0]);return l&&(c=l+"("+c+")",l.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(u<0?"":u===0?"()":"("+s.slice(1).map(e).join(",")+")")}function n(o,s,l){return function(u){return t(o,u,s,l)}}var i="new Date",r="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&N("Missing arguments to clamp function."),o.length>3&&N("Too many arguments to clamp function.");var s=o.map(e);return"Math.max("+s[1]+", Math.min("+s[2]+","+s[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),join:n("join",null),indexof:n("indexOf",null),lastindexof:n("lastIndexOf",null),slice:n("slice",null),reverse:function(o){return"("+e(o[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),replace:n("replace",r),trim:n("trim",r,0),regexp:a,test:n("test",a),if:function(o){o.length<3&&N("Missing arguments to if function."),o.length>3&&N("Too many arguments to if function.");var s=o.map(e);return"("+s[0]+"?"+s[1]+":"+s[2]+")"}}}function CQ(e){var t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function $Q(e){e=e||{};var t=e.whitelist?kt(e.whitelist):{},n=e.blacklist?kt(e.blacklist):{},i=e.constants||XR,r=(e.functions||JR)(f),a=e.globalvar,o=e.fieldvar,s={},l={},u=0,c=ge(a)?a:function(p){return a+'["'+p+'"]'};function f(p){if(Y(p))return p;var g=d[p.type];return g==null&&N("Unsupported type: "+p.type),g(p)}var d={Literal:function(p){return p.raw},Identifier:function(p){var g=p.name;return u>0?g:Q(n,g)?N("Illegal identifier: "+g):Q(i,g)?i[g]:Q(t,g)?g:(s[g]=1,c(g))},MemberExpression:function(p){var g=!p.computed,m=f(p.object);g&&(u+=1);var v=f(p.property);return m===o&&(l[CQ(v)]=1),g&&(u-=1),m+(g?"."+v:"["+v+"]")},CallExpression:function(p){p.callee.type!=="Identifier"&&N("Illegal callee type: "+p.callee.type);var g=p.callee.name,m=p.arguments,v=Q(r,g)&&r[g];return v||N("Unrecognized function: "+g),ge(v)?v(m):v+"("+m.map(f).join(",")+")"},ArrayExpression:function(p){return"["+p.elements.map(f).join(",")+"]"},BinaryExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},UnaryExpression:function(p){return"("+p.operator+f(p.argument)+")"},ConditionalExpression:function(p){return"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")"},LogicalExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},ObjectExpression:function(p){return"{"+p.properties.map(f).join(",")+"}"},Property:function(p){u+=1;var g=f(p.key);return u-=1,g+":"+f(p.value)}};function h(p){var g={code:f(p),globals:Object.keys(s),fields:Object.keys(l)};return s={},l={},g}return h.functions=r,h.constants=i,h}function zw(e,t,n,i){t[0].type!==qo&&N("First argument to data functions must be a string literal.");const r=t[0].value,a=xK+r;if(!Q(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(o){}}function DQ(e,t,n,i){t[0].type!==qo&&N("First argument to indata must be a string literal."),t[1].type!==qo&&N("Second argument to indata must be a string literal.");const r=t[0].value,a=t[1].value,o=EK+a;Q(o,i)||(i[o]=n.getData(r).indataRef(n,a))}function kn(e,t,n,i){if(t[0].type===qo)KR(n,i,t[0].value);else for(e in n.scales)KR(n,i,e)}function KR(e,t,n){const i=Dw+n;if(!Q(t,i))try{t[i]=e.scaleRef(n)}catch(r){}}function Ir(e,t){let n;return ge(e)?e:Y(e)?(n=t.scales[e])&&n.value:void 0}function RQ(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=kn,n._range=kn,n._scale=kn;const i=r=>"_["+(r.type===qo?B(Dw+r.value):B(Dw)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function Bw(e,t){return function(n,i,r){if(n){const a=Ir(n,(r||this).context);return a&&a.path[e](i)}else return t(i)}}const NQ=Bw("area",mH),FQ=Bw("bounds",wH),IQ=Bw("centroid",SH);function MQ(e){let t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function Uw(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function jQ(){return Uw(this.context.dataflow,"warn",arguments)}function LQ(){return Uw(this.context.dataflow,"info",arguments)}function PQ(){return Uw(this.context.dataflow,"debug",arguments)}function qw(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ww(e){const t=xa(e),n=qw(t.r),i=qw(t.g),r=qw(t.b);return .2126*n+.7152*i+.0722*r}function zQ(e,t){const n=Ww(e),i=Ww(t),r=Math.max(n,i),a=Math.min(n,i);return(r+.05)/(a+.05)}function BQ(){var e=[].slice.call(arguments);return e.unshift({}),fe.apply(null,e)}function QR(e,t){return e===t||e!==e&&t!==t?!0:I(e)?I(t)&&e.length===t.length?UQ(e,t):!1:K(e)&&K(t)?ZR(e,t):!1}function UQ(e,t){for(let n=0,i=e.length;n<i;++n)if(!QR(e[n],t[n]))return!1;return!0}function ZR(e,t){for(let n in e)if(!QR(e[n],t[n]))return!1;return!0}function eN(e){return t=>ZR(e,t)}function qQ(e,t,n,i,r,a){let o=this.context.dataflow,s=this.context.data[e],l=s.input,u=s.changes,c=o.stamp(),f,d;if(o._trigger===!1||!(l.value.length||t||i))return 0;if((!u||u.stamp<c)&&(s.changes=u=o.changeset(),u.stamp=c,o.runAfter(function(){s.modified=!0,o.pulse(l,u).run()},!0,1)),n&&(f=n===!0?Fi:I(n)||dd(n)?n:eN(n),u.remove(f)),t&&u.insert(t),i&&(f=eN(i),l.value.some(f)?u.remove(f):u.insert(i)),r)for(d in a)u.modify(r,d,a[d]);return 1}function WQ(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function GQ(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}function HQ(e,t,n){return zy(e||0,t||0,n||0)}function YQ(e,t){const n=Ir(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function VQ(e,t){const n=Ir(e,(t||this).context);return n?n.copy():void 0}function XQ(e,t){const n=Ir(e,(t||this).context);return n?n.domain():[]}function JQ(e,t,n){const i=Ir(e,(n||this).context);return i?I(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function KQ(e,t){const n=Ir(e,(t||this).context);return n&&n.range?n.range():[]}function QQ(e,t,n){const i=Ir(e,(n||this).context);return i?i(t):void 0}function ZQ(e,t,n,i,r){e=Ir(e,(r||this).context);const a=dS(t,n);let o=e.domain(),s=o[0],l=ve(o),u=Yt;return l-s?u=JT(e,s,l):e=(e.interpolator?Ee("sequential")().interpolator(e.interpolator()):Ee("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+i||15),s!==o[0]&&o.unshift(s),l!==ve(o)&&o.push(l)),o.forEach(c=>a.stop(u(c),e(c))),a}function eZ(e,t,n){const i=Ir(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function tZ(e){let t=null;return function(n){return n?$u(n,t=t||Hs(e)):e}}const tN=e=>e.data;function nN(e,t){const n=DR.call(t,e);return n.root&&n.root.lookup||{}}function nZ(e,t,n){const i=nN(e,this),r=i[t],a=i[n];return r&&a?r.path(a).map(tN):void 0}function iZ(e,t){const n=nN(e,this)[t];return n?n.ancestors().map(tN):void 0}const iN=()=>typeof window!="undefined"&&window||null;function rZ(){const e=iN();return e?e.screen:{}}function aZ(){const e=iN();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function oZ(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}const rN="intersect",aN="union",sZ="vlMulti",oN="or",lZ="and";var uZ="E",cZ="R",fZ="R-E",dZ="R-LE",hZ="R-RE",sN="index:unit";function lN(e,t){for(var n=t.fields,i=t.values,r=n.length,a=0,o,s;a<r;++a)if(s=n[a],s.getter=Ni.getter||Ni(s.field),o=s.getter(e),uo(o)&&(o=fn(o)),uo(i[a])&&(i[a]=fn(i[a])),uo(i[a][0])&&(i[a]=i[a].map(fn)),s.type===uZ){if(I(i[a])?i[a].indexOf(o)<0:o!==i[a])return!1}else if(s.type===cZ){if(!ou(o,i[a]))return!1}else if(s.type===hZ){if(!ou(o,i[a],!0,!1))return!1}else if(s.type===fZ){if(!ou(o,i[a],!1,!1))return!1}else if(s.type===dZ&&!ou(o,i[a],!1,!0))return!1;return!0}function pZ(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a=i?i[sN]&&i[sN].value:void 0,o=n===rN,s=r.length,l=0,u,c,f,d,h;l<s;++l)if(u=r[l],a&&o){if(c=c||{},f=c[d=u.unit]||0,f===-1)continue;if(h=lN(t,u),c[d]=h?-1:++f,h&&a.size===1)return!0;if(!h&&f===a.get(d).count)return!1}else if(h=lN(t,u),o^h)return h;return s&&o}function gZ(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a={},o={},s={},l,u,c,f,d,h,p,g,m,v=r.length,y=0,b,E;y<v;++y){for(l=r[y],f=l.unit,u=l.fields,c=l.values,b=0,E=u.length;b<E;++b)d=u[b],h=a[d.field]||(a[d.field]={}),p=h[f]||(h[f]=[]),s[d.field]=g=d.type.charAt(0),m=uN[g+"_union"],h[f]=m(p,G(c[b]));n&&(p=o[f]||(o[f]=[]),p.push(G(c).reduce((x,k,w)=>(x[u[w].field]=k,x),{})))}return t=t||aN,Object.keys(a).forEach(function(x){a[x]=Object.keys(a[x]).map(k=>a[x][k]).reduce((k,w)=>k===void 0?w:uN[s[x]+"_"+t](k,w))}),r=Object.keys(o),n&&r.length&&(a[sZ]=t===aN?{[oN]:r.reduce((x,k)=>(x.push.apply(x,o[k]),x),[])}:{[lZ]:r.map(x=>({[oN]:o[x]}))}),a}var uN={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(function(n){return t.indexOf(n)>=0}):t},R_union:function(e,t){var n=fn(t[0]),i=fn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=fn(t[0]),i=fn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const mZ=":",vZ="@";function cN(e,t,n,i){t[0].type!==qo&&N("First argument to selection functions must be a string literal.");const r=t[0].value,a=t.length>=2&&ve(t).value,o="unit",s=vZ+o,l=mZ+r;a===rN&&!Q(i,s)&&(i[s]=n.getData(r).indataRef(n,o)),Q(i,l)||(i[l]=n.getData(r).tuplesRef())}function yZ(e,t,n){if(!e)return[];const[i,r]=e,a=new st().set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return OC(o,a,bZ(t))}function bZ(e){let t=null;if(e){const n=G(e.marktype),i=G(e.markname);t=r=>(!n.length||n.some(a=>r.marktype===a))&&(!i.length||i.some(a=>r.name===a))}return t}const Uc={random:function(){return Wn()},cumulativeNormal:Id,cumulativeLogNormal:sv,cumulativeUniform:fv,densityNormal:nv,densityLogNormal:ov,densityUniform:cv,quantileNormal:Md,quantileLogNormal:lv,quantileUniform:dv,sampleNormal:Fd,sampleLogNormal:av,sampleUniform:uv,isArray:I,isBoolean:lo,isDate:uo,isDefined:function(e){return e!==void 0},isNumber:Re,isObject:K,isRegExp:D5,isString:Y,isTuple:dd,isValid:function(e){return e!=null&&e===e},toBoolean:Sk,toDate:Ok,toNumber:fn,toString:Tk,flush:$5,lerp:R5,merge:BQ,pad:M5,peek:ve,span:ud,inrange:ou,truncate:L5,rgb:xa,lab:Dh,hcl:Rh,hsl:Ch,luminance:Ww,contrast:zQ,sequence:po,format:hK,utcFormat:pK,utcParse:mK,utcOffset:O_,utcSequence:$_,timeFormat:RR,timeParse:gK,timeOffset:S_,timeSequence:C_,timeUnitSpecifier:u_,monthFormat:vK,monthAbbrevFormat:yK,dayFormat:bK,dayAbbrevFormat:wK,quarter:x5,utcquarter:E5,week:v_,utcweek:w_,dayofyear:m_,utcdayofyear:b_,warn:jQ,info:LQ,debug:PQ,extent:yr,inScope:MQ,intersect:yZ,clampRange:k5,pinchDistance:WQ,pinchAngle:GQ,screen:rZ,containerSize:oZ,windowSize:aZ,bandspace:HQ,setdata:fK,pathShape:tZ,panLinear:v5,panLog:y5,panPow:b5,panSymlog:w5,zoomLinear:bk,zoomLog:wk,zoomPow:r0,zoomSymlog:xk,encode:dK,modify:qQ},wZ=["view","item","group","xy","x","y"],xZ="event.vega.",fN="this.",Gw={};function EZ(e){const t=JR(e);wZ.forEach(n=>t[n]=xZ+n);for(let n in Uc)t[n]=fN+n;return fe(t,RQ(e,Uc,Gw)),t}function vt(e,t,n){return arguments.length===1?Uc[e]:(Uc[e]=t,n&&(Gw[e]=n),Hw&&(Hw.functions[e]=fN+e),this)}vt("bandwidth",YQ,kn),vt("copy",VQ,kn),vt("domain",XQ,kn),vt("range",KQ,kn),vt("invert",JQ,kn),vt("scale",QQ,kn),vt("gradient",ZQ,kn),vt("geoArea",NQ,kn),vt("geoBounds",FQ,kn),vt("geoCentroid",IQ,kn),vt("geoShape",eZ,kn),vt("indata",cK,DQ),vt("data",DR,zw),vt("treePath",nZ,zw),vt("treeAncestors",iZ,zw),vt("vlSelectionTest",pZ,cN),vt("vlSelectionResolve",gZ,cN);const dN={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_["+B(NR+e)+"]",functions:EZ,constants:XR,visitors:Gw};var Hw=$Q(dN);function Ki(e,t){var n={},i,r;try{e=Y(e)?e:B(e)+"",i=VR(e)}catch(a){N("Expression parse error: "+e)}return i.visit(a=>{if(a.type!==FR)return;var o=a.callee.name,s=dN.visitors[o];s&&s(o,a.arguments,t,n)}),r=Hw(i),r.globals.forEach(a=>{var o=NR+a;!Q(n,o)&&t.getSignal(a)&&(n[o]=t.signalRef(a))}),{$expr:fe({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function kZ(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const _Z=kt(["rule"]),hN=kt(["group","image","rect"]);function AZ(e,t){let n="";return _Z[t]||(e.x2&&(e.x?(hN[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(hN[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function Yw(e){return(e+"").toLowerCase()}function SZ(e){return Yw(e)==="operator"}function OZ(e){return Yw(e)==="collect"}function qc(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");var i=Function.apply(null,t.concat(n));return e&&e.functions?i.bind(e.functions):i}function TZ(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var CZ={operator:(e,t)=>qc(e,["_"],t.code),parameter:(e,t)=>qc(e,["datum","_"],t.code),event:(e,t)=>qc(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return qc(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const a in i){const o="o["+B(a)+"]";r+=`$=${i[a].code};if(${o}!==$)${o}=$,m=1;`}return r+=AZ(i,n),r+="return m;",qc(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(B).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(a,o)=>{const s=t[o];let l,u;return a.path?(l=`a${a.path}`,u=`b${a.path}`):((n=n||{})["f"+o]=a,l=`this.f${o}(a)`,u=`this.f${o}(b)`),TZ(l,u,-s,s)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function $Z(e){const t=this;SZ(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function DZ(e){const t=this;if(e.params){const n=t.get(e.id);n||N("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function RZ(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=I(r)?r.map(a=>pN(a,n,t)):pN(r,n,t)}return t}function pN(e,t,n){if(!e||!K(e))return e;for(let i=0,r=gN.length,a;i<r;++i)if(a=gN[i],Q(e,a.key))return a.parse(e,t,n);return e}var gN=[{key:"$ref",parse:NZ},{key:"$key",parse:IZ},{key:"$expr",parse:FZ},{key:"$field",parse:MZ},{key:"$encode",parse:LZ},{key:"$compare",parse:jZ},{key:"$context",parse:PZ},{key:"$subflow",parse:zZ},{key:"$tupleid",parse:BZ}];function NZ(e,t){return t.get(e.$ref)||N("Operator not defined: "+e.$ref)}function FZ(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Rn(t.parameterExpression(e.$expr),e.$fields,e.$name))}function IZ(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Ak(e.$key,e.$flat,t.expr.codegen))}function MZ(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Ni(e.$field,e.$name,t.expr.codegen))}function jZ(e,t){const n="c:"+e.$compare+"_"+e.$order,i=G(e.$compare).map(r=>r&&r.$tupleid?ee:r);return t.fn[n]||(t.fn[n]=Ek(i,e.$order,t.expr.codegen))}function LZ(e,t){const n=e.$encode,i={};for(const r in n){const a=n[r];i[r]=Rn(t.encodeExpression(a.$expr),a.$fields),i[r].output=a.$output}return i}function PZ(e,t){return t}function zZ(e,t){const n=e.$subflow;return function(i,r,a){const o=t.fork().parse(n),s=o.get(n.operators[0].id),l=o.signals.parent;return l&&l.set(a),s.detachSubflow=()=>t.detach(o),s}}function BZ(){return ee}function UZ(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(a=>t.get(a)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(a=>t.get(a)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&N("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function qZ(e){var t=this,n=K(n=e.source)?n.$ref:n,i=t.get(n),r=null,a=e.update,o=void 0;i||N("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),a&&a.$expr&&(a.$params&&(o=t.parseParameters(a.$params)),a=t.handlerExpression(a.$expr)),t.update(e,i,r,a,o)}var WZ={skip:!0};function GZ(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(a=>{var o=t.signals[a];e.signals(a,o)&&(i[a]=o.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(a=>{var o=t.data[a];e.data(a,o)&&(r[a]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(a=>a.getState(e))),n}function HZ(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(a=>{n.update(t.signals[a],r[a],WZ)}),Object.keys(i||{}).forEach(a=>{n.pulse(t.data[a].input,n.changeset().remove(Fi).insert(i[a]))}),(e.subcontext||[]).forEach((a,o)=>{var s=t.subcontext[o];s&&s.setState(a)})}function mN(e,t,n,i){return new vN(e,t,n,i)}function vN(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||CZ,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function yN(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}vN.prototype=yN.prototype={fork(){const e=new yN(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),OZ(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){var a=n.get(e.parent.$ref);a?(i.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(e.parent.$ref),i.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const s=n.data[o]||(n.data[o]={});e.data[o].forEach(l=>s[l]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Yw(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:kZ,parseOperator:$Z,parseOperatorParameters:DZ,parseParameters:RZ,parseStream:UZ,parseUpdate:qZ,getState:GZ,setState:HZ};function YZ(e,t,n){return mN(e,zs,Uc,n).parse(t)}function VZ(e){var t=this._runtime.scales;return Q(t,e)||N("Unrecognized scale or projection: "+e),t[e].value}var bN="width",wN="height",Vw="padding",xN={skip:!0};function EN(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===Vw?i.left+i.right:0)}function kN(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===Vw?i.top+i.bottom:0)}function XZ(e){var t=e._signals,n=t[bN],i=t[wN],r=t[Vw];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,function(s){e._width=s.size,e._viewWidth=EN(e,s.size),a()},{size:n}),e._resizeHeight=e.add(null,function(s){e._height=s.size,e._viewHeight=kN(e,s.size),a()},{size:i});var o=e.add(null,a,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function JZ(e,t,n,i,r,a){this.runAfter(function(o){var s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(bN,n,xN),o._resizeWidth.skip(!0)),o.height()!==i&&(s=1,o.signal(wN,i,xN),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),s&&o.run("enter"),a&&o.runAfter(l=>l.resize())},!1,1)}function KZ(e){return this._runtime.getState(e||{data:QZ,signals:ZZ,recurse:!0})}function QZ(e,t){return t.modified&&I(t.input.value)&&e.indexOf("_:vega:_")}function ZZ(e,t){return!(e==="parent"||t instanceof zs.proxy)}function eee(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function tee(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(EV(n,t))}function nee(e,t,n,i){var r=e.element();r&&r.setAttribute("title",iee(i))}function iee(e){return e==null?"":I(e)?_N(e):K(e)&&!uo(e)?ree(e):e+""}function ree(e){return Object.keys(e).map(function(t){var n=e[t];return t+": "+(I(n)?_N(n):AN(n))}).join(`
`)}function _N(e){return"["+e.map(AN).join(", ")+"]"}function AN(e){return I(e)?"[â€¦]":K(e)&&!uo(e)?"{â€¦}":e}function SN(e,t){const n=this;if(t=t||{},Ps.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const a=fe({},e.locale,t.locale);n.locale(Z_(a.number,a.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||ka.Canvas,n._scenegraph=new Ny();const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||nee,n._redraw=!0,n._handler=new Uu().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=UJ(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=YZ(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(a=>({state:null,param:fe({},a)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=EN(n,n._width),n._viewHeight=kN(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,XZ(n),DJ(n),RJ(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}var le=P(SN,Ps);le.evaluate=async function(e,t,n){if(await Ps.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,MJ(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&fd(this,n),this},le.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},le.description=function(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&ER(this._el,this._desc=t),this}return this._desc},le.container=function(){return this._el},le.scenegraph=function(){return this._scenegraph},le.origin=function(){return this._origin.slice()};function rg(e,t){return Q(e._signals,t)?e._signals[t]:N("Unrecognized signal name: "+B(t))}le.signal=function(e,t,n){var i=rg(this,e);return arguments.length===1?i.value:this.update(i,t,n)},le.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},le.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},le.padding=function(e){return arguments.length?this.signal("padding",$R(e)):$R(this.signal("padding"))},le.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},le.background=function(e){return arguments.length?this.signal("background",e):this.signal("background")},le.renderer=function(e){return arguments.length?(Gh(e)||N("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},le.tooltip=function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},le.loader=function(e){return arguments.length?(e!==this._loader&&(Ps.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},le.resize=function(){return this._autosize=1,this.touch(rg(this,"autosize"))},le._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},le._resizeView=JZ,le.addEventListener=function(e,t,n){var i=t;return n&&n.trap===!1||(i=Tw(this,t),i.raw=t),this._handler.on(e,i),this},le.removeEventListener=function(e,t){for(var n=this._handler.handlers(e),i=n.length,r,a;--i>=0;)if(a=n[i].type,r=n[i].handler,e===a&&(t===r||t===r.raw)){this._handler.off(a,r);break}return this},le.addResizeListener=function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},le.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this};function ON(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function TN(e,t,n,i){var r=ON(n,i);return r||(r=Tw(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function CN(e,t,n){var i=ON(t,n);return i&&t._targets.remove(i),e}le.addSignalListener=function(e,t){return TN(this,e,rg(this,e),t)},le.removeSignalListener=function(e,t){return CN(this,rg(this,e),t)},le.addDataListener=function(e,t){return TN(this,e,Gp(this,e).values,t)},le.removeDataListener=function(e,t){return CN(this,Gp(this,e).values,t)},le.globalCursor=function(e){if(arguments.length){if(this._globalCursor!==!!e){const t=Ow(this,null);this._globalCursor=!!e,t&&Ow(this,t)}return this}else return this._globalCursor},le.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},le.timer=tee,le.events=WJ,le.finalize=HJ,le.hover=GJ,le.data=NJ,le.change=Hp,le.insert=FJ,le.remove=IJ,le.scale=VZ,le.initialize=rK,le.toImageURL=oK,le.toCanvas=lK,le.toSVG=uK,le.getState=KZ,le.setState=eee;function aee(e){return K(e)?e:{type:e||"pad"}}const Wc=e=>+e||0,oee=e=>({top:e,bottom:e,left:e,right:e});function see(e){return K(e)?e.signal?e:{top:Wc(e.top),bottom:Wc(e.bottom),left:Wc(e.left),right:Wc(e.right)}:oee(Wc(e))}const yt=e=>K(e)&&!I(e)?fe({},e):{value:e};function $N(e,t,n,i){return n!=null?(K(n)&&!I(n)?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function Dt(e,t,n){for(const i in t)$N(e,i,t[i]);for(const i in n)$N(e,i,n[i],"update")}function Al(e,t,n){for(const i in t){if(n&&Q(n,i))continue;e[i]=fe(e[i]||{},t[i])}return e}function Sl(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var Xw="mark",Jw="frame",Kw="scope",lee="axis",uee="axis-domain",cee="axis-grid",fee="axis-label",dee="axis-tick",hee="axis-title",pee="legend",gee="legend-band",mee="legend-entry",vee="legend-gradient",DN="legend-label",yee="legend-symbol",bee="legend-title",wee="title",xee="title-text",Eee="title-subtitle";function kee(e,t,n,i,r){const a={},o={};let s,l,u,c;l="lineBreak",t==="text"&&r[l]!=null&&!Sl(l,e)&&Qw(a,l,r[l]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===Jw?r.group:n===Xw?fe({},r.mark,r[t]):null;for(l in c)u=Sl(l,e)||(l==="fill"||l==="stroke")&&(Sl("fill",e)||Sl("stroke",e)),u||Qw(a,l,c[l]);G(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)Sl(h,e)||Qw(a,h,d[h])}),e=fe({},e);for(l in a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=fe(o,e.enter),s&&(e.update=fe(s,e.update)),e}function Qw(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const RN=e=>Y(e)?B(e):e.signal?`(${e.signal})`:NN(e);function ag(e){if(e.gradient!=null)return Aee(e);let t=e.signal?`(${e.signal})`:e.color?_ee(e.color):e.field!=null?NN(e.field):e.value!==void 0?B(e.value):void 0;return e.scale!=null&&(t=See(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${sg(e.exponent)})`),e.mult!=null&&(t+=`*${sg(e.mult)}`),e.offset!=null&&(t+=`+${sg(e.offset)}`),e.round&&(t=`round(${t})`),t}const og=(e,t,n,i)=>`(${e}(${[t,n,i].map(ag).join(",")})+'')`;function _ee(e){return e.c?og("hcl",e.h,e.c,e.l):e.h||e.s?og("hsl",e.h,e.s,e.l):e.l||e.a?og("lab",e.l,e.a,e.b):e.r||e.g||e.b?og("rgb",e.r,e.g,e.b):null}function Aee(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:B(n));for(;t.length&&ve(t)==null;)t.pop();return t.unshift(RN(e.gradient)),`gradient(${t.join(",")})`}function sg(e){return K(e)?"("+ag(e)+")":e}function NN(e){return FN(K(e)?e:{datum:e})}function FN(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):N("Invalid field reference: "+B(e));return e.signal||(i=Y(i)?vr(i).map(B).join("]["):FN(i)),t+"["+i+"]"}function See(e,t){const n=RN(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band===1?"":"*"+sg(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function Oee(e){let t="";return e.forEach(n=>{const i=ag(n);t+=n.test?`(${n.test})?${i}:`:i}),ve(t)===":"&&(t+="null"),t}function IN(e,t,n,i,r,a){const o={};a=a||{},a.encoders={$encode:o},e=kee(e,t,n,i,r.config);for(const s in e)o[s]=Tee(e[s],t,a,r);return a}function Tee(e,t,n,i){const r={},a={};for(const o in e)e[o]!=null&&(r[o]=$ee(Cee(e[o]),i,n,a));return{$expr:{marktype:t,channels:r},$fields:Object.keys(a),$output:Object.keys(e)}}function Cee(e){return I(e)?Oee(e):ag(e)}function $ee(e,t,n,i){const r=Ki(e,t);return r.$fields.forEach(a=>i[a]=1),fe(n,r.$params),r.$expr}var Dee="outer",Ree=["value","update","init","react","bind"];function MN(e,t){N(e+' for "outer" push: '+B(t))}function jN(e,t){var n=e.name;if(e.push===Dee)t.signals[n]||MN("No prior signal definition",n),Ree.forEach(function(r){e[r]!==void 0&&MN("Invalid property ",r)});else{var i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Zw(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function lg(e,t,n,i){return new Zw(e,t,n,i)}function ug(e,t){return lg("operator",e,t)}function ne(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Gc(e,t){return t?{$field:e,$name:t}:{$field:e}}var ex=Gc("key");function LN(e,t){return{$compare:e,$order:t}}function Nee(e,t){var n={$key:e};return t&&(n.$flat=!0),n}var Fee="ascending",Iee="descending";function Mee(e){return K(e)?(e.order===Iee?"-":"+")+cg(e.op,e.field):""}function cg(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var tx="scope",nx="view";function bt(e){return e&&e.signal}function jee(e){return e&&e.expr}function Hc(e){if(bt(e))return!0;if(K(e)){for(var t in e)if(Hc(e[t]))return!0}return!1}function Ei(e,t){return e??t}function Yo(e){return e&&e.signal||e}var PN="timer";function Yc(e,t){var n=e.merge?Pee:e.stream?zee:e.type?Bee:N("Invalid stream specification: "+B(e));return n(e,t)}function Lee(e){return e===tx?nx:e||nx}function Pee(e,t){var n=e.merge.map(r=>Yc(r,t)),i=ix({merge:n},e,t);return t.addStream(i).id}function zee(e,t){var n=Yc(e.stream,t),i=ix({stream:n},e,t);return t.addStream(i).id}function Bee(e,t){var n,i;return e.type===PN?(n=t.event(PN,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(Lee(e.source),e.type),i=ix({stream:n},e,t),Object.keys(i).length===1?n:t.addStream(i).id}function ix(e,t,n){var i=t.between;return i&&(i.length!==2&&N('Stream "between" parameter must have 2 entries: '+B(t)),e.between=[Yc(i[0],n),Yc(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(Uee(t.marktype,t.markname,t.markrole)),t.source===tx&&i.push("inScope(event.item)"),i.length&&(e.filter=Ki("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function Uee(e,t,n){var i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}function Vo(e,t,n){return qN=t||qee,WN=n||Vee,GN(e.trim()).map(rx)}var qee="view",fg="[",dg="]",zN="{",BN="}",Wee=":",UN=",",Gee="@",Hee=">",Yee=/[[\]{}]/,qN,WN,Vee={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Xee(e){return WN[e]}function Vc(e,t,n,i,r){for(var a=0,o=e.length,s;t<o;++t){if(s=e[t],!a&&s===n)return t;r&&r.indexOf(s)>=0?--a:i&&i.indexOf(s)>=0&&++a}return t}function GN(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=Vc(e,r,UN,fg+zN,dg+BN),t.push(e.substring(n,r).trim()),n=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function rx(e){return e[0]==="["?Jee(e):Kee(e)}function Jee(e){var t=e.length,n=1,i,r;if(n=Vc(e,n,dg,fg,dg),n===t)throw"Empty between selector: "+e;if(i=GN(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==Hee)throw"Expected '>' after between selector: "+e;return i=i.map(rx),r=rx(e.slice(1).trim()),r.between?{between:i,stream:r}:(r.between=i,r)}function Kee(e){var t={source:qN},n=[],i=[0,0],r=0,a=0,o=e.length,s=0,l,u;if(e[o-1]===BN){if(s=e.lastIndexOf(zN),s>=0){try{i=Qee(e.substring(s+1,o-1))}catch(c){throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),o=e.length}else throw"Unmatched right brace: "+e;s=0}if(!o)throw e;if(e[0]===Gee&&(r=++s),l=Vc(e,s,Wee),l<o&&(n.push(e.substring(a,l).trim()),a=s=++l),s=Vc(e,s,fg),s===o)n.push(e.substring(a,o).trim());else if(n.push(e.substring(a,s).trim()),u=[],a=++s,a===o)throw"Unmatched left bracket: "+e;for(;s<o;){if(s=Vc(e,s,dg),s===o)throw"Unmatched left bracket: "+e;if(u.push(e.substring(a,s).trim()),s<o-1&&e[++s]!==fg)throw"Expected left bracket: "+e;a=++s}if(!(o=n.length)||Yee.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],r?t.markname=n[0].slice(1):Xee(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),u!=null&&(t.filter=u),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function Qee(e){var t=e.split(UN);if(!e.length||t.length>2)throw e;return t.map(function(n){var i=+n;if(i!==i)throw e;return i})}const Zee={code:"_.$value",ast:{type:"Identifier",value:"value"}};function ete(e,t,n){var i=e.events,r=e.update,a=e.encode,o=[],s={target:n};i||N("Signal update missing events specification."),Y(i)&&(i=Vo(i,t.isSubscope()?tx:nx)),i=G(i).filter(l=>l.signal||l.scale?(o.push(l),0):1),o.length>1&&(o=[nte(o)]),i.length&&o.push(i.length>1?{merge:i}:i[0]),a!=null&&(r&&N("Signal encode and update are mutually exclusive."),r="encode(item(),"+B(a)+")"),s.update=Y(r)?Ki(r,t):r.expr!=null?Ki(r.expr,t):r.value!=null?r.value:r.signal!=null?{$expr:Zee,$params:{$value:t.signalRef(r.signal)}}:N("Invalid signal update specification."),e.force&&(s.options={force:!0}),o.forEach(function(l){t.addUpdate(fe(tte(l,t),s))})}function tte(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Yc(e,t)}}function nte(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function ite(e,t){var n=t.getSignal(e.name),i=e.update;e.init&&(i?N("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=Ki(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(function(r){ete(r,t,n.id)})}const $e=e=>(t,n,i)=>lg(e,n,t||void 0,i);var HN=$e("aggregate"),rte=$e("axisticks"),YN=$e("bound"),ki=$e("collect"),VN=$e("compare"),ate=$e("datajoin"),XN=$e("encode"),ote=$e("expression"),ste=$e("facet"),lte=$e("field"),ute=$e("key"),cte=$e("legendentries"),fte=$e("load"),dte=$e("mark"),hte=$e("multiextent"),pte=$e("multivalues"),gte=$e("overlap"),mte=$e("params"),JN=$e("prefacet"),vte=$e("projection"),yte=$e("proxy"),bte=$e("relay"),KN=$e("render"),wte=$e("scale"),Xo=$e("sieve"),xte=$e("sortitems"),QN=$e("viewlayout"),Ete=$e("values"),kte=0,ZN={min:"min",max:"max",count:"sum"};function _te(e,t){var n=e.type||"linear";WT(n)||N("Unrecognized scale type: "+B(n)),t.addScale(e.name,{type:n,domain:void 0})}function Ate(e,t){var n=t.getScale(e.name).params,i;n.domain=eF(e.domain,e,t),e.range!=null&&(n.range=nF(e,t,n)),e.interpolate!=null&&Ite(e.interpolate,n),e.nice!=null&&(n.nice=Fte(e.nice)),e.bins!=null&&(n.bins=Nte(e.bins,t));for(i in e){if(Q(n,i)||i==="name")continue;n[i]=Zn(e[i],t)}}function Zn(e,t){return K(e)?e.signal?t.signalRef(e.signal):N("Unsupported object: "+B(e)):e}function hg(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Zn(n,t))}function pg(e){N("Can not find data set: "+B(e))}function eF(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&N("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(I(e)?Ste:e.fields?Tte:Ote)(e,t,n)}function Ste(e,t,n){return e.map(function(i){return Zn(i,n)})}function Ote(e,t,n){var i=n.getData(e.data);return i||pg(e.data),ll(t.type)?i.valuesRef(n,e.field,tF(e.sort,!1)):YT(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function Tte(e,t,n){var i=e.data,r=e.fields.reduce(function(a,o){return o=Y(o)?{data:i,field:o}:I(o)||o.signal?Cte(o,n):o,a.push(o),a},[]);return(ll(t.type)?$te:YT(t.type)?Dte:Rte)(e,n,r)}function Cte(e,t){var n="_:vega:_"+kte++,i=ki({});if(I(e))i.value={$ingest:e};else if(e.signal){var r="setdata("+B(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Xo({})]),{data:n,field:"data"}}function $te(e,t,n){var i=tF(e.sort,!0),r,a,o,s,l;return r=n.map(function(u){var c=t.getData(u.data);return c||pg(u.data),c.countsRef(t,u.field,i)}),a={groupby:ex,pulse:r},i&&(o=i.op||"count",l=i.field?cg(o,i.field):"count",a.ops=[ZN[o]],a.fields=[t.fieldRef(l)],a.as=[l]),o=t.add(HN(a)),s=t.add(ki({pulse:ne(o)})),l=t.add(Ete({field:ex,sort:t.sortRef(i),pulse:ne(s)})),ne(l)}function tF(e,t){return e&&(!e.field&&!e.op?K(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?N("No field provided for sort aggregate op: "+e.op):t&&e.field&&(e.op&&!ZN[e.op]&&N("Multiple domain scales can not be sorted using "+e.op))),e}function Dte(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||pg(r.data),a.domainRef(t,r.field)});return ne(t.add(pte({values:i})))}function Rte(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||pg(r.data),a.extentRef(t,r.field)});return ne(t.add(hte({extents:i})))}function Nte(e,t){return e.signal||I(e)?hg(e,t):t.objectProperty(e)}function Fte(e){return K(e)?{interval:Zn(e.interval),step:Zn(e.step)}:Zn(e)}function Ite(e,t){t.interpolate=Zn(e.type||e),e.gamma!=null&&(t.interpolateGamma=Zn(e.gamma))}function nF(e,t,n){var i=e.range,r=t.config.range;if(i.signal)return t.signalRef(i.signal);if(Y(i)){if(r&&Q(r,i))return e=fe({},e,{range:r[i]}),nF(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=ll(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:N("Unrecognized scale range value: "+B(i))}else if(i.scheme){n.scheme=I(i.scheme)?hg(i.scheme,t):Zn(i.scheme,t),i.extent&&(n.schemeExtent=hg(i.extent,t)),i.count&&(n.schemeCount=Zn(i.count,t));return}else if(i.step){n.rangeStep=Zn(i.step,t);return}else{if(ll(e.type)&&!I(i))return eF(i,e,t);I(i)||N("Unsupported range type: "+B(i))}return i.map(a=>(I(a)?hg:Zn)(a,t))}function Mte(e,t){var n=t.config.projection||{},i={};for(var r in e){if(r==="name")continue;i[r]=ax(e[r],r,t)}for(r in n)i[r]==null&&(i[r]=ax(n[r],r,t));t.addProjection(e.name,i)}function ax(e,t,n){return I(e)?e.map(function(i){return ax(i,t,n)}):K(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:N("Unsupported parameter object: "+B(e)):e}const _i="top",Ol="left",Tl="right",Oa="bottom",iF="center",jte="vertical",Lte="start",Pte="middle",zte="end",ox="index",sx="label",Bte="offset",Cl="perc",Ute="perc2",ei="value",Xc="guide-label",lx="guide-title",qte="group-title",Wte="group-subtitle",rF="symbol",gg="gradient",ux="discrete",cx="size",Gte="shape",Hte="fill",Yte="stroke",Vte="strokeWidth",Xte="strokeDash",Jte="opacity",fx=[cx,Gte,Hte,Yte,Vte,Xte,Jte],Jc={name:1,style:1,interactive:1},be={value:0},ti={value:1};var mg="group",aF="rect",dx="rule",Kte="symbol",Jo="text";function Kc(e){return e.type=mg,e.interactive=e.interactive||!1,e}function _n(e,t){const n=(i,r)=>Ei(e[i],Ei(t[i],r));return n.isVertical=i=>jte===Ei(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>Ei(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>Ei(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>Ei(e.columns,Ei(t.columns,+n.isVertical(!0))),n}function oF(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Qte(e,t,n){var i=t.config.style[n];return i&&i[e]}function vg(e,t,n){return`item.anchor === '${Lte}' ? ${e} : item.anchor === '${zte}' ? ${t} : ${n}`}const hx=vg(B(Ol),B(Tl),B(iF));function Zte(e){let t=e("tickBand"),n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},K(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function sF(e,t){return t?e?K(e)?Object.assign({},e,{offset:sF(e.offset,t)}):{value:e,offset:t}:t:e}function zn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Al(e.encode,t,Jc)):e.interactive=!1,e}function ene(e,t,n,i){var r=_n(e,n),a=r.isVertical(),o=r.gradientThickness(),s=r.gradientLength(),l,u,c,f,d,h;return a?(c=[0,1],f=[0,0],d=o,h=s):(c=[0,0],f=[1,0],d=s,h=o),l={enter:u={opacity:be,x:be,y:be,width:yt(d),height:yt(h)},update:fe({},u,{opacity:ti,fill:{gradient:t,start:c,stop:f}}),exit:{opacity:be}},Dt(l,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),zn({type:aF,role:vee,encode:l},i)}function tne(e,t,n,i,r){var a=_n(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength(),u,c,f,d,h,p,g="";return o?(f="y",h="y2",d="x",p="width",g="1-"):(f="x",h="x2",d="y",p="height"),c={opacity:be,fill:{scale:t,field:ei}},c[f]={signal:g+"datum."+Cl,mult:l},c[d]=be,c[h]={signal:g+"datum."+Ute,mult:l},c[p]=yt(s),u={enter:c,update:fe({},c,{opacity:ti}),exit:{opacity:be}},Dt(u,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),zn({type:aF,role:gee,key:ei,from:r,encode:u},i)}const nne=`datum.${Cl}<=0?"${Ol}":datum.${Cl}>=1?"${Tl}":"${iF}"`,ine=`datum.${Cl}<=0?"${Oa}":datum.${Cl}>=1?"${_i}":"${Pte}"`;function lF(e,t,n,i){var r=_n(e,t),a=r.isVertical(),o=yt(r.gradientThickness()),s=r.gradientLength(),l=r("labelOverlap"),u,c,f,d,h,p="";return u={enter:c={opacity:be},update:f={opacity:ti,text:{field:sx}},exit:{opacity:be}},Dt(u,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:Ei(e.labelLimit,t.gradientLabelLimit)}),a?(c.align={value:"left"},c.baseline=f.baseline={signal:ine},d="y",h="x",p="1-"):(c.align=f.align={signal:nne},c.baseline={value:"top"},d="x",h="y"),c[d]=f[d]={signal:p+"datum."+Cl,mult:s},c[h]=f[h]=o,o.offset=Ei(e.labelOffset,t.gradientLabelOffset)||0,l=l?{separation:r("labelSeparation"),method:l,order:"datum."+ox}:void 0,zn({type:Jo,role:DN,style:Xc,key:ei,from:i,encode:u,overlap:l},n)}function rne(e,t,n,i,r){var a=_n(e,t),o=n.entries,s=!!(o&&o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d={},h=`(${r}) ? datum.${Bte} : datum.${cx}`,p=u?yt(u):{field:cx},g=`datum.${ox}`,m=`max(1, ${r})`,v,y,b,E,x,k,w;p.mult=.5,d={enter:v={opacity:be,x:{signal:h,mult:.5,offset:c},y:p},update:y={opacity:ti,x:v.x,y:v.y},exit:{opacity:be}};var A=null,_=null;return e.fill||(A=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Dt(d,{fill:a("symbolFillColor",A),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),fx.forEach(function(O){e[O]&&(y[O]=v[O]={scale:e[O],field:ei})}),E=zn({type:Kte,role:yee,key:ei,from:f,clip:u?!0:void 0,encode:d},n.symbols),b=yt(c),b.offset=a("labelOffset"),d={enter:v={opacity:be,x:{signal:h,offset:b},y:p},update:y={opacity:ti,text:{field:sx},x:v.x,y:v.y},exit:{opacity:be}},Dt(d,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")}),x=zn({type:Jo,role:DN,style:Xc,key:ei,from:f,encode:d},n.labels),d={enter:{noBound:{value:!u},width:be,height:u?yt(u):be,opacity:be},exit:{opacity:be},update:y={opacity:ti,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(k=`ceil(item.mark.items.length / ${m})`,y.row.signal=`${g}%${k}`,y.column.signal=`floor(${g} / ${k})`,w={field:["row",g]}):(y.row.signal=`floor(${g} / ${m})`,y.column.signal=`${g} % ${m}`,w={field:g}),y.column.signal=`(${r})?${y.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:ox}},Kc({role:Kw,from:i,encode:Al(d,o,Jc),marks:[E,x],name:l,interactive:s,sort:w})}function ane(e,t){const n=_n(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const px='item.orient === "left"',gx='item.orient === "right"',yg=`(${px} || ${gx})`,one=`datum.vgrad && ${yg}`,sne=vg('"top"','"bottom"','"middle"'),lne=vg('"right"','"left"','"center"'),une=`datum.vgrad && ${gx} ? (${lne}) : (${yg} && !(datum.vgrad && ${px})) ? "left" : ${hx}`,cne=`item._anchor || (${yg} ? "middle" : "start")`,fne=`${one} ? (${px} ? -90 : 90) : 0`,dne=`${yg} ? (datum.vgrad ? (${gx} ? "bottom" : "top") : ${sne}) : "top"`;function hne(e,t,n,i){var r=_n(e,t),a;return a={enter:{opacity:be},update:{opacity:ti,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:be}},Dt(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:cne},angle:{signal:fne},align:{signal:une},baseline:{signal:dne},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),zn({type:Jo,role:bee,style:lx,from:i,encode:a},n)}function pne(e,t){var n;return K(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+uF(e.path)+")":e.sphere&&(n="geoShape("+uF(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function uF(e){return K(e)&&e.signal?e.signal:B(e)}function cF(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===mg?Kw:t||Xw}function gne(e){return{marktype:e.type,name:e.name||void 0,role:e.role||cF(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function mne(e,t){return e&&e.signal?t.signalRef(e.signal):!(e===!1)}function mx(e,t){var n=lA(e.type);n||N("Unrecognized transform type: "+B(e.type));var i=lg(n.type.toLowerCase(),null,fF(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function fF(e,t,n){var i={},r,a,o;for(a=0,o=e.params.length;a<o;++a)r=e.params[a],i[r.name]=vne(r,t,n);return i}function vne(e,t,n){var i=e.type,r=t[e.name];if(i==="index")return yne(e,t,n);if(r===void 0){e.required&&N("Missing required "+B(t.type)+" parameter: "+B(e.name));return}else{if(i==="param")return bne(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!bt(r)?r.map(function(a){return dF(e,a,n)}):dF(e,r,n)}function dF(e,t,n){var i=e.type;if(bt(t))return pF(i)?N("Expression references can not be signals."):vx(i)?n.fieldRef(t):gF(i)?n.compareRef(t):n.signalRef(t.signal);var r=e.expr||vx(i);return r&&wne(t)?n.exprRef(t.expr,t.as):r&&xne(t)?Gc(t.field,t.as):pF(i)?Ki(t,n):Ene(i)?ne(n.getData(t).values):vx(i)?Gc(t):gF(i)?n.compareRef(t):t}function yne(e,t,n){return Y(t.from)||N('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function bne(e,t,n){var i=t[e.name];return e.array?(I(i)||N("Expected an array of sub-parameters. Instead: "+B(i)),i.map(function(r){return hF(e,r,n)})):hF(e,i,n)}function hF(e,t,n){var i,r,a,o,s;for(o=0,s=e.params.length;o<s;++o){r=e.params[o];for(a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}return r||N("Unsupported parameter: "+B(t)),i=fe(fF(r,t,n),r.key),ne(n.add(mte(i)))}function wne(e){return e&&e.expr}function xne(e){return e&&e.field}function Ene(e){return e==="data"}function pF(e){return e==="expr"}function vx(e){return e==="field"}function gF(e){return e==="compare"}function kne(e,t,n){var i,r,a,o,s;return e?(i=e.facet)&&(t||N("Only group marks can be faceted."),i.field!=null?o=s=bg(i,n):(e.data?s=ne(n.getData(e.data).aggregate):(a=mx(fe({type:"aggregate",groupby:G(i.groupby)},i.aggregate),n),a.params.key=n.keyRef(i.groupby),a.params.pulse=bg(i,n),o=s=ne(n.add(a))),r=n.keyRef(i.groupby,!0))):o=ne(n.add(ki(null,[{}]))),o||(o=bg(e,n)),{key:r,pulse:o,parent:s}}function bg(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ne(t.getData(e.data).output)}function Ko(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Ko.fromEntries=function(e,t){var n=t.length,i=1,r=t[0],a=t[n-1],o=t[n-2],s=null;for(r&&r.type==="load"&&(r=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=ne(t[i-1]),e.add(t[i]),t[i].type==="aggregate"&&(s=t[i]);return new Ko(e,r,o,a,s)};var Qo=Ko.prototype;Qo.countsRef=function(e,t,n){var i=this,r=i.counts||(i.counts={}),a=mF(t),o,s,l;return a!=null&&(e=i.scope,o=r[a]),o?n&&n.field&&vF(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:ne(i.output)},n&&n.field&&vF(e,l,n),s=e.add(HN(l)),o=e.add(ki({pulse:ne(s)})),o={agg:s,ref:ne(o)},a!=null&&(r[a]=o)),o.ref};function mF(e){return Y(e)?e:null}function vF(e,t,n){var i=cg(n.op,n.field),r;if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Qc(e,t,n,i,r,a,o){var s=t[n]||(t[n]={}),l=Mee(a),u=mF(r),c,f;if(u!=null&&(e=t.scope,u=u+(l?"|"+l:""),c=s[u]),!c){var d=a?{field:ex,pulse:t.countsRef(e,r,a)}:{field:e.fieldRef(r),pulse:ne(t.output)};l&&(d.sort=e.sortRef(a)),f=e.add(lg(i,void 0,d)),o&&(t.index[r]=f),c=ne(f),u!=null&&(s[u]=c)}return c}Qo.tuplesRef=function(){return ne(this.values)},Qo.extentRef=function(e,t){return Qc(e,this,"extent","extent",t,!1)},Qo.domainRef=function(e,t){return Qc(e,this,"domain","values",t,!1)},Qo.valuesRef=function(e,t,n){return Qc(e,this,"vals","values",t,n||!0)},Qo.lookupRef=function(e,t){return Qc(e,this,"lookup","tupleindex",t,!1)},Qo.indataRef=function(e,t){return Qc(e,this,"indata","tupleindex",t,!0,!0)};function _ne(e,t,n){var i=e.from.facet,r=i.name,a=bg(i,t),o,s,l,u;i.name||N("Facet must have a name: "+B(i)),i.data||N("Facet must reference a data set: "+B(i)),i.field?u=t.add(JN({field:t.fieldRef(i.field),pulse:a})):i.groupby?u=t.add(ste({key:t.keyRef(i.groupby),group:ne(t.proxy(n.parent)),pulse:a})):N("Facet must specify groupby or field: "+B(i)),o=t.fork(),s=o.add(ki()),l=o.add(Xo({pulse:ne(s)})),o.addData(r,new Ko(o,s,s,l)),o.addSignal("parent",null),u.params.subflow={$subflow:o.parse(e).toRuntime()}}function Ane(e,t,n){var i=t.add(JN({pulse:n.pulse})),r=t.fork();r.add(Xo()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function yF(e,t,n){var i=e.remove,r=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(ug()),u,c;u="if("+e.trigger+',modify("'+n+'",'+[r,i,a,o,s].map(function(f){return f??"null"}).join(",")+"),0)",c=Ki(u,t),l.update=c.$expr,l.params=c.$params}function wg(e,t){var n=cF(e),i=e.type===mg,r=e.from&&e.from.facet,a=e.layout||n===Kw||n===Jw,o=n===Xw||a||r,s=e.overlap,l,u,c,f,d,h,p,g,m,v,y,b,E,x;c=kne(e.from,i,t),u=t.add(ate({key:c.key||(e.key?Gc(e.key):void 0),pulse:c.pulse,clean:!i})),v=ne(u),u=f=t.add(ki({pulse:v})),u=t.add(dte({markdef:gne(e),interactive:mne(e.interactive,t),clip:pne(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ne(u)})),y=ne(u),u=d=t.add(XN(IN(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(function(k){const w=mx(k,t),A=w.metadata;(A.generates||A.changes)&&N("Mark transforms should not generate new data."),A.nomod||(d.params.mod=!0),w.params.pulse=ne(u),t.add(u=w)}),e.sort&&(u=t.add(xte({sort:t.compareRef(e.sort),pulse:ne(u)}))),b=ne(u),(r||a)&&(a=t.add(QN({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),E=ne(a)),h=t.add(YN({mark:y,pulse:E||b})),x=ne(h),i&&(o&&(l=t.operators,l.pop(),a&&l.pop()),t.pushState(b,E||x,v),r?_ne(e,t,c):o?Ane(e,t,c):t.parse(e),t.popState(),o&&(a&&l.push(a),l.push(h))),s&&(x=Sne(s,x,t)),p=t.add(KN({pulse:x})),g=t.add(Xo({pulse:ne(p)},void 0,t.parent())),e.name!=null&&(m=e.name,t.addData(m,new Ko(t,f,p,g)),e.on&&e.on.forEach(function(k){(k.insert||k.remove||k.toggle)&&N("Marks only support modify triggers."),yF(k,t,m)}))}function Sne(e,t,n){var i=e.method,r=e.bound,a=e.separation,o,s={separation:bt(a)?n.signalRef(a.signal):a,method:bt(i)?n.signalRef(i.signal):i,pulse:t};return e.order&&(s.sort=n.compareRef({field:e.order})),r&&(o=r.tolerance,s.boundTolerance=bt(o)?n.signalRef(o.signal):+o,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient),ne(n.add(gte(s)))}function One(e,t){var n=t.config.legend,i=e.encode||{},r=i.legend||{},a=r.name||void 0,o=r.interactive,s=r.style,l=_n(e,n),u={},c=0,f,d,h,p,g,m,v,y;return fx.forEach(b=>e[b]?(u[b]=e[b],c=c||e[b]):0),c||N("Missing valid scale for legend."),g=Tne(e,t.scaleType(c)),m={title:e.title!=null,scales:u,type:g,vgrad:g!=="symbol"&&l.isVertical()},v=ne(t.add(ki(null,[m]))),r=Al($ne(l,e,n),r,Jc),f={enter:{x:{value:0},y:{value:0}}},y=ne(t.add(cte(h={type:g,scale:t.scaleRef(c),count:t.objectProperty(l("tickCount")),limit:t.property(l("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),g===gg?(p=[ene(e,c,n,i.gradient),lF(e,n,i.labels,y)],h.count=h.count||t.signalRef(`max(2,2*floor((${Yo(l.gradientLength())})/100))`)):g===ux?p=[tne(e,c,n,i.gradient,y),lF(e,n,i.labels,y)]:(d=ane(e,n),p=[rne(e,n,i,y,Yo(d.columns))],h.size=Dne(e,t,p[0].marks)),p=[Kc({role:mee,from:v,encode:f,marks:p,layout:d,interactive:o})],m.title&&p.push(hne(e,n,i.title,v)),wg(Kc({role:pee,from:v,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function Tne(e,t){var n=e.type||rF;return!e.type&&Cne(e)===1&&(e.fill||e.stroke)&&(n=kb(t)?gg:_b(t)?ux:rF),n!==gg?n:_b(t)?ux:gg}function Cne(e){return fx.reduce(function(t,n){return t+(e[n]?1:0)},0)}function $ne(e,t,n){var i={enter:{},update:{}};return Dt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Dne(e,t,n){var i=Yo(bF("size",e,n)),r=Yo(bF("strokeWidth",e,n)),a=Yo(Rne(n[1].encode,t,Xc));return Ki(`max(ceil(sqrt(${i})+${r}),${a})`,t)}function bF(e,t,n){return t[e]?`scale("${t[e]}",datum)`:oF(e,n[0].encode)}function Rne(e,t,n){return oF("fontSize",e)||Qte("fontSize",t,n)}const Nne=`item.orient==="${Ol}"?-90:item.orient==="${Tl}"?90:0`;function Fne(e,t){e=Y(e)?{text:e}:e;var n=_n(e,t.config.title),i=e.encode||{},r=i.group||{},a=r.name||void 0,o=r.interactive,s=r.style,l=[],u,c;return u={},c=ne(t.add(ki(null,[u]))),l.push(jne(e,n,Ine(e),c)),e.subtitle&&l.push(Lne(e,n,i.subtitle,c)),wg(Kc({role:wee,from:c,encode:Mne(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function Ine(e){const t=e.encode;return t&&t.title||fe({name:e.name,interactive:e.interactive,style:e.style},t)}function Mne(e,t){var n={enter:{},update:{}};return Dt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:hx},angle:{signal:Nne},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Al(n,t,Jc)}function jne(e,t,n,i){var r={value:0},a=e.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Dt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:Jo,role:xee,style:qte,from:i,encode:o},n)}function Lne(e,t,n,i){var r={value:0},a=e.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Dt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:Jo,role:Eee,style:Wte,from:i,encode:o},n)}function Pne(e,t){var n=[];e.transform&&e.transform.forEach(function(i){n.push(mx(i,t))}),e.on&&e.on.forEach(function(i){yF(i,t,e.name)}),t.addDataPipeline(e.name,zne(e,t,n))}function zne(e,t,n){var i=[],r=null,a=!1,o=!1,s,l,u,c,f;for(e.values?Hc(e.values)||Hc(e.format)?(i.push(wF(t,e)),i.push(r=Zo())):i.push(r=Zo({$ingest:e.values,$format:e.format})):e.url?Hc(e.url)||Hc(e.format)?(i.push(wF(t,e)),i.push(r=Zo())):i.push(r=Zo({$request:e.url,$format:e.format})):e.source&&(r=s=G(e.source).map(function(d){return ne(t.getData(d).output)}),i.push(null)),l=0,u=n.length;l<u;++l)c=n[l],f=c.metadata,!r&&!f.source&&i.push(r=Zo()),i.push(c),f.generates&&(o=!0),f.modifies&&!o&&(a=!0),f.source?r=c:f.changes&&(r=null);return s&&(u=s.length-1,i[0]=bte({derive:a,pulse:u?s:s[0]}),(a||u)&&i.splice(1,0,Zo())),r||i.push(Zo()),i.push(Xo({})),i}function Zo(e){var t=ki({},e);return t.metadata={source:!0},t}function wF(e,t){return fte({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const xF=e=>e===Oa||e===_i,xg=(e,t,n)=>bt(e)?Wne(e.signal,t,n):e===Ol||e===_i?t:n,wt=(e,t,n)=>bt(e)?Une(e.signal,t,n):xF(e)?t:n,Ai=(e,t,n)=>bt(e)?qne(e.signal,t,n):xF(e)?n:t,EF=(e,t,n)=>bt(e)?Gne(e.signal,t,n):e===_i?{value:t}:{value:n},Bne=(e,t,n)=>bt(e)?Hne(e.signal,t,n):e===Tl?{value:t}:{value:n},Une=(e,t,n)=>kF(`${e} === '${_i}' || ${e} === '${Oa}'`,t,n),qne=(e,t,n)=>kF(`${e} !== '${_i}' && ${e} !== '${Oa}'`,t,n),Wne=(e,t,n)=>yx(`${e} === '${Ol}' || ${e} === '${_i}'`,t,n),Gne=(e,t,n)=>yx(`${e} === '${_i}'`,t,n),Hne=(e,t,n)=>yx(`${e} === '${Tl}'`,t,n),kF=(e,t,n)=>(t=t!=null?yt(t):t,n=n!=null?yt(n):n,_F(t)&&_F(n)?(t=t?t.signal||B(t.value):null,n=n?n.signal||B(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[fe({test:e},t)].concat(n||[])),_F=e=>e==null||Object.keys(e).length===1,yx=(e,t,n)=>({signal:`${e} ? (${$l(t)}) : (${$l(n)})`}),Yne=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${Ol}' ? (${$l(i)}) : `:"")+(n!=null?`${e} === '${Oa}' ? (${$l(n)}) : `:"")+(r!=null?`${e} === '${Tl}' ? (${$l(r)}) : `:"")+(t!=null?`${e} === '${_i}' ? (${$l(t)}) : `:"")+"(null)"}),$l=e=>bt(e)?e.signal:e==null?null:B(e),Vne=(e,t)=>t===0?0:bt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Dl=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Rl(e,t,n,i){let r;if(t&&Q(t,e))return t[e];if(Q(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[lx][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Xc][r]}return null}function AF(e){const t={};for(const n of e){if(!n)continue;for(const i in n)t[i]=1}return Object.keys(t)}function Xne(e,t){var n=t.config,i=n.style,r=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,s,l,u;if(bt(o)){const f=AF([n.axisX,n.axisY]),d=AF([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(u of f)s[u]=wt(o,Rl(u,n.axisX,r,i),Rl(u,n.axisY,r,i));l={};for(u of d)l[u]=Yne(o.signal,Rl(u,n.axisTop,r,i),Rl(u,n.axisBottom,r,i),Rl(u,n.axisLeft,r,i),Rl(u,n.axisRight,r,i))}else s=o===_i||o===Oa?n.axisX:n.axisY,l=n["axis"+o[0].toUpperCase()+o.slice(1)];var c=s||l||a?fe({},r,s,l,a):r;return c}function Jne(e,t,n,i){var r=_n(e,t),a=e.orient,o,s,l;o={enter:s={opacity:be},update:l={opacity:ti},exit:{opacity:be}},Dt(o,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const u=SF(e,0),c=SF(e,1);return s.x=l.x=wt(a,u,be),s.x2=l.x2=wt(a,c),s.y=l.y=Ai(a,u,be),s.y2=l.y2=Ai(a,c),zn({type:dx,role:uee,from:i,encode:o},n)}function SF(e,t){return{scale:e.scale,range:t}}function Kne(e,t,n,i,r){var a=_n(e,t),o=e.orient,s=e.gridScale,l=xg(o,1,-1),u=Qne(e.offset,l),c,f,d,h,p,g,m,v;return c={enter:f={opacity:be},update:h={opacity:ti},exit:d={opacity:be}},Dt(c,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")}),p={scale:e.scale,field:ei,band:r.band,extra:r.extra,offset:r.offset,round:a("tickRound")},v=wt(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},m=s?{scale:s,range:1,mult:l,offset:u}:fe(v,{mult:l,offset:u}),f.x=h.x=wt(o,p,g),f.y=h.y=Ai(o,p,g),f.x2=h.x2=Ai(o,m),f.y2=h.y2=wt(o,m),d.x=wt(o,p),d.y=Ai(o,p),zn({type:dx,role:cee,key:ei,from:i,encode:c},n)}function Qne(e,t){if(!(t===1))if(!K(e))e=bt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=fe({},e);for(;n.mult!=null;)if(K(n.mult))n=n.mult=fe({},n.mult);else return n.mult=bt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function Zne(e,t,n,i,r,a){var o=_n(e,t),s=e.orient,l=xg(s,-1,1),u,c,f,d,h,p;return u={enter:c={opacity:be},update:d={opacity:ti},exit:f={opacity:be}},Dt(u,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")}),h=yt(r),h.mult=l,p={scale:e.scale,field:ei,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")},d.y=c.y=wt(s,be,p),d.y2=c.y2=wt(s,h),f.x=wt(s,p),d.x=c.x=Ai(s,be,p),d.x2=c.x2=Ai(s,h),f.y=Ai(s,p),zn({type:dx,role:dee,key:ei,from:i,encode:u},n)}function bx(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function eie(e,t,n,i,r,a){var o=_n(e,t),s=e.orient,l=e.scale,u=xg(s,-1,1),c=Yo(o("labelFlush")),f=Yo(o("labelFlushOffset")),d=c===0||!!c,h=o("labelAlign"),p=o("labelBaseline"),g,m,v,y,b,E,x,k,w,A;return y=yt(r),y.mult=u,y.offset=yt(o("labelPadding")||0),y.offset.mult=u,b={scale:l,field:ei,band:.5,offset:sF(a.offset,o("labelOffset"))},E=wt(s,d?bx(l,c,'"left"','"right"','"center"'):{value:"center"},Bne(s,"left","right")),x=wt(s,EF(s,"bottom","top"),d?bx(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),A=bx(l,c,`-(${f})`,f,0),d=d&&f,m={opacity:be,x:wt(s,b,y),y:Ai(s,b,y)},g={enter:m,update:v={opacity:ti,text:{field:sx},x:m.x,y:m.y,align:E,baseline:x},exit:{opacity:be,x:m.x,y:m.y}},Dt(g,{dx:!h&&d?wt(s,A):null,dy:!p&&d?Ai(s,A):null}),Dt(g,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:p}),k=o("labelBound"),w=o("labelOverlap"),w=w||k?{separation:o("labelSeparation"),method:w,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,v.align!==E&&(v.align=Dl(v.align,E)),v.baseline!==x&&(v.baseline=Dl(v.baseline,x)),zn({type:Jo,role:fee,style:Xc,key:ei,from:i,encode:g,overlap:w},n)}function tie(e,t,n,i){var r=_n(e,t),a=e.orient,o=xg(a,-1,1),s,l,u,c;return s={enter:l={opacity:be,anchor:yt(r("titleAnchor",null)),align:{signal:hx}},update:u=fe({},l,{opacity:ti,text:yt(e.title)}),exit:{opacity:be}},c={signal:`lerp(range("${e.scale}"), ${vg(0,1,.5)})`},u.x=wt(a,c),u.y=Ai(a,c),l.angle=wt(a,be,Vne(o,90)),l.baseline=wt(a,EF(a,Oa,_i),{value:Oa}),u.angle=l.angle,u.baseline=l.baseline,Dt(s,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),nie(r,a,s,n),s.update.align=Dl(s.update.align,l.align),s.update.angle=Dl(s.update.angle,l.angle),s.update.baseline=Dl(s.update.baseline,l.baseline),zn({type:Jo,role:hee,style:lx,from:i,encode:s},n)}function nie(e,t,n,i){const r=(s,l)=>s!=null?(n.update[l]=Dl(yt(s),n.update[l]),!1):!Sl(l,i),a=r(e("titleX"),"x"),o=r(e("titleY"),"y");n.enter.auto=o===a?yt(o):wt(t,yt(o),yt(a))}function iie(e,t){var n=Xne(e,t),i=e.encode||{},r=i.axis||{},a=r.name||void 0,o=r.interactive,s=r.style,l=_n(e,n),u=Zte(l),c,f,d,h,p;return c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:e.title!=null},f=ne(t.add(ki({},[c]))),r=Al(rie(l,e),r,Jc),d=ne(t.add(rte({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),p=[],c.grid&&p.push(Kne(e,n,i.grid,d,u)),c.ticks&&(h=l("tickSize"),p.push(Zne(e,n,i.ticks,d,h,u))),c.labels&&(h=c.ticks?h:0,p.push(eie(e,n,i.labels,d,h,u))),c.domain&&p.push(Jne(e,n,i.domain,f)),c.title&&p.push(tie(e,n,i.title,f)),wg(Kc({role:lee,from:f,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function rie(e,t){var n={enter:{},update:{}};return Dt(n,{orient:e("orient"),offset:e("offset")||0,position:Ei(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function OF(e,t,n){var i=G(e.signals),r=G(e.scales);return n||i.forEach(a=>jN(a,t)),G(e.projections).forEach(a=>Mte(a,t)),r.forEach(a=>_te(a,t)),G(e.data).forEach(a=>Pne(a,t)),r.forEach(a=>Ate(a,t)),(n||i).forEach(a=>ite(a,t)),G(e.axes).forEach(a=>iie(a,t)),G(e.marks).forEach(a=>wg(a,t)),G(e.legends).forEach(a=>One(a,t)),e.title&&Fne(e.title,t),t.parseLambdas(),t}const aie=e=>Al({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function oie(e,t){const n=t.config,i=ne(t.root=t.add(ug())),r=sie(e,n);r.forEach(u=>jN(u,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(ki()),o=t.add(XN(IN(aie(e.encode),mg,Jw,e.style,t,{pulse:ne(a)}))),s=t.add(QN({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:ne(o)}));t.operators.pop(),t.pushState(ne(o),ne(s),null),OF(e,t,r),t.operators.push(s);let l=t.add(YN({mark:i,pulse:ne(s)}));return l=t.add(KN({pulse:ne(l)})),l=t.add(Xo({pulse:ne(l)})),t.addData("root",new Ko(t,a,a,l)),t}function Zc(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function sie(e,t){const n=o=>Ei(e[o],t[o]),i=[Zc("background",n("background")),Zc("autosize",aee(n("autosize"))),Zc("padding",see(n("padding"))),Zc("width",n("width")||0),Zc("height",n("height")||0)],r=i.reduce((o,s)=>(o[s.name]=s,o),{}),a={};return G(e.signals).forEach(o=>{Q(r,o.name)?o=fe(r[o.name],o):i.push(o),a[o.name]=o}),G(t.signals).forEach(o=>{!Q(a,o.name)&&!Q(r,o.name)&&i.push(o)}),i}function TF(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function CF(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var ce=TF.prototype=CF.prototype;ce.parse=function(e){return OF(e,this)},ce.fork=function(){return new CF(this)},ce.isSubscope=function(){return this._subid>0},ce.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},ce.id=function(){return(this._subid?this._subid+":":0)+this._id++},ce.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},ce.proxy=function(e){var t=e instanceof Zw?ne(e):e;return this.add(yte({value:t}))},ce.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},ce.addUpdate=function(e){return this.updates.push(e),e},ce.finish=function(){var e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,a,o){var s,l;r&&(s=r.data||(r.data={}),l=s[a]||(s[a]=[]),l.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(var i in t.index)n(t.index[i],e,"index:"+i)}return this},ce.pushState=function(e,t,n){this._encode.push(ne(this.add(Xo({pulse:e})))),this._parent.push(t),this._lookup.push(n?ne(this.proxy(n)):null),this._markpath.push(-1)},ce.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},ce.parent=function(){return ve(this._parent)},ce.encode=function(){return ve(this._encode)},ce.lookup=function(){return ve(this._lookup)},ce.markpath=function(){var e=this._markpath;return++e[e.length-1]},ce.fieldRef=function(e,t){if(Y(e))return Gc(e,t);e.signal||N("Unsupported field reference: "+B(e));var n=e.signal,i=this.field[n],r;return i||(r={name:this.signalRef(n)},t&&(r.as=t),this.field[n]=i=ne(this.add(lte(r)))),i},ce.compareRef=function(e){function t(o){return bt(o)?(i=!0,n.signalRef(o.signal)):jee(o)?(i=!0,n.exprRef(o.expr)):o}var n=this,i=!1,r=G(e.field).map(t),a=G(e.order).map(t);return i?ne(this.add(VN({fields:r,orders:a}))):LN(r,a)},ce.keyRef=function(e,t){function n(a){return bt(a)?(r=!0,ne(i[a.signal])):a}var i=this.signals,r=!1;return e=G(e).map(n),r?ne(this.add(ute({fields:e,flat:t}))):Nee(e,t)},ce.sortRef=function(e){if(!e)return e;var t=cg(e.op,e.field),n=e.order||Fee;return n.signal?ne(this.add(VN({fields:t,orders:this.signalRef(n.signal)}))):LN(t,n)},ce.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},ce.hasOwnSignal=function(e){return Q(this.signals,e)},ce.addSignal=function(e,t){this.hasOwnSignal(e)&&N("Duplicate signal name: "+B(e));var n=t instanceof Zw?t:this.add(ug(t));return this.signals[e]=n},ce.getSignal=function(e){return this.signals[e]||N("Unrecognized signal name: "+B(e)),this.signals[e]},ce.signalRef=function(e){return this.signals[e]?ne(this.signals[e]):(Q(this.lambdas,e)||(this.lambdas[e]=this.add(ug(null))),ne(this.lambdas[e]))},ce.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],r=Ki(i,this),a=this.lambdas[i];a.params=r.$params,a.update=r.$expr}},ce.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},ce.objectProperty=function(e){return!e||!K(e)?e:this.signalRef(e.signal||wx(e))};function wx(e){return(I(e)?lie:uie)(e)}function lie(e){for(var t="[",n=0,i=e.length,r;n<i;++n)r=e[n],t+=(n>0?",":"")+(K(r)?r.signal||wx(r):B(r));return t+"]"}function uie(e){var t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+B(i)+":"+(K(r)?r.signal||wx(r):B(r));return t+"}"}ce.exprRef=function(e,t){var n={expr:Ki(e,this)};return t&&(n.expr.$name=t),ne(this.add(ote(n)))},ce.addBinding=function(e,t){this.bindings||N("Nested signals do not support binding: "+B(e)),this.bindings.push(fe({signal:e},t))},ce.addScaleProj=function(e,t){Q(this.scales,e)&&N("Duplicate scale or projection name: "+B(e)),this.scales[e]=this.add(t)},ce.addScale=function(e,t){this.addScaleProj(e,wte(t))},ce.addProjection=function(e,t){this.addScaleProj(e,vte(t))},ce.getScale=function(e){return this.scales[e]||N("Unrecognized scale name: "+B(e)),this.scales[e]},ce.projectionRef=ce.scaleRef=function(e){return ne(this.getScale(e))},ce.projectionType=ce.scaleType=function(e){return this.getScale(e).params.type},ce.addData=function(e,t){return Q(this.data,e)&&N("Duplicate data set name: "+B(e)),this.data[e]=t},ce.getData=function(e){return this.data[e]||N("Undefined data set name: "+B(e)),this.data[e]},ce.addDataPipeline=function(e,t){return Q(this.data,e)&&N("Duplicate data set name: "+B(e)),this.addData(e,Ko.fromEntries(this,t))};function cie(){const e="sans-serif",t=30,n=2,i="#4c78a8",r="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:n},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:n},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:a,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:a,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function fie(e,t,n){return K(e)||N("Input Vega specification must be an object."),t=ru(cie(),t,e.config),oie(e,new TF(t,n)).toRuntime()}ak(zs,V9,uG,JG,HY,jV,BX,GX,uJ,wJ,TJ);var die=Object.freeze({__proto__:null,version:CJ,Dataflow:Ps,EventStream:gd,Parameters:pd,Pulse:sa,MultiPulse:V0,Operator:Ne,Transform:$,changeset:ho,ingest:ke,isTuple:dd,definition:lA,transform:uA,transforms:zs,tupleid:ee,scale:Ee,scheme:Sb,interpolate:Ab,interpolateColors:Bh,interpolateRange:VT,quantizeInterpolator:XT,projection:I1,View:SN,formatLocale:_d,timeFormatLocale:wu,locale:Z_,defaultLocale:H0,resetDefaultLocale:Z4,expressionFunction:vt,parse:fie,runtimeContext:mN,bandwidthNRD:tv,bin:gA,bootstrapCI:mA,dotbin:vA,quantiles:Z0,quartiles:ev,get random(){return Wn},setRandom:F8,randomLCG:M8,randomInteger:j8,randomKDE:rv,randomLogNormal:bA,sampleLogNormal:av,densityLogNormal:ov,cumulativeLogNormal:sv,quantileLogNormal:lv,randomMixture:wA,randomNormal:iv,sampleNormal:Fd,densityNormal:nv,cumulativeNormal:Id,quantileNormal:Md,randomUniform:xA,sampleUniform:uv,densityUniform:cv,cumulativeUniform:fv,quantileUniform:dv,regressionLinear:hv,regressionLog:EA,regressionExp:kA,regressionPow:_A,regressionQuad:pv,regressionPoly:AA,regressionLoess:TA,sampleCurve:Ld,TIME_UNITS:k0,YEAR:_t,QUARTER:hn,MONTH:Ft,WEEK:ot,DATE:pn,DAY:It,DAYOFYEAR:Ii,HOURS:Nn,MINUTES:Fn,SECONDS:qn,MILLISECONDS:fi,timeUnitSpecifier:u_,timeUnits:A0,dayofyear:m_,week:v_,utcdayofyear:b_,utcweek:w_,timeFloor:k_,utcFloor:__,timeInterval:Fs,timeOffset:S_,timeSequence:C_,utcInterval:Is,utcOffset:O_,utcSequence:$_,timeBin:I_,accessor:mr,accessorName:hz,accessorFields:HE,id:mz,identity:e0,zero:vz,one:yz,truthy:bz,falsy:wz,logger:xz,None:VE,Error:XE,Warn:JE,Info:KE,Debug:QE,mergeConfig:Ez,writeConfig:Kf,panLinear:_z,panLog:Az,panPow:Sz,panSymlog:Oz,zoomLinear:Tz,zoomLog:Cz,zoomPow:$z,zoomSymlog:Dz,quarter:Rz,utcquarter:Nz,array:eu,clampRange:Fz,compare:Mz,constant:zz,debounce:Bz,error:Yf,extend:ak,extent:Uz,extentIndex:qz,fastmap:Gz,field:Zm,flush:Hz,hasOwnProperty:ao,inherits:Yz,inrange:Vz,isArray:Xf,isBoolean:Xz,isDate:ok,isFunction:n0,isNumber:sk,isObject:Jf,isRegExp:Jz,isString:lk,key:Kz,lerp:Qz,lruCache:e5,merge:t5,pad:n5,peek:Ts,repeat:tu,span:i5,splitAccessPath:Qm,stringValue:uk,toBoolean:r5,toDate:o5,toNumber:t0,toString:s5,toSet:l5,truncate:u5,visitArray:c5,read:eA,inferType:Ik,inferTypes:Mk,typeParsers:l0,format:vd,formats:p0,responseType:Gk,loader:Dd,Bounds:st,Gradient:dS,GroupItem:th,ResourceLoader:gy,Item:eh,Scenegraph:Ny,Handler:va,Renderer:vi,CanvasHandler:Uu,CanvasRenderer:kh,SVGHandler:Ly,SVGRenderer:Ib,SVGStringRenderer:Lb,RenderType:ka,renderModule:Gh,intersect:OC,Marks:Yn,boundClip:DC,boundContext:gn,boundStroke:kr,boundItem:Ry,boundMark:vO,pathCurves:uy,pathSymbols:zS,pathRectangle:BS,pathTrail:US,pathParse:Hs,pathRender:$u,point:mh,domCreate:ma,domFind:Fy,domChild:In,domClear:mi,openTag:We,closeTag:Ye,font:ph,fontFamily:Lu,fontSize:zi,lineHeight:pa,multiLineOffset:Cy,textMetrics:el,sceneEqual:zb,pathEqual:RC,sceneToJSON:yO,sceneFromJSON:bO,intersectPath:vy,intersectPoint:yy,intersectRule:ZS,intersectBoxLine:Xs,sceneZOrder:by,sceneVisit:gi,scenePickVisit:sh,resetSVGClipId:WS,resetSVGDefIds:RW});const hie="vega-lite",pie='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',gie="4.13.1",mie=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],vie="https://vega.github.io/vega-lite/",yie="Vega-Lite is a concise high-level language for interactive visualization.",bie="build/vega-lite.js",wie="build/vega-lite.min.js",xie="build/vega-lite.min.js",Eie="build/src/index",kie="build/src/index.d.ts",_ie={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Aie={test:"test"},Sie={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},Oie={type:"git",url:"https://github.com/vega/vega-lite.git"},Tie="BSD-3-Clause",Cie={url:"https://github.com/vega/vega-lite/issues"},$ie={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},Die={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},Rie={vega:"^5.12.1"},Nie={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1};var Fie={name:hie,author:pie,version:gie,collaborators:mie,homepage:vie,description:yie,main:bie,unpkg:wie,jsdelivr:xie,module:Eie,types:kie,bin:_ie,directories:Aie,scripts:Sie,repository:Oie,license:Tie,bugs:Cie,devDependencies:$ie,dependencies:Die,peerDependencies:Rie,jest:Nie};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Iie=Mm(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch(d){i=function(){}}var r;try{r=Set}catch(d){r=function(){}}var a;try{a=Promise}catch(d){a=function(){}}function o(d,h,p,g,m){typeof h=="object"&&(p=h.depth,g=h.prototype,m=h.includeNonEnumerable,h=h.circular);var v=[],y=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof p=="undefined"&&(p=Infinity);function E(x,k){if(x===null)return null;if(k===0)return x;var w,A;if(typeof x!="object")return x;if(n(x,i))w=new i();else if(n(x,r))w=new r();else if(n(x,a))w=new a(function(W,X){x.then(function(J){W(E(J,k-1))},function(J){X(E(J,k-1))})});else if(o.__isArray(x))w=[];else if(o.__isRegExp(x))w=new RegExp(x.source,f(x)),x.lastIndex&&(w.lastIndex=x.lastIndex);else if(o.__isDate(x))w=new Date(x.getTime());else{if(b&&Buffer.isBuffer(x))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(x.length):w=new Buffer(x.length),x.copy(w),w;n(x,Error)?w=Object.create(x):typeof g=="undefined"?(A=Object.getPrototypeOf(x),w=Object.create(A)):(w=Object.create(g),A=g)}if(h){var _=v.indexOf(x);if(_!=-1)return y[_];v.push(x),y.push(w)}n(x,i)&&x.forEach(function(W,X){var J=E(X,k-1),xe=E(W,k-1);w.set(J,xe)}),n(x,r)&&x.forEach(function(W){var X=E(W,k-1);w.add(X)});for(var O in x){var S;if(A&&(S=Object.getOwnPropertyDescriptor(A,O)),S&&S.set==null)continue;w[O]=E(x[O],k-1)}if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(x),O=0;O<T.length;O++){var D=T[O],M=Object.getOwnPropertyDescriptor(x,D);if(M&&!M.enumerable&&!m)continue;w[D]=E(x[D],k-1),M.enumerable||Object.defineProperty(w,D,{enumerable:!1})}if(m)for(var C=Object.getOwnPropertyNames(x),O=0;O<C.length;O++){var F=C[O],M=Object.getOwnPropertyDescriptor(x,F);if(M&&M.enumerable)continue;w[F]=E(x[F],k-1),Object.defineProperty(w,F,{enumerable:!1})}return w}return E(d,p)}o.clonePrototype=function(h){if(h===null)return null;var p=function(){};return p.prototype=h,new p()};function s(d){return Object.prototype.toString.call(d)}o.__objToStr=s;function l(d){return typeof d=="object"&&s(d)==="[object Date]"}o.__isDate=l;function u(d){return typeof d=="object"&&s(d)==="[object Array]"}o.__isArray=u;function c(d){return typeof d=="object"&&s(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)}),Mie=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,a;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),i=a.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;r--!==0;){var o=a[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},ef=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(a){return function(o){return function(s,l){var u={key:s,value:o[s]},c={key:l,value:o[l]};return a(u,c)}}}(t.cmp),r=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var s,l;if(Array.isArray(o)){for(l="[",s=0;s<o.length;s++)s&&(l+=","),l+=a(o[s])||"null";return l+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=r.push(o)-1,c=Object.keys(o).sort(i&&i(o));for(l="",s=0;s<c.length;s++){var f=c[s],d=a(o[f]);if(!d)continue;l&&(l+=","),l+=JSON.stringify(f)+":"+d}return r.splice(u,1),"{"+l+"}"}(e)};function xx(e){return!!e.or}function Ex(e){return!!e.and}function kx(e){return!!e.not}function Eg(e,t){if(kx(e))Eg(e.not,t);else if(Ex(e))for(const n of e.and)Eg(n,t);else if(xx(e))for(const n of e.or)Eg(n,t);else t(e)}function kg(e,t){return kx(e)?{not:kg(e.not,t)}:Ex(e)?{and:e.and.map(n=>kg(n,t))}:xx(e)?{or:e.or.map(n=>kg(n,t))}:t(e)}const tf=Mie,pe=Iie;function nf(e,t){const n={};for(const i of t)Q(e,i)&&(n[i]=e[i]);return n}function Mr(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>ef(e)).join(",")})`};const Ue=ef;function we(e){if(Re(e))return e;const t=Y(e)?e:ef(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function $F(e){return e===!1||e===null}function ae(e,t){return e.indexOf(t)>-1}function rf(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function DF(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function jie(e,...t){for(const n of t)Lie(e,n??{});return e}function Lie(e,t){for(const n of z(t))i0(e,n,t[n],!0)}function Ta(e,t){const n=[],i={};let r;for(const a of e){if(r=t(a),r in i)continue;i[r]=1,n.push(a)}return n}function Pie(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function RF(e,t){for(const n of e)if(t.has(n))return!0;return!1}function NF(e){const t=new Set();for(const n of e){const i=vr(n),r=i.map((o,s)=>s===0?o:`[${o}]`),a=r.map((o,s)=>r.slice(0,s+1).join(""));for(const o of a)t.add(o)}return t}function FF(e,t){return e===void 0||t===void 0?!0:RF(NF(e),NF(t))}function Fe(e){return z(e).length===0}const z=Object.keys,Ca=Object.values;function IF(e){const t=[];for(const n in e)Q(e,n)&&t.push({key:n,value:e[n]});return t}function _g(e){return e===!0||e===!1}function qe(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function af(e,t){return kx(e)?"!("+af(e.not,t)+")":Ex(e)?"("+e.and.map(n=>af(n,t)).join(") && (")+")":xx(e)?"("+e.or.map(n=>af(n,t)).join(") || (")+")":t(e)}function _x(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&_x(e[n],t)&&delete e[n],Fe(e)}function Ag(e){return e.charAt(0).toUpperCase()+e.substr(1)}function MF(e,t="datum"){const n=vr(e),i=[];for(let r=1;r<=n.length;r++){const a=`[${n.slice(0,r).map(B).join("][")}]`;i.push(`${t}${a}`)}return i.join(" && ")}function zie(e,t="datum"){return`${t}[${B(vr(e).join("."))}]`}function Bie(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function $a(e){return`${vr(e).map(Bie).join("\\.")}`}function Nl(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function jF(e){return`${vr(e).join(".")}`}function of(e){return e?vr(e).length:0}function rt(...e){for(const t of e)if(t!==void 0)return t;return}let Uie=42;function qie(e){const t=++Uie;return e?String(e)+t:t}function Wie(e){return Gie(e)?e:`__${e}`}function Gie(e){return e.indexOf("__")===0}function Sg(e){return e===void 0?void 0:(e%360+360)%360}function Ax(e){return Re(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const LF={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function Sx(e){return e&&e.condition}const PF=["domain","grid","labels","ticks","title"],Hie={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},zF={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Yie=Object.assign(Object.assign({},zF),{style:1,labelExpr:1,encoding:1});function BF(e){return!!Yie[e]}const rn={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},UF=rn.arc,Og=rn.area,Tg=rn.bar,Vie=rn.image,Cg=rn.line,$g=rn.point,Xie=rn.rect,Dg=rn.rule,qF=rn.text,Ox=rn.tick,Jie=rn.trail,Tx=rn.circle,Cx=rn.square,WF=rn.geoshape;function es(e){return ae(["line","area","trail"],e)}function GF(e){return ae(["rect","bar","image","arc"],e)}const HF=z(rn);function Qi(e){return e.type}const xhe=kt(HF),Kie=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Qie=["fill","fillOpacity"],Zie=[...Kie,...Qie],ere={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},YF=z(ere),tre={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},nre={color:"#4c78a8",invalid:"filter",timeUnitBand:1},ire={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},VF=5,rre={binSpacing:1,continuousBandSize:VF,timeUnitBandPosition:.5},are={binSpacing:0,continuousBandSize:VF,timeUnitBandPosition:.5},ore={thickness:1};function sre(e){return Qi(e)?e.type:e}function jr(e){return"mark"in e}class Rg{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return jr(e)?sre(e.mark)===this.name:!1}}const lre={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},ure={count:1,min:1,max:1};function Da(e){return!!e&&!!e.argmin}function ts(e){return!!e&&!!e.argmax}function $x(e){return Y(e)&&!!lre[e]}const cre=["count","valid","missing","distinct"];function XF(e){return Y(e)&&ae(cre,e)}function fre(e){return Y(e)&&ae(["min","max"],e)}const dre=["count","sum","distinct","valid","missing"],hre=["mean","average","median","q1","q3","min","max"],pre=kt(hre),Lr="row",Pr="column",Ng="facet",He="x",ct="y",Si="x2",Zi="y2",er="radius",zr="radius2",Oi="theta",Br="theta2",tr="latitude",nr="longitude",Ti="latitude2",ni="longitude2",An="color",ir="fill",rr="stroke",Sn="shape",Ur="size",ns="angle",qr="opacity",Ra="fillOpacity",Na="strokeOpacity",Fa="strokeWidth",Ia="strokeDash",sf="text",lf="order",uf="detail",Fg="key",is="tooltip",Ig="href",Mg="url",jg="description",gre={x:1,y:1,x2:1,y2:1},JF={theta:1,theta2:1,radius:1,radius2:1};function KF(e){return e in JF}const Dx={longitude:1,longitude2:1,latitude:1,latitude2:1};function mre(e){switch(e){case tr:return"y";case Ti:return"y2";case nr:return"x";case ni:return"x2"}}function vre(e){return e in Dx}const yre=z(Dx),QF=Object.assign(Object.assign(Object.assign(Object.assign({},gre),JF),Dx),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Fl(e){return e===An||e===ir||e===rr}const ZF={row:1,column:1,facet:1},ii=z(ZF),Rx=Object.assign(Object.assign({},QF),ZF),eI=z(Rx),bre=Z(Rx,["order","detail","tooltip"]),wre=Z(bre,["row","column","facet"]);function xre(e){return!!wre[e]}function tI(e){return!!Rx[e]}const Ere=[Si,Zi,Ti,ni,Br,zr];function nI(e){const t=rs(e);return t!==e}function rs(e){switch(e){case Si:return He;case Zi:return ct;case Ti:return tr;case ni:return nr;case Br:return Oi;case zr:return er}return e}function Ma(e){if(KF(e))switch(e){case Oi:return"startAngle";case Br:return"endAngle";case er:return"outerRadius";case zr:return"innerRadius"}return e}function ar(e){switch(e){case He:return Si;case ct:return Zi;case tr:return Ti;case nr:return ni;case Oi:return Br;case er:return zr}return}function or(e){switch(e){case He:case Si:return"width";case ct:case Zi:return"height"}return}function kre(e){switch(e){case He:return"xOffset";case ct:return"yOffset";case Si:return"x2Offset";case Zi:return"y2Offset";case Oi:return"thetaOffset";case er:return"radiusOffset";case Br:return"theta2Offset";case zr:return"radius2Offset"}return}const Nx=Z(QF,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),_re=z(Nx),ja={x:1,y:1},ri=z(ja);function sr(e){return e in ja}const Fx={theta:1,radius:1},Are=z(Fx);function Lg(e){return e==="width"?He:ct}const iI=Z(Nx,["text","tooltip","href","url","description","detail","key","order"]),Sre=z(iI);function Ore(e){return!!Nx[e]}function Tre(e){switch(e){case An:case ir:case rr:case Ur:case Sn:case qr:case Fa:case Ia:return!0;case Ra:case Na:case ns:return!1}}const rI=Object.assign(Object.assign(Object.assign({},ja),Fx),iI),Pg=z(rI);function La(e){return!!rI[e]}function Cre(e,t){return Dre(e)[t]}const aI={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},$re=Z(aI,["geoshape"]);function Dre(e){switch(e){case An:case ir:case rr:case jg:case uf:case Fg:case is:case Ig:case lf:case qr:case Ra:case Na:case Fa:case Ng:case Lr:case Pr:return aI;case He:case ct:case tr:case nr:return $re;case Si:case Zi:case Ti:case ni:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Ur:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Ia:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Sn:return{point:"always",geoshape:"always"};case sf:return{text:"always"};case ns:return{point:"always",square:"always",text:"always"};case Mg:return{image:"always"};case Oi:return{text:"always",arc:"always"};case er:return{text:"always",arc:"always"};case Br:case zr:return{arc:"always"}}}function zg(e){switch(e){case He:case ct:case Oi:case er:case Ur:case ns:case Fa:case qr:case Ra:case Na:case Si:case Zi:case Br:case zr:return;case Ng:case Lr:case Pr:case Sn:case Ia:case sf:case is:case Ig:case Mg:case jg:return"discrete";case An:case ir:case rr:return"flexible";case tr:case nr:case Ti:case ni:case uf:case Fg:case lf:return}}function oI(e){return lo(e)&&(e=Qg(e,void 0)),"bin"+z(e).map(t=>Bg(e[t])?qe(`_${t}_${Object.entries(e[t])}`):qe(`_${t}_${e[t]}`)).join("")}function Me(e){return e===!0||cf(e)&&!e.binned}function an(e){return e==="binned"||cf(e)&&e.binned===!0}function cf(e){return K(e)}function Bg(e){return e==null?void 0:e.selection}function sI(e){switch(e){case Lr:case Pr:case Ur:case An:case ir:case rr:case Fa:case qr:case Ra:case Na:case Sn:return 6;case Ia:return 4;default:return 10}}function Ix(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Rre='Autosize "fit" only works for single views and layered views.';function lI(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function uI(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function cI(e){return e?`Dropping "fit-${e}" because spec has discrete ${or(e)}.`:'Dropping "fit" because spec has discrete size.'}function fI(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Nre(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Fre(e){return`The "nearest" transform is not supported for ${e} marks.`}function dI(e){return`Selection not supported for ${e} yet.`}function Ire(e){return`Cannot find a selection named "${e}".`}const Mre="Scale bindings are currently only supported for scales with unbinned, continuous domains.",jre="Legend bindings are only supported for selections over an individual field or encoding channel.";function Lre(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function Pre(e){return`Unknown repeated value "${e}".`}function hI(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const zre="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Bre(e){return`Unrecognized parse "${e}".`}function pI(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function Ure(e){return`Ignoring an invalid transform: ${Ue(e)}.`}const qre='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function gI(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Wre(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function Gre(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Ue(t)} is overridden by a child projection ${Ue(n)}.`}const Hre="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Yre(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Ue(n)}}.`}function mI(e){return`Invalid field type "${e}".`}function Vre(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Xre(e){return`Invalid aggregation operator "${e}".`}function Jre(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function vI(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Mx(e,t){return`Dropping ${Ue(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Kre="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ug(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function Qre(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Zre(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function eae(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function jx(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function tae(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function nae(e,t){return`Specified orient "${e}" overridden with "${t}".`}const iae=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function rae(e){return`Cannot use the scale property "${e}" with non-color channel.`}function aae(e){return`Using unaggregated domain with raw field has no effect (${Ue(e)}).`}function oae(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function sae(e){return`Unaggregated domain is currently unsupported for log scale (${Ue(e)}).`}function lae(e){return`Cannot apply size to non-oriented mark "${e}".`}function uae(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function cae(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function yI(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function bI(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function fae(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ue(n)} and ${Ue(i)}). Using ${Ue(n)}.`}function dae(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ue(n)} and ${Ue(i)}). Using the union of the two domains.`}function hae(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function pae(e){return`Dropping sort property ${Ue(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const wI="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",gae="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",mae="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",vae="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function yae(e){return`Cannot stack "${e}" if there is already "${e}2".`}function bae(e){return`Cannot stack non-linear scale (${e}).`}function wae(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function qg(e,t){return`Invalid ${e}: ${Ue(t)}.`}function xae(e){return`Dropping day from datetime ${Ue(e)} as day cannot be combined with other units.`}function Eae(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function kae(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function _ae(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Aae(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function xI(e){return`1D error band does not support ${e}.`}function EI(e){return`Channel ${e} is required for "binned" bin.`}function Sae(e){return`Domain for ${e} is required for threshold scale.`}const kI=hk(dk);let Il=kI;function Oae(e){return Il=e,Il}function Tae(){return Il=kI,Il}function j(...e){Il.warn(...e)}function Cae(...e){Il.debug(...e)}function Ml(e){if(e&&K(e)){for(const t of Px)if(t in e)return!0}return!1}const _I=["january","february","march","april","may","june","july","august","september","october","november","december"],$ae=_I.map(e=>e.substr(0,3)),AI=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Dae=AI.map(e=>e.substr(0,3));function Rae(e){if(Ax(e)&&(e=+e),Re(e))return e>4&&j(qg("quarter",e)),e-1;throw new Error(qg("quarter",e))}function Nae(e){if(Ax(e)&&(e=+e),Re(e))return e-1;{const t=e.toLowerCase(),n=_I.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=$ae.indexOf(i);if(r!==-1)return r;throw new Error(qg("month",e))}}function Fae(e){if(Ax(e)&&(e=+e),Re(e))return e%7;{const t=e.toLowerCase(),n=AI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Dae.indexOf(i);if(r!==-1)return r;throw new Error(qg("day",e))}}function Lx(e,t){const n=[];if(t&&e.day!==void 0&&(z(e).length>1&&(j(xae(e)),e=pe(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Nae(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Rae(e.quarter):e.quarter;n.push(Re(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Fae(e.day):e.day;n.push(Re(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function ff(e){const t=Lx(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Iae(e){const t=Lx(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Mae(e){const t=Lx(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const SI={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Px=z(SI);function jae(e){return!!SI[e]}function zx(e){return e.startsWith("utc")}function Lae(e){return e.substr(3)}const Pae={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Bx(e){const t=[];for(const n of Px)OI(e,n)&&t.push(n);return t}function OI(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function zae(e,t,{end:n}={end:!1}){const i=MF(t),r=zx(e)?"utc":"";function a(l){return l==="quarter"?`(${r}quarter(${i})-1)`:`${r}${l}(${i})`}let o;const s={};for(const l of Px)OI(e,l)&&(s[l]=a(l),o=l);return n&&(s[o]+="+1"),Iae(s)}function TI(e){if(!e)return;const t=Bx(e);return`timeUnitSpecifier(${ef(t)}, ${ef(Pae)})`}function Bae(e,t,n){if(!e)return;const i=TI(e),r=n||zx(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function on(e){if(!e)return;let t;return Y(e)?t={unit:e}:K(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),zx(t.unit)&&(t.utc=!0,t.unit=Lae(t.unit)),t}function Uae(e){const t=on(e),{utc:n}=t,i=Z(t,["utc"]);return i.unit?(n?"utc":"")+z(i).map(r=>qe(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+z(i).map(r=>qe(`_${r}_${i[r]}`)).join("")}function oe(e){return e&&!!e.signal}function Pa(e){return!!e.step}function qae(e){return I(e)?!1:"fields"in e&&!("data"in e)}function Wae(e){return I(e)?!1:"fields"in e&&"data"in e}function za(e){return I(e)?!1:"field"in e&&"data"in e}const Gae={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},Hae=z(Gae),Yae={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Ux=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Vae(e){return e==null?void 0:e.selection}function qx(e){return e&&!!e.field&&e.equal!==void 0}function CI(e){return e&&!!e.field&&e.lt!==void 0}function $I(e){return e&&!!e.field&&e.lte!==void 0}function DI(e){return e&&!!e.field&&e.gt!==void 0}function RI(e){return e&&!!e.field&&e.gte!==void 0}function Wx(e){if(e&&e.field){if(I(e.range)&&e.range.length===2)return!0;if(oe(e.range))return!0}return!1}function Gx(e){return e&&!!e.field&&(I(e.oneOf)||I(e.in))}function Xae(e){return e&&!!e.field&&e.valid!==void 0}function NI(e){return Gx(e)||qx(e)||Wx(e)||CI(e)||DI(e)||$I(e)||RI(e)}function lr(e,t){return u2(e,{timeUnit:t,wrapTime:!0})}function Jae(e,t){return e.map(n=>lr(n,t))}function FI(e,t=!0){var n;const{field:i}=e,r=(n=on(e.timeUnit))===null||n===void 0?void 0:n.unit,a=r?"time("+zae(r,i)+")":U(e,{expr:"datum"});if(qx(e))return a+"==="+lr(e.equal,r);if(CI(e)){const o=e.lt;return`${a}<${lr(o,r)}`}else if(DI(e)){const o=e.gt;return`${a}>${lr(o,r)}`}else if($I(e)){const o=e.lte;return`${a}<=${lr(o,r)}`}else if(RI(e)){const o=e.gte;return`${a}>=${lr(o,r)}`}else{if(Gx(e))return`indexof([${Jae(e.oneOf,r).join(",")}], ${a}) !== -1`;if(Xae(e))return Hx(a,e.valid);if(Wx(e)){const{range:o}=e,s=oe(o)?{signal:`${o.signal}[0]`}:o[0],l=oe(o)?{signal:`${o.signal}[1]`}:o[1];if(s!==null&&l!==null&&t)return"inrange("+a+", ["+lr(s,r)+", "+lr(l,r)+"])";const u=[];return s!==null&&u.push(`${a} >= ${lr(s,r)}`),l!==null&&u.push(`${a} <= ${lr(l,r)}`),u.length>0?u.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function Hx(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Kae(e){var t;return NI(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=on(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const jl={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},as=jl.quantitative,Yx=jl.ordinal,Ll=jl.temporal,Vx=jl.nominal,Pl=jl.geojson,Qae=z(jl);function Zae(e){if(e){e=e.toLowerCase();switch(e){case"q":case as:return"quantitative";case"t":case Ll:return"temporal";case"o":case Yx:return"ordinal";case"n":case Vx:return"nominal";case Pl:return"geojson"}}return}const at={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Xx={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},eoe=z(Xx);function toe(e,t){const n=Xx[e],i=Xx[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const noe={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function II(e){return noe[e]}const MI=["linear","log","pow","sqrt","symlog","time","utc"],ioe=kt(MI),roe=["linear","log","pow","sqrt","symlog"],aoe=kt(roe);function ooe(e){return e in aoe}const soe=["quantile","quantize","threshold"],loe=kt(soe),uoe=MI.concat(["quantile","quantize","threshold","sequential","identity"]),coe=kt(uoe),foe=["ordinal","bin-ordinal","point","band"],doe=kt(foe);function On(e){return e in doe}function ai(e){return e in coe}function Ci(e){return e in ioe}function Wg(e){return e in loe}const hoe={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function poe(e){return!Y(e)&&!!e.name}function jI(e){return e==null?void 0:e.selection}function goe(e){return e&&e.unionWith}const moe={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},voe=Z(moe,["type","domain","range","scheme"]),yoe=z(voe),Ehe=boe();function LI(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!ae(["point","band","identity"],e);case"bins":return!ae(["point","band","identity","ordinal"],e);case"round":return Ci(e)||e==="band"||e==="point";case"padding":return Ci(e)||ae(["point","band"],e);case"paddingOuter":case"align":return ae(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return Ci(e);case"nice":return Ci(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ai(e)&&!ae(["log","time","utc","threshold","quantile"],e)}}function PI(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Fl(e)?void 0:rae(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function zI(e,t){return ae([Yx,Vx],t)?e===void 0||On(e):t===Ll?ae([at.TIME,at.UTC,void 0],e):t===as?ae([at.LOG,at.POW,at.SQRT,at.SYMLOG,at.QUANTILE,at.QUANTIZE,at.THRESHOLD,at.LINEAR,void 0],e):!0}function BI(e,t){if(!La(e))return!1;switch(e){case He:case ct:case Oi:case er:return Ci(t)||ae(["band","point"],t);case Ur:case Fa:case qr:case Ra:case Na:case ns:return Ci(t)||Wg(t)||ae(["band","point","ordinal"],t);case An:case ir:case rr:return t!=="band";case Ia:return t==="ordinal"||Wg(t);case Sn:return t==="ordinal"}}function boe(){var e;const t={};for(const n of eI)for(const i of Qae)for(const r of eoe){const a=woe(n,i);BI(n,r)&&zI(r,i)&&(t[a]=(e=t[a])!==null&&e!==void 0?e:[],t[a].push(r))}return t}function woe(e,t){return e+"_"+t}function Jx(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:a}=e,o=qI(e);return q(n)&&!XF(n.aggregate)&&r&&Ci(r.get("type"))&&r.get("zero")===!1?UI({fieldDef:n,channel:t,markDef:i,ref:o,config:a}):o}function UI({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(es(n.type))return i;const a=Se("invalid",n,r);return a===null?i:[xoe(e,t),i]}function xoe(e,t){const n=Kx(e,!0),i=rs(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Kx(e,t=!0){return Hx(Y(e)?e:U(e,{expr:"datum"}),!t)}function Eoe(e){const{datum:t}=e;return Ml(t)?ff(t):`${JSON.stringify(t)}`}function os(e,t,n,i){const r={};if(t&&(r.scale=t),Ua(e)){const{datum:a}=e;Ml(a)?r.signal=ff(a):oe(a)?r.signal=a.signal:r.value=a}else r.field=U(e,n);if(i){const{offset:a,band:o}=i;a&&(r.offset=a),o&&(r.band=o)}return r}function Gg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=U(t,{expr:o,suffix:r}),l=n!==void 0?U(n,{expr:o}):U(t,{suffix:"end",expr:o}),u={};if(a===0||a===1){u.scale=e;const c=a===0?s:l;u.field=c}else{const c=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${c})`}return i&&(u.offset=i),u}function qI({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(se(t)){if(Bn(t)){c=c??pf({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:s,config:r,isMidPoint:!0});const{bin:h,timeUnit:p,type:g}=t;if(Me(h)||c&&p&&g===Ll)return s&&s.impute?os(t,a,{binSuffix:"mid"},{offset:l}):c?Gg({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):os(t,a,gf(t,e)?{binSuffix:"range"}:{},{offset:l});if(an(h)){if(q(n))return Gg({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});{const m=e===He?Si:Zi;j(EI(m))}}}const d=o==null?void 0:o.get("type");return os(t,a,On(d)?{binSuffix:"range"}:{},{offset:l,band:d==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(Wr(t)){const d=t.value,h=l?{offset:l}:{};return Object.assign(Object.assign({},df(e,d)),h)}}return ge(u)&&(u=u()),u&&Object.assign(Object.assign({},u),l?{offset:l}:{})}function df(e,t){return ae(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:ae(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:nt(t)}function ss(e){return e&&e!=="number"&&e!=="time"}function WI(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const koe=" â€“ ";function Qx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a}){var o,s;if(ss(n))return Zx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:a});const l=GI(e,i,r);if(Zg(e)){const u=Aoe(l,q(e)?(o=on(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,a.timeFormat,a2(e)&&((s=e.scale)===null||s===void 0?void 0:s.type)===at.UTC);return u?{signal:u}:void 0}if(t=VI(Ba(e),t,a),q(e)&&Me(e.bin)){const u=U(e,{expr:i,binSuffix:"end"});return{signal:Hg(l,u,t,n,a)}}else return t||Ba(e)==="quantitative"?{signal:`${XI(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function GI(e,t,n){return q(e)?n?`${U(e,{expr:t,suffix:"end"})}-${U(e,{expr:t,suffix:"start"})}`:U(e,{expr:t}):Eoe(e)}function Zx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a,field:o}){if(o=o??GI(e,i,r),q(e)&&Me(e.bin)){const s=U(e,{expr:i,binSuffix:"end"});return{signal:Hg(o,s,t,n,a)}}return{signal:WI(n,o,t)}}function HI(e,t,n,i,r,a){var o;if(ss(i))return;if(Zg(e)){const s=q(e)?(o=on(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return _oe(n,s,r,a)}return VI(t,n,r)}function YI(e,t,n){return e&&(oe(e)||e==="number"||e==="time")?e:Zg(t)&&n!=="time"&&n!=="utc"?"time":void 0}function VI(e,t,n){return Y(t)?t:e===as?n.numberFormat:void 0}function _oe(e,t,n,i){return e||(t?{signal:TI(t)}:i?void 0:n.timeFormat)}function XI(e,t){return`format(${e}, "${t||""}")`}function JI(e,t,n,i){var r;return ss(n)?WI(n,e,t):XI(e,(r=Y(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Hg(e,t,n,i,r){const a=JI(e,n,i,r),o=JI(t,n,i,r);return`${Hx(e,!1)} ? "null" : ${a} + "${koe}" + ${o}`}function Aoe(e,t,n,i,r){return!t||n?(n=Y(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):Bae(t,e,r)}const Yg="min",Soe={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function KI(e){return e in Soe}function QI(e){return!!e&&!!e.encoding}function ur(e){return!!e&&(e.op==="count"||!!e.field)}function ZI(e){return!!e&&I(e)}function hf(e){return"row"in e||"column"in e}function e2(e){return!!e&&"header"in e}function Vg(e){return"facet"in e}function Ooe(e){return e.selection}function Toe(e){return e&&!Y(e)&&"repeat"in e}function eM(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function tM(e){return Bn(e)&&"sort"in e}function pf({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:a,isMidPoint:o}){if(se(t)&&t.band!==void 0)return t.band;if(q(t)){const{timeUnit:s,bin:l}=t;if(s&&!n)return o?cs("timeUnitBandPosition",i,a):GF(i.type)?cs("timeUnitBand",i,a):0;if(Me(l))return GF(i.type)&&!o?1:.5}return(r==null?void 0:r.fieldChannel)===e&&o?.5:void 0}function t2(e,t,n,i,r,a){return Me(t.bin)||t.timeUnit&&Bn(t)&&t.type==="temporal"?!!pf({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:a}):!1}function n2(e){return!!e&&"condition"in e}function Xg(e){const t=e&&e.condition;return!!t&&!I(t)&&q(t)}function i2(e){const t=e&&e.condition;return!!t&&!I(t)&&se(t)}function Coe(e){const t=e&&e.condition;return!!t&&(I(t)||Wr(t))}function q(e){return!!e&&(!!e.field||e.aggregate==="count")}function Ba(e){return e&&e.type}function Ua(e){return!!e&&"datum"in e}function cr(e){return Bn(e)&&aM(e)||r2(e)}function r2(e){return Ua(e)&&Re(e.datum)}function se(e){return q(e)||Ua(e)}function Bn(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function Wr(e){return e&&"value"in e&&"value"in e}function a2(e){return!!e&&("scale"in e||"sort"in e)}function o2(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function nM(e){return!!e&&"legend"in e}function iM(e){return!!e&&("format"in e||"formatType"in e)}function $oe(e){return"op"in e}function U(e,t={}){var n,i,r;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(Doe(e))a=Wie("count");else{let u;if(!t.nofn)if($oe(e))u=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;Me(c)?(u=oI(c),s=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?ts(f)?(l=`["${a}"]`,a=`argmax_${f.argmax}`):Da(f)?(l=`["${a}"]`,a=`argmin_${f.argmin}`):u=String(f):d&&(u=Uae(d),s=(!ae(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}u&&(a=a?`${u}_${a}`:u)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?jF(a):t.expr?zie(a,t.expr)+l:$a(a)+l}function rM(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return q(e)&&!!e.bin;case"temporal":return!1}throw new Error(mI(e.type))}function aM(e){return!rM(e)}function Doe(e){return e.aggregate==="count"}function Roe(e,t){var n;const{field:i,bin:r,timeUnit:a,aggregate:o}=e;if(o==="count")return t.countTitle;if(Me(r))return`${i} (binned)`;if(a){const s=(n=on(a))===null||n===void 0?void 0:n.unit;if(s)return`${i} (${Bx(s).join("-")})`}else if(o)return ts(o)?`${i} for max ${o.argmax}`:Da(o)?`${i} for min ${o.argmin}`:`${Ag(o)} of ${i}`;return i}function Noe(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(ts(t))return`${r} for argmax(${t.argmax})`;if(Da(t))return`${r} for argmin(${t.argmin})`;const a=on(i),o=t||(a==null?void 0:a.unit)||(a==null?void 0:a.maxbins)&&"timeunit"||Me(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const oM=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Noe(e);default:return Roe(e,t)}};let sM=oM;function lM(e){sM=e}function Foe(){lM(oM)}function ls(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,a;const o=(r=s2(e))!==null&&r!==void 0?r:{},s=o.title;if(!q(e))return s;const l=e,u=i?uM(l,t):void 0;return n?rt(s,l.title,u):(a=s??l.title)!==null&&a!==void 0?a:u}function s2(e){return o2(e)&&e.axis?e.axis:nM(e)&&e.legend?e.legend:e2(e)&&e.header?e.header:void 0}function uM(e,t){return sM(e,t)}function Jg(e){var t;if(iM(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=s2(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function Ioe(e,t){if(e.timeUnit)return"temporal";if(Me(e.bin))return"quantitative";switch(zg(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function fr(e){return q(e)?e:Xg(e)?e.condition:void 0}function ft(e){return se(e)?e:i2(e)?e.condition:void 0}function l2(e,t,n){if(Y(e)||Re(e)||lo(e)){const i=Y(e)?"string":Re(e)?"number":"boolean";return j(Yre(t,i,e)),{value:e}}return se(e)?Kg(e,t,n):i2(e)?Object.assign(Object.assign({},e),{condition:Kg(e.condition,t,n)}):e}function Kg(e,t,n){if(iM(e)){const{format:i,formatType:r}=e,a=Z(e,["format","formatType"]);if(ss(r)&&!n.customFormatTypes)return j(gI(t)),Kg(a,t,n)}else{const i=o2(e)?"axis":nM(e)?"legend":e2(e)?"header":null;if(i&&e[i]){const r=e[i],{format:a,formatType:o}=r,s=Z(r,["format","formatType"]);if(ss(o)&&!n.customFormatTypes)return j(gI(t)),Kg(Object.assign(Object.assign({},e),{[i]:s}),t,n)}}return q(e)?cM(e,t):Moe(e)}function Moe(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Re(n)?"quantitative":Y(n)?"nominal":Ml(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function cM(e,t){const{aggregate:n,timeUnit:i,bin:r,field:a}=e,o=Object.assign({},e);if(n&&!$x(n)&&!ts(n)&&!Da(n)&&(j(Xre(n)),delete o.aggregate),i&&(o.timeUnit=on(i)),a&&(o.field=`${a}`),Me(r)&&(o.bin=Qg(r,t)),an(r)&&!sr(t)&&j(`Channel ${t} should not be used with "binned" bin.`),Bn(o)){const{type:s}=o,l=Zae(s);s!==l&&(o.type=l),s!=="quantitative"&&(XF(n)&&(j(Vre(s,n)),o.type="quantitative"))}else if(!nI(t)){const s=Ioe(o,t);j(Jre(t,s)),o.type=s}if(Bn(o)){const{compatible:s,warning:l}=joe(o,t);s||j(l)}if(tM(o)&&Y(o.sort)){const{sort:s}=o;if(KI(s))return Object.assign(Object.assign({},o),{sort:{encoding:s}});const l=s.substr(1);if(s.charAt(0)==="-"&&KI(l))return Object.assign(Object.assign({},o),{sort:{encoding:l,order:"descending"}})}if(e2(o)){const{header:s}=o,{orient:l}=s,u=Z(s,["orient"]);if(l)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},u),{labelOrient:s.labelOrient||l,titleOrient:s.titleOrient||l})})}return o}function Qg(e,t){return lo(e)?{maxbins:sI(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:sI(t)}):e}const us={compatible:!0};function joe(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Lr:case Pr:case Ng:return aM(e)?{compatible:!1,warning:Zre(t)}:us;case He:case ct:case An:case ir:case rr:case sf:case uf:case Fg:case is:case Ig:case Mg:case ns:case Oi:case er:case jg:return us;case nr:case ni:case tr:case Ti:return n!==as?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:us;case qr:case Ra:case Na:case Fa:case Ur:case Br:case zr:case Si:case Zi:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:us;case Ia:return ae(["ordinal","nominal"],e.type)?us:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Sn:return ae(["ordinal","nominal","geojson"],e.type)?us:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case lf:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:us}}function Zg(e){const{formatType:t}=Jg(e);return t==="time"||!t&&Loe(e)}function Loe(e){return e&&(e.type==="temporal"||q(e)&&!!e.timeUnit)}function u2(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var a;const o=t&&((a=on(t))===null||a===void 0?void 0:a.unit);let s=o||n==="temporal",l;return oe(e)?l=e.signal:Ml(e)?(s=!0,l=ff(e)):(Y(e)||Re(e))&&(s&&(l=`datetime(${JSON.stringify(e)})`,jae(o)&&((Re(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(l=ff({[o]:e}))))),l?i&&s?`time(${l})`:l:r?void 0:JSON.stringify(e)}function fM(e,t){const{type:n}=e;return t.map(i=>{const r=u2(i,{timeUnit:q(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function gf(e,t){return Me(e.bin)?La(t)&&ae(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function dM(e){const{anchor:t,frame:n,offset:i,orient:r,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=Z(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),v=nf(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:v,nonMark:g,subtitle:m}}function qa(e){return Y(e)||I(e)&&Y(e[0])}function nt(e){return oe(e)?e:e!==void 0?{value:e}:void 0}function hM(e){return oe(e)?e.signal:B(e.value)}function mf(e){return oe(e)?e.signal:e==null?null:B(e)}function Poe(e,t,n){for(const i of n){const r=cs(i,t.markDef,t.config);r!==void 0&&(e[i]=nt(r))}return e}function pM(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Se(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:a}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:a&&(!r||r===e)?void 0:cs(e,t,n,i)}function cs(e,t,n,{vgChannel:i}={}){return rt(i?em(e,t,n.style):void 0,em(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function em(e,t,n){return gM(e,pM(t),n)}function gM(e,t,n){t=G(t);let i;for(const r of t){const a=n[r];a&&a[e]!==void 0&&(i=a[e])}return i}function mM(e,t){return G(e).reduce((n,i)=>{var r;return n.field.push(U(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function vM(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(tf(r,i))return;n.push(i)}),n}function yM(e,t){return tf(e,t)||!t?e:e?[...G(e),...G(t)].join(", "):t}function bM(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((qa(n)||oe(n))&&(qa(i)||oe(i)))return{explicit:e.explicit,value:yM(n,i)};if(qa(n)||oe(n))return{explicit:e.explicit,value:n};if(qa(i)||oe(i))return{explicit:e.explicit,value:i};if(!qa(n)&&!oe(n)&&!qa(i)&&!oe(i))return{explicit:e.explicit,value:vM(n,i)};throw new Error("It should never reach here")}function fs(e,t){const n=e&&e[t];return n?I(n)?rf(n,i=>!!i.field):q(n)||Xg(n):!1}function c2(e){return rf(eI,t=>{if(fs(e,t)){const n=e[t];if(I(n))return rf(n,i=>!!i.aggregate);{const i=fr(n);return i&&!!i.aggregate}}return!1})}function f2(e,t){const n=[],i=[],r=[],a=[],o={};return d2(e,(s,l)=>{if(q(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=Z(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const p=s2(s),g=p&&p.title;let m=U(s,{forAs:!0});const v=Object.assign(Object.assign(Object.assign({},g?[]:{title:ls(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let y;if(ts(c)?(y="argmax",m=U({op:"argmax",field:c.argmax},{forAs:!0}),v.field=`${m}.${u}`):Da(c)?(y="argmin",m=U({op:"argmin",field:c.argmin},{forAs:!0}),v.field=`${m}.${u}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(y=c),y){const b={op:y,as:m};u&&(b.field=u),a.push(b)}}else if(n.push(m),Bn(s)&&Me(f)){if(i.push({bin:f,field:u,as:m}),n.push(U(s,{binSuffix:"end"})),gf(s,l)&&n.push(U(s,{binSuffix:"range"})),sr(l)){const y={field:m+"_end"};o[l+"2"]=y}v.bin="binned",nI(l)||(v.type=as)}else if(d){r.push({timeUnit:d,field:u,as:m});const y=Bn(s)&&s.type!==Ll&&"time";y&&(l===sf||l===is?v.formatType=y:Ore(l)?v.legend=Object.assign({formatType:y},v.legend):sr(l)&&(v.axis=Object.assign({formatType:y},v.axis)))}o[l]=v}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:i,timeUnits:r,aggregate:a,groupby:n,encoding:o}}function zoe(e,t,n){const i=Cre(t,n);if(i){if(i==="binned"){const r=e[t===Si?He:ct];return!!(q(r)&&q(e[t])&&an(r.bin))}}else return!1;return!0}function Boe(e,t,n){const i=t.type;return z(e).reduce((r,a)=>{if(!tI(a))return j(Qre(a)),r;const o=e[a];if(a==="angle"&&i==="arc"&&!e.theta&&(j(Hre),a=Oi),!zoe(e,a,i))return j(Ug(a,i)),r;if(a===Ur&&i==="line"){const s=fr(e[a]);if(s==null?void 0:s.aggregate)return j(Kre),r}if(a===An&&(t.filled?"fill"in e:"stroke"in e))return j(vI("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(a===uf||a===lf&&!I(o)&&!Wr(o)||a===is&&I(o))o&&(r[a]=G(o).reduce((s,l)=>(q(l)?s.push(cM(l,a)):j(Mx(l,a)),s),[]));else{if(a===is&&o===null)r[a]=null;else if(!q(o)&&!Ua(o)&&!Wr(o)&&!n2(o)&&!oe(o))return j(Mx(o,a)),r;r[a]=l2(o,a,n)}return r},{})}function Uoe(e){const t=[];for(const n of z(e))if(fs(e,n)){const i=e[n],r=G(i);for(const a of r)q(a)?t.push(a):Xg(a)&&t.push(a.condition)}return t}function d2(e,t,n){if(!e)return;for(const i of z(e)){const r=e[i];if(I(r))for(const a of r)t.call(n,a,i);else t.call(n,r,i)}}function wM(e,t,n,i){return e?z(e).reduce((r,a)=>{const o=e[a];return I(o)?o.reduce((s,l)=>t.call(i,s,l,a),r):t.call(i,r,o,a)},n):n}function xM(e,t){return z(t).reduce((n,i)=>{switch(i){case He:case ct:case Ig:case jg:case Mg:case Si:case Zi:case Oi:case Br:case er:case zr:case tr:case nr:case Ti:case ni:case sf:case Sn:case ns:case is:return n;case lf:if(e==="line"||e==="trail")return n;case uf:case Fg:{const r=t[i];if(I(r)||q(r))for(const a of G(r))a.aggregate||n.push(U(a,{}));return n}case Ur:if(e==="trail")return n;case An:case ir:case rr:case qr:case Ra:case Na:case Ia:case Fa:{const r=fr(t[i]);return r&&!r.aggregate&&n.push(U(r,{})),n}}},[])}function qoe(e){const{tooltip:t}=e,n=Z(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;if(I(t)){for(const a of t)a.aggregate?(i||(i=[]),i.push(a)):(r||(r=[]),r.push(a));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return I(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function h2(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:a,titlePrefix:o})=>{const s=i?` of ${t.field}`:"";return{field:a+t.field,type:t.type,title:oe(o)?{signal:o+`"${escape(s)}"`}:o+s}});return{tooltip:[...r,...Uoe(n)]}}function EM(e){const{axis:t,title:n,field:i}=e;return t&&t.title!==void 0?void 0:rt(n,i)}function p2(e,t,n,i,r){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c=void 0,aria:f,extraEncoding:d={}})=>{const h=EM(n);return kM(e,s,r,f,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},h!==void 0?{title:h}:{}),a!==void 0?{scale:a}:{}),o!==void 0?{axis:o}:{})},Y(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),d)})}}function kM(e,t,n,i,r){const{clip:a,color:o,opacity:s}=e,l=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),o?{color:o}:{}),s?{opacity:s}:{}),Qi(r.mark)?r.mark:{type:r.mark}),{style:`${l}-${t}`}),lo(e[t])?{}:e[t]),i===!1?{aria:i}:{})})]:[]}function _M(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",a=i[r],o=i[r+"2"],s=i[r+"Error"],l=i[r+"Error2"];return{continuousAxisChannelDef:tm(a,n),continuousAxisChannelDef2:tm(o,n),continuousAxisChannelDefError:tm(s,n),continuousAxisChannelDefError2:tm(l,n),continuousAxis:r}}function tm(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Z(e,["aggregate"]);return n!==t&&j(_ae(n,t)),i}else return e}function AM(e,t){const{mark:n,encoding:i}=e,{x:r,y:a}=i;if(cr(r)){if(cr(a)){const o=q(r)&&r.aggregate,s=q(a)&&a.aggregate;if(!o&&s===t)return"vertical";if(!s&&o===t)return"horizontal";if(o===t&&s===t)throw new Error("Both x and y cannot have aggregate");return Qi(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(cr(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const nm="boxplot",Woe=["box","median","outliers","rule","ticks"],Goe=new Rg(nm,OM);function SM(e){return Re(e)?"tukey":e}function OM(e,{config:t}){var n,i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=Qi(r)?r:{type:r};o&&j(dI("boxplot"));const c=(n=u.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Se("size",u,t),d=SM(c),{transform:h,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:v,encodingWithoutContinuousAxis:y,ticksOrient:b,boxOrient:E,customTooltipWithoutAggregatedField:x}=Hoe(e,c,t),{color:k,size:w}=y,A=Z(y,["color","size"]),_=J=>p2(u,g,p,J,t.boxplot),O=_(A),S=_(y),T=_(Object.assign(Object.assign({},A),w?{size:w}:{})),D=h2([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,y),M={type:"tick",color:"black",opacity:1,orient:b,invalid:null},C=d==="min-max"?D:h2([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,y),F=[...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:C}),...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:M,positionPrefix:"lower_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:M,positionPrefix:"upper_whisker",aria:!1,extraEncoding:C})],W=[...d!=="tukey"?F:[],...S({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:E,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:D}),...T({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},K(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:D})];let X;if(d!=="min-max"){const J=`datum["lower_box_${p.field}"]`,xe=`datum["upper_box_${p.field}"]`,Pe=`(${xe} - ${J})`,dt=`${J} - ${c} * ${Pe}`,ht=`${xe} + ${c} * ${Pe}`,Ke=`datum["${p.field}"]`,Rt={joinaggregate:TM(p.field),groupby:m};let ui;d==="tukey"&&(ui={transform:[{filter:`(${dt} <= ${Ke}) && (${Ke} <= ${ht})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:m}],layer:F});const Ka=Z(A,["tooltip"]),{scale:Jr,axis:H}=p,ue=EM(p),me=kM(u,"outliers",t.boxplot,!0,{transform:[{filter:`(${Ke} < ${dt}) || (${Ke} > ${ht})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},ue!==void 0?{title:ue}:{}),Jr!==void 0?{scale:Jr}:{}),H!==void 0?{axis:H}:{})},Ka),x?{tooltip:x}:{})})[0];me&&ui?X={transform:[Rt],layer:[me,ui]}:me?(X=me,X.transform.unshift(Rt)):ui&&(X=ui,X.transform.unshift(Rt))}return X?Object.assign(Object.assign({},l),{layer:[X,{transform:h,layer:W}]}):Object.assign(Object.assign({},l),{transform:((i=l.transform)!==null&&i!==void 0?i:[]).concat(h),layer:W})}function TM(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function Hoe(e,t,n){const i=AM(e,nm),{continuousAxisChannelDef:r,continuousAxis:a}=_M(e,i,nm),o=r.field,s=SM(t),l=[...TM(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(s==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(s==="min-max"?"upper_whisker_":"max_")+o}],u=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=c[f],h=Z(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:g}=qoe(h),{bins:m,timeUnits:v,aggregate:y,groupby:b,encoding:E}=f2(g,n),x=i==="vertical"?"horizontal":"vertical",k=i,w=[...m,...v,{aggregate:[...y,...l],groupby:b},...u];return{transform:w,groupby:b,aggregate:y,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:E,ticksOrient:x,boxOrient:k,customTooltipWithoutAggregatedField:p}}const g2="errorbar",Yoe=["ticks","rule"],Voe=new Rg(g2,CM);function CM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=$M(e,g2,t),c=p2(s,r,i,a,t.errorbar),f={type:"tick",orient:o},d=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:u}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function Xoe(e,t){const{encoding:n}=e;if(Joe(n))return{orient:AM(e,t),inputType:"raw"};const i=Koe(n),r=Qoe(n),a=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const s=n.x2,l=n.y2;if(se(s)&&se(l))throw new Error(`${t} cannot have both x2 and y2`);if(se(s)){if(cr(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(l)){if(cr(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const s=n.xError,l=n.xError2,u=n.yError,c=n.yError2;if(se(l)&&!se(s))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(u))throw new Error(`${t} cannot have yError2 without yError`);if(se(s)&&se(u))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(s)){if(cr(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(u)){if(cr(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Joe(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function Koe(e){return se(e.x2)||se(e.y2)}function Qoe(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function $M(e,t,n){var i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=Qi(r)?r:{type:r};o&&j(dI(t));const{orient:c,inputType:f}=Xoe(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=_M(e,c,t),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:E}=Zoe(u,d,h,p,g,f,t,n),x=a,k=m,w=x[k],A=m==="x"?"x2":"y2",_=x[A],O=m==="x"?"xError":"yError",S=x[O],T=m==="x"?"xError2":"yError2",D=x[T],M=Z(x,[typeof k=="symbol"?k:k+"",typeof A=="symbol"?A:A+"",typeof O=="symbol"?O:O+"",typeof T=="symbol"?T:T+""]),{bins:C,timeUnits:F,aggregate:W,groupby:X,encoding:J}=f2(M,n),xe=[...W,...v],Pe=f!=="raw"?[]:X,dt=h2(b,d,J,E);return{transform:[...(i=l.transform)!==null&&i!==void 0?i:[],...C,...F,...xe.length===0?[]:[{aggregate:xe,groupby:Pe}],...y],groupby:Pe,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:J,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:dt}}function Zoe(e,t,n,i,r,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if(a==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center,p=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!==(p==="iqr")&&j(kae(h,p,o)),p==="stderr"||p==="stdev")l=[{op:p,field:c,as:"extent_"+c},{op:h,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:Ag(h)},{fieldPrefix:"upper_",titlePrefix:DM(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:DM(h,p,"-")}],d=!0;else{e.center&&e.extent&&j(Aae(e.extent,o));let g,m,v;p==="ci"?(g="mean",m="ci0",v="ci1"):(g="median",m="q1",v="q3"),l=[{op:m,field:c,as:"lower_"+c},{op:v,field:c,as:"upper_"+c},{op:g,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:ls({field:c,aggregate:v,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:ls({field:c,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:ls({field:c,aggregate:g,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&j(Eae(e.center,e.extent)),a==="aggregated-upper-lower"?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):a==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?u.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const h of u)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Nl(Nl(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}function DM(e,t,n){return Ag(e)+" "+n+" "+t}const m2="errorband",ese=["band","borders"],tse=new Rg(m2,RM);function RM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=$M(e,m2,t),u=o,c=p2(u,r,i,a,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign({},h),p)):u.interpolate?j(xI("interpolate")):u.tension&&j(xI("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:l})]})}const NM={};function v2(e,t,n){const i=new Rg(e,t);NM[e]={normalizer:i,parts:n}}function nse(){return z(NM)}v2(nm,OM,Woe),v2(g2,CM,Yoe),v2(m2,RM,ese);const ise=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],FM=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],rse={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},ase={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},ose={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},zl="_vgsid_",sse={single:{on:"click",fields:[zl],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[zl],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function y2(e){return!!e&&(e==="legend"||!!e.legend)}function b2(e){return y2(e)&&K(e)}function lse(e){return im(e)||x2(e)||w2(e)}function w2(e){return"concat"in e}function im(e){return"vconcat"in e}function x2(e){return"hconcat"in e}function dr(e){return K(e)&&e.step!==void 0}function IM(e){return e.view||e.width||e.height}const MM=20,use={align:1,bounds:1,center:1,columns:1,spacing:1},cse=z(use);function fse(e,t,n){var i,r;const a=n[t],o={},{spacing:s,columns:l}=a;s!==void 0&&(o.spacing=s),l!==void 0&&((Vg(e)&&!hf(e.facet)||w2(e))&&(o.columns=l)),im(e)&&(o.columns=1);for(const u of cse)if(e[u]!==void 0)if(u==="spacing"){const c=e[u];o[u]=Re(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:s,column:(r=c.column)!==null&&r!==void 0?r:s}}else o[u]=e[u];return o}function E2(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function rm(e,t){const n=vf(e,t);return dr(n)?n.step:k2}function vf(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return rt(i,{step:e.step})}const k2=20,dse={continuousWidth:200,continuousHeight:200,step:k2},hse={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:dse,mark:nre,arc:{},area:{},bar:rre,circle:{},geoshape:{},image:{},line:{},point:{},rect:are,rule:{color:"black"},square:{},text:{color:"black"},tick:ore,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:hoe,projection:{},legend:ase,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:sse,style:{},title:{},facet:{spacing:MM},concat:{spacing:MM}},Gr=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],jM={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},LM={blue:Gr[0],orange:Gr[1],red:Gr[2],teal:Gr[3],green:Gr[4],yellow:Gr[5],purple:Gr[6],pink:Gr[7],brown:Gr[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function pse(e={}){return{signals:[{name:"color",value:K(e)?Object.assign(Object.assign({},LM),e):LM}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function gse(e){return{signals:[{name:"fontSize",value:K(e)?Object.assign(Object.assign({},jM),e):jM}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function mse(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function PM(e={}){const{color:t,font:n,fontSize:i}=e,r=Z(e,["color","font","fontSize"]);return ru({},hse,n?mse(n):{},t?pse(t):{},i?gse(i):{},r||{})}const vse=["view",...HF],yse=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],bse=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},tre);function wse(e){e=pe(e);for(const t of yse)delete e[t];if(e.axis)for(const t in e.axis)Sx(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of ise)delete e.legend[t];if(e.mark){for(const t of YF)delete e.mark[t];e.mark.tooltip&&K(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of vse){for(const i of YF)delete e[t][i];const n=bse[t];if(n)for(const i of n)delete e[t][i];Ese(e,t)}for(const t of nse())delete e[t];xse(e);for(const t in e)K(e[t])&&Fe(e[t])&&delete e[t];return Fe(e)?void 0:e}function xse(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=dM(e.title);Fe(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Fe(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Fe(i)?delete e.title:e.title=i}function Ese(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const a=Object.assign(Object.assign({},r),e.style[n??t]);Fe(a)||(e.style[n??t]=a),i||delete e[t]}function am(e){return"layer"in e}function kse(e){return"repeat"in e}function _se(e){return!I(e.repeat)&&e.repeat.layer}class zM{map(e,t){return Vg(e)?this.mapFacet(e,t):kse(e)?this.mapRepeat(e,t):x2(e)?this.mapHConcat(e,t):im(e)?this.mapVConcat(e,t):w2(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(am(e))return this.mapLayer(e,t);if(jr(e))return this.mapUnit(e,t);throw new Error(Ix(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(n=>this.mapLayerOrUnit(n,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(n=>this.map(n,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(n=>this.map(n,t))})}mapConcat(e,t){const{concat:n}=e,i=Z(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(r=>this.map(r,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const Ase={zero:1,center:1,normalize:1};function Sse(e){return e in Ase}const Ose=new Set([UF,Tg,Og,Dg,$g,Tx,Cx,Cg,qF,Ox]),Tse=new Set([Tg,Og,UF]);function BM(e,t){var n,i;const r=t==="x"?"y":"radius",a=e[t],o=e[r];if(q(a)&&q(o))if(Ba(a)==="quantitative"&&Ba(o)==="quantitative"){if(a.stack)return t;if(o.stack)return r;const s=q(a)&&!!a.aggregate,l=q(o)&&!!o.aggregate;if(s!==l)return s?t:r;{const u=(n=a.scale)===null||n===void 0?void 0:n.type,c=(i=o.scale)===null||i===void 0?void 0:i.type;if(u&&u!=="linear")return r;if(c&&c!=="linear")return t}}else{if(Ba(a)==="quantitative")return t;if(Ba(o)==="quantitative")return r}else{if(Ba(a)==="quantitative")return t;if(Ba(o)==="quantitative")return r}return}function Cse(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function UM(e,t,n={}){const i=Qi(e)?e.type:e;if(!Ose.has(i))return null;const r=BM(t,"x")||BM(t,"theta");if(!r)return null;const a=t[r],o=q(a)?U(a,{}):void 0;let s=Cse(r),l=t[s],u=q(l)?U(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=_re.reduce((d,h)=>{if(h!=="tooltip"&&fs(t,h)){const p=t[h];for(const g of G(p)){const m=fr(g);if(m.aggregate)continue;const v=U(m,{});(!v||v!==u)&&d.push({channel:h,fieldDef:m})}}return d},[]);let f;if(a.stack!==void 0?lo(a.stack)?f=a.stack?"zero":null:f=a.stack:c.length>0&&Tse.has(i)&&(f="zero"),!f||!Sse(f))return null;if(c2(t)&&c.length===0)return null;if(a.scale&&a.scale.type&&a.scale.type!==at.LINEAR){if(n.disallowNonLinearStack)return null;j(bae(a.scale.type))}return se(t[ar(r)])?(a.stack!==void 0&&j(yae(r)),null):(q(a)&&a.aggregate&&!ae(dre,a.aggregate)&&j(wae(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:r,impute:a.impute===null?!1:es(i),stackBy:c,offset:f})}function $se(e){const t=Z(e,["point","line"]);return z(t).length>1?t:t.type}function Dse(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Mr(e[t],["point","line"])}));return e}function _2(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?K(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?K(t.point)?t.point:{}:void 0}function qM(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Rse{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(jr(e)){const{mark:n,encoding:i}=e,r=Qi(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!_2(r,t[r.type],i);case"area":return!!_2(r,t[r.type],i)||!!qM(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:a,encoding:o,mark:s}=e,l=Z(e,["selection","projection","encoding","mark"]),u=Qi(s)?s:{type:s},c=_2(u,i[u.type],o),f=u.type==="area"&&qM(u,i[u.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:$se(Object.assign(Object.assign({},u.type==="area"&&u.opacity===void 0&&u.fillOpacity===void 0?{opacity:.7}:{}),u)),encoding:Mr(o,["shape"])})],h=UM(u,o);let p=o;if(h){const{fieldChannel:g,offset:m}=h;p=Object.assign(Object.assign({},o),{[g]:Object.assign(Object.assign({},o[g]),m?{stack:m}:{})})}return f&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},nf(u,["clip","interpolate","tension","tooltip"])),f),encoding:p})),c&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},nf(u,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},t),{config:Dse(i)}))}}class Nse{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(jr(e)&&e.encoding)for(const n of ri){const i=e.encoding[n];if(i&&se(i)&&((t=i==null?void 0:i.scale)===null||t===void 0?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const r of ri){const a=or(r),o=i[r];if(o&&se(o)&&((t=o==null?void 0:o.scale)===null||t===void 0?void 0:t.rangeStep)){const{scale:s}=o,l=Z(o,["scale"]),u=s,c=Z(u,["rangeStep"]);n[a]={step:s.rangeStep},j(iae),i=Object.assign(Object.assign({},i),{[r]:Object.assign(Object.assign({},l),Fe(c)?{}:{scale:c})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function Fse(e,t){return t?hf(e)?YM(e,t):WM(e,t):e}function A2(e,t){return t?YM(e,t):e}function S2(e,t,n){const i=t[e];if(Toe(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});j(Pre(i.repeat));return}return t}function WM(e,t){if(e=S2("field",e,t),e===void 0)return;if(e===null)return null;if(tM(e)&&ur(e.sort)){const n=S2("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function GM(e,t){if(q(e))return WM(e,t);{const n=S2("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function HM(e,t){if(se(e)){const n=GM(e,t);if(n)return n;if(n2(e))return{condition:e.condition}}else{if(i2(e)){const n=GM(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=Z(e,["condition"]);return i}}return e}return}function YM(e,t){const n={};for(const i in e)if(Q(e,i)){const r=e[i];if(I(r))n[i]=r.map(a=>HM(a,t)).filter(a=>a);else{const a=HM(r,t);a!==void 0&&(n[i]=a)}}return n}class Ise{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(jr(e)){const{encoding:t,mark:n}=e;if(n==="line")for(const i of Ere){const r=rs(i),a=t[r];if(t[i]&&(q(a)&&!an(a.bin)||Ua(a)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;return j(tae(!!i.x2,!!i.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}class Mse extends zM{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[Goe,Voe,tse,new Rse(),new Ise(),new Nse()]}map(e,t){if(jr(e)){const n=fs(e.encoding,Lr),i=fs(e.encoding,Pr),r=fs(e.encoding,Ng);if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Object.assign(Object.assign({},e),{encoding:A2(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const a=this.mapLayerOrUnit.bind(this);for(const o of this.nonFacetUnitNormalizers)if(o.hasMatchingType(r,t.config))return o.run(r,t,a);return r}mapRepeat(e,t){return _se(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=Z(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:i}}),t):Object.assign(Object.assign({},r),{layer:s.map(c=>{const f=Object.assign(Object.assign({},l),{layer:c}),d=(i.name||"")+u+`child__layer_${qe(c)}`,h=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:f,repeaterPrefix:d}));return h.name=d,h})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:a}=e,o=Z(e,["repeat","spec","data"]);!I(i)&&e.columns&&(e=Mr(e,["columns"]),j(hI("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!I(i)&&i.row||[l?l.row:null],f=!I(i)&&i.column||[l?l.column:null],d=I(i)&&i||[l?l.repeat:null];for(const p of d)for(const g of c)for(const m of f){const v={repeat:p,row:g,column:m,layer:l.layer},y=(r.name||"")+u+"child__"+(I(i)?`${qe(p)}`:(i.row?`row_${qe(g)}`:"")+(i.column?`column_${qe(m)}`:"")),b=this.map(r,Object.assign(Object.assign({},t),{repeater:v,repeaterPrefix:y}));b.name=y,s.push(Mr(b,["data"]))}const h=I(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(n=r.data)!==null&&n!==void 0?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return hf(n)&&e.columns&&(e=Mr(e,["columns"]),j(hI("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:a,config:o}=t,s=XM({parentProjection:a,projection:i}),l=VM({parentEncoding:r,encoding:A2(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:a}=n,o=Z(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=Z(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:a},t),v=A2(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:v}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:a}=e;if(i||r){a&&j(eae([...i?[Lr]:[],...r?[Pr]:[]]));const o={},s={};for(const l of[Lr,Pr]){const u=e[l];if(u){const c=Z(u,["align","center","spacing","columns"]);o[l]=c;for(const f of["align","center","spacing"])u[f]!==void 0&&(s[f]=(n=s[f])!==null&&n!==void 0?n:{},s[f][l]=u[f])}}return{facetMapping:o,layout:s}}else{const{align:o,center:s,spacing:l,columns:u}=a,c=Z(a,["align","center","spacing","columns"]);return{facetMapping:Fse(c,t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},o?{align:o}:{}),s?{center:s}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=Z(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=Z(e,["encoding","projection"]),l=Object.assign(Object.assign({},r),{parentEncoding:VM({parentEncoding:n,encoding:a}),parentProjection:XM({parentProjection:i,projection:o})});return super.mapLayer(s,l)}}function VM(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const r=z(t).reduce((a,o)=>(n[o]&&a.push(o),a),[]);r.length>0&&j(Wre(r))}const i=Object.assign(Object.assign({},t??{}),n??{});return Fe(i)?void 0:i}function XM(e){const{parentProjection:t,projection:n}=e;return t&&n&&j(Gre({parentProjection:t,projection:n})),n??t}function JM(e,t){t===void 0&&(t=PM(e.config));const n=Lse(e,t),{width:i,height:r}=e,a=Pse(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const jse=new Mse();function Lse(e,t={}){return jse.map(e,{config:t})}function KM(e){return Y(e)?{type:e}:e??{}}function Pse(e,t,n){let{width:i,height:r}=t;const a=jr(e)||am(e),o={};a?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(j(lI("width")),i=void 0),r=="container"&&(j(lI("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?KM(n.autosize):{}),KM(e.autosize));return s.type==="fit"&&!a&&(j(Rre),s.type="pad"),i=="container"&&!(s.type=="fit"||s.type=="fit-x")&&j(uI("width")),r=="container"&&!(s.type=="fit"||s.type=="fit-y")&&j(uI("height")),tf(s,{type:"pad"})?void 0:s}function zse(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Bse(e){return e?`fit-${Lg(e)}`:"fit"}const Use=["background","padding"];function QM(e){return Use.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class Wa{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Wa(pe(this.explicit),pe(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return rt(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){t.value!==void 0&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){t.explicit[e]!==void 0?this.set(e,t.explicit[e],!0):t.implicit[e]!==void 0&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){t[e]!==void 0&&this.set(e,t[e],!0)}copyAll(e){for(const t of z(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function ds(e){return{explicit:!0,value:e}}function Un(e){return{explicit:!1,value:e}}function ZM(e){return(t,n,i,r)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:om(t,n,i,r)}}function om(e,t,n,i){return e.explicit&&t.explicit&&j(fae(n,i,e.value,t.value)),e}function Ga(e,t,n,i,r=om){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:tf(e.value,t.value)?e:r(e,t,n,i)}class qse extends Wa{constructor(e={},t={},n=!1){super(e,t);this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function yf(e){return"url"in e}function sm(e){return"values"in e}function ej(e){return"name"in e&&!yf(e)&&!sm(e)&&!hs(e)}function hs(e){return e&&(tj(e)||nj(e)||O2(e))}function tj(e){return"sequence"in e}function nj(e){return"sphere"in e}function O2(e){return"graticule"in e}const qt="main",lm="raw";function ij(e){return"filter"in e}function Wse(e){return(e==null?void 0:e.stop)!==void 0}function Gse(e){return"lookup"in e}function Hse(e){return"data"in e}function Yse(e){return"selection"in e}function Vse(e){return"pivot"in e}function Xse(e){return"density"in e}function Jse(e){return"quantile"in e}function Kse(e){return"regression"in e}function Qse(e){return"loess"in e}function Zse(e){return"sample"in e}function ele(e){return"window"in e}function tle(e){return"joinaggregate"in e}function nle(e){return"flatten"in e}function ile(e){return"calculate"in e}function rle(e){return"bin"in e}function ale(e){return"impute"in e}function ole(e){return"timeUnit"in e}function sle(e){return"aggregate"in e}function lle(e){return"stack"in e}function ule(e){return"fold"in e}function cle(e){return e.map(t=>ij(t)?{filter:kg(t.filter,Kae)}:t)}function bf(e,t,n,i){const r=n2(t)&&t.condition,a=i(t);if(r){const o=G(r),s=o.map(l=>{const u=i(l),c=Ooe(l)?Cj(e,l.selection):pm(e,l.test);return Object.assign({test:c},u)});return{[n]:[...s,...a!==void 0?[a]:[]]}}else return a!==void 0?{[n]:a}:{}}function T2(e,t="text"){const n=e.encoding[t];return bf(e,n,t,i=>um(i,e.config))}function um(e,t,n="datum"){if(e){if(Wr(e))return nt(e.value);if(se(e)){const{format:i,formatType:r}=Jg(e);return Qx({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function rj(e,t={}){const{encoding:n,markDef:i,config:r,stack:a}=e,o=n.tooltip;if(I(o))return{tooltip:oj({tooltip:o},a,r,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return bf(e,o,"tooltip",l=>{const u=um(l,r,s);if(u)return u;if(l===null)return;let c=Se("tooltip",i,r);return c===!0&&(c={content:"encoding"}),Y(c)?{value:c}:K(c)?c.content==="encoding"?oj(n,a,r,t):{signal:s}:void 0})}}function aj(e,t,n,{reactiveGeom:i}={}){const r={},a=i?"datum.datum":"datum",o=[];function s(u,c){const f=rs(c),d=Bn(u)?u:Object.assign(Object.assign({},u),{type:e[f].type}),h=G(ls(d,n,{allowDisabling:!1})).join(", ");let p;if(sr(c)){const g=c==="x"?"x2":"y2",m=fr(e[g]);if(an(d.bin)&&m){const v=U(d,{expr:a}),y=U(m,{expr:a}),{format:b,formatType:E}=Jg(d);p=Hg(v,y,b,E,n),r[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:y}=Jg(d);p=Qx({fieldOrDatumDef:d,format:v,formatType:y,expr:a,config:n,normalizeStack:!0}).signal}}p=p??um(d,n,a).signal,o.push({channel:c,key:h,value:p})}d2(e,(u,c)=>{q(u)?s(u,c):Xg(u)&&s(u.condition,c)});const l={};for(const{channel:u,key:c,value:f}of o)!r[u]&&!l[c]&&(l[B(c)]=f);return l}function oj(e,t,n,{reactiveGeom:i}={}){const r=aj(e,t,n,{reactiveGeom:i}),a=IF(r).map(({key:o,value:s})=>`${o}: ${s}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function fle(e){const{markDef:t,config:n}=e,i=Se("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),dle(e)),hle(e))}function dle(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Se("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Yae?{}:{ariaRoleDescription:{value:t}}}function hle(e){const{encoding:t,markDef:n,config:i,stack:r}=e,a=t.description;if(a)return bf(e,a,"description",l=>um(l,e.config));const o=Se("description",n,i);if(o!=null)return{description:nt(o)};if(i.aria===!1)return{};const s=aj(t,r,i);return Fe(s)?void 0:{description:{signal:IF(s).map(({key:l,value:u})=>`${l} + ": " + (${u})`).join(' + "; " + ')}}}function xt(e,t,n={}){const{markDef:i,encoding:r,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;s===void 0&&(l=l??Se(e,i,a,{vgChannel:o,ignoreVgConfig:!0}),l!==void 0&&(s=nt(l)));const u=r[e];return bf(t,u,o??e,c=>qI({channel:e,channelDef:c,markDef:i,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function sj(e,t={filled:void 0}){var n,i,r,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=(n=t.filled)!==null&&n!==void 0?n:Se("filled",o,l),f=ae(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=(r=(i=Se(c===!0?"color":void 0,o,l,{vgChannel:"fill"}))!==null&&i!==void 0?i:l.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,h=(a=Se(c===!1?"color":void 0,o,l,{vgChannel:"stroke"}))!==null&&a!==void 0?a:l.mark[c===!1&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},d?{fill:nt(d)}:{}),h?{stroke:nt(h)}:{});return o.color&&(c?o.fill:o.stroke)&&j(vI("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),xt("color",e,{vgChannel:p,defaultValue:c?d:h})),xt("fill",e,{defaultValue:s.fill?d:void 0})),xt("stroke",e,{defaultValue:s.stroke?h:void 0}))}function wf(e,t){const n=kre(e),i=t[n];return i||void 0}function Wt(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[ar(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=wf(e,o),p=C2({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),g=!u&&sr(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:ple({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:r,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return g?{[i||e]:g}:void 0}function ple(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:a,offset:o,markDef:s,config:l}=e;if(se(n)&&a&&t===a.fieldChannel){if(q(n)){const u=pf({channel:t,fieldDef:n,isMidPoint:i,markDef:s,stack:a,config:l});if(u!==void 0)return Gg({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:u,offset:o})}return os(n,r,{suffix:"end"},{offset:o})}return Jx(e)}function C2({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:a,config:o}=e;return()=>{const s=rs(n),l=Ma(n),u=Se(n,a,o,{vgChannel:l});if(u!==void 0)return df(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!ae([at.LOG,at.TIME,at.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return s==="y"?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[or(n)];return Object.assign(Object.assign({},c),{mult:.5})}}return}}const gle={left:"x",center:"xc",right:"x2"},mle={top:"y",middle:"yc",bottom:"y2"};function lj(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Ma(e);const r=e==="x"?"align":"baseline",a=Se(r,t,n);return e==="x"?gle[a||(i==="top"?"left":"center")]:mle[a||i]}function cm(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?uj(e,t,{defaultPos:n,defaultPos2:i}):Wt(e,t,{defaultPos:n})}function uj(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:a}=t,o=ar(e),s=or(e),l=vle(t,i,o),u=l[s]?lj(e,r,a):Ma(e);return Object.assign(Object.assign({},Wt(e,t,{defaultPos:n,vgChannel:u})),l)}function vle(e,t,n){const{encoding:i,mark:r,markDef:a,stack:o,config:s}=e,l=rs(n),u=or(n),c=Ma(n),f=i[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=n in i||n in a?wf(n,e.markDef):wf(l,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const g=yle({channel:n,channelDef:f,channel2Def:i[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:fm(n,a)||fm(n,{[n]:em(n,a,s.style),[u]:em(u,a,s.style)})||fm(n,s[r])||fm(n,s.mark)||{[c]:C2({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function yle({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return se(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?os(t,a,{suffix:"start"},{offset:l}):Jx({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:i,config:r,offset:l,defaultRef:u})}function fm(e,t){const n=or(e),i=Ma(e);return t[i]!==void 0?{[i]:df(e,t[i])}:t[e]!==void 0?{[i]:df(e,t[e])}:t[n]?{[n]:df(e,t[n])}:void 0}function Ha(e,t,n){var i,r,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=ar(t),d=or(t),h=l[t],p=l[f],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,v=e.scaleName(t),y=u.orient,b=(r=(i=l[d])!==null&&i!==void 0?i:l.size)!==null&&r!==void 0?r:Se("size",u,s,{vgChannel:d}),E=n==="bar"&&(t==="x"?y==="vertical":y==="horizontal");if(q(h)&&(Me(h.bin)||an(h.bin)||h.timeUnit&&!p)&&!b&&!On(m)){const x=pf({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),k=(a=e.component.axes[t])===null||a===void 0?void 0:a[0],w=(o=k==null?void 0:k.get("translate"))!==null&&o!==void 0?o:.5;return xle({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:v,band:x,axisTranslate:w,spacing:sr(t)?Se("binSpacing",u,s):void 0,reverse:g.get("reverse"),config:s})}else return(se(h)&&On(m)||E)&&!p?wle(n,h,t,e):uj(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function ble(e,t,n,i,r,a){if(i){const l=i.get("type");if(l==="point"||l==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(l===at.POINT){const u=i.get("range");return Pa(u)&&Re(u.step)?{value:u.step-2}:{value:k2-2}}else return{scale:n,band:a}}else return{value:r[e].continuousBandSize}}const o=rm(r.view,t),s=rt(r[e].discreteBandSize,o-2);return s!==void 0?{value:s}:void 0}function wle(e,t,n,i){var r;const{markDef:a,encoding:o,config:s,stack:l}=i,u=a.orient,c=i.scaleName(n),f=i.getScaleComponent(n),d=or(n),h=ar(n),p=u==="horizontal"&&n==="y"||u==="vertical"&&n==="x",g=Se(p?"size":d,a,s,{vgChannel:d});let m;(o.size||g!==void 0)&&(p?m=xt("size",i,{vgChannel:d,defaultValue:g}):j(lae(a.type)));const v=(r=se(t)?pf({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)!==null&&r!==void 0?r:1;m=m||{[d]:ble(e,d,c,f,s,v)};const y=(f==null?void 0:f.get("type"))!=="band"||!("band"in m[d]),b=lj(n,a,s,y?"middle":"top"),E=wf(n,a),x=Jx({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:E,defaultRef:C2({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:y?.5:(1-v)/2});if(d)return Object.assign({[b]:x},m);{const k=Ma(h),w=m[d],A=E?Object.assign(Object.assign({},w),{offset:E}):w;return{[b]:x,[k]:I(x)?[x[0],Object.assign(Object.assign({},x[1]),{offset:A})]:Object.assign(Object.assign({},x),{offset:A})}}}function xf(e,t,n,i,r){if(KF(e))return 0;const a=e==="x"||e==="y2"?-t/2:t/2;if(oe(n)){const o=mf(r);return{signal:`${n.signal} ? ${i-a}${o?"-"+o:""} : ${i+a}${o?"+"+o:""}`}}else{if(oe(r)){const o=i+(n?-a:a);return{signal:`${o||""}${n?" - ":o?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-a:+r+a)}}function xle({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=ar(n),f=Ma(n),d=Ma(c),h=wf(n,a);if(Me(e.bin)||e.timeUnit)return{[d]:cj({channel:n,fieldDef:e,scaleName:r,markDef:a,band:(1-i)/2,offset:xf(c,o,l,s,h),config:u}),[f]:cj({channel:n,fieldDef:e,scaleName:r,markDef:a,band:1-(1-i)/2,offset:xf(n,o,l,s,h),config:u})};if(an(e.bin)){const p=os(e,r,{},{offset:xf(c,o,l,s,h)});if(q(t))return{[d]:p,[f]:os(t,r,{},{offset:xf(n,o,l,s,h)})};if(cf(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${U(e,{expr:"datum"})} + ${e.bin.step})`,offset:xf(n,o,l,s,h)}}}j(EI(c));return}function cj({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:a,config:o}){const s=Gg({scaleName:n,fieldOrDatumDef:t,band:r,offset:a});return UI({fieldDef:t,channel:e,markDef:i,ref:s,config:o})}const Ele=new Set(["aria"]);function oi(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?sj(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},kle(e.markDef,t)),fj(e,"fill",n)),fj(e,"stroke",i)),xt("opacity",e)),xt("fillOpacity",e)),xt("strokeOpacity",e)),xt("strokeWidth",e)),xt("strokeDash",e)),rj(e)),T2(e,"href")),fle(e))}function fj(e,t,n){const{config:i,mark:r,markDef:a}=e,o=Se("invalid",a,i);if(o==="hide"&&n&&!es(r)){const s=_le(e,{invalid:!0,channels:Pg});if(s)return{[t]:[{test:s,value:null},...G(n)]}}return n?{[t]:n}:{}}function kle(e,t){return Hae.reduce((n,i)=>(!Ele.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=nt(e[i])),n),{})}function _le(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ai(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>Kx(o,t)).join(` ${a} `)}return}function $2(e){const{config:t,markDef:n}=e,i=Se("invalid",n,t);if(i){const r=Ale(e,{channels:ri});if(r)return{defined:{signal:r}}}return{}}function Ale(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ai(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>Kx(o,t)).join(` ${a} `)}return}function dj(e,t){return t!==void 0?{[e]:nt(t)}:void 0}const D2="voronoi",hj={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(D2)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,a=e.mark;if(es(a))return j(Fre(a)),n;const o={name:e.getName(D2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},rj(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((u,c)=>{var f;const d=(f=u.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?s=c:d.indexOf(D2)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}};class De{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){if(this._children.indexOf(e)>-1){console.warn("Attempt to add the same child twice.");return}t!==void 0?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class sn extends De{constructor(e,t,n,i){super(e,t);this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor();return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return this._hash===void 0&&(this._hash=`Output ${qie()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class Hr extends De{constructor(e,t){super(e);this.formula=t}clone(){return new Hr(null,pe(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{const{field:o,timeUnit:s}=r,l=Je(t)?t.encoding[ar(a)]:void 0,u=Je(t)&&t2(a,r,l,t.stack,t.markDef,t.config);if(s){const c=U(r,{forAs:!0});i[we({as:c,field:o,timeUnit:s})]=Object.assign({as:c,field:o,timeUnit:s},u?{band:!0}:{})}return i},{});return Fe(n)?null:new Hr(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=Z(n,["timeUnit"]),a=on(i),o=Object.assign(Object.assign({},r),{timeUnit:a});return new Hr(e,{[we(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)(!this.formula[t]||e.formula[t].band)&&(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Ca(this.formula).map(e=>e.as))}dependentFields(){return new Set(Ca(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${we(this.formula)}`}assemble(){const e=[];for(const t of Ca(this.formula)){const{field:n,as:i,timeUnit:r}=t,a=on(r),{unit:o,utc:s}=a,l=Z(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:$a(n),type:"timeunit"},o?{units:Bx(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return e}}const Ef="_tuple_fields";class Sle{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const Ole={has:()=>!0,parse:(e,t,n)=>{var i,r,a;const o=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new Sle(),l={},u={},c=new Set(),f=(d,h)=>{const p=h==="visual"?d.channel:d.field;let g=qe(`${o}_${p}`);for(let m=1;c.has(g);m++)g=qe(`${o}_${p}_${m}`);return c.add(g),{[h]:g}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const h of G(n.init))for(const p of z(h))xre(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(j('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const h={type:"E",field:d};h.signals=Object.assign({},f(h,"data")),s.items.push(h),s.hasField[d]=h}for(const d of(a=n.encodings)!==null&&a!==void 0?a:[]){const h=e.fieldDef(d);if(h){let p=h.field;if(h.aggregate){j(Nre(d,h.aggregate));continue}else if(!p){j(fI(d));continue}if(h.timeUnit){p=e.vgField(d);const g={timeUnit:h.timeUnit,as:p,field:h.field};u[we(g)]=g}if(!l[p]){let g="E";if(t.type==="interval"){const v=e.getScaleComponent(d).get("type");ai(v)&&(g="R")}else h.bin&&(g="R-RE");const m={field:p,channel:d,type:g};m.signals=Object.assign(Object.assign({},f(m,"data")),f(m,"visual")),s.items.push(l[p]=m),s.hasField[p]=s.hasChannel[d]=l[p]}}else j(fI(d))}if(n.init){const d=h=>s.items.map(p=>h[p.channel]!==void 0?h[p.channel]:h[p.field]);if(n.type==="interval")t.init=d(n.init);else{const h=G(n.init);t.init=h.map(d)}}Fe(u)||(s.timeUnit=new Hr(null,u))},signals:(e,t,n)=>{const i=t.name+Ef,r=n.filter(a=>a.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(a=>{const o=Z(a,["signals","hasLegend"]);return o.field=$a(o.field),o})})}},pj={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!y2(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,a=t.bind,o=t.init&&t.init[0],s=hj.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((l,u)=>{var c,f;const d=qe(`${i}_${l.field}`),h=n.filter(p=>p.name===d);h.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Bl(o[u])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${B(l.field)}] : null`}]:[],bind:(f=(c=a[l.field])!==null&&c!==void 0?c:a[l.channel])!==null&&f!==void 0?f:a}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.filter(u=>u.name===i+hr)[0],o=i+Ef,s=r.items.map(u=>qe(`${i}_${u.field}`)),l=s.map(u=>`${u} !== null`).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},dm="_toggle",gj={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+dm,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+hr,i=t.name+dm;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Yr(e)}}, `)+`${i} ? ${n} : null`}},Tle={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=Y(n.clear)?Vo(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(pj.has(t))for(const i of t.project.items){const r=n.findIndex(a=>a.name===qe(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,a){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:a})}if(t.type==="interval")for(const r of t.project.items){const a=n.findIndex(o=>o.name===r.signals.visual);if(i(a,"[0, 0]"),a===-1){const o=n.findIndex(s=>s.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(a=>a.name===t.name+hr);i(r,"null"),gj.has(t)&&(r=n.findIndex(a=>a.name===t.name+dm),i(r,"false"))}return n}},Ya={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!La(r))continue;const a=e.getScaleComponent(r),o=a?a.get("type"):void 0;if(!a||!ai(o)){j(Mre);continue}const s={selection:t.name,field:i.field};a.set("selectionExtent",s,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(s=>s.name===o.signals.data).length===0);if(!e.parent||N2(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let a=r.update;if(a.indexOf(Sj)>=0)r.update=`{${i.map(o=>`${B(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const s=`${B(o.field)}: ${o.signals.data}`;a.indexOf(s)<0&&(a=`${a.substring(0,a.length-1)}, ${s}}`)}r.update=a}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!N2(e))for(const i of t.scales){const r=n.filter(a=>a.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function R2(e,t){const n=B(e.scaleName(t));return`domain(${n})`}function N2(e){var t;return e.parent&&Yl(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:N2(e.parent.parent))}const mj={has:e=>{const t=e.resolve==="global"&&e.bind&&y2(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==zl;return t&&!n&&j(jre),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const l of t.events)l.filter=G((r=l.filter)!==null&&r!==void 0?r:[]),l.filter.indexOf(s)<0&&l.filter.push(s)}const a=b2(t.bind)?t.bind.legend:"click",o=Y(a)?Vo(a,"view"):G(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=b2(t.bind)&&t.bind.legend,a=o=>s=>{const l=pe(s);return l.markname=o,l};for(const o of t.project.items){if(!o.hasLegend)continue;const s=`${qe(o.field)}_legend`,l=`${i}_${s}`,u=n.filter(c=>c.name===l);if(u.length===0){const c=r.merge.map(a(`${s}_symbols`)).concat(r.merge.map(a(`${s}_labels`))).concat(r.merge.map(a(`${s}_entries`)));n.unshift(Object.assign(Object.assign({name:l},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${l}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.find(d=>d.name===i+hr),o=i+Ef,s=r.items.filter(d=>d.hasLegend).map(d=>qe(`${i}_${qe(d.field)}_legend`)),l=s.map(d=>`${d} !== null`).join(" && "),u=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(d=>({signal:d})),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);const c=n.find(d=>d.name===i+dm),f=b2(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function Cle(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;gs(e,a=>{var o,s;const l=(o=a.project.hasField[r])!==null&&o!==void 0?o:a.project.hasChannel[t];if(l&&mj.has(a)){const u=(s=n.get("selections"))!==null&&s!==void 0?s:[];u.push(a.name),n.set("selections",u,!1),l.hasLegend=!0}})}const vj="_translate_anchor",yj="_translate_delta",$le={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Ya.has(t),a=i+vj,{x:o,y:s}=t.project.hasChannel;let l=Vo(t.translate,"scope");return r||(l=l.map(u=>(u.between[0].markname=i+kf,u))),n.push({name:a,value:{},on:[{events:l.map(u=>u.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?R2(e,He):`slice(${o.signals.visual})`):"")+(s!==void 0?", extent_y: "+(r?R2(e,ct):`slice(${s.signals.visual})`):"")+"}"}]},{name:i+yj,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),o!==void 0&&bj(e,t,o,"width",n),s!==void 0&&bj(e,t,s,"height",n),n}};function bj(e,t,n,i,r){var a;const o=t.name,s=o+vj,l=o+yj,u=n.channel,c=Ya.has(t),f=r.filter(E=>E.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(u),p=h.get("type"),g=c&&u===He?"-":"",m=`${s}.extent_${u}`,v=`${g}${l}.${u} / `+(c?`${d}`:`span(${m})`),y=c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear",b=`${y}(${m}, ${v}`+(c&&p==="pow"?`, ${(a=h.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?b:`clampRange(${b}, 0, ${d})`})}const wj="_zoom_anchor",xj="_zoom_delta",Dle={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Ya.has(t),a=i+xj,{x:o,y:s}=t.project.hasChannel,l=B(e.scaleName(He)),u=B(e.scaleName(ct));let c=Vo(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+kf,f))),n.push({name:i+wj,on:[{events:c,update:r?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&Ej(e,t,o,"width",n),s!==void 0&&Ej(e,t,s,"height",n),n}};function Ej(e,t,n,i,r){var a;const o=t.name,s=n.channel,l=Ya.has(t),u=r.filter(y=>y.name===n.signals[l?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?R2(e,s):u.name,p=o+xj,g=`${o}${wj}.${s}`,m=l?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=`${m}(${h}, ${g}, ${p}`+(l&&d==="pow"?`, ${(a=f.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?v:`clampRange(${v}, 0, ${c})`})}const Rle=[Ole,gj,Ya,mj,$le,Dle,pj,hj,Tle];function hm(e,t){for(const n of Rle)n.has(e)&&t(n)}function Bl(e,t=!0,n=Yt){if(I(e)){const i=e.map(r=>Bl(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Ml(e))return n(t?ff(e):Mae(e));return t?n(JSON.stringify(e)):e}function Nle(e,t){return gs(e,(n,i)=>{const r=n.name;let a=i.modifyExpr(e,n);t.push(...i.signals(e,n)),hm(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(a=o.modifyExpr(e,n,a))}),t.push({name:r+qle,on:[{events:{signal:n.name+hr},update:`modify(${B(n.name+ps)}, ${a})`}]})}),F2(t)}function Fle(e,t){if(e.component.selection&&z(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Vo("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return F2(t)}function Ile(e,t){let n=!1;if(gs(e,(i,r)=>{const a=i.name,o=B(a+ps),s=t.filter(l=>l.name===a);if(s.length===0){const l=i.resolve==="global"?"union":i.resolve,u=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${Sj}(${o}, ${B(l)}${u}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),hm(i,l=>{l.topLevelSignals&&(t=l.topLevelSignals(e,i,t))})}),n){const i=t.filter(r=>r.name==="unit");i.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return F2(t)}function Mle(e,t){const n=[...t];return gs(e,i=>{const r={name:i.name+ps};if(i.init){const o=i.project.items.map(l=>{const u=Z(l,["signals"]);return u}),s=i.init.map(l=>Bl(l,!1));r.values=i.type==="interval"?[{unit:Yr(e,{escape:!1}),fields:o,values:s}]:s.map(l=>({unit:Yr(e,{escape:!1}),fields:o,values:l}))}const a=n.filter(o=>o.name===i.name+ps);a.length||n.push(r)}),n}function kj(e,t){return gs(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,hm(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function jle(e,t){for(const n of e.children)Je(n)&&(t=kj(n,t));return t}function Lle(e,t){const n=t.selection,i=e.getSelectionComponent(n,qe(n));return{signal:$j(i,t)}}function F2(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const kf="_brush",I2="_scale_trigger",Ple={signals:(e,t)=>{const n=t.name,i=n+Ef,r=Ya.has(t),a=[],o=[],s=[];if(t.translate&&!r){const c=`!event.item || event.item.mark.name !== ${B(n+kf)}`;_j(t,(f,d)=>{var h;const p=G((h=d.between[0].filter)!==null&&h!==void 0?h:d.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==He&&d!==ct){j("Interval selections only support x and y encoding channels.");return}const h=t.init?t.init[f]:null,p=zle(e,t,c,h),g=c.signals.data,m=c.signals.visual,v=B(e.scaleName(d)),y=e.getScaleComponent(d).get("type"),b=ai(y)?"+":"";a.push(...p),o.push(g),s.push({scaleName:e.scaleName(d),expr:`(!isArray(${g}) || (${b}invert(${v}, ${m})[0] === ${b}${g}[0] && ${b}invert(${v}, ${m})[1] === ${b}${g}[1]))`})}),r||a.push({name:n+I2,value:{},on:[{events:s.map(c=>({scale:c.scaleName})),update:s.map(c=>c.expr).join(" && ")+` ? ${n+I2} : {}`}]});const l=t.init,u=`unit: ${Yr(e)}, fields: ${i}, values`;return a.concat(Object.assign(Object.assign({name:n+hr},l?{init:`{${u}: ${Bl(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>{const n=t.name+hr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Yr(e)}}`)},marks:(e,t,n)=>{const i=t.name,{x:r,y:a}=t.project.hasChannel,o=r&&r.signals.visual,s=a&&a.signals.visual,l=`data(${B(t.name+ps)})`;if(Ya.has(t))return n;const u={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:a!==void 0?{signal:`${s}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:a!==void 0?{signal:`${s}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of z(u))u[m]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${Yr(e)}`},u[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=Z(c,["fill","fillOpacity","cursor"]),g=z(p).reduce((m,v)=>(m[v]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,a!==void 0&&`${s}[0] !== ${s}[1]`].filter(y=>y).join(" && "),value:p[v]},{value:null}],m),{});return[{name:i+kf+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:i+kf,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),g)}}]}};function zle(e,t,n,i){const r=n.channel,a=n.signals.visual,o=n.signals.data,s=Ya.has(t),l=B(e.scaleName(r)),u=e.getScaleComponent(r),c=u?u.get("type"):void 0,f=g=>`scale(${l}, ${g})`,d=e.getSizeSignalRef(r===He?"width":"height").signal,h=`${r}(unit)`,p=_j(t,(g,m)=>[...g,{events:m.between[0],update:`[${h}, ${h}]`},{events:m,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]);return p.push({events:{signal:t.name+I2},update:ai(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},i?{init:Bl(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:Bl(i)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}function _j(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(j(`${i} is not an ordered event stream for interval selections.`),n),[])}function Aj(e,t){const n=t.name,i=n+Ef,r=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(u=>{const c=e.fieldDef(u.channel);return c&&c.bin?`[${a}[${B(e.vgField(u.channel,{}))}], ${a}[${B(e.vgField(u.channel,{binSuffix:"end"}))}]]`:`${a}[${B(u.field)}]`}).join(", "),s=`unit: ${Yr(e)}, fields: ${i}, values`,l=t.events;return[{name:n+hr,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const Ble={signals:Aj,modifyExpr:(e,t)=>{const n=t.name+hr;return n+", "+(t.resolve==="global"?"null":`{unit: ${Yr(e)}}`)}},Ule={signals:Aj,modifyExpr:(e,t)=>{const n=t.name+hr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Yr(e)}}`)}},ps="_store",hr="_tuple",qle="_modify",Sj="vlSelectionResolve",Wle={single:Ule,multi:Ble,interval:Ple};function gs(e,t){const n=e.component.selection;if(n)for(const i of Ca(n)){const r=t(i,Wle[i.type]);if(r===!0)break}}function Gle(e){let t=e.parent;for(;t&&!Di(t);)t=t.parent;return t}function Yr(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=Gle(e);if(i){const{facet:r}=i;for(const a of ii)r[a]&&(n+=` + '__facet_${a}_' + (facet[${B(i.vgField(a))}])`)}return n}function M2(e){let t=!1;return gs(e,n=>{t=t||n.project.items.some(i=>i.field===zl)}),t}function j2(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...j2(e.object)),t.push(...j2(e.property))),t)}function Oj(e){return e.object.type==="MemberExpression"?Oj(e.object):e.object.name==="datum"}function Tj(e){const t=VR(e),n=new Set();return t.visit(i=>{i.type==="MemberExpression"&&Oj(i)&&n.add(j2(i).slice(1).join("."))}),n}class _f extends De{constructor(e,t,n){super(e);this.model=t,this.filter=n,this.expr=pm(this.model,this.filter,this),this._dependentFields=Tj(this.expr)}clone(){return new _f(null,this.model,pe(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set()}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Hle(e,t){var n;const i={},r=e.config.selection;for(const a of z(t??{})){const o=pe(t[a]),s=r[o.type],l=Z(s,["fields","encodings"]);for(const f in l){if(f==="encodings"&&o.fields||f==="fields"&&o.encodings)continue;f==="mark"&&(o[f]=Object.assign(Object.assign({},l[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=l[f])!==null&&n!==void 0?n:o[f])}const u=qe(a),c=i[u]=Object.assign(Object.assign({},o),{name:u,events:Y(o.on)?Vo(o.on,"scope"):pe(o.on)});hm(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[a])})}return i}function Cj(e,t,n,i="datum"){const r=[];function a(s){const l=qe(s),u=e.getSelectionComponent(l,s),c=B(l+ps);if(u.project.timeUnit){const f=n??e.component.data.raw,d=u.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return u.empty!=="none"&&r.push(c),`vlSelectionTest(${c}, ${i}`+(u.resolve==="global"?")":`, ${B(u.resolve)})`)}const o=af(t,a);return(r.length?"!("+r.map(s=>`length(data(${s}))`).join(" || ")+") || ":"")+`(${o})`}function $j(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&j(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${B(i)}.`);else if(n&&!i){const r=e.project.items.filter(a=>a.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,j((r.length?"Multiple ":"No ")+`matching ${B(n)} encoding found for selection ${B(t.selection)}. Using "field": ${B(i)}.`)):i=r[0].field}return`${e.name}[${B(i)}]`}function Yle(e,t){gs(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new sn(new _f(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)})}function pm(e,t,n){return af(t,i=>Y(i)?i:Vae(i)?Cj(e,i.selection,n):FI(i))}function Vle(e,t){return e?I(e)&&!qa(e)?e.map(n=>uM(n,t)).join(", "):e:void 0}function L2(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function Af(e,t,n,i={header:!1}){var r,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=Z(o,["disable","orient","scale","labelExpr","title","zindex"]);if(s)return;for(const p in h){const g=Hie[p],m=h[p];if(g&&g!==t&&g!=="both")delete h[p];else if(Sx(m)){const{condition:v}=m,y=Z(m,["condition"]),b=G(v),E=LF[p];if(E){const{vgProp:x,part:k}=E,w=[...b.map(A=>{const{test:_}=A,O=Z(A,["test"]);return Object.assign({test:pm(null,_)},O)}),y];L2(h,k,x,w),delete h[p]}else if(E===null){const x={signal:b.map(k=>{const{test:w}=k,A=Z(k,["test"]);return`${pm(null,w)} ? ${hM(A)} : `}).join("")+hM(y)};h[p]=x}}else if(oe(m)){const v=LF[p];if(v){const{vgProp:y,part:b}=v;L2(h,b,y,m),delete h[p]}}}if(t==="grid"){if(!h.grid)return;if(h.encode){const{grid:p}=h.encode;h.encode=Object.assign({},p?{grid:p}:{}),Fe(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:rt(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let g=c;((a=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||a===void 0?void 0:a.update)&&oe(h.encode.labels.update.text)&&(g=Nl(c,"datum.label",h.encode.labels.update.text.signal)),L2(h,"labels","text",{signal:g})}if(h.labelAlign===null&&delete h.labelAlign,h.encode){for(const g of PF)e.hasAxisPart(g)||delete h.encode[g];Fe(h.encode)&&delete h.encode}const p=Vle(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},p?{title:p}:{}),h),n.aria===!1?{aria:!1}:{}),{zindex:rt(d,0)})}}function Dj(e){const{axes:t}=e.component,n=[];for(const i of ri)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const a=i==="x"?"height":"width",o=e.getSizeSignalRef(a).signal;a!==o&&n.push({name:a,update:o})}}return n}function Xle(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Af(r,"grid",t)),...i.map(r=>Af(r,"grid",t)),...n.map(r=>Af(r,"main",t)),...i.map(r=>Af(r,"main",t))].filter(r=>r)}const Rj={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Nj={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Jle=z(Rj),Kle=z(Nj);function Fj(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const a=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},s=t[n==="x"?"axisTop":"axisRight"]||{},l=new Set([...z(o),...z(s)]),u={};for(const c of l.values())u[c]={signal:`${i.signal} === "${a}" ? ${mf(o[c])} : ${mf(s[c])}`};return u}return t[r]})])}function Qle(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:ooe(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],a=e==="x"?"axisX":"axisY",o=oe(n)?"axisOrient":"axis"+Ag(n),s=[...r,...r.map(u=>a+u.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:Fj(s,i,e,n),vgAxisConfig:Fj(l,i,e,n),axisConfigStyle:Zle([...l,...s],i)}}function Zle(e,t){var n;const i=[{}];for(const r of e){let a=(n=t[r])===null||n===void 0?void 0:n.style;if(a){a=G(a);for(const o of a)i.push(t.style[o])}}return Object.assign.apply(null,i)}function P2(e,t,n,i={}){var r;const a=gM(e,n,t.style);if(a!==void 0)return{configFrom:"style",configValue:a};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const Ij={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return HI(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return YI(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return q(e)&&an(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:eue(n,e)},gridScale:({model:e,channel:t})=>tue(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||jj(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||Mj(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:iue(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:rue(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var a;const o=e==="x"?"width":e==="y"?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return(a=n.tickCount)!==null&&a!==void 0?a:oue({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=Lj(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),a=n==="x"?"x2":"y2",o=t.fieldDef(a);return vM(r?[eM(r)]:[],q(o)?[eM(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>sue(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:lue(n,t)}};function eue(e,t){return!On(e)&&q(t)&&!Me(t==null?void 0:t.bin)}function tue(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function nue(e,t,n,i,r){const a=t==null?void 0:t.labelAngle;if(a!==void 0)return oe(a)?a:Sg(a);{const{configValue:o}=P2("labelAngle",e.config,t==null?void 0:t.style,r);return o!==void 0?Sg(o):n===He&&ae([Vx,Yx],i.type)?270:void 0}}function z2(e){return`(((${e.signal} % 360) + 360) % 360)`}function Mj(e,t,n,i){if(e!==void 0)if(n==="x"){if(oe(e)){const r=z2(e),a=oe(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${a} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(oe(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(oe(e)){const r=z2(e),a=oe(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${a} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(oe(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function jj(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,a=i?"bottom":"left";if(oe(e)){const o=z2(e),s=oe(t)?`(${t.signal} === "${a}")`:t===a;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${s} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(oe(t)){const o=r<e&&e<180+r?"===":"!==",s=`${t.signal} ${o} "${a}"`;return{signal:`${s} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===a)?"left":"right"}function iue(e,t){return t==="x"&&ae(["quantitative","temporal"],e)?!0:void 0}function rue(e,t){return e!=="nominal"?t==="log"?"greedy":!0:void 0}function aue(e){return e==="x"?"bottom":"left"}function oue({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!On(t)&&t!=="log"){if(q(e)){if(Me(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&ae(["month","hours","day","quarter"],(r=on(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function Lj(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),a=i?i.title:void 0,o=r?r.title:void 0;return a&&o?yM(a,o):a||(o||(a!==void 0?a:o!==void 0?o:void 0))}function sue(e,t){const n=e.values;return I(n)?fM(t,n):oe(n)?n:void 0}function lue(e,t){return e==="rect"&&rM(t)?1:0}class Sf extends De{constructor(e,t){super(e);this.transform=t,this._dependentFields=Tj(this.transform.calculate)}clone(){return new Sf(null,pe(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((n,i)=>{if(!a2(n))return;if(ZI(n.sort)){const{field:r,timeUnit:a}=n,o=n.sort,s=o.map((l,u)=>`${FI({field:r,timeUnit:a,equal:l})} ? ${u} : `).join("")+o.length;e=new Sf(e,{calculate:s,as:Ul(n,i,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${we(this.transform)}`}}function Ul(e,t,n){return U(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function gm(e,t){return ae(["top","bottom"],t)?"column":ae(["left","right"],t)||e==="row"?"row":"column"}function ql(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return rt(((t==null?void 0:t.header)||{})[e],r[e],n.header[e])}function mm(e,t,n,i){const r={};for(const a of e){const o=ql(a,t,n,i);o!==void 0&&(r[a]=o)}return r}const B2=["row","column"],U2=["header","footer"];function uue(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=mm(["titleAnchor","titleAngle","titleOrient"],r,i,t),l=gm(t,s),u=Sg(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),zj(u,l)),Pj(l,u,a)),Bj(i,r,t,Jle,Rj))}}function Pj(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=jj(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function zj(e,t){const n=Mj(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function cue(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of U2)if(n[r])for(const a of n[r]){const o=due(e,t,r,n,a);o!=null&&i.push(o)}return i}function fue(e,t){var n;const{sort:i}=e;return ur(i)?{field:U(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:I(i)?{field:Ul(e,t,{expr:"datum"}),order:"ascending"}:{field:U(e,{expr:"datum"}),order:i??"ascending"}}function q2(e,t,n){const{format:i,formatType:r,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=mm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),u=Qx({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=gm(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?Nl(Nl(l,"datum.label",u),"datum.value",U(e,{expr:"parent"})):u}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),zj(a,c)),Pj(c,a,o)),Bj(n,e,t,Kle,Nj))}function due(e,t,n,i,r){if(r){let a=null;const{facetFieldDef:o}=i,s=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=mm(["labelOrient"],o,s,t);(t==="row"&&!ae(["top","bottom"],f)||t==="column"&&!ae(["left","right"],f))&&(a=q2(o,t,s))}const l=Di(e)&&!hf(e.facet),u=r.axes,c=(u==null?void 0:u.length)>0;if(a||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:fue(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const hue={column:{start:0,end:1},row:{start:1,end:0}};function pue(e,t){return hue[t][e]}function gue(e,t){const n={};for(const i of ii){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:a,titleOrient:o}=mm(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),s=gm(i,o),l=pue(a,s);l!==void 0&&(n[s]=l)}}return Fe(n)?void 0:n}function Bj(e,t,n,i,r){const a={};for(const o of i){if(!r[o])continue;const s=ql(o,t,e,n);s!==void 0&&(a[r[o]]=s)}return a}function W2(e){return[...vm(e,"width"),...vm(e,"height"),...vm(e,"childWidth"),...vm(e,"childHeight")]}function vm(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const a=e.getScaleComponent(n);if(a){const o=a.get("type"),s=a.get("range");if(On(o)&&Pa(s)){const l=e.scaleName(n);if(Di(e.parent)){const u=e.parent.component.resolve;if(u.scale[n]==="independent")return[Uj(l,s)]}return[Uj(l,s),{name:r,update:qj(l,a,`domain('${l}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const a=r.endsWith("width"),o=a?"containerSize()[0]":"containerSize()[1]",s=E2(e.config.view,a?"width":"height"),l=`isFinite(${o}) ? ${o} : ${s}`;return[{name:r,init:l,on:[{update:l,events:"window:resize"}]}]}else return[{name:r,value:i}]}function Uj(e,t){return{name:e+"_step",value:t.step}}function qj(e,t,n){const i=t.get("type"),r=t.get("padding"),a=rt(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${o}, ${a}) * ${e}_step`}function Wj(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Gj(e,t){return z(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),bf(t,r,i,a=>oe(a)?a:{value:a.value}))},{})}function mue(e,t){if(Yl(t)||Di(t))return"shared";if(iE(t))return sr(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function G2(e,t){const n=e.scale[t],i=sr(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&j(hae(t)),"independent"):e[i][t]||"shared"}const vue=Object.assign(Object.assign({},ose),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Hj=z(vue);class yue extends Wa{}const Yj={symbols:bue,gradient:wue,labels:xue,entries:Eue};function bue(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:a}){var o,s,l,u,c;if(a!=="symbol")return;const{markDef:f,encoding:d,config:h,mark:p}=n,g=f.filled&&p!=="trail";let m=Object.assign(Object.assign({},Poe({},n,Zie)),sj(n,{filled:g}));const v=(o=Vj(d.opacity))!==null&&o!==void 0?o:f.opacity;if(m.fill){if(i==="fill"||g&&i===An)delete m.fill;else if(m.fill.field)r.get("symbolFillColor")?delete m.fill:(m.fill=nt((s=h.legend.symbolBaseFillColor)!==null&&s!==void 0?s:"black"),m.fillOpacity=nt(v??1));else if(I(m.fill)){const y=(c=(u=H2((l=d.fill)!==null&&l!==void 0?l:d.color))!==null&&u!==void 0?u:f.fill)!==null&&c!==void 0?c:g&&f.color;y&&(m.fill=nt(y))}}if(m.stroke){if(i==="stroke"||!g&&i===An)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(I(m.stroke)){const y=rt(H2(d.stroke||d.color),f.stroke,g?f.color:void 0);y&&(m.stroke={value:y})}}if(i!==qr){const y=q(t)&&Jj(n,r,t);y?m.opacity=[Object.assign({test:y},nt(v??1)),nt(h.legend.unselectedOpacity)]:v&&(m.opacity=nt(v))}return m=Object.assign(Object.assign({},m),e),Fe(m)?void 0:m}function wue(e,{model:t,legendType:n}){if(n!=="gradient")return;let i={};const r=Vj(t.encoding.opacity)||t.markDef.opacity;return r&&(i.opacity=nt(r)),i=Object.assign(Object.assign({},i),e),Fe(i)?void 0:i}function xue(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const a=n.legend(i)||{},o=n.config,s=q(t)?Jj(n,r,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=ss(c)?Zx({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return Fe(d)?void 0:d}function Eue(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Vj(e){return Xj(e,(t,n)=>Math.max(t,n.value))}function H2(e){return Xj(e,(t,n)=>rt(t,n.value))}function Xj(e,t){return Coe(e)?G(e.condition).reduce(t,e.value):Wr(e)?e.value:void 0}function Jj(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=B(n.field);return i.map(a=>{const o=B(qe(a)+ps);return`(!length(data(${o})) || (${a}[${r}] && indexof(${a}[${r}], datum.value) >= 0))`}).join(" || ")}const Kj={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return HI(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return YI(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Cue(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:$ue(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:_ue(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>ls(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Fl(n)&&Ci(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>kue(t,e)};function kue(e,t){const n=e.values;return I(n)?fM(t,n):oe(n)?n:void 0}function _ue(e,t,n,i){var r;if(t!=="shape"){const a=(r=H2(n))!==null&&r!==void 0?r:i;if(a)return a}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Aue(e){const{legend:t}=e;return rt(t.type,Sue(e))}function Sue({channel:e,timeUnit:t,scaleType:n}){if(Fl(e)){if(ae(["quarter","month","day"],t))return"symbol";if(Ci(n))return"gradient"}return"symbol"}function Oue({legendConfig:e,legendType:t,orient:n,legend:i}){var r,a;return(a=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&a!==void 0?a:Tue(n,t)}function Tue(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Cue({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;return Ci(r)?n==="horizontal"?i==="top"||i==="bottom"?Qj(t,"width",o,a):o:Qj(t,"height",l,s):void 0}function Qj(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function $ue(e){return ae(["quantile","threshold","log"],e)?"greedy":void 0}function Zj(e){const t=Je(e)?Due(e):Iue(e);return e.component.legends=t,t}function Due(e){const{encoding:t}=e,n={};for(const i of[An,...FM]){const r=ft(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===Sn&&q(r)&&r.type===Pl)continue;n[i]=Fue(e,i)}return n}function Rue(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Nue(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Fue(e,t){var n,i,r;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new yue({},Rue(e,t));Cle(e,t,c);const f=a!==void 0?!a:u.disable;if(c.set("disable",f,a!==void 0),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=ft(s[t]),p=q(h)?(n=on(h.timeUnit))===null||n===void 0?void 0:n.unit:void 0,g=a.orient||l.legend.orient||"right",m=Aue({legend:a,channel:t,timeUnit:p,scaleType:d}),v=Oue({legend:a,legendType:m,orient:g,legendConfig:u}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:g,legendType:m,direction:v};for(const w of Hj){const A=w in Kj?Kj[w](y):a[w];if(A!==void 0){const _=Nue(A,w,a,e.fieldDef(t));(_||l.legend[w]===void 0)&&c.set(w,A,_)}}const b=(i=a==null?void 0:a.encoding)!==null&&i!==void 0?i:{},E=c.get("selections"),x={},k={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:m};for(const w of["labels","legend","title","symbols","gradient","entries"]){const A=Gj((r=b[w])!==null&&r!==void 0?r:{},e),_=w in Yj?Yj[w](A,k):A;_!==void 0&&!Fe(_)&&(x[w]=Object.assign(Object.assign(Object.assign({},(E==null?void 0:E.length)&&q(h)?{name:`${qe(h.field)}_legend_${w}`}:{}),(E==null?void 0:E.length)?{interactive:!!E}:{}),{update:_}))}return Fe(x)||c.set("encode",x,!!(a==null?void 0:a.encoding)),c}function Iue(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Zj(i);for(const r of z(i.component.legends))n.legend[r]=G2(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=e3(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of z(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function e3(e,t){var n,i,r,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const u of Hj){const c=Ga(e.getWithExplicit(u),t.getWithExplicit(u),u,"legend",(f,d)=>{switch(u){case"symbolType":return Mue(f,d);case"title":return bM(f,d);case"type":return l=!0,Un("symbol")}return om(f,d,u,"legend")});e.setWithExplicit(u,c)}return l&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&_x(e.implicit,["encode","gradient"]),((a=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||a===void 0?void 0:a.gradient)&&_x(e.explicit,["encode","gradient"])),e}function Mue(e,t){return t.value==="circle"?t:e}function t3(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function n3(e){const t=e.component.legends,n={};for(const r of z(t)){const a=e.getScaleComponent(r),o=Ue(a.get("domains"));if(n[o])for(const s of n[o]){const l=e3(s,t[r]);l||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=Ca(n).flat().map(r=>jue(r,e.config)).filter(r=>r!==void 0);return i}function jue(e,t){var n,i,r;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=Z(a,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&u.aria==null&&(u.aria=!1),(n=u.encode)===null||n===void 0?void 0:n.symbols){const c=u.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!u.stroke&&(c.stroke={value:"transparent"});for(const f of FM)u[f]&&delete c[f]}if(u.title||delete u.title,s!==void 0){let c=s;((r=(i=u.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&oe(u.encode.labels.update.text)&&(c=Nl(s,"datum.label",u.encode.labels.update.text.signal)),t3(u,"labels","text",{signal:c})}for(const c in u){const f=u[c];if(oe(f)){const d=rse[c];if(d){const{vgProp:h,part:p}=d;t3(u,p,h,f),delete u[c]}}}return u}function Lue(e){return Yl(e)||iE(e)?Pue(e):i3(e)}function Pue(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),i3(e))}function i3(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},a=t.data.reduce((o,s)=>{const l=oe(s)?s.signal:`data('${e.lookupDataSource(s)}')`;return ae(o,l)||o.push(l),o},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const zue=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class r3 extends Wa{constructor(e,t,n,i){super(Object.assign({},t),{name:e});this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function a3(e){e.component.projection=Je(e)?Bue(e):Wue(e)}function Bue(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=i?Uue(e):void 0;return new r3(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),r,a)}return}function Uue(e){const t=[],{encoding:n}=e;for(const i of[[nr,tr],[ni,Ti]])(ft(n[i[0]])||ft(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Sn)&&e.typedFieldDef(Sn).type===Pl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(qt)),t}function que(e,t){const n=DF(zue,r=>!Q(e.explicit,r)&&!Q(t.explicit,r)?!0:!!(Q(e.explicit,r)&&Q(t.explicit,r)&&Ue(e.get(r))===Ue(t.get(r)))),i=Ue(e.size)===Ue(t.size);if(i){if(n)return e;if(Ue(e.explicit)===Ue({}))return t;if(Ue(t.explicit)===Ue({}))return e}return null}function Wue(e){if(e.children.length===0)return;let t;for(const i of e.children)a3(i);const n=DF(e.children,i=>{const r=i.component.projection;if(r)if(t){const a=que(t,r);return a&&(t=a),!!a}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new r3(i,t.specifiedProjection,t.size,pe(t.data));for(const a of e.children){const o=a.component.projection;o&&(o.isFit&&r.data.push(...a.component.projection.data),a.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}function Gue(e,t,n,i){var r,a;if(gf(t,n)){const o=Je(e)?(a=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&a!==void 0?a:{}:{},s=U(t,{expr:"datum"}),l=U(t,{expr:"datum",binSuffix:"end"});return{formulaAs:U(t,{binSuffix:"range",forAs:!0}),formula:Hg(s,l,o.format,o.formatType,i)}}return{}}function o3(e,t){return`${oI(e)}_${t}`}function Hue(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function Y2(e,t,n){var i;const r=(i=Qg(n,void 0))!==null&&i!==void 0?i:{},a=o3(r,t);return e.getName(`${a}_bins`)}function Yue(e){return"as"in e}function s3(e,t,n){let i,r;Yue(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[U(e,{forAs:!0}),U(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},Qg(t,void 0)),o=o3(a,e.field),{signal:s,extentSignal:l}=Hue(n,o);if(Bg(a.extent)){const c=a.extent,f=c.selection;r=$j(n.getSelectionComponent(qe(f),f),c),delete a.extent}const u=Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[i]},s?{signal:s}:{}),l?{extentSignal:l}:{}),r?{span:r}:{});return{key:o,binComponent:u}}class Vr extends De{constructor(e,t){super(e);this.bins=t}clone(){return new Vr(null,pe(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{if(Bn(r)&&Me(r.bin)){const{key:o,binComponent:s}=s3(r,r.bin,t);i[o]=Object.assign(Object.assign(Object.assign({},s),i[o]),Gue(t,r,a,t.config))}return i},{});return Fe(n)?null:new Vr(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=s3(t,t.bin,n);return new Vr(e,{[i]:r})}merge(e,t){for(const n of z(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=Ta([...this.bins[n].as,...e.bins[n].as],we)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(Ca(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(Ca(this.bins).map(e=>e.field))}hash(){return`Bin ${we(this.bins)}`}assemble(){return Ca(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:a}=r,o=Z(r,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:$a(e.field),as:n,signal:e.signal},Bg(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:$a(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const l of i)for(let u=0;u<2;u++)t.push({type:"formula",expr:U({field:n[u]},{expr:"datum"}),as:l[u]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class Wl extends De{constructor(e){super(null);e=e??{name:"source"};let t;if(hs(e)||(t=e.format?Object.assign({},Mr(e.format,["parse"])):{}),sm(e))this._data={values:e.values};else if(yf(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];ae(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else nj(e)?this._data={values:[{type:"Sphere"}]}:(ej(e)||hs(e))&&(this._data={});this._generator=hs(e),e.name&&(this._name=e.name),t&&!Fe(t)&&(this._data.format=t)}dependentFields(){return new Set()}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function V2(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!V2(t.children))return!1}return!0}class ym extends De{constructor(e,t){super(e);this.params=t}clone(){return new ym(null,this.params)}dependentFields(){return new Set()}producedFields(){return}hash(){return`Graticule ${we(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class bm extends De{constructor(e,t){super(e);this.params=t}clone(){return new bm(null,this.params)}dependentFields(){return new Set()}producedFields(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])}hash(){return`Hash ${we(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function wm(e){return e instanceof Wl||e instanceof ym||e instanceof bm}class l3{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Xr extends l3{constructor(){super();this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(wm(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class X2 extends l3{}function Vue(e,t,n,i){const r=Je(i)?i.encoding[ar(t)]:void 0;if(Bn(n)&&Je(i)&&t2(t,n,r,i.stack,i.markDef,i.config))e.add(U(n,{})),e.add(U(n,{suffix:"end"})),n.bin&&gf(n,t)&&e.add(U(n,{binSuffix:"range"}));else if(vre(t)){const a=mre(t);e.add(i.getName(a))}else e.add(U(n));return e}function Xue(e,t){var n;for(const i of z(t)){const r=t[i];for(const a of z(r))i in e?e[i][a]=new Set([...(n=e[i][a])!==null&&n!==void 0?n:[],...r[a]]):e[i]={[a]:r[a]}}}class pr extends De{constructor(e,t,n){super(e);this.dimensions=t,this.measures=n}clone(){return new pr(null,new Set(this.dimensions),pe(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(a=>{a.aggregate&&(n=!0)});const i={},r=new Set();return n?(t.forEachFieldDef((a,o)=>{var s,l,u,c;const{aggregate:f,field:d}=a;if(f)if(f==="count")i["*"]=(s=i["*"])!==null&&s!==void 0?s:{},i["*"].count=new Set([U(a,{forAs:!0})]);else{if(Da(f)||ts(f)){const h=Da(f)?"argmin":"argmax",p=f[h];i[p]=(l=i[p])!==null&&l!==void 0?l:{},i[p][h]=new Set([U({op:h,field:p},{forAs:!0})])}else i[d]=(u=i[d])!==null&&u!==void 0?u:{},i[d][f]=new Set([U(a,{forAs:!0})]);La(o)&&t.scaleDomain(o)==="unaggregated"&&(i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d].min=new Set([U({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([U({field:d,aggregate:"max"},{forAs:!0})]))}else Vue(r,o,a,t)}),r.size+z(i).length===0?null:new pr(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const a=new Set(),o={};for(const s of t.aggregate){const{op:l,field:u,as:c}=s;l&&(l==="count"?(o["*"]=(n=o["*"])!==null&&n!==void 0?n:{},o["*"].count=new Set([c||U(s,{forAs:!0})])):(o[u]=(i=o[u])!==null&&i!==void 0?i:{},o[u][l]=new Set([c||U(s,{forAs:!0})])))}for(const s of(r=t.groupby)!==null&&r!==void 0?r:[])a.add(s);return a.size+z(o).length===0?null:new pr(e,a,o)}merge(e){return Pie(this.dimensions,e.dimensions)?(Xue(this.measures,e.measures),!0):(Cae("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...z(this.measures)])}producedFields(){const e=new Set();for(const t of z(this.measures))for(const n of z(this.measures[t])){const i=this.measures[t][n];i.size===0?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${we({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of z(this.measures))for(const a of z(this.measures[r]))for(const o of this.measures[r][a])n.push(o),e.push(a),t.push(r==="*"?null:$a(r));const i={type:"aggregate",groupby:[...this.dimensions].map($a),ops:e,fields:t,as:n};return i}}class Gl extends De{constructor(e,t,n,i){super(e);this.model=t,this.name=n,this.data=i;for(const r of ii){const a=t.facet[r];if(a){const{bin:o,sort:s}=a;this[r]=Object.assign({name:t.getName(`${r}_domain`),fields:[U(a),...Me(o)?[U(a,{binSuffix:"end"})]:[]]},ur(s)?{sortField:s}:I(s)?{sortIndexField:Ul(a,r)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of ii)this[t]&&(e+=` ${t.charAt(0)}:${we(this[t])}`);return e}get fields(){var e;const t=[];for(const n of ii)((e=this[n])===null||e===void 0?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of ii)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set()}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of ri){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(On(i)&&Pa(r)){const a=Em(this.childModel,t),o=tE(a);o?e[t]=o:j(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],a=[],o=[];n&&n[i]&&(t?(r.push(`distinct_${n[i]}`),a.push("max")):(r.push(n[i]),a.push("distinct")),o.push(`distinct_${n[i]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:u=Yg,field:c}=s;r.push(c),a.push(u),o.push(U(s,{forAs:!0}))}else l&&(r.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:t??this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,a=[],o={};for(const u of B2){for(const c of U2){const f=(t=r[u]&&r[u][c])!==null&&t!==void 0?t:[];for(const d of f)if(((n=d.axes)===null||n===void 0?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const c=`length(data("${this.facet.name}"))`,f=u==="row"?i?{signal:`ceil(${c} / ${i})`}:1:i?{signal:`min(${c}, ${i})`}:{signal:c};a.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((e=r.x)!==null&&e!==void 0?e:[],(t=r.y)!==null&&t!==void 0?t:[]),u=l.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[Pr,Lr])this[l]&&n.push(this.assembleRowColumnHeaderData(l,i,r));if(s){const l=this.assembleFacetHeaderData(r);l&&n.push(...l)}return n}}function u3(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function Jue(e,t){const n=MF(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=u3(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=u3(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return j(Bre(t)),null}function Kue(e){const t={};return Eg(e.filter,n=>{var i;if(NI(n)){let r=null;qx(n)?r=n.equal:Wx(n)?r=n.range[0]:Gx(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Ml(r)?t[n.field]="date":Re(r)?t[n.field]="number":Y(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Que(e){const t={};function n(i){Zg(i)?t[i.field]="date":i.type==="quantitative"&&fre(i.aggregate)?t[i.field]="number":of(i.field)>1?i.field in t||(t[i.field]="flatten"):a2(i)&&ur(i.sort)&&of(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Je(e)||Di(e))&&e.forEachFieldDef((i,r)=>{if(Bn(i))n(i);else{const a=rs(r),o=e.fieldDef(a);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Je(e)){const{mark:i,markDef:r,encoding:a}=e;if(es(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",s=a[o];q(s)&&s.type==="quantitative"&&!(s.field in t)&&(t[s.field]="number")}}return t}function Zue(e){const t={};if(Je(e)&&e.component.selection)for(const n of z(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&of(r.field)>1&&(t[r.field]="flatten")}return t}class ln extends De{constructor(e,t){super(e);this._parse=t}clone(){return new ln(null,pe(this._parse))}hash(){return`Parse ${we(this._parse)}`}static makeExplicit(e,t,n){let i={};const r=t.data;return!hs(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const o of z(n)){const s=i.getWithExplicit(o);s.value!==void 0&&(s.explicit||s.value===n[o]||s.value==="derived"||n[o]==="flatten"?delete n[o]:j(pI(o,n[o],s.value)))}for(const o of z(t)){const s=i.get(o);s!==void 0&&(s===t[o]?delete t[o]:j(pI(o,t[o],s)))}const r=new Wa(t,n);i.copyAll(r);const a={};for(const o of z(r.combine())){const s=r.get(o);s!==null&&(a[o]=s)}return z(a).length===0||i.parseNothing?null:new ln(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of z(this._parse)){const n=this._parse[t];of(t)===1&&(e[t]=n)}return e}producedFields(){return new Set(z(this._parse))}dependentFields(){return new Set(z(this._parse))}assembleTransforms(e=!1){return z(this._parse).filter(t=>e?of(t)>1:!0).map(t=>{const n=Jue(t,this._parse[t]);if(!n)return null;const i={type:"formula",expr:n,as:jF(t)};return i}).filter(t=>t!==null)}}class ms extends De{clone(){return new ms(null)}constructor(e){super(e)}dependentFields(){return new Set()}producedFields(){return new Set([zl])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:zl}}}class Hl extends De{constructor(e,t){super(e);this.transform=t}clone(){return new Hl(null,pe(this.transform))}addDimensions(e){this.transform.groupby=Ta(this.transform.groupby.concat(e),t=>t)}dependentFields(){const e=new Set();return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(t=>t.field).filter(t=>t!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`JoinAggregateTransform ${we(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(r.field===void 0?null:r.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},i!==void 0?{groupby:i}:{})}}function ece(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=U(i);return r&&t.push(r),t},[])}function tce(e){return I(e)&&e.every(t=>Y(t))&&e.length>1}class Va extends De{constructor(e,t){super(e);this._stack=t}clone(){return new Va(null,pe(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:a="zero"}=t,o=[],s=[];if(t.sort!==void 0)for(const c of t.sort)o.push(c.field),s.push(rt(c.order,"ascending"));const l={field:o,order:s};let u;return tce(r)?u=r:Y(r)?u=[r,r+"_end"]:u=[t.stack+"_start",t.stack+"_end"],new Va(e,{stackField:n,groupby:i,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:a,offset:o,impute:s}=n;let l;if(r){const d=i[r];l=fr(d)}const u=ece(t),c=t.encoding.order;let f;return I(c)||q(c)?f=mM(c):f=u.reduce((d,h)=>(d.field.push(h),d.order.push(a==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Va(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set();return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${we(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[U(e,{binSuffix:"mid"})]:[U(e,{}),U(e,{binSuffix:"end"})]:[U(e)]:n??[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:u=.5,bin:c}=n;c&&e.push({type:"formula",expr:`${u}*`+U(n,{expr:"datum"})+`+${1-u}*`+U(n,{expr:"datum",binSuffix:"end"}),as:U(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:U(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:a,as:l,offset:o}),e}}class Of extends De{constructor(e,t){super(e);this.transform=t}clone(){return new Of(null,pe(this.transform))}addDimensions(e){this.transform.groupby=Ta(this.transform.groupby.concat(e),t=>t)}dependentFields(){var e,t;const n=new Set();return((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(n.add,n),((t=this.transform.sort)!==null&&t!==void 0?t:[]).forEach(i=>n.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`WindowTransform ${we(this.transform)}`}assemble(){var e;const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&a[0]===null&&a[1]===null&&n.every(f=>$x(f)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},o!==void 0?{groupby:o}:{});const s=[],l=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)s.push(f.field),l.push((e=f.order)!==null&&e!==void 0?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:u},c!==void 0?{ignorePeers:c}:{}),o!==void 0?{groupby:o}:{}),a!==void 0?{frame:a}:{})}}class nce extends Xr{run(e){const t=e.parent;if(e instanceof ln){if(wm(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof ln)this.setMutated(),t.merge(e);else{if(FF(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class ice extends X2{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(i=>i.hash()),n={};for(let i=0;i<t.length;i++)n[t[i]]===void 0?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const i of z(n))n[i].length>1&&(this.setMutated(),this.mergeNodes(e,n[i]));for(const i of e.children)this.run(i);return this.mutatedFlag}}class rce extends Xr{run(e){return e instanceof sn||e.numChildren()>0||e instanceof Gl?this.flags:(this.setMutated(),e.remove(),this.flags)}}class ace extends Xr{constructor(){super(...arguments);this.fields=new Set(),this.prev=null}run(e){if(this.setContinue(),e instanceof Hr){const t=e.producedFields();RF(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class oce extends Xr{run(e){this.setContinue();const t=e.parent,n=t.children.filter(r=>r instanceof Hr),i=n.pop();for(const r of n)this.setMutated(),i.merge(r);return this.flags}}function sce(e){function t(n){if(!(n instanceof Gl)){const i=n.clone();if(i instanceof sn){const r=K2+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof pr||i instanceof Va||i instanceof Of||i instanceof Hl)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function J2(e){if(e instanceof Gl)if(e.numChildren()===1&&!(e.children[0]instanceof sn)){const t=e.children[0];(t instanceof pr||t instanceof Va||t instanceof Of||t instanceof Hl)&&t.addDimensions(e.fields),t.swapWithParent(),J2(e)}else{const t=e.model.component.data.main;c3(t);const n=sce(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(J2)}function c3(e){if(e instanceof sn&&e.type===qt&&e.numChildren()===1){const t=e.children[0];t instanceof Gl||(t.swapWithParent(),c3(e))}}class lce extends X2{constructor(){super()}run(e){e instanceof sn&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class uce extends X2{constructor(e){super();this.requiresSelectionId=e&&M2(e)}run(e){e instanceof ms&&(this.requiresSelectionId&&(wm(e.parent)||e.parent instanceof pr||e.parent instanceof ln)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class cce extends Xr{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(r=>r instanceof ln);if(t.numChildren()>1&&i.length>=1){const r={},a=new Set();for(const o of i){const s=o.parse;for(const l of z(s))l in r?r[l]!==s[l]&&a.add(l):r[l]=s[l]}for(const o of a)delete r[o];if(!Fe(r)){this.setMutated();const o=new ln(t,r);for(const s of n){if(s instanceof ln)for(const l of z(r))delete s.parse[l];t.removeChild(s),s.parent=o,s instanceof ln&&z(s.parse).length===0&&s.remove()}}}return this.setContinue(),this.flags}}class fce extends Xr{run(e){const t=e.parent,n=t.children.filter(r=>r instanceof pr),i={};for(const r of n){const a=we(r.groupBy);a in i||(i[a]=[]),i[a].push(r)}for(const r of z(i)){const a=i[r];if(a.length>1){const o=a.pop();for(const s of a)o.merge(s)&&(t.removeChild(s),s.parent=o,s.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class dce extends Xr{constructor(e){super();this.model=e}run(e){const t=e.parent,n=!(wm(t)||t instanceof _f||t instanceof ln||t instanceof ms),i=[],r=[];for(const a of t.children)a instanceof Vr&&(n&&!FF(t.producedFields(),a.dependentFields())?i.push(a):r.push(a));if(i.length>0){const a=i.pop();for(const o of i)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof Vr?t.merge(a,this.model.renameSignal.bind(this.model)):a.swapWithParent()}if(r.length>1){const a=r.pop();for(const o of r)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class hce extends Xr{run(e){const t=e.parent,n=[...t.children],i=rf(n,o=>o instanceof sn);if(!i||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let a;for(const o of n)if(o instanceof sn){let s=o;for(;s.numChildren()===1;){const l=s.children[0];if(l instanceof sn)s=l;else break}r.push(...s.children),a?(t.removeChild(o),o.parent=a.parent,a.parent.removeChild(a),a.parent=s,this.setMutated()):a=s}else r.push(o);if(r.length){this.setMutated();for(const o of r)o.parent.removeChild(o),o.parent=a}return this.setContinue(),this.flags}}const K2="scale_",xm=5;function Xa(e){const t=[];function n(i){if(i.numChildren()===0)t.push(i);else for(const r of i.children)n(r)}for(const i of e)n(i);return t}function pce(e){return e}function $i(e,t){const n=t.map(i=>{if(e instanceof Xr){const r=e.optimizeNextFromLeaves(i);return e.reset(),r}else return e.run(i)});return n.some(pce)}function f3(e,t){let n=e.sources;const i=new Set();return i.add($i(new lce(),n)),i.add($i(new uce(t),n)),n=n.filter(r=>r.numChildren()>0),i.add($i(new rce(),Xa(n))),n=n.filter(r=>r.numChildren()>0),i.add($i(new nce(),Xa(n))),i.add($i(new dce(t),Xa(n))),i.add($i(new ace(),Xa(n))),i.add($i(new cce(),Xa(n))),i.add($i(new fce(),Xa(n))),i.add($i(new oce(),Xa(n))),i.add($i(new ice(),n)),i.add($i(new hce(),Xa(n))),e.sources=n,i.has(!0)}function gce(e,t){V2(e.sources);let n=0,i=0;for(let r=0;r<xm&&f3(e,t);r++)n++;e.sources.map(J2);for(let r=0;r<xm&&f3(e,t);r++)i++;V2(e.sources),Math.max(n,i)===xm&&j(`Maximum optimization runs(${xm}) reached.`)}class si{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new si(()=>e(t))}}function d3(e){Je(e)?mce(e):vce(e)}function mce(e){const t=e.component.scales;for(const n of z(t)){const i=bce(e,n),r=t[n];if(r.setWithExplicit("domains",i),xce(e,n),e.component.data.isFaceted){let a=e;for(;!Di(a)&&a.parent;)a=a.parent;const o=a.component.resolve.scale[n];if(o==="shared")for(const s of i.value)za(s)&&(s.data=K2+s.data.replace(K2,""))}}}function vce(e){for(const n of e.children)d3(n);const t=e.component.scales;for(const n of z(t)){let i,r=null;for(const a of e.children){const o=a.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Ga(i,o.getWithExplicit("domains"),"domains","scale",eE);const s=o.get("selectionExtent");r&&s&&r.selection!==s.selection&&j("The same selection must be used to override scale domains in a layered view."),r=s}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function yce(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:a}=h3(t,n);if(!r){j(a);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=h3(t,n);if(r)return"unaggregated"}return e}function bce(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=yce(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&ft(i.x2)?ft(i.x)?Ga(Ja(n,r,e,"x"),Ja(n,r,e,"x2"),"domain","scale",eE):Ja(n,r,e,"x2"):t==="y"&&ft(i.y2)?ft(i.y)?Ga(Ja(n,r,e,"y"),Ja(n,r,e,"y2"),"domain","scale",eE):Ja(n,r,e,"y2"):Ja(n,r,e,t)}function wce(e,t,n){return e.map(i=>{const r=u2(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function Q2(e,t,n){var i;const r=(i=on(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?wce(e,t,r):[e]}function Ja(e,t,n,i){const{encoding:r}=n,a=ft(r[i]),{type:o}=a,s=a.timeUnit;if(goe(t)){const f=Ja(e,void 0,n,i),d=Q2(t.unionWith,o,s);return ds([...f.value,...d])}else{if(oe(t))return ds([t]);if(t&&t!=="unaggregated"&&!jI(t))return ds(Q2(t,o,s))}const l=n.stack;if(l&&i===l.fieldChannel){if(l.offset==="normalize")return Un([[0,1]]);const f=n.requestDataName(qt);return Un([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const u=La(i)&&q(a)?Ece(n,i,e):void 0;if(Ua(a)){const f=Q2([a.datum],o,s);return Un(f)}const c=a;if(t==="unaggregated"){const f=n.requestDataName(qt),{field:d}=a;return Un([{data:f,field:U({field:d,aggregate:"min"})},{data:f,field:U({field:d,aggregate:"max"})}])}else if(Me(c.bin)){if(On(e))return e==="bin-ordinal"?Un([]):Un([{data:_g(u)?n.requestDataName(qt):n.requestDataName(lm),field:n.vgField(i,gf(c,i)?{binSuffix:"range"}:{}),sort:u===!0||!K(u)?{field:n.vgField(i,{}),op:"min"}:u}]);{const{bin:f}=c;if(Me(f)){const d=Y2(n,c.field,f);return Un([new si(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return Un([{data:n.requestDataName(qt),field:n.vgField(i,{})}])}}else if(c.timeUnit&&ae(["time","utc"],e)&&t2(i,c,Je(n)?n.encoding[ar(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(qt);return Un([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Un(u?[{data:_g(u)?n.requestDataName(qt):n.requestDataName(lm),field:n.vgField(i),sort:u}]:[{data:n.requestDataName(qt),field:n.vgField(i)}])}function Z2(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Yg)},i?{field:$a(i)}:{}),r?{order:r}:{})}function xce(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,a=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=jI(r)&&r,s=cf(a)&&Bg(a.extent)&&a.extent;(o||s)&&i.set("selectionExtent",o??s,!0)}function Ece(e,t,n){if(!On(n))return;const i=e.fieldDef(t),r=i.sort;if(ZI(r))return{op:"min",field:Ul(i,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(s=>s.fieldDef.field)]:void 0;if(ur(r)){const s=a&&!ae(o,r.field);return Z2(r,s)}else if(QI(r)){const{encoding:s,order:l}=r,u=e.fieldDef(s),{aggregate:c,field:f}=u,d=a&&!ae(o,f);if(Da(c)||ts(c))return Z2({field:U(u),order:l},d);if($x(c)||!c)return Z2({op:c,field:f,order:l},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(ae(["ascending",void 0],r))return!0}return}function h3(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!pre[n]?{valid:!1,reason:oae(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:sae(e)}:{valid:!0}:{valid:!1,reason:aae(e)}}function eE(e,t,n,i){return e.explicit&&t.explicit&&j(dae(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function kce(e){const t=Ta(e.map(o=>{if(za(o)){const s=Z(o,["sort"]);return s}return o}),we),n=Ta(e.map(o=>{if(za(o)){const s=o.sort;return s!==void 0&&!_g(s)&&("op"in s&&s.op==="count"&&delete s.field,s.order==="ascending"&&delete s.order),s}return}).filter(o=>o!==void 0),we);if(t.length===0)return;if(t.length===1){const o=e[0];if(za(o)&&n.length>0){let s=n[0];if(n.length>1)j(wI),s=!0;else if(K(s)&&"field"in s){const l=s.field;o.field===l&&(s=s.order?{order:s.order}:!0)}return Object.assign(Object.assign({},o),{sort:s})}return o}const i=Ta(n.map(o=>_g(o)||!("op"in o)||o.op in ure?o:(j(pae(o)),!0)),we);let r;i.length===1?r=i[0]:i.length>1&&(j(wI),r=!0);const a=Ta(e.map(o=>za(o)?o.data:null),o=>o);if(a.length===1&&a[0]!==null){const o=Object.assign({data:a[0],fields:t.map(s=>s.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function tE(e){if(za(e)&&Y(e.field))return e.field;if(qae(e)){let t;for(const n of e.fields)if(za(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return j(gae),t}return j(mae),t}else if(Wae(e)){j(vae);const t=e.fields[0];return Y(t)?t:void 0}return}function Em(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(za(r)&&(r.data=e.lookupDataSource(r.data)),r));return kce(i)}function p3(e){return Yl(e)||iE(e)?e.children.reduce((t,n)=>t.concat(p3(n)),g3(e)):g3(e)}function g3(e){return z(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=r,f=Z(r,["name","type","selectionExtent","domains","range","reverse"]),d=_ce(r.range,a,n);let h;s&&(h=Lle(e,s));const p=Em(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function _ce(e,t,n){return sr(n)&&Pa(e)?{step:{signal:t+"_step"}}:e}class m3 extends Wa{constructor(e,t){super({},{name:e});this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:rf(this.get("domains"),e=>I(e)&&e.length===2&&e[0]<=0&&e[1]>=0)}}const Ace=["range","scheme"];function v3(e){return e==="x"?"width":e==="y"?"height":void 0}function Sce(e){const t=e.component.scales;for(const n of Pg){const i=t[n];if(!i)continue;const r=Oce(n,e);i.setWithExplicit("range",r)}}function y3(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Me(n.bin)){const i=Y2(e,n.field,n.bin),r=v3(t),a=e.getName(r);return new si(()=>{const o=e.getSignalName(i),s=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(a)} / (${s})`})}return}function Oce(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),a=r.get("type");for(const o of Ace)if(n[o]!==void 0){const s=LI(a,o),l=PI(e,o);if(!s)j(yI(a,o,e));else if(l)j(l);else switch(o){case"range":return I(n.range)&&sr(e)?ds(n.range.map(u=>{if(u==="width"||u==="height"){const c=t.getName(u),f=t.getSignalName.bind(t);return si.fromName(f,c)}return u})):ds(n.range);case"scheme":return ds(Tce(n[o]))}}if(e===He||e===ct){const o=e===He?"width":"height",s=i[o];if(dr(s)){if(On(a))return ds({step:s.step});j(bI(o))}}return Un(Cce(e,t))}function Tce(e){return poe(e)?Object.assign({scheme:e.name},Mr(e,["name"])):{scheme:e}}function Cce(e,t){const{size:n,config:i,mark:r,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=ft(a[e]),l=t.getScaleComponent(e),u=l.get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case He:case ct:{if(ae(["point","band"],u)){if(e===He&&!n.width){const p=vf(i.view,"width");if(dr(p))return p}else if(e===ct&&!n.height){const p=vf(i.view,"height");if(dr(p))return p}}const d=v3(e),h=t.getName(d);return e===ct&&ai(u)?[si.fromName(o,h),0]:[0,si.fromName(o,h)]}case Ur:{const d=t.component.scales[e].get("zero"),h=b3(r,d,i),p=Rce(r,n,t,i);return Wg(u)?Dce(h,p,$ce(u,i,c,e)):[h,p]}case Oi:return[0,Math.PI*2];case ns:return[0,360];case er:return[0,new si(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case Fa:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Ia:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Sn:return"symbol";case An:case ir:case rr:return u==="ordinal"?s==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case qr:case Ra:case Na:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function $ce(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&I(n)?n.length+1:(j(Sae(i)),3)}}function Dce(e,t,n){const i=()=>{const r=mf(t),a=mf(e),o=`(${r} - ${a}) / (${n} - 1)`;return`sequence(${a}, ${r} + ${o}, ${o})`};return oe(t)?new si(i):{signal:i()}}function b3(e,t,n){if(t)return oe(t)?{signal:`${t.signal} ? 0 : ${b3(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Ug("size",e))}const w3=.95;function Rce(e,t,n,i){const r={x:y3(n,"x"),y:y3(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const a=x3(t,r,i.view);return Re(a)?a-1:new si(()=>`${a.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const a=x3(t,r,i.view);return Re(a)?Math.pow(w3*a,2):new si(()=>`pow(${w3} * ${a.signal}, 2)`)}}throw new Error(Ug("size",e))}function x3(e,t,n){const i=dr(e.width)?e.width.step:rm(n,"width"),r=dr(e.height)?e.height.step:rm(n,"height");return t.x||t.y?new si(()=>{const a=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${a.join(", ")})`}):Math.min(i,r)}function E3(e,t){Je(e)?Nce(e,t):A3(e,t)}function Nce(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:a,specifiedScales:o}=e;for(const s of z(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=ft(r[s]),d=l[t],h=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=LI(h,t),v=PI(s,t);if(d!==void 0&&(m?v&&j(v):j(yI(h,t,s))),m&&v===void 0)if(d!==void 0)u.copyKeyFromObject(t,l);else{const y=t in k3?k3[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:g,domain:l.domain,markDef:a,config:i}):i.scale[t];y!==void 0&&u.set(t,y,!1)}}}const k3={bins:({model:e,fieldOrDatumDef:t})=>q(t)?Fce(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Ice(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>Mce(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>jce(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>Lce(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:a})=>Pce(e,t,n,i.type,r,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=q(e)?e.sort:void 0;return zce(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>Bce(e,t,n,i,r)};function _3(e){Je(e)?Sce(e):A3(e,"range")}function A3(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?_3(i):E3(i,t);for(const i of z(n)){let r;for(const a of e.children){const o=a.component.scales[i];if(o){const s=o.getWithExplicit(t);r=Ga(r,s,t,"scale",ZM((l,u)=>{switch(t){case"range":return l.step&&u.step?l.step-u.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Fce(e,t){const n=t.bin;if(Me(n)){const i=Y2(e,t.field,n);return new si(()=>e.getSignalName(i))}else if(an(n)&&cf(n)&&n.step!==void 0)return{step:n.step};return}function Ice(e,t){return ae([An,ir,rr],e)&&t!=="nominal"?"hcl":void 0}function Mce(e,t,n){var i;return((i=fr(n))===null||i===void 0?void 0:i.bin)||ae([at.TIME,at.UTC],e)?void 0:t in ja?!0:void 0}function jce(e,t,n,i,r,a){if(e in ja){if(Ci(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:s}=r;if(o==="bar"&&!(q(i)&&(i.bin||i.timeUnit))&&(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"))return a.continuousBandSize}if(t===at.POINT)return n.pointPadding}return}function Lce(e,t,n,i){if(e!==void 0)return;if(t in ja){const{bandPaddingInner:r,barBandPaddingInner:a,rectBandPaddingInner:o}=i;return rt(r,n==="bar"?a:o)}return}function Pce(e,t,n,i,r,a){if(e!==void 0)return;if(t in ja&&n===at.BAND){const{bandPaddingOuter:o}=a;return rt(o,oe(r)?{signal:`${r.signal}/2`}:r/2)}return}function zce(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ai(e)&&t==="descending"?oe(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ai(e)&&t==="descending"?!0:void 0}function Bce(e,t,n,i,r){const a=!!n&&n!=="unaggregated";if(a&&ai(r)){if(I(n)){const o=n[0],s=n[n.length-1];if(o<=0&&s>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Wg(r))return!0;if(!(q(t)&&t.bin)&&ae([...ri,...Are],e)){const{orient:o,type:s}=i;return!(ae(["bar","area","line","trail"],s)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function Uce(e,t,n,i){const r=qce(t,n,i),{type:a}=e;return La(t)?a!==void 0?BI(t,a)?q(n)&&!zI(a,n.type)?(j(cae(a,r)),r):a:(j(uae(t,a,r)),r):r:null}function qce(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(Fl(e)||zg(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&j(jx(e,"ordinal")),"ordinal";if(e in ja){if(ae(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Fx)return"band";return t.band!==void 0||o2(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point";case"temporal":return Fl(e)?"time":zg(e)==="discrete"?(j(jx(e,"temporal")),"ordinal"):q(t)&&t.timeUnit&&on(t.timeUnit).utc?"utc":"time";case"quantitative":return Fl(e)?q(t)&&Me(t.bin)?"bin-ordinal":"linear":zg(e)==="discrete"?(j(jx(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(mI(t.type))}function Wce(e,{ignoreRange:t}={}){S3(e),d3(e);for(const n of yoe)E3(e,n);t||_3(e)}function S3(e){Je(e)?e.component.scales=Gce(e):e.component.scales=Yce(e)}function Gce(e){const{encoding:t,mark:n}=e;return Pg.reduce((i,r)=>{const a=ft(t[r]);if(a&&n===WF&&r===Sn&&a.type===Pl)return i;let o=a&&a.scale;if(a&&o!==null&&o!==!1){o=o??{};const s=Uce(o,r,a,n);i[r]=new m3(e.scaleName(r+"",!0),{value:s,explicit:o.type===s})}return i},{})}const Hce=ZM((e,t)=>II(e)-II(t));function Yce(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const a of e.children){S3(a);for(const o of z(a.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:mue(o,e),r.scale[o]==="shared"){const s=i[o],l=a.component.scales[o].getWithExplicit("type");s?toe(s.value,l.value)?i[o]=Ga(s,l,"type","scale",Hce):(r.scale[o]="independent",delete i[o]):i[o]=l}}for(const a of z(i)){const o=e.scaleName(a,!0),s=i[a];n[a]=new m3(o,s);for(const l of e.children){const u=l.component.scales[a];u&&(l.renameScale(u.get("name"),o),u.merged=!0)}}return n}class nE{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Je(e){return(e==null?void 0:e.type)==="unit"}function Di(e){return(e==null?void 0:e.type)==="facet"}function iE(e){return(e==null?void 0:e.type)==="concat"}function Yl(e){return(e==null?void 0:e.type)==="layer"}class rE{constructor(e,t,n,i,r,a,o){var s,l;this.type=t,this.parent=n,this.config=r,this.view=o,this.children=[],this.correctDataNames=u=>(u.from&&u.from.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from&&u.from.facet&&u.from.facet.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=n,this.config=r,this.name=(s=e.name)!==null&&s!==void 0?s:i,this.title=qa(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new nE(),this.projectionNameMap=n?n.projectionNameMap:new nE(),this.signalNameMap=n?n.signalNameMap:new nE(),this.data=e.data,this.description=e.description,this.transforms=cle((l=e.transform)!==null&&l!==void 0?l:[]),this.layout=t==="layer"||t==="unit"?{}:fse(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Vg(e)||n&&n.component.data.isFaceted&&e.data===void 0},layoutSize:new Wa(),layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?pe(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Wce(this)}parseProjection(){a3(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Zj(this)}assembleGroupStyle(){var e,t;return this.type==="unit"||this.type==="layer"?(t=(e=this.view)===null||e===void 0?void 0:e.style)!==null&&t!==void 0?t:"cell":void 0}assembleEncodeFromView(e){const t=Z(e,["style"]),n={};for(const i of z(t)){const r=t[i];r!==void 0&&(n[i]=nt(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(t.description=nt(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},t??{}):Fe(t)?void 0:t}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=Z(e,["spacing"]),{component:i,config:r}=this,a=gue(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of ii)e[n].title&&t.push(uue(this,n));for(const n of B2)t=t.concat(cue(this,n));return t}assembleAxes(){return Xle(this.component.axes,this.config)}assembleLegends(){return n3(this)}assembleProjections(){return Lue(this)}assembleTitle(){var e,t,n;const i=(e=this.title)!==null&&e!==void 0?e:{},{encoding:r}=i,a=Z(i,["encoding"]),o=Object.assign(Object.assign(Object.assign({},dM(this.config.title).nonMark),a),r?{encode:{update:r}}:{});return o.text?(ae(["unit","layer"],this.type)?ae(["middle",void 0],o.anchor)&&(o.frame=(t=o.frame)!==null&&t!==void 0?t:"group"):o.anchor=(n=o.anchor)!==null&&n!==void 0?n:"start",Fe(o)?void 0:o):void 0}assembleGroup(e=[]){const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Di(this.parent)?p3(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return qe((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=((t=i[n])!==null&&t!==void 0?t:0)+1,n}getSizeSignalRef(e){if(Di(this.parent)){const t=Wj(e),n=Lg(t),i=this.component.scales[n];if(i&&!i.merged){const r=i.get("type"),a=i.get("range");if(On(r)&&Pa(a)){const o=i.get("name"),s=Em(this,n),l=tE(s);if(l){const u=U({aggregate:"distinct",field:l},{expr:"datum"});return{signal:qj(o,i,u)}}else return j(`Unknown field for ${n}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):tI(e)&&La(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(Ire(t));return n}hasAxisOrientSignalRef(){var e,t;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some(n=>n.hasOrientSignalRef()))||((t=this.component.axes.y)===null||t===void 0?void 0:t.some(n=>n.hasOrientSignalRef()))}}class O3 extends rE{vgField(e,t={}){const n=this.fieldDef(e);return n?U(n,t):void 0}reduceFieldDef(e,t){return wM(this.getMapping(),(n,i,r)=>{const a=fr(i);return a?e(n,a,r):n},t)}forEachFieldDef(e,t){d2(this.getMapping(),(n,i)=>{const r=fr(n);r&&e(r,i)},t)}}class aE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"value",(r=a[1])!==null&&r!==void 0?r:"density"]}clone(){return new aE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${we(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=Z(e,["density"]),i=Object.assign({type:"kde",field:t},n);return i}}class km extends De{constructor(e,t){super(e);this.filter=t}clone(){return new km(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t,a=Se("invalid",r,n);if(a!=="filter")return null;const o=t.reduceFieldDef((s,l,u)=>{const c=La(u)&&t.getScaleComponent(u);if(c){const f=c.get("type");ai(f)&&l.aggregate!=="count"&&!es(i)&&(s[l.field]=l)}return s},{});return z(o).length?new km(e,o):null}dependentFields(){return new Set(z(this.filter))}producedFields(){return new Set()}hash(){return`FilterInvalid ${we(this.filter)}`}assemble(){const e=z(this.filter).reduce((t,n)=>{const i=this.filter[n],r=U(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?t.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):i.type==="quantitative"&&(t.push(`isValid(${r})`),t.push(`isFinite(+${r})`))),t},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class oE extends De{constructor(e,t){super(e);this.transform=t,this.transform=pe(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((r,a)=>{var o;return(o=i[a])!==null&&o!==void 0?o:r})}clone(){return new oE(this.parent,pe(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${we(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform,n={type:"flatten",fields:e,as:t};return n}}class sE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"key",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new sE(null,pe(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${we(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform,n={type:"fold",fields:e,as:t};return n}}class Tf extends De{constructor(e,t,n,i){super(e);this.fields=t,this.geojson=n,this.signal=i}clone(){return new Tf(null,pe(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[nr,tr],[ni,Ti]]){const r=i.map(a=>{const o=ft(t.encoding[a]);return q(o)?o.field:Ua(o)?{expr:`${o.datum}`}:Wr(o)?{expr:`${o.value}`}:void 0});(r[0]||r[1])&&(e=new Tf(e,r,null,t.getName(`geojson_${n++}`)))}if(t.channelHasField(Sn)){const i=t.typedFieldDef(Sn);i.type===Pl&&(e=new Tf(e,null,i.field,t.getName(`geojson_${n++}`)))}return e}dependentFields(){var e;const t=((e=this.fields)!==null&&e!==void 0?e:[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set()}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${we(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class _m extends De{constructor(e,t,n,i){super(e);this.projection=t,this.fields=n,this.as=i}clone(){return new _m(null,this.projection,pe(this.fields),pe(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[nr,tr],[ni,Ti]]){const i=n.map(a=>{const o=ft(t.encoding[a]);return q(o)?o.field:Ua(o)?{expr:`${o.datum}`}:Wr(o)?{expr:`${o.value}`}:void 0}),r=n[0]===ni?"2":"";(i[0]||i[1])&&(e=new _m(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${we(this.fields)} ${we(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Vl extends De{constructor(e,t){super(e);this.transform=t}clone(){return new Vl(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e,r=[t,n,...i?[i]:[]].join(",");return{signal:`sequence(${r})`}}static makeFromTransform(e,t){return new Vl(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(q(i)&&q(r)){const a=i.impute?i:r.impute?r:void 0;if(a===void 0)return;const o=i.impute?r:r.impute?i:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=xM(t.mark,n);return new Vl(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),c!==void 0?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${we(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:Wse(n)?this.processSequence(n):n}:{}),{method:"value"}),r?{groupby:r}:{}),{value:!i||i==="value"?a:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:o,ignorePeers:!1},r?{groupby:r}:{}),u={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[s,l,u]}else return[s]}}class lE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.loess]}clone(){return new lE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${we(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,i=Z(e,["loess","on"]),r=Object.assign({type:"loess",x:n,y:t},i);return r}}class Am extends De{constructor(e,t,n){super(e);this.transform=t,this.secondary=n}clone(){return new Am(null,pe(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:a}=n;let o=null;if(Hse(a)){let s=D3(a.data,r);s||(s=new Wl(a.data),r.push(s));const l=t.getName(`lookup_${i}`);o=new sn(s,l,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[l]=o}else if(Yse(a)){const s=a.selection;if(n=Object.assign({as:s},n),o=t.getSelectionComponent(qe(s),s).materialized,!o)throw new Error(Lre(s))}return new Am(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?G(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${we({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:G(this.transform.as)}:{});else{let t=this.transform.as;Y(t)||(j(qre),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class uE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"prob",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new uE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${we(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=Z(e,["quantile"]),i=Object.assign({type:"quantile",field:t},n);return i}}class cE extends De{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=pe(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.regression]}clone(){return new cE(null,pe(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${we(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,i=Z(e,["regression","on"]),r=Object.assign({type:"regression",x:n,y:t},i);return r}}class fE extends De{constructor(e,t){super(e);this.transform=t}clone(){return new fE(null,pe(this.transform))}addDimensions(e){var t;this.transform.groupby=Ta(((t=this.transform.groupby)!==null&&t!==void 0?t:[]).concat(e),n=>n)}producedFields(){return}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}hash(){return`PivotTransform ${we(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},i!==void 0?{limit:i}:{}),r!==void 0?{op:r}:{}),n!==void 0?{groupby:n}:{})}}class dE extends De{constructor(e,t){super(e);this.transform=t}clone(){return new dE(null,pe(this.transform))}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return`SampleTransform ${we(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function T3(e){let t=0;function n(i,r){var a;if(i instanceof Wl&&(!i.isGenerator&&!yf(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof ln&&(i.parent instanceof Wl&&!r.source?(r.format=Object.assign(Object.assign({},(a=r.format)!==null&&a!==void 0?a:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Gl){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}if((i instanceof ym||i instanceof bm||i instanceof km||i instanceof _f||i instanceof Sf||i instanceof _m||i instanceof Tf||i instanceof pr||i instanceof Am||i instanceof Of||i instanceof Hl||i instanceof sE||i instanceof oE||i instanceof aE||i instanceof lE||i instanceof uE||i instanceof cE||i instanceof ms||i instanceof dE||i instanceof fE)&&r.transform.push(i.assemble()),(i instanceof Vr||i instanceof Hr||i instanceof Vl||i instanceof Va)&&r.transform.push(...i.assemble()),i instanceof sn){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof sn)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof sn&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const s of i.children){const l={name:null,source:o,transform:[]};n(s,l)}break}}}return n}function Vce(e){const t=[],n=T3(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Xce(e,t){var n,i;const r=[],a=T3(r);let o=0;for(const l of e.sources){l.hasName()||(l.dataName=`source_${o++}`);const u=l.assemble();a(l,u)}for(const l of r)l.transform.length===0&&delete l.transform;let s=0;for(const[l,u]of r.entries())((n=u.transform)!==null&&n!==void 0?n:[]).length===0&&!u.source&&r.splice(s++,0,r.splice(l,1)[0]);for(const l of r)for(const u of(i=l.transform)!==null&&i!==void 0?i:[])u.type==="lookup"&&(u.from=e.outputNodes[u.from].getSource());for(const l of r)l.name in t&&(l.values=t[l.name]);return r}function Jce(e){return e==="top"||e==="left"||oe(e)?"header":"footer"}function Kce(e){for(const t of ii)Qce(e,t);$3(e,"x"),$3(e,"y")}function Qce(e,t){var n;const{facet:i,config:r,child:a,component:o}=e;if(e.channelHasField(t)){const s=i[t],l=ql("title",null,r,t);let u=ls(s,r,{allowDisabling:!0,includeDefault:l===void 0||!!l});a.component.layoutHeaders[t].title&&(u=I(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=ql("labelOrient",s,r,t),f=(n=s.header)!==null&&n!==void 0?n:{},d=rt(f.labels,r.header.labels,!0),h=ae(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[h]:t==="facet"?[]:[C3(e,t,d)]}}}function C3(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function $3(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:a}=e.component;if(a.axis[t]=G2(a,t),a.axis[t]==="shared"){const o=t==="x"?"column":"row",s=r[o];for(const l of i.component.axes[t]){const u=Jce(l.get("orient"));s[u]=(n=s[u])!==null&&n!==void 0?n:[C3(e,o,!1)];const c=Af(l,"main",e.config,{header:!0});c&&s[u][0].axes.push(c),l.mainExtracted=!0}}}}function Zce(e){hE(e),Sm(e,"width"),Sm(e,"height")}function efe(e){hE(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Sm(e,t),Sm(e,n)}function hE(e){for(const t of e.children)t.parseLayoutSize()}function Sm(e,t){const n=Wj(t),i=Lg(n),r=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const l=s.component.layoutSize.getWithExplicit(n),u=r.scale[i];if(u==="independent"&&l.value==="step"){o=void 0;break}if(o){if(u==="independent"&&o.value!==l.value){o=void 0;break}o=Ga(o,l,n,"")}else o=l}if(o){for(const s of e.children)e.renameSignal(s.getName(n),e.getName(t)),s.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function tfe(e){const{size:t,component:n}=e;for(const i of ri){const r=or(i);if(t[r]){const a=t[r];n.layoutSize.set(r,dr(a)?"step":a,!0)}else{const a=nfe(e,r);n.layoutSize.set(r,a,!1)}}}function nfe(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const a=r.get("type"),o=r.get("range");if(On(a)){const s=vf(i.view,t);return Pa(o)||dr(s)?"step":s}else return E2(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return E2(i.view,t);{const a=vf(i.view,t);return dr(a)?a.step:a}}}function pE(e,t,n){return U(t,Object.assign({suffix:`by_${U(e)}`},n??{}))}class Om extends O3{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve);this.child=mE(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return hf(e)?wM(e,(n,i,r)=>ae([Lr,Pr],r)?i.field===void 0?(j(Mx(i,r)),n):(n[r]=l2(i,r,t),n):(j(Ug(r,"facet")),n),{}):{facet:l2(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=Tm(this),this.child.parseData()}parseLayoutSize(){hE(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Kce(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of ii)for(const a of U2){const o=this.component.layoutHeaders[r],s=o[a],{facetFieldDef:l}=o;if(l){const u=ql("titleOrient",l,this.config,r);if(ae(["right","bottom"],u)){const c=gm(r,u);i.titleAnchor=(e=i.titleAnchor)!==null&&e!==void 0?e:{},i.titleAnchor[c]="end"}}if(s==null?void 0:s[0]){const u=r==="row"?"height":"width",c=a==="header"?"headerBand":"footerBand";r!=="facet"&&!this.child.component.layoutSize.get(u)&&(i[c]=(t=i[c])!==null&&t!==void 0?t:{},i[c][r]=.5),o.title&&(i.offset=(n=i.offset)!==null&&n!==void 0?n:{},i.offset[r==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(!t&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof Om)return;{const e=this.getName("column_domain");return{signal:`length(data('${e}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof Om?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:U(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof Om){if(this.child.channelHasField("column")){const i=U(this.child.facet.column);e.push(i),t.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of ri){const r=this.child.component.scales[i];if(r&&!r.merged){const a=r.get("type"),o=r.get("range");if(On(a)&&Pa(o)){const s=Em(this.child,i),l=tE(s);l?(e.push(l),t.push("distinct"),n.push(`distinct_${l}`)):j(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of ii){const c=this.facet[u];if(c){s.push(U(c));const{bin:f,sort:d}=c;if(Me(f)&&s.push(U(c,{binSuffix:"end"})),ur(d)){const{field:h,op:p=Yg}=d,g=pE(c,d);n&&i?(r.push(g),a.push("max"),o.push(g)):(r.push(h),a.push(p),o.push(g))}else if(I(d)){const h=Ul(c,u);r.push(h),a.push("max"),o.push(h)}}}const l=!!n&&!!i;return Object.assign({name:e,data:t,groupby:s},l||r.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),r.length?{fields:r,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?ur(n.sort)?[pE(n,n.sort,{expr:"datum"})]:I(n.sort)?[Ul(n,e,{expr:"datum"})]:[U(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:i}=n,r=(ur(i)?i.order:!I(i)&&i)||"ascending";return[r]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return q2(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of B2)if(e[i]){const r=ql("labelOrient",e[i],t,i);if(ae(n[i],r))return q2(e[i],i,t)}return}assembleMarks(){const{child:e}=this,t=this.component.data.facetRoot,n=Vce(t),i=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),a=e.assembleGroupStyle(),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:ii.map(s=>this.facetSortFields(s)).flat(),order:ii.map(s=>this.facetSortOrder(s)).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup(Fle(this,[])));return[o]}getMapping(){return this.facet}}function ife(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const a of[n,i])if(ur(a.sort)){const{field:o,op:s=Yg}=a.sort;e=r=new Hl(e,{joinaggregate:[{op:s,field:o,as:pE(a,a.sort,{forAs:!0})}],groupby:[U(a)]})}return r}return null}function D3(e,t){var n,i,r,a,o,s,l,u,c,f;for(const d of t){const h=d.data;if(e.name&&d.hasName()&&e.name!==d.dataName)continue;if(((n=e.format)===null||n===void 0?void 0:n.mesh)&&((i=h.format)===null||i===void 0?void 0:i.feature))continue;if((((r=e.format)===null||r===void 0?void 0:r.feature)||((a=h.format)===null||a===void 0?void 0:a.feature))&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((s=h.format)===null||s===void 0?void 0:s.feature))continue;if((((l=e.format)===null||l===void 0?void 0:l.mesh)||((u=h.format)===null||u===void 0?void 0:u.mesh))&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=h.format)===null||f===void 0?void 0:f.mesh))continue;if(sm(e)&&sm(h)){if(tf(e.values,h.values))return d}else if(yf(e)&&yf(h)){if(e.url===h.url)return d}else if(ej(e)&&e.name===d.dataName)return d}return null}function rfe(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Wl({values:[]});return t.push(i),i}const n=D3(e.data,t);if(n)return hs(e.data)||(n.data.format=jie({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Wl(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function afe(e,t,n){var i,r;let a=0;for(const o of t.transforms){let s,l;if(ile(o))l=e=new Sf(e,o),s="derived";else if(ij(o)){const u=Kue(o);l=e=(i=ln.makeWithAncestors(e,{},u,n))!==null&&i!==void 0?i:e,e=new _f(e,t,o.filter)}else if(rle(o))l=e=Vr.makeFromTransform(e,o,t),s="number";else if(ole(o)){s="date";const u=n.getWithExplicit(o.field);u.value===void 0&&(e=new ln(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=Hr.makeFromTransform(e,o)}else if(sle(o))l=e=pr.makeFromTransform(e,o),s="number",M2(t)&&(e=new ms(e));else if(Gse(o))l=e=Am.make(e,t,o,a++),s="derived";else if(ele(o))l=e=new Of(e,o),s="number";else if(tle(o))l=e=new Hl(e,o),s="number";else if(lle(o))l=e=Va.makeFromTransform(e,o),s="derived";else if(ule(o))l=e=new sE(e,o),s="derived";else if(nle(o))l=e=new oE(e,o),s="derived";else if(Vse(o))l=e=new fE(e,o),s="derived";else if(Zse(o))e=new dE(e,o);else if(ale(o))l=e=Vl.makeFromTransform(e,o),s="derived";else if(Xse(o))l=e=new aE(e,o),s="derived";else if(Jse(o))l=e=new uE(e,o),s="derived";else if(Kse(o))l=e=new cE(e,o),s="derived";else if(Qse(o))l=e=new lE(e,o),s="derived";else{j(Ure(o));continue}if(l&&s!==void 0)for(const u of(r=l.producedFields())!==null&&r!==void 0?r:[])n.set(u,s,!1)}return e}function Tm(e){var t,n,i,r,a,o,s,l,u,c;let f=rfe(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new qse(),g=e.data;hs(g)?(tj(g)?f=new bm(f,g.sequence):O2(g)&&(f=new ym(f,g.graticule)),p.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=ln.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new ms(f);const m=e.parent&&Yl(e.parent);(Je(e)||Di(e))&&(m&&(f=(i=Vr.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=afe(f,e,p));const v=Zue(e),y=Que(e);f=(r=ln.makeWithAncestors(f,{},Object.assign(Object.assign({},v),y),p))!==null&&r!==void 0?r:f,Je(e)&&(f=Tf.parseAll(f,e),f=_m.parseAll(f,e)),(Je(e)||Di(e))&&(m||(f=(a=Vr.makeFromEncoding(f,e))!==null&&a!==void 0?a:f),f=(o=Hr.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=Sf.parseAllForSortIndex(f,e));const b=e.getName(lm),E=new sn(f,b,lm,h);if(d[b]=E,f=E,Je(e)){const A=pr.makeFromEncoding(f,e);A&&(f=A,M2(e)&&(f=new ms(f))),f=(s=Vl.makeFromEncoding(f,e))!==null&&s!==void 0?s:f,f=(l=Va.makeFromEncoding(f,e))!==null&&l!==void 0?l:f}Je(e)&&(f=(u=km.make(f,e))!==null&&u!==void 0?u:f);const x=e.getName(qt),k=new sn(f,x,qt,h);d[x]=k,f=k,Je(e)&&Yle(e,k);let w=null;if(Di(e)){const A=e.getName("facet");f=(c=ife(f,e.facet))!==null&&c!==void 0?c:f,w=new Gl(f,e,A,k.getSource()),d[A]=w}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:E,main:k,facetRoot:w,ancestorParse:p})}class ofe extends rE{constructor(e,t,n,i){var r,a,o,s;super(e,"concat",t,n,i,e.resolve);(((a=(r=e.resolve)===null||r===void 0?void 0:r.axis)===null||a===void 0?void 0:a.x)==="shared"||((s=(o=e.resolve)===null||o===void 0?void 0:o.axis)===null||s===void 0?void 0:s.y)==="shared")&&j(zre),this.children=this.getChildren(e).map((l,u)=>mE(l,this,this.getName("concat_"+u),void 0,i))}parseData(){this.component.data=Tm(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return im(e)?e.vconcat:x2(e)?e.hconcat:e.concat}parseLayoutSize(){efe(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=W2(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})}}function sfe(e){return e===!1||e===null}const lfe=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},zF),{labelExpr:1,encode:1}),R3=z(lfe);class N3 extends Wa{constructor(e={},t={},n=!1){super();this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new N3(pe(this.explicit),pe(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!sfe(this.get(e))}hasOrientSignalRef(){return oe(this.explicit.orient)}}function ufe(e,t,n){var i;const{encoding:r,config:a}=e,o=(i=ft(r[t]))!==null&&i!==void 0?i:ft(r[ar(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return ss(u)?Object.assign({text:Zx({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}function cfe(e){return ri.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[vfe(n,e)]),t),{})}const ffe={bottom:"top",top:"bottom",left:"right",right:"left"};function dfe(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const o of z(a.component.axes))i.axis[o]=G2(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=hfe(n[o],a.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const a of ri){for(const o of e.children){if(!o.component.axes[a])continue;if(i.axis[a]==="independent"){n[a]=((t=n[a])!==null&&t!==void 0?t:[]).concat(o.component.axes[a]);for(const s of o.component.axes[a]){const{value:l,explicit:u}=s.getWithExplicit("orient");if(oe(l))continue;if(r[l]>0&&!u){const c=ffe[l];r[l]>r[c]&&s.set("orient",c,!1)}r[l]++}}delete o.component.axes[a]}if(i.axis[a]==="independent"&&n[a]&&n[a].length>1)for(const o of n[a])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function hfe(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],a=t[i];if(!!r!==!!a)return;if(r&&a){const o=r.getWithExplicit("orient"),s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;e[i]=pfe(r,a)}}}else return t.map(n=>n.clone());return e}function pfe(e,t){for(const n of R3){const i=Ga(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,a)=>{switch(n){case"title":return bM(r,a);case"gridScale":return{explicit:r.explicit,value:rt(r.value,a.value)}}return om(r,a,n,"axis")});e.setWithExplicit(n,i)}return e}function gfe(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(oe(n.labelAngle)?n.labelAngle:Sg(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Lj(i,r))return!0}return e===n[t]}const mfe=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function vfe(e,t){var n,i,r;let a=t.axis(e);const o=new N3(),s=ft(t.encoding[e]),{mark:l,config:u}=t,c=(a==null?void 0:a.orient)||((n=u[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=u.axis)===null||i===void 0?void 0:i.orient)||aue(e),f=t.getScaleComponent(e).get("type"),d=Qle(e,f,c,t.config),h=a!==void 0?!a:P2("disable",u,a==null?void 0:a.style,d).configValue;if(o.set("disable",h,a!==void 0),h)return o;a=a||{};const p=nue(t,a,e,s,d),g={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const y of R3){const b=y in Ij?Ij[y](g):BF(y)?a[y]:void 0,E=b!==void 0,x=gfe(b,y,a,t,e);if(E&&x)o.set(y,b,x);else{const{configValue:k=void 0,configFrom:w=void 0}=BF(y)&&y!=="values"?P2(y,t.config,a.style,d):{},A=k!==void 0;E&&!A?o.set(y,b,x):(!(w==="vgAxisConfig")||mfe.has(y)&&A||Sx(k)||oe(k))&&o.set(y,k,!1)}}const m=(r=a.encoding)!==null&&r!==void 0?r:{},v=PF.reduce((y,b)=>{var E;if(!o.hasAxisPart(b))return y;const x=Gj((E=m[b])!==null&&E!==void 0?E:{},t),k=b==="labels"?ufe(t,e,x):x;return k!==void 0&&!Fe(k)&&(y[b]={update:k}),y},{});return Fe(v)||o.set("encode",v,!!a.encoding||a.labelAngle!==void 0),o}function yfe({encoding:e,size:t}){for(const n of ri){const i=or(n);dr(t[i])&&(cr(e[n])&&(delete t[i],j(bI(i))))}return t}function bfe(e,t,n,{graticule:i}){const r=Qi(e)?Object.assign({},e):{type:e},a=Se("orient",r,n);if(r.orient=kfe(r.type,t,a),a!==void 0&&a!==r.orient&&j(nae(r.orient,a)),r.type==="bar"&&r.orient){const u=Se("cornerRadiusEnd",r,n);if(u!==void 0){const c=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:ire[r.orient];for(const f of c)r[f]=u;r.cornerRadiusEnd!==void 0&&delete r.cornerRadiusEnd}}const o=Se("opacity",r,n);o===void 0&&(r.opacity=xfe(r.type,t));const s=r.filled;s===void 0&&(r.filled=i?!1:Efe(r,n));const l=Se("cursor",r,n);return l===void 0&&(r.cursor=wfe(r,t,n)),r}function wfe(e,t,n){return t.href||e.href||Se("href",e,n)?"pointer":e.cursor}function xfe(e,t){return ae([$g,Ox,Tx,Cx],e)&&!c2(t)?.7:void 0}function Efe(e,t){const n=cs("filled",e,t),i=e.type;return rt(n,i!==$g&&i!==Cg&&i!==Dg)}function kfe(e,t,n){switch(e){case $g:case Tx:case Cx:case qF:case Xie:case Vie:return}const{x:i,y:r,x2:a,y2:o}=t;switch(e){case Tg:if(q(i)&&(an(i.bin)||q(r)&&r.aggregate&&!i.aggregate))return"vertical";if(q(r)&&(an(r.bin)||q(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(q(i)&&i.type===as&&!Me(i.bin)||r2(i)))return"horizontal";if(!o&&(q(r)&&r.type===as&&!Me(r.bin)||r2(r)))return"vertical"}case Dg:if(a&&!(q(i)&&an(i.bin))&&o&&!(q(r)&&an(r.bin)))return;case Og:if(o)return q(r)&&an(r.bin)?"horizontal":"vertical";if(a)return q(i)&&an(i.bin)?"vertical":"horizontal";if(e===Dg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Cg:case Ox:{const s=cr(i),l=cr(r);if(s&&!l)return e!=="tick"?"horizontal":"vertical";if(!s&&l)return e!=="tick"?"vertical":"horizontal";if(s&&l){const u=i,c=r,f=u.type===Ll,d=c.type===Ll;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!u.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":u.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const _fe={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),Ha(e,"radius","arc")),Ha(e,"theta","arc"))},Afe={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),cm("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),cm("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),$2(e))},Sfe={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ha(e,"x","bar")),Ha(e,"y","bar"))},Ofe={vgMark:"shape",encodeEntry:e=>Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&q(n)&&n.type===Pl?{field:U(n,{expr:"datum"})}:{});return[i]}},Tfe={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Ha(e,"x","image")),Ha(e,"y","image")),T2(e,"url"))},Cfe={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),xt("size",e,{vgChannel:"strokeWidth"})),$2(e))},$fe={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),xt("size",e)),$2(e))};function gE(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),xt("size",e)),xt("angle",e)),Dfe(e,n,t))}function Dfe(e,t,n){return n?{shape:{value:n}}:xt("shape",e)}const Rfe={vgMark:"symbol",encodeEntry:e=>gE(e)},Nfe={vgMark:"symbol",encodeEntry:e=>gE(e,"circle")},Ffe={vgMark:"symbol",encodeEntry:e=>gE(e,"square")},Ife={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ha(e,"x","rect")),Ha(e,"y","rect"))},Mfe={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),cm("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),cm("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),xt("size",e,{vgChannel:"strokeWidth"}))}},jfe={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Wt("x",e,{defaultPos:"mid"})),Wt("y",e,{defaultPos:"mid"})),T2(e)),xt("size",e,{vgChannel:"fontSize"})),xt("angle",e)),dj("align",Lfe(e.markDef,n,t))),dj("baseline",Pfe(e.markDef,n,t))),Wt("radius",e,{defaultPos:null,isMidPoint:!0})),Wt("theta",e,{defaultPos:null,isMidPoint:!0}))}};function Lfe(e,t,n){const i=Se("align",e,n);return i===void 0?"center":void 0}function Pfe(e,t,n){const i=Se("baseline",e,n);return i===void 0?"middle":void 0}const zfe={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",a=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Wt("x",e,{defaultPos:"mid",vgChannel:"xc"})),Wt("y",e,{defaultPos:"mid",vgChannel:"yc"})),xt("size",e,{defaultValue:Bfe(e),vgChannel:r})),{[a]:nt(Se("thickness",n,t))})}};function Bfe(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,a=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),s=(t=Se("size",i,n,{vgChannel:a}))!==null&&t!==void 0?t:n.tick.bandSize;if(s!==void 0)return s;{const l=o?o.get("range"):void 0;if(l&&Pa(l)&&Re(l.step))return l.step*3/4;const u=rm(n.view,a);return u*3/4}}const Cm={arc:_fe,area:Afe,bar:Sfe,circle:Nfe,geoshape:Ofe,image:Tfe,line:Cfe,point:Rfe,rect:Ife,rule:Mfe,square:Ffe,text:jfe,tick:zfe,trail:$fe};function Ufe(e){return ae([Cg,Og,Jie],e.mark)?qfe(e):ae([Tg],e.mark)?Wfe(e):$m(e)}const F3="faceted_path_";function qfe(e){const t=xM(e.mark,e.encoding),n=$m(e,{fromPrefix:t.length>0?F3:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:F3+e.requestDataName(qt),data:e.requestDataName(qt),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const I3="stack_group_";function Wfe(e){const t=Ux.some(n=>Se(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=$m(e,{fromPrefix:I3}),i=e.scaleName(e.stack.fieldChannel),r=(f={})=>e.vgField(e.stack.fieldChannel,f),a=(f,d)=>{const h=[r({prefix:"min",suffix:"start",expr:d}),r({prefix:"max",suffix:"start",expr:d}),r({prefix:"min",suffix:"end",expr:d}),r({prefix:"max",suffix:"end",expr:d})];return`${f}(${h.map(p=>`scale('${i}',${p})`).join(",")})`};let o,s;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},nf(n.encode.update,["y","yc","y2","height",...Ux])),{x:{signal:a("min","datum")},x2:{signal:a("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},Mr(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},nf(n.encode.update,["x","xc","x2","width"])),{y:{signal:a("min","datum")},y2:{signal:a("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},Mr(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of Ux){const d=cs(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):d&&(o[f]=nt(d)),d&&(n.encode.update[f]={value:0})}const l=e.fieldDef(e.stack.groupbyChannel),u=U(l)?[U(l)]:[];((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&u.push(U(l,{binSuffix:"end"}));const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=c.reduce((f,d)=>{if(n.encode.update[d])return Object.assign(Object.assign({},f),{[d]:n.encode.update[d]});{const h=cs(d,e.markDef,e.config);return h!==void 0?Object.assign(Object.assign({},f),{[d]:nt(h)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(qt),name:I3+e.requestDataName(qt),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}else return $m(e)}function Gfe(e){const{encoding:t,stack:n,mark:i,markDef:r,config:a}=e,o=t.order;if(!I(o)&&Wr(o)&&$F(o.value)||!o&&$F(Se("order",r,a)))return;if((I(o)||q(o))&&!n)return mM(o,{expr:"datum"});if(es(i)){const s=r.orient==="horizontal"?"y":"x",l=t[s];if(q(l)){const u=l.sort;if(I(u))return{field:U(l,{prefix:s,suffix:"sort_index",expr:"datum"})};if(ur(u))return{field:U({aggregate:c2(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(QI(u)){const c=e.fieldDef(u.encoding);return{field:U(c,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:U(l,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function $m(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:r}=e,a=rt(i.clip,Hfe(e),Yfe(e)),o=pM(i),s=e.encoding.key,l=Gfe(e),u=Vfe(e),c=Se("aria",i,r),f=Cm[n].postEncodingTransform?Cm[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Cm[n].vgMark},a?{clip:!0}:{}),o?{style:o}:{}),s?{key:s.field}:{}),l?{sort:l}:{}),u||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(qt)},encode:{update:Cm[n].encodeEntry(e)}}),f?{transform:f}:{})]}function Hfe(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function Yfe(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Vfe(e){if(!e.component.selection)return null;const t=z(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=z(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}class M3 extends O3{constructor(e,t,n,i={},r){var a,o;super(e,"unit",t,n,r,void 0,IM(e)?e.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=Qi(e.mark)?e.mark.type:e.mark;this.markDef=bfe(e.mark,(a=e.encoding)!==null&&a!==void 0?a:{},r,{graticule:e.data&&O2(e.data)});const l=this.encoding=Boe((o=e.encoding)!==null&&o!==void 0?o:{},this.markDef,r);this.size=yfe({encoding:l,size:IM(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=UM(s,l),this.specifiedScales=this.initScales(s,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===WF,n=e&&yre.some(i=>se(e[i]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return Pg.reduce((n,i)=>{var r;const a=ft(t[i]);return a&&(n[i]=(r=a.scale)!==null&&r!==void 0?r:{}),n},{})}initAxes(e){return ri.reduce((t,n)=>{const i=e[n];if(se(i)||n===He&&se(e.x2)||n===ct&&se(e.y2)){const r=se(i)?i.axis:void 0;t[n]=r&&Object.assign({},r)}return t},{})}initLegend(e){return Sre.reduce((t,n)=>{const i=ft(e[n]);if(i&&Tre(n)){const r=i.legend;t[n]=r&&Object.assign({},r)}return t},{})}parseData(){this.component.data=Tm(this)}parseLayoutSize(){tfe(this)}parseSelections(){this.component.selection=Hle(this,this.selection)}parseMarkGroup(){this.component.mark=Ufe(this)}parseAxesAndHeaders(){this.component.axes=cfe(this)}assembleSelectionTopLevelSignals(e){return Ile(this,e)}assembleSignals(){return[...Dj(this),...Nle(this,[])]}assembleSelectionData(e){return Mle(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return W2(this)}assembleMarks(){var e;let t=(e=this.component.mark)!==null&&e!==void 0?e:[];return(!this.parent||!Yl(this.parent))&&(t=kj(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return fs(this.encoding,e)}fieldDef(e){const t=this.encoding[e];return fr(t)}typedFieldDef(e){const t=this.fieldDef(e);return Bn(t)?t:null}}class j3 extends rE{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((o,s)=>{if(am(o))return new j3(o,this,this.getName("layer_"+s),a,r);if(jr(o))return new M3(o,this,this.getName("layer_"+s),a,r);throw new Error(Ix(o))})}parseData(){this.component.data=Tm(this);for(const e of this.children)e.parseData()}parseLayoutSize(){Zce(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){dfe(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),Dj(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),W2(this))}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e;return}assembleLayout(){return null}assembleMarks(){return jle(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),n3(this))}}function mE(e,t,n,i,r){if(Vg(e))return new Om(e,t,n,r);if(am(e))return new j3(e,t,n,i,r);if(jr(e))return new M3(e,t,n,i,r);if(lse(e))return new ofe(e,t,n,r);throw new Error(Ix(e))}function Xfe(e,t={}){t.logger&&Oae(t.logger),t.fieldTitle&&lM(t.fieldTitle);try{const n=PM(ru(t.config,e.config)),i=JM(e,n),r=mE(i,null,"",void 0,n);r.parse(),gce(r.component.data,r);const a=Kfe(r,Jfe(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:a,normalized:i}}finally{t.logger&&Tae(),t.fieldTitle&&Foe()}}function Jfe(e,t,n,i){const r=i.component.layoutSize.get("width"),a=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&a&&zse(t.type)){if(r==="step"&&a==="step")j(cI()),t.type="pad";else if(r==="step"||a==="step"){const o=r==="step"?"width":"height";j(cI(Lg(o)));const s=o==="width"?"height":"width";t.type=Bse(s)}}return Object.assign(Object.assign(Object.assign({},z(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),QM(n)),QM(e))}function Kfe(e,t,n={},i){const r=e.config?wse(e.config):void 0,a=[].concat(e.assembleSelectionData([]),Xce(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}class Qfe extends zM{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:a,aggregate:o,groupby:s,encoding:l}=f2(n,t),u=[...i||[],...r,...a,...o.length===0?[]:[{aggregate:o,groupby:s}]];return Object.assign(Object.assign(Object.assign({},e),u.length>0?{transform:u}:{}),{encoding:l})}else return e}}const Zfe=new Qfe();function ede(e,t){return Zfe.map(e,{config:t})}const tde=Fie.version;var nde=Object.freeze({__proto__:null,normalize:JM,version:tde,compile:Xfe,extractTransforms:ede}),ide=Mm(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function n(i){var r=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g,a=r.exec(i).slice(1,3),o=a[0],s=a[1];return{library:o,version:s}}t.default=n}),L3=Q3(ide);const rde="vega-themes",ade="2.8.3",ode="Themes for stylized Vega and Vega-Lite visualizations.",sde=["vega","vega-lite","themes","style"],lde="BSD-3-Clause",ude={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},cde=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],fde="build/vega-themes.js",dde="build/src/index.js",hde="build/vega-themes.min.js",pde="build/vega-themes.min.js",gde="build/src/index.d.ts",mde={type:"git",url:"https://github.com/vega/vega-themes.git"},vde={prepare:"beemo create-config --silent",clean:"rm -rf build examples/build",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint 'src/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",prebuild:"mkdir -p build",build:"tsc && rollup -c",postbuild:"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'yarn serve' 'tsc -w' 'rollup -c -w'"},yde={"@rollup/plugin-json":"^4.0.2","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",rollup:"^2.1.0",terser:"^4.6.7",typescript:"^3.8.3",vega:"^5.10.0","vega-lite":"^4.8.1","vega-lite-dev-config":"^0.5.0"},bde={vega:"*","vega-lite":"*"},wde={module:"vega-lite-dev-config",drivers:["prettier","eslint"]};var xde={name:rde,version:ade,description:ode,keywords:sde,license:lde,author:ude,contributors:cde,main:fde,module:dde,unpkg:hde,jsdelivr:pde,typings:gde,repository:mde,scripts:vde,devDependencies:yde,peerDependencies:bde,beemo:wde};const Cf="#fff",Ede="#888",kde={background:"#333",title:{color:Cf},style:{"guide-label":{fill:Cf},"guide-title":{fill:Cf}},axis:{domainColor:Cf,gridColor:Ede,tickColor:Cf}},vs="#4572a7",_de={background:"#fff",arc:{fill:vs},area:{fill:vs},line:{stroke:vs,strokeWidth:2},path:{stroke:vs},rect:{fill:vs},shape:{stroke:vs},symbol:{fill:vs,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},ys="#30a2da",vE="#cbcbcb",Ade="#999",Sde="#333",P3="#f0f0f0",z3="#333",Ode={arc:{fill:ys},area:{fill:ys},axis:{domainColor:vE,grid:!0,gridColor:vE,gridWidth:1,labelColor:Ade,labelFontSize:10,titleColor:Sde,tickColor:vE,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:P3,group:{fill:P3},legend:{labelColor:z3,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:z3,titleFontSize:14,titlePadding:10},line:{stroke:ys,strokeWidth:2},path:{stroke:ys,strokeWidth:.5},rect:{fill:ys},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:ys},bar:{binSpacing:2,fill:ys,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},bs="#000",Tde={group:{fill:"#e5e5e5"},arc:{fill:bs},area:{fill:bs},line:{stroke:bs},path:{stroke:bs},rect:{fill:bs},shape:{stroke:bs},symbol:{fill:bs,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Cde=22,$de="normal",B3="Benton Gothic, sans-serif",U3=11.5,Dde="normal",ws="#82c6df",yE="Benton Gothic Bold, sans-serif",q3="normal",W3=13,$f={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Rde={background:"#ffffff",title:{anchor:"start",color:"#000000",font:yE,fontSize:Cde,fontWeight:$de},arc:{fill:ws},area:{fill:ws},line:{stroke:ws,strokeWidth:2},path:{stroke:ws},rect:{fill:ws},shape:{stroke:ws},symbol:{fill:ws,size:30},axis:{labelFont:B3,labelFontSize:U3,labelFontWeight:Dde,titleFont:yE,titleFontSize:W3,titleFontWeight:q3},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:B3,labelFontSize:U3,symbolType:"square",titleFont:yE,titleFontSize:W3,titleFontWeight:q3},range:{category:$f["category-6"],diverging:$f["fireandice-6"],heatmap:$f["fire-7"],ordinal:$f["fire-7"],ramp:$f["fire-7"]}},xs="#ab5787",Dm="#979797",Nde={background:"#f9f9f9",arc:{fill:xs},area:{fill:xs},line:{stroke:xs},path:{stroke:xs},rect:{fill:xs},shape:{stroke:xs},symbol:{fill:xs,size:30},axis:{domainColor:Dm,domainWidth:.5,gridWidth:.2,labelColor:Dm,tickColor:Dm,tickWidth:.2,titleColor:Dm},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Es="#3e5c69",Fde={background:"#fff",arc:{fill:Es},area:{fill:Es},line:{stroke:Es},path:{stroke:Es},rect:{fill:Es},shape:{stroke:Es},symbol:{fill:Es},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},li="#1696d2",G3="#000000",Ide="#FFFFFF",Rm="Lato",bE="Lato",Mde="Lato",jde="#DEDDDD",Lde=18,Df={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Pde={background:Ide,title:{anchor:"start",fontSize:Lde,font:Rm},axisX:{domain:!0,domainColor:G3,domainWidth:1,grid:!1,labelFontSize:12,labelFont:bE,labelAngle:0,tickColor:G3,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Rm},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:jde,gridWidth:1,labelFontSize:12,labelFont:bE,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Rm,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:bE,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Rm,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Df["six-groups-cat-1"],diverging:Df["diverging-colors"],heatmap:Df["diverging-colors"],ordinal:Df["six-groups-seq"],ramp:Df["shades-blue"]},area:{fill:li},rect:{fill:li},line:{color:li,stroke:li,strokeWidth:5},trail:{color:li,stroke:li,strokeWidth:0,size:1},path:{stroke:li,strokeWidth:.5},point:{filled:!0},text:{font:Mde,color:li,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:li,stroke:null}},arc:{fill:li},shape:{stroke:li},symbol:{fill:li,size:30}},ks="#3366CC",H3="#ccc",Nm="Arial, sans-serif",zde={arc:{fill:ks},area:{fill:ks},path:{stroke:ks},rect:{fill:ks},shape:{stroke:ks},symbol:{stroke:ks},circle:{fill:ks},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Nm,fontSize:12},"guide-title":{font:Nm,fontSize:12},"group-title":{font:Nm,fontSize:12}},title:{font:Nm,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:H3,tickColor:H3,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},Bde=xde.version;var Ude=Object.freeze({__proto__:null,version:Bde,dark:kde,excel:_de,fivethirtyeight:Ode,ggplot2:Tde,latimes:Rde,quartz:Nde,vox:Fde,urbaninstitute:Pde,googlecharts:zde}),qde=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const Y3="vg-tooltip-element",Wde={offsetX:10,offsetY:10,id:Y3,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:Gde,maxDepth:2};function Gde(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function Hde(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return qde.toString().replace(Y3,e)}var Yde=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Vde(e,t,n){if(I(e))return`[${e.map(i=>t(Y(i)?i:V3(i,n))).join(", ")}]`;if(K(e)){let i="";const r=e,{title:a,image:o}=r,s=Yde(r,["title","image"]);a&&(i+=`<h2>${t(a)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){i+="<table>";for(const u of l){let c=s[u];if(c===void 0)continue;K(c)&&(c=V3(c,n)),i+=`<tr><td class="key">${t(u)}:</td><td class="value">${t(c)}</td></tr>`}i+="</table>"}return i||"{}"}return t(e)}function Xde(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function V3(e,t){return JSON.stringify(e,Xde(t))}function Jde(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let a=e.clientY+i;return a+t.height>window.innerHeight&&(a=+e.clientY-i-t.height),{x:r,y:a}}class Kde{constructor(e){this.options=Object.assign(Object.assign({},Wde),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=Hde(t);const i=document.head;i.childNodes.length>0?i.insertBefore(n,i.childNodes[0]):i.appendChild(n)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,i){if(i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=Vde(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:a}=Jde(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${r}px`)}}function Qde(e,t,n){const i=e.open(t),r=1e4,a=250,{origin:o}=new URL(t);let s=~~(r/a);function l(c){c.source===i&&(s=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function u(){if(s<=0)return;i.postMessage(n,o),setTimeout(u,a),s-=1}setTimeout(u,a)}var Zde=`.vega-embed {
  position: relative;
  display: inline-block; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: scroll;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function X3(e,...t){for(const n of t)ehe(e,n);return e}function ehe(e,t){for(const n of Object.keys(t))Kf(e,n,t[n],!0)}var wE;const _s=die;let Rf=nde;const Fm=typeof window!="undefined"?window:void 0;Rf===void 0&&((wE=Fm==null?void 0:Fm.vl)===null||wE===void 0?void 0:wE.compile)&&(Rf=Fm.vl);const the={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},nhe={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Nf={vega:"Vega","vega-lite":"Vega-Lite"},Im={vega:_s.version,"vega-lite":Rf?Rf.version:"not available"},ihe={vega:e=>e,"vega-lite":(e,t)=>Rf.compile(e,{config:t}).spec},rhe=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`;function ahe(e){return typeof e=="function"}function J3(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+e+a),o.document.title=`${Nf[i]} JSON Source`}function ohe(e,t){var n;if(e.$schema){const i=L3(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${Nf[i.library]}, but mode argument sets ${(n=Nf[t])!==null&&n!==void 0?n:t}.`);const r=i.library;return GE.satisfies(Im[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${Nf[r]} ${i.version}, but the current version of ${Nf[r]} is v${Im[r]}.`),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function she(e){return!!(e&&"load"in e)}function lhe(e,t,n={}){var i,r,a;return Ff(this,void 0,void 0,function*(){const o=she(n.loader)?n.loader:_s.loader(n.loader),s=Y(t)?JSON.parse(yield o.load(t)):t,l=yield K3((i=s.usermeta&&s.usermeta.embedOptions)!==null&&i!==void 0?i:{},o),u=yield K3(n,o),c=Object.assign(Object.assign({},X3(u,l)),{config:ru((r=u.config)!==null&&r!==void 0?r:{},(a=l.config)!==null&&a!==void 0?a:{})});return yield uhe(e,s,c,o)})}function K3(e,t){var n;return Ff(this,void 0,void 0,function*(){const i=Y(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},r=Y(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),r?{patch:r}:{}),i?{config:i}:{})})}function uhe(e,t,n={},i){var r,a,o,s,l,u;return Ff(this,void 0,void 0,function*(){const c=n.theme?ru(Ude[n.theme],(r=n.config)!==null&&r!==void 0?r:{}):n.config,f=lo(n.actions)?n.actions:X3({},the,(a=n.actions)!==null&&a!==void 0?a:{}),d=Object.assign(Object.assign({},nhe),n.i18n),h=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(s=n.logLevel)!==null&&s!==void 0?s:_s.Warn,g=(l=n.downloadFileName)!==null&&l!==void 0?l:"visualization";if(n.defaultStyle!==!1){const _="vega-embed-style";if(!document.getElementById(_)){const O=document.createElement("style");O.id=_,O.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?Zde.toString():n.defaultStyle,document.head.appendChild(O)}}const m=ohe(t,n.mode);let v=ihe[m](t,c);if(m==="vega-lite"&&v.$schema){const _=L3(v.$schema);GE.satisfies(Im.vega,`^${_.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${_.version}, but current version is v${Im.vega}.`)}const y=typeof e=="string"?document.querySelector(e):e;if(!y)throw Error(`${e} does not exist`);y.classList.add("vega-embed"),f&&y.classList.add("has-actions"),y.innerHTML="";const b=n.patch;b&&(b instanceof Function?v=b(v):v=Mf(v,b,!0,!1).newDocument),n.formatLocale&&_s.formatLocale(n.formatLocale),n.timeFormatLocale&&_s.timeFormatLocale(n.timeFormatLocale);const E=_s.parse(v,m==="vega-lite"?{}:c),x=new _s.View(E,{loader:i,logLevel:p,renderer:h});if(n.tooltip!==!1){let _;ahe(n.tooltip)?_=n.tooltip:_=new Kde(n.tooltip===!0?{}:n.tooltip).call,x.tooltip(_)}let{hover:k}=n;if(k===void 0&&(k=m==="vega"),k){const{hoverSet:_,updateSet:O}=typeof k=="boolean"?{}:k;x.hover(_,O)}n&&(n.width!=null&&x.width(n.width),n.height!=null&&x.height(n.height),n.padding!=null&&x.padding(n.padding)),yield x.initialize(e).runAsync();let w;if(f!==!1){let _=y;if(n.defaultStyle!==!1){const S=document.createElement("details");S.title=d.CLICK_TO_VIEW_ACTIONS,y.append(S),_=S;const T=document.createElement("summary");T.innerHTML=rhe,S.append(T),w=D=>{S.contains(D.target)||S.removeAttribute("open")},document.addEventListener("click",w)}const O=document.createElement("div");if(_.append(O),O.classList.add("vega-actions"),f===!0||f.export!==!1){for(const S of["svg","png"])if(f===!0||f.export===!0||f.export[S]){const T=d[`${S.toUpperCase()}_ACTION`],D=document.createElement("a");D.text=T,D.href="#",D.target="_blank",D.download=`${g}.${S}`,D.addEventListener("mousedown",function(M){return Ff(this,void 0,void 0,function*(){M.preventDefault();const C=yield x.toImageURL(S,n.scaleFactor);this.href=C})}),O.append(D)}}if(f===!0||f.source!==!1){const S=document.createElement("a");S.text=d.SOURCE_ACTION,S.href="#",S.addEventListener("click",function(T){var D,M;J3(Wm(t),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(M=n.sourceFooter)!==null&&M!==void 0?M:"",m),T.preventDefault()}),O.append(S)}if(m==="vega-lite"&&(f===!0||f.compiled!==!1)){const S=document.createElement("a");S.text=d.COMPILED_ACTION,S.href="#",S.addEventListener("click",function(T){var D,M;J3(Wm(v),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(M=n.sourceFooter)!==null&&M!==void 0?M:"","vega"),T.preventDefault()}),O.append(S)}if(f===!0||f.editor!==!1){const S=(u=n.editorUrl)!==null&&u!==void 0?u:"https://vega.github.io/editor/",T=document.createElement("a");T.text=d.EDITOR_ACTION,T.href="#",T.addEventListener("click",function(D){Qde(window,S,{config:c,mode:m,renderer:h,spec:Wm(t)}),D.preventDefault()}),O.append(T)}}function A(){w&&document.removeEventListener("click",w),x.finalize()}return{view:x,spec:t,vgSpec:v,finalize:A}})}export default lhe;
