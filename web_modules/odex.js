import{g as We,c as Ve}from"./common/_commonjsHelpers-be8ed69f.js";var Xe=Ve(function(Je,fe){Object.defineProperty(fe,"__esModule",{value:!0});var ue;(function(v){v[v.Converged=0]="Converged",v[v.MaxStepsExceeded=1]="MaxStepsExceeded",v[v.EarlyReturn=2]="EarlyReturn"})(ue=fe.Outcome||(fe.Outcome={}));var we=function(){function v(Y){this.n=Y,this.uRound=23e-17,this.maxSteps=1e4,this.initialStepSize=1e-4,this.maxStepSize=0,this.maxExtrapolationColumns=9,this.stepSizeSequence=0,this.stabilityCheckCount=1,this.stabilityCheckTableLines=2,this.denseOutput=!1,this.denseOutputErrorEstimator=!0,this.denseComponents=void 0,this.interpolationFormulaDegree=4,this.stepSizeReductionFactor=.5,this.stepSizeFac1=.02,this.stepSizeFac2=4,this.stepSizeFac3=.8,this.stepSizeFac4=.9,this.stepSafetyFactor1=.65,this.stepSafetyFactor2=.94,this.relativeTolerance=1e-5,this.absoluteTolerance=1e-5,this.debug=!1}return v.prototype.grid=function(Y,u){if(!this.denseOutput)throw new Error("Must set .denseOutput to true when using grid");var O=this.denseComponents;if(!O){O=[];for(var o=0;o<this.n;++o)O.push(o)}var y;return function(a,G,W,Z,B){if(a===1){var d=u(W,Z);return y=W+Y,d}for(;y<=W;){for(var l=[],b=0,i=O;b<i.length;b++){var pe=i[b];l.push(B(pe,y))}var d=u(y,l);if(d===!1)return!1;y+=Y}}},v.dim2=function(Y,u){for(var O=new Array(Y+1),o=1;o<=Y;++o)O[o]=v.dim(u);return O},v.stepSizeSequence=function(Y,u){var O=new Array(u+1);O[0]=0;switch(Y){case 1:for(var o=1;o<=u;++o)O[o]=2*o;break;case 2:O[1]=2;for(var o=2;o<=u;++o)O[o]=4*o-4;break;case 3:O[1]=2,O[2]=4,O[3]=6;for(var o=4;o<=u;++o)O[o]=2*O[o-2];break;case 4:for(var o=1;o<=u;++o)O[o]=4*o-2;break;case 5:for(var o=1;o<=u;++o)O[o]=4*o;break;default:throw new Error("invalid stepSizeSequence selected")}return O},v.prototype.solve=function(Y,u,O,o,y){var a=this,G=[0].concat(O),W=v.dim(this.n),Z=v.dim(this.n),B=v.dim(this.n);if(this.maxSteps<=0)throw new Error("maxSteps must be positive");var d=this.maxExtrapolationColumns;if(d<=2)throw new Error("maxExtrapolationColumns must be > 2");var l=this.stepSizeSequence||(this.denseOutput?4:1);if(l<=3&&this.denseOutput)throw new Error("stepSizeSequence incompatible with denseOutput");if(this.denseOutput&&!y)throw new Error("denseOutput requires a solution observer function");if(this.interpolationFormulaDegree<=0||this.interpolationFormulaDegree>=7)throw new Error("bad interpolationFormulaDegree");var b=[0],i=0;if(this.denseOutput)if(this.denseComponents)for(var pe=0,Ae=this.denseComponents;pe<Ae.length;pe++){var ce=Ae[pe];if(ce<0||ce>this.n)throw new Error("bad dense component: "+ce);b.push(ce+1),++i}else{for(var Ce=1;Ce<=this.n;++Ce)b.push(Ce);i=this.n}if(this.uRound<=1e-35||this.uRound>1)throw new Error("suspicious value of uRound");var Se=Math.abs(this.maxStepSize||o-u),Pe=2*d*d+d;function be(_,se){var D=[0];if(Array.isArray(_))return D.concat(_);for(var te=0;te<se;++te)D.push(_);return D}var De=be(this.absoluteTolerance,this.n),Te=be(this.relativeTolerance,this.n),de=[0,0,0,0],Ee=de[0],ee=de[1],Me=de[2],Fe=de[3],h=Math.max(1,i),xe=Math.max(1,(2*d+5)*i),Q=v.dim(xe),$=v.dim2(Pe,h),Oe=function(_,se,D){for(var te=Y(_,se.slice(1)),J=0;J<te.length;++J)D[J+1]=te[J]},Be=function(){var _,se,D,te=function(r){if(he=u,u+=f,a.denseOutput){D=2*n-a.interpolationFormulaDegree+1;for(var e=1;e<=h;++e)Q[e]=G[b[e]];_=he,se=f;for(var e=1;e<=h;++e)Q[h+e]=f*W[b[e]];for(var R=2*h,e=1;e<=h;++e)Q[R+e]=V[1][b[e]];for(var t=2;t<=n;++t)for(var E=A[t],s=t;s>=2;--s)for(var z=Math.pow(E/A[s-1],2)-1,e=1;e<=h;++e)q[s-1][e]=q[s][e]+(q[s][e]-q[s-1][e])/z;for(var F=4*h,e=1;e<=h;++e)Q[F+e]=q[1][e];for(var e=1;e<=r;++e)Z[e]=V[1][e];Oe(u,Z,B),F=3*h;for(var e=1;e<=h;++e)Q[F+e]=B[b[e]]*f;for(var M=1;M<=D;++M){for(var g=(M+1)/2|0,S=g;S<=n;++S){var X=Math.pow(A[S]/2,M-1);K=j[S+1]-2*S+M;for(var e=1;e<=h;++e)q[S][e]=$[K][e]*X}for(var t=g+1;t<=n;++t)for(var E=A[t],s=t;s>=g+1;--s)for(var z=Math.pow(E/A[s-1],2)-1,e=1;e<=h;++e)q[s-1][e]=q[s][e]+(q[s][e]-q[s-1][e])/z;F=(M+4)*h;for(var e=1;e<=h;++e)Q[F+e]=q[g][e]*f;if(M===D)continue;for(var S=(M+2)/2|0;S<=n;++S){var U=j[S+1],N=j[S]+M+1;M===1&&l===4&&(N+=2);var s=void 0;for(s=U;s>=N;s-=2)for(var e=1;e<=h;++e)$[s][e]-=$[s-2][e];if(M===1&&l===4){s=N-2;for(var e=1;e<=h;++e)$[s][e]-=W[b[e]]}}for(var S=(M+2)/2|0;S<=n;++S)for(var U=j[S+1]-1,N=j[S]+M+2,s=U;s>=N;s-=2)for(var e=1;e<=h;++e)$[s][e]-=$[s-2][e]}if(Ye(h,Q,D),a.denseOutputErrorEstimator&&D>=1){for(var P=0,e=1;e<=h;++e)P+=Math.pow(Q[(D+4)*h+e]/ve[b[e]],2);if(P=Math.sqrt(P/h)*ze[D],Ie=f/Math.max(Math.pow(P,1/(D+4)),.01),P>10)return f=Ie,u=he,++Fe,m=!0,!0}for(var e=1;e<=r;++e)W[e]=B[e]}for(var e=1;e<=r;++e)G[e]=V[1][e];if(++Me,y&&y(Me+1,he,u,G.slice(1),a.denseOutput&&ye(_,se,D,Q,b))===!1)return!1;var w;return n===2?(w=Math.min(3,d-1),m&&(w=2)):n<=I?(w=n,H[n-1]<H[n]*a.stepSizeFac3&&(w=n-1),H[n]<H[n-1]*a.stepSizeFac4&&(w=Math.min(n+1,d-1))):(w=n-1,n>3&&H[n-2]<H[n-1]*a.stepSizeFac3&&(w=n-2),H[n]<H[w]*a.stepSizeFac4&&(w=Math.min(n,d-1))),m?(I=Math.min(w,n),f=ae*Math.min(Math.abs(f),Math.abs(re[I])),m=!1,!0):(w<=n?f=re[w]:n<I&&H[n]<H[n-1]*a.stepSizeFac4?f=re[n]*k[w+1]/k[n]:f=re[n]*k[w]/k[n],I=w,f=ae*Math.abs(f),!0)},J=function(r){for(var e=v.dim(a.n),R=f/A[r],t=1;t<=a.n;++t)Z[t]=G[t],B[t]=G[t]+R*W[t];for(var E=A[r]-1,s=A[r]/2|0,z=1;z<=E;++z){if(a.denseOutput&&z===s)for(var t=1;t<=h;++t)q[r][t]=B[b[t]];if(Oe(u+R*z,B,e),a.denseOutput&&Math.abs(z-s)<=2*r-1){++K;for(var t=1;t<=h;++t)$[K][t]=e[b[t]]}for(var t=1;t<=a.n;++t){var F=Z[t];Z[t]=B[t],B[t]=F+2*R*e[t]}if(z<=a.stabilityCheckCount&&r<=a.stabilityCheckTableLines){for(var M=0,t=1;t<=a.n;++t)M+=Math.pow(W[t]/ve[t],2);for(var g=0,t=1;t<=a.n;++t)g+=Math.pow((e[t]-W[t])/ve[t],2);var S=g/Math.max(a.uRound,M);if(S>4){++Ee,ne=!0,f*=a.stepSizeReductionFactor,m=!0;return}}}if(Oe(u+f,B,e),a.denseOutput&&s<=2*r-1){++K;for(var t=1;t<=h;++t)$[K][t]=e[b[t]]}for(var t=1;t<=a.n;++t)V[r][t]=(Z[t]+B[t]+R*e[t])/2;if(Ee+=A[r],r===1)return;for(var X=A[r],U,N=r;N>1;--N){U=Math.pow(X/A[N-1],2)-1;for(var t=1;t<=a.n;++t)V[N-1][t]=V[N][t]+(V[N][t]-V[N-1][t])/U}L=0;for(var t=1;t<=a.n;++t){var P=Math.max(Math.abs(G[t]),Math.abs(V[1][t]));ve[t]=De[t]+Te[t]*P,L+=Math.pow((V[1][t]-V[2][t])/ve[t],2)}if(L=Math.sqrt(L/a.n),L*a.uRound>=1||r>2&&L>=He){ne=!0,f*=a.stepSizeReductionFactor,m=!0;return}He=Math.max(4*L,1);var w=1/(2*r-1),p=Math.pow(a.stepSizeFac1,w);U=Math.min(a.stepSizeFac2/p,Math.max(p,Math.pow(L/a.stepSafetyFactor1,w)/a.stepSafetyFactor2)),U=1/U,re[r]=Math.min(Math.abs(f)*U,Se),H[r]=k[r]/re[r]},Ye=function(r,e,R){for(var t=new Array(31),E=1;E<=r;++E){var s=e[E],z=e[2*r+E],F=e[r+E],M=e[3*r+E],g=z-s,S=-M+g,X=F-g;if(e[r+E]=g,e[2*r+E]=S,e[3*r+E]=X,R<0)continue;var U=(s+z)*.5+.125*(S+X),N=g+(S-X)*.25,P=-(F-M),w=6*(X-S);if(R>=1&&(t[1]=16*(e[5*r+E]-N),R>=3&&(t[3]=16*(e[7*r+E]-w+3*t[1]),R>=5)))for(var p=5;p<=R;p+=2){var Re=p*(p-1)/2,ge=Re*(p-2)*(p-3)*2;t[p]=16*(e[(p+4)*r+E]+Re*t[p-2]-ge*t[p-4])}if(t[0]=(e[4*r+E]-U)*16,R>=2&&(t[2]=(e[r*6+E]-P+t[0])*16,R>=4))for(var p=4;p<=R;p+=2){var Re=p*(p-1)/2,ge=p*(p-1)*(p-2)*(p-3);t[p]=(e[r*(p+4)+E]+t[p-2]*Re-t[p-4]*ge)*16}for(var p=0;p<=R;++p)e[r*(p+4)+E]=t[p]}},ye=function(r,e,R,t,E){return function(s,z){for(var F=0,M=1;M<=h;++M)E[M]===s+1&&(F=M);if(F===0)throw new Error("no dense output available for component "+s);var g=(z-r)/e,S=1-g,X=t[F]+g*(t[h+F]+S*(t[2*h+F]*g+t[3*h+F]*S));if(R<0)return X;for(var U=g-.5,N=t[h*(R+4)+F],P=R;P>=1;--P)N=t[h*(P+3)+F]+N*U/P;return X+Math.pow(g*S,2)*N}},q=v.dim2(d,h),re=v.dim(d),V=v.dim2(d,a.n),A=v.stepSizeSequence(l,d),k=v.dim(d);k[1]=1+A[1];for(var C=2;C<=d;++C)k[C]=k[C-1]+A[C];for(var ve=v.dim(a.n),C=1;C<=a.n;++C)ve[C]=De[C]+Te[C]+Math.abs(G[C]);var ae=o-u>=0?1:-1,I=Math.max(2,Math.min(d-1,Math.floor(-v.log10(Te[1]+1e-40)*.6+1.5))),f=Math.max(Math.abs(a.initialStepSize),1e-4);f=ae*Math.min(f,Se,Math.abs(o-u)/2);var j=v.dim(d+1),ze=v.dim(2*d),he=u,K=0;if(y){if(a.denseOutput){j[1]=0;for(var C=1;C<=d;++C){var Ne=4*C-2;A[C]>Ne&&++Ne,j[C+1]=j[C]+Ne}for(var oe=1;oe<=2*d;++oe){for(var Ge=Math.sqrt(oe/(oe+4))*.5,Le=Math.pow(1/(oe+4),2),x=1;x<=oe;++x)Le*=Ge/x;ze[oe]=Le}K=0}if(y(Me+1,he,u,G.slice(1))===!1)return ue.EarlyReturn}var L=0,He=1e10,Ie=ae*Se,H=v.dim(d);H[1]=0;var m=!1,Ue=!1,ne,n=0,c;(function(r){r[r.Start=0]="Start",r[r.BasicIntegrationStep=1]="BasicIntegrationStep",r[r.ConvergenceStep=2]="ConvergenceStep",r[r.HopeForConvergence=3]="HopeForConvergence",r[r.Accept=4]="Accept",r[r.Reject=5]="Reject"})(c||(c={}));var T=c.Start;e:for(;;){a.debug&&console.log("STATE",c[T],ee,he,u,f,I,n,Ie);switch(T){case c.Start:if(ne=!1,.1*Math.abs(o-u)<=Math.abs(u)*a.uRound)break e;if(f=ae*Math.min(Math.abs(f),Math.abs(o-u),Se,Math.abs(Ie)),(u+1.01*f-o)*ae>0&&(f=o-u,Ue=!0),(ee===0||!a.denseOutput)&&(Oe(u,G,W),++Ee),ee===0||Ue){K=0,++ee;for(var x=1;x<=I;++x){if(n=x,J(x),ne)continue e;if(x>1&&L<=1){T=c.Accept;continue e}}T=c.HopeForConvergence;continue}T=c.BasicIntegrationStep;continue;case c.BasicIntegrationStep:if(K=0,++ee,ee>=a.maxSteps)return ue.MaxStepsExceeded;n=I-1;for(var x=1;x<=n;++x)if(J(x),ne){T=c.Start;continue e}I===2||m?T=c.ConvergenceStep:L<=1?T=c.Accept:L>Math.pow(A[I+1]*A[I]/4,2)?T=c.Reject:T=c.ConvergenceStep;continue;case c.ConvergenceStep:if(J(I),ne){T=c.Start;continue}if(n=I,L<=1){T=c.Accept;continue}T=c.HopeForConvergence;continue;case c.HopeForConvergence:if(L>Math.pow(A[I+1]/2,2)){T=c.Reject;continue}n=I+1,J(n),ne?T=c.Start:L>1?T=c.Reject:T=c.Accept;continue;case c.Accept:if(!te(a.n))return ue.EarlyReturn;T=c.Start;continue;case c.Reject:I=Math.min(I,n,d-1),I>2&&H[I-1]<H[I]*a.stepSizeFac3&&(I-=1),++Fe,f=ae*re[I],m=!0,T=c.BasicIntegrationStep}}return ue.Converged},qe=Be();return{y:G.slice(1),outcome:qe,nStep:ee,xEnd:o,nAccept:Me,nReject:Fe,nEval:Ee}},v}();we.dim=function(v){return Array(v+1)},we.log10=function(v){return Math.log(v)/Math.LN10},fe.Solver=we}),Qe=We(Xe);export default Qe;
