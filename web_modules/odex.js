import{c as Ia}from"./common/_commonjsHelpers-1d2f7e84.js";var Ja=Ia(function(Ta,ma){Object.defineProperty(ma,"__esModule",{value:!0});var ja;(function(h){h[h.Converged=0]="Converged",h[h.MaxStepsExceeded=1]="MaxStepsExceeded",h[h.EarlyReturn=2]="EarlyReturn"})(ja=ma.Outcome||(ma.Outcome={}));var va=function(){function h(L){this.n=L,this.uRound=23e-17,this.maxSteps=1e4,this.initialStepSize=1e-4,this.maxStepSize=0,this.maxExtrapolationColumns=9,this.stepSizeSequence=0,this.stabilityCheckCount=1,this.stabilityCheckTableLines=2,this.denseOutput=!1,this.denseOutputErrorEstimator=!0,this.denseComponents=void 0,this.interpolationFormulaDegree=4,this.stepSizeReductionFactor=.5,this.stepSizeFac1=.02,this.stepSizeFac2=4,this.stepSizeFac3=.8,this.stepSizeFac4=.9,this.stepSafetyFactor1=.65,this.stepSafetyFactor2=.94,this.relativeTolerance=1e-5,this.absoluteTolerance=1e-5,this.debug=!1}return h.prototype.grid=function(L,j){if(!this.denseOutput)throw new Error("Must set .denseOutput to true when using grid");var r=this.denseComponents;if(!r){r=[];for(var e=0;e<this.n;++e)r.push(e)}var M;return function(d,N,O,U,J){if(d===1){var o=j(O,U);return M=O+L,o}for(;M<=O;){for(var _=[],B=0,$=r;B<$.length;B++){var ka=$[B];_.push(J(ka,M))}var o=j(M,_);if(o===!1)return!1;M+=L}}},h.dim2=function(L,j){for(var r=new Array(L+1),e=1;e<=L;++e)r[e]=h.dim(j);return r},h.stepSizeSequence=function(L,j){var r=new Array(j+1);r[0]=0;switch(L){case 1:for(var e=1;e<=j;++e)r[e]=2*e;break;case 2:r[1]=2;for(var e=2;e<=j;++e)r[e]=4*e-4;break;case 3:r[1]=2,r[2]=4,r[3]=6;for(var e=4;e<=j;++e)r[e]=2*r[e-2];break;case 4:for(var e=1;e<=j;++e)r[e]=4*e-2;break;case 5:for(var e=1;e<=j;++e)r[e]=4*e;break;default:throw new Error("invalid stepSizeSequence selected")}return r},h.prototype.solve=function(L,j,r,e,M){var d=this,N=[0].concat(r),O=h.dim(this.n),U=h.dim(this.n),J=h.dim(this.n);if(this.maxSteps<=0)throw new Error("maxSteps must be positive");var o=this.maxExtrapolationColumns;if(o<=2)throw new Error("maxExtrapolationColumns must be > 2");var _=this.stepSizeSequence||(this.denseOutput?4:1);if(_<=3&&this.denseOutput)throw new Error("stepSizeSequence incompatible with denseOutput");if(this.denseOutput&&!M)throw new Error("denseOutput requires a solution observer function");if(this.interpolationFormulaDegree<=0||this.interpolationFormulaDegree>=7)throw new Error("bad interpolationFormulaDegree");var B=[0],$=0;if(this.denseOutput)if(this.denseComponents)for(var ka=0,Ba=this.denseComponents;ka<Ba.length;ka++){var na=Ba[ka];if(na<0||na>this.n)throw new Error("bad dense component: "+na);B.push(na+1),++$}else{for(var wa=1;wa<=this.n;++wa)B.push(wa);$=this.n}if(this.uRound<=1e-35||this.uRound>1)throw new Error("suspicious value of uRound");var oa=Math.abs(this.maxStepSize||e-j),Ka=2*o*o+o;function Ca(W,ga){var C=[0];if(Array.isArray(W))return C.concat(W);{for(var ba=0;ba<ga;++ba)C.push(W);return C}}var Da=Ca(this.absoluteTolerance,this.n),xa=Ca(this.relativeTolerance,this.n),pa=[0,0,0,0],qa=pa[0],aa=pa[1],ra=pa[2],ya=pa[3],i=Math.max(1,$),La=Math.max(1,(2*o+5)*$),R=h.dim(La),V=h.dim2(Ka,i),sa=function(W,ga,C){for(var ba=L(W,ga.slice(1)),S=0;S<ba.length;++S)C[S+1]=ba[S]},Ma=function(){var W,ga,C,ba=function(c){ia=j,j+=l;if(d.denseOutput){C=2*f-d.interpolationFormulaDegree+1;for(var a=1;a<=i;++a)R[a]=N[B[a]];W=ia,ga=l;for(var a=1;a<=i;++a)R[i+a]=l*O[B[a]];for(var t=2*i,a=1;a<=i;++a)R[t+a]=P[1][B[a]];for(var b=2;b<=f;++b)for(var p=A[b],g=b;g>=2;--g)for(var D=Math.pow(p/A[g-1],2)-1,a=1;a<=i;++a)K[g-1][a]=K[g][a]+(K[g][a]-K[g-1][a])/D;for(var x=4*i,a=1;a<=i;++a)R[x+a]=K[1][a];for(var a=1;a<=c;++a)U[a]=P[1][a];sa(j,U,J),x=3*i;for(var a=1;a<=i;++a)R[x+a]=J[B[a]]*l;for(var q=1;q<=C;++q){for(var z=(q+1)/2|0,n=z;n<=f;++n){var Q=Math.pow(A[n]/2,q-1);T=Y[n+1]-2*n+q;for(var a=1;a<=i;++a)K[n][a]=V[T][a]*Q}for(var b=z+1;b<=f;++b)for(var p=A[b],g=b;g>=z+1;--g)for(var D=Math.pow(p/A[g-1],2)-1,a=1;a<=i;++a)K[g-1][a]=K[g][a]+(K[g][a]-K[g-1][a])/D;x=(q+4)*i;for(var a=1;a<=i;++a)R[x+a]=K[z][a]*l;if(q===C)continue;for(var n=(q+2)/2|0;n<=f;++n){var G=Y[n+1],y=Y[n]+q+1;q===1&&_===4&&(y+=2);var g=void 0;for(g=G;g>=y;g-=2)for(var a=1;a<=i;++a)V[g][a]-=V[g-2][a];if(q===1&&_===4){g=y-2;for(var a=1;a<=i;++a)V[g][a]-=O[B[a]]}}for(var n=(q+2)/2|0;n<=f;++n)for(var G=Y[n+1]-1,y=Y[n]+q+2,g=G;g>=y;g-=2)for(var a=1;a<=i;++a)V[g][a]-=V[g-2][a]}Oa(i,R,C);if(d.denseOutputErrorEstimator&&C>=1){for(var H=0,a=1;a<=i;++a)H+=Math.pow(R[(C+4)*i+a]/ha[B[a]],2);H=Math.sqrt(H/i)*Ea[C],ta=l/Math.max(Math.pow(H,1/(C+4)),.01);if(H>10)return l=ta,j=ia,++ya,Z=!0,!0}for(var a=1;a<=c;++a)O[a]=J[a]}for(var a=1;a<=c;++a)N[a]=P[1][a];++ra;if(M){if(M(ra+1,ia,j,N.slice(1),d.denseOutput&&Pa(W,ga,C,R,B))===!1)return!1}var u;return f===2?(u=Math.min(3,o-1),Z&&(u=2)):f<=s?(u=f,F[f-1]<F[f]*d.stepSizeFac3&&(u=f-1),F[f]<F[f-1]*d.stepSizeFac4&&(u=Math.min(f+1,o-1))):(u=f-1,f>3&&F[f-2]<F[f-1]*d.stepSizeFac3&&(u=f-2),F[f]<F[u]*d.stepSizeFac4&&(u=Math.min(f,o-1))),Z?(s=Math.min(u,f),l=da*Math.min(Math.abs(l),Math.abs(ca[s])),Z=!1,!0):(u<=f?l=ca[u]:f<s&&F[f]<F[f-1]*d.stepSizeFac4?l=ca[f]*X[u+1]/X[f]:l=ca[f]*X[u]/X[f],s=u,l=da*Math.abs(l),!0)},S=function(c){for(var a=h.dim(d.n),t=l/A[c],b=1;b<=d.n;++b)U[b]=N[b],J[b]=N[b]+t*O[b];for(var p=A[c]-1,g=A[c]/2|0,D=1;D<=p;++D){if(d.denseOutput&&D===g)for(var b=1;b<=i;++b)K[c][b]=J[B[b]];sa(j+t*D,J,a);if(d.denseOutput&&Math.abs(D-g)<=2*c-1){++T;for(var b=1;b<=i;++b)V[T][b]=a[B[b]]}for(var b=1;b<=d.n;++b){var x=U[b];U[b]=J[b],J[b]=x+2*t*a[b]}if(D<=d.stabilityCheckCount&&c<=d.stabilityCheckTableLines){for(var q=0,b=1;b<=d.n;++b)q+=Math.pow(O[b]/ha[b],2);for(var z=0,b=1;b<=d.n;++b)z+=Math.pow((a[b]-O[b])/ha[b],2);var n=z/Math.max(d.uRound,q);if(n>4){++qa,fa=!0,l*=d.stepSizeReductionFactor,Z=!0;return}}}sa(j+l,J,a);if(d.denseOutput&&g<=2*c-1){++T;for(var b=1;b<=i;++b)V[T][b]=a[B[b]]}for(var b=1;b<=d.n;++b)P[c][b]=(U[b]+J[b]+t*a[b])/2;qa+=A[c];if(c===1)return;for(var Q=A[c],G,y=c;y>1;--y){G=Math.pow(Q/A[y-1],2)-1;for(var b=1;b<=d.n;++b)P[y-1][b]=P[y][b]+(P[y][b]-P[y-1][b])/G}E=0;for(var b=1;b<=d.n;++b){var H=Math.max(Math.abs(N[b]),Math.abs(P[1][b]));ha[b]=Da[b]+xa[b]*H,E+=Math.pow((P[1][b]-P[2][b])/ha[b],2)}E=Math.sqrt(E/d.n);if(E*d.uRound>=1||c>2&&E>=Ga){fa=!0,l*=d.stepSizeReductionFactor,Z=!0;return}Ga=Math.max(4*E,1);var u=1/(2*c-1),k=Math.pow(d.stepSizeFac1,u);G=Math.min(d.stepSizeFac2/k,Math.max(k,Math.pow(E/d.stepSafetyFactor1,u)/d.stepSafetyFactor2)),G=1/G,ca[c]=Math.min(Math.abs(l)*G,oa),F[c]=X[c]/ca[c]},Oa=function(c,a,t){for(var b=new Array(31),p=1;p<=c;++p){var g=a[p],D=a[2*c+p],x=a[c+p],q=a[3*c+p],z=D-g,n=-q+z,Q=x-z;a[c+p]=z,a[2*c+p]=n,a[3*c+p]=Q;if(t<0)continue;var G=(g+D)*.5+.125*(n+Q),y=z+(n-Q)*.25,H=-(x-q),u=6*(Q-n);if(t>=1){b[1]=16*(a[5*c+p]-y);if(t>=3){b[3]=16*(a[7*c+p]-u+3*b[1]);if(t>=5)for(var k=5;k<=t;k+=2){var ua=k*(k-1)/2,Aa=ua*(k-2)*(k-3)*2;b[k]=16*(a[(k+4)*c+p]+ua*b[k-2]-Aa*b[k-4])}}}b[0]=(a[4*c+p]-G)*16;if(t>=2){b[2]=(a[c*6+p]-H+b[0])*16;if(t>=4)for(var k=4;k<=t;k+=2){var ua=k*(k-1)/2,Aa=k*(k-1)*(k-2)*(k-3);b[k]=(a[c*(k+4)+p]+b[k-2]*ua-b[k-4]*Aa)*16}}for(var k=0;k<=t;++k)a[c*(k+4)+p]=b[k]}},Pa=function(c,a,t,b,p){return function(g,D){for(var x=0,q=1;q<=i;++q)p[q]===g+1&&(x=q);if(x===0)throw new Error("no dense output available for component "+g);var z=(D-c)/a,n=1-z,Q=b[x]+z*(b[i+x]+n*(b[2*i+x]*z+b[3*i+x]*n));if(t<0)return Q;for(var G=z-.5,y=b[i*(t+4)+x],H=t;H>=1;--H)y=b[i*(H+3)+x]+y*G/H;return Q+Math.pow(z*n,2)*y}},K=h.dim2(o,i),ca=h.dim(o),P=h.dim2(o,d.n),A=h.stepSizeSequence(_,o),X=h.dim(o);X[1]=1+A[1];for(var v=2;v<=o;++v)X[v]=X[v-1]+A[v];for(var ha=h.dim(d.n),v=1;v<=d.n;++v)ha[v]=Da[v]+xa[v]+Math.abs(N[v]);var da=e-j>=0?1:-1,s=Math.max(2,Math.min(o-1,Math.floor(-h.log10(xa[1]+1e-40)*.6+1.5))),l=Math.max(Math.abs(d.initialStepSize),1e-4);l=da*Math.min(l,oa,Math.abs(e-j)/2);var Y=h.dim(o+1),Ea=h.dim(2*o),ia=j,T=0;if(M){if(d.denseOutput){Y[1]=0;for(var v=1;v<=o;++v){var za=4*v-2;A[v]>za&&++za,Y[v+1]=Y[v]+za}for(var ea=1;ea<=2*o;++ea){for(var Qa=Math.sqrt(ea/(ea+4))*.5,Fa=Math.pow(1/(ea+4),2),I=1;I<=ea;++I)Fa*=Qa/I;Ea[ea]=Fa}T=0}if(!1===M(ra+1,ia,j,N.slice(1)))return ja.EarlyReturn}var E=0,Ga=1e10,ta=da*oa,F=h.dim(o);F[1]=0;var Z=!1,Ha=!1,fa,f=0,m;(function(c){c[c.Start=0]="Start",c[c.BasicIntegrationStep=1]="BasicIntegrationStep",c[c.ConvergenceStep=2]="ConvergenceStep",c[c.HopeForConvergence=3]="HopeForConvergence",c[c.Accept=4]="Accept",c[c.Reject=5]="Reject"})(m||(m={}));var w=m.Start;la:for(;;){d.debug&&console.log("STATE",m[w],aa,ia,j,l,s,f,ta);switch(w){case m.Start:fa=!1;if(.1*Math.abs(e-j)<=Math.abs(j)*d.uRound)break la;l=da*Math.min(Math.abs(l),Math.abs(e-j),oa,Math.abs(ta)),(j+1.01*l-e)*da>0&&(l=e-j,Ha=!0),(aa===0||!d.denseOutput)&&(sa(j,N,O),++qa);if(aa===0||Ha){T=0,++aa;for(var I=1;I<=s;++I){f=I,S(I);if(fa)continue la;if(I>1&&E<=1){w=m.Accept;continue la}}w=m.HopeForConvergence;continue}w=m.BasicIntegrationStep;continue;case m.BasicIntegrationStep:T=0,++aa;if(aa>=d.maxSteps)return ja.MaxStepsExceeded;f=s-1;for(var I=1;I<=f;++I){S(I);if(fa){w=m.Start;continue la}}s===2||Z?w=m.ConvergenceStep:E<=1?w=m.Accept:E>Math.pow(A[s+1]*A[s]/4,2)?w=m.Reject:w=m.ConvergenceStep;continue;case m.ConvergenceStep:S(s);if(fa){w=m.Start;continue}f=s;if(E<=1){w=m.Accept;continue}w=m.HopeForConvergence;continue;case m.HopeForConvergence:if(E>Math.pow(A[s+1]/2,2)){w=m.Reject;continue}f=s+1,S(f),fa?w=m.Start:E>1?w=m.Reject:w=m.Accept;continue;case m.Accept:if(!ba(d.n))return ja.EarlyReturn;w=m.Start;continue;case m.Reject:s=Math.min(s,f,o-1),s>2&&F[s-1]<F[s]*d.stepSizeFac3&&(s-=1),++ya,l=da*ca[s],Z=!0,w=m.BasicIntegrationStep}}return ja.Converged},Na=Ma();return{y:N.slice(1),outcome:Na,nStep:aa,xEnd:e,nAccept:ra,nReject:ya,nEval:qa}},h}();va.dim=function(h){return Array(h+1)},va.log10=function(h){return Math.log(h)/Math.LN10},ma.Solver=va});export default Ja;
