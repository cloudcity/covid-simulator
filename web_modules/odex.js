import{g as qe,c as Ye}from"./common/_commonjsHelpers-be8ed69f.js";var Ge=Ye(function(_e,ve){Object.defineProperty(ve,"__esModule",{value:!0});var ce;(function(s){s[s.Converged=0]="Converged",s[s.MaxStepsExceeded=1]="MaxStepsExceeded",s[s.EarlyReturn=2]="EarlyReturn"})(ce=ve.Outcome||(ve.Outcome={}));var Oe=function(){function s(U){this.n=U,this.uRound=23e-17,this.maxSteps=1e4,this.initialStepSize=1e-4,this.maxStepSize=0,this.maxExtrapolationColumns=9,this.stepSizeSequence=0,this.stabilityCheckCount=1,this.stabilityCheckTableLines=2,this.denseOutput=!1,this.denseOutputErrorEstimator=!0,this.denseComponents=void 0,this.interpolationFormulaDegree=4,this.stepSizeReductionFactor=.5,this.stepSizeFac1=.02,this.stepSizeFac2=4,this.stepSizeFac3=.8,this.stepSizeFac4=.9,this.stepSafetyFactor1=.65,this.stepSafetyFactor2=.94,this.relativeTolerance=1e-5,this.absoluteTolerance=1e-5,this.debug=!1}return s.prototype.grid=function(U,c){if(!this.denseOutput)throw new Error("Must set .denseOutput to true when using grid");var m=this.denseComponents;if(!m){m=[];for(var o=0;o<this.n;++o)m.push(o)}var P;return function(a,B,q,X,y){if(a===1){var d=c(q,X);return P=q+U,d}for(;P<=q;){for(var $=[],T=0,j=m;T<j.length;T++){var ue=j[T];$.push(y(ue,P))}var d=c(P,$);if(d===!1)return!1;P+=U}}},s.dim2=function(U,c){for(var m=new Array(U+1),o=1;o<=U;++o)m[o]=s.dim(c);return m},s.stepSizeSequence=function(U,c){var m=new Array(c+1);m[0]=0;switch(U){case 1:for(var o=1;o<=c;++o)m[o]=2*o;break;case 2:m[1]=2;for(var o=2;o<=c;++o)m[o]=4*o-4;break;case 3:m[1]=2,m[2]=4,m[3]=6;for(var o=4;o<=c;++o)m[o]=2*m[o-2];break;case 4:for(var o=1;o<=c;++o)m[o]=4*o-2;break;case 5:for(var o=1;o<=c;++o)m[o]=4*o;break;default:throw new Error("invalid stepSizeSequence selected")}return m},s.prototype.solve=function(U,c,m,o,P){var a=this,B=[0].concat(m),q=s.dim(this.n),X=s.dim(this.n),y=s.dim(this.n);if(this.maxSteps<=0)throw new Error("maxSteps must be positive");var d=this.maxExtrapolationColumns;if(d<=2)throw new Error("maxExtrapolationColumns must be > 2");var $=this.stepSizeSequence||(this.denseOutput?4:1);if($<=3&&this.denseOutput)throw new Error("stepSizeSequence incompatible with denseOutput");if(this.denseOutput&&!P)throw new Error("denseOutput requires a solution observer function");if(this.interpolationFormulaDegree<=0||this.interpolationFormulaDegree>=7)throw new Error("bad interpolationFormulaDegree");var T=[0],j=0;if(this.denseOutput)if(this.denseComponents)for(var ue=0,Ce=this.denseComponents;ue<Ce.length;ue++){var he=Ce[ue];if(he<0||he>this.n)throw new Error("bad dense component: "+he);T.push(he+1),++j}else{for(var Ie=1;Ie<=this.n;++Ie)T.push(Ie);j=this.n}if(this.uRound<=1e-35||this.uRound>1)throw new Error("suspicious value of uRound");var pe=Math.abs(this.maxStepSize||o-c),Le=2*d*d+d;function Te(Q,ie){var F=[0];if(Array.isArray(Q))return F.concat(Q);for(var te=0;te<ie;++te)F.push(Q);return F}var Fe=Te(this.absoluteTolerance,this.n),Re=Te(this.relativeTolerance,this.n),de=[0,0,0,0],le=de[0],ee=de[1],Se=de[2],be=de[3],f=Math.max(1,j),He=Math.max(1,(2*d+5)*j),W=s.dim(He),k=s.dim2(Le,f),me=function(Q,ie,F){for(var te=U(Q,ie.slice(1)),_=0;_<te.length;++_)F[_+1]=te[_]},ye=function(){var Q,ie,F,te=function(r){if(fe=c,c+=v,a.denseOutput){F=2*n-a.interpolationFormulaDegree+1;for(var e=1;e<=f;++e)W[e]=B[T[e]];Q=fe,ie=v;for(var e=1;e<=f;++e)W[f+e]=v*q[T[e]];for(var M=2*f,e=1;e<=f;++e)W[M+e]=Y[1][T[e]];for(var t=2;t<=n;++t)for(var l=C[t],i=t;i>=2;--i)for(var A=Math.pow(l/C[i-1],2)-1,e=1;e<=f;++e)x[i-1][e]=x[i][e]+(x[i][e]-x[i-1][e])/A;for(var b=4*f,e=1;e<=f;++e)W[b+e]=x[1][e];for(var e=1;e<=r;++e)X[e]=Y[1][e];me(c,X,y),b=3*f;for(var e=1;e<=f;++e)W[b+e]=y[T[e]]*v;for(var S=1;S<=F;++S){for(var w=(S+1)/2|0,p=w;p<=n;++p){var G=Math.pow(C[p]/2,S-1);V=K[p+1]-2*p+S;for(var e=1;e<=f;++e)x[p][e]=k[V][e]*G}for(var t=w+1;t<=n;++t)for(var l=C[t],i=t;i>=w+1;--i)for(var A=Math.pow(l/C[i-1],2)-1,e=1;e<=f;++e)x[i-1][e]=x[i][e]+(x[i][e]-x[i-1][e])/A;b=(S+4)*f;for(var e=1;e<=f;++e)W[b+e]=x[w][e]*v;if(S===F)continue;for(var p=(S+2)/2|0;p<=n;++p){var z=K[p+1],g=K[p]+S+1;S===1&&$===4&&(g+=2);var i=void 0;for(i=z;i>=g;i-=2)for(var e=1;e<=f;++e)k[i][e]-=k[i-2][e];if(S===1&&$===4){i=g-2;for(var e=1;e<=f;++e)k[i][e]-=q[T[e]]}}for(var p=(S+2)/2|0;p<=n;++p)for(var z=K[p+1]-1,g=K[p]+S+2,i=z;i>=g;i-=2)for(var e=1;e<=f;++e)k[i][e]-=k[i-2][e]}if(Ue(f,W,F),a.denseOutputErrorEstimator&&F>=1){for(var L=0,e=1;e<=f;++e)L+=Math.pow(W[(F+4)*f+e]/se[T[e]],2);if(L=Math.sqrt(L/f)*Ae[F],Ee=v/Math.max(Math.pow(L,1/(F+4)),.01),L>10)return v=Ee,c=fe,++be,Z=!0,!0}for(var e=1;e<=r;++e)q[e]=y[e]}for(var e=1;e<=r;++e)B[e]=Y[1][e];if(++Se,P&&P(Se+1,fe,c,B.slice(1),a.denseOutput&&Pe(Q,ie,F,W,T))===!1)return!1;var O;return n===2?(O=Math.min(3,d-1),Z&&(O=2)):n<=E?(O=n,D[n-1]<D[n]*a.stepSizeFac3&&(O=n-1),D[n]<D[n-1]*a.stepSizeFac4&&(O=Math.min(n+1,d-1))):(O=n-1,n>3&&D[n-2]<D[n-1]*a.stepSizeFac3&&(O=n-2),D[n]<D[O]*a.stepSizeFac4&&(O=Math.min(n,d-1))),Z?(E=Math.min(O,n),v=ae*Math.min(Math.abs(v),Math.abs(re[E])),Z=!1,!0):(O<=n?v=re[O]:n<E&&D[n]<D[n-1]*a.stepSizeFac4?v=re[n]*J[O+1]/J[n]:v=re[n]*J[O]/J[n],E=O,v=ae*Math.abs(v),!0)},_=function(r){for(var e=s.dim(a.n),M=v/C[r],t=1;t<=a.n;++t)X[t]=B[t],y[t]=B[t]+M*q[t];for(var l=C[r]-1,i=C[r]/2|0,A=1;A<=l;++A){if(a.denseOutput&&A===i)for(var t=1;t<=f;++t)x[r][t]=y[T[t]];if(me(c+M*A,y,e),a.denseOutput&&Math.abs(A-i)<=2*r-1){++V;for(var t=1;t<=f;++t)k[V][t]=e[T[t]]}for(var t=1;t<=a.n;++t){var b=X[t];X[t]=y[t],y[t]=b+2*M*e[t]}if(A<=a.stabilityCheckCount&&r<=a.stabilityCheckTableLines){for(var S=0,t=1;t<=a.n;++t)S+=Math.pow(q[t]/se[t],2);for(var w=0,t=1;t<=a.n;++t)w+=Math.pow((e[t]-q[t])/se[t],2);var p=w/Math.max(a.uRound,S);if(p>4){++le,ne=!0,v*=a.stepSizeReductionFactor,Z=!0;return}}}if(me(c+v,y,e),a.denseOutput&&i<=2*r-1){++V;for(var t=1;t<=f;++t)k[V][t]=e[T[t]]}for(var t=1;t<=a.n;++t)Y[r][t]=(X[t]+y[t]+M*e[t])/2;if(le+=C[r],r===1)return;for(var G=C[r],z,g=r;g>1;--g){z=Math.pow(G/C[g-1],2)-1;for(var t=1;t<=a.n;++t)Y[g-1][t]=Y[g][t]+(Y[g][t]-Y[g-1][t])/z}N=0;for(var t=1;t<=a.n;++t){var L=Math.max(Math.abs(B[t]),Math.abs(Y[1][t]));se[t]=Fe[t]+Re[t]*L,N+=Math.pow((Y[1][t]-Y[2][t])/se[t],2)}if(N=Math.sqrt(N/a.n),N*a.uRound>=1||r>2&&N>=De){ne=!0,v*=a.stepSizeReductionFactor,Z=!0;return}De=Math.max(4*N,1);var O=1/(2*r-1),u=Math.pow(a.stepSizeFac1,O);z=Math.min(a.stepSizeFac2/u,Math.max(u,Math.pow(N/a.stepSafetyFactor1,O)/a.stepSafetyFactor2)),z=1/z,re[r]=Math.min(Math.abs(v)*z,pe),D[r]=J[r]/re[r]},Ue=function(r,e,M){for(var t=new Array(31),l=1;l<=r;++l){var i=e[l],A=e[2*r+l],b=e[r+l],S=e[3*r+l],w=A-i,p=-S+w,G=b-w;if(e[r+l]=w,e[2*r+l]=p,e[3*r+l]=G,M<0)continue;var z=(i+A)*.5+.125*(p+G),g=w+(p-G)*.25,L=-(b-S),O=6*(G-p);if(M>=1&&(t[1]=16*(e[5*r+l]-g),M>=3&&(t[3]=16*(e[7*r+l]-O+3*t[1]),M>=5)))for(var u=5;u<=M;u+=2){var Me=u*(u-1)/2,we=Me*(u-2)*(u-3)*2;t[u]=16*(e[(u+4)*r+l]+Me*t[u-2]-we*t[u-4])}if(t[0]=(e[4*r+l]-z)*16,M>=2&&(t[2]=(e[r*6+l]-L+t[0])*16,M>=4))for(var u=4;u<=M;u+=2){var Me=u*(u-1)/2,we=u*(u-1)*(u-2)*(u-3);t[u]=(e[r*(u+4)+l]+t[u-2]*Me-t[u-4]*we)*16}for(var u=0;u<=M;++u)e[r*(u+4)+l]=t[u]}},Pe=function(r,e,M,t,l){return function(i,A){for(var b=0,S=1;S<=f;++S)l[S]===i+1&&(b=S);if(b===0)throw new Error("no dense output available for component "+i);var w=(A-r)/e,p=1-w,G=t[b]+w*(t[f+b]+p*(t[2*f+b]*w+t[3*f+b]*p));if(M<0)return G;for(var z=w-.5,g=t[f*(M+4)+b],L=M;L>=1;--L)g=t[f*(L+3)+b]+g*z/L;return G+Math.pow(w*p,2)*g}},x=s.dim2(d,f),re=s.dim(d),Y=s.dim2(d,a.n),C=s.stepSizeSequence($,d),J=s.dim(d);J[1]=1+C[1];for(var I=2;I<=d;++I)J[I]=J[I-1]+C[I];for(var se=s.dim(a.n),I=1;I<=a.n;++I)se[I]=Fe[I]+Re[I]+Math.abs(B[I]);var ae=o-c>=0?1:-1,E=Math.max(2,Math.min(d-1,Math.floor(-s.log10(Re[1]+1e-40)*.6+1.5))),v=Math.max(Math.abs(a.initialStepSize),1e-4);v=ae*Math.min(v,pe,Math.abs(o-c)/2);var K=s.dim(d+1),Ae=s.dim(2*d),fe=c,V=0;if(P){if(a.denseOutput){K[1]=0;for(var I=1;I<=d;++I){var ge=4*I-2;C[I]>ge&&++ge,K[I+1]=K[I]+ge}for(var oe=1;oe<=2*d;++oe){for(var Be=Math.sqrt(oe/(oe+4))*.5,Ne=Math.pow(1/(oe+4),2),H=1;H<=oe;++H)Ne*=Be/H;Ae[oe]=Ne}V=0}if(P(Se+1,fe,c,B.slice(1))===!1)return ce.EarlyReturn}var N=0,De=1e10,Ee=ae*pe,D=s.dim(d);D[1]=0;var Z=!1,ze=!1,ne,n=0,h;(function(r){r[r.Start=0]="Start",r[r.BasicIntegrationStep=1]="BasicIntegrationStep",r[r.ConvergenceStep=2]="ConvergenceStep",r[r.HopeForConvergence=3]="HopeForConvergence",r[r.Accept=4]="Accept",r[r.Reject=5]="Reject"})(h||(h={}));var R=h.Start;e:for(;;){a.debug&&console.log("STATE",h[R],ee,fe,c,v,E,n,Ee);switch(R){case h.Start:if(ne=!1,.1*Math.abs(o-c)<=Math.abs(c)*a.uRound)break e;if(v=ae*Math.min(Math.abs(v),Math.abs(o-c),pe,Math.abs(Ee)),(c+1.01*v-o)*ae>0&&(v=o-c,ze=!0),(ee===0||!a.denseOutput)&&(me(c,B,q),++le),ee===0||ze){V=0,++ee;for(var H=1;H<=E;++H){if(n=H,_(H),ne)continue e;if(H>1&&N<=1){R=h.Accept;continue e}}R=h.HopeForConvergence;continue}R=h.BasicIntegrationStep;continue;case h.BasicIntegrationStep:if(V=0,++ee,ee>=a.maxSteps)return ce.MaxStepsExceeded;n=E-1;for(var H=1;H<=n;++H)if(_(H),ne){R=h.Start;continue e}E===2||Z?R=h.ConvergenceStep:N<=1?R=h.Accept:N>Math.pow(C[E+1]*C[E]/4,2)?R=h.Reject:R=h.ConvergenceStep;continue;case h.ConvergenceStep:if(_(E),ne){R=h.Start;continue}if(n=E,N<=1){R=h.Accept;continue}R=h.HopeForConvergence;continue;case h.HopeForConvergence:if(N>Math.pow(C[E+1]/2,2)){R=h.Reject;continue}n=E+1,_(n),ne?R=h.Start:N>1?R=h.Reject:R=h.Accept;continue;case h.Accept:if(!te(a.n))return ce.EarlyReturn;R=h.Start;continue;case h.Reject:E=Math.min(E,n,d-1),E>2&&D[E-1]<D[E]*a.stepSizeFac3&&(E-=1),++be,v=ae*re[E],Z=!0,R=h.BasicIntegrationStep}}return ce.Converged},xe=ye();return{y:B.slice(1),outcome:xe,nStep:ee,xEnd:o,nAccept:Se,nReject:be,nEval:le}},s}();Oe.dim=function(s){return Array(s+1)},Oe.log10=function(s){return Math.log(s)/Math.LN10},ve.Solver=Oe}),We=qe(Ge);export default We;
