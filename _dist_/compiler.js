import n from"./thunk.js";function t(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function c(o){var r=new t();r.pre=o.pre,r.body=o.body,r.post=o.post;var a=o.args.slice(0);r.argTypes=a;for(var e=0;e<a.length;++e){var s=a[e];if(s==="array"||typeof s=="object"&&s.blockIndices){if(r.argTypes[e]="array",r.arrayArgs.push(e),r.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),r.shimArgs.push("array"+e),e<r.pre.args.length&&r.pre.args[e].count>0)throw new Error("cwise: pre() block may not reference array args");if(e<r.post.args.length&&r.post.args[e].count>0)throw new Error("cwise: post() block may not reference array args")}else if(s==="scalar")r.scalarArgs.push(e),r.shimArgs.push("scalar"+e);else if(s==="index"){if(r.indexArgs.push(e),e<r.pre.args.length&&r.pre.args[e].count>0)throw new Error("cwise: pre() block may not reference array index");if(e<r.body.args.length&&r.body.args[e].lvalue)throw new Error("cwise: body() block may not write to array index");if(e<r.post.args.length&&r.post.args[e].count>0)throw new Error("cwise: post() block may not reference array index")}else if(s==="shape"){if(r.shapeArgs.push(e),e<r.pre.args.length&&r.pre.args[e].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(e<r.body.args.length&&r.body.args[e].lvalue)throw new Error("cwise: body() block may not write to array shape");if(e<r.post.args.length&&r.post.args[e].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof s=="object"&&s.offset)r.argTypes[e]="offset",r.offsetArgs.push({array:s.array,offset:s.offset}),r.offsetArgIndex.push(e);else throw new Error("cwise: Unknown argument type "+a[e])}if(r.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(r.pre.args.length>a.length)throw new Error("cwise: Too many arguments in pre() block");if(r.body.args.length>a.length)throw new Error("cwise: Too many arguments in body() block");if(r.post.args.length>a.length)throw new Error("cwise: Too many arguments in post() block");return r.debug=!!o.printCode||!!o.debug,r.funcName=o.funcName||"cwise",r.blockSize=o.blockSize||64,n(r)}export default c;
