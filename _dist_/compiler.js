import f from"./thunk.js";function g(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function h(d){var a=new g();a.pre=d.pre,a.body=d.body,a.post=d.post;var e=d.args.slice(0);a.argTypes=e;for(var b=0;b<e.length;++b){var c=e[b];if(c==="array"||typeof c==="object"&&c.blockIndices){a.argTypes[b]="array",a.arrayArgs.push(b),a.arrayBlockIndices.push(c.blockIndices?c.blockIndices:0),a.shimArgs.push("array"+b);if(b<a.pre.args.length&&a.pre.args[b].count>0)throw new Error("cwise: pre() block may not reference array args");if(b<a.post.args.length&&a.post.args[b].count>0)throw new Error("cwise: post() block may not reference array args")}else if(c==="scalar")a.scalarArgs.push(b),a.shimArgs.push("scalar"+b);else if(c==="index"){a.indexArgs.push(b);if(b<a.pre.args.length&&a.pre.args[b].count>0)throw new Error("cwise: pre() block may not reference array index");if(b<a.body.args.length&&a.body.args[b].lvalue)throw new Error("cwise: body() block may not write to array index");if(b<a.post.args.length&&a.post.args[b].count>0)throw new Error("cwise: post() block may not reference array index")}else if(c==="shape"){a.shapeArgs.push(b);if(b<a.pre.args.length&&a.pre.args[b].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(b<a.body.args.length&&a.body.args[b].lvalue)throw new Error("cwise: body() block may not write to array shape");if(b<a.post.args.length&&a.post.args[b].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof c==="object"&&c.offset)a.argTypes[b]="offset",a.offsetArgs.push({array:c.array,offset:c.offset}),a.offsetArgIndex.push(b);else throw new Error("cwise: Unknown argument type "+e[b])}if(a.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(a.pre.args.length>e.length)throw new Error("cwise: Too many arguments in pre() block");if(a.body.args.length>e.length)throw new Error("cwise: Too many arguments in body() block");if(a.post.args.length>e.length)throw new Error("cwise: Too many arguments in post() block");return a.debug=!!d.printCode||!!d.debug,a.funcName=d.funcName||"cwise",a.blockSize=d.blockSize||64,f(a)}export default h;
